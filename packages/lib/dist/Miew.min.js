/** Miew - 3D Molecular Viewer v0.9.0+20211216.153701.b82b229 Copyright (c) 2015-2021 EPAM Systems, Inc. */
!(function (e, t) {
  'object' == typeof exports && 'undefined' != typeof module
    ? (module.exports = t(require('lodash'), require('three')))
    : 'function' == typeof define && define.amd
    ? define(['lodash', 'three'], t)
    : ((e = 'undefined' != typeof globalThis ? globalThis : e || self).Miew = t(
        e._,
        e.THREE
      ))
})(this, function (e, i) {
  'use strict'
  function t(e) {
    return e && 'object' == typeof e && 'default' in e ? e : { default: e }
  }
  function r(r) {
    if (r && r.__esModule) return r
    var n = Object.create(null)
    return (
      r &&
        Object.keys(r).forEach(function (e) {
          var t
          'default' !== e &&
            ((t = Object.getOwnPropertyDescriptor(r, e)),
            Object.defineProperty(
              n,
              e,
              t.get
                ? t
                : {
                    enumerable: !0,
                    get: function () {
                      return r[e]
                    }
                  }
            ))
        }),
      (n.default = r),
      Object.freeze(n)
    )
  }
  var b = t(e),
    ae = r(i)
  function n(e, t) {
    ;(null == t || t > e.length) && (t = e.length)
    for (var r = 0, n = new Array(t); r < t; r++) n[r] = e[r]
    return n
  }
  function o(e, t) {
    if (e) {
      if ('string' == typeof e) return n(e, t)
      var r = Object.prototype.toString.call(e).slice(8, -1)
      return 'Map' ===
        (r = 'Object' === r && e.constructor ? e.constructor.name : r) ||
        'Set' === r
        ? Array.from(e)
        : 'Arguments' === r ||
          /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
        ? n(e, t)
        : void 0
    }
  }
  function m(e, t) {
    return (
      (function (e) {
        if (Array.isArray(e)) return e
      })(e) ||
      (function (e, t) {
        var r =
          null == e
            ? null
            : ('undefined' != typeof Symbol && e[Symbol.iterator]) ||
              e['@@iterator']
        if (null != r) {
          var n,
            i,
            o = [],
            s = !0,
            a = !1
          try {
            for (
              r = r.call(e);
              !(s = (n = r.next()).done) &&
              (o.push(n.value), !t || o.length !== t);
              s = !0
            );
          } catch (e) {
            ;(a = !0), (i = e)
          } finally {
            try {
              s || null == r.return || r.return()
            } finally {
              if (a) throw i
            }
          }
          return o
        }
      })(e, t) ||
      o(e, t) ||
      (function () {
        throw new TypeError(
          'Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
        )
      })()
    )
  }
  var s = function () {
      return (s =
        Object.assign ||
        function (e) {
          for (var t, r = 1, n = arguments.length; r < n; r++)
            for (var i in (t = arguments[r]))
              Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i])
          return e
        }).apply(this, arguments)
    },
    a = {
      lines: 12,
      length: 7,
      width: 5,
      radius: 10,
      scale: 1,
      corners: 1,
      color: '#000',
      fadeColor: 'transparent',
      animation: 'spinner-line-fade-default',
      rotate: 0,
      direction: 1,
      speed: 1,
      zIndex: 2e9,
      className: 'spinner',
      top: '50%',
      left: '50%',
      shadow: '0 0 1px transparent',
      position: 'absolute'
    },
    l =
      ((c.prototype.spin = function (e) {
        return (
          this.stop(),
          (this.el = document.createElement('div')),
          (this.el.className = this.opts.className),
          this.el.setAttribute('role', 'progressbar'),
          u(this.el, {
            position: this.opts.position,
            width: 0,
            zIndex: this.opts.zIndex,
            left: this.opts.left,
            top: this.opts.top,
            transform: 'scale(' + this.opts.scale + ')'
          }),
          e && e.insertBefore(this.el, e.firstChild || null),
          (function (e, t) {
            var r = Math.round(t.corners * t.width * 500) / 1e3 + 'px',
              n = 'none'
            !0 === t.shadow
              ? (n = '0 2px 4px #000')
              : 'string' == typeof t.shadow && (n = t.shadow)
            for (
              var i = (function (e) {
                  for (
                    var t =
                        /^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,
                      r = [],
                      n = 0,
                      i = e.split(',');
                    n < i.length;
                    n++
                  ) {
                    var o,
                      s,
                      a,
                      l,
                      c = i[n].match(t)
                    null !== c &&
                      ((o = +c[2]),
                      (s = +c[5]),
                      (a = c[4]),
                      (l = c[7]),
                      (a = 0 == o && !a ? l : a) ===
                        (l = 0 == s && !l ? a : l) &&
                        r.push({
                          prefix: c[1] || '',
                          x: o,
                          y: s,
                          xUnits: a,
                          yUnits: l,
                          end: c[8]
                        }))
                  }
                  return r
                })(n),
                o = 0;
              o < t.lines;
              o++
            ) {
              var s = ~~((360 / t.lines) * o + t.rotate),
                a = u(document.createElement('div'), {
                  position: 'absolute',
                  top: -t.width / 2 + 'px',
                  width: t.length + t.width + 'px',
                  height: t.width + 'px',
                  background: h(t.fadeColor, o),
                  borderRadius: r,
                  transformOrigin: 'left',
                  transform:
                    'rotate(' + s + 'deg) translateX(' + t.radius + 'px)'
                }),
                l = (o * t.direction) / t.lines / t.speed
              l -= 1 / t.speed
              l = u(document.createElement('div'), {
                width: '100%',
                height: '100%',
                background: h(t.color, o),
                borderRadius: r,
                boxShadow: (function (e, t) {
                  for (var r = [], n = 0, i = e; n < i.length; n++) {
                    var o = i[n],
                      s = (function (e, t, r) {
                        var n = (r * Math.PI) / 180,
                          r = Math.sin(n),
                          n = Math.cos(n)
                        return [
                          Math.round(1e3 * (e * n + t * r)) / 1e3,
                          Math.round(1e3 * (-e * r + t * n)) / 1e3
                        ]
                      })(o.x, o.y, t)
                    r.push(
                      o.prefix + s[0] + o.xUnits + ' ' + s[1] + o.yUnits + o.end
                    )
                  }
                  return r.join(', ')
                })(i, s),
                animation:
                  1 / t.speed + 's linear ' + l + 's infinite ' + t.animation
              })
              a.appendChild(l), e.appendChild(a)
            }
          })(this.el, this.opts),
          this
        )
      }),
      (c.prototype.stop = function () {
        return (
          this.el &&
            (('undefined' != typeof requestAnimationFrame
              ? cancelAnimationFrame
              : clearTimeout)(this.animateId),
            this.el.parentNode && this.el.parentNode.removeChild(this.el),
            (this.el = void 0)),
          this
        )
      }),
      c)
  function c(e) {
    void 0 === e && (e = {}), (this.opts = s(s({}, a), e))
  }
  function u(e, t) {
    for (var r in t) e.style[r] = t[r]
    return e
  }
  function h(e, t) {
    return 'string' == typeof e ? e : e[t % e.length]
  }
  function G(e, t) {
    if (!(e instanceof t))
      throw new TypeError('Cannot call a class as a function')
  }
  function f(e, t) {
    for (var r = 0; r < t.length; r++) {
      var n = t[r]
      ;(n.enumerable = n.enumerable || !1),
        (n.configurable = !0),
        'value' in n && (n.writable = !0),
        Object.defineProperty(e, n.key, n)
    }
  }
  function p(e, t, r) {
    return (
      t && f(e.prototype, t),
      r && f(e, r),
      Object.defineProperty(e, 'prototype', { writable: !1 }),
      e
    )
  }
  var d = (function () {
    function r() {
      G(this, r),
        (this.startTime = 0),
        (this.oldTime = 0),
        (this.elapsedTime = 0),
        (this.running = !1)
    }
    return (
      p(r, [
        {
          key: 'start',
          value: function () {
            ;(this.startTime = r.now()),
              (this.oldTime = this.startTime),
              (this.running = !0)
          }
        },
        {
          key: 'stop',
          value: function () {
            this.getElapsedTime(), (this.running = !1)
          }
        },
        {
          key: 'getElapsedTime',
          value: function () {
            return this.update(), this.elapsedTime
          }
        },
        {
          key: 'update',
          value: function () {
            var e,
              t = 0
            return (
              this.running &&
                ((t = 0.001 * ((e = r.now()) - this.oldTime)),
                (this.oldTime = e),
                (this.elapsedTime += t)),
              t
            )
          }
        }
      ]),
      r
    )
  })()
  d.now =
    (Hs = 'undefined' != typeof window && window.performance) && Hs.now
      ? Hs.now.bind(Hs)
      : Date.now
  var y = d.now
  function _(e, t, r) {
    e = document.createElement(e)
    return (e.id = t), (e.style.cssText = r), e
  }
  var v = (function () {
    function e() {
      G(this, e),
        (this.domElement = _('div', 'stats', 'padding:8px')),
        (this._text = _('p', 'fps', 'margin:0;color:silver;font-size:large')),
        this.domElement.appendChild(this._text),
        (this._startTime = y()),
        (this._prevTime = this._startTime),
        (this._deltas = new Array(20)),
        (this._index = 0),
        (this._total = 0),
        (this._count = 0)
    }
    return (
      p(e, [
        {
          key: 'end',
          value: function () {
            var e = y(),
              t = e - this._startTime
            return (
              this._count < this._deltas.length
                ? this._count++
                : (this._total -= this._deltas[this._index]),
              (this._total += t),
              (this._deltas[this._index] = t),
              (this._index = (this._index + 1) % this._deltas.length),
              (this.ms = this._total / this._count),
              (this.fps = 1e3 / this.ms),
              e > this._prevTime + 1e3 &&
                ((this._text.textContent = this.fps.toPrecision(2)),
                (this._prevTime = e)),
              e
            )
          }
        },
        {
          key: 'update',
          value: function () {
            this._startTime = this.end()
          }
        },
        {
          key: 'show',
          value: function (e) {
            this.domElement.style.display = (e = void 0 === e ? !0 : e)
              ? 'block'
              : 'none'
          }
        }
      ]),
      e
    )
  })()
  function g(e, t) {
    return (g =
      Object.setPrototypeOf ||
      function (e, t) {
        return (e.__proto__ = t), e
      })(e, t)
  }
  function x(e, t) {
    if ('function' != typeof t && null !== t)
      throw new TypeError('Super expression must either be null or a function')
    Object.defineProperty(e, 'prototype', {
      value: Object.create(t && t.prototype, {
        constructor: { value: e, writable: !0, configurable: !0 }
      }),
      writable: !1
    }),
      t && g(e, t)
  }
  function w(e) {
    return (w =
      'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator
        ? function (e) {
            return typeof e
          }
        : function (e) {
            return e &&
              'function' == typeof Symbol &&
              e.constructor === Symbol &&
              e !== Symbol.prototype
              ? 'symbol'
              : typeof e
          })(e)
  }
  function S(e) {
    if (void 0 === e)
      throw new ReferenceError(
        "this hasn't been initialised - super() hasn't been called"
      )
    return e
  }
  function R(e, t) {
    if (t && ('object' === w(t) || 'function' == typeof t)) return t
    if (void 0 !== t)
      throw new TypeError(
        'Derived constructors may only return object or undefined'
      )
    return S(e)
  }
  function C(e) {
    return (C = Object.setPrototypeOf
      ? Object.getPrototypeOf
      : function (e) {
          return e.__proto__ || Object.getPrototypeOf(e)
        })(e)
  }
  function A(e, t, r) {
    return (A = (function () {
      if (
        'undefined' != typeof Reflect &&
        Reflect.construct &&
        !Reflect.construct.sham
      ) {
        if ('function' == typeof Proxy) return 1
        try {
          return (
            Boolean.prototype.valueOf.call(
              Reflect.construct(Boolean, [], function () {})
            ),
            1
          )
        } catch (e) {
          return
        }
      }
    })()
      ? Reflect.construct
      : function (e, t, r) {
          var n = [null]
          n.push.apply(n, t)
          n = new (Function.bind.apply(e, n))()
          return r && g(n, r.prototype), n
        }).apply(null, arguments)
  }
  function E(e) {
    var r = 'function' == typeof Map ? new Map() : void 0
    return (E = function (e) {
      if (
        null === e ||
        -1 === Function.toString.call(e).indexOf('[native code]')
      )
        return e
      if ('function' != typeof e)
        throw new TypeError(
          'Super expression must either be null or a function'
        )
      if (void 0 !== r) {
        if (r.has(e)) return r.get(e)
        r.set(e, t)
      }
      function t() {
        return A(e, arguments, C(this).constructor)
      }
      return (
        (t.prototype = Object.create(e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        })),
        g(t, e)
      )
    })(e)
  }
  function k(e, t) {
    return !e || e === t
  }
  function T() {
    this._handlers = {}
  }
  ;(T.prototype.addEventListener = function (e, t, r) {
    var n = this._handlers[e]
    n || ((this._handlers[e] = []), (n = this._handlers[e]))
    var i = [t, r]
    void 0 ===
      b.default.find(n, function (e) {
        return e[0] === i[0] && e[1] === i[1]
      }) && n.push(i)
  }),
    (T.prototype.removeEventListener = function (r, n, i) {
      var o = this
      b.default.forEach(o._handlers, function (e, t) {
        b.default.remove(e, function (e) {
          return k(r, t) && k(n, e[0]) && k(i, e[1] || o)
        })
      }),
        (this._handlers = b.default.omitBy(o._handlers, function (e) {
          return 0 === e.length
        }))
    }),
    (T.prototype.dispatchEvent = function (r) {
      var n = this
      b.default.forEach(this._handlers[r.type], function (e) {
        var t = e[1] || n
        e[0].apply(t, [r])
      })
    })
  var P = { debug: 0, info: 1, report: 2, warn: 3, error: 4 }
  function M() {
    T.call(this), (this.console = !1), (this._priority = P.warn)
  }
  function N(e) {
    if (!b.default.isNumber(e)) throw new Error('Wrong log level specified!')
    return e
  }
  ;(((M.prototype = Object.create(T.prototype)).constructor =
    M).prototype.instantiate = function () {
    return new M()
  }),
    Object.defineProperty(M.prototype, 'level', {
      get: function () {
        var t = this
        return b.default.findKey(P, function (e) {
          return e === t._priority
        })
      },
      set: function (e) {
        this._priority = N(P[e])
      }
    }),
    (M.prototype.levels = function () {
      return Object.keys(P)
    }),
    (M.prototype.message = function (e, t) {
      e = N(P[e])
      this._message(e, t)
    }),
    (M.prototype.debug = function (e) {
      this._message(P.debug, e)
    }),
    (M.prototype.info = function (e) {
      this._message(P.info, e)
    }),
    (M.prototype.report = function (e) {
      this._message(P.report, e)
    }),
    (M.prototype.warn = function (e) {
      this._message(P.warn, e)
    }),
    (M.prototype.error = function (e) {
      this._message(P.error, e)
    }),
    (M.prototype._message = function (t, e) {
      var r
      t < this._priority ||
        ((r = b.default.findKey(P, function (e) {
          return e === t
        })),
        (e = String(e)),
        this.console && 'miew:'.concat(r, ': ').concat(e),
        this.dispatchEvent({ type: 'message', level: r, message: e }))
    })
  var L = new M()
  function I(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var O = { DEFAULT: 0, SAFARI: 1 }
  function B(e) {
    return decodeURIComponent(e.replace(/\+/g, ' '))
  }
  function V(e) {
    for (
      var t,
        r = (e = e || window.location.search).substring(e.indexOf('?') + 1),
        n = /([^&=]+)=?([^&]*)/g,
        i = [];
      null !== (t = n.exec(r));

    )
      i.push([B(t[1]), B(t[2])])
    return i
  }
  function D(e) {
    var a = !1
    this.enable = function (e) {
      a = e
    }
    var l = 0,
      t = Object.keys(e)
    for (var r = 0, n = t.length; r < n; ++r) {
      var i = t[r],
        o = e[i]
      o instanceof Function &&
        'constructor' !== i &&
        (e[i] = (function (o, s) {
          return function () {
            var e = D.spaces.substr(0, 2 * l)
            a && L.debug(''.concat(e + s, ' {')), l++
            for (var t = arguments.length, r = new Array(t), n = 0; n < t; n++)
              r[n] = arguments[n]
            var i = o.apply(this, r)
            return l--, a && L.debug(''.concat(e, '} // ').concat(s)), i
          }
        })(o, i))
    }
  }
  D.spaces =
    '                                                                                          '
  var z = (function () {
    x(n, E(Error))
    var r = I(n)
    function n(e) {
      var t
      return (
        G(this, n),
        ((t = r.call(this)).name = 'OutOfMemoryError'),
        (t.message = e),
        t
      )
    }
    return p(n)
  })()
  function F(e) {
    for (var t = new Uint8Array(e), r = '', n = 0; n < t.byteLength; n++)
      r += String.fromCharCode(t[n])
    return window.btoa(r)
  }
  function U(e) {
    for (
      var t = window.atob(e), r = new Uint8Array(t.length), n = 0;
      n < r.length;
      ++n
    )
      r[n] = t[n].charCodeAt(0)
    return r.buffer
  }
  function j(e) {
    if (b.default.isPlainObject(e)) return !0
    e = e && Object.getPrototypeOf(e)
    return !!e && !e.hasOwnProperty('constructor') && j(e)
  }
  function H(e) {
    return e.slice(Math.max(0, e.lastIndexOf('.')) || 1 / 0)
  }
  function W(e) {
    var t = e.split(/[:;,]/),
      e = t.length
    return 3 <= e && 'base64' === t[e - 2] ? new Blob([U(t[e - 1])]) : null
  }
  var Y = /^[a-zA-Z0-9_]*$/,
    X = ['"', '', '"']
  var le = {
    browserType: O,
    encodeQueryComponent: function (e, t) {
      return encodeURIComponent(e)
        .replace(t, function (e) {
          return String.fromCharCode(parseInt(e.substr(1), 16))
        })
        .replace(/%20/g, '+')
    },
    decodeQueryComponent: B,
    getUrlParameters: V,
    getUrlParametersAsDict: function (e) {
      for (var t = {}, r = V(e), n = 0; n < r.length; ++n) {
        var i = m(r[n], 2),
          o = i[0],
          i = i[1]
        t[o] = i
      }
      return t
    },
    resolveURL: function (e) {
      if ('undefined' != typeof URL)
        try {
          return 'undefined' != typeof window
            ? new URL(e, window.location).href
            : new URL(e).href
        } catch (e) {}
      if ('undefined' == typeof document) return e
      var t = document.createElement('a')
      return (t.href = e), t.href
    },
    generateRegExp: function (e) {
      for (var t = [], r = 0, n = e.length; r < n; ++r)
        t[t.length] = e[r].charCodeAt(0).toString(16)
      var i = t.join('|')
      return new RegExp('%(?:'.concat(i, ')'), 'gi')
    },
    createElement: function (e, t, r) {
      var n = document.createElement(e)
      if (t)
        for (var i = Object.keys(t), o = 0, s = i.length; o < s; ++o) {
          var a = i[o]
          n.setAttribute(a, t[a])
        }
      if (r)
        for (
          o = 0, s = (r = !(r instanceof Array) ? [r] : r).length;
          o < s;
          ++o
        ) {
          var l = r[o]
          'string' == typeof l
            ? n.appendChild(document.createTextNode(l))
            : l instanceof HTMLElement && n.appendChild(l)
        }
      return n
    },
    deriveClass: function (e, t, r, n) {
      return (
        (e.prototype = b.default.assign(
          Object.create(t.prototype),
          { constructor: e },
          r
        )),
        n && b.default.assign(e, n),
        e
      )
    },
    deriveDeep: function e(t, r) {
      var n = t
      if (t instanceof Array)
        for (n = new Array(t.length), o = 0, s = t.length; o < s; ++o)
          n[o] = e(t[o])
      else if (t instanceof Object) {
        for (
          var n = Object.create(t), i = Object.keys(t), o = 0, s = i.length;
          o < s;
          ++o
        ) {
          var a = i[o],
            l = t[a],
            c = e(l)
          c !== l && (n[a] = c)
        }
        r && 0 < Object.keys(n).length && (n = Object.create(n))
      }
      return n
    },
    hexColor: function (e) {
      return (e = '0000000'.concat(e.toString(16)).substr(-6)), '#'.concat(e)
    },
    DebugTracer: D,
    OutOfMemoryError: z,
    allocateTyped: function (e, t) {
      var r = null
      try {
        r = new e(t)
      } catch (e) {
        throw e instanceof RangeError ? new z(e.message) : e
      }
      return r
    },
    bytesFromBase64: U,
    bytesToBase64: F,
    arrayFromBase64: function (e, t) {
      return Array.prototype.slice.call(new t(U(e)))
    },
    arrayToBase64: function (e, t) {
      return F(new t(e).buffer)
    },
    compareOptionsWithDefaults: function (e, t) {
      var r = []
      if (t && e) {
        for (var n = Object.keys(e), i = 0; i < n.length; ++i) {
          var o = n[i],
            s = e[o]
          s instanceof Object ||
            void 0 === t[o] ||
            t[o] === s ||
            r.push(''.concat(o, ':').concat(s))
        }
        if (0 < r.length) return '!'.concat(r.join())
      }
      return ''
    },
    objectsDiff: function i(e, o) {
      var s = {}
      return (
        b.default.forIn(e, function (e, t) {
          var r,
            n = o[t]
          j(e) && j(n)
            ? ((r = i(e, n)), b.default.isEmpty(r) || (s[t] = r))
            : b.default.isEqual(e, n) || (s[t] = e)
        }),
        s
      )
    },
    forInRecursive: function (e, o) {
      !(function n(e, i) {
        b.default.forIn(e, function (e, t) {
          var r = i + (0 < i.length ? '.' : '')
          e instanceof Object ? n(e, r + t) : void 0 !== e && o(e, r + t)
        })
      })(e, '')
    },
    enquoteString: function (e) {
      return b.default.isString(e) ? '"'.concat(e.replace(/"/g, '\\"'), '"') : e
    },
    unquoteString: function (e) {
      if (!b.default.isString(e)) return e
      if ('"' === e[0] && '"' === e[e.length - 1])
        return (e = e.slice(1, e.length - 1)).replace(/\\"/g, '"')
      if ("'" === e[0] && "'" === e[e.length - 1])
        return (e = e.slice(1, e.length - 1)).replace(/\\'/g, "'")
      throw new SyntaxError("Incorrect string format, can't unqute it")
    },
    getBrowser: function () {
      return navigator.vendor &&
        -1 < navigator.vendor.indexOf('Apple') &&
        navigator.userAgent &&
        -1 === navigator.userAgent.indexOf('CriOS') &&
        -1 === navigator.userAgent.indexOf('FxiOS')
        ? O.SAFARI
        : O.DEFAULT
    },
    shotOpen: function (e) {
      'undefined' != typeof window &&
        window
          .open()
          .document.write(
            '<body style="margin:0"><img src="'.concat(e, '" /></body>')
          )
    },
    shotDownload: function (e, t) {
      var r
      e &&
        'data:' === e.substr(0, 5) &&
        ((t = t || ['screenshot-', +new Date(), '.png'].join('')),
        'undefined' != typeof window &&
        window.navigator &&
        window.navigator.msSaveBlob
          ? window.navigator.msSaveBlob(W(e), t)
          : 'undefined' != typeof document &&
            (((r = document.createElement('a')).download = t),
            (r.innerHTML = 'download'),
            (r.href = window.URL.createObjectURL(W(e))),
            document.body.appendChild(r),
            r.click(),
            document.body.removeChild(r)))
    },
    copySubArrays: function (e, t, r, n) {
      for (var i = 0, o = r.length; i < o; ++i)
        for (var s = 0; s < n; ++s) t[i * n + s] = e[r[i] * n + s]
    },
    shallowCloneNode: function (e) {
      var t = e.cloneNode(!0)
      return (t.worldPos = e.worldPos), t
    },
    correctSelectorIdentifier: function (e) {
      return Y.test(e) ? e : ((X[1] = e), X.join(''))
    },
    getFileExtension: H,
    splitFileName: function (e) {
      var t = H(e)
      return [e.slice(0, e.length - t.length), t]
    },
    download: function (e, t, r) {
      ;(e = new Blob([e])),
        (t = t || ['data', +new Date()].join('')),
        (t += r ? '.'.concat(r) : e.type || '.bin'),
        'undefined' != typeof window &&
        window.navigator &&
        window.navigator.msSaveBlob
          ? window.navigator.msSaveBlob(e, t)
          : 'undefined' != typeof document &&
            (((r = document.createElement('a')).download = t),
            (r.innerHTML = 'download'),
            (r.href = window.URL.createObjectURL(e)),
            document.body.appendChild(r),
            r.click(),
            document.body.removeChild(r))
    },
    concatTypedArraysUnsafe: function (e, t) {
      var r = new e.constructor(e.length + t.length)
      return r.set(e), r.set(t, e.length), r
    },
    mergeTypedArraysUnsafe: function (e) {
      if (e.length <= 0) return null
      for (
        var t = e.reduce(function (e, t) {
            return e + t.length
          }, 0),
          r = new e[0].constructor(t),
          n = 0,
          i = 0;
        n < e.length;
        n++
      ) {
        var o = e[n].length
        r.set(e[n], i), (i += o)
      }
      return r
    }
  }
  function q(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var $ = (function () {
      x(r, T)
      var t = q(r)
      function r() {
        var e
        return G(this, r), ((e = t.call(this))._shouldCancel = !1), e
      }
      return (
        p(r, [
          {
            key: 'cancel',
            value: function () {
              ;(this._shouldCancel = !0), this.dispatchEvent({ type: 'cancel' })
            }
          },
          {
            key: 'shouldCancel',
            value: function () {
              return this._shouldCancel
            }
          },
          {
            key: 'notify',
            value: function (e) {
              this.dispatchEvent({ type: 'notification', slaveEvent: e })
            }
          }
        ]),
        r
      )
    })(),
    Z = {
      modes: {
        BS: {
          atom: 0.23,
          bond: 0.15,
          space: 0.5,
          multibond: !0,
          aromrad: 0.1,
          showarom: !0,
          polyComplexity: { poor: 3, low: 4, medium: 6, high: 12, ultra: 32 }
        },
        VW: {
          polyComplexity: { poor: 4, low: 6, medium: 8, high: 16, ultra: 32 }
        },
        LN: {
          multibond: !0,
          showarom: !0,
          offsarom: 0.2,
          chunkarom: 10,
          atom: 0.23,
          lineWidth: 2
        },
        LC: {
          bond: 0.2,
          space: 0,
          multibond: !0,
          aromrad: 0.1,
          showarom: !0,
          polyComplexity: { poor: 3, low: 4, medium: 6, high: 12, ultra: 32 }
        },
        SA: {
          zClip: !1,
          probeRadius: 1.5,
          subset: '',
          wireframe: !1,
          polyComplexity: { poor: 6, low: 8, medium: 16, high: 30, ultra: 60 }
        },
        SE: {
          zClip: !1,
          probeRadius: 1.5,
          subset: '',
          wireframe: !1,
          polyComplexity: { poor: 6, low: 8, medium: 16, high: 30, ultra: 60 }
        },
        QS: {
          isoValue: 0.5,
          gaussLim: { poor: 1.5, low: 2, medium: 2.5, high: 3, ultra: 4 },
          scale: 1,
          wireframe: !1,
          gridSpacing: { poor: 2, low: 1.5, medium: 1, high: 0.5, ultra: 0.25 },
          subset: '',
          zClip: !1
        },
        CS: {
          probeRadius: 1.4,
          isoValue: 1.5,
          wireframe: !1,
          probePositions: 30,
          polyComplexity: {
            poor: 0.5,
            low: 1,
            medium: 1.5,
            high: 1.75,
            ultra: 2
          },
          subset: '',
          zClip: !1
        },
        TR: {
          radius: 0.3,
          polyComplexity: { poor: 12, low: 16, medium: 32, high: 64, ultra: 64 }
        },
        TU: {
          radius: 0.3,
          heightSegmentsRatio: 1.5,
          tension: -0.7,
          polyComplexity: { poor: 4, low: 6, medium: 10, high: 18, ultra: 34 }
        },
        CA: {
          radius: 0.3,
          depth: 0.25,
          ss: { helix: { width: 1, arrow: 2 }, strand: { width: 1, arrow: 2 } },
          heightSegmentsRatio: 1.5,
          tension: -0.7,
          polyComplexity: { poor: 4, low: 6, medium: 10, high: 18, ultra: 34 }
        },
        TX: {
          template: '{{Chain}}.{{Residue}}{{Sequence}}.{{Name}}',
          horizontalAlign: 'center',
          verticalAlign: 'middle',
          dx: 0,
          dy: 0,
          dz: 1,
          fg: 'none',
          bg: '0x202020',
          showBg: !0
        },
        VD: {
          kSigma: 1,
          kSigmaMed: 2,
          kSigmaMax: 4,
          frame: !0,
          isoMode: !1,
          polyComplexity: { poor: 2, low: 3, medium: 4, high: 8, ultra: 10 }
        }
      },
      colorers: {
        EL: { carbon: -1 },
        UN: { color: 16777215 },
        CO: { subset: 'charged', color: 16711680, baseColor: 16777215 },
        CB: { color: 9474192, factor: 0.6 },
        SQ: { gradient: 'rainbow' },
        TM: { gradient: 'temp', min: 5, max: 40 },
        OC: { gradient: 'reds' },
        HY: { gradient: 'blue-red' },
        MO: { gradient: 'rainbow' }
      },
      antialias: !0,
      camFov: 45,
      camNear: 0.5,
      camFar: 100,
      camDistance: 2.5,
      radiusToFit: 1,
      fogNearFactor: 0.5,
      fogFarFactor: 1,
      fogAlpha: 1,
      fogColor: 0,
      fogColorEnable: !1,
      palette: 'JM',
      resolution: 'medium',
      autoResolution: !1,
      autoPreset: !0,
      preset: 'default',
      presets: {
        default: [
          { mode: 'BS', colorer: 'EL', selector: 'all', material: 'SF' }
        ],
        empty: [],
        wire: [{ mode: 'LN', colorer: 'EL', selector: 'all', material: 'SF' }],
        small: [{ mode: 'BS', colorer: 'EL', selector: 'all', material: 'SF' }],
        macro: [
          { mode: 'CA', colorer: 'SS', selector: 'not hetatm', material: 'SF' },
          {
            mode: 'BS',
            colorer: 'EL',
            selector: 'hetatm and not water',
            material: 'SF'
          }
        ]
      },
      objects: { line: { color: 4294967295, dashSize: 0.3, gapSize: 0.05 } },
      bg: { color: 2105376, transparent: !1 },
      draft: { clipPlane: !1, clipPlaneFactor: 0.5, clipPlaneSpeed: 3e-5 },
      plugins: {},
      axes: !0,
      fog: !0,
      fps: !0,
      zSprites: !0,
      isoSurfaceFakeOpacity: !0,
      suspendRender: !0,
      nowater: !1,
      autobuild: !0,
      fxaa: !0,
      outline: { on: !1, color: 0, threshold: 0.1, thickness: 1 },
      ao: !1,
      shadow: { on: !1, type: 'random', radius: 1 },
      autoRotation: 0,
      maxfps: 30,
      fbxprec: 4,
      autoRotationAxisFixed: !0,
      zooming: !0,
      picking: !0,
      pick: 'atom',
      editing: !1,
      aromatic: !1,
      singleUnit: !0,
      stereo: 'NONE',
      interpolateViews: !0,
      transparency: 'prepass',
      translationSpeed: 2,
      debug: {
        example: 3.5,
        text: 'hello!',
        good: !0,
        ssaoKernelRadius: 0.7,
        ssaoFactor: 0.7,
        stereoBarrel: 0.25
      },
      use: { multiFile: !1 }
    }
  function K() {
    T.call(this),
      (this.old = null),
      (this.now = {}),
      (this._changed = {}),
      this.reset()
  }
  le.deriveClass(K, T, {
    defaults: Z,
    set: function (e, t) {
      b.default.isString(e)
        ? b.default.get(this.now, e) !== t &&
          (b.default.set(this.now, e, t), this._notifyChange(e, t))
        : ((e = le.objectsDiff(e, this.now)),
          b.default.isEmpty(e) ||
            (b.default.merge(this.now, e), this._notifyChanges(e)))
    },
    get: function (e, t) {
      return b.default.get(this.now, e, t)
    },
    reset: function () {
      var e = le.objectsDiff(Z, this.now)
      ;(this.now = b.default.cloneDeep(Z)),
        (this.old = null),
        this._notifyChanges(e),
        (this._changed = {})
    },
    checkpoint: function () {
      ;(this.old = b.default.cloneDeep(this.now)), (this._changed = {})
    },
    _notifyChange: function (e, t) {
      ;(this._changed[e] = !0),
        this.dispatchEvent({ type: 'change:'.concat(e), value: t })
    },
    _notifyChanges: function (e) {
      var r = this
      le.forInRecursive(e, function (e, t) {
        r._notifyChange(t, e)
      })
    },
    changed: function () {
      if (!this.old) return []
      var t = this.old,
        r = this.now
      return b.default.filter(Object.keys(this._changed), function (e) {
        return b.default.get(t, e) !== b.default.get(r, e)
      })
    },
    applyDiffs: function (e) {
      if (e.hasOwnProperty('VERSION') && 0 !== e.VERSION)
        throw new Error('Settings version does not match!')
      delete e.VERSION, this.reset(), this.set(e)
    },
    getDiffs: function (e) {
      var t = le.objectsDiff(this.now, Z)
      return e && (t.VERSION = 0), t
    },
    setPluginOpts: function (e, t) {
      ;(Z.plugins[e] = b.default.cloneDeep(t)),
        (this.now.plugins[e] = b.default.cloneDeep(t))
    }
  })
  var Q = new K(),
    J = 0
  function ee(e) {
    return !(
      !e ||
      '0' === e ||
      (b.default.isString(e) && 'false' === e.toLowerCase())
    )
  }
  var te = { string: String, number: Number, boolean: ee },
    re = '!',
    ne = ':',
    ie = ','
  var oe = le.generateRegExp('$;@/?:,')
  function se(e) {
    return le.encodeQueryComponent(e, oe)
  }
  var ce = le.generateRegExp('$;@/? ')
  function ue(e) {
    return le.encodeQueryComponent(e, ce)
  }
  function he(e) {
    var t,
      r,
      n = e.reps
    n ||
      ((n = (t = Q.now.presets)[(r = e.preset || Q.now.preset)]) ||
        (L.warn('Unknown preset "'.concat(r, '"')),
        (n = t[(r = m(Object.keys(t), 1)[0])])),
      (e.preset = r),
      (e.reps = le.deriveDeep(n, !0)))
  }
  function fe(e, t, r) {
    he(e)
    var n = e.reps[J]
    n.hasOwnProperty(t) &&
      ((J = e.reps.length), (e.reps[J] = le.deriveDeep(n, !0))),
      void 0 !== r && (e.reps[J][t] = r)
  }
  function de(n, e, t) {
    var r, i, o, s, a
    return (
      n &&
        ((r = n.indexOf(re)),
        (s = n.substr(0, 0 <= r ? r : void 0)),
        (a = t),
        (s =
          0 <= (t = s.indexOf(','))
            ? (a.push(s.substr(t + 1).split(',')), s.substr(0, t))
            : s),
        0 <= r
          ? ((r = n.substr(r + 1).split(ie)),
            (n = s),
            e &&
              ((i = e[n]),
              (o = le.deriveDeep(i, !0)),
              r.forEach(function (e) {
                var t = e.split(ne, 2),
                  r = decodeURIComponent(t[0]),
                  e = decodeURIComponent(t[1]),
                  t = te[w(b.default.get(i, r))]
                t
                  ? b.default.set(o, r, t(e))
                  : L.warn(
                      'Unknown argument "'
                        .concat(r, '" for option "')
                        .concat(n, '"')
                    )
              }),
              0 < Object.keys(o).length && (n = [n, o])))
          : (n = s)),
      n
    )
  }
  var pe = {
    l: 'load',
    load: String,
    t: 'type',
    type: String,
    v: 'view',
    view: String,
    u: 'unit',
    unit: Number,
    menu: ee,
    o: 'object',
    object: function (e, t) {
      var r = [],
        e = de(e, Q.defaults.objects, r)
      Array.isArray(e) || (e = [e]),
        (function (e, t, r) {
          void 0 === e._objects && (e._objects = [])
          var r = (n = m(r, 2))[0],
            n = n[1],
            t = { type: r, params: t }
          void 0 !== n && (t.opts = n), (e._objects[e._objects.length] = t)
        })(t, r[0], e)
    },
    p: 'preset',
    preset: function (e, t) {
      ;(t.preset = e), (t.reps = null), he(t)
    },
    r: 'rep',
    rep: function (e, t) {
      he(t),
        (J =
          (J = Number(e)) <= t.reps.length
            ? J < 0
              ? 0
              : J
            : t.reps.length) === t.reps.length &&
          (t.reps[J] =
            0 < J
              ? le.deriveDeep(t.reps[J - 1], !0)
              : le.deriveDeep(Q.defaults.presets.default[0], !0))
    },
    s: 'select',
    select: function (e, t) {
      fe(t, 'selector', e)
    },
    m: 'mode',
    mode: function (e, t) {
      fe(t, 'mode', de(e, Q.defaults.modes))
    },
    c: 'color',
    color: function (e, t) {
      fe(t, 'colorer', de(e, Q.defaults.colorers))
    },
    mt: 'material',
    material: function (e, t) {
      fe(t, 'material', de(e, Q.defaults.materials))
    },
    dup: function (e, t) {
      he(t)
      var r = t.reps,
        t = r[J]
      r[(J = r.length)] = le.deriveDeep(t, !0)
    },
    ar: 'autoResolution'
  }
  function me(e) {
    for (var t = {}, r = (J = 0), n = e.length; r < n; ++r) {
      var i = e[r],
        o = i[0],
        i = i[1]
      if (pe.hasOwnProperty(o) || te[w(b.default.get(Q.defaults, o))]) {
        for (var s, a = pe[o]; b.default.isString(a); ) a = pe[(o = a)]
        a
          ? 'function' != typeof a || (void 0 !== (s = a(i, t)) && (t[o] = s))
          : (s = te[w(b.default.get(Q.defaults, o))])
          ? b.default.set(t, 'settings.'.concat(o), s(i))
          : L.warn('Unknown option "'.concat(o, '"'))
      }
    }
    return t
  }
  function ye(e) {
    var r = [],
      n = 0
    return (
      le.forInRecursive(e, function (e, t) {
        r[n++] = ue(t) + ne + ue(e)
      }),
      r.join(ie)
    )
  }
  function _e(e) {
    return b.default.isArray(e)
      ? e.length < 2
        ? e[0]
        : ''.concat(e[0]).concat(re).concat(ye(e[1]))
      : e
  }
  function ve(e) {
    var r = [],
      n = 0
    return (
      le.forInRecursive(e, function (e, t) {
        r[n++] = ''.concat(t, '=').concat(le.enquoteString(e))
      }),
      r.join(' ')
    )
  }
  function ge(e) {
    return b.default.isArray(e)
      ? e.length < 2
        ? e[0]
        : ''.concat(e[0], ' ').concat(ve(e[1]))
      : e
  }
  var xe = {
    fromURL: function (e) {
      return me(le.getUrlParameters(e))
    },
    fromAttr: function (e) {
      return me(le.getUrlParameters('?'.concat(e || '')))
    },
    adapters: te,
    toURL: function (e) {
      var r = [],
        n = 0
      function i(e, t) {
        null != t && (r[n++] = se(e) + '=' + se(t))
      }
      i('l', e.load),
        i('u', e.unit),
        i('p', e.preset),
        (function (e) {
          if (e)
            for (var t = 0, r = e.length; t < r; ++t)
              b.default.isEmpty(e[t]) ||
                (i('r', t),
                i('s', e[t].selector),
                i('m', _e(e[t].mode)),
                i('c', _e(e[t].colorer)),
                i('mt', _e(e[t].material)))
        })(e.reps),
        (function (e) {
          if (e)
            for (var t = 0, r = e.length; t < r; ++t)
              i(
                'o',
                (function (e) {
                  if (e && e.type) {
                    var t = e.type
                    return (
                      b.default.isArray(e.params) &&
                        0 < e.params.length &&
                        (t += ','.concat(e.params.join(','))),
                      e.opts && (t += re + ye(e.opts)),
                      t
                    )
                  }
                })(e[t])
              )
        })(e._objects),
        i('v', e.view),
        le.forInRecursive(e.settings, function (e, t) {
          'preset' !== t && i(t, e)
        })
      var t = ''
      return (
        'undefined' != typeof window &&
          (t = ''
            .concat((e = window.location).protocol, '//')
            .concat(e.host)
            .concat(e.pathname)),
        0 < r.length && (t += '?'.concat(r.join('&'))),
        t
      )
    },
    toScript: function (e) {
      var n = [],
        i = 0
      function o(e, t, r) {
        null != t &&
          ((r = 'string' == typeof t && r ? '"' : ''),
          (n[i++] = ''.concat(e, ' ').concat(r).concat(t).concat(r).trim()))
      }
      return (
        o('set', 'autobuild false'),
        o('load', e.load, !0),
        o('unit', e.unit),
        o('preset', e.preset),
        (function (e) {
          if (e)
            for (var t = 0, r = e.length; t < r; ++t)
              o(
                'rep',
                (function (e, t) {
                  var r = [],
                    n = 0
                  function i(e, t) {
                    null != t && (r[n++] = e + t)
                  }
                  return b.default.isEmpty(e)
                    ? null
                    : (i('', t),
                      i('s=', le.enquoteString(e.selector)),
                      i('m=', ge(e.mode)),
                      i('c=', ge(e.colorer)),
                      i('mt=', ge(e.material)),
                      r.join(' '))
                })(e[t], t)
              )
        })(e.reps),
        (function (e) {
          if (e)
            for (var t = 0, r = e.length; t < r; ++t)
              o(
                '',
                (function (e) {
                  if (e && e.type) {
                    var t = e.type
                    return (
                      b.default.isArray(e.params) &&
                        0 < e.params.length &&
                        (t += ' '.concat(
                          e.params.map(le.enquoteString).join(' ')
                        )),
                      e.opts && (t += ' '.concat(ve(e.opts))),
                      t
                    )
                  }
                })(e[t])
              )
        })(e._objects),
        le.forInRecursive(e.settings, function (e, t) {
          'preset' !== t && o('set '.concat(t), e, !0)
        }),
        o('view', e.view),
        o('set', 'autobuild true'),
        n.join('\n')
      )
    }
  }
  function be(e, t, r) {
    return (
      t in e
        ? Object.defineProperty(e, t, {
            value: r,
            enumerable: !0,
            configurable: !0,
            writable: !0
          })
        : (e[t] = r),
      e
    )
  }
  var we = (function () {
    function h(e, t, r, n, i, o, s, a, l, c, u) {
      G(this, h),
        (this.index = -1),
        (this.residue = e),
        (this.name = t),
        (this.element = r),
        (this.position = n),
        (this.role = i),
        (this.mask = 1),
        (this.het = o),
        (this.serial = s),
        (this.location = (a || ' ').charCodeAt(0)),
        (this.occupancy = l || 1),
        (this.temperature = c),
        (this.charge = u),
        (this.hydrogenCount = -1),
        (this.radicalCount = 0),
        (this.valence = -1),
        (this.bonds = []),
        (this.flags = 0),
        'H' === r.name
          ? (this.flags |= h.Flags.HYDROGEN)
          : 'C' === r.name && (this.flags |= h.Flags.CARBON)
    }
    return (
      p(h, [
        {
          key: 'isHet',
          value: function () {
            return this.het
          }
        },
        {
          key: 'isHydrogen',
          value: function () {
            return 1 === this.element.number
          }
        },
        {
          key: 'getVisualName',
          value: function () {
            var e = this.name
            return 0 < e.length ? e : this.element.name.trim()
          }
        },
        {
          key: 'forEachBond',
          value: function (e) {
            for (var t = this.bonds, r = 0, n = t.length; r < n; ++r) e(t[r])
          }
        },
        {
          key: 'getFullName',
          value: function () {
            var e = ''
            return (
              null !== this.residue &&
                (null !== this.residue._chain &&
                  (e += ''.concat(this.residue._chain.getName(), '.')),
                (e += ''.concat(this.residue._sequence, '.'))),
              (e += this.name)
            )
          }
        }
      ]),
      h
    )
  })()
  be(we, 'Flags', { CARBON: 1, HYDROGEN: 8, NONPOLARH: 4104 })
  var Se = p(function e(t, r, n, i, o, s, a) {
    G(this, e),
      (this.number = t),
      (this.name = r),
      (this.fullName = n),
      (this.weight = i),
      (this.radius = o),
      (this.radiusBonding = s),
      (this.hydrogenValency = a)
  })
  be(Se, 'Constants', { U1: 1, Lead: 2, U2: 3, Wing: 4, U18: 18 }),
    be(Se, 'Role', {
      N: Se.Constants.U1,
      CA: Se.Constants.Lead,
      C: Se.Constants.U2,
      O: Se.Constants.Wing,
      SG: Se.Constants.U18
    }),
    be(Se, 'ByAtomicNumber', [
      null,
      new Se(1, 'H', 'Hydrogen', 1.008, 1.2, 0.23, [1]),
      new Se(2, 'HE', 'Helium', 4.003, 1.4, 0.93, [0]),
      new Se(3, 'LI', 'Lithium', 6.941, 1.82, 0.68, [1]),
      new Se(4, 'BE', 'Beryllium', 9.012, 1.7, 0.35, [2]),
      new Se(5, 'B', 'Boron', 10.81, 2.08, 0.83, [3]),
      new Se(6, 'C', 'Carbon', 12.011, 1.95, 0.68, [4]),
      new Se(7, 'N', 'Nitrogen', 14.007, 1.85, 0.68, [3, 5]),
      new Se(8, 'O', 'Oxygen', 15.999, 1.7, 0.68, [2, 4]),
      new Se(9, 'F', 'Fluorine', 18.998, 1.73, 0.64, [1]),
      new Se(10, 'NE', 'Neon', 20.18, 1.54, 1.12, [0]),
      new Se(11, 'NA', 'Sodium', 22.99, 2.27, 0.97, [1]),
      new Se(12, 'MG', 'Magnesium', 24.305, 1.73, 1.1, [2]),
      new Se(13, 'AL', 'Aluminum', 26.981, 2.05, 1.35, [3]),
      new Se(14, 'SI', 'Silicon', 28.086, 2.1, 1.2, [4]),
      new Se(15, 'P', 'Phosphorus', 30.974, 2.08, 0.75, [3, 5]),
      new Se(16, 'S', 'Sulfur', 32.07, 2, 1.02, [2, 4, 6]),
      new Se(17, 'CL', 'Chlorine', 35.453, 1.97, 0.99, [1, 3, 5, 7]),
      new Se(18, 'AR', 'Argon', 39.948, 1.88, 1.57, [0]),
      new Se(19, 'K', 'Potassium', 39.1, 2.75, 1.33, [1]),
      new Se(20, 'CA', 'Calcium', 40.08, 1.973, 0.99, [2]),
      new Se(21, 'SC', 'Scandium', 44.956, 1.7, 1.44, [0]),
      new Se(22, 'TI', 'Titanium', 47.88, 1.7, 1.47, [0]),
      new Se(23, 'V', 'Vanadium', 50.941, 1.7, 1.33, [0]),
      new Se(24, 'CR', 'Chromium', 52, 1.7, 1.35, [0]),
      new Se(25, 'MN', 'Manganese', 54.938, 1.7, 1.35, [0]),
      new Se(26, 'FE', 'Iron', 55.847, 1.7, 1.34, [0]),
      new Se(27, 'CO', 'Cobalt', 58.93, 1.7, 1.33, [0]),
      new Se(28, 'NI', 'Nickel', 58.69, 1.63, 1.5, [0]),
      new Se(29, 'CU', 'Copper', 63.55, 1.4, 1.52, [0]),
      new Se(30, 'ZN', 'Zinc', 65.39, 1.39, 1.45, [0]),
      new Se(31, 'GA', 'Gallium', 69.72, 1.87, 1.22, [3]),
      new Se(32, 'GE', 'Germanium', 72.61, 1.7, 1.17, [4]),
      new Se(33, 'AS', 'Arsenic', 74.92, 1.85, 1.21, [3, 5]),
      new Se(34, 'SE', 'Selenium', 78.96, 1.9, 1.22, [2, 4, 6]),
      new Se(35, 'BR', 'Bromine', 79.9, 2.1, 1.21, [1, 3, 5, 7]),
      new Se(36, 'KR', 'Krypton', 83.8, 2.02, 1.91, [0]),
      new Se(37, 'RB', 'Rubidium', 85.47, 1.7, 1.47, [1]),
      new Se(38, 'SR', 'Strontium', 87.62, 1.7, 1.12, [2]),
      new Se(39, 'Y', 'Yttrium', 88.91, 1.7, 1.78, [0]),
      new Se(40, 'ZR', 'Zirconium', 91.22, 1.7, 1.56, [0]),
      new Se(41, 'NB', 'Niobium', 92.91, 1.7, 1.48, [0]),
      new Se(42, 'MO', 'Molybdenum', 95.94, 1.7, 1.47, [0]),
      new Se(43, 'TC', 'Technetium', 98.91, 1.7, 1.35, [0]),
      new Se(44, 'RU', 'Ruthenium', 101.07, 1.7, 1.4, [0]),
      new Se(45, 'RH', 'Rhodium', 102.91, 1.7, 1.45, [0]),
      new Se(46, 'PD', 'Palladium', 106.42, 1.63, 1.5, [0]),
      new Se(47, 'AG', 'Silver', 107.87, 1.72, 1.59, [0]),
      new Se(48, 'CD', 'Cadmium', 112.41, 1.58, 1.69, [0]),
      new Se(49, 'IN', 'Indium', 114.82, 1.93, 1.63, [3]),
      new Se(50, 'SN', 'Tin', 118.71, 2.17, 1.46, [2, 4]),
      new Se(51, 'SB', 'Antimony', 121.75, 2.2, 1.46, [3, 5]),
      new Se(52, 'TE', 'Tellurium', 127.6, 2.06, 1.47, [2, 4, 6]),
      new Se(53, 'I', 'Iodine', 126.91, 2.15, 1.4, [1, 3, 5, 7]),
      new Se(54, 'XE', 'Xenon', 131.29, 2.16, 1.98, [0]),
      new Se(55, 'CS', 'Cesium', 132.91, 1.7, 1.67, [1]),
      new Se(56, 'BA', 'Barium', 137.33, 1.7, 1.34, [2]),
      new Se(57, 'LA', 'Lanthanum', 138.91, 1.7, 1.87, [0]),
      new Se(58, 'CE', 'Cerium', 140.12, 1.7, 1.83, [0]),
      new Se(59, 'PR', 'Praseodymium', 140.91, 1.7, 1.82, [0]),
      new Se(60, 'ND', 'Neodymium', 144.24, 1.7, 1.81, [0]),
      new Se(61, 'PM', 'Promethium', 144.9, 1.7, 1.8, [0]),
      new Se(62, 'SM', 'Samarium', 150.36, 1.7, 1.8, [0]),
      new Se(63, 'EU', 'Europium', 151.96, 1.7, 1.99, [0]),
      new Se(64, 'GD', 'Gadolinium', 157.25, 1.7, 1.79, [0]),
      new Se(65, 'TB', 'Terbium', 158.93, 1.7, 1.76, [0]),
      new Se(66, 'DY', 'Dysprosium', 162.5, 1.7, 1.75, [0]),
      new Se(67, 'HO', 'Holmium', 164.93, 1.7, 1.74, [0]),
      new Se(68, 'ER', 'Erbium', 167.26, 1.7, 1.73, [0]),
      new Se(69, 'TM', 'Thulium', 168.93, 1.7, 1.72, [0]),
      new Se(70, 'YB', 'Ytterbium', 173.04, 1.7, 1.94, [0]),
      new Se(71, 'LU', 'Lutetium', 174.97, 1.7, 1.72, [0]),
      new Se(72, 'HF', 'Hafnium', 178.49, 1.7, 1.57, [0]),
      new Se(73, 'TA', 'Tantalum', 180.95, 1.7, 1.43, [0]),
      new Se(74, 'W', 'Tungsten', 183.85, 1.7, 1.37, [0]),
      new Se(75, 'RE', 'Rhenium', 186.21, 1.7, 1.35, [0]),
      new Se(76, 'OS', 'Osmium', 190.2, 1.7, 1.37, [0]),
      new Se(77, 'IR', 'Iridium', 192.22, 1.7, 1.32, [0]),
      new Se(78, 'PT', 'Platinum', 195.08, 1.72, 1.5, [0]),
      new Se(79, 'AU', 'Gold', 196.97, 1.66, 1.5, [0]),
      new Se(80, 'HG', 'Mercury', 200.59, 1.55, 1.7, [0]),
      new Se(81, 'TL', 'Thallium', 204.38, 1.96, 1.55, [1, 3]),
      new Se(82, 'PB', 'Lead', 207.2, 2.02, 1.54, [2, 4]),
      new Se(83, 'BI', 'Bismuth', 208.98, 1.7, 1.54, [3, 5]),
      new Se(84, 'PO', 'Polonium', 210, 1.7, 1.68, [2, 4, 6]),
      new Se(85, 'AT', 'Astatine', 210, 1.7, 1.7, [1, 3, 5, 7]),
      new Se(86, 'RN', 'Radon', 222, 1.7, 2.4, [0]),
      new Se(87, 'FR', 'Francium', 223, 1.7, 2, [1]),
      new Se(88, 'RA', 'Radium', 226.03, 1.7, 1.9, [2]),
      new Se(89, 'AC', 'Actinium', 227.03, 1.7, 1.88, [0]),
      new Se(90, 'TH', 'Thorium', 232.04, 1.7, 1.79, [0]),
      new Se(91, 'PA', 'Protactinium', 231.04, 1.7, 1.61, [0]),
      new Se(92, 'U', 'Uranium', 238.03, 1.86, 1.58, [0]),
      new Se(93, 'NP', 'Neptunium', 237.05, 1.7, 1.55, [0]),
      new Se(94, 'PU', 'Plutonium', 239.1, 1.7, 1.53, [0]),
      new Se(95, 'AM', 'Americium', 243.1, 1.7, 1.51, [0]),
      new Se(96, 'CM', 'Curium', 247.1, 1.7, 1.5, [0]),
      new Se(97, 'BK', 'Berkelium', 247.1, 1.7, 1.5, [0]),
      new Se(98, 'CF', 'Californium', 252.1, 1.7, 1.5, [0]),
      new Se(99, 'ES', 'Einsteinium', 252.1, 1.7, 1.5, [0]),
      new Se(100, 'FM', 'Fermium', 257.1, 1.7, 1.5, [0]),
      new Se(101, 'MD', 'Mendelevium', 256.1, 1.7, 1.5, [0]),
      new Se(102, 'NO', 'Nobelium', 259.1, 1.7, 1.5, [0]),
      new Se(103, 'LR', 'Lawrencium', 260.1, 1.7, 1.5, [0]),
      new Se(104, 'RF', 'Rutherfordium', 261, 1.7, 1.6, [0]),
      new Se(105, 'DB', 'Dubnium', 262, 1.7, 1.6, [0]),
      new Se(106, 'SG', 'Seaborgium', 263, 1.7, 1.6, [0]),
      new Se(107, 'BH', 'Bohrium', 262, 1.7, 1.6, [0]),
      new Se(108, 'HS', 'Hassium', 265, 1.7, 1.6, [0]),
      new Se(109, 'MT', 'Meitnerium', 268, 1.7, 1.6, [0])
    ]),
    be(Se, 'ByName', {
      D: new Se(1, 'D', 'Deuterium', 2.014, 1.2, 0.23, [1]),
      T: new Se(1, 'T', 'Tritium', 3.016, 1.2, 0.23, [1])
    }),
    (function () {
      for (
        var e = Se.ByAtomicNumber, t = Se.ByName, r = 0, n = e.length;
        r < n;
        ++r
      ) {
        var i = e[r]
        i && (t[i.name] = i)
      }
    })(),
    (Se.getByName = function (e) {
      return (
        Se.ByName[e] ||
        (Se.ByName[e] = new Se(0, e, 'Unknown', 0, 1, 0.01, [0]))
      )
    })
  var Re = { UNKNOWN: 0, COVALENT: 1, AROMATIC: 2 }
  function Ce(e) {
    return e.position
  }
  var Ae = (function () {
    function o(e, t, r, n, i) {
      if (
        (G(this, o),
        (this._left = e),
        (this._right = t),
        (this._fixed = i),
        (this._index = -1),
        t < e)
      )
        throw new Error('In a bond atom indices must be in increasing order')
      ;(this._order = r), (this._type = n)
    }
    return (
      p(o, [
        {
          key: 'getLeft',
          value: function () {
            return this._left
          }
        },
        {
          key: 'getRight',
          value: function () {
            return this._right
          }
        },
        {
          key: 'getOrder',
          value: function () {
            return this._order
          }
        },
        {
          key: 'calcLength',
          value: function () {
            return this._left.position.distanceTo(this._right.position)
          }
        },
        {
          key: '_forEachNeighbour',
          value: function (e, t) {
            for (var r = e.bonds, n = 0, i = r.length; n < i; ++n)
              t(r[n]._left !== e ? r[n]._left : r[n]._right)
          }
        },
        {
          key: 'forEachLevelOne',
          value: function (t) {
            var r = this._left,
              n = this._right
            this._forEachNeighbour(r, function (e) {
              e !== n && t(e)
            }),
              this._forEachNeighbour(n, function (e) {
                e !== r && t(e)
              })
          }
        },
        {
          key: 'forEachLevelTwo',
          value: function (t) {
            var r = this._left,
              n = this._right,
              i = this
            i._forEachNeighbour(r, function (e) {
              e !== n &&
                i._forEachNeighbour(e, function (e) {
                  e !== r && t(e)
                })
            }),
              i._forEachNeighbour(n, function (e) {
                e !== r &&
                  i._forEachNeighbour(e, function (e) {
                    e !== n && t(e)
                  })
              })
          }
        },
        {
          key: '_fixDir',
          value: function (t, r, n) {
            var i = 0,
              o = 0,
              s = t.clone()
            function a(e) {
              s.copy(n(e)), s.sub(t), 0 < r.dot(s) ? ++i : ++o
            }
            function e(e) {
              'C' === e.element.name && a(e)
            }
            for (
              var l = [
                  [this.forEachLevelOne, e],
                  [this.forEachLevelOne, a],
                  [this.forEachLevelTwo, e],
                  [this.forEachLevelTwo, a]
                ],
                c = 0;
              c < l.length;
              ++c
            ) {
              if ((l[c][0].call(this, l[c][1]), i < o))
                return r.multiplyScalar(-1)
              if (o < i) return r
            }
            return r
          }
        },
        {
          key: 'calcNormalDir',
          value: function (e) {
            var t = this._left,
              r = this._right,
              n = t,
              i = r
            ;(e = void 0 === e ? Ce : e),
              t.bonds.length > r.bonds.length && ((n = r), (i = t))
            for (
              var o = n, s = 0, a = i.bonds, l = 0, c = a.length;
              l < c;
              ++l
            ) {
              var u = a[l]._left
              ;(u = a[l]._left === i ? a[l]._right : u).bonds.length > s &&
                u !== n &&
                (s = (o = u).bonds.length)
            }
            var h = e(i),
              r = e(n).clone().sub(h),
              t = e(o).clone().sub(h)
            return (
              t.crossVectors(r, t),
              t.lengthSq() < 1e-4 && t.set(0, 1, 0),
              r.normalize(),
              t.normalize(),
              r.crossVectors(t, r),
              r.lengthSq() < 1e-4 && r.set(0, 1, 0),
              r.normalize(),
              this._fixDir(h, r, e)
            )
          }
        }
      ]),
      o
    )
  })()
  be(Ae, 'BondType', Re), (Ae.prototype.BondType = Re)
  var Ee = ["C3'", 'C3*', 'P', 'H5T', 'H3T'],
    ke = ['OP1', 'O1P'],
    Te = ['OP2', 'O2P'],
    Pe = ["C3'", 'C3*', 'C1', "C1'", 'C1*', 'P'],
    Me = [
      { types: ['A', 'DA', 'G', 'DG'], atoms: ['N1'] },
      { types: ['C', 'DC'], atoms: ['N3'] },
      { types: ['T', 'DT', 'U', 'DU'], atoms: ['O4'] }
    ],
    Ne = (function () {
      function i(e, t, r, n) {
        G(this, i),
          (this._chain = e),
          (this._component = null),
          (this._type = t),
          (this._sequence = r),
          (this._icode = n),
          (this._mask = 1),
          (this._index = -1),
          (this._atoms = []),
          (this._secondary = null),
          (this._firstAtom = null),
          (this._leadAtom = null),
          (this._wingAtom = null),
          (this._lastAtom = null),
          (this._controlPoint = null),
          (this._midPoint = null),
          (this._wingVector = null),
          (this._cylinders = null),
          (this._isValid = !0),
          (this._het = !1),
          (this._molecule = null),
          (this.temperature = null),
          (this.occupancy = null)
      }
      return (
        p(i, [
          {
            key: 'getChain',
            value: function () {
              return this._chain
            }
          },
          {
            key: 'getMolecule',
            value: function () {
              return this._molecule
            }
          },
          {
            key: 'getType',
            value: function () {
              return this._type
            }
          },
          {
            key: 'getSequence',
            value: function () {
              return this._sequence
            }
          },
          {
            key: 'getSecondary',
            value: function () {
              return this._secondary
            }
          },
          {
            key: 'getICode',
            value: function () {
              return this._icode
            }
          },
          {
            key: 'addAtom',
            value: function (e, t, r, n, i, o, s, a, l, c) {
              c = new we(this, e, t, r, n, i, o, s, a, l, c)
              return (
                this._chain.getComplex().addAtom(c),
                this._atoms.push(c),
                (this._het = this._het || i),
                c
              )
            }
          },
          {
            key: 'getAtomCount',
            value: function () {
              return this._atoms.length
            }
          },
          {
            key: 'forEachAtom',
            value: function (e) {
              for (
                var t = this._atoms, r = 0, n = t.length;
                r < n && !e(t[r]);
                ++r
              );
            }
          },
          {
            key: '_findAtomByName',
            value: function (t) {
              var r = null
              return (
                this.forEachAtom(function (e) {
                  return e.name === t && ((r = e), !0)
                }),
                r
              )
            }
          },
          {
            key: '_findFirstAtomInList',
            value: function (e) {
              for (var t = null, r = 0; r < e.length; ++r)
                if (null !== (t = this._findAtomByName(e[r]))) return t
              return t
            }
          },
          {
            key: 'collectMask',
            value: function () {
              for (
                var e = 4294967295, t = this._atoms, r = 0, n = t.length;
                r < n;
                ++r
              )
                e &= t[r].mask
              this._mask = e
            }
          },
          {
            key: 'getCylinderTargetList',
            value: function () {
              for (var e = this._type._name, t = 0, r = Me.length; t < r; ++t)
                for (var n = 0, i = Me[t].types.length; n < i; ++n)
                  if (e === Me[t].types[n]) return Me[t].atoms
              return null
            }
          },
          {
            key: '_detectLeadWing',
            value: function (e, t, r) {
              var n = this._findFirstAtomInList(Ee),
                i = this._findFirstAtomInList(ke),
                o = this._findFirstAtomInList(Te)
              null === i && null !== t && (i = t._findFirstAtomInList(ke)),
                null === o && null !== t && (o = t._findFirstAtomInList(Te)),
                null !== n &&
                  null !== i &&
                  null !== o &&
                  ((e._leadAtom = n),
                  (e._controlPoint = r(n)),
                  (e._wingVector = r(o).clone().sub(r(i))),
                  (e._isValid = !0),
                  (o = this._findFirstAtomInList(Pe)),
                  (i =
                    null !== (i = this.getCylinderTargetList())
                      ? this._findFirstAtomInList(i)
                      : null),
                  null !== o && null !== i && (e._cylinders = [r(o), r(i)]))
            }
          },
          {
            key: 'calcWing',
            value: function (e, t, r, n) {
              ;(t = t.clone().sub(e)), (r = e.clone().sub(r))
              return (
                r.crossVectors(t, r),
                r.crossVectors(t, r).normalize(),
                null !== n &&
                  1e-4 < n.length() &&
                  1e-4 < r.length() &&
                  Math.abs(n.angleTo(r)) > Math.PI / 2 &&
                  r.negate(),
                r
              )
            }
          },
          {
            key: '_innerFinalize',
            value: function (e, t, r, n, i, o) {
              var s = null === t,
                a = o(this._leadAtom),
                a = new ae.Vector3(a.x, a.y, a.z)
              i
                ? this._detectLeadWing(n, r, o)
                : (s
                    ? (n._midPoint = o(this._firstAtom).clone())
                    : ((s = t._controlPoint),
                      (n._midPoint = s.clone().lerp(a, 0.5)),
                      (n._wingVector = this.calcWing(
                        s,
                        a,
                        o(e._wingAtom),
                        t._wingVector
                      ))),
                  (n._controlPoint = a))
            }
          },
          {
            key: '_finalize2',
            value: function (e, t, r) {
              this._innerFinalize(e, e, t, this, r, function (e) {
                return e.position
              })
            }
          },
          {
            key: 'isConnected',
            value: function (o) {
              if (this._chain !== o._chain) return !1
              if (this === o) return !0
              var s = !1
              return (
                this.forEachAtom(function (e) {
                  for (var t = e.bonds, r = 0, n = t.length; r < n; ++r) {
                    var i = t[r]
                    if (i._left.residue === o || i._right.residue === o)
                      return (s = !0)
                  }
                  return !1
                }),
                s
              )
            }
          },
          {
            key: '_finalize',
            value: function () {
              var t = this,
                e = m(this._atoms, 1)
              ;(this._firstAtom = e[0]),
                (this._lastAtom = this._atoms[this._atoms.length - 1]),
                (this._leadAtom = null),
                (this._wingAtom = null)
              var r = 0,
                n = 0,
                i = 0,
                o = 0
              this.forEachAtom(function (e) {
                return (
                  null === t._leadAtom &&
                    e.role === Se.Constants.Lead &&
                    (t._leadAtom = e),
                  null === t._wingAtom &&
                    e.role === Se.Constants.Wing &&
                    (t._wingAtom = e),
                  e.temperature && ((n += e.temperature), r++),
                  e.occupancy && ((o += e.occupancy), i++),
                  null !== t._leadAtom && null !== t._wingAtom
                )
              }),
                0 < r && (this.temperature = n / r),
                0 < i && (this.occupancy = o / i),
                (null !== this._leadAtom && null !== this._wingAtom) ||
                  (this._isValid = !1),
                null === this._leadAtom && (this._leadAtom = this._firstAtom),
                null === this._wingAtom && (this._wingAtom = this._lastAtom)
            }
          }
        ]),
        i
      )
    })(),
    Le = (function () {
      function n(e, t, r) {
        G(this, n),
          (this._name = e),
          (this._fullName = t),
          (this.letterCode = r),
          (this.flags = 0)
      }
      return (
        p(n, [
          {
            key: 'getName',
            value: function () {
              return this._name
            }
          }
        ]),
        n
      )
    })()
  function Ie(e, t) {
    for (var r = 0, n = t.length; r < n; ++r) {
      var i = Le.StandardTypes[t[r]]
      i && (i.flags |= e)
    }
  }
  be(Le, 'StandardTypes', {
    ALA: new Le('ALA', 'Alanine', 'A'),
    ARG: new Le('ARG', 'Arginine', 'R'),
    ASN: new Le('ASN', 'Asparagine', 'N'),
    ASP: new Le('ASP', 'Aspartic Acid', 'D'),
    CYS: new Le('CYS', 'Cysteine', 'C'),
    GLN: new Le('GLN', 'Glutamine', 'Q'),
    GLU: new Le('GLU', 'Glutamic Acid', 'E'),
    GLY: new Le('GLY', 'Glycine', 'G'),
    HIS: new Le('HIS', 'Histidine', 'H'),
    ILE: new Le('ILE', 'Isoleucine', 'I'),
    LEU: new Le('LEU', 'Leucine', 'L'),
    LYS: new Le('LYS', 'Lysine', 'K'),
    MET: new Le('MET', 'Methionine', 'M'),
    PHE: new Le('PHE', 'Phenylalanine', 'F'),
    PRO: new Le('PRO', 'Proline', 'P'),
    PYL: new Le('PYL', 'Pyrrolysine', 'O'),
    SEC: new Le('SEC', 'Selenocysteine', 'U'),
    SER: new Le('SER', 'Serine', 'S'),
    THR: new Le('THR', 'Threonine', 'T'),
    TRP: new Le('TRP', 'Tryptophan', 'W'),
    TYR: new Le('TYR', 'Tyrosine', 'Y'),
    VAL: new Le('VAL', 'Valine', 'V'),
    A: new Le('A', 'Adenine', 'A'),
    C: new Le('C', 'Cytosine', 'C'),
    G: new Le('G', 'Guanine', 'G'),
    I: new Le('I', 'Inosine', 'I'),
    T: new Le('T', 'Thymine', 'T'),
    U: new Le('U', 'Uracil', 'U'),
    DA: new Le('DA', 'Adenine', 'A'),
    DC: new Le('DC', 'Cytosine', 'C'),
    DG: new Le('DG', 'Guanine', 'G'),
    DI: new Le('DI', 'Inosine', 'I'),
    DT: new Le('DT', 'Thymine', 'T'),
    DU: new Le('DU', 'Uracil', 'U'),
    '+A': new Le('+A', 'Adenine', 'A'),
    '+C': new Le('+C', 'Cytosine', 'C'),
    '+G': new Le('+G', 'Guanine', 'G'),
    '+I': new Le('+I', 'Inosine', 'I'),
    '+T': new Le('+T', 'Thymine', 'T'),
    '+U': new Le('+U', 'Uracil', 'U'),
    WAT: new Le('WAT', 'Water', ''),
    H2O: new Le('H2O', 'Water', ''),
    HOH: new Le('HOH', 'Water', ''),
    DOD: new Le('DOD', 'Water', ''),
    UNK: new Le('UNK', 'Unknown', ''),
    UNL: new Le('UNL', 'Unknown Ligand', '')
  }),
    be(Le, 'Flags', {
      PROTEIN: 1,
      BASIC: 2,
      ACIDIC: 4,
      POLAR: 8,
      NONPOLAR: 16,
      AROMATIC: 32,
      NUCLEIC: 256,
      PURINE: 512,
      PYRIMIDINE: 1024,
      DNA: 2048,
      RNA: 4096,
      WATER: 65536
    })
  var Oe = Le.Flags
  Ie(Oe.WATER, ['WAT', 'H2O', 'HOH', 'DOD']),
    Ie(Oe.PROTEIN, [
      'ALA',
      'ARG',
      'ASN',
      'ASP',
      'CYS',
      'GLY',
      'GLU',
      'GLN',
      'HIS',
      'ILE',
      'LEU',
      'LYS',
      'MET',
      'PHE',
      'PRO',
      'PYL',
      'SEC',
      'SER',
      'THR',
      'TRP',
      'TYR',
      'VAL'
    ]),
    Ie(Oe.BASIC, ['ARG', 'HIS', 'LYS']),
    Ie(Oe.ACIDIC, ['ASP', 'GLU']),
    Ie(Oe.POLAR, ['ASN', 'CYS', 'GLN', 'SER', 'THR', 'TYR']),
    Ie(Oe.NONPOLAR, [
      'ALA',
      'ILE',
      'LEU',
      'MET',
      'PHE',
      'PRO',
      'TRP',
      'VAL',
      'GLY'
    ]),
    Ie(Oe.AROMATIC, ['PHE', 'TRP', 'TYR']),
    Ie(Oe.NUCLEIC, [
      'A',
      'G',
      'I',
      'DA',
      'DG',
      'DI',
      '+A',
      '+G',
      '+I',
      'C',
      'T',
      'U',
      'DC',
      'DT',
      'DU',
      '+C',
      '+T',
      '+U'
    ]),
    Ie(Oe.PURINE, ['A', 'G', 'I', 'DA', 'DG', 'DI', '+A', '+G', '+I']),
    Ie(Oe.PYRIMIDINE, ['C', 'T', 'U', 'DC', 'DT', 'DU', '+C', '+T', '+U']),
    Ie(Oe.DNA, ['DA', 'DG', 'DI', 'DC', 'DT', 'DU']),
    Ie(Oe.RNA, ['A', 'G', 'I', 'C', 'T', 'U'])
  !(function (e, t) {
    for (var r = Object.keys(t), n = 0, i = r.length; n < i; ++n) {
      var o = r[n],
        s = t[o]
      Le.StandardTypes[o][e] = s
    }
  })('hydrophobicity', {
    ILE: 4.5,
    VAL: 4.2,
    LEU: 3.8,
    PHE: 2.8,
    CYS: 2.5,
    MET: 1.9,
    ALA: 1.8,
    GLY: -0.4,
    THR: -0.7,
    SER: -0.8,
    TRP: -0.9,
    TYR: -1.3,
    PRO: -1.6,
    HIS: -3.2,
    GLU: -3.5,
    GLN: -3.5,
    ASP: -3.5,
    ASN: -3.5,
    LYS: -3.9,
    ARG: -4.5
  })
  var Be = 0,
    Ve = 1,
    De = 2,
    ze = (function () {
      function r(e, t) {
        G(this, r),
          (this._complex = e),
          (this._name = t),
          (this._mask = 1),
          (this._index = -1),
          (this._residues = []),
          (this.minSequence = Number.POSITIVE_INFINITY),
          (this.maxSequence = Number.NEGATIVE_INFINITY)
      }
      return (
        p(r, [
          {
            key: 'getComplex',
            value: function () {
              return this._complex
            }
          },
          {
            key: 'getName',
            value: function () {
              return this._name
            }
          },
          {
            key: 'getResidues',
            value: function () {
              return this._residues
            }
          },
          {
            key: '_determineType',
            value: function () {
              var e = this._residues,
                t = Le.Flags,
                r = t.PROTEIN,
                n = t.NUCLEIC
              this.type = Be
              for (var i = 0, o = e.length; i < o; ++i) {
                var s = e[i]._type.flags
                if (0 != (s & n)) {
                  this.type = De
                  break
                }
                if (0 != (s & r)) {
                  this.type = Ve
                  break
                }
              }
            }
          },
          {
            key: 'findResidue',
            value: function (e, t) {
              for (var r = this._residues, n = 0, i = r.length; n < i; ++n) {
                var o = r[n]
                if (o._sequence === e && o._icode === t) return [o, n]
              }
              return null
            }
          },
          {
            key: '_finalize',
            value: function () {
              this._determineType()
              for (
                var e, t = this._residues, r = null, n = 0, i = t.length;
                n < i;
                ++n
              ) {
                var o = n + 1 < i ? t[n + 1] : null,
                  s = t[n]
                s._finalize2(r, o, this.type === De), (r = s)
              }
              1 < t.length && t[1]._wingVector
                ? ((e = t[1]._wingVector),
                  (t[0]._wingVector = new ae.Vector3(e.x, e.y, e.z)))
                : 0 < t.length && (t[0]._wingVector = new ae.Vector3(1, 0, 0))
            }
          },
          {
            key: 'updateToFrame',
            value: function (t) {
              var e = this._residues,
                r = null,
                n = null,
                i = t._residues,
                o = e.length
              function s(e) {
                return t.getAtomPos(e.index)
              }
              for (var a = 0; a < o; ++a) {
                var l = e[a],
                  c = i[l._index],
                  u = a + 1 < o ? e[a + 1] : null
                l._innerFinalize(r, n, u, c, this.type === De, s),
                  (r = l),
                  (n = c)
              }
              i[e[0]._index]._wingVector =
                1 < o ? i[e[1]._index]._wingVector : new ae.Vector3(1, 0, 0)
            }
          },
          {
            key: 'addResidue',
            value: function (e, t, r) {
              var n = this._complex.getResidueType(e)
              null === n && (n = this._complex.addResidueType(e))
              r = new Ne(this, n, t, r)
              return (
                this._complex.addResidue(r),
                this._residues.push(r),
                n.flags & (Le.Flags.NUCLEIC | Le.Flags.PROTEIN) &&
                  (this.maxSequence < t && (this.maxSequence = t),
                  this.minSequence > t && (this.minSequence = t)),
                r
              )
            }
          },
          {
            key: 'getResidueCount',
            value: function () {
              return this._residues.length
            }
          },
          {
            key: 'forEachResidue',
            value: function (e) {
              for (var t = this._residues, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'collectMask',
            value: function () {
              for (
                var e = 4294967295, t = this._residues, r = 0, n = t.length;
                r < n;
                ++r
              )
                e &= t[r]._mask
              this._mask = e
            }
          }
        ]),
        r
      )
    })(),
    Fe = (function () {
      function n(e, t, r) {
        G(this, n),
          (this.type = e),
          (this.generic = n.genericByType[this.type] || 'loop'),
          (this.init = t),
          (this.term = r)
      }
      return (
        p(n, [
          {
            key: '_finalize',
            value: function (e, t, r) {
              if (!(this.init instanceof Ne && this.term instanceof Ne)) {
                for (
                  var n = r.splitUnifiedSerial(this.init),
                    i = r.splitUnifiedSerial(this.term),
                    o = n.chain;
                  o <= i.chain;
                  o++
                )
                  for (var s = n.serial; s <= i.serial; s++)
                    for (var a = n.iCode; a <= i.iCode; a++) {
                      var l = r.getUnifiedSerial(o, s, a)
                      t[l] && (t[l]._secondary = this)
                    }
                ;(this.init = t[this.init]), (this.term = t[this.term])
              }
            }
          }
        ]),
        n
      )
    })()
  ;(Fe.Type = {
    STRAND: 'E',
    BRIDGE: 'B',
    HELIX_310: 'G',
    HELIX_ALPHA: 'H',
    HELIX_PI: 'I',
    HELIX: 'X',
    TURN_310: '3',
    TURN_ALPHA: '4',
    TURN_PI: '5',
    TURN: 'T',
    BEND: 'S',
    COIL: 'C'
  }),
    (Fe.Generic = { STRAND: 'strand', HELIX: 'helix', LOOP: 'loop' })
  var Ue = Fe.Type,
    Ge = Fe.Generic
  function je(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Fe.genericByType =
    (be((ta = {}), Ue.STRAND, Ge.STRAND),
    be(ta, Ue.HELIX_310, Ge.HELIX),
    be(ta, Ue.HELIX_ALPHA, Ge.HELIX),
    be(ta, Ue.HELIX_PI, Ge.HELIX),
    be(ta, Ue.HELIX, Ge.HELIX),
    ta)
  var He = Fe.Type,
    We = { 1: He.HELIX_ALPHA, 3: He.HELIX_PI, 5: He.HELIX_310 },
    Ye = (function () {
      x(l, Fe)
      var a = je(l)
      function l(e, t, r, n, i, o, s) {
        return (
          G(this, l),
          ((r = a.call(this, We[e] || Fe.Type.HELIX, t, r)).serial = n),
          (r.name = i),
          (r.comment = o),
          (r.length = s),
          r
        )
      }
      return p(l)
    })()
  function Xe() {
    return (Xe =
      'undefined' != typeof Reflect && Reflect.get
        ? Reflect.get
        : function (e, t, r) {
            var n = (function (e, t) {
              for (
                ;
                !Object.prototype.hasOwnProperty.call(e, t) &&
                null !== (e = C(e));

              );
              return e
            })(e, t)
            if (n) {
              t = Object.getOwnPropertyDescriptor(n, t)
              return t.get ? t.get.call(arguments.length < 3 ? e : r) : t.value
            }
          }).apply(this, arguments)
  }
  function qe(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var $e = (function () {
      x(a, Fe)
      var s = qe(a)
      function a(e, t, r, n, i, o) {
        return (
          G(this, a),
          ((r = s.call(this, Fe.Type.STRAND, t, r)).sheet = e),
          (r.sense = n),
          (r.atomCur = i),
          (r.atomPrev = o),
          r
        )
      }
      return (
        p(a, [
          {
            key: '_finalize',
            value: function (e, t, r) {
              Xe(C(a.prototype), '_finalize', this).call(this, e, t, r)
              r = this.atomCur
              null === r || Number.isNaN(r) || (this.atomCur = e[r]),
                null === (r = this.atomPrev) ||
                  Number.isNaN(r) ||
                  (this.atomPrev = e[r])
            }
          }
        ]),
        a
      )
    })(),
    Ze = (function () {
      function r(e, t) {
        G(this, r), (this._name = e), (this._width = t), (this._strands = [])
      }
      return (
        p(r, [
          {
            key: 'getName',
            value: function () {
              return this._name
            }
          },
          {
            key: 'getWidth',
            value: function () {
              return this._width
            }
          },
          {
            key: 'addStrand',
            value: function (e) {
              this._strands.push(e), (this._width = this._strands.length)
            }
          },
          {
            key: 'addEmptyStrand',
            value: function () {
              this._strands.push(new $e(null, null, null, null, null, null))
            }
          },
          {
            key: '_finalize',
            value: function (e, t, r) {
              for (var n = this._strands, i = 0, o = n.length; i < o; ++i)
                n[i]._finalize(e, t, r)
              if (
                (this._width || (this._width = n.length),
                n.length !== this._width)
              )
                throw new Error(
                  'Sheet '.concat(this._name, ' is inconsistent.')
                )
            }
          }
        ]),
        r
      )
    })(),
    Ke = (function () {
      function o(e, t, r, n, i) {
        G(this, o),
          (this._id = e),
          (this._name = t),
          (this._position = r || new ae.Vector3()),
          (this._atoms = n || []),
          (this._charge = 0),
          (this._repeat = 1),
          (this._center = null),
          (this.xmlNodeRef = i || null)
      }
      return (
        p(o, [
          {
            key: 'getName',
            value: function () {
              return this._name
            }
          },
          {
            key: 'getPosition',
            value: function () {
              return this._position
            }
          },
          {
            key: 'getCentralPoint',
            value: function () {
              return this._center
            }
          },
          {
            key: '_rebuildSGroupOnAtomChange',
            value: function () {
              if (null !== this._center) {
                for (
                  var e = new ae.Vector3(1e8, 1e8, 1e8),
                    t = new ae.Vector3(-1e8, -1e8, -1e8),
                    r = 0,
                    n = this._atoms.length;
                  r < n;
                  r++
                ) {
                  var i = this._atoms[r].position
                  e.set(
                    Math.min(e.x, i.x),
                    Math.min(e.y, i.y),
                    Math.min(e.z, i.z)
                  ),
                    t.set(
                      Math.max(t.x, i.x),
                      Math.max(t.y, i.y),
                      Math.max(t.z, i.z)
                    )
                }
                this._center.addVectors(e, t), this._center.multiplyScalar(0.5)
              }
            }
          }
        ]),
        o
      )
    })(),
    Qe =
      'undefined' != typeof globalThis
        ? globalThis
        : 'undefined' != typeof window
        ? window
        : 'undefined' != typeof global
        ? global
        : 'undefined' != typeof self
        ? self
        : {}
  function Je(e, t, r, n) {
    for (r = r || {}, n = e.length; n--; r[e[n]] = t);
    return r
  }
  function et() {
    this.yy = {}
  }
  var tt = {
    parser:
      ((va = [1, 17]),
      (xa = [1, 22]),
      (wa = [1, 20]),
      (Ra = [1, 21]),
      (Aa = [5, 7, 8, 11, 19]),
      ((Aa = {
        trace: function () {},
        yy: {},
        symbols_: {
          error: 2,
          Program: 3,
          Expression: 4,
          EOF: 5,
          Selector: 6,
          OR: 7,
          AND: 8,
          NOT: 9,
          '(': 10,
          ')': 11,
          SELECTOR: 12,
          NAMED_SELECTOR: 13,
          SELECTOR_RANGED: 14,
          RangeList: 15,
          SELECTOR_NAMED: 16,
          NameList: 17,
          Range: 18,
          ',': 19,
          NUMBER: 20,
          ':': 21,
          Name: 22,
          IDENTIFIER: 23,
          STRING: 24,
          $accept: 0,
          $end: 1
        },
        terminals_: {
          2: 'error',
          5: 'EOF',
          7: 'OR',
          8: 'AND',
          9: 'NOT',
          10: '(',
          11: ')',
          12: 'SELECTOR',
          13: 'NAMED_SELECTOR',
          14: 'SELECTOR_RANGED',
          16: 'SELECTOR_NAMED',
          19: ',',
          20: 'NUMBER',
          21: ':',
          23: 'IDENTIFIER',
          24: 'STRING'
        },
        productions_: [
          0,
          [3, 2],
          [4, 1],
          [4, 3],
          [4, 3],
          [4, 2],
          [4, 3],
          [6, 1],
          [6, 1],
          [6, 2],
          [6, 2],
          [15, 1],
          [15, 3],
          [18, 1],
          [18, 3],
          [17, 1],
          [17, 3],
          [22, 1],
          [22, 1],
          [22, 1]
        ],
        performAction: function (e, t, r, n, i, o, s) {
          var a = o.length - 1
          switch (i) {
            case 1:
              return o[a - 1]
            case 3:
              this.$ = n.keyword('or')(o[a - 2], o[a])
              break
            case 4:
              this.$ = n.keyword('and')(o[a - 2], o[a])
              break
            case 5:
              this.$ = n.keyword('not')(o[a])
              break
            case 6:
              this.$ = o[a - 1]
              break
            case 7:
              this.$ = n.keyword(o[a])()
              break
            case 8:
              this.$ = n.GetSelector(o[a].toLowerCase().slice(1, o[a].length))
              break
            case 9:
            case 10:
              this.$ = n.keyword(o[a - 1])(o[a])
              break
            case 11:
              this.$ = new n.RangeList(o[a])
              break
            case 12:
            case 16:
              this.$ = o[a - 2].append(o[a])
              break
            case 13:
              this.$ = new n.Range(Number(o[a]))
              break
            case 14:
              this.$ = new n.Range(Number(o[a - 2]), Number(o[a]))
              break
            case 15:
              this.$ = new n.ValueList(o[a])
          }
        },
        table: [
          {
            3: 1,
            4: 2,
            6: 3,
            9: (ra = [1, 4]),
            10: (vd = [1, 5]),
            12: (na = [1, 6]),
            13: (ia = [1, 7]),
            14: (gd = [1, 8]),
            16: (la = [1, 9])
          },
          { 1: [3] },
          { 5: [1, 10], 7: (ua = [1, 11]), 8: (fa = [1, 12]) },
          Je((pa = [5, 7, 8, 11]), [2, 2]),
          { 4: 13, 6: 3, 9: ra, 10: vd, 12: na, 13: ia, 14: gd, 16: la },
          { 4: 14, 6: 3, 9: ra, 10: vd, 12: na, 13: ia, 14: gd, 16: la },
          Je(pa, [2, 7]),
          Je(pa, [2, 8]),
          { 15: 15, 18: 16, 20: va },
          { 17: 18, 20: xa, 22: 19, 23: wa, 24: Ra },
          { 1: [2, 1] },
          { 4: 23, 6: 3, 9: ra, 10: vd, 12: na, 13: ia, 14: gd, 16: la },
          { 4: 24, 6: 3, 9: ra, 10: vd, 12: na, 13: ia, 14: gd, 16: la },
          Je(pa, [2, 5]),
          { 7: ua, 8: fa, 11: [1, 25] },
          Je(pa, [2, 9], { 19: [1, 26] }),
          Je(Aa, [2, 11]),
          Je(Aa, [2, 13], { 21: [1, 27] }),
          Je(pa, [2, 10], { 19: [1, 28] }),
          Je(Aa, [2, 15]),
          Je(Aa, [2, 17]),
          Je(Aa, [2, 18]),
          Je(Aa, [2, 19]),
          Je([5, 7, 11], [2, 3], { 8: fa }),
          Je(pa, [2, 4]),
          Je(pa, [2, 6]),
          { 18: 29, 20: va },
          { 20: [1, 30] },
          { 20: xa, 22: 31, 23: wa, 24: Ra },
          Je(Aa, [2, 12]),
          Je(Aa, [2, 14]),
          Je(Aa, [2, 16])
        ],
        defaultActions: { 10: [2, 1] },
        parseError: function (e, t) {
          if (!t.recoverable) {
            var r = new Error(e)
            throw ((r.hash = t), r)
          }
          this.trace(e)
        },
        parse: function (e) {
          var t,
            r = this,
            n = [0],
            i = [],
            o = [null],
            s = [],
            a = this.table,
            l = '',
            c = 0,
            u = 0,
            h = 1,
            f = s.slice.call(arguments, 1),
            d = Object.create(this.lexer),
            p = { yy: {} }
          for (t in this.yy)
            Object.prototype.hasOwnProperty.call(this.yy, t) &&
              (p.yy[t] = this.yy[t])
          d.setInput(e, p.yy),
            (p.yy.lexer = d),
            (p.yy.parser = this),
            void 0 === d.yylloc && (d.yylloc = {})
          var m = d.yylloc
          s.push(m)
          var y = d.options && d.options.ranges
          'function' == typeof p.yy.parseError
            ? (this.parseError = p.yy.parseError)
            : (this.parseError = Object.getPrototypeOf(this).parseError)
          for (var _, v, g, x, b, w, S = {}; ; ) {
            if (
              ((v = n[n.length - 1]),
              void 0 ===
                (g =
                  this.defaultActions[v] ||
                  (null == _ &&
                    ((R = void 0),
                    'number' != typeof (R = i.pop() || d.lex() || h) &&
                      (R instanceof Array && (R = (i = R).pop()),
                      (R = r.symbols_[R] || R)),
                    (_ = R)),
                  a[v] && a[v][_])) ||
                !g.length ||
                !g[0])
            ) {
              var R = '',
                C = []
              for (b in a[v])
                this.terminals_[b] &&
                  2 < b &&
                  C.push("'" + this.terminals_[b] + "'")
              ;(R = d.showPosition
                ? 'Parse error on line ' +
                  (c + 1) +
                  ':\n' +
                  d.showPosition() +
                  '\nExpecting ' +
                  C.join(', ') +
                  ", got '" +
                  (this.terminals_[_] || _) +
                  "'"
                : 'Parse error on line ' +
                  (c + 1) +
                  ': Unexpected ' +
                  (_ == h
                    ? 'end of input'
                    : "'" + (this.terminals_[_] || _) + "'")),
                this.parseError(R, {
                  text: d.match,
                  token: this.terminals_[_] || _,
                  line: d.yylineno,
                  loc: m,
                  expected: C
                })
            }
            if (g[0] instanceof Array && 1 < g.length)
              throw new Error(
                'Parse Error: multiple actions possible at state: ' +
                  v +
                  ', token: ' +
                  _
              )
            switch (g[0]) {
              case 1:
                n.push(_),
                  o.push(d.yytext),
                  s.push(d.yylloc),
                  n.push(g[1]),
                  (_ = null),
                  (u = d.yyleng),
                  (l = d.yytext),
                  (c = d.yylineno),
                  (m = d.yylloc)
                break
              case 2:
                if (
                  ((w = this.productions_[g[1]][1]),
                  (S.$ = o[o.length - w]),
                  (S._$ = {
                    first_line: s[s.length - (w || 1)].first_line,
                    last_line: s[s.length - 1].last_line,
                    first_column: s[s.length - (w || 1)].first_column,
                    last_column: s[s.length - 1].last_column
                  }),
                  y &&
                    (S._$.range = [
                      s[s.length - (w || 1)].range[0],
                      s[s.length - 1].range[1]
                    ]),
                  void 0 !==
                    (x = this.performAction.apply(
                      S,
                      [l, u, c, p.yy, g[1], o, s].concat(f)
                    )))
                )
                  return x
                w &&
                  ((n = n.slice(0, -1 * w * 2)),
                  (o = o.slice(0, -1 * w)),
                  (s = s.slice(0, -1 * w))),
                  n.push(this.productions_[g[1]][0]),
                  o.push(S.$),
                  s.push(S._$),
                  (w = a[n[n.length - 2]][n[n.length - 1]]),
                  n.push(w)
                break
              case 3:
                return !0
            }
          }
          return !0
        }
      }).lexer = {
        EOF: 1,
        parseError: function (e, t) {
          if (!this.yy.parser) throw new Error(e)
          this.yy.parser.parseError(e, t)
        },
        setInput: function (e, t) {
          return (
            (this.yy = t || this.yy || {}),
            (this._input = e),
            (this._more = this._backtrack = this.done = !1),
            (this.yylineno = this.yyleng = 0),
            (this.yytext = this.matched = this.match = ''),
            (this.conditionStack = ['INITIAL']),
            (this.yylloc = {
              first_line: 1,
              first_column: 0,
              last_line: 1,
              last_column: 0
            }),
            this.options.ranges && (this.yylloc.range = [0, 0]),
            (this.offset = 0),
            this
          )
        },
        input: function () {
          var e = this._input[0]
          return (
            (this.yytext += e),
            this.yyleng++,
            this.offset++,
            (this.match += e),
            (this.matched += e),
            e.match(/(?:\r\n?|\n).*/g)
              ? (this.yylineno++, this.yylloc.last_line++)
              : this.yylloc.last_column++,
            this.options.ranges && this.yylloc.range[1]++,
            (this._input = this._input.slice(1)),
            e
          )
        },
        unput: function (e) {
          var t = e.length,
            r = e.split(/(?:\r\n?|\n)/g)
          ;(this._input = e + this._input),
            (this.yytext = this.yytext.substr(0, this.yytext.length - t)),
            (this.offset -= t)
          var n = this.match.split(/(?:\r\n?|\n)/g)
          ;(this.match = this.match.substr(0, this.match.length - 1)),
            (this.matched = this.matched.substr(0, this.matched.length - 1)),
            r.length - 1 && (this.yylineno -= r.length - 1)
          e = this.yylloc.range
          return (
            (this.yylloc = {
              first_line: this.yylloc.first_line,
              last_line: this.yylineno + 1,
              first_column: this.yylloc.first_column,
              last_column: r
                ? (r.length === n.length ? this.yylloc.first_column : 0) +
                  n[n.length - r.length].length -
                  r[0].length
                : this.yylloc.first_column - t
            }),
            this.options.ranges &&
              (this.yylloc.range = [e[0], e[0] + this.yyleng - t]),
            (this.yyleng = this.yytext.length),
            this
          )
        },
        more: function () {
          return (this._more = !0), this
        },
        reject: function () {
          return this.options.backtrack_lexer
            ? ((this._backtrack = !0), this)
            : this.parseError(
                'Lexical error on line ' +
                  (this.yylineno + 1) +
                  '. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n' +
                  this.showPosition(),
                { text: '', token: null, line: this.yylineno }
              )
        },
        less: function (e) {
          this.unput(this.match.slice(e))
        },
        pastInput: function () {
          var e = this.matched.substr(
            0,
            this.matched.length - this.match.length
          )
          return (20 < e.length ? '...' : '') + e.substr(-20).replace(/\n/g, '')
        },
        upcomingInput: function () {
          var e = this.match
          return (
            e.length < 20 && (e += this._input.substr(0, 20 - e.length)),
            (e.substr(0, 20) + (20 < e.length ? '...' : '')).replace(/\n/g, '')
          )
        },
        showPosition: function () {
          var e = this.pastInput(),
            t = new Array(e.length + 1).join('-')
          return e + this.upcomingInput() + '\n' + t + '^'
        },
        test_match: function (e, t) {
          var r, n
          if (
            (this.options.backtrack_lexer &&
              ((n = {
                yylineno: this.yylineno,
                yylloc: {
                  first_line: this.yylloc.first_line,
                  last_line: this.last_line,
                  first_column: this.yylloc.first_column,
                  last_column: this.yylloc.last_column
                },
                yytext: this.yytext,
                match: this.match,
                matches: this.matches,
                matched: this.matched,
                yyleng: this.yyleng,
                offset: this.offset,
                _more: this._more,
                _input: this._input,
                yy: this.yy,
                conditionStack: this.conditionStack.slice(0),
                done: this.done
              }),
              this.options.ranges &&
                (n.yylloc.range = this.yylloc.range.slice(0))),
            (r = e[0].match(/(?:\r\n?|\n).*/g)) && (this.yylineno += r.length),
            (this.yylloc = {
              first_line: this.yylloc.last_line,
              last_line: this.yylineno + 1,
              first_column: this.yylloc.last_column,
              last_column: r
                ? r[r.length - 1].length -
                  r[r.length - 1].match(/\r?\n?/)[0].length
                : this.yylloc.last_column + e[0].length
            }),
            (this.yytext += e[0]),
            (this.match += e[0]),
            (this.matches = e),
            (this.yyleng = this.yytext.length),
            this.options.ranges &&
              (this.yylloc.range = [this.offset, (this.offset += this.yyleng)]),
            (this._more = !1),
            (this._backtrack = !1),
            (this._input = this._input.slice(e[0].length)),
            (this.matched += e[0]),
            (t = this.performAction.call(
              this,
              this.yy,
              this,
              t,
              this.conditionStack[this.conditionStack.length - 1]
            )),
            this.done && this._input && (this.done = !1),
            t)
          )
            return t
          if (this._backtrack) {
            for (var i in n) this[i] = n[i]
            return !1
          }
          return !1
        },
        next: function () {
          if (this.done) return this.EOF
          var e, t, r, n
          this._input || (this.done = !0),
            this._more || ((this.yytext = ''), (this.match = ''))
          for (var i = this._currentRules(), o = 0; o < i.length; o++)
            if (
              (r = this._input.match(this.rules[i[o]])) &&
              (!t || r[0].length > t[0].length)
            )
              if (((t = r), (n = o), this.options.backtrack_lexer)) {
                if (!1 !== (e = this.test_match(r, i[o]))) return e
                if (!this._backtrack) return !1
                t = !1
              } else if (!this.options.flex) break
          return t
            ? !1 !== (e = this.test_match(t, i[n])) && e
            : '' === this._input
            ? this.EOF
            : this.parseError(
                'Lexical error on line ' +
                  (this.yylineno + 1) +
                  '. Unrecognized text.\n' +
                  this.showPosition(),
                { text: '', token: null, line: this.yylineno }
              )
        },
        lex: function () {
          var e = this.next()
          return e || this.lex()
        },
        begin: function (e) {
          this.conditionStack.push(e)
        },
        popState: function () {
          return 0 < this.conditionStack.length - 1
            ? this.conditionStack.pop()
            : this.conditionStack[0]
        },
        _currentRules: function () {
          return (
            this.conditionStack.length &&
            this.conditionStack[this.conditionStack.length - 1]
              ? this.conditions[
                  this.conditionStack[this.conditionStack.length - 1]
                ]
              : this.conditions.INITIAL
          ).rules
        },
        topState: function (e) {
          return 0 <= (e = this.conditionStack.length - 1 - Math.abs(e || 0))
            ? this.conditionStack[e]
            : 'INITIAL'
        },
        pushState: function (e) {
          this.begin(e)
        },
        stateStackSize: function () {
          return this.conditionStack.length
        },
        options: { 'case-insensitive': !0 },
        performAction: function (e, t, r, n) {
          switch (r) {
            case 0:
              break
            case 1:
              return 20
            case 2:
              return 7
            case 3:
              return 8
            case 4:
              return 9
            case 5:
              return 12
            case 6:
              return 16
            case 7:
              return 14
            case 8:
              return 10
            case 9:
              return 11
            case 10:
              return 19
            case 11:
              return 21
            case 12:
              return '<='
            case 13:
              return '>='
            case 14:
              return '<'
            case 15:
              return '>'
            case 16:
              return (t.yytext = t.yytext.substr(1, t.yyleng - 2)), 24
            case 17:
              return 13
            case 18:
              return 23
            case 19:
              return 5
            case 20:
              return 'INVALID'
          }
        },
        rules: [
          /^(?:\s+)/i,
          /^(?:(-?(?:[1-9][0-9]+|[0-9]))\b)/i,
          /^(?:OR\b)/i,
          /^(?:AND\b)/i,
          /^(?:NOT\b)/i,
          /^(?:((ALL|NONE|HETATM|PROTEIN|BASIC|ACIDIC|CHARGED|POLAR|NONPOLAR|AROMATIC|NUCLEIC|PURINE|PYRIMIDINE|WATER|POLARH|NONPOLARH))\b)/i,
          /^(?:((NAME|ELEM|TYPE|RESIDUE|ICODE|CHAIN|ALTLOC))\b)/i,
          /^(?:((SERIAL|SEQUENCE|RESIDX))\b)/i,
          /^(?:\()/i,
          /^(?:\))/i,
          /^(?:,)/i,
          /^(?::)/i,
          /^(?:<=)/i,
          /^(?:>=)/i,
          /^(?:<)/i,
          /^(?:>)/i,
          /^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,
          /^(?:(@[_A-Z0-9]+))/i,
          /^(?:([_A-Z0-9]+))/i,
          /^(?:$)/i,
          /^(?:.)/i
        ],
        conditions: {
          INITIAL: {
            rules: [
              0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
              19, 20
            ],
            inclusive: !0
          }
        }
      }),
      new ((et.prototype = Aa).Parser = et)())
  }
  function rt(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var nt = (function () {
      function r(e, t) {
        G(this, r), (this.min = e), (this.max = void 0 === t ? e : t)
      }
      return (
        p(r, [
          {
            key: 'includes',
            value: function (e) {
              return this.min <= e && e <= this.max
            }
          },
          {
            key: 'toString',
            value: function () {
              var e = this.min,
                t = this.max
              return e === t ? String(e) : [e, t].join(':')
            }
          },
          {
            key: 'toJSON',
            value: function () {
              return [this.min, this.max]
            }
          }
        ]),
        r
      )
    })(),
    it = (function () {
      function t(e) {
        if ((G(this, t), e instanceof this.constructor)) return e
        e instanceof Array
          ? (this._values = e.slice(0))
          : (this._values = e ? [e] : [])
      }
      return (
        p(t, [
          {
            key: 'append',
            value: function (e) {
              var t = this._values
              return (t[t.length] = e), this
            }
          },
          {
            key: 'remove',
            value: function (e) {
              var t = this._values,
                e = t.indexOf(e)
              return 0 <= e && t.splice(e, 1), this
            }
          },
          {
            key: 'toString',
            value: function () {
              return this._values.join(',')
            }
          },
          {
            key: 'toJSON',
            value: function () {
              for (
                var e = this._values, t = [], r = 0, n = e.length;
                r < n;
                ++r
              ) {
                var i = e[r]
                t[r] = i.toJSON ? i.toJSON() : i
              }
              return t
            }
          }
        ]),
        t
      )
    })(),
    ot = (function () {
      x(t, it)
      var e = rt(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: 'includes',
            value: function (e) {
              for (var t = this._values, r = 0, n = t.length; r < n; ++r)
                if (t[r].includes(e)) return !0
              return !1
            }
          }
        ]),
        t
      )
    })(),
    st = [],
    at = (function () {
      x(l, it)
      var a = rt(l)
      function l(e, t) {
        var r
        G(this, l)
        e = r = a.call(this, e)
        if (t) {
          r.upperOnly = !0
          for (var n = e._values, i = 0, o = n.length; i < o; ++i) {
            var s = n[i]
            'string' == typeof s && (n[i] = s.toUpperCase())
          }
        } else r.upperOnly = !1
        return R(r, e)
      }
      return (
        p(l, [
          {
            key: 'includes',
            value: function (e) {
              return -1 !== this._values.indexOf(e)
            }
          },
          {
            key: 'toString',
            value: function () {
              for (
                var e = this._values, t = (st.length = 0), r = e.length;
                t < r;
                ++t
              )
                st[t] = le.correctSelectorIdentifier(String(e[t]))
              return st.join(',')
            }
          },
          {
            key: '_validate',
            value: function (e) {
              return this.upperOnly && 'string' == typeof e
                ? e.toUpperCase()
                : e
            }
          },
          {
            key: 'append',
            value: function (e) {
              return (
                Xe(C(l.prototype), 'append', this).call(
                  this,
                  this._validate(e)
                ),
                this
              )
            }
          },
          {
            key: 'remove',
            value: function (e) {
              return (
                Xe(C(l.prototype), 'remove', this).call(
                  this,
                  this._validate(e)
                ),
                this
              )
            }
          }
        ]),
        l
      )
    })()
  function lt(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ct = (function () {
    function e() {
      G(this, e)
    }
    return (
      p(e, [
        {
          key: 'toString',
          value: function () {
            return this.keyword
          }
        },
        {
          key: 'toJSON',
          value: function () {
            return [this.name]
          }
        }
      ]),
      e
    )
  })()
  ;(ct.prototype.name = 'Error'), (ct.prototype.keyword = 'error')
  var ut = (function () {
      x(n, ct)
      var r = lt(n)
      function n(e) {
        var t
        return G(this, n), ((t = r.call(this)).list = e), t
      }
      return (
        p(n, [
          {
            key: 'toString',
            value: function () {
              return ''.concat(this.keyword, ' ').concat(this.list)
            }
          },
          {
            key: 'toJSON',
            value: function () {
              return [this.name, this.list.toJSON()]
            }
          }
        ]),
        n
      )
    })(),
    ht = (function () {
      x(r, ut)
      var t = lt(r)
      function r(e) {
        return G(this, r), t.call(this, new ot(e))
      }
      return p(r)
    })(),
    ft = (function () {
      x(n, ut)
      var r = lt(n)
      function n(e, t) {
        return G(this, n), r.call(this, new at(e, !t))
      }
      return p(n)
    })(),
    dt = (function () {
      x(t, ct)
      var e = lt(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: 'includesAtom',
            value: function (e) {
              return !1
            }
          }
        ]),
        t
      )
    })()
  ;(dt.prototype.name = 'None'), (dt.prototype.keyword = 'none')
  var pt = (function () {
    x(t, ct)
    var e = lt(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'includesAtom',
          value: function (e) {
            return !0
          }
        }
      ]),
      t
    )
  })()
  function mt(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(pt.prototype.name = 'All'), (pt.prototype.keyword = 'all')
  var yt = new dt(),
    _t = (function () {
      x(n, ct)
      var r = mt(n)
      function n(e) {
        var t
        return G(this, n), ((t = r.call(this)).rhs = e || yt), t
      }
      return (
        p(n, [
          {
            key: 'toString',
            value: function () {
              var e =
                this.rhs.priority && this.rhs.priority > this.priority
                  ? '('.concat(this.rhs, ')')
                  : this.rhs
              return ''.concat(this.keyword, ' ').concat(e)
            }
          },
          {
            key: 'toJSON',
            value: function () {
              return [this.name, this.rhs.toJSON()]
            }
          }
        ]),
        n
      )
    })()
  _t.prototype.priority = 1
  var vt = (function () {
    x(i, ct)
    var n = mt(i)
    function i(e, t) {
      var r
      return (
        G(this, i), ((r = n.call(this)).lhs = e || yt), (r.rhs = t || yt), r
      )
    }
    return (
      p(i, [
        {
          key: 'toString',
          value: function () {
            var e =
                this.lhs.priority && this.lhs.priority > this.priority
                  ? '('.concat(this.lhs, ')')
                  : this.lhs,
              t =
                this.rhs.priority && this.rhs.priority > this.priority
                  ? '('.concat(this.rhs, ')')
                  : this.rhs
            return ''.concat(e, ' ').concat(this.keyword, ' ').concat(t)
          }
        },
        {
          key: 'toJSON',
          value: function () {
            return [this.name, this.lhs.toJSON(), this.rhs.toJSON()]
          }
        }
      ]),
      i
    )
  })()
  function gt(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  vt.prototype.priority = 1e3
  var xt = {}
  function bt(e, n) {
    var t = e.toLowerCase()
    ;(n.prototype.keyword = t), (n.prototype.name = e)
    function r() {
      for (var e = arguments.length, t = new Array(e), r = 0; r < e; r++)
        t[r] = arguments[r]
      return A(n, t)
    }
    return (r.SelectorClass = n), (xt[t] = r), n
  }
  bt(
    'Serial',
    (function () {
      x(t, ht)
      var e = gt(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: 'includesAtom',
            value: function (e) {
              return this.list.includes(e.serial)
            }
          }
        ]),
        t
      )
    })()
  ),
    bt(
      'Name',
      (function () {
        x(t, ft)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(e.name)
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'AltLoc',
      (function () {
        x(t, ft)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(String.fromCharCode(e.location))
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'Elem',
      (function () {
        x(t, ft)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(e.element.name)
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'Residue',
      (function () {
        x(t, ft)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(e.residue._type._name)
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'Sequence',
      (function () {
        x(t, ht)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(e.residue._sequence)
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'ICode',
      (function () {
        x(r, ft)
        var t = gt(r)
        function r(e) {
          return G(this, r), t.call(this, e, !0)
        }
        return (
          p(r, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(e.residue._icode)
              }
            }
          ]),
          r
        )
      })()
    ),
    bt(
      'ResIdx',
      (function () {
        x(t, ht)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(e.residue._index)
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'Chain',
      (function () {
        x(r, ft)
        var t = gt(r)
        function r(e) {
          return G(this, r), t.call(this, e, !0)
        }
        return (
          p(r, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.list.includes(e.residue._chain._name)
              }
            }
          ]),
          r
        )
      })()
    ),
    bt(
      'Hetatm',
      (function () {
        x(t, ct)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return e.het
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'PolarH',
      (function () {
        x(t, ct)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return (e.flags & we.Flags.NONPOLARH) === we.Flags.HYDROGEN
              }
            }
          ]),
          t
        )
      })()
    ),
    bt(
      'NonPolarH',
      (function () {
        x(t, ct)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return (e.flags & we.Flags.NONPOLARH) === we.Flags.NONPOLARH
              }
            }
          ]),
          t
        )
      })()
    ),
    bt('All', pt),
    bt('None', dt)
  var wt = xt.none()
  function St(e, t, r) {
    return (r.prototype.priority = t), bt(e, r)
  }
  function Rt(r, e) {
    return bt(
      e,
      (function () {
        x(t, ct)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return 0 != (e.residue._type.flags & r)
              }
            }
          ]),
          t
        )
      })()
    )
  }
  St(
    'Not',
    1,
    (function () {
      x(t, _t)
      var e = gt(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: 'includesAtom',
            value: function (e) {
              return !this.rhs.includesAtom(e)
            }
          }
        ]),
        t
      )
    })()
  ),
    St(
      'And',
      2,
      (function () {
        x(t, vt)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.lhs.includesAtom(e) && this.rhs.includesAtom(e)
              }
            }
          ]),
          t
        )
      })()
    ),
    St(
      'Or',
      3,
      (function () {
        x(t, vt)
        var e = gt(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: 'includesAtom',
              value: function (e) {
                return this.lhs.includesAtom(e) || this.rhs.includesAtom(e)
              }
            }
          ]),
          t
        )
      })()
    ),
    Rt(Le.Flags.PROTEIN, 'Protein'),
    Rt(Le.Flags.BASIC, 'Basic'),
    Rt(Le.Flags.ACIDIC, 'Acidic'),
    Rt(Le.Flags.BASIC | Le.Flags.ACIDIC, 'Charged'),
    Rt(Le.Flags.POLAR, 'Polar'),
    Rt(Le.Flags.NONPOLAR, 'NonPolar'),
    Rt(Le.Flags.AROMATIC, 'Aromatic'),
    Rt(Le.Flags.NUCLEIC, 'Nucleic'),
    Rt(Le.Flags.PURINE, 'Purine'),
    Rt(Le.Flags.PYRIMIDINE, 'Pyrimidine'),
    Rt(Le.Flags.WATER, 'Water')
  var Ct = Object.create(xt)
  ;(Ct.Selector = ct),
    (Ct.RangeListSelector = ht),
    (Ct.ValueListSelector = ft),
    (Ct.Range = nt),
    (Ct.RangeList = ot),
    (Ct.ValueList = at),
    (Ct.PrefixOperator = _t),
    (Ct.InfixOperator = vt),
    (Ct.Context = Object.create({})),
    (Ct.GetSelector = function (e) {
      if (Ct.Context.hasOwnProperty(e)) return Ct.Context[e] || wt
      throw { message: 'selector '.concat(e, ' is not registered') }
    }),
    (Ct.ClearContext = function () {
      Object.keys(Ct.Context).forEach(function (e) {
        delete Ct.Context[e]
      })
    }),
    (Ct.keyword = function (e) {
      return xt[e.toLowerCase()] || xt.none
    }),
    (Ct.parse = function (e) {
      var t = {}
      try {
        t.selector = tt.parser.parse(e)
      } catch (e) {
        ;(t.selector = wt), (t.error = e.message)
      }
      return t
    }),
    (tt.parser.yy = Ct),
    (tt.parser.yy.parseError = tt.parser.parseError)
  var At = (function () {
    function t(e) {
      G(this, t),
        (this._complex = e),
        (this._selector = Ct.keyword('All')()),
        (this._boundaries = {
          boundingBox: new ae.Box3(),
          boundingSphere: new ae.Sphere()
        })
    }
    return (
      p(t, [
        {
          key: 'computeBoundaries',
          value: function () {
            var e = this._complex._atoms,
              t = e.length,
              r = this._selector,
              n = this._boundaries.boundingBox
            if ((n.makeEmpty(), 1 === t)) {
              n.expandByPoint(e[0].position)
              var i = new ae.Vector3()
              n.getCenter(i)
              var o = 2 * e[0].element.radius
              n.setFromCenterAndSize(i, new ae.Vector3(o, o, o))
            } else
              for (var s = 0; s < t; ++s)
                r.includesAtom(e[s]) && n.expandByPoint(e[s].position)
            var a = 0,
              l = new ae.Vector3()
            if ((n.getCenter(l), 1 === t))
              this._boundaries.boundingSphere.set(l, e[0].element.radius)
            else {
              for (var c, u = 0; u < t; ++u)
                r.includesAtom(e[u]) &&
                  ((c = e[u].position),
                  a < (c = l.distanceToSquared(c)) && (a = c))
              this._boundaries.boundingSphere.set(l, Math.sqrt(a))
            }
          }
        },
        {
          key: 'getTransforms',
          value: function () {
            return []
          }
        },
        {
          key: 'getSelector',
          value: function () {
            return this._selector
          }
        },
        {
          key: 'getBoundaries',
          value: function () {
            return this._boundaries
          }
        },
        { key: 'finalize', value: function () {} }
      ]),
      t
    )
  })()
  function Et(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var kt = (function () {
      x(l, At)
      var t = Et(l)
      function l(e) {
        return (
          G(this, l), ((e = t.call(this, e)).chains = []), (e.matrices = []), e
        )
      }
      return (
        p(l, [
          {
            key: 'computeBoundaries',
            value: function () {
              Xe(C(l.prototype), 'computeBoundaries', this).call(this)
              var e = this.matrices,
                t = this._boundaries.boundingSphere.center,
                r = this._boundaries.boundingSphere.radius,
                n = (this._boundaries.boundingBox = new ae.Box3())
              n.makeEmpty()
              for (var i = 0, o = e.length; i < o; ++i)
                n.expandByPoint(t.clone().applyMatrix4(e[i]))
              var s = n.max.distanceTo(n.min) / 2 + r,
                a = new ae.Vector3()
              n.getCenter(a),
                (this._boundaries.boundingSphere = new ae.Sphere().set(a, s)),
                n.max.addScalar(r),
                n.min.subScalar(r)
            }
          },
          {
            key: 'addChain',
            value: function (e) {
              this.chains[this.chains.length] = e
            }
          },
          {
            key: 'addMatrix',
            value: function (e) {
              this.matrices[this.matrices.length] = e
            }
          },
          {
            key: 'getTransforms',
            value: function () {
              return this.matrices
            }
          },
          {
            key: 'finalize',
            value: function () {
              0 < this.chains.length
                ? (this._selector = Ct.keyword('Chain')(this.chains))
                : (this._selector = Ct.keyword('None')())
            }
          }
        ]),
        l
      )
    })(),
    Tt = (function () {
      function t(e) {
        G(this, t),
          (this._complex = e),
          (this._index = -1),
          (this._residueIndices = []),
          (this._cycles = []),
          (this._subDivs = []),
          (this._residueCount = 0)
      }
      return (
        p(t, [
          {
            key: 'getResidues',
            value: function () {
              return this._complex._residues
            }
          },
          {
            key: 'getResidueCount',
            value: function () {
              return this._residueCount
            }
          },
          {
            key: 'forEachResidue',
            value: function (e) {
              for (
                var t = this._complex._residues,
                  r = this._residueIndices,
                  n = 0,
                  i = r.length;
                n < i;
                ++n
              )
                for (var o = r[n].start, s = r[n].end; o <= s; ++o) e(t[o])
            }
          },
          {
            key: 'setSubDivs',
            value: function (e) {
              for (
                var t,
                  r,
                  n = 0,
                  i = [],
                  o = 0,
                  s = 0,
                  a = (this._subDivs = e).length;
                s < a;
                ++s
              )
                (s !== a - 1 && e[s].end + 1 === e[s + 1].start) ||
                  ((t = e[n].start),
                  (r = e[s].end),
                  (i[i.length] = { start: t, end: r }),
                  (o += r - t + 1),
                  (n = s + 1))
              ;(this._residueIndices = i), (this._residueCount = o)
            }
          },
          {
            key: 'getComplex',
            value: function () {
              return this._complex
            }
          },
          {
            key: 'forEachBond',
            value: function (e) {
              for (
                var t = this._complex._bonds, r = 0, n = t.length;
                r < n;
                ++r
              ) {
                var i = t[r]
                i._left.residue._component === this && e(i)
              }
            }
          },
          {
            key: 'update',
            value: function () {
              this.forEachCycle(function (e) {
                e.update()
              })
            }
          },
          {
            key: 'forEachAtom',
            value: function (t) {
              this.forEachResidue(function (e) {
                e.forEachAtom(t)
              })
            }
          },
          {
            key: 'addCycle',
            value: function (e) {
              this._cycles.push(e)
            }
          },
          {
            key: 'forEachCycle',
            value: function (e) {
              for (var t = this._cycles, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'markResidues',
            value: function () {
              var t = this
              t.forEachResidue(function (e) {
                e._component = t
              })
            }
          },
          {
            key: '_forEachSubChain',
            value: function (e, t) {
              for (
                var r = this._complex._residues,
                  n = this._subDivs,
                  i = 0,
                  o = n.length;
                i < o;
                ++i
              )
                for (var s = n[i].start, a = n[i].end; s <= a; ++s) {
                  var l = r[s]
                  if (e & l._mask && l._isValid) {
                    for (var c = s + 1; c <= a; ++c) {
                      var u = r[c]
                      if (!(e & u._mask && u._isValid)) break
                    }
                    t(i, s, c - 1), (s = c)
                  }
                }
            }
          },
          {
            key: 'getMaskedSequences',
            value: function (e) {
              var n = [],
                i = 0
              return (
                this._forEachSubChain(e, function (e, t, r) {
                  n[i++] = { start: t, end: r }
                }),
                n
              )
            }
          },
          {
            key: 'getMaskedSubdivSequences',
            value: function (e) {
              var n = [],
                i = -1,
                o = -1,
                s = this._subDivs
              return (
                this._forEachSubChain(e, function (e, t, r) {
                  o !== e &&
                    ((n[++i] = { arr: [], boundaries: s[e] }), (o = e)),
                    (n[i].arr[n[i].arr.length] = { start: t, end: r })
                }),
                n
              )
            }
          }
        ]),
        t
      )
    })(),
    Pt = 1048576,
    Mt = (function () {
      function n(e) {
        G(this, n),
          (this.numPairs = 0),
          (this.numMaxPairs = e),
          (this.intBuffer = le.allocateTyped(Int32Array, 4 * e))
        for (var t = 0; t < 4 * e; t++) this.intBuffer[t] = -1
        this.hashBuffer = le.allocateTyped(Int32Array, 32 * Pt)
        for (var r = 0; r < 32 * Pt; r++) this.hashBuffer[r] = -1
      }
      return (
        p(n, [
          {
            key: 'destroy',
            value: function () {
              ;(this.intBuffer = null), (this.hashBuffer = null)
            }
          },
          {
            key: 'addPair',
            value: function (e, t) {
              for (
                var r = e < t ? e : t,
                  t = t < e ? e : t,
                  n = r + (t << 14),
                  i = 32 * ((r + 89237 * t) & (Pt - 1)),
                  o = 0;
                o < 32;
                o++
              ) {
                var s = this.hashBuffer[i + o]
                if (-1 === s) break
                if (s === n) return !1
              }
              if (32 <= o)
                throw new Error('addPair: increase cMaxPairsForHashCode')
              if (
                ((this.hashBuffer[i + o] = n),
                this.numPairs >= this.numMaxPairs)
              )
                throw new Error('addPair: increase num pairs')
              return (
                (i = 4 * this.numPairs),
                (this.intBuffer[i] = r),
                (this.intBuffer[i + 1] = t),
                (this.intBuffer[i + 2] = n),
                this.numPairs++,
                !0
              )
            }
          }
        ]),
        n
      )
    })()
  function Nt(e) {
    e = e.element
    if (e) return e.radiusBonding
    throw new Error('_getBondingRadius: Logic error.')
  }
  var Lt,
    It,
    Ot,
    Bt = (function () {
      function t(e) {
        G(this, t), (this._complex = e), (this._maxRad = 1.8)
        e = this._complex.getDefaultBoundaries().boundingBox
        ;(this._vBoxMin = e.min.clone()),
          (this._vBoxMax = e.max.clone()),
          (this._pairCollection = null)
      }
      return (
        p(t, [
          {
            key: '_addExistingPairs',
            value: function () {
              for (
                var e = this._complex.getAtoms(),
                  t = e.length,
                  r = 0,
                  n = this._pairCollection;
                r < t;
                r++
              )
                for (var i = e[r].bonds, o = i.length, s = 0; s < o; s++) {
                  var a = i[s]
                  a._left.index === r && n.addPair(r, a._right.index)
                }
              return 0
            }
          },
          {
            key: '_findPairs',
            value: function () {
              var e = this._complex.getVoxelWorld()
              if (null !== e)
                for (
                  var n,
                    i,
                    o,
                    s,
                    a,
                    t,
                    r = this._complex._atoms,
                    l = r.length,
                    c = this,
                    u = function (e) {
                      var t, r
                      ;(i && e.isHydrogen()) ||
                        ((r = e.location),
                        (32 !== s && 32 !== r && s !== r) ||
                          ((t = o.distanceToSquared(e.position)),
                          (r = e.element.radiusBonding),
                          (r = n + r + 0.45) * r < t ||
                            t < 0.001 ||
                            c._pairCollection.addPair(a.index, e.index)))
                    },
                    h = 0;
                  h < l;
                  ++h
                )
                  (a = r[h]),
                    (!(t = a).isHet() || (t.bonds && 0 === t.bonds.length)) &&
                      ((n = a.element.radiusBonding),
                      (i = a.isHydrogen()),
                      (o = a.position),
                      (s = a.location),
                      e.forEachAtomWithinRadius(o, 2 * this._maxRad + 0.45, u))
            }
          },
          {
            key: '_addPairs',
            value: function () {
              for (
                var e = this._complex._atoms, t = 0, r = 0;
                t < this._pairCollection.numPairs;
                t++, r += 4
              ) {
                var n = this._pairCollection.intBuffer[r],
                  i = this._pairCollection.intBuffer[r + 1]
                this._addPair(e[n], e[i])
              }
            }
          },
          {
            key: '_addPair',
            value: function (e, t) {
              for (
                var r = e.bonds, n = e.index, i = t.index, o = 0, s = r.length;
                o < s;
                ++o
              ) {
                var a = r[o]
                if (a._left.index === i || a._right.index === i) return
              }
              e = this._complex.addBond(
                n < i ? e : t,
                n < i ? t : e,
                0,
                Ae.BondType.UNKNOWN,
                !1
              )
              r.push(e), t.bonds.push(e)
            }
          },
          {
            key: 'build',
            value: function () {
              this._buildInner()
            }
          },
          {
            key: '_buildInner',
            value: function () {
              var e = this._complex._atoms
              if (!(e.length < 2)) {
                if (e[0].index < 0)
                  throw new Error(
                    'AutoBond: Atoms in complex were not indexed.'
                  )
                this._calcBoundingBox(),
                  (this._pairCollection = new Mt(4 * e.length)),
                  this._addExistingPairs(),
                  this._findPairs(),
                  this._addPairs()
              }
            }
          },
          {
            key: '_calcBoundingBox',
            value: function () {
              for (
                var e = this._complex._atoms, t = e.length, r = Nt(e[0]), n = 1;
                n < t;
                ++n
              )
                r = Math.max(r, Nt(e[n]))
              this._vBoxMax.addScalar(r),
                this._vBoxMin.addScalar(-r),
                (this._maxRad = 1.2 * r)
            }
          },
          {
            key: 'destroy',
            value: function () {
              this._pairCollection && this._pairCollection.destroy()
            }
          }
        ]),
        t
      )
    })(),
    Vt = Ae.BondType.AROMATIC,
    Dt = [Se.ByName.C.number, Se.ByName.N.number],
    zt =
      ((Lt = new ae.Vector3()),
      (It = new ae.Vector3()),
      (Ot = new ae.Vector3()),
      function (e, t) {
        return (
          Lt.copy(e).normalize(),
          It.copy(t).normalize(),
          Ot.crossVectors(Lt, It),
          !(0.1 < Ot.length()) && 0 <= Lt.dot(It)
        )
      })
  function Ft(e, t) {
    for (var r = 0; r < e.length && e[r] < t; ) ++r
    e.splice(r, 0, t)
  }
  function Ut(e, t) {
    return e._left === t ? e._right : e._left
  }
  function Gt(e) {
    e._type = Vt
  }
  var jt = (function () {
    function t(e) {
      G(this, t), (this.atoms = e), this.update()
    }
    return (
      p(t, [
        {
          key: 'update',
          value: function () {
            for (
              var e = this.atoms, t = new ae.Vector3(), r = e.length, n = 0;
              n < r;
              ++n
            )
              t.add(e[n].position)
            t.multiplyScalar(1 / r),
              (this.center = t),
              (this.radius = t.distanceTo(
                e[0].position.clone().lerp(e[1].position, 0.5)
              ))
          }
        },
        {
          key: 'forEachBond',
          value: function (t) {
            var r,
              e = this.atoms,
              n = e.length,
              i = e[0]
            function o(e) {
              ;(e._left !== r && e._right !== r) || t(e)
            }
            for (var s = 0; s < n; ++s)
              (r = e[(s + 1) % n]), i.forEachBond(o), (i = r)
          }
        }
      ]),
      t
    )
  })()
  function Ht(e) {
    return e._type === Vt
  }
  function Wt(e) {
    if (e.type === Vt) return !0
    var t = Dt.indexOf(e._right.element.number),
      e = Dt.indexOf(e._left.element.number)
    return -1 !== t && -1 !== e
  }
  function Yt(e) {
    return 3 < e.length
  }
  function Xt(e) {
    return !0
  }
  var qt = (function () {
    function o(e) {
      G(this, o), (this._complex = e)
      for (
        var t = new Array(e._bonds.length),
          r = new Array(e._bonds.length),
          n = 0,
          i = t.length;
        n < i;
        ++n
      )
        (t[n] = []), (r[n] = !1)
      ;(this._bondsData = t), (this._bondMarks = r), this._resetCycles()
    }
    return (
      p(o, [
        {
          key: '_resetCycles',
          value: function () {
            ;(this._cycles = []), (this._currIdx = -1)
          }
        },
        {
          key: '_haveSameCycle',
          value: function (e, t, r) {
            for (
              var n = e[t._index],
                i = e[r._index],
                o = n.length,
                s = i.length,
                a = 0,
                l = 0;
              a < o && l < s;

            ) {
              if (n[a] === i[l]) return !0
              n[a] > i[l] ? ++l : ++a
            }
            return !1
          }
        },
        {
          key: '_tryBond',
          value: function (s, a, l) {
            var c = [],
              u = this._bondsData,
              e = Ut(s, a),
              h = a.position.clone().sub(e.position),
              f = this._currStart,
              d = this,
              p = this._bondMarks,
              m = this._checkBond
            ;(p[s._index] = !0),
              (m = void 0 === m ? Ht : m),
              a.forEachBond(function (e) {
                if (
                  m(e) &&
                  e !== s &&
                  !p[e._index] &&
                  !d._haveSameCycle(u, s, e)
                ) {
                  var t,
                    r = Ut(e, a),
                    n = r.position.clone().sub(a.position),
                    i =
                      r === f
                        ? -2
                        : 1 -
                          ((t = n),
                          (t =
                            (r = h).dot(t) /
                            Math.sqrt(r.lengthSq() * t.lengthSq())),
                          ae.MathUtils.clamp(t, -1, 1)),
                    n = n.cross(h)
                  if (zt(n, l)) {
                    for (var o = 0; o < c.length && c[o].val < i; ) ++o
                    c.splice(o, 0, { bond: e, val: i, dir: n })
                  }
                }
              })
            for (var t = 0, r = c.length; t < r; ++t) {
              var n = c[t].bond,
                i = n._left === a ? n._right : n._left
              if (i === f)
                return (
                  ++this._currIdx, this._cycles.push([a]), !(p[s._index] = !1)
                )
              if (this._tryBond(n, i, c[t].dir))
                return (
                  Ft(u[n._index], this._currIdx),
                  this._cycles[this._currIdx].push(a),
                  !(p[s._index] = !1)
                )
            }
            return (p[s._index] = !1)
          }
        },
        {
          key: '_startCycle',
          value: function (e) {
            ;(this._currStart = e._left),
              this._tryBond(e, e._right, new ae.Vector3()) &&
                (Ft(this._bondsData[e._index], this._currIdx),
                this._cycles[this._currIdx].push(e._left))
          }
        },
        {
          key: '_findLoops',
          value: function (o, s) {
            this._checkBond = o
            var e = this._complex,
              a = this
            e.forEachComponent(function (e) {
              a._resetCycles(),
                e.forEachBond(function (e) {
                  o(e) && a._startCycle(e)
                })
              for (var t = a._cycles, r = 0, n = t.length; r < n; ++r) {
                var i = t[r]
                s(i) && ((i = new jt(i)).forEachBond(Gt), e.addCycle(i))
              }
            })
          }
        },
        {
          key: 'markCycles',
          value: function () {
            this._findLoops(Ht, Yt)
          }
        },
        {
          key: 'detectCycles',
          value: function () {
            this._findLoops(Wt, Xt)
          }
        }
      ]),
      o
    )
  })()
  var $t = (function () {
    function k(e, t) {
      G(this, k), (this._box = e.clone())
      var r = new ae.Vector3()
      e.getSize(r),
        (this._count = r
          .clone()
          .divide(t)
          .floor()
          .max(new ae.Vector3(1, 1, 1))),
        (this._last = this._count.clone().subScalar(1)),
        (this._cellSize = r.clone().divide(this._count)),
        (this._cellInnerR =
          0.5 *
          Math.min(
            Math.min(this._cellSize.x, this._cellSize.y),
            this._cellSize.z
          )),
        (this._cellOuterR = 0.5 * Math.sqrt(this._cellSize.dot(this._cellSize)))
      var n = this._count.x * this._count.y * this._count.z
      this._voxels = le.allocateTyped(Int32Array, n)
      for (var i = 0; i < n; ++i) this._voxels[i] = -1
      this._atoms = []
    }
    return (
      p(k, [
        {
          key: 'addAtoms',
          value: function (e) {
            var r = this,
              n = this._atoms.length
            ;(this._atoms.length += 2 * e.getAtomCount()),
              e.forEachAtom(function (e) {
                var t = r._findVoxel(e.position)
                ;(r._atoms[n] = e),
                  (r._atoms[n + 1] = r._voxels[t]),
                  (r._voxels[t] = n),
                  (n += 2)
              })
          }
        },
        {
          key: '_findVoxel',
          value: function (e) {
            var t = k._zero,
              r = k._voxel
            return (
              r
                .copy(e)
                .sub(this._box.min)
                .divide(this._cellSize)
                .floor()
                .clamp(t, this._last),
              r.x + this._count.x * (r.y + this._count.y * r.z)
            )
          }
        },
        {
          key: '_forEachAtomInVoxel',
          value: function (e, t) {
            for (var r = this._voxels[e]; 0 <= r; r = this._atoms[r + 1])
              t(this._atoms[r])
          }
        },
        {
          key: '_forEachVoxelWithinRadius',
          value: function (e, t, r) {
            var n,
              i,
              o,
              s,
              a,
              l = k._xRange,
              c = k._yRange,
              u = k._zRange
            if (t / this._cellInnerR < 10)
              this._forEachVoxelWithinRadiusSimple(e, t, r)
            else {
              u.set(e.z - t, e.z + t),
                u
                  .subScalar(this._box.min.z)
                  .divideScalar(this._cellSize.z)
                  .floor()
                  .clampScalar(0, this._count.z - 1)
              for (
                var h, f, d, p, m, y, _, v, g, x, b, w, S, R, C = u.x;
                C <= u.y;
                ++C
              ) {
                ;(v = [
                  this._box.min.z + C * this._cellSize.z,
                  this._box.min.z + (C + 1) * this._cellSize.z
                ]),
                  (a = e.z - t <= v[0] && v[1] <= e.z + t),
                  (g = t),
                  (b = v[1]),
                  (w = S = w = R = S = w = void 0),
                  (w = (x = v[0]) - (v = e).z),
                  (S = b - v.z),
                  (R = Math.sqrt(Math.max(g * g - w * w, 0))),
                  (w = Math.sqrt(Math.max(g * g - S * S, 0))),
                  (S = Math.min(R, w)),
                  (w = x <= v.z && b >= v.z ? g : Math.max(R, w)),
                  c.set(e.y - (n = [S, w])[1], e.y + n[1]),
                  c
                    .subScalar(this._box.min.y)
                    .divideScalar(this._cellSize.y)
                    .floor()
                    .clampScalar(0, this._count.y - 1)
                for (var A = c.x; A <= c.y; ++A) {
                  ;(h = [
                    this._box.min.y + A * this._cellSize.y,
                    this._box.min.y + (A + 1) * this._cellSize.y
                  ]),
                    (s = e.y - n[0] <= h[0] && h[1] <= e.y + n[0]),
                    (f = n[1]),
                    (p = h[1]),
                    (m = y = m = _ = y = m = void 0),
                    (m = (d = h[0]) - (h = e).y),
                    (y = p - h.y),
                    (_ = Math.sqrt(Math.max(f * f - m * m, 0))),
                    (m = Math.sqrt(Math.max(f * f - y * y, 0))),
                    (y = Math.min(_, m)),
                    (m = d <= h.y && p >= h.y ? f : Math.max(_, m)),
                    l.set(e.x - (i = [y, m])[1], e.x + i[1]),
                    l
                      .subScalar(this._box.min.x)
                      .divideScalar(this._cellSize.x)
                      .floor()
                      .clampScalar(0, this._count.x - 1)
                  for (var E = l.x; E <= l.y; ++E)
                    (o = [
                      this._box.min.x + E * this._cellSize.x,
                      this._box.min.x + (E + 1) * this._cellSize.x
                    ]),
                      (o = e.x - i[0] <= o[0] && o[1] <= e.x + i[0]),
                      r(
                        E + this._count.x * (A + this._count.y * C),
                        o && s && a
                      )
                }
              }
            }
          }
        },
        {
          key: '_forEachVoxelWithinRadiusSimple',
          value: function (e, t, r) {
            var n = k._xRange,
              i = k._yRange,
              o = k._zRange,
              s = k._vCenter,
              a = (t + this._cellOuterR) * (t + this._cellOuterR),
              l = -1
            t > this._cellOuterR &&
              (l = (t - this._cellOuterR) * (t - this._cellOuterR)),
              n.set(e.x - t, e.x + t),
              n
                .subScalar(this._box.min.x)
                .divideScalar(this._cellSize.x)
                .floor(),
              (n.x = Math.min(Math.max(n.x, 0), this._count.x - 1)),
              (n.y = Math.min(Math.max(n.y, 0), this._count.x - 1)),
              i.set(e.y - t, e.y + t),
              i
                .subScalar(this._box.min.y)
                .divideScalar(this._cellSize.y)
                .floor(),
              (i.x = Math.min(Math.max(i.x, 0), this._count.y - 1)),
              (i.y = Math.min(Math.max(i.y, 0), this._count.y - 1)),
              o.set(e.z - t, e.z + t),
              o
                .subScalar(this._box.min.z)
                .divideScalar(this._cellSize.z)
                .floor(),
              (o.x = Math.min(Math.max(o.x, 0), this._count.z - 1)),
              (o.y = Math.min(Math.max(o.y, 0), this._count.z - 1))
            for (var c = o.x; c <= o.y; ++c) {
              var u = [
                this._box.min.z + c * this._cellSize.z,
                this._box.min.z + (c + 1) * this._cellSize.z
              ]
              s.z = 0.5 * (u[0] + u[1])
              for (var h = i.x; h <= i.y; ++h) {
                var f = [
                  this._box.min.y + h * this._cellSize.y,
                  this._box.min.y + (h + 1) * this._cellSize.y
                ]
                s.y = 0.5 * (f[0] + f[1])
                for (var d = n.x; d <= n.y; ++d) {
                  var p = [
                    this._box.min.x + d * this._cellSize.x,
                    this._box.min.x + (d + 1) * this._cellSize.x
                  ]
                  s.x = 0.5 * (p[0] + p[1])
                  p = e.distanceToSquared(s)
                  p <= a &&
                    r(d + this._count.x * (h + this._count.y * c), p <= l)
                }
              }
            }
          }
        },
        {
          key: 'forEachAtomWithinRadius',
          value: function (r, e, n) {
            var i = this,
              o = e * e
            i._forEachVoxelWithinRadius(r, e, function (e, t) {
              t
                ? i._forEachAtomInVoxel(e, n)
                : i._forEachAtomInVoxel(e, function (e) {
                    r.distanceToSquared(e.position) <= o && n(e)
                  })
            })
          }
        },
        {
          key: 'forEachAtomWithinDistFromMasked',
          value: function (e, r, t, n) {
            this._forEachAtomWithinDistFromGroup(
              function (t) {
                e.forEachAtom(function (e) {
                  0 != (e.mask & r) && t(e)
                })
              },
              t,
              n
            )
          }
        },
        {
          key: 'forEachAtomWithinDistFromSelected',
          value: function (e, r, t, n) {
            this._forEachAtomWithinDistFromGroup(
              function (t) {
                e.forEachAtom(function (e) {
                  r.includesAtom(e) && t(e)
                })
              },
              t,
              n
            )
          }
        },
        {
          key: '_forEachAtomWithinDistFromGroup',
          value: function (e, t, r) {
            var n,
              i = this,
              o = t * t,
              s = [],
              a = [],
              l = 0
            e(function (r) {
              i._forEachVoxelWithinRadius(r.position, t, function (e, t) {
                t
                  ? (s[e] = -1)
                  : void 0 === s[e]
                  ? (a.push(r), a.push(-1), (s[e] = l), (l += 2))
                  : -1 !== s[e] &&
                    (a.push(r), a.push(s[e]), (s[e] = l), (l += 2))
              })
            })
            function c(e) {
              if (void 0 !== s[n])
                if (-1 !== (l = s[n])) {
                  for (; 0 <= l; l = a[l + 1])
                    if (e.position.distanceToSquared(a[l].position) < o) {
                      r(e)
                      break
                    }
                } else r(e)
            }
            for (n in s) s.hasOwnProperty(n) && i._forEachAtomInVoxel(n, c)
          }
        }
      ]),
      k
    )
  })()
  be($t, '_zero', new ae.Vector3(0, 0, 0)),
    be($t, '_voxel', new ae.Vector3()),
    be($t, '_xRange', new ae.Vector2()),
    be($t, '_yRange', new ae.Vector2()),
    be($t, '_zRange', new ae.Vector2()),
    be($t, '_vCenter', new ae.Vector3())
  var Zt = -27.888,
    Kt = (function () {
      function t(e) {
        G(this, t),
          (this._complex = e),
          (this._hbonds = []),
          1e3 < this._complex._residues.length ? this._buildVW() : this._build()
      }
      return (
        p(t, [
          {
            key: 'isBond',
            value: function (e, t) {
              if (this._hbonds[e]) {
                var r = m(this._hbonds[e].acceptor, 2),
                  e = r[0],
                  r = r[1]
                if (e && e.residue === t && e.energy < -0.5) return !0
                if (r && r.residue === t && r.energy < -0.5) return !0
              }
              return !1
            }
          },
          {
            key: '_build',
            value: function () {
              for (var e = 0; e < this._complex._residues.length - 1; ++e) {
                var t = this._complex._residues[e]
                if (0 != (t.getType().flags & Le.Flags.PROTEIN)) {
                  var r = null
                  0 < e &&
                    this._complex._residues[e - 1].getType().flags &
                      Le.Flags.PROTEIN &&
                    t._sequence ===
                      this._complex._residues[e - 1]._sequence + 1 &&
                    (r = this._complex._residues[e - 1])
                  for (var n = e + 1; n < this._complex._residues.length; ++n) {
                    var i,
                      o = this._complex._residues[n]
                    0 != (o.getType().flags & Le.Flags.PROTEIN) &&
                      ((i = null),
                      this._complex._residues[n - 1].getType().flags &
                        Le.Flags.PROTEIN &&
                        o._sequence ===
                          this._complex._residues[n - 1]._sequence + 1 &&
                        (i = this._complex._residues[n - 1]),
                      this._calcHBondEnergy(r, t, o),
                      n !== e + 1 && this._calcHBondEnergy(i, o, t))
                  }
                }
              }
            }
          },
          {
            key: '_buildVW',
            value: function () {
              var r,
                n,
                i = this,
                o = this._complex._residues,
                e = this._complex.getVoxelWorld()
              if (null !== e)
                for (
                  var s = new Mt(
                      (this._complex._residues.length *
                        this._complex._residues.length) /
                        2
                    ),
                    t = 0;
                  t < o.length - 1;
                  ++t
                )
                  0 != ((r = o[t]).getType().flags & Le.Flags.PROTEIN) &&
                    (!(n = 0 < t ? o[t - 1] : null) ||
                      (0 != (n.getType().flags & Le.Flags.PROTEIN) &&
                        r._sequence === n._sequence + 1) ||
                      (n = null),
                    e.forEachAtomWithinRadius(this._residueGetCAlpha(r), 5, a))
              function a(e) {
                var t = e.residue
                t._index !== r._index &&
                  0 != (t.getType().flags & Le.Flags.PROTEIN) &&
                  s.addPair(r._index, t._index) &&
                  (!(e = 0 < t._index ? o[t._index - 1] : null) ||
                    (0 != (e.getType().flags & Le.Flags.PROTEIN) &&
                      t._sequence === e._sequence + 1) ||
                    (e = null),
                  i._calcHBondEnergy(n, r, t),
                  t._index !== r._index + 1 && i._calcHBondEnergy(e, t, r))
              }
            }
          },
          {
            key: '_residueGetCAlpha',
            value: function (e) {
              for (var t = 0; t < e._atoms.length; ++t) {
                var r = e._atoms[t].name
                if ('CA' === r || 'C1' === r) return e._atoms[t].position
              }
              return null
            }
          },
          {
            key: '_residueGetCO',
            value: function (e) {
              var t = null,
                r = null
              return (
                e.forEachAtom(function (e) {
                  'C' === e.name
                    ? (t = e.position)
                    : 'O' === e.name && (r = e.position)
                }),
                [t, r]
              )
            }
          },
          {
            key: '_residueGetNH',
            value: function (e, t) {
              var r,
                n = m(this._residueGetCO(e), 2),
                e = n[0],
                n = n[1]
              if (
                (t.forEachAtom(function (e) {
                  'N' === e.name && (r = e.position)
                }),
                e && n && r)
              ) {
                e = e.clone()
                return (
                  e.sub(n), e.multiplyScalar(1 / e.length()), e.add(r), [r, e]
                )
              }
              return [null, null]
            }
          },
          {
            key: '_calcHBondEnergy',
            value: function (e, t, r) {
              var n = 0
              if (null === e) return n
              if ('PRO' !== t.getType().getName()) {
                var i = m(this._residueGetNH(e, t), 2),
                  o = i[0],
                  s = i[1],
                  a = m(this._residueGetCO(r), 2),
                  e = a[0],
                  i = a[1]
                if (null === o || null === s || null === e || null === i)
                  return n
                ;(a = s.distanceTo(i)),
                  (s = s.distanceTo(e)),
                  (e = o.distanceTo(e)),
                  (i = o.distanceTo(i)),
                  (n =
                    a < 0.5 || s < 0.5 || e < 0.5 || i < 0.5
                      ? -9.9
                      : Zt / a - Zt / s + Zt / e - Zt / i)
                ;(n = Math.round(1e3 * n) / 1e3) < -9.9 && (n = -9.9)
              }
              void 0 === this._hbonds[t._index] &&
                (this._hbonds[t._index] = { donor: [], acceptor: [] })
              i = this._hbonds[t._index]
              i.acceptor.length < 2 &&
                i.acceptor.push({ residue: r._index, energy: n }),
                1 < i.acceptor.length &&
                  (n < i.acceptor[0].energy
                    ? ((i.acceptor[1].residue = i.acceptor[0].residue),
                      (i.acceptor[1].energy = i.acceptor[0].energy),
                      (i.acceptor[0].residue = r._index),
                      (i.acceptor[0].energy = n))
                    : n < i.acceptor[1].energy &&
                      ((i.acceptor[1].residue = r._index),
                      (i.acceptor[1].energy = n))),
                void 0 === this._hbonds[r._index] &&
                  (this._hbonds[r._index] = { donor: [], acceptor: [] })
              r = this._hbonds[r._index]
              return (
                r.donor.length < 2 &&
                  r.donor.push({ residue: t._index, energy: n }),
                1 < r.donor.length &&
                  (n < r.donor[0].energy
                    ? ((r.donor[1].residue = r.donor[0].residue),
                      (r.donor[1].energy = r.donor[0].energy),
                      (r.donor[0].residue = t._index),
                      (r.donor[0].energy = n))
                    : n < r.donor[1].energy &&
                      ((r.donor[1].residue = t._index),
                      (r.donor[1].energy = n))),
                n
              )
            }
          }
        ]),
        t
      )
    })()
  function Qt(e, t) {
    var r =
      ('undefined' != typeof Symbol && e[Symbol.iterator]) || e['@@iterator']
    if (!r) {
      if (
        Array.isArray(e) ||
        (r = (function (e, t) {
          if (e) {
            if ('string' == typeof e) return Jt(e, t)
            var r = Object.prototype.toString.call(e).slice(8, -1)
            return 'Map' ===
              (r = 'Object' === r && e.constructor ? e.constructor.name : r) ||
              'Set' === r
              ? Array.from(e)
              : 'Arguments' === r ||
                /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
              ? Jt(e, t)
              : void 0
          }
        })(e)) ||
        (t && e && 'number' == typeof e.length)
      ) {
        r && (e = r)
        var n = 0,
          t = function () {}
        return {
          s: t,
          n: function () {
            return n >= e.length ? { done: !0 } : { done: !1, value: e[n++] }
          },
          e: function (e) {
            throw e
          },
          f: t
        }
      }
      throw new TypeError(
        'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }
    var i,
      o = !0,
      s = !1
    return {
      s: function () {
        r = r.call(e)
      },
      n: function () {
        var e = r.next()
        return (o = e.done), e
      },
      e: function (e) {
        ;(s = !0), (i = e)
      },
      f: function () {
        try {
          o || null == r.return || r.return()
        } finally {
          if (s) throw i
        }
      }
    }
  }
  function Jt(e, t) {
    ;(null == t || t > e.length) && (t = e.length)
    for (var r = 0, n = new Array(t); r < t; r++) n[r] = e[r]
    return n
  }
  var er = Object.freeze({ NO_BRIDGE: 0, PARALLEL: 1, ANTI_PARALLEL: 2 }),
    tr = Object.freeze({ START: 1, MIDDLE: 2, END: 3, START_AND_END: 4 }),
    rr = Object.freeze({
      STRAND: 'E',
      BRIDGE: 'B',
      HELIX_310: 'G',
      HELIX_ALPHA: 'H',
      HELIX_PI: 'I',
      TURN: 'T',
      BEND: 'S',
      LOOP: ' '
    }),
    nr = (function () {
      function t(e) {
        G(this, t), (this._complex = e), this._build()
      }
      return (
        p(t, [
          {
            key: '_build',
            value: function () {
              ;(this._hbonds = new Kt(this._complex)),
                (this._ss = []),
                (this._sheet = []),
                (this._betaPartners = []),
                (this._bend = [])
              for (var e = 0; e < this._complex.getResidues().length; ++e)
                this._betaPartners[e] = []
              ;(this._helixFlags = []),
                (this._helixFlags[3] = []),
                (this._helixFlags[4] = []),
                (this._helixFlags[5] = []),
                (this._chainLengths = [])
              for (var t = 0; t < this._complex._chains.length; ++t) {
                for (
                  var r = this._complex._chains[t].getResidues(), n = 0;
                  n < r.length &&
                  0 != (r[n].getType().flags & Le.Flags.PROTEIN);
                  ++n
                );
                this._chainLengths[t] = n
              }
              this._buildBetaSheets()
              for (var i = 0; i < this._complex._chains.length; ++i)
                this._buildAlphaHelices(
                  this._complex._chains[i].getResidues(),
                  this._chainLengths[i],
                  !1
                )
            }
          },
          {
            key: '_buildAlphaHelices',
            value: function (e, t, r) {
              for (var n = 3; n <= 5 && !(e.length < n); ++n)
                for (var i = 0; i + n < t; ++i)
                  if (this._hbonds.isBond(e[i + n]._index, e[i]._index)) {
                    this._helixFlags[n][e[i + n]._index] = tr.END
                    for (var o = i + 1; o < i + n; ++o)
                      void 0 === this._helixFlags[n][e[o]._index] &&
                        (this._helixFlags[n][e[o]._index] = tr.MIDDLE)
                    this._helixFlags[n][e[i]._index] === tr.END
                      ? (this._helixFlags[n][e[i]._index] = tr.START_AND_END)
                      : (this._helixFlags[n][e[i]._index] = tr.START)
                  }
              for (var s = 2; s < t - 2; ++s) {
                var a = this._kappa(e[s - 2], e[s], e[s + 2])
                this._bend[e[s]._index] = 360 !== a && 70 < a
              }
              for (var l = 1; l + 4 < t; ++l)
                if (
                  this._isHelixStart(e[l]._index, 4) &&
                  this._isHelixStart(e[l - 1]._index, 4)
                )
                  for (var c = l; c <= l + 3; ++c)
                    this._ss[e[c]._index] = rr.HELIX_ALPHA
              for (var u = 1; u + 3 < t; ++u)
                if (
                  this._isHelixStart(e[u]._index, 3) &&
                  this._isHelixStart(e[u - 1]._index, 3)
                ) {
                  for (var h = !0, f = u; h && f <= u + 2; ++f)
                    h =
                      void 0 === this._ss[e[f]._index] ||
                      this._ss[e[f]._index] === rr.HELIX_310
                  if (h)
                    for (var d = u; d <= u + 2; ++d)
                      this._ss[e[d]._index] = rr.HELIX_310
                }
              for (var p = 1; p + 5 < t; ++p)
                if (
                  this._isHelixStart(e[p]._index, 5) &&
                  this._isHelixStart(e[p - 1]._index, 5)
                ) {
                  for (var m = !0, y = p; m && y <= p + 4; ++y)
                    m =
                      void 0 === this._ss[e[y]._index] ||
                      this._ss[e[y]._index] === rr.HELIX_PI ||
                      (r && this._ss[e[y]._index] === rr.HELIX_ALPHA)
                  if (m)
                    for (var _ = p; _ <= p + 4; ++_)
                      this._ss[e[_]._index] = rr.HELIX_PI
                }
              for (var v = 1; v + 1 < t; ++v)
                if (void 0 === this._ss[e[v]._index]) {
                  for (var g = !1, x = 3; x <= 5 && !g; ++x)
                    for (var b = 1; b < x && !g; ++b)
                      g = b <= v && this._isHelixStart(e[v - b]._index, x)
                  g
                    ? (this._ss[e[v]._index] = rr.TURN)
                    : this._bend[e[v]._index] &&
                      (this._ss[e[v]._index] = rr.BEND)
                }
            }
          },
          {
            key: '_residueGetCAlpha',
            value: function (e) {
              for (var t = 0; t < e._atoms.length; ++t) {
                var r = e._atoms[t].name
                if ('CA' === r || 'C1' === r) return e._atoms[t].position
              }
              return null
            }
          },
          {
            key: '_cosinusAngle',
            value: function (e, t, r, n) {
              ;(e = e.clone().sub(t)),
                (t = r.clone().sub(n)),
                (r = 0),
                (n = e.dot(e) * t.dot(t))
              return (r = 0 < n ? e.dot(t) / Math.sqrt(n) : r)
            }
          },
          {
            key: '_kappa',
            value: function (e, t, r) {
              ;(t = this._residueGetCAlpha(t)),
                (e = this._residueGetCAlpha(e)),
                (r = this._residueGetCAlpha(r))
              if (null === t || null === e || null === r) return 180
              ;(r = this._cosinusAngle(t, e, r, t)), (t = Math.sqrt(1 - r * r))
              return (180 * Math.atan2(t, r)) / Math.PI
            }
          },
          {
            key: '_isHelixStart',
            value: function (e, t) {
              return (
                this._helixFlags[t][e] === tr.START ||
                this._helixFlags[t][e] === tr.START_AND_END
              )
            }
          },
          {
            key: '_buildBetaSheets',
            value: function () {
              for (var e = [], t = 0; t < this._complex._chains.length; ++t) {
                var r = this._chainLengths[t]
                if (!(r <= 4))
                  for (
                    var n = this._complex._chains[t].getResidues(), i = t;
                    i < this._complex._chains.length;
                    ++i
                  ) {
                    var o = this._chainLengths[i]
                    if (!(o <= 4))
                      for (
                        var s = this._complex._chains[i].getResidues(), a = 1;
                        a + 1 < r;
                        ++a
                      ) {
                        var l = n[a],
                          c = 1
                        for (i === t && (c = a + 3); c + 1 < o; ++c) {
                          var u = s[c],
                            h = this._testBridge(n, a, s, c)
                          if (h !== er.NO_BRIDGE) {
                            var f,
                              d = !1,
                              p = Qt(e)
                            try {
                              for (p.s(); !(f = p.n()).done; ) {
                                var m = f.value
                                if (
                                  h === m.type &&
                                  l._index === m.i[m.i.length - 1] + 1
                                ) {
                                  if (
                                    h === er.PARALLEL &&
                                    m.j[m.j.length - 1] + 1 === u._index
                                  ) {
                                    m.i.push(l._index),
                                      m.j.push(u._index),
                                      (d = !0)
                                    break
                                  }
                                  if (
                                    h === er.ANTI_PARALLEL &&
                                    m.j[0] - 1 === u._index
                                  ) {
                                    m.i.push(l._index),
                                      m.j.unshift(u._index),
                                      (d = !0)
                                    break
                                  }
                                }
                              }
                            } catch (e) {
                              p.e(e)
                            } finally {
                              p.f()
                            }
                            d ||
                              e.push({
                                type: h,
                                i: [l._index],
                                chainI: l.getChain()._index,
                                j: [u._index],
                                chainJ: u.getChain()._index
                              })
                          }
                        }
                      }
                  }
              }
              e.sort(function (e, t) {
                return e.chainI < t.chainI ||
                  (e.chainI === t.chainI && e.i[0] < t.i[0])
                  ? -1
                  : 1
              })
              for (var y = 0; y < e.length; ++y)
                for (var _ = y + 1; _ < e.length; ++_) {
                  var v = e[y].i[0],
                    g = e[y].i[e[y].i.length - 1],
                    x = e[y].j[0],
                    b = e[y].j[e[y].j.length - 1],
                    w = e[_].i[0],
                    S = e[_].i[e[_].i.length - 1],
                    R = e[_].j[0],
                    C = e[_].j[e[_].j.length - 1]
                  e[y].type !== e[_].type ||
                    this._hasChainBreak(Math.min(v, w), Math.max(g, S)) ||
                    this._hasChainBreak(Math.min(x, R), Math.max(b, C)) ||
                    6 <= w - g ||
                    (w <= g && v <= S) ||
                    ((e[y].type === er.PARALLEL
                      ? (R - b < 6 && w - g < 3) || R - b < 3
                      : (x - C < 6 && w - g < 3) || x - C < 3) &&
                      ((e[y].i = e[y].i.concat(e[_].i)),
                      e[y].type === er.PARALLEL
                        ? (e[y].j = e[y].j.concat(e[_].j))
                        : (e[y].j = e[_].j.concat(e[y].j)),
                      e.splice(_--, 1)))
                }
              for (var A = new Set(), E = 0; E < e.length; ++E) A.add(e[E])
              for (var k = 1, T = 0; 0 < A.size; ) {
                var P = A.values().next().value
                A.delete(P)
                var M = new Set()
                M.add(P)
                var N = void 0
                do {
                  var L,
                    N = new Set(),
                    I = Qt(M.values())
                  try {
                    for (I.s(); !(L = I.n()).done; ) {
                      var O,
                        B = L.value,
                        V = Qt(A.values())
                      try {
                        for (V.s(); !(O = V.n()).done; ) {
                          var D = O.value
                          this._areBridgesLinked(B, D) && N.add(D)
                        }
                      } catch (e) {
                        V.e(e)
                      } finally {
                        V.f()
                      }
                    }
                  } catch (e) {
                    I.e(e)
                  } finally {
                    I.f()
                  }
                  var z,
                    F = Qt(N.values())
                  try {
                    for (F.s(); !(z = F.n()).done; )
                      (P = z.value), M.add(P), A.delete(P)
                  } catch (e) {
                    F.e(e)
                  } finally {
                    F.f()
                  }
                } while (0 < N.size)
                var U,
                  G = Qt(M.values())
                try {
                  for (G.s(); !(U = G.n()).done; )
                    ((P = U.value).ladder = T), (P.sheet = k), (P.link = M), ++T
                } catch (e) {
                  G.e(e)
                } finally {
                  G.f()
                }
                ++k
              }
              for (var j = 0; j < e.length; ++j) {
                for (var H = e[j], W = 0, Y = 0, X = 0; X < H.i.length; ++X)
                  if (this._betaPartners[H.i[X]][0]) {
                    W = 1
                    break
                  }
                for (var q = 0; q < H.j.length; ++q)
                  if (this._betaPartners[H.j[q]][0]) {
                    Y = 1
                    break
                  }
                var $ = rr.BRIDGE
                if (
                  (1 < H.i.length && ($ = rr.STRAND), H.type === er.PARALLEL)
                ) {
                  for (var Z = 0, K = 0; K < H.i.length; ++K)
                    this._betaPartners[H.i[K]][W] = {
                      residue: H.j[Z++],
                      ladder: H.ladder,
                      parallel: !0
                    }
                  for (var Z = 0, Q = 0; Q < H.j.length; ++Q)
                    this._betaPartners[H.j[Q]][Y] = {
                      residue: H.i[Z++],
                      ladder: H.ladder,
                      parallel: !0
                    }
                } else {
                  for (var J = H.j.length - 1, ee = 0; ee < H.i.length; ++ee)
                    this._betaPartners[H.i[ee]][W] = {
                      residue: H.j[J--],
                      ladder: H.ladder,
                      parallel: !1
                    }
                  for (var J = H.i.length - 1, te = 0; te < H.j.length; ++te)
                    this._betaPartners[H.j[te]][Y] = {
                      residue: H.i[J--],
                      ladder: H.ladder,
                      parallel: !1
                    }
                }
                for (var re = H.i[0]; re <= H.i[H.i.length - 1]; ++re)
                  this._ss[re] !== rr.STRAND &&
                    ((this._ss[re] = $), (this._sheet[re] = H.sheet))
                for (var ne = H.j[0]; ne <= H.j[H.j.length - 1]; ++ne)
                  this._ss[ne] !== rr.STRAND &&
                    ((this._ss[ne] = $), (this._sheet[ne] = H.sheet))
              }
            }
          },
          {
            key: '_testBridge',
            value: function (e, t, r, n) {
              var i = er.NO_BRIDGE,
                o = e[t - 1]._index,
                s = e[t]._index,
                a = e[t + 1]._index,
                e = r[n - 1]._index,
                t = r[n]._index,
                r = r[n + 1]._index,
                n = this._hbonds.isBond.bind(this._hbonds)
              return (
                (n(a, t) && n(t, o)) || (n(r, s) && n(s, e))
                  ? (i = er.PARALLEL)
                  : ((n(a, e) && n(r, o)) || (n(t, s) && n(s, t))) &&
                    (i = er.ANTI_PARALLEL),
                i
              )
            }
          },
          {
            key: '_areBridgesLinked',
            value: function (e, t) {
              var r,
                n = new Set(e.i),
                i = new Set(e.j),
                o = Qt(t.i)
              try {
                for (o.s(); !(r = o.n()).done; ) {
                  var s = r.value
                  if (n.has(s) || i.has(s)) return !0
                }
              } catch (e) {
                o.e(e)
              } finally {
                o.f()
              }
              var a,
                l = Qt(t.j)
              try {
                for (l.s(); !(a = l.n()).done; ) {
                  var c = a.value
                  if (n.has(c) || i.has(c)) return !0
                }
              } catch (e) {
                l.e(e)
              } finally {
                l.f()
              }
              return !1
            }
          },
          {
            key: '_hasChainBreak',
            value: function (e, t) {
              for (var r = e + 1; r <= t; ++r)
                if (
                  this._complex._residues[r]._sequence !==
                  this._complex._residues[r - 1]._sequence + 1
                )
                  return !0
              return !1
            }
          }
        ]),
        t
      )
    })()
  nr.StructureType = rr
  var ir = nr.StructureType,
    or = Fe.Type,
    sr =
      (be((Oa = {}), ir.HELIX_ALPHA, 1),
      be(Oa, ir.HELIX_PI, 3),
      be(Oa, ir.HELIX_310, 5),
      Oa),
    ar =
      (be((hl = {}), ir.BRIDGE, or.BRIDGE),
      be(hl, ir.TURN, or.TURN),
      be(hl, ir.BEND, or.BEND),
      be(hl, ir.LOOP, or.COIL),
      hl),
    lr = (function () {
      function e() {
        G(this, e),
          (this._chains = []),
          (this._components = []),
          (this._helices = []),
          (this._sheets = []),
          (this.structures = []),
          (this._residueTypes = Object.create(Le.StandardTypes)),
          (this._atoms = []),
          (this._residues = []),
          (this._bonds = []),
          (this._sgroups = []),
          (this._molecules = []),
          (this._maskNeedsUpdate = !1),
          (this.metadata = {}),
          (this.symmetry = []),
          (this.units = [new At(this)]),
          (this._currentUnit = 0)
      }
      return (
        p(e, [
          {
            key: 'addAtom',
            value: function (e) {
              var t = this._atoms.length
              return this._atoms.push(e), t
            }
          },
          {
            key: 'addSheet',
            value: function (e) {
              var t = this._sheets.length
              return this._sheets.push(e), t
            }
          },
          {
            key: 'addHelix',
            value: function (e) {
              var t = this._helices.length
              return this._helices.push(e), t
            }
          },
          {
            key: 'getAtoms',
            value: function () {
              return this._atoms
            }
          },
          {
            key: 'getBonds',
            value: function () {
              return this._bonds
            }
          },
          {
            key: 'getAtomCount',
            value: function () {
              return this._atoms.length
            }
          },
          {
            key: 'addResidue',
            value: function (e) {
              var t = this._residues.length
              return this._residues.push(e), t
            }
          },
          {
            key: 'updateToFrame',
            value: function (t) {
              this.forEachChain(function (e) {
                e.updateToFrame(t)
              })
            }
          },
          {
            key: 'addResidueType',
            value: function (e) {
              return (this._residueTypes[e] = new Le(e, 'Unknown', ''))
            }
          },
          {
            key: 'getResidueCount',
            value: function () {
              return this._residues.length
            }
          },
          {
            key: 'getResidues',
            value: function () {
              return this._residues
            }
          },
          {
            key: 'getSGroupCount',
            value: function () {
              return this._sgroups.length
            }
          },
          {
            key: 'getSGroups',
            value: function () {
              return this._sgroups
            }
          },
          {
            key: 'getAtomByFullname',
            value: function (e) {
              e = e.split('.')
              if (3 !== e.length) return null
              var t = e[0],
                r = parseInt(e[1], 10)
              if (Number.isNaN(r)) return null
              var n = e[2].toUpperCase(),
                i = null
              return (
                this.forEachChain(function (e) {
                  i ||
                    (0 === e._name.localeCompare(t) &&
                      e.forEachResidue(function (e) {
                        i ||
                          (e._sequence === r &&
                            e.forEachAtom(function (e) {
                              i || (0 === n.localeCompare(e.name) && (i = e))
                            }))
                      }))
                }),
                i
              )
            }
          },
          {
            key: 'addChain',
            value: function (e) {
              e = new ze(this, e)
              return this._chains.push(e), e
            }
          },
          {
            key: 'getChain',
            value: function (e) {
              for (var t = 0, r = this._chains.length; t < r; ++t) {
                var n = this._chains[t]
                if (n.getName() === e) return n
              }
              return null
            }
          },
          {
            key: 'getChainCount',
            value: function () {
              return this._chains.length
            }
          },
          {
            key: 'getMolecules',
            value: function () {
              return this._molecules
            }
          },
          {
            key: 'getMoleculeCount',
            value: function () {
              return this._molecules.length
            }
          },
          {
            key: 'forEachAtom',
            value: function (e) {
              for (var t = this._atoms, r = 0, n = t.length; r < n; ++r) e(t[r])
            }
          },
          {
            key: 'forEachBond',
            value: function (e) {
              for (var t = this._bonds, r = 0, n = t.length; r < n; ++r) e(t[r])
            }
          },
          {
            key: 'forEachResidue',
            value: function (e) {
              for (var t = this._residues, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'forEachChain',
            value: function (e) {
              for (var t = this._chains, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'forEachMolecule',
            value: function (e) {
              for (var t = this._molecules, r = t.length, n = 0; n < r; ++n)
                e(t[n])
            }
          },
          {
            key: 'forEachSGroup',
            value: function (e) {
              for (var t = this._sgroups, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'forEachComponent',
            value: function (e) {
              for (var t = this._components, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'forEachVisibleComponent',
            value: function (e) {
              for (var t = this._components, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'addBond',
            value: function (e, t, r, n, i) {
              i = new Ae(e, t, r, n, i)
              return this._bonds.push(i), i
            }
          },
          {
            key: 'getBondCount',
            value: function () {
              return this._bonds.length
            }
          },
          {
            key: 'getResidueType',
            value: function (e) {
              return this._residueTypes[e] || null
            }
          },
          {
            key: 'getUnifiedSerial',
            value: function (e, t, r) {
              return t + 65536 * r + 16777216 * e
            }
          },
          {
            key: 'splitUnifiedSerial',
            value: function (e) {
              var t = Math.floor(e / 16777216),
                r = e - 16777216 * t,
                e = Math.floor(r / 65536)
              return { chain: t, serial: r - 65536 * e, iCode: e }
            }
          },
          {
            key: '_fillCmpEdit',
            value: function () {
              var t = this,
                r = this._components
              function l() {
                var e = new Tt(t)
                return (e._index = r.length), (r[e._index] = e)
              }
              this.forEachChain(function (e) {
                var t = e._residues,
                  r = t.length
                if (!(r < 1))
                  for (var n = l(), i = t[0]._index, o = 0; o < r; ++o) {
                    var s = t[o]
                    s._component = n
                    var a = o === r - 1 ? null : t[o + 1]
                    ;(a && s.isConnected(a) && s._index === a._index - 1) ||
                      (n.setSubDivs([{ start: i, end: s._index }]),
                      a && ((i = a._index), (n = l())))
                  }
              })
            }
          },
          {
            key: '_fillCmpNoedit',
            value: function () {
              var e = new Tt(this)
              e._index = 0
              var t = this._residues,
                r = t.length
              if (0 !== r) {
                for (var n = [], i = 0, o = 0; o < r; ++o) {
                  var s = t[o]
                  s._component = e
                  var a = o === r - 1 ? null : t[o + 1]
                  ;(a && s.isConnected(a)) ||
                    ((n[n.length] = { start: i, end: o }), a && (i = o + 1))
                }
                e.setSubDivs(n), (this._components[e._index] = e)
              }
            }
          },
          {
            key: '_fillComponents',
            value: function (e) {
              e ? this._fillCmpEdit() : this._fillCmpNoedit()
            }
          },
          {
            key: 'getCurrentUnit',
            value: function () {
              return this._currentUnit
            }
          },
          {
            key: 'getDefaultBoundaries',
            value: function () {
              return this.units[0].getBoundaries()
            }
          },
          {
            key: 'getBoundaries',
            value: function () {
              return this.units[this._currentUnit].getBoundaries()
            }
          },
          {
            key: 'getTransforms',
            value: function () {
              return this.units[this._currentUnit].getTransforms()
            }
          },
          {
            key: 'getSelector',
            value: function () {
              return this.units[this._currentUnit].getSelector()
            }
          },
          {
            key: 'resetCurrentUnit',
            value: function () {
              ;(this._currentUnit = 0), this.setCurrentUnit(1)
            }
          },
          {
            key: 'setCurrentUnit',
            value: function (e) {
              return (
                null != e &&
                e !== this._currentUnit &&
                0 <= e &&
                e < this.units.length &&
                ((this._currentUnit = e), !0)
              )
            }
          },
          {
            key: '_computeBounds',
            value: function () {
              for (var e = this.units, t = 0, r = e.length; t < r; ++t)
                e[t].computeBoundaries()
            }
          },
          {
            key: 'onAtomPositionChanged',
            value: function () {
              this.forEachChain(function (e) {
                e._finalize()
              }),
                this.forEachComponent(function (e) {
                  e.update()
                }),
                this._computeBounds(),
                this._finalizeBonds(),
                this.forEachSGroup(function (e) {
                  e._rebuildSGroupOnAtomChange()
                })
            }
          },
          {
            key: 'update',
            value: function () {
              this._maskNeedsUpdate &&
                (this.updateStructuresMask(), (this._maskNeedsUpdate = !1))
            }
          },
          {
            key: '_finalizeBonds',
            value: function () {
              for (var e = this.getBonds(), t = e.length, r = 0; r < t; ++r)
                e[r]._index = r
            }
          },
          {
            key: 'finalize',
            value: function (e) {
              e = e || {}
              for (var t, r = this._bonds, n = r.length - 1; 0 <= n; n--) {
                var i = r[n]
                null === i._left || null === i._right
                  ? r.splice(n, 1)
                  : (i._left.bonds.push(i), i._right.bonds.push(i))
              }
              var o = this._residues
              for (n = 0, t = o.length; n < t; ++n) o[n]._finalize()
              this.forEachChain(function (e) {
                e._finalize()
              })
              var s = this.units
              for (n = 0, t = s.length; n < t; ++n) s[n].finalize()
              this.setCurrentUnit(1)
              var a = {}
              for (n = 0, t = o.length; n < t; ++n) {
                var l = o[n]
                a[
                  this.getUnifiedSerial(
                    l.getChain().getName().charCodeAt(0),
                    l.getSequence(),
                    l.getICode().charCodeAt(0)
                  )
                ] = l
              }
              var c = this.structures
              for (n = 0, t = c.length; n < t; ++n)
                c[n]._finalize(e.serialAtomMap, a, this)
              var u = this._helices
              for (n = 0, t = u.length; n < t; ++n)
                u[n]._finalize(e.serialAtomMap, a, this)
              var h = this._sheets
              for (n = 0, t = h.length; n < t; ++n)
                h[n]._finalize(e.serialAtomMap, a, this)
              this._computeBounds()
              var f = this._atoms
              for (n = 0, t = f.length; n < t; ++n) f[n].index = n
              e.needAutoBonding && ((y = new Bt(this)).build(), y.destroy())
              var d = this._chains
              for (n = 0, t = d.length; n < t; ++n) d[n]._index = n
              for (n = 0, t = o.length; n < t; ++n) o[n]._index = n
              for (n = 0, t = f.length; n < t; ++n) {
                var p,
                  m = f[n]
                m.flags & we.Flags.HYDROGEN &&
                  1 === m.bonds.length &&
                  (((p = m.bonds[0])._left !== m && p._left) || p._right)
                    .flags & we.Flags.CARBON &&
                  (m.flags |= we.Flags.NONPOLARH)
              }
              this._finalizeBonds(), this._fillComponents(e.enableEditing)
              var y = new qt(this)
              y.markCycles(),
                e.detectAromaticLoops && y.detectCycles(),
                this._finalizeMolecules()
            }
          },
          {
            key: '_finalizeMolecules',
            value: function () {
              for (var e = 0; e < this._molecules.length; e++)
                for (
                  var t = this._molecules[e], r = t.residues.length, n = 0;
                  n < r;
                  n++
                )
                  t.residues[n]._molecule = t
            }
          },
          {
            key: 'updateStructuresMask',
            value: function () {
              function e(e) {
                return e.collectMask()
              }
              this.forEachResidue(e),
                this.forEachChain(e),
                this.forEachMolecule(e)
            }
          },
          {
            key: 'countAtomsByMask',
            value: function (t) {
              var r = 0
              return (
                this.forEachAtom(function (e) {
                  0 != (e.mask & t) && r++
                }),
                r
              )
            }
          },
          {
            key: 'getNumAtomsBySelector',
            value: function (t) {
              var r = 0
              return (
                this.forEachAtom(function (e) {
                  t.includesAtom(e) && r++
                }),
                r
              )
            }
          },
          {
            key: 'resetAtomMask',
            value: function (t) {
              this.forEachAtom(function (e) {
                e.mask = t
              })
            }
          },
          {
            key: 'markAtoms',
            value: function (e, t) {
              var r = t,
                n = ~r,
                i = 0,
                o = Ct.keyword('And')(e, this.getSelector())
              return (
                this.forEachAtom(function (e) {
                  o.includesAtom(e) ? ((e.mask |= r), i++) : (e.mask &= n)
                }),
                (this._maskNeedsUpdate = !0),
                i
              )
            }
          },
          {
            key: 'markAtomsAdditionally',
            value: function (t, r) {
              var n = r,
                i = 0
              return (
                this.forEachAtom(function (e) {
                  t.includesAtom(e) &&
                    (e.mask & r) !== r &&
                    ((e.mask |= n), i++)
                }),
                i
              )
            }
          },
          {
            key: 'clearAtomBits',
            value: function (e) {
              var t = ~e
              this.forEachAtom(function (e) {
                e.mask &= t
              })
              function r(e) {
                e._mask &= t
              }
              this.forEachAtom(r),
                this.forEachResidue(r),
                this.forEachChain(r),
                this.forEachMolecule(r)
            }
          },
          {
            key: 'getAtomNames',
            value: function () {
              if (this.hasOwnProperty('_atomNames')) return this._atomNames
              var t = {}
              return (
                this.forEachAtom(function (e) {
                  t[e.name] = 1
                }),
                (this._atomNames = Object.keys(t)),
                this._atomNames
              )
            }
          },
          {
            key: 'getElements',
            value: function () {
              if (this.hasOwnProperty('_elements')) return this._elements
              var t = {}
              return (
                this.forEachAtom(function (e) {
                  t[e.element.name] = 1
                }),
                (this._elements = Object.keys(t)),
                this._elements
              )
            }
          },
          {
            key: 'getResidueNames',
            value: function () {
              if (this.hasOwnProperty('_residueNames'))
                return this._residueNames
              var t = {}
              return (
                this.forEachResidue(function (e) {
                  t[e._type._name] = 1
                }),
                (this._residueNames = Object.keys(t)),
                this._residueNames
              )
            }
          },
          {
            key: 'getChainNames',
            value: function () {
              if (this.hasOwnProperty('_chainNames')) return this._chainNames
              var t = {}
              return (
                this.forEachChain(function (e) {
                  t[e._name] = 1
                }),
                (this._chainNames = Object.keys(t)),
                this._chainNames
              )
            }
          },
          {
            key: 'getAltLocNames',
            value: function () {
              if (this.hasOwnProperty('_altlocNames')) return this._altlocNames
              var t = {}
              return (
                this.forEachAtom(function (e) {
                  t[String.fromCharCode(e.location)] = 1
                }),
                (this._altlocNames = Object.keys(t)),
                this._altlocNames
              )
            }
          },
          {
            key: 'getVoxelWorld',
            value: function () {
              if (!this.hasOwnProperty('_voxelWorld'))
                try {
                  ;(this._voxelWorld = new $t(
                    this.getDefaultBoundaries().boundingBox,
                    new ae.Vector3(5, 5, 5)
                  )),
                    this._voxelWorld.addAtoms(this)
                } catch (e) {
                  L.warn('Unable to create voxel world'),
                    (this._voxelWorld = null)
                }
              return this._voxelWorld
            }
          },
          {
            key: 'addElement',
            value: function (e, t, r, n) {
              for (var i = e.length, o = 0; o < i; ++o) {
                var s = e[o]
                n(s, r), t.push(s)
              }
            }
          },
          {
            key: 'joinComplexes',
            value: function (e) {
              ;(this._chains = []),
                (this._components = []),
                (this._helices = []),
                (this._sheets = []),
                (this.structures = []),
                (this._atoms = []),
                (this._residues = []),
                (this._bonds = []),
                (this._sgroups = [])
              var r = this,
                t = 0,
                n = 0,
                i = 0,
                o = 0,
                s = 0
              function a(e, t) {
                ;(e.serial += t), (e.index += t)
              }
              function l(e, t) {
                e._index += t
              }
              function c(e, t) {
                e._index += t
              }
              function u(e, t) {
                ;(e._complex = r), (e._index += t)
              }
              function h(e, t) {
                ;(e._complex = r), (e._index += t)
              }
              function f() {}
              for (var d = 0; d < e.length; ++d) {
                var p,
                  m = e[d]
                for (p in (this.addElement(m._atoms, this._atoms, t, a),
                this.addElement(m._bonds, this._bonds, n, l),
                this.addElement(m._residues, this._residues, i, c),
                this.addElement(m._chains, this._chains, o, u),
                this.addElement(m._sheets, this._sheets, 0, f),
                this.addElement(m._helices, this._helices, 0, f),
                this.addElement(m._sgroups, this._sgroups, 0, f),
                this.addElement(m._components, this._components, s, h),
                this.addElement(m.structures, this.structures, 0, f),
                m._residueTypes))
                  m._residueTypes.hasOwnProperty(p) &&
                    (this._residueTypes[p] = m._residueTypes[p])
                ;(t += m._atoms.length),
                  (n += m._bonds.length),
                  (i += m._residues.length),
                  (o += m._chains.length),
                  (s += m._components.length)
              }
              this._computeBounds()
            }
          },
          {
            key: 'dssp',
            value: function () {
              for (
                var e,
                  t,
                  r = new nr(this),
                  n = (this.structures = []),
                  i = (this._helices = []),
                  o = (this._sheets = []),
                  s = 0,
                  a = null,
                  l = 0,
                  c = this._residues.length;
                l < c;
                ++l
              ) {
                var u,
                  h,
                  f,
                  d = r._ss[l],
                  p = this._residues[l],
                  m = r._sheet[l]
                d !== e || m !== t
                  ? ((u = sr[d]),
                    (h = ar[d]),
                    d === ir.STRAND
                      ? ((f = o[(f = m)] || (o[f] = new Ze(String(f), 0))),
                        (a = new $e(f, p, p, 0, null, null)),
                        f.addStrand(a))
                      : void 0 !== u
                      ? ((a = new Ye(u, p, p, ++s, String(s), '', 1)),
                        i.push(a))
                      : (a = void 0 !== h ? new Fe(h, p, p) : null),
                    a && n.push(a),
                    (p._secondary = a),
                    (e = d),
                    (t = m))
                  : ((p._secondary = a) && (a.term = p),
                    a instanceof Ye && a.length++)
              }
              this._sheets = o.filter(function (e) {
                return !0
              })
            }
          }
        ]),
        e
      )
    })()
  function cr(e) {
    var t = 2
    for (e = (e - 1) >> 1; e; ) (t <<= 1), (e >>= 1)
    return t
  }
  ;(lr.prototype.id = 'Complex'), (lr.prototype.name = '')
  var ur = (function () {
    function v(e, t, r, n, i, o) {
      switch (
        (G(this, v),
        (this._box = r.clone()),
        (this._dimVec = Math.max(Math.floor(n || 1), 1)),
        (this._volumeInfo = o),
        t instanceof Array
          ? ((o = m(t, 3)),
            (this._dimX = o[0]),
            (this._dimY = o[1]),
            (this._dimZ = o[2]))
          : ((this._dimX = t.x), (this._dimY = t.y), (this._dimZ = t.z)),
        (this._dimX = Math.max(Math.floor(this._dimX), 1)),
        (this._dimY = Math.max(Math.floor(this._dimY), 1)),
        (this._dimZ = Math.max(Math.floor(this._dimZ), 1)),
        (this._rowElements = this._dimVec * this._dimX),
        (this._planeElements = this._rowElements * this._dimY),
        (this._totalElements = this._planeElements * this._dimZ),
        (this._data = i || le.allocateTyped(e, this._totalElements)),
        this._dimVec)
      ) {
        case 1:
          break
        case 2:
          ;(this.getValue = function (e, t, r) {
            r =
              e * this._dimVec + t * this._rowElements + r * this._planeElements
            return [this._data[r], this._data[1 + r]]
          }),
            (this.setValue = function (e, t, r, n, i) {
              r =
                e * this._dimVec +
                t * this._rowElements +
                r * this._planeElements
              ;(this._data[r] = n), (this._data[1 + r] = i)
            }),
            (this.addValue = function (e, t, r, n, i) {
              r =
                e * this._dimVec +
                t * this._rowElements +
                r * this._planeElements
              ;(this._data[r] += n), (this._data[1 + r] += i)
            })
          break
        case 3:
          ;(this.getValue = function (e, t, r) {
            r =
              e * this._dimVec + t * this._rowElements + r * this._planeElements
            return [this._data[r], this._data[1 + r], this._data[2 + r]]
          }),
            (this.setValue = function (e, t, r, n, i, o) {
              r =
                e * this._dimVec +
                t * this._rowElements +
                r * this._planeElements
              ;(this._data[r] = n),
                (this._data[1 + r] = i),
                (this._data[2 + r] = o)
            }),
            (this.addValue = function (e, t, r, n, i, o) {
              r =
                e * this._dimVec +
                t * this._rowElements +
                r * this._planeElements
              ;(this._data[r] += n),
                (this._data[1 + r] += i),
                (this._data[2 + r] += o)
            })
          break
        default:
          throw new Error('Volume: invalid vector dimension')
      }
    }
    return (
      p(v, [
        {
          key: 'getValue',
          value: function (e, t, r) {
            return this._data[
              e + t * this._rowElements + r * this._planeElements
            ]
          }
        },
        {
          key: 'setValue',
          value: function (e, t, r, n) {
            this._data[e + t * this._rowElements + r * this._planeElements] = n
          }
        },
        {
          key: 'addValue',
          value: function (e, t, r, n) {
            this._data[e + t * this._rowElements + r * this._planeElements] += n
          }
        },
        {
          key: 'getDimensions',
          value: function () {
            return [this._dimX, this._dimY, this._dimZ]
          }
        },
        {
          key: 'getBox',
          value: function () {
            return this._box
          }
        },
        {
          key: 'getVolumeInfo',
          value: function () {
            return this._volumeInfo
          }
        },
        {
          key: 'getCellSize',
          value: function () {
            var e = new ae.Vector3()
            this._box.getSize(e)
            var t = new ae.Vector3()
            return (
              (t.x = 1 < this._dimX ? e.x / (this._dimX - 1) : 0),
              (t.y = 1 < this._dimY ? e.y / (this._dimY - 1) : 0),
              (t.z = 1 < this._dimZ ? e.z / (this._dimZ - 1) : 0),
              t
            )
          }
        },
        {
          key: 'computeGradient',
          value: function () {
            if (1 !== this._dimVec) return null
            var e = new v(
                Float32Array,
                [this._dimX, this._dimY, this._dimZ],
                this._box,
                3
              ),
              t = this.getCellSize(),
              r = new ae.Vector3(-0.5 / t.x, -0.5 / t.y, -0.5 / t.z)
            function n(e, t, r) {
              return Math.min(r, Math.max(t, e))
            }
            var i = this._dimX,
              o = this._dimY,
              s = this._dimZ,
              a = this._data
            function l(e, t, r) {
              return a[r * i * o + t * i + e]
            }
            for (var c = 0; c < s; ++c)
              for (
                var u = n(c - 1, 0, s - 1), h = n(c + 1, 0, s - 1), f = 0;
                f < o;
                ++f
              )
                for (
                  var d = n(f - 1, 0, o - 1), p = n(f + 1, 0, o - 1), m = 0;
                  m < i;
                  ++m
                ) {
                  var y = n(m - 1, 0, i - 1),
                    _ = n(m + 1, 0, i - 1)
                  e.setValue(
                    m,
                    f,
                    c,
                    (l(_, f, c) - l(y, f, c)) * r.x,
                    (l(m, p, c) - l(m, d, c)) * r.y,
                    (l(m, f, h) - l(m, f, u)) * r.z
                  )
                }
            return e
          }
        },
        {
          key: 'normalize',
          value: function () {
            for (
              var e = this._data, t = e[0], r = e[0], n = 1;
              n < e.length;
              ++n
            )
              (t = Math.min(t, e[n])), (r = Math.max(r, e[n]))
            var i = 1 / (r - t)
            if (0 != i) for (var o = 0; o < e.length; ++o) e[o] = i * (e[o] - t)
          }
        },
        {
          key: 'getTiledTextureStride',
          value: function () {
            return [this._dimX + 2, this._dimY + 2]
          }
        },
        {
          key: 'buildTiledTexture',
          value: function () {
            for (
              var e = cr(
                  (e =
                    (t = Math.ceil(
                      Math.sqrt((this._dimZ * this._dimY) / this._dimX)
                    )) *
                      (this._dimX + 2) -
                    1)
                ),
                t = Math.floor(e / (this._dimX + 2)),
                r = Math.ceil(this._dimZ / t),
                n = cr((n = r * (this._dimY + 2) - 1)),
                i = new Uint8Array(e * n),
                o = 0;
              o < r;
              ++o
            )
              for (var s = 0; s < this._dimY; ++s)
                for (
                  var a = o * t * this._planeElements + s * this._rowElements,
                    l = e * (o * (this._dimY + 2) + s),
                    c = 0;
                  c < t;
                  ++c
                ) {
                  for (var u = 0; u < this._dimX; ++u)
                    i[l++] = 255 * this._data[a++]
                  ;(i[l++] = 255 * this._data[a - 1]),
                    c < t - 1 &&
                      ((a += this._planeElements - this._rowElements),
                      (i[l++] = 255 * this._data[a]))
                }
            for (var h = 0; h < r; ++h) {
              l = (a = e * (h * (this._dimY + 2) + this._dimY - 1)) + e
              for (var f = 0; f < e; ++f) i[l++] = i[a++]
              if (h < r - 1) {
                l = (a = e * (h + 1) * (this._dimY + 2)) - e
                for (var d = 0; d < e; ++d) i[l++] = i[a++]
              }
            }
            n = new ae.DataTexture(
              i,
              e,
              n,
              ae.LuminanceFormat,
              ae.UnsignedByteType,
              ae.UVMapping,
              ae.ClampToEdgeWrapping,
              ae.ClampToEdgeWrapping,
              ae.LinearFilter,
              ae.LinearFilter
            )
            return (n.needsUpdate = !0), n
          }
        },
        {
          key: 'getData',
          value: function () {
            return this._data
          }
        },
        {
          key: 'getDirectIdx',
          value: function (e, t, r) {
            return (
              e * this._dimVec + t * this._rowElements + r * this._planeElements
            )
          }
        },
        {
          key: 'getStrideX',
          value: function () {
            return this._dimVec
          }
        },
        {
          key: 'getStrideY',
          value: function () {
            return this._rowElements
          }
        },
        {
          key: 'getStrideZ',
          value: function () {
            return this._planeElements
          }
        }
      ]),
      v
    )
  })()
  ur.prototype.id = 'Volume'
  var hr = {
    Atom: we,
    Element: Se,
    Bond: Ae,
    Residue: Ne,
    ResidueType: Le,
    Chain: ze,
    Helix: Ye,
    Strand: $e,
    Sheet: Ze,
    SGroup: Ke,
    Assembly: kt,
    Complex: lr,
    Volume: ur,
    VoxelWorld: $t,
    selectors: Ct,
    Molecule: (function () {
      function n(e, t, r) {
        G(this, n),
          (this.complex = e),
          (this.name = t || ''),
          (this.residues = []),
          (this.mask = 1),
          (this.index = r || -1)
      }
      return (
        p(n, [
          {
            key: 'forEachResidue',
            value: function (e) {
              for (var t = this.residues, r = 0, n = t.length; r < n; ++r)
                e(t[r])
            }
          },
          {
            key: 'collectMask',
            value: function () {
              for (
                var e = 4294967295, t = this.residues, r = 0, n = t.length;
                r < n;
                ++r
              )
                e &= t[r]._mask
              this.mask = e
            }
          }
        ]),
        n
      )
    })()
  }
  function fr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var dr = (function () {
    x(i, ae.Object3D)
    var n = fr(i)
    function i(e) {
      G(this, i)
      var t,
        r = S((t = n.call(this)))
      return (
        (t._element = e),
        (t._element.style.position = 'absolute'),
        t.addEventListener('removed', function () {
          null !== r._element.parentNode &&
            r._element.parentNode.removeChild(r._element)
        }),
        t
      )
    }
    return (
      p(i, [
        {
          key: 'getElement',
          value: function () {
            return this._element
          }
        },
        {
          key: 'setTransparency',
          value: function (e) {
            var t,
              r = this.getElement()
            null !== r &&
              (1 !== e
                ? ((r.style.display = 'inline'),
                  (e = (t = 1 - e).toString()),
                  (t = 100 * t),
                  (r.style.opacity = e),
                  (r.style.filter = 'alpha(opacity='.concat(t, ')')))
                : (r.style.display = 'none'))
          }
        },
        {
          key: 'clone',
          value: function () {
            var e = new i(this._element)
            return e.copy(this), e
          }
        }
      ]),
      i
    )
  })()
  function pr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var mr = (function () {
      x(t, ae.Group)
      var e = pr(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: 'raycast',
            value: function (e, t) {
              if (this.visible)
                for (var r = this.children, n = 0, i = r.length; n < i; ++n)
                  r[n].raycast(e, t)
            }
          },
          {
            key: 'enableSubset',
            value: function (e, t) {
              for (var r = this.children, n = 0, i = r.length; n < i; ++n)
                r[n].enableSubset && r[n].enableSubset(e, t)
            }
          },
          {
            key: 'disableSubset',
            value: function (e, t) {
              for (var r = this.children, n = 0, i = r.length; n < i; ++n)
                r[n].disableSubset && r[n].disableSubset(e, t)
            }
          },
          {
            key: 'isEmpty',
            value: function () {
              return 0 === this.children.length
            }
          },
          {
            key: 'updateToFrame',
            value: function (e) {
              for (var t = this.children, r = 0, n = t.length; r < n; ++r)
                t[r].updateToFrame && t[r].updateToFrame(e)
            }
          },
          {
            key: 'getSubset',
            value: function (e, t) {
              for (
                var r = [], n = this.children, i = 0, o = n.length;
                i < o;
                ++i
              )
                n[i].getSubset &&
                  Array.prototype.push.apply(r, n[i].getSubset(e, t))
              return r
            }
          }
        ]),
        t
      )
    })(),
    yr =
      'uniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\n\r\nattribute vec2 uv;\r\nattribute vec3 position;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n'
  function _r(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var vr,
    gr,
    xr = {
      DEFAULT: 0,
      VOLUME: 1,
      TRANSPARENT: 2,
      PREPASS_TRANSPARENT: 3,
      VOLUME_BFPLANE: 4,
      COLOR_FROM_POSITION: 5,
      SHADOWMAP: 6
    },
    br = [xr.DEFAULT, xr.TRANSPARENT]
  ;(ae.Object3D.prototype.resetTransform = function () {
    this.position.set(0, 0, 0),
      this.quaternion.set(0, 0, 0, 1),
      this.scale.set(1, 1, 1)
  }),
    (ae.Object3D.prototype.updateMatrixWorldRecursive = function () {
      null != this.parent && this.parent.updateMatrixWorldRecursive(),
        this.updateMatrixWorld()
    }),
    (ae.Object3D.prototype.addSavingWorldTransform =
      ((vr = new ae.Matrix4()),
      function (e) {
        e instanceof ae.Object3D &&
          (vr.copy(this.matrixWorld).invert(),
          vr.multiply(e.matrixWorld),
          e.matrix.copy(vr),
          e.matrix.decompose(e.position, e.quaternion, e.scale),
          this.add(e))
      })),
    (ae.WebGLRenderer.prototype.renderDummyQuad = (function () {
      var e = new ae.MeshBasicMaterial({
          transparent: !0,
          opacity: 0,
          depthWrite: !1
        }),
        t = new ae.Scene(),
        e = new ae.Mesh(new ae.PlaneBufferGeometry(0.01, 0.01), e)
      t.add(e)
      var r = new ae.OrthographicCamera(-0.5, 0.5, 0.5, -0.5, -1e4, 1e4)
      return (
        (r.position.z = 100),
        function () {
          this.render(t, r)
        }
      )
    })()),
    (ae.WebGLRenderer.prototype.renderScreenQuad = (function () {
      var t = new ae.Scene(),
        r = new ae.Mesh(new ae.PlaneBufferGeometry(1, 1))
      t.add(r)
      var n = new ae.OrthographicCamera(-0.5, 0.5, 0.5, -0.5, -1e4, 1e4)
      return (
        (n.position.z = 100),
        function (e) {
          ;(r.material = e), this.render(t, n)
        }
      )
    })()),
    (ae.Matrix4.prototype.isIdentity =
      ((gr = new ae.Matrix4()),
      function () {
        return gr.equals(this)
      })),
    (ae.Matrix4.prototype.applyToPointsArray = function (e, t, r) {
      if (!e || !t || t < 3) return e
      r = r || 0
      for (var n = this.elements, i = 0; i < e.length; i += t) {
        var o = e[i],
          s = e[i + 1],
          a = e[i + 2],
          l = 1 / (n[3] * o + n[7] * s + n[11] * a + n[15])
        ;(e[i] = (n[0] * o + n[4] * s + n[8] * a + n[12] * r) * l),
          (e[i + 1] = (n[1] * o + n[5] * s + n[9] * a + n[13] * r) * l),
          (e[i + 2] = (n[2] * o + n[6] * s + n[10] * a + n[14] * r) * l)
      }
      return e
    })
  var wr,
    Sr,
    Rr,
    Cr = (function () {
      x(r, ae.RawShaderMaterial)
      var t = _r(r)
      function r(e) {
        return (
          G(this, r),
          void 0 === e.uniforms && (e.uniforms = {}),
          (e.uniforms.srcTex = { type: 't', value: null }),
          (e.vertexShader = yr),
          (e.transparent = !1),
          (e.depthTest = !1),
          (e.depthWrite = !1),
          t.call(this, e)
        )
      }
      return p(r)
    })()
  function Ar(e) {
    e.traverse(function (e) {
      ;(e instanceof ae.Mesh ||
        e instanceof ae.LineSegments ||
        e instanceof ae.Line) &&
        e.geometry.dispose()
    }),
      (function (e) {
        for (var t = e.children, r = 0, n = t.length; r < n; ++r) {
          var i = t[r]
          ;(i.parent = null), i.dispatchEvent({ type: 'removed' })
        }
        e.children = []
      })(e)
  }
  ;(ae.WebGLRenderer.prototype.renderScreenQuadFromTex =
    ((wr = new Cr({
      uniforms: { opacity: { type: 'f', value: 1 } },
      fragmentShader:
        'precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color = texture2D(srcTex, vUv);\r\n  gl_FragColor = vec4(color.xyz, color.a * opacity);\r\n}\r\n',
      transparent: !0
    })),
    function (e, t) {
      ;(wr.uniforms.srcTex.value = e),
        (wr.transparent = t < 1),
        (wr.uniforms.opacity.value = t),
        this.renderScreenQuad(wr)
    })),
    (ae.WebGLRenderer.prototype.renderScreenQuadFromTexWithDistortion =
      ((Sr = new Cr({
        uniforms: { coef: { type: 'f', value: 1 } },
        fragmentShader:
          'precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform float coef;\r\n\r\nvoid main() {\r\n  vec2 uv = vUv * 2.0 - 1.0;\r\n  float r2 = dot(uv, uv);\r\n  vec2 tc = uv * (1.0 + coef * r2);\r\n  if (!all(lessThan(abs(tc), vec2(1.0))))\r\n    discard;\r\n  tc = 0.5 * (tc + 1.0);\r\n  gl_FragColor = texture2D(srcTex, tc);\r\n}\r\n'
      })),
      function (e, t) {
        ;(Sr.uniforms.srcTex.value = e),
          (Sr.uniforms.coef.value = t),
          this.renderScreenQuad(Sr)
      })),
    (ae.PerspectiveCamera.prototype.setMinimalFov = function (e) {
      1 <= this.aspect
        ? (this.fov = e)
        : (this.fov = ae.MathUtils.radToDeg(
            2 *
              Math.atan(Math.tan(0.5 * ae.MathUtils.degToRad(e)) / this.aspect)
          ))
    }),
    (ae.StereoCamera.prototype.updateHalfSized = function (e, t) {
      var r = e.aspect,
        n = e.fov
      ;(e.aspect = r / 2),
        e.setMinimalFov(t),
        e.updateProjectionMatrix(),
        this.update(e),
        (e.aspect = r),
        (e.fov = n),
        e.updateProjectionMatrix()
    }),
    (ae.PerspectiveCamera.prototype.setDistanceToFit = function (e, t) {
      this.position.z = e / Math.sin(0.5 * ae.MathUtils.degToRad(t))
    }),
    (ae.Raycaster.prototype.intersectVisibleObject = function (e, t, r, n) {
      var i = this.intersectObject(e, !1)
      if (0 === i.length) return null
      for (
        var o = Math.min(t.near, r), s = i[0], a = new ae.Vector3(), l = 0;
        l < i.length &&
        ((s = i[l]),
        a.copy(s.point),
        a.applyMatrix4(t.matrixWorldInverse),
        !(a.z <= -o));
        ++l
      );
      if (l === i.length) return null
      n = Math.min(t.far, n)
      return (
        a.copy(s.point),
        a.applyMatrix4(t.matrixWorldInverse),
        a.z <= -n ? null : s
      )
    }),
    (ae.Matrix4.prototype.extractScale =
      ((Rr = new ae.Vector3()),
      function (e) {
        void 0 === e &&
          (L.debug(
            'extractScale(): new is too expensive operation to do it on-the-fly'
          ),
          (e = Rr.clone()))
        var t = this.elements
        return (
          (e.x = Rr.set(t[0], t[1], t[2]).length()),
          (e.y = Rr.set(t[4], t[5], t[6]).length()),
          (e.z = Rr.set(t[8], t[9], t[10]).length()),
          this.determinant() < 0 && (e.x = -e.x),
          e
        )
      })),
    (ae.BufferAttribute.prototype.copyAtList = function (e, t) {
      for (var r = this.itemSize, n = 0, i = t.length; n < i; ++n)
        for (var o = 0; o < r; ++o)
          this.array[n * r + o] = e.array[t[n] * r + o]
      return this
    })
  var Er = ae.InstancedBufferGeometry.prototype.copy
  ae.InstancedBufferGeometry.prototype.copy = function (e) {
    Er.call(this, e),
      void 0 === this.instanceCount && (this.instanceCount = 1 / 0)
  }
  var kr = {
    calcCylinderMatrix: function (e, t, r) {
      var n = e.clone().lerp(t, 0.5),
        i = new ae.Matrix4()
      i.makeScale(r, e.distanceTo(t), r)
      var o = new ae.Matrix4()
      return (
        o.makeRotationX(Math.PI / 2),
        (e = new ae.Matrix4()),
        (r = new ae.Vector3(0, 1, 0)),
        e.lookAt(n, t, r),
        e.multiply(o),
        e.multiply(i),
        e.setPosition(n),
        e
      )
    },
    calcChunkMatrix: function (e, t, r, n) {
      var i = new ae.Matrix4()
      return (
        i.makeScale(n.x, n.y, 0),
        (n = new ae.Matrix4()).lookAt(e, t, r),
        n.multiply(i),
        n.setPosition(e),
        n
      )
    },
    groupHasGeometryToRender: function (e) {
      var t = !1
      return (
        e.traverse(function (e) {
          ;(e.hasOwnProperty('geometry') || e instanceof dr) && (t = !0)
        }),
        t
      )
    },
    buildDistorionMesh: function (e, t, i) {
      for (
        var r = (t = new ae.PlaneBufferGeometry(2, 2, e, t)).getAttribute(
            'position'
          ),
          n = 0;
        n < r.count;
        ++n
      ) {
        var o = r.array[3 * n],
          s = r.array[3 * n + 1],
          a = (function (e) {
            for (var t = 0, r = e, n = 1; 1e-5 < Math.abs(r - t); )
              r = e / ((n = 1 + i * (t = r)) * n)
            return 1 / n
          })(o * o + s * s)
        r.setXY(n, a * o, a * s)
      }
      return t
    },
    RCGroup: mr,
    fillArray: function (e, t, r, n) {
      n = void 0 !== n ? n : e.length
      for (var i = (r = void 0 !== r ? r : 0); i < n; ++i) e[i] = t
    },
    clearTree: Ar,
    destroyObject: function (e) {
      Ar(e),
        e.parent ? e.parent.remove(e) : e.dispatchEvent({ type: 'removed' })
    },
    belongToSelectLayers: function (e) {
      for (var t = 0; t < br.length; t++)
        if (1 == ((e.layers.mask >> br[t]) & 1)) return !0
      return !1
    },
    processObjRenderOrder: function (e, t) {
      var r = +('BA' !== t)
      e.traverse(function (e) {
        e.isGroup && (e.renderOrder = r)
      })
    },
    applySelectionMaterial: function (e) {
      e.traverse(function (e) {
        'material' in e &&
          ((e.material = e.material.clone(!0)),
          e.material.setValues({
            depthFunc: ae.LessEqualDepth,
            overrideColor: !0,
            fog: !1,
            lights: !1,
            shadowmap: !1
          }),
          e.material.setUberOptions({
            fixedColor: new ae.Color(16776960),
            zOffset: -1e-6
          }))
      })
    },
    getMiddlePoint: function (e, t, r) {
      return (
        (r = r || new ae.Vector3()).set(0, 0, 0),
        r.addScaledVector(e, 0.5),
        r.addScaledVector(t, 0.5),
        r
      )
    },
    LAYERS: xr
  }
  function Tr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Pr = {
      boundingBox: new ae.Box3(
        new ae.Vector3(-1, -1, -1),
        new ae.Vector3(1, 1, 1)
      ),
      boundingSphere: new ae.Sphere(new ae.Vector3(0, 0, 0), 1)
    },
    Mr = (function () {
      x(i, kr.RCGroup)
      var n = Tr(i)
      function i(e, t) {
        var r
        return (
          G(this, i),
          ((r = n.call(this, e, t)).name = e),
          (r._dataSource = t),
          r
        )
      }
      return (
        p(i, [
          {
            key: 'release',
            value: function () {
              this.parent && this.parent.remove(this)
            }
          },
          {
            key: 'getDataSource',
            value: function () {
              return this._dataSource
            }
          },
          {
            key: 'getBoundaries',
            value: function () {
              return Pr
            }
          }
        ]),
        i
      )
    })()
  function Nr(e) {
    return (
      (function (e) {
        if (Array.isArray(e)) return n(e)
      })(e) ||
      (function (e) {
        if (
          ('undefined' != typeof Symbol && null != e[Symbol.iterator]) ||
          null != e['@@iterator']
        )
          return Array.from(e)
      })(e) ||
      o(e) ||
      (function () {
        throw new TypeError(
          'Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
        )
      })()
    )
  }
  function Lr(e) {
    return null == e || Array.isArray(e) ? e : [e]
  }
  var Ir = (function () {
    function n() {
      var t = this,
        e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : [],
        r =
          1 < arguments.length && void 0 !== arguments[1]
            ? arguments[1]
            : ['id']
      G(this, n),
        (this._list = []),
        (this._dict = {}),
        (this._indices = Nr(r)),
        this._indices.forEach(function (e) {
          t._dict[e] = {}
        }),
        e.forEach(function (e) {
          return t.register(e)
        })
    }
    return (
      p(
        n,
        [
          {
            key: 'register',
            value: function (t) {
              var r = this
              n.registerInList(this._list, t),
                this._indices.forEach(function (e) {
                  n.registerInDict(r._dict[e], Lr(t[e]), t)
                })
            }
          },
          {
            key: 'unregister',
            value: function (t) {
              var r = this
              n.unregisterFromList(this._list, t),
                this._indices.forEach(function (e) {
                  n.unregisterFromDict(r._dict[e], Lr(t[e]), t)
                })
            }
          },
          {
            key: 'all',
            get: function () {
              return Nr(this._list)
            }
          },
          {
            key: 'first',
            get: function () {
              return this._list[0]
            }
          },
          {
            key: 'keys',
            value: function (e) {
              return Object.keys(this._dict[e || this._indices[0]])
            }
          },
          {
            key: 'get',
            value: function (e, t) {
              t = this._dict[t || this._indices[0]]
              if (t) {
                e = t[e && e.toLowerCase()]
                return e && 0 < e.length ? e[0] : void 0
              }
            }
          }
        ],
        [
          {
            key: 'registerInList',
            value: function (e, t) {
              e.includes(t) || e.push(t)
            }
          },
          {
            key: 'unregisterFromList',
            value: function (e, t) {
              t = e.indexOf(t)
              ;-1 !== t && e.splice(t, 1)
            }
          },
          {
            key: 'registerInDict',
            value: function (t, e, r) {
              e.forEach(function (e) {
                e = e.toLowerCase()
                e = t[e] = t[e] || []
                e.includes(r) || e.push(r)
              })
            }
          },
          {
            key: 'unregisterFromDict',
            value: function (n, e, i) {
              e.forEach(function (e) {
                e = e.toLowerCase()
                var t,
                  r = n[e]
                r &&
                  (-1 !== (t = r.indexOf(i)) && r.splice(t, 1),
                  0 === r.length && delete n[e])
              })
            }
          }
        ]
      ),
      n
    )
  })()
  function Or(e) {
    Object.defineProperties(e, {
      logger: {
        get: function () {
          return this.context && this.context.logger ? this.context.logger : L
        }
      },
      settings: {
        get: function () {
          return this.context && this.context.settings
            ? this.context.settings
            : Q
        }
      }
    })
  }
  function Br(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Vr = (function () {
    function n(e, t) {
      G(this, n), (this._position = e), (this._radius = t)
    }
    return (
      p(n, [
        {
          key: 'raycast',
          value: function (e) {
            var t = n._sphere
            t.set(this._position, this._radius)
            var r = new ae.Vector3()
            return e.ray.intersectSphere(t, r)
              ? { distance: e.ray.origin.distanceTo(r), point: r }
              : null
          }
        }
      ]),
      n
    )
  })()
  be(Vr, '_sphere', new ae.Sphere())
  function Dr(e) {
    return (function () {
      x(s, e)
      var o = Br(s)
      function s(e) {
        var t
        G(this, s)
        for (
          var r = arguments.length, n = new Array(1 < r ? r - 1 : 0), i = 1;
          i < r;
          i++
        )
          n[i - 1] = arguments[i]
        return (
          ((t = o.call.apply(o, [this].concat(n)))._objects = new Array(e)),
          (t.boundingSphere = null),
          (t.boundingBox = null),
          t
        )
      }
      return (
        p(s, [
          {
            key: 'setSphere',
            value: function (e, t, r) {
              this._objects[e] = new Vr(t, r)
            }
          },
          {
            key: 'raycast',
            value: function (e, t) {
              for (var r = 0, n = this._objects.length; r < n; ++r) {
                var i = this._objects[r].raycast(e)
                i && ((i.chunkIdx = r), t.push(i))
              }
            }
          },
          {
            key: 'computeBoundingBox',
            value: function () {
              var e = this._objects,
                t = this.boundingBox
              null === t && (this.boundingBox = t = new ae.Box3()),
                t.makeEmpty()
              for (var r = 0, n = e.length; r < n; ++r)
                t.expandByPoint(e[r]._position)
            }
          },
          {
            key: 'computeBoundingSphere',
            value: function () {
              this.computeBoundingBox()
              var e = this._objects,
                t = this.boundingBox,
                r = 0,
                n = new ae.Vector3()
              t.getCenter(n)
              for (var i = 0, o = e.length; i < o; ++i) {
                var s = e[i]._position,
                  s = n.distanceToSquared(s)
                r < s && (r = s)
              }
              null === this.boundingSphere &&
                (this.boundingSphere = new ae.Sphere()),
                this.boundingSphere.set(n, Math.sqrt(r))
            }
          }
        ]),
        s
      )
    })()
  }
  function zr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Fr = new ae.Color(),
    Ur = le.copySubArrays
  var Gr = (function () {
    x(o, Dr(ae.InstancedBufferGeometry))
    var i = zr(o)
    function o(e, t, r) {
      var n
      return (
        G(this, o),
        ((n = i.call(this, e))._sphGeometry = r
          ? new ae.PlaneBufferGeometry(2, 2, 1, 1)
          : new ae.SphereBufferGeometry(
              1,
              2 * t,
              t,
              0,
              2 * Math.PI,
              0,
              Math.PI
            )),
        n._init(e, n._sphGeometry),
        n
      )
    }
    return (
      p(o, [
        {
          key: 'setItem',
          value: function (e, t, r) {
            var n, i, o, s, a, l
            ;(n = this._offsets),
              (i = 4 * e),
              (o = t.x),
              (s = t.y),
              (a = t.z),
              (l = r),
              (n[i] = o),
              (n[i + 1] = s),
              (n[i + 2] = a),
              (n[i + 3] = l),
              this.setSphere(e, t, r)
          }
        },
        {
          key: 'setColor',
          value: function (e, t) {
            var r, n, i
            Fr.set(t),
              (r = this._colors),
              (n = 3 * e),
              (i = Fr.r),
              (t = Fr.g),
              (e = Fr.b),
              (r[n] = i),
              (r[n + 1] = t),
              (r[n + 2] = e)
          }
        },
        {
          key: 'startUpdate',
          value: function () {
            return !0
          }
        },
        {
          key: 'finishUpdate',
          value: function () {
            ;(this.getAttribute('offset').needsUpdate = !0),
              (this.getAttribute('color').needsUpdate = !0)
          }
        },
        {
          key: 'finalize',
          value: function () {
            this.finishUpdate(), this.computeBoundingSphere()
          }
        },
        {
          key: 'setOpacity',
          value: function (e, t) {
            for (var r = this._alpha, n = 0, i = e.length; n < i; ++n)
              r[e[n]] = t
            this.getAttribute('alphaColor').needsUpdate = !0
          }
        },
        {
          key: 'getSubset',
          value: function (e) {
            var t = e.length,
              r = new ae.InstancedBufferGeometry()
            return (
              this._init.call(r, t, this._sphGeometry),
              Ur(this._offsets, r._offsets, e, 4),
              Ur(this._colors, r._colors, e, 3),
              (r.boundingSphere = this.boundingSphere),
              (r.boundingBox = this.boundingBox),
              [r]
            )
          }
        },
        {
          key: '_init',
          value: function (e, t) {
            this.copy(t),
              (this._offsets = le.allocateTyped(Float32Array, 4 * e)),
              (this._colors = le.allocateTyped(Float32Array, 3 * e))
            e = this._alpha = le.allocateTyped(Float32Array, e)
            b.default.fill(e, 1),
              this.setAttribute(
                'offset',
                new ae.InstancedBufferAttribute(this._offsets, 4, !1, 1)
              ),
              this.setAttribute(
                'color',
                new ae.InstancedBufferAttribute(this._colors, 3, !1, 1)
              ),
              this.setAttribute(
                'alphaColor',
                new ae.InstancedBufferAttribute(e, 1, !1, 1)
              )
          }
        }
      ]),
      o
    )
  })()
  function jr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Hr = new ae.Color(),
    Wr = (function () {
      x(i, ae.BufferGeometry)
      var n = jr(i)
      function i(e, t) {
        var r
        if ((G(this, i), (r = n.call(this)).constructor === i))
          throw new Error('Can not instantiate abstract class!')
        return (r._chunkGeo = e), r._init(e, t), r
      }
      return (
        p(i, [
          {
            key: 'startUpdate',
            value: function () {
              return !0
            }
          },
          {
            key: 'finishUpdate',
            value: function () {
              ;(this.getAttribute('position').needsUpdate = !0),
                (this.getAttribute('normal').needsUpdate = !0),
                (this.getAttribute('color').needsUpdate = !0)
            }
          },
          {
            key: 'setColor',
            value: function (e, t) {
              Hr.set(t)
              for (
                var r = this._colors, t = this._chunkSize, n = e * t, i = n + t;
                n < i;
                ++n
              ) {
                var o = 3 * n
                ;(r[o] = Hr.r), (r[1 + o] = Hr.g), (r[2 + o] = Hr.b)
              }
            }
          },
          {
            key: 'finalize',
            value: function () {
              this.finishUpdate(), this.computeBoundingSphere()
            }
          },
          {
            key: 'setOpacity',
            value: function (e, t) {
              for (
                var r = this._alpha, n = this._chunkSize, i = 0, o = e.length;
                i < o;
                ++i
              ) {
                var s = e[i] * n
                b.default.fill(r, t, s, s + n)
              }
              this.getAttribute('alphaColor').needsUpdate = !0
            }
          },
          {
            key: 'raycast',
            value: function (e, t) {
              var r = [],
                n = new ae.Mesh()
              ;(n.geometry = this), n.raycast(e, r)
              for (
                var i = this._chunkGeo.index.count / 3, o = 0, s = r.length;
                o < s;
                ++o
              )
                r[o].hasOwnProperty('faceIndex') &&
                  ((r[o].chunkIdx = Math.floor(r[o].faceIndex / i)),
                  t.push(r[o]))
            }
          },
          {
            key: 'getSubset',
            value: function (e) {
              var t = e.length,
                r = new ae.BufferGeometry()
              this._init.call(r, this._chunkGeo, t)
              for (
                var n = this._positions,
                  i = this._normals,
                  o = this._colors,
                  s = r._positions,
                  a = r._normals,
                  l = r._colors,
                  c = 3 * this._chunkSize,
                  u = 0,
                  h = e.length;
                u < h;
                ++u
              ) {
                var f = u * c,
                  d = e[u] * c,
                  p = d + c
                s.set(n.subarray(d, p), f),
                  a.set(i.subarray(d, p), f),
                  l.set(o.subarray(d, p), f)
              }
              return (
                (r.boundingSphere = this.boundingSphere),
                (r.boundingBox = this.boundingBox),
                [r]
              )
            }
          },
          {
            key: '_init',
            value: function (e, t) {
              var r = (this._chunkSize = e.attributes.position.count),
                n = e.index.array,
                i = n.length,
                e = this._chunkSize * t,
                o = (this._index = le.allocateTyped(
                  65535 < e ? Uint32Array : Uint16Array,
                  i * t
                ))
              ;(this._positions = le.allocateTyped(Float32Array, 3 * e)),
                (this._normals = le.allocateTyped(Float32Array, 3 * e)),
                (this._colors = le.allocateTyped(Float32Array, 3 * e))
              e = this._alpha = le.allocateTyped(Float32Array, e)
              b.default.fill(e, 1)
              for (var s = 0; s < t; ++s) {
                var a = s * i,
                  l = s * r
                o.set(n, a)
                for (var c = 0; c < i; ++c) o[a + c] += l
              }
              this.setIndex(new ae.BufferAttribute(this._index, 1)),
                this.setAttribute(
                  'position',
                  new ae.BufferAttribute(this._positions, 3)
                ),
                this.setAttribute(
                  'normal',
                  new ae.BufferAttribute(this._normals, 3)
                ),
                this.setAttribute(
                  'color',
                  new ae.BufferAttribute(this._colors, 3)
                ),
                this.setAttribute('alphaColor', new ae.BufferAttribute(e, 1))
            }
          }
        ]),
        i
      )
    })()
  function Yr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Xr = (function () {
    x(l, Dr(Wr))
    var a = Yr(l)
    function l(e, t) {
      G(this, l)
      var r = new ae.SphereBufferGeometry(
          1,
          2 * t,
          t,
          0,
          2 * Math.PI,
          0,
          Math.PI
        ),
        n = (t = a.call(this, e, r, e))._normals,
        i = r.attributes.normal.array,
        o = t._chunkSize
      ;(t._chunkPos = t._chunkGeo.attributes.position.array),
        (t._tmpPositions = le.allocateTyped(Float32Array, 3 * o))
      for (var s = 0; s < e; ++s) n.set(i, 3 * o * s)
      return t
    }
    return (
      p(l, [
        {
          key: 'setItem',
          value: function (e, t, r) {
            for (
              var n = this._tmpPositions,
                i = this._chunkSize,
                o = this._chunkPos,
                s = 0;
              s < i;
              ++s
            ) {
              var a = 3 * s
              ;(n[a] = t.x + o[a] * r),
                (n[1 + a] = t.y + o[1 + a] * r),
                (n[2 + a] = t.z + o[2 + a] * r)
            }
            this._positions.set(n, i * e * 3), this.setSphere(e, t, r)
          }
        }
      ]),
      l
    )
  })()
  function qr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var $r = new ae.Vector3(),
    Zr = new ae.Vector3(),
    Kr = new ae.Matrix3(),
    Qr = (function () {
      x(n, Wr)
      var r = qr(n)
      function n(e, t) {
        G(this, n)
        var t = new ae.CylinderBufferGeometry(1, 1, 1, Math.max(3, t), 2, !0),
          e = (t = r.call(this, t, 2 * e))._chunkSize
        return (
          (t._chunkPos = t._chunkGeo.attributes.position.array),
          (t._chunkNorms = t._chunkGeo.attributes.normal.array),
          (t._tmpVector = le.allocateTyped(Float32Array, 3 * e)),
          t
        )
      }
      return (
        p(n, [
          {
            key: 'setItem',
            value: function (e, t, r, n) {
              var i = this._chunkSize,
                o = 2 * i * e * 3,
                e = o + 3 * i,
                s = this._tmpVector,
                a = this._chunkPos,
                l = this._chunkNorms
              $r.lerpVectors(t, r, 0.5)
              var c,
                u = kr.calcCylinderMatrix(t, $r, n)
              Kr.getNormalMatrix(u)
              for (var h = 0; h < i; ++h)
                Zr.fromArray(a, (c = 3 * h)),
                  Zr.applyMatrix4(u),
                  Zr.toArray(s, c)
              this._positions.set(s, o), $r.sub(t)
              for (var f = 0; f < i; ++f)
                (s[(c = 3 * f)] += $r.x), (s[c + 1] += $r.y), (s[c + 2] += $r.z)
              this._positions.set(s, e)
              for (var d = 0; d < i; ++d)
                Zr.fromArray(l, (c = 3 * d)),
                  Zr.applyMatrix3(Kr),
                  Zr.toArray(s, c)
              this._normals.set(s, o), this._normals.set(s, e)
            }
          },
          {
            key: 'setColor',
            value: function (e, t, r) {
              e *= 2
              Xe(C(n.prototype), 'setColor', this).call(this, e, t)
              e = 1 + e
              Xe(C(n.prototype), 'setColor', this).call(this, e, r)
            }
          }
        ]),
        n
      )
    })()
  function Jr(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var en = (function () {
    x(U, ae.BufferGeometry)
    var F = Jr(U)
    function U(e, t, r, n, i, o) {
      G(this, U)
      var s = F.call(this),
        a = 2 * Math.PI
      s.type = 'CylinderBufferGeometry'
      for (
        var l =
            !(s.parameters = {
              radiusTop: e,
              radiusBottom: t,
              height: r,
              radialSegments: n,
              heightSegments: i,
              openEnded: o
            }) === o && 0 < e,
          c = !1 === o && 0 < t,
          u = (i + 1) * n + l * (n + 1) + c * (n + 1),
          o = (2 * i + l + c) * n,
          h = r / 2,
          f = new ae.BufferAttribute(le.allocateTyped(Float32Array, 3 * u), 3),
          d = new ae.BufferAttribute(le.allocateTyped(Float32Array, 3 * u), 3),
          p = new ae.Uint16BufferAttribute(
            le.allocateTyped(Uint16Array, 3 * o),
            1
          ),
          m = new ae.BufferAttribute(le.allocateTyped(Float32Array, 2 * u), 2),
          y = 0,
          _ = 0,
          v = -(t - e) / r,
          g = 0;
        g <= i;
        g++
      ) {
        if (g !== i)
          for (var x = 0; x < n; x++) {
            var b = y + n + x,
              w = y + n + ((x + 1) % n),
              S = y + ((x + 1) % n)
            p.setXYZ(3 * _, y + x, S, b), _++, p.setXYZ(3 * _, b, S, w), _++
          }
        for (var R = g / i, C = R * (t - e) + e, A = 0; A < n; A++) {
          var E = A / n,
            k = C * Math.sin(E * a + 0),
            T = R * r - h,
            P = C * Math.cos(E * a + 0),
            M = new ae.Vector3(k, Math.sqrt(k * k + P * P) * v, P).normalize()
          f.setXYZ(y, k, T, P),
            d.setXYZ(y, M.x, M.y, M.z),
            m.setXY(y, E, R),
            ++y
        }
      }
      if (l) {
        for (var N = y, L = y + n, I = 0; I < n; ++I) {
          var O = y - n
          f.setXYZ(y, f.getX(O), f.getY(O), f.getZ(O)),
            d.setXYZ(y, 0, 1, 0),
            m.setXY(y, 1, 1),
            p.setXYZ(3 * _, y, N + ((I + 1) % n), L),
            _++,
            y++
        }
        f.setXYZ(y, 0, h, 0), d.setXYZ(y, 0, 1, 0), m.setXY(y, 1, 1), ++y
      }
      if (c) {
        for (var B = y, V = y + n, D = 0; D < n; ++D) {
          var z = D
          f.setXYZ(y, f.getX(z), f.getY(z), f.getZ(z)),
            d.setXYZ(y, 0, -1, 0),
            m.setXY(y, 0, 0),
            p.setXYZ(3 * _, B + ((D + 1) % n), y, V),
            _++,
            y++
        }
        f.setXYZ(y, 0, -h, 0), d.setXYZ(y, 0, -1, 0), m.setXY(y, 0, 0)
      }
      return (
        s.setIndex(p),
        s.setAttribute('position', f),
        s.setAttribute('normal', d),
        s.setAttribute('uv', m),
        s
      )
    }
    return (
      p(U, [
        {
          key: 'clone',
          value: function () {
            var e = this.parameters
            return new U(
              e.radiusTop,
              e.radiusBottom,
              e.height,
              e.radialSegments,
              e.heightSegments,
              e.openEnded
            )
          }
        }
      ]),
      U
    )
  })()
  function tn(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var rn = new ae.Color(),
    nn = new ae.Matrix4(),
    on = le.copySubArrays
  function sn(e, t, r, n, i) {
    ;(e[t] = r), (e[t + 1] = n), (e[t + 2] = i)
  }
  function an(e, t, r, n, i, o) {
    ;(e[t] = r), (e[t + 1] = n), (e[t + 2] = i), (e[t + 3] = o)
  }
  function ln(e, t) {
    return e - t
  }
  var cn = (function () {
    x(s, ae.InstancedBufferGeometry)
    var o = tn(s)
    function s(e, t, r, n) {
      var i
      return (
        G(this, s),
        ((i = o.call(this))._useZSprites = r),
        (i._cylGeometry = r
          ? new ae.PlaneBufferGeometry(2, 2, 1, 1)
          : new en(1, 1, 1, Math.max(3, t), 2, n)),
        i._init(e, i._cylGeometry, i._useZSprites),
        (i._collisionGeo = new Qr(e, 3)),
        i
      )
    }
    return (
      p(s, [
        {
          key: 'setItem',
          value: function (e, t, r, n) {
            var i = kr.calcCylinderMatrix(t, r, n),
              o = i.elements,
              s = 4 * e
            this._collisionGeo.setItem(e, t, r, n),
              an(this._matVector1, s, o[0], o[4], o[8], o[12]),
              an(this._matVector2, s, o[1], o[5], o[9], o[13]),
              an(this._matVector3, s, o[2], o[6], o[10], o[14]),
              this._useZSprites &&
                (nn.copy(i).invert(),
                (o = nn.elements),
                an(this._invmatVector1, s, o[0], o[4], o[8], o[12]),
                an(this._invmatVector2, s, o[1], o[5], o[9], o[13]),
                an(this._invmatVector3, s, o[2], o[6], o[10], o[14]))
          }
        },
        {
          key: 'setColor',
          value: function (e, t, r) {
            e *= 3
            rn.set(t),
              sn(this._color1, e, rn.r, rn.g, rn.b),
              rn.set(r),
              sn(this._color2, e, rn.r, rn.g, rn.b)
          }
        },
        {
          key: 'computeBoundingSphere',
          value: function () {
            this._collisionGeo.computeBoundingSphere(),
              (this.boundingSphere = this._collisionGeo.boundingSphere)
          }
        },
        {
          key: 'computeBoundingBox',
          value: function () {
            this._collisionGeo.computeBoundingBox(),
              (this.boundingBox = this._collisionGeo.boundingBox)
          }
        },
        {
          key: 'raycast',
          value: function (e, t) {
            this._collisionGeo.raycast(e, t)
          }
        },
        {
          key: 'startUpdate',
          value: function () {
            return !0
          }
        },
        {
          key: 'finishUpdate',
          value: function () {
            ;(this.getAttribute('matVector1').needsUpdate = !0),
              (this.getAttribute('matVector2').needsUpdate = !0),
              (this.getAttribute('matVector3').needsUpdate = !0),
              (this.getAttribute('color').needsUpdate = !0),
              (this.getAttribute('color2').needsUpdate = !0),
              (this.getAttribute('alphaColor').needsUpdate = !0),
              this._useZSprites &&
                ((this.getAttribute('invmatVector1').needsUpdate = !0),
                (this.getAttribute('invmatVector2').needsUpdate = !0),
                (this.getAttribute('invmatVector3').needsUpdate = !0)),
              this._collisionGeo.finishUpdate()
          }
        },
        {
          key: 'finalize',
          value: function () {
            this.finishUpdate(), this.computeBoundingSphere()
          }
        },
        {
          key: 'setOpacity',
          value: function (e, t) {
            for (var r = this._alpha, n = 0, i = e.length; n < i; ++n)
              r[Math.floor(e[n] / 2)] = t
            this.getAttribute('alphaColor').needsUpdate = !0
          }
        },
        {
          key: 'getSubset',
          value: function (e) {
            var t = (function (e) {
                e.sort(ln)
                for (var t = [], r = [], n = 0, i = e.length; n < i; ++n) {
                  var o = e[n],
                    s = { first: !1, second: !1 }
                  ;(0 | o) % 2 == 0
                    ? ((s.first = !0),
                      (s.second = n + 1 < i && e[n + 1] === e[n] + 1),
                      s.second && ++n)
                    : (s.second = !0),
                    t.push(Math.floor(o / 2)),
                    r.push(s)
                }
                return { indices: t, cylinderInfo: r }
              })(e),
              r = t.indices,
              n = r.length,
              e = new ae.InstancedBufferGeometry()
            return (
              this._init.call(e, n, this._cylGeometry, this._useZSprites),
              on(this._matVector1, e._matVector1, r, 4),
              on(this._matVector2, e._matVector2, r, 4),
              on(this._matVector3, e._matVector3, r, 4),
              this._useZSprites &&
                (on(this._invmatVector1, e._invmatVector1, r, 4),
                on(this._invmatVector2, e._invmatVector2, r, 4),
                on(this._invmatVector3, e._invmatVector3, r, 4)),
              on(this._color1, e._color1, r, 3),
              on(this._color2, e._color2, r, 3),
              (function (e, t, r) {
                for (var n = 0, i = e.length; n < i; ++n) {
                  var o = e[n]
                  o.first || (t[3 * n] = -0.5), o.second || (r[3 * n] = -0.5)
                }
              })(t.cylinderInfo, e._color1, e._color2),
              (e.boundingSphere = this.boundingSphere),
              (e.boundingBox = this.boundingBox),
              [e]
            )
          }
        },
        {
          key: 'getGeoParams',
          value: function () {
            return this._cylGeometry.parameters
          }
        },
        {
          key: '_init',
          value: function (e, t, r) {
            this.copy(t),
              (this._matVector1 = le.allocateTyped(Float32Array, 4 * e)),
              (this._matVector2 = le.allocateTyped(Float32Array, 4 * e)),
              (this._matVector3 = le.allocateTyped(Float32Array, 4 * e)),
              (this._color1 = le.allocateTyped(Float32Array, 3 * e)),
              (this._color2 = le.allocateTyped(Float32Array, 3 * e))
            t = this._alpha = le.allocateTyped(Float32Array, e)
            b.default.fill(t, 1),
              this.setAttribute(
                'matVector1',
                new ae.InstancedBufferAttribute(this._matVector1, 4, !1, 1)
              ),
              this.setAttribute(
                'matVector2',
                new ae.InstancedBufferAttribute(this._matVector2, 4, !1, 1)
              ),
              this.setAttribute(
                'matVector3',
                new ae.InstancedBufferAttribute(this._matVector3, 4, !1, 1)
              ),
              this.setAttribute(
                'color',
                new ae.InstancedBufferAttribute(this._color1, 3, !1, 1)
              ),
              this.setAttribute(
                'color2',
                new ae.InstancedBufferAttribute(this._color2, 3, !1, 1)
              ),
              this.setAttribute(
                'alphaColor',
                new ae.InstancedBufferAttribute(this._alpha, 1, !1, 1)
              ),
              r &&
                ((this._invmatVector1 = le.allocateTyped(Float32Array, 4 * e)),
                (this._invmatVector2 = le.allocateTyped(Float32Array, 4 * e)),
                (this._invmatVector3 = le.allocateTyped(Float32Array, 4 * e)),
                this.setAttribute(
                  'invmatVector1',
                  new ae.InstancedBufferAttribute(this._invmatVector1, 4, !1, 1)
                ),
                this.setAttribute(
                  'invmatVector2',
                  new ae.InstancedBufferAttribute(this._invmatVector2, 4, !1, 1)
                ),
                this.setAttribute(
                  'invmatVector3',
                  new ae.InstancedBufferAttribute(this._invmatVector3, 4, !1, 1)
                ))
          }
        }
      ]),
      s
    )
  })()
  function un(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var hn = 3,
    fn = 3,
    dn = new ae.Vector3(),
    pn = new ae.Vector3(),
    mn = new ae.Vector3(),
    yn = new ae.Vector3(1, 0, 0),
    _n = new ae.Vector3(),
    vn = new ae.Vector3()
  var gn = (function () {
    x(a, Wr)
    var s = un(a)
    function a(e, t, r) {
      G(this, a)
      var n = (function (e, t) {
        for (
          var r = new ae.BufferGeometry(),
            n = e.length,
            i = n * t,
            o = i <= 65536 ? Uint16Array : Uint32Array,
            s = new ae.BufferAttribute(
              le.allocateTyped(o, (t - 1) * n * 2 * fn),
              1
            ),
            a = 0,
            l = 0,
            c = 0;
          c < t;
          c++
        ) {
          if (c !== t - 1)
            for (var u = 0; u < n; u++) {
              var h = a + n + u,
                f = a + n + ((u + 1) % n),
                d = a + ((u + 1) % n)
              s.setXYZ(l * fn, a + u, d, h), l++, s.setXYZ(l * fn, h, d, f), l++
            }
          a += n
        }
        return (
          r.setIndex(s),
          (i = le.allocateTyped(Float32Array, i * hn)),
          r.setAttribute('position', new ae.BufferAttribute(i, hn)),
          (r._positions = e),
          r
        )
      })(e, t)
      ;(r = s.call(this, n, r))._ringsCount = t
      for (var i = (r._tmpShape = []), o = 0; o < e.length; ++o)
        i[o] = new ae.Vector3()
      return r
    }
    return (
      p(a, [
        {
          key: 'setItem',
          value: function (e, t) {
            var r =
                2 < arguments.length && void 0 !== arguments[2] && arguments[2],
              n =
                3 < arguments.length && void 0 !== arguments[3] && arguments[3],
              i = this._chunkGeo._positions.length,
              o = this._ringsCount,
              e = i * this._ringsCount * e * hn
            this._setPoints(t, i, o, e),
              r
                ? this._setSlopeNormals(i, o, e)
                : this._setBaseNormals(i, o, e),
              n && this._addCut(i, o, e)
          }
        },
        {
          key: '_setPoints',
          value: function (e, t, r, n) {
            for (
              var i = this._tmpShape,
                o = this._positions,
                s = this._chunkGeo._positions,
                a = 0,
                l = n;
              a < r;
              ++a
            )
              for (var c = e[a], u = 0; u < t; ++u, l += hn)
                i[u].copy(s[u]).applyMatrix4(c).toArray(o, l)
          }
        },
        {
          key: '_setBaseNormals',
          value: function (e, t, r) {
            for (var n = e * hn, i = 0, o = r; i < t; ++i, o += n)
              this._countNormalsInRing(e, o, !1)
          }
        },
        {
          key: '_setSlopeNormals',
          value: function (e, t, r) {
            for (
              var n = this._normals, i = e * hn, o = r, s = 0;
              s < e;
              ++s, o += hn
            )
              yn.toArray(n, o)
            if (0 < o - 2 * i)
              for (var a = 0; a < e; ++a, o += hn)
                mn.fromArray(n, o - 2 * i).toArray(n, o)
            else this._countNormalsInRing(e, o, !0, +i), (o += i)
            for (var l = 2; l < t; ++l, o += i)
              this._countNormalsInRing(e, o, !0, -i)
          }
        },
        {
          key: '_countNormalsInRing',
          value: function (e, t, r, n) {
            var i = this._tmpShape,
              o = this._normals
            i[0].fromArray(this._positions, t),
              i[e - 1].fromArray(this._positions, t + (e - 1) * hn)
            for (var s = 0; s < e; ++s, t += hn)
              s < e - 1 && i[s + 1].fromArray(this._positions, t + hn),
                r
                  ? (vn.fromArray(this._positions, t + n),
                    dn
                      .subVectors(i[(s + e - 1) % e], i[(s + 1) % e])
                      .normalize(),
                    pn.subVectors(i[s], vn).normalize(),
                    mn.crossVectors(pn, dn).normalize().toArray(o, t))
                  : (dn.subVectors(i[s], i[(s + e - 1) % e]).normalize(),
                    pn.subVectors(i[s], i[(s + 1) % e]).normalize(),
                    mn.addVectors(dn, pn).normalize().toArray(o, t))
          }
        },
        {
          key: '_addCut',
          value: function (e, t, r) {
            if (!(e < 3 || t < 2)) {
              var n = this._positions,
                i = this._normals,
                o = this._tmpShape,
                s = e * hn
              o[0].fromArray(n, r),
                o[1].fromArray(n, r + hn),
                o[2].fromArray(n, r + 2 * hn),
                dn.subVectors(o[1], o[0]).normalize(),
                pn.subVectors(o[1], o[2]).normalize(),
                _n.crossVectors(dn, pn).normalize()
              for (var a = r, l = 0; l < 2 * e; ++l, a += hn) _n.toArray(i, a)
              if (2 < t)
                for (var c = 0; c < e; ++c, a += hn)
                  mn.fromArray(n, a - s).toArray(n, a)
            }
          }
        }
      ]),
      a
    )
  })()
  function xn(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var bn = new ae.Color(),
    wn = new ae.Vector3()
  function Sn(e, t, r, n, i) {
    ;(e[t] = r), (e[t + 1] = n), (e[t + 2] = i)
  }
  function Rn(e, t, r, n, i, o) {
    ;(e[t] = r), (e[t + 1] = n), (e[t + 2] = i), (e[t + 3] = o)
  }
  function Cn(e, t, r, n) {
    t *= 4
    return e.subarray(t * n, (t + 4 * r) * n)
  }
  var An = (function () {
    x(n, ae.BufferGeometry)
    var r = xn(n)
    function n(e) {
      var t
      return G(this, n), (t = r.call(this))._initVertices(e), t
    }
    return (
      p(n, [
        {
          key: 'startUpdate',
          value: function () {
            return !0
          }
        },
        {
          key: 'finishUpdate',
          value: function () {
            ;(this.getAttribute('position').needsUpdate = !0),
              (this.getAttribute('color').needsUpdate = !0),
              (this.getAttribute('alphaColor').needsUpdate = !0),
              (this.getAttribute('direction').needsUpdate = !0)
          }
        },
        {
          key: 'setColor',
          value: function (e, t) {
            bn.set(t)
            e = 4 * e * 3
            Sn(this._colors, e, bn.r, bn.g, bn.b),
              Sn(this._colors, (e += 3), bn.r, bn.g, bn.b),
              Sn(this._colors, (e += 3), bn.r, bn.g, bn.b),
              Sn(this._colors, (e += 3), bn.r, bn.g, bn.b)
          }
        },
        {
          key: 'setSegment',
          value: function (e, t, r) {
            wn.subVectors(t, r), wn.normalize()
            var n = this._positions,
              i = this._directions,
              o = 4 * e * 4,
              e = 4 * e * 3
            Rn(n, o, t.x, t.y, t.z, 0.5),
              Sn(i, e, wn.x, wn.y, wn.z),
              (e += 3),
              Rn(n, (o += 4), t.x, t.y, t.z, -0.5),
              Sn(i, e, wn.x, wn.y, wn.z),
              (e += 3),
              Rn(n, (o += 4), r.x, r.y, r.z, 0.5),
              Sn(i, e, wn.x, wn.y, wn.z),
              (e += 3),
              Rn(n, (o += 4), r.x, r.y, r.z, -0.5),
              Sn(i, e, wn.x, wn.y, wn.z)
          }
        },
        {
          key: 'setOpacity',
          value: function (e, t, r) {
            b.default.fill(this.alpha, r, 4 * t, 4 * e),
              (this.getAttribute('alphaColor').needsUpdate = !0)
          }
        },
        {
          key: 'getSubsetSegments',
          value: function (e, t) {
            return [Cn(this._positions, e, t, 4), Cn(this._directions, e, t, 3)]
          }
        },
        {
          key: 'getSubsetColors',
          value: function (e, t) {
            return Cn(this._colors, e, t, 3)
          }
        },
        {
          key: 'getSubsetOpacities',
          value: function (e, t) {
            return Cn(this._alpha, e, t, 1)
          }
        },
        {
          key: 'getNumVertexPerSegment',
          value: function () {
            return 4
          }
        },
        {
          key: 'getPositionSize',
          value: function () {
            return 4
          }
        },
        {
          key: 'setSegments',
          value: function (e, t) {
            var r = 4 * e * 4
            t instanceof Array && 2 === t.length
              ? (this._positions.set(t[0], r),
                this._directions.set(t[1], 4 * e * 3))
              : this._positions.set(t, r)
          }
        },
        {
          key: 'setColors',
          value: function (e, t) {
            this._colors.set(t, 4 * e * 3)
          }
        },
        {
          key: '_initVertices',
          value: function (e) {
            this._buffersSize = 4 * e
            var t = this._buffersSize
            ;(this._index = le.allocateTyped(
              65535 < t ? Uint32Array : Uint16Array,
              6 * e
            )),
              (this._positions = le.allocateTyped(Float32Array, 4 * t)),
              (this._colors = le.allocateTyped(Float32Array, 3 * t)),
              (this._directions = le.allocateTyped(Float32Array, 3 * t))
            t = this._alpha = le.allocateTyped(Float32Array, t)
            b.default.fill(t, 1)
            for (
              var r = this._index, n = 0, i = 0, o = 0;
              o < e;
              o++, n += 6, i += 4
            )
              (r[n] = i),
                (r[n + 1] = i + 1),
                (r[n + 2] = i + 3),
                (r[n + 3] = i),
                (r[n + 4] = i + 2),
                (r[n + 5] = i + 3)
            this.setIndex(new ae.BufferAttribute(this._index, 1)),
              this.setAttribute(
                'position',
                new ae.BufferAttribute(this._positions, 4)
              ),
              this.setAttribute(
                'color',
                new ae.BufferAttribute(this._colors, 3)
              ),
              this.setAttribute('alphaColor', new ae.BufferAttribute(t, 1)),
              this.setAttribute(
                'direction',
                new ae.BufferAttribute(this._directions, 3)
              )
          }
        }
      ]),
      n
    )
  })()
  function En(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var kn = (function () {
    x(t, An)
    var e = En(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'startUpdate',
          value: function () {
            return !0
          }
        },
        {
          key: 'computeBoundingSphere',
          value: function () {
            var e = this.boundingBox,
              t = 0,
              r = new ae.Vector3()
            e && e.getCenter(r)
            for (
              var n = this._positions,
                e = this.boundingSphere || new ae.Sphere(),
                i = this._positions.length,
                o = new ae.Vector3(),
                s = this.getPositionSize(),
                a = 0;
              a < i;
              a += s
            ) {
              o.set(n[a], n[a + 1], n[a + 2])
              var l = r.distanceToSquared(o)
              t < l && (t = l)
            }
            e.set(r, Math.sqrt(t)), (this.boundingSphere = e)
          }
        },
        {
          key: 'computeBoundingBox',
          value: function () {
            for (
              var e = this._positions,
                t = new ae.Box3(),
                r = this._positions.length,
                n = new ae.Vector3(),
                i = this.getPositionSize(),
                o = 0;
              o < r;
              o += i
            )
              n.set(e[o], e[o + 1], e[o + 2]), t.expandByPoint(n)
            this.boundingBox = t
          }
        },
        {
          key: 'finalize',
          value: function () {
            this.finishUpdate(), this.computeBoundingSphere()
          }
        }
      ]),
      t
    )
  })()
  function Tn(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Pn = new ae.Vector3(),
    Mn = new ae.Matrix3(),
    Nn = (function () {
      x(n, Wr)
      var r = Tn(n)
      function n(e, t) {
        G(this, n)
        var t = new ae.CylinderBufferGeometry(1, 1, 1, Math.max(3, t), 2, !0),
          e = (t = r.call(this, t, e))._chunkSize
        return (
          (t._chunkPos = t._chunkGeo.attributes.position.array),
          (t._chunkNorms = t._chunkGeo.attributes.normal.array),
          (t._tmpVector = le.allocateTyped(Float32Array, 3 * e)),
          t
        )
      }
      return (
        p(n, [
          {
            key: 'setItem',
            value: function (e, t, r, n) {
              var i,
                o = this._chunkSize,
                e = o * e * 3,
                s = this._tmpVector,
                a = this._chunkPos,
                l = this._chunkNorms,
                c = kr.calcCylinderMatrix(t, r, n)
              Mn.getNormalMatrix(c)
              for (var u = 0; u < o; ++u)
                Pn.fromArray(a, (i = 3 * u)),
                  Pn.applyMatrix4(c),
                  Pn.toArray(s, i)
              this._positions.set(s, e)
              for (var h = 0; h < o; ++h)
                Pn.fromArray(l, (i = 3 * h)),
                  Pn.applyMatrix3(Mn),
                  Pn.toArray(s, i)
              this._normals.set(s, e)
            }
          }
        ]),
        n
      )
    })()
  function Ln(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var In = (function () {
    x(l, kn)
    var i = Ln(l)
    function l(e, t, r) {
      var n
      return (
        G(this, l),
        (n = i.call(this, e * t))._init(t),
        (n._collisionGeo = r ? new Nn(e * t, 3) : null),
        n
      )
    }
    return (
      p(l, [
        {
          key: 'startUpdate',
          value: function () {
            return !0
          }
        },
        {
          key: 'computeBoundingSphere',
          value: function () {
            var e = this._collisionGeo
            if (e)
              return (
                e.computeBoundingSphere(),
                void (this.boundingSphere = e.boundingSphere)
              )
            Xe(C(l.prototype), 'computeBoundingSphere', this).call(this)
          }
        },
        {
          key: 'computeBoundingBox',
          value: function () {
            var e = this._collisionGeo
            if (e)
              return (
                e.computeBoundingBox(), void (this.boundingBox = e.boundingBox)
              )
            Xe(C(l.prototype), 'computeBoundingBox', this).call(this)
          }
        },
        {
          key: 'raycast',
          value: function (e, t) {
            if (this._collisionGeo) {
              var r = this._chunkSize
              this._collisionGeo.raycast(e, t)
              for (var n = 0, i = t.length; n < i; ++n) {
                var o = t[n].chunkIdx
                void 0 !== o && (t[n].chunkIdx = (o / r) | 0)
              }
            }
          }
        },
        {
          key: 'setColor',
          value: function (e, t) {
            for (var r = this._chunkSize, n = e * r, i = n + r; n < i; ++n)
              Xe(C(l.prototype), 'setColor', this).call(this, n, t)
          }
        },
        {
          key: 'setSegment',
          value: function (e, t, r, n) {
            var i = this._chunkSize,
              o = e * i + t
            Xe(C(l.prototype), 'setSegment', this).call(this, o, r, n),
              this._collisionGeo &&
                this._collisionGeo.setItem(e * i + t, r, n, 0.1)
          }
        },
        {
          key: 'finalize',
          value: function () {
            this.finishUpdate(), this.computeBoundingSphere()
          }
        },
        {
          key: 'setOpacity',
          value: function (e, t) {
            for (var r = this._chunkSize, n = 0, i = e.length; n < i; ++n) {
              var o = e[n] * r
              Xe(C(l.prototype), 'setOpacity', this).call(this, o, o + r - 1, t)
            }
          }
        },
        {
          key: 'getSubset',
          value: function (e) {
            for (
              var t = e.length,
                r = this._chunkSize,
                n = new l(t, r, !1),
                i = 0,
                o = e.length;
              i < o;
              ++i
            ) {
              var s = i * r,
                a = e[i] * r
              n.setSegments(s, this.getSubsetSegments(a, r)),
                n.setColors(s, this.getSubsetColors(a, r))
            }
            return (
              (n.boundingSphere = this.boundingSphere),
              (n.boundingBox = this.boundingBox),
              [n]
            )
          }
        },
        {
          key: '_init',
          value: function (e) {
            this._chunkSize = e
          }
        }
      ]),
      l
    )
  })()
  function On(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Bn = new ae.Vector3(),
    Vn = (function () {
      x(s, kn)
      var r = On(s)
      function s(e) {
        var t
        return (
          G(this, s),
          (t = r.call(this, 2 * e))._init(e),
          (t._collisionGeo = new Qr(e, 3)),
          t
        )
      }
      return (
        p(s, [
          {
            key: 'setItem',
            value: function (e, t, r) {
              this._collisionGeo.setItem(e, t, r, 0.3)
              e *= 2
              Bn.lerpVectors(t, r, 0.5),
                Xe(C(s.prototype), 'setSegment', this).call(this, e, t, Bn),
                Xe(C(s.prototype), 'setSegment', this).call(this, 1 + e, Bn, r)
            }
          },
          {
            key: 'setColor',
            value: function (e, t, r) {
              e *= 2
              Xe(C(s.prototype), 'setColor', this).call(this, e, t),
                Xe(C(s.prototype), 'setColor', this).call(this, 1 + e, r)
            }
          },
          {
            key: 'raycast',
            value: function (e, t) {
              this._collisionGeo && this._collisionGeo.raycast(e, t)
            }
          },
          {
            key: 'getSubset',
            value: function (e) {
              for (var t = e.length, r = new s(t), n = 0, i = t; n < i; ++n) {
                var o = e[n]
                r.setSegments(n, this.getSubsetSegments(o, 1)),
                  r.setColors(n, this.getSubsetColors(o, 1))
              }
              return (
                (r.boundingSphere = this.boundingSphere),
                (r.boundingBox = this.boundingBox),
                [r]
              )
            }
          },
          {
            key: '_init',
            value: function (e) {
              this._segCounts = 2 * e
            }
          }
        ]),
        s
      )
    })()
  function Dn(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var zn = [
      new ae.Vector3(1, 0, 0),
      new ae.Vector3(-1, 0, 0),
      new ae.Vector3(0, 1, 0),
      new ae.Vector3(0, -1, 0),
      new ae.Vector3(0, 0, 1),
      new ae.Vector3(0, 0, -1)
    ],
    Fn = zn.length,
    Un = new ae.Vector3(),
    Gn = new ae.Vector3(),
    jn = (function () {
      x(r, Dr(In))
      var t = Dn(r)
      function r(e) {
        return G(this, r), t.call(this, e, e, (Fn / 2) | 0, !1)
      }
      return (
        p(r, [
          {
            key: 'setItem',
            value: function (e, t, r) {
              this.setSphere(e, t, r)
              for (var n = 0; n < Fn / 2; ++n) {
                var i = 2 * n
                ;(Un.x = t.x + zn[i].x * r),
                  (Un.y = t.y + zn[i].y * r),
                  (Un.z = t.z + zn[i].z * r)
                i = 1 + i
                ;(Gn.x = t.x + zn[i].x * r),
                  (Gn.y = t.y + zn[i].y * r),
                  (Gn.z = t.z + zn[i].z * r),
                  this.setSegment(e, n, Un, Gn)
              }
            }
          }
        ]),
        r
      )
    })()
  function Hn(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Wn = new ae.Color(),
    Yn = (function () {
      x(i, ae.BufferGeometry)
      var n = Hn(i)
      function i(e, t) {
        var r
        return (
          G(this, i),
          ((r = n.call(this))._opts = t),
          (r.zClip = r._opts.zClip),
          (r._posRad = le.allocateTyped(Float32Array, 4 * e)),
          (r._colors = le.allocateTyped(Float32Array, 3 * e)),
          r
        )
      }
      return (
        p(i, [
          {
            key: 'setItem',
            value: function (e, t, r) {
              var n = this._posRad,
                e = 4 * e
              ;(n[e++] = t.x), (n[e++] = t.y), (n[e++] = t.z), (n[e] = r)
            }
          },
          {
            key: 'setColor',
            value: function (e, t) {
              Wn.set(t)
              ;(t = this._colors), (e *= 3)
              ;(t[e++] = Wn.r), (t[e++] = Wn.g), (t[e] = Wn.b)
            }
          },
          {
            key: 'finalize',
            value: function () {
              this.finishUpdate(), this.computeBoundingSphere()
            }
          },
          {
            key: 'finishUpdate',
            value: function () {
              this._build()
            }
          },
          { key: 'setOpacity', value: function () {} },
          { key: 'raycast', value: function () {} },
          {
            key: 'getSubset',
            value: function () {
              return []
            }
          }
        ]),
        i
      )
    })(),
    Xn = (function () {
      function e() {
        G(this, e),
          (this.pointsValuesLinear = null),
          (this.hasIntersection = null),
          (this.bitsInside = null)
      }
      return (
        p(e, [
          {
            key: 'create',
            value: function (e) {
              e *= e * e
              if (117440512 < e)
                throw new Error(
                  'Too large cube dimension: lead to memory huge uasge'
                )
              return (
                (this.pointsValuesLinear = le.allocateTyped(
                  Float32Array,
                  32 * e
                )),
                (this.hasIntersection = le.allocateTyped(Int32Array, e)),
                (this.bitsInside = le.allocateTyped(Int32Array, e)),
                0
              )
            }
          },
          {
            key: 'destroy',
            value: function () {
              ;(this.bitsInside = null),
                (this.hasIntersection = null),
                (this.pointsValuesLinear = null)
            }
          }
        ]),
        e
      )
    })()
  Xn.prototype.striIndicesMarchCube = [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 9, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, 1, 8, 3, 9, 8, 1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, 0, 8, 3, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 2, 10, 0,
    2, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 8, 3, 2, 10, 8, 10, 9, 8,
    -1, -1, -1, -1, -1, -1, -1, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, 0, 11, 2, 8, 11, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    1, 9, 0, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 11, 2, 1, 9,
    11, 9, 8, 11, -1, -1, -1, -1, -1, -1, -1, 3, 10, 1, 11, 10, 3, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, 0, 10, 1, 0, 8, 10, 8, 11, 10, -1, -1, -1, -1,
    -1, -1, -1, 3, 9, 0, 3, 11, 9, 11, 10, 9, -1, -1, -1, -1, -1, -1, -1, 9, 8,
    10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 7, 8, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 3, 0, 7, 3, 4, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, 0, 1, 9, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, 4, 1, 9, 4, 7, 1, 7, 3, 1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 10, 8,
    4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 4, 7, 3, 0, 4, 1, 2, 10,
    -1, -1, -1, -1, -1, -1, -1, 9, 2, 10, 9, 0, 2, 8, 4, 7, -1, -1, -1, -1, -1,
    -1, -1, 2, 10, 9, 2, 9, 7, 2, 7, 3, 7, 9, 4, -1, -1, -1, -1, 8, 4, 7, 3, 11,
    2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 4, 7, 11, 2, 4, 2, 0, 4, -1,
    -1, -1, -1, -1, -1, -1, 9, 0, 1, 8, 4, 7, 2, 3, 11, -1, -1, -1, -1, -1, -1,
    -1, 4, 7, 11, 9, 4, 11, 9, 11, 2, 9, 2, 1, -1, -1, -1, -1, 3, 10, 1, 3, 11,
    10, 7, 8, 4, -1, -1, -1, -1, -1, -1, -1, 1, 11, 10, 1, 4, 11, 1, 0, 4, 7,
    11, 4, -1, -1, -1, -1, 4, 7, 8, 9, 0, 11, 9, 11, 10, 11, 0, 3, -1, -1, -1,
    -1, 4, 7, 11, 4, 11, 9, 9, 11, 10, -1, -1, -1, -1, -1, -1, -1, 9, 5, 4, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 5, 4, 0, 8, 3, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, 0, 5, 4, 1, 5, 0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, 8, 5, 4, 8, 3, 5, 3, 1, 5, -1, -1, -1, -1, -1, -1, -1, 1, 2,
    10, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 3, 0, 8, 1, 2, 10, 4,
    9, 5, -1, -1, -1, -1, -1, -1, -1, 5, 2, 10, 5, 4, 2, 4, 0, 2, -1, -1, -1,
    -1, -1, -1, -1, 2, 10, 5, 3, 2, 5, 3, 5, 4, 3, 4, 8, -1, -1, -1, -1, 9, 5,
    4, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 11, 2, 0, 8, 11, 4,
    9, 5, -1, -1, -1, -1, -1, -1, -1, 0, 5, 4, 0, 1, 5, 2, 3, 11, -1, -1, -1,
    -1, -1, -1, -1, 2, 1, 5, 2, 5, 8, 2, 8, 11, 4, 8, 5, -1, -1, -1, -1, 10, 3,
    11, 10, 1, 3, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, 4, 9, 5, 0, 8, 1, 8, 10,
    1, 8, 11, 10, -1, -1, -1, -1, 5, 4, 0, 5, 0, 11, 5, 11, 10, 11, 0, 3, -1,
    -1, -1, -1, 5, 4, 8, 5, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1, 9, 7,
    8, 5, 7, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 3, 0, 9, 5, 3, 5, 7,
    3, -1, -1, -1, -1, -1, -1, -1, 0, 7, 8, 0, 1, 7, 1, 5, 7, -1, -1, -1, -1,
    -1, -1, -1, 1, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 7,
    8, 9, 5, 7, 10, 1, 2, -1, -1, -1, -1, -1, -1, -1, 10, 1, 2, 9, 5, 0, 5, 3,
    0, 5, 7, 3, -1, -1, -1, -1, 8, 0, 2, 8, 2, 5, 8, 5, 7, 10, 5, 2, -1, -1, -1,
    -1, 2, 10, 5, 2, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1, 7, 9, 5, 7, 8,
    9, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, 9, 5, 7, 9, 7, 2, 9, 2, 0, 2, 7,
    11, -1, -1, -1, -1, 2, 3, 11, 0, 1, 8, 1, 7, 8, 1, 5, 7, -1, -1, -1, -1, 11,
    2, 1, 11, 1, 7, 7, 1, 5, -1, -1, -1, -1, -1, -1, -1, 9, 5, 8, 8, 5, 7, 10,
    1, 3, 10, 3, 11, -1, -1, -1, -1, 5, 7, 0, 5, 0, 9, 7, 11, 0, 1, 0, 10, 11,
    10, 0, -1, 11, 10, 0, 11, 0, 3, 10, 5, 0, 8, 0, 7, 5, 7, 0, -1, 11, 10, 5,
    7, 11, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 10, 6, 5, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 5, 10, 6, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, 9, 0, 1, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, 1, 8, 3, 1, 9, 8, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, 1, 6, 5, 2, 6,
    1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 6, 5, 1, 2, 6, 3, 0, 8, -1,
    -1, -1, -1, -1, -1, -1, 9, 6, 5, 9, 0, 6, 0, 2, 6, -1, -1, -1, -1, -1, -1,
    -1, 5, 9, 8, 5, 8, 2, 5, 2, 6, 3, 2, 8, -1, -1, -1, -1, 2, 3, 11, 10, 6, 5,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 0, 8, 11, 2, 0, 10, 6, 5, -1,
    -1, -1, -1, -1, -1, -1, 0, 1, 9, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1, -1, -1,
    -1, 5, 10, 6, 1, 9, 2, 9, 11, 2, 9, 8, 11, -1, -1, -1, -1, 6, 3, 11, 6, 5,
    3, 5, 1, 3, -1, -1, -1, -1, -1, -1, -1, 0, 8, 11, 0, 11, 5, 0, 5, 1, 5, 11,
    6, -1, -1, -1, -1, 3, 11, 6, 0, 3, 6, 0, 6, 5, 0, 5, 9, -1, -1, -1, -1, 6,
    5, 9, 6, 9, 11, 11, 9, 8, -1, -1, -1, -1, -1, -1, -1, 5, 10, 6, 4, 7, 8, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 3, 0, 4, 7, 3, 6, 5, 10, -1, -1, -1,
    -1, -1, -1, -1, 1, 9, 0, 5, 10, 6, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, 10,
    6, 5, 1, 9, 7, 1, 7, 3, 7, 9, 4, -1, -1, -1, -1, 6, 1, 2, 6, 5, 1, 4, 7, 8,
    -1, -1, -1, -1, -1, -1, -1, 1, 2, 5, 5, 2, 6, 3, 0, 4, 3, 4, 7, -1, -1, -1,
    -1, 8, 4, 7, 9, 0, 5, 0, 6, 5, 0, 2, 6, -1, -1, -1, -1, 7, 3, 9, 7, 9, 4, 3,
    2, 9, 5, 9, 6, 2, 6, 9, -1, 3, 11, 2, 7, 8, 4, 10, 6, 5, -1, -1, -1, -1, -1,
    -1, -1, 5, 10, 6, 4, 7, 2, 4, 2, 0, 2, 7, 11, -1, -1, -1, -1, 0, 1, 9, 4, 7,
    8, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1, 9, 2, 1, 9, 11, 2, 9, 4, 11, 7, 11,
    4, 5, 10, 6, -1, 8, 4, 7, 3, 11, 5, 3, 5, 1, 5, 11, 6, -1, -1, -1, -1, 5, 1,
    11, 5, 11, 6, 1, 0, 11, 7, 11, 4, 0, 4, 11, -1, 0, 5, 9, 0, 6, 5, 0, 3, 6,
    11, 6, 3, 8, 4, 7, -1, 6, 5, 9, 6, 9, 11, 4, 7, 9, 7, 11, 9, -1, -1, -1, -1,
    10, 4, 9, 6, 4, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 10, 6, 4, 9,
    10, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1, 10, 0, 1, 10, 6, 0, 6, 4, 0, -1,
    -1, -1, -1, -1, -1, -1, 8, 3, 1, 8, 1, 6, 8, 6, 4, 6, 1, 10, -1, -1, -1, -1,
    1, 4, 9, 1, 2, 4, 2, 6, 4, -1, -1, -1, -1, -1, -1, -1, 3, 0, 8, 1, 2, 9, 2,
    4, 9, 2, 6, 4, -1, -1, -1, -1, 0, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, 8, 3, 2, 8, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1, 10, 4, 9,
    10, 6, 4, 11, 2, 3, -1, -1, -1, -1, -1, -1, -1, 0, 8, 2, 2, 8, 11, 4, 9, 10,
    4, 10, 6, -1, -1, -1, -1, 3, 11, 2, 0, 1, 6, 0, 6, 4, 6, 1, 10, -1, -1, -1,
    -1, 6, 4, 1, 6, 1, 10, 4, 8, 1, 2, 1, 11, 8, 11, 1, -1, 9, 6, 4, 9, 3, 6, 9,
    1, 3, 11, 6, 3, -1, -1, -1, -1, 8, 11, 1, 8, 1, 0, 11, 6, 1, 9, 1, 4, 6, 4,
    1, -1, 3, 11, 6, 3, 6, 0, 0, 6, 4, -1, -1, -1, -1, -1, -1, -1, 6, 4, 8, 11,
    6, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 10, 6, 7, 8, 10, 8, 9, 10,
    -1, -1, -1, -1, -1, -1, -1, 0, 7, 3, 0, 10, 7, 0, 9, 10, 6, 7, 10, -1, -1,
    -1, -1, 10, 6, 7, 1, 10, 7, 1, 7, 8, 1, 8, 0, -1, -1, -1, -1, 10, 6, 7, 10,
    7, 1, 1, 7, 3, -1, -1, -1, -1, -1, -1, -1, 1, 2, 6, 1, 6, 8, 1, 8, 9, 8, 6,
    7, -1, -1, -1, -1, 2, 6, 9, 2, 9, 1, 6, 7, 9, 0, 9, 3, 7, 3, 9, -1, 7, 8, 0,
    7, 0, 6, 6, 0, 2, -1, -1, -1, -1, -1, -1, -1, 7, 3, 2, 6, 7, 2, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, 2, 3, 11, 10, 6, 8, 10, 8, 9, 8, 6, 7, -1, -1,
    -1, -1, 2, 0, 7, 2, 7, 11, 0, 9, 7, 6, 7, 10, 9, 10, 7, -1, 1, 8, 0, 1, 7,
    8, 1, 10, 7, 6, 7, 10, 2, 3, 11, -1, 11, 2, 1, 11, 1, 7, 10, 6, 1, 6, 7, 1,
    -1, -1, -1, -1, 8, 9, 6, 8, 6, 7, 9, 1, 6, 11, 6, 3, 1, 3, 6, -1, 0, 9, 1,
    11, 6, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 7, 8, 0, 7, 0, 6, 3, 11,
    0, 11, 6, 0, -1, -1, -1, -1, 7, 11, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, 3, 0, 8, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 9, 11,
    7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 8, 1, 9, 8, 3, 1, 11, 7, 6,
    -1, -1, -1, -1, -1, -1, -1, 10, 1, 2, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, 1, 2, 10, 3, 0, 8, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, 2, 9,
    0, 2, 10, 9, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, 6, 11, 7, 2, 10, 3, 10,
    8, 3, 10, 9, 8, -1, -1, -1, -1, 7, 2, 3, 6, 2, 7, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, 7, 0, 8, 7, 6, 0, 6, 2, 0, -1, -1, -1, -1, -1, -1, -1, 2, 7,
    6, 2, 3, 7, 0, 1, 9, -1, -1, -1, -1, -1, -1, -1, 1, 6, 2, 1, 8, 6, 1, 9, 8,
    8, 7, 6, -1, -1, -1, -1, 10, 7, 6, 10, 1, 7, 1, 3, 7, -1, -1, -1, -1, -1,
    -1, -1, 10, 7, 6, 1, 7, 10, 1, 8, 7, 1, 0, 8, -1, -1, -1, -1, 0, 3, 7, 0, 7,
    10, 0, 10, 9, 6, 10, 7, -1, -1, -1, -1, 7, 6, 10, 7, 10, 8, 8, 10, 9, -1,
    -1, -1, -1, -1, -1, -1, 6, 8, 4, 11, 8, 6, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, 3, 6, 11, 3, 0, 6, 0, 4, 6, -1, -1, -1, -1, -1, -1, -1, 8, 6, 11, 8,
    4, 6, 9, 0, 1, -1, -1, -1, -1, -1, -1, -1, 9, 4, 6, 9, 6, 3, 9, 3, 1, 11, 3,
    6, -1, -1, -1, -1, 6, 8, 4, 6, 11, 8, 2, 10, 1, -1, -1, -1, -1, -1, -1, -1,
    1, 2, 10, 3, 0, 11, 0, 6, 11, 0, 4, 6, -1, -1, -1, -1, 4, 11, 8, 4, 6, 11,
    0, 2, 9, 2, 10, 9, -1, -1, -1, -1, 10, 9, 3, 10, 3, 2, 9, 4, 3, 11, 3, 6, 4,
    6, 3, -1, 8, 2, 3, 8, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1, 0, 4, 2, 4,
    6, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 9, 0, 2, 3, 4, 2, 4, 6, 4,
    3, 8, -1, -1, -1, -1, 1, 9, 4, 1, 4, 2, 2, 4, 6, -1, -1, -1, -1, -1, -1, -1,
    8, 1, 3, 8, 6, 1, 8, 4, 6, 6, 10, 1, -1, -1, -1, -1, 10, 1, 0, 10, 0, 6, 6,
    0, 4, -1, -1, -1, -1, -1, -1, -1, 4, 6, 3, 4, 3, 8, 6, 10, 3, 0, 3, 9, 10,
    9, 3, -1, 10, 9, 4, 6, 10, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 9,
    5, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 4, 9, 5, 11,
    7, 6, -1, -1, -1, -1, -1, -1, -1, 5, 0, 1, 5, 4, 0, 7, 6, 11, -1, -1, -1,
    -1, -1, -1, -1, 11, 7, 6, 8, 3, 4, 3, 5, 4, 3, 1, 5, -1, -1, -1, -1, 9, 5,
    4, 10, 1, 2, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, 6, 11, 7, 1, 2, 10, 0, 8,
    3, 4, 9, 5, -1, -1, -1, -1, 7, 6, 11, 5, 4, 10, 4, 2, 10, 4, 0, 2, -1, -1,
    -1, -1, 3, 4, 8, 3, 5, 4, 3, 2, 5, 10, 5, 2, 11, 7, 6, -1, 7, 2, 3, 7, 6, 2,
    5, 4, 9, -1, -1, -1, -1, -1, -1, -1, 9, 5, 4, 0, 8, 6, 0, 6, 2, 6, 8, 7, -1,
    -1, -1, -1, 3, 6, 2, 3, 7, 6, 1, 5, 0, 5, 4, 0, -1, -1, -1, -1, 6, 2, 8, 6,
    8, 7, 2, 1, 8, 4, 8, 5, 1, 5, 8, -1, 9, 5, 4, 10, 1, 6, 1, 7, 6, 1, 3, 7,
    -1, -1, -1, -1, 1, 6, 10, 1, 7, 6, 1, 0, 7, 8, 7, 0, 9, 5, 4, -1, 4, 0, 10,
    4, 10, 5, 0, 3, 10, 6, 10, 7, 3, 7, 10, -1, 7, 6, 10, 7, 10, 8, 5, 4, 10, 4,
    8, 10, -1, -1, -1, -1, 6, 9, 5, 6, 11, 9, 11, 8, 9, -1, -1, -1, -1, -1, -1,
    -1, 3, 6, 11, 0, 6, 3, 0, 5, 6, 0, 9, 5, -1, -1, -1, -1, 0, 11, 8, 0, 5, 11,
    0, 1, 5, 5, 6, 11, -1, -1, -1, -1, 6, 11, 3, 6, 3, 5, 5, 3, 1, -1, -1, -1,
    -1, -1, -1, -1, 1, 2, 10, 9, 5, 11, 9, 11, 8, 11, 5, 6, -1, -1, -1, -1, 0,
    11, 3, 0, 6, 11, 0, 9, 6, 5, 6, 9, 1, 2, 10, -1, 11, 8, 5, 11, 5, 6, 8, 0,
    5, 10, 5, 2, 0, 2, 5, -1, 6, 11, 3, 6, 3, 5, 2, 10, 3, 10, 5, 3, -1, -1, -1,
    -1, 5, 8, 9, 5, 2, 8, 5, 6, 2, 3, 8, 2, -1, -1, -1, -1, 9, 5, 6, 9, 6, 0, 0,
    6, 2, -1, -1, -1, -1, -1, -1, -1, 1, 5, 8, 1, 8, 0, 5, 6, 8, 3, 8, 2, 6, 2,
    8, -1, 1, 5, 6, 2, 1, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 6, 1,
    6, 10, 3, 8, 6, 5, 6, 9, 8, 9, 6, -1, 10, 1, 0, 10, 0, 6, 9, 5, 0, 5, 6, 0,
    -1, -1, -1, -1, 0, 3, 8, 5, 6, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    10, 5, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 5, 10, 7,
    5, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 11, 5, 10, 11, 7, 5, 8, 3, 0,
    -1, -1, -1, -1, -1, -1, -1, 5, 11, 7, 5, 10, 11, 1, 9, 0, -1, -1, -1, -1,
    -1, -1, -1, 10, 7, 5, 10, 11, 7, 9, 8, 1, 8, 3, 1, -1, -1, -1, -1, 11, 1, 2,
    11, 7, 1, 7, 5, 1, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 1, 2, 7, 1, 7, 5, 7,
    2, 11, -1, -1, -1, -1, 9, 7, 5, 9, 2, 7, 9, 0, 2, 2, 11, 7, -1, -1, -1, -1,
    7, 5, 2, 7, 2, 11, 5, 9, 2, 3, 2, 8, 9, 8, 2, -1, 2, 5, 10, 2, 3, 5, 3, 7,
    5, -1, -1, -1, -1, -1, -1, -1, 8, 2, 0, 8, 5, 2, 8, 7, 5, 10, 2, 5, -1, -1,
    -1, -1, 9, 0, 1, 5, 10, 3, 5, 3, 7, 3, 10, 2, -1, -1, -1, -1, 9, 8, 2, 9, 2,
    1, 8, 7, 2, 10, 2, 5, 7, 5, 2, -1, 1, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, 0, 8, 7, 0, 7, 1, 1, 7, 5, -1, -1, -1, -1, -1, -1, -1, 9, 0,
    3, 9, 3, 5, 5, 3, 7, -1, -1, -1, -1, -1, -1, -1, 9, 8, 7, 5, 9, 7, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, 5, 8, 4, 5, 10, 8, 10, 11, 8, -1, -1, -1,
    -1, -1, -1, -1, 5, 0, 4, 5, 11, 0, 5, 10, 11, 11, 3, 0, -1, -1, -1, -1, 0,
    1, 9, 8, 4, 10, 8, 10, 11, 10, 4, 5, -1, -1, -1, -1, 10, 11, 4, 10, 4, 5,
    11, 3, 4, 9, 4, 1, 3, 1, 4, -1, 2, 5, 1, 2, 8, 5, 2, 11, 8, 4, 5, 8, -1, -1,
    -1, -1, 0, 4, 11, 0, 11, 3, 4, 5, 11, 2, 11, 1, 5, 1, 11, -1, 0, 2, 5, 0, 5,
    9, 2, 11, 5, 4, 5, 8, 11, 8, 5, -1, 9, 4, 5, 2, 11, 3, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, 2, 5, 10, 3, 5, 2, 3, 4, 5, 3, 8, 4, -1, -1, -1, -1, 5,
    10, 2, 5, 2, 4, 4, 2, 0, -1, -1, -1, -1, -1, -1, -1, 3, 10, 2, 3, 5, 10, 3,
    8, 5, 4, 5, 8, 0, 1, 9, -1, 5, 10, 2, 5, 2, 4, 1, 9, 2, 9, 4, 2, -1, -1, -1,
    -1, 8, 4, 5, 8, 5, 3, 3, 5, 1, -1, -1, -1, -1, -1, -1, -1, 0, 4, 5, 1, 0, 5,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 8, 4, 5, 8, 5, 3, 9, 0, 5, 0, 3, 5,
    -1, -1, -1, -1, 9, 4, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    4, 11, 7, 4, 9, 11, 9, 10, 11, -1, -1, -1, -1, -1, -1, -1, 0, 8, 3, 4, 9, 7,
    9, 11, 7, 9, 10, 11, -1, -1, -1, -1, 1, 10, 11, 1, 11, 4, 1, 4, 0, 7, 4, 11,
    -1, -1, -1, -1, 3, 1, 4, 3, 4, 8, 1, 10, 4, 7, 4, 11, 10, 11, 4, -1, 4, 11,
    7, 9, 11, 4, 9, 2, 11, 9, 1, 2, -1, -1, -1, -1, 9, 7, 4, 9, 11, 7, 9, 1, 11,
    2, 11, 1, 0, 8, 3, -1, 11, 7, 4, 11, 4, 2, 2, 4, 0, -1, -1, -1, -1, -1, -1,
    -1, 11, 7, 4, 11, 4, 2, 8, 3, 4, 3, 2, 4, -1, -1, -1, -1, 2, 9, 10, 2, 7, 9,
    2, 3, 7, 7, 4, 9, -1, -1, -1, -1, 9, 10, 7, 9, 7, 4, 10, 2, 7, 8, 7, 0, 2,
    0, 7, -1, 3, 7, 10, 3, 10, 2, 7, 4, 10, 1, 10, 0, 4, 0, 10, -1, 1, 10, 2, 8,
    7, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 9, 1, 4, 1, 7, 7, 1, 3, -1,
    -1, -1, -1, -1, -1, -1, 4, 9, 1, 4, 1, 7, 0, 8, 1, 8, 7, 1, -1, -1, -1, -1,
    4, 0, 3, 7, 4, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 4, 8, 7, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 9, 10, 8, 10, 11, 8, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, 3, 0, 9, 3, 9, 11, 11, 9, 10, -1, -1, -1, -1,
    -1, -1, -1, 0, 1, 10, 0, 10, 8, 8, 10, 11, -1, -1, -1, -1, -1, -1, -1, 3, 1,
    10, 11, 3, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 2, 11, 1, 11, 9,
    9, 11, 8, -1, -1, -1, -1, -1, -1, -1, 3, 0, 9, 3, 9, 11, 1, 2, 9, 2, 11, 9,
    -1, -1, -1, -1, 0, 2, 11, 8, 0, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    3, 2, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, 3, 8, 2, 8,
    10, 10, 8, 9, -1, -1, -1, -1, -1, -1, -1, 9, 10, 2, 0, 9, 2, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, 2, 3, 8, 2, 8, 10, 0, 1, 8, 1, 10, 8, -1, -1, -1,
    -1, 1, 10, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 3, 8,
    9, 1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 9, 1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 3, 8, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1
  ]
  var qn = [
    0, 265, 515, 778, 1030, 1295, 1541, 1804, 2060, 2309, 2575, 2822, 3082,
    3331, 3593, 3840, 400, 153, 915, 666, 1430, 1183, 1941, 1692, 2460, 2197,
    2975, 2710, 3482, 3219, 3993, 3728, 560, 825, 51, 314, 1590, 1855, 1077,
    1340, 2620, 2869, 2111, 2358, 3642, 3891, 3129, 3376, 928, 681, 419, 170,
    1958, 1711, 1445, 1196, 2988, 2725, 2479, 2214, 4010, 3747, 3497, 3232,
    1120, 1385, 1635, 1898, 102, 367, 613, 876, 3180, 3429, 3695, 3942, 2154,
    2403, 2665, 2912, 1520, 1273, 2035, 1786, 502, 255, 1013, 764, 3580, 3317,
    4095, 3830, 2554, 2291, 3065, 2800, 1616, 1881, 1107, 1370, 598, 863, 85,
    348, 3676, 3925, 3167, 3414, 2650, 2899, 2137, 2384, 1984, 1737, 1475, 1226,
    966, 719, 453, 204, 4044, 3781, 3535, 3270, 3018, 2755, 2505, 2240, 2240,
    2505, 2755, 3018, 3270, 3535, 3781, 4044, 204, 453, 719, 966, 1226, 1475,
    1737, 1984, 2384, 2137, 2899, 2650, 3414, 3167, 3925, 3676, 348, 85, 863,
    598, 1370, 1107, 1881, 1616, 2800, 3065, 2291, 2554, 3830, 4095, 3317, 3580,
    764, 1013, 255, 502, 1786, 2035, 1273, 1520, 2912, 2665, 2403, 2154, 3942,
    3695, 3429, 3180, 876, 613, 367, 102, 1898, 1635, 1385, 1120, 3232, 3497,
    3747, 4010, 2214, 2479, 2725, 2988, 1196, 1445, 1711, 1958, 170, 419, 681,
    928, 3376, 3129, 3891, 3642, 2358, 2111, 2869, 2620, 1340, 1077, 1855, 1590,
    314, 51, 825, 560, 3728, 3993, 3219, 3482, 2710, 2975, 2197, 2460, 1692,
    1941, 1183, 1430, 666, 915, 153, 400, 3840, 3593, 3331, 3082, 2822, 2575,
    2309, 2060, 1804, 1541, 1295, 1030, 778, 515, 265, 0
  ]
  var $n = p(function e() {
      G(this, e),
        (this._arrSize = 8),
        (this.p = new Array(this._arrSize)),
        (this.g = new Array(this._arrSize)),
        (this.val = new Array(this._arrSize))
      for (var t = 0; t < this._arrSize; ++t)
        (this.p[t] = new ae.Vector3()), (this.g[t] = new ae.Vector3())
      this.cubeIndex = 0
    }),
    Zn = p(function e() {
      G(this, e),
        (this.a = { p: new ae.Vector3(), n: new ae.Vector3() }),
        (this.b = { p: new ae.Vector3(), n: new ae.Vector3() }),
        (this.c = { p: new ae.Vector3(), n: new ae.Vector3() })
    })
  function Kn(e) {
    for (var t = new Array(e), r = 0; r < e; ++r) t[r] = new ae.Vector3()
    return t
  }
  var Qn = (function () {
    function d() {
      G(this, d),
        (this._numTriangles = 0),
        (this._numVertices = 0),
        (this._position = []),
        (this._normals = []),
        (this._colors = null),
        (this._indices = []),
        (this._volumetricData = null),
        (this._xAxis = new ae.Vector3()),
        (this._yAxis = new ae.Vector3()),
        (this._zAxis = new ae.Vector3()),
        (this._xDir = new ae.Vector3()),
        (this._yDir = new ae.Vector3()),
        (this._zDir = new ae.Vector3())
    }
    return (
      p(d, [
        {
          key: '_prepareAxesAndDirs',
          value: function () {
            var e = this._volumetricData.getCellSize(),
              t = this._xAxis,
              r = this._yAxis,
              n = this._zAxis,
              i = this._xDir,
              o = this._yDir,
              s = this._zDir
            t.set(e.x, 0, 0),
              r.set(0, e.y, 0),
              n.set(0, 0, e.z),
              i.set(1, 0, 0),
              o.set(0, 1, 0),
              s.set(0, 0, 1)
            e = new ae.Vector3()
            if (
              (e.crossVectors(i, o),
              e.dot(s) < 0 && (i.negate(), o.negate(), s.negate()),
              i.x < 0 ||
                i.y < 0 ||
                i.z < 0 ||
                o.x < 0 ||
                o.y < 0 ||
                o.z < 0 ||
                s.x < 0 ||
                s.y < 0 ||
                s.z < 0)
            )
              return !1
            function a(e) {
              return Math.abs(e) > Number.EPSILON
            }
            return !(a(t.y) || a(t.z) || a(r.x) || a(r.z) || a(n.x) || a(n.y))
          }
        },
        {
          key: '_vertexInterp',
          value: function (e, t, r, n, i, o) {
            var s = t.p[r],
              a = t.p[n],
              l = t.g[r],
              c = t.g[n],
              r = t.val[r],
              e = e - r,
              n = t.val[n] - r,
              r = 0
            0 < Math.abs(n) && (r = e / n),
              i.lerpVectors(s, a, (r = 1 < r ? 1 : r)),
              o.lerpVectors(l, c, r)
          }
        },
        {
          key: '_polygonize',
          value: function (e, t, r) {
            for (
              var n = e.cubeIndex,
                i = 0,
                o = d._arrSize,
                s = d._firstIndices,
                a = d._secondIndices,
                l = d._vertexList,
                c = d._normalList;
              i < o;
              ++i
            )
              qn[n] & (1 << i) &&
                this._vertexInterp(t, e, s[i], a[i], l[i], c[i])
            for (
              var u = 0, h = 16 * n, f = d._triTable, i = 0;
              -1 !== f[h + i];
              i += 3
            )
              r[u].a.p.copy(l[f[h + i]]),
                r[u].a.n.copy(c[f[h + i]]),
                r[u].b.p.copy(l[f[h + i + 1]]),
                r[u].b.n.copy(c[f[h + i + 1]]),
                r[u].c.p.copy(l[f[h + i + 2]]),
                r[u].c.n.copy(c[f[h + i + 2]]),
                ++u
            return u
          }
        },
        {
          key: '_doGridPosNorms',
          value: function (e, t, r) {
            for (
              var n = this._volumetricData,
                i = this._volumetricData.getData(),
                o = n.getDimensions(),
                s = o[0],
                a = o[1],
                l = o[2],
                c = t * n.getStrideX(),
                u = t * n.getStrideY(),
                h = t * n.getStrideZ(),
                f = new $n(),
                d = f.val,
                p = f.val.length,
                m = [
                  new ae.Vector3(0, 0, 0),
                  new ae.Vector3(t, 0, 0),
                  new ae.Vector3(t, t, 0),
                  new ae.Vector3(0, t, 0),
                  new ae.Vector3(0, 0, t),
                  new ae.Vector3(t, 0, t),
                  new ae.Vector3(t, t, t),
                  new ae.Vector3(0, t, t)
                ],
                y = new Array(5),
                _ = 0;
              _ < 5;
              ++_
            )
              y[_] = new Zn()
            for (
              var v,
                g,
                x,
                b,
                w = this,
                S = this._position,
                R = this._normals,
                C = r
                  ? ((v = new ae.Vector3(w._xAxis.x, w._yAxis.y, w._zAxis.z)),
                    function (e) {
                      var t = e.p.clone()
                      t.multiply(v),
                        S.push(t.add(w._origin)),
                        R.push(e.n.clone())
                    })
                  : (function () {
                      var t = new ae.Matrix3()
                      t.set(
                        w._xAxis.x,
                        w._yAxis.x,
                        w._zAxis.x,
                        w._xAxis.y,
                        w._yAxis.y,
                        w._zAxis.y,
                        w._xAxis.z,
                        w._yAxis.z,
                        w._zAxis.z
                      )
                      var r = new ae.Matrix3()
                      return (
                        r.set(
                          w._xDir.x,
                          w._yDir.x,
                          w._zDir.x,
                          w._xDir.y,
                          w._yDir.y,
                          w._zDir.y,
                          w._xDir.z,
                          w._yDir.z,
                          w._zDir.z
                        ),
                        function (e) {
                          S.push(e.p.clone().applyMatrix3(t).add(w._origin)),
                            R.push(e.n.clone().applyMatrix3(r))
                        }
                      )
                    })(),
                A = this._indices,
                E = 0,
                k = 0;
              k < l - t;
              k += t
            )
              for (var T = 0; T < a - t; T += t)
                for (
                  var P = n.getDirectIdx(0, T, k), M = 0;
                  M < s - t;
                  M += t, P += c
                ) {
                  ;(d[0] = i[P]),
                    (d[1] = i[P + c]),
                    (d[3] = i[P + u]),
                    (d[2] = i[P + c + u]),
                    (d[4] = i[P + h]),
                    (d[5] = i[P + c + h]),
                    (d[7] = i[P + u + h]),
                    (d[6] = i[P + c + u + h])
                  for (var N = 0, L = 0; L < p; ++L) d[L] < e && (N |= 1 << L)
                  if (0 !== qn[N]) {
                    for (f.cubeIndex = N, L = 0; L < p; ++L)
                      f.p[L].set(M + m[L].x, T + m[L].y, k + m[L].z),
                        (g = this._gradient),
                        (x = f.p[L]),
                        (b = f.g[L]),
                        (x = g.getValue(x.x, x.y, x.z)),
                        b.set(x[0], x[1], x[2])
                    var I = this._polygonize(f, e, y)
                    for (E += I, L = 0; L < I; ++L)
                      A.push(3 * this._numTriangles),
                        A.push(3 * this._numTriangles + 1),
                        A.push(3 * this._numTriangles + 2),
                        ++this._numTriangles,
                        C(y[L].a),
                        C(y[L].b),
                        C(y[L].c)
                  }
                }
            return E
          }
        },
        {
          key: 'compute',
          value: function (e, t, r, n) {
            ;(this._volumetricData = e),
              (this._origin = t),
              (this._gradient = e.computeGradient()),
              this._doGridPosNorms(r, n, this._prepareAxesAndDirs())
          }
        },
        {
          key: '_remapIndices',
          value: function (e, t) {
            for (
              var r = this._indices,
                n = le.allocateTyped(Uint32Array, t),
                i = 0;
              i < t;
              ++i
            )
              (r[i] = e[r[i]]), (n[i] = r[i])
            this._indices = n
          }
        },
        {
          key: '_remapVertices',
          value: function (e, t, r) {
            for (
              var n = le.allocateTyped(Float32Array, 3 * r),
                i = le.allocateTyped(Float32Array, 3 * r),
                o = 0;
              o < r;
              ++o
            ) {
              var s = e[o]
              ;(n[3 * o] = s.x), (n[3 * o + 1] = s.y), (n[3 * o + 2] = s.z)
              s = t[o].normalize()
              ;(i[3 * o] = s.x), (i[3 * o + 1] = s.y), (i[3 * o + 2] = s.z)
            }
            ;(this._position = n), (this._normals = i)
          }
        },
        {
          key: 'vertexFusion',
          value: function (e, t) {
            var r = this._indices.length,
              n = this._position,
              i = this._normals,
              o = 0 | n.length
            if (0 !== r && 0 != o) {
              var s = le.allocateTyped(Uint32Array, o)
              s[0] = 0
              for (var a = 1, l = 1; l < o; ++l) {
                for (
                  var c = a - e < 0 ? 0 : a - e,
                    u = a < c + t ? a : c + t,
                    h = -1,
                    f = c;
                  f < u;
                  ++f
                )
                  if (Math.abs(n[l] - n[f]) < Number.EPSILON) {
                    h = f
                    break
                  }
                ;-1 !== h
                  ? (s[l] = h)
                  : (n[a].copy(n[l]), i[a].copy(i[l]), (s[l] = a), ++a)
              }
              this._remapIndices(s, r), this._remapVertices(n, i, a)
            }
          }
        },
        {
          key: 'setColorVolTex',
          value: function (e, o, t, r) {
            var s,
              n,
              i,
              a,
              l = this._position.length / 3,
              c = this._position,
              u = this._origin,
              h = this._volumetricData.getDimensions(),
              f = h[0] - 1,
              d = h[1] - 1,
              p = h[2] - 1,
              m = e.getData(),
              y = e.getStrideX(),
              _ = e.getStrideY(),
              v = e.getStrideZ()
            null !== r &&
              ((s = t.getData()),
              (n = t.getStrideX()),
              (i = t.getStrideY()),
              (a = t.getStrideZ()))
            var g = 1 / this._xAxis.x,
              x = 1 / this._yAxis.y,
              b = 1 / this._zAxis.z,
              w = [],
              S = [],
              R = le.allocateTyped(Float32Array, 3 * l)
            function C(e, t, r, n) {
              ;(n[0] = (1 - e) * m[t] + e * m[r]),
                (n[1] = (1 - e) * m[t + 1] + e * m[r + 1]),
                (n[2] = (1 - e) * m[t + 2] + e * m[r + 2])
            }
            function A(e, t, r, n) {
              var i = o[e]
              null != i &&
                ((w[i.index] = i),
                (e = t * r * n * s[e]),
                void 0 === S[i.index] ? (S[i.index] = e) : (S[i.index] += e))
            }
            var E = le.allocateTyped(Int32Array, l),
              k = 0
            for (Z = 0; Z < l; Z++) {
              var T = 3 * Z,
                P = (c[T] - u.x) * g,
                M = (c[1 + T] - u.y) * x,
                N = (c[2 + T] - u.z) * b,
                L = 0 | Math.min(Math.max(P, 0), f),
                I = 0 | Math.min(Math.max(M, 0), d),
                O = 0 | Math.min(Math.max(N, 0), p),
                B = P - L,
                V = M - I,
                D = N - O
              if (null != r) {
                ;(w = []),
                  (S = []),
                  A((G = t.getDirectIdx(L, I, O)), 1 - B, 1 - V, 1 - D),
                  A(G + n, B, 1 - V, 1 - D),
                  A(G + i, 1 - B, V, 1 - D),
                  A(G + n + i, B, V, 1 - D),
                  A(G + a, 1 - B, 1 - V, D),
                  A(G + n + a, B, 1 - V, D),
                  A(G + i + a, 1 - B, V, D),
                  A(G + n + i + a, B, V, D)
                var z,
                  F = 0,
                  U = -1
                for (z in S) S[z] > F && (F = S[(U = z)])
                if (U < 0 || !r.includesAtom(w[U])) {
                  E[Z] = -1
                  continue
                }
              }
              E[Z] = k++
              var G,
                j = L < f ? y : 0,
                H = I < d ? _ : 0,
                W = O < p ? v : 0,
                Y = [0, 0, 0],
                P = [0, 0, 0],
                M = [0, 0, 0],
                N = [0, 0, 0]
              C(B, (G = e.getDirectIdx(L, I, O)), G + j, Y),
                C(B, G + H, G + j + H, P),
                C(B, G + W, G + j + W, M),
                C(B, G + H + W, G + j + H + W, N)
              W = [0, 0, 0]
              ;(W[0] = (1 - V) * Y[0] + V * P[0]),
                (W[1] = (1 - V) * Y[1] + V * P[1]),
                (W[2] = (1 - V) * Y[2] + V * P[2])
              P = [0, 0, 0]
              ;(P[0] = (1 - V) * M[0] + V * N[0]),
                (P[1] = (1 - V) * M[1] + V * N[1]),
                (P[2] = (1 - V) * M[2] + V * N[2]),
                (R[T] = (1 - D) * W[0] + D * P[0]),
                (R[1 + T] = (1 - D) * W[1] + D * P[1]),
                (R[2 + T] = (1 - D) * W[2] + D * P[2])
            }
            if (((this._colors = R), null != r)) {
              for (Z = 0; Z < l; ++Z) {
                var X = E[Z]
                X < 0 ||
                  ((this._position[3 * X] = this._position[3 * Z]),
                  (this._position[3 * X + 1] = this._position[3 * Z + 1]),
                  (this._position[3 * X + 2] = this._position[3 * Z + 2]),
                  (this._normals[3 * X] = this._normals[3 * Z]),
                  (this._normals[3 * X + 1] = this._normals[3 * Z + 1]),
                  (this._normals[3 * X + 2] = this._normals[3 * Z + 2]),
                  (this._colors[3 * X] = this._colors[3 * Z]),
                  (this._colors[3 * X + 1] = this._colors[3 * Z + 1]),
                  (this._colors[3 * X + 2] = this._colors[3 * Z + 2]))
              }
              for (var q = this._indices.length / 3, $ = 0, Z = 0; Z < q; ++Z) {
                var K = E[this._indices[3 * Z]],
                  Q = E[this._indices[3 * Z + 1]],
                  J = E[this._indices[3 * Z + 2]]
                0 <= K &&
                  0 <= Q &&
                  0 <= J &&
                  ((this._indices[3 * $] = K),
                  (this._indices[3 * $ + 1] = Q),
                  (this._indices[3 * $ + 2] = J),
                  ++$)
              }
              ;(this._position = new Float32Array(
                this._position.buffer.slice(0, 3 * k * 4)
              )),
                (this._normals = new Float32Array(
                  this._normals.buffer.slice(0, 3 * k * 4)
                )),
                (this._colors = new Float32Array(
                  this._colors.buffer.slice(0, 3 * k * 4)
                )),
                (this._indices = new Uint32Array(
                  this._indices.buffer.slice(0, 3 * $ * 4)
                ))
            }
          }
        },
        {
          key: 'toMesh',
          value: function () {
            var e = new ae.BufferGeometry()
            return (
              e.setIndex(new ae.BufferAttribute(this._indices, 1)),
              e.setAttribute(
                'position',
                new ae.BufferAttribute(this._position, 3)
              ),
              e.setAttribute(
                'normal',
                new ae.BufferAttribute(this._normals, 3)
              ),
              e.setAttribute('color', new ae.BufferAttribute(this._colors, 3)),
              e.computeBoundingSphere(),
              e
            )
          }
        }
      ]),
      d
    )
  })()
  function Jn(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Qn, '_triTable', Xn.prototype.striIndicesMarchCube),
    be(Qn, '_arrSize', 12),
    be(Qn, '_firstIndices', [0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3]),
    be(Qn, '_secondIndices', [1, 2, 3, 0, 5, 6, 7, 4, 4, 5, 6, 7]),
    be(Qn, '_vertexList', Kn(Qn._arrSize)),
    be(Qn, '_normalList', Kn(Qn._arrSize))
  var ei = (function () {
    x(t, Yn)
    var e = Jn(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_build',
          value: function () {
            var e = this._opts
            ;(this.numVoxels = [128, 128, 128]),
              (this.xAxis = new ae.Vector3(1, 0, 0)),
              (this.yAxis = new ae.Vector3(0, 1, 0)),
              (this.zAxis = new ae.Vector3(0, 0, 1)),
              (this.origin = new ae.Vector3(0, 0, 0)),
              (this._visibilitySelector = e.visibilitySelector),
              this._calcSurface(e)
          }
        },
        {
          key: '_findMinMax',
          value: function (e) {
            for (
              var t = e.length / 4,
                r = [e[0], e[1], e[2], e[3]],
                n = [e[0], e[1], e[2], e[3]],
                i = 1;
              i < t;
              ++i
            )
              for (var o = 4 * i, s = 0; s < 4; ++s) {
                var a = e[o + s]
                ;(r[s] = Math.max(a, r[s])), (n[s] = Math.min(a, n[s]))
              }
            return { maxPosRad: r, minPosRad: n }
          }
        },
        {
          key: '_findNumVoxels',
          value: function (e, t) {
            var r = this.numVoxels,
              n = this._findMinMax(e),
              i = n.minPosRad,
              o = n.maxPosRad
            4 < i[3] && (t.gridSpacing *= i[3])
            s = t.radScale * o[3] * 1.7
            for (
              var e = 0.65 * Math.sqrt((4 / 3) * Math.PI * s * s * s),
                s = Math.max(s, e),
                a = 0;
              a < 3;
              ++a
            )
              (i[a] -= s), (o[a] += s)
            for (a = 0; a < 3; ++a)
              r[a] = Math.ceil((o[a] - i[a]) / t.gridSpacing)
            ;(this.xAxis.x = (r[0] - 1) * t.gridSpacing),
              (this.yAxis.y = (r[1] - 1) * t.gridSpacing),
              (this.zAxis.z = (r[2] - 1) * t.gridSpacing)
            e = m(i, 3)
            return (
              (this.origin.x = e[0]),
              (this.origin.y = e[1]),
              (this.origin.z = e[2]),
              { bbox: n, dim: r }
            )
          }
        },
        {
          key: '_makeSurface',
          value: function (e, t) {
            var r = new Qn()
            r.compute(e.volMap, this.origin, t.isoValue, 1),
              r.vertexFusion(9, 9),
              0 < r._numTriangles
                ? (r.setColorVolTex(
                    e.volTexMap,
                    e.atomMap,
                    e.atomWeightMap,
                    this._visibilitySelector
                  ),
                  this.setIndex(new ae.BufferAttribute(r._indices, 1)),
                  this.setAttribute(
                    'position',
                    new ae.BufferAttribute(r._position, 3)
                  ),
                  this.setAttribute(
                    'normal',
                    new ae.BufferAttribute(r._normals, 3)
                  ),
                  this.setAttribute(
                    'color',
                    new ae.BufferAttribute(r._colors, 3)
                  ))
                : this.setAttribute(
                    'position',
                    new ae.BufferAttribute(le.allocateTyped(Float32Array, 0), 3)
                  )
          }
        },
        {
          key: '_calcSurface',
          value: function (e) {
            var t,
              r,
              n = {
                posRad: this._posRad,
                colors: this._colors,
                atoms: this._opts.atoms
              }
            0 !== n.posRad.length &&
              ((r = this._findNumVoxels(n.posRad, e)),
              (t = new ae.Box3(
                this.origin,
                new ae.Vector3(this.xAxis.x, this.yAxis.y, this.zAxis.z).add(
                  this.origin
                )
              )),
              (r = this._computeSurface(n, t, r, e)),
              this._makeSurface(r, e))
          }
        }
      ]),
      t
    )
  })()
  function ti(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ri = hr.Volume,
    ni = (function () {
      x(t, ei)
      var e = ti(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_computeSurface',
            value: function (e, t, r, n) {
              this._shiftByOrigin(e.posRad)
              var i = {
                volMap: new ri(Float32Array, this.numVoxels, t),
                volTexMap: new ri(Float32Array, this.numVoxels, t, 3)
              }
              return (
                null != this._visibilitySelector &&
                  ((i.atomMap = []),
                  (i.atomWeightMap = new ri(Float32Array, this.numVoxels, t))),
                this.gaussdensity(i, e, null, n),
                i
              )
            }
          },
          {
            key: 'gaussdensity',
            value: function (e, t, r, n) {
              var i,
                o = t.posRad.length / 4,
                s = t.posRad,
                a = t.colors,
                l = this.numVoxels,
                c = n.radScale,
                u = n.gaussLim,
                h = n.gridSpacing,
                f = 1 / n.isoValue,
                d = 1 / h,
                p = l[0] - 1,
                m = l[1] - 1,
                y = l[2] - 1,
                _ = e.volMap,
                v = e.volTexMap,
                g = _.getData(),
                x = _.getStrideX(),
                b = v.getData(),
                w = v.getStrideX()
              null != this._visibilitySelector &&
                (i = e.atomWeightMap.getData())
              for (var S = e.atomMap, R = 0; R < o; ++R) {
                var C = 4 * R,
                  A = s[3 + C] * c,
                  E = null === r ? 1 : r[R],
                  k = 1 / (2 * A * A),
                  T = u * A,
                  P = T * T
                T *= d
                var M = s[C] * d,
                  N = Math.max((M - T) | 0, 0),
                  L = Math.min((M + T) | 0, p),
                  M = s[1 + C] * d,
                  I = Math.max((M - T) | 0, 0),
                  O = Math.min((M + T) | 0, m)
                M = s[2 + C] * d
                for (
                  var A = Math.max((M - T) | 0, 0),
                    B = Math.min((M + T) | 0, y),
                    V = A * h - s[2 + C],
                    D = A;
                  D <= B;
                  ++D, V += h
                )
                  for (var z = I * h - s[1 + C], F = I; F <= O; ++F, z += h) {
                    var U = z * z + V * V
                    if (!(P <= U))
                      for (
                        var G = _.getDirectIdx(N, F, D),
                          j = v.getDirectIdx(N, F, D),
                          H = N * h - s[C],
                          W = N;
                        W <= L;
                        ++W, H += h, G += x, j += w
                      ) {
                        var Y = Math.exp(-(H * H + U) * k) * E
                        null != this._visibilitySelector &&
                          Y > i[G] &&
                          ((i[G] = Y), (S[G] = t.atoms[R])),
                          (g[G] += Y),
                          (Y *= f)
                        var X = 3 * R
                        ;(b[j] += Y * a[X]),
                          (b[j + 1] += Y * a[1 + X]),
                          (b[j + 2] += Y * a[2 + X])
                      }
                  }
              }
            }
          },
          {
            key: '_shiftByOrigin',
            value: function (e) {
              for (
                var t = this.origin.x,
                  r = this.origin.y,
                  n = this.origin.z,
                  i = e.length / 4,
                  o = 0;
                o < i;
                ++o
              ) {
                var s = 4 * o
                ;(e[s] -= t), (e[1 + s] -= r), (e[2 + s] -= n)
              }
            }
          }
        ]),
        t
      )
    })()
  function ii(C, e, t, r) {
    var n = C.length / 4,
      A = e[0],
      E = e[1],
      k = e[2],
      i = t[0],
      e = t[1],
      t = t[2]
    function T(e, t) {
      return Math.floor((e - t) / r)
    }
    for (
      var P,
        o,
        s,
        M = T(i, A) + 1,
        N = T(e, E) + 1,
        L = T(t, k) + 1,
        a = M * N * L,
        I = N * L,
        l = [],
        O = 0;
      O < n;
      O++
    ) {
      var c = 4 * O
      ;(o = C[c]),
        (s = C[1 + c]),
        (c = C[2 + c]),
        void 0 === l[(P = (T(o, A) * N + T(s, E)) * L + T(c, k))]
          ? (l[P] = [O])
          : l[P].push(O)
    }
    var B,
      V = le.allocateTyped(Uint32Array, a),
      D = le.allocateTyped(Uint16Array, a),
      z = le.allocateTyped(Uint32Array, n),
      u = 0,
      h = 0
    for (O = 0; O < a; O++) {
      var f = (V[O] = u),
        d = l[O]
      if (void 0 !== d) for (B = 0; B < d.length; B++) (z[u] = d[B]), u++
      f = u - f
      h < (D[O] = f) && (h = f)
    }
    ;(this.neighbourListLength = 27 * h + 1),
      (this.withinRadii = function (e, t, r, n, i) {
        var o = 0,
          s = T(e, A),
          a = T(t, E),
          l = T(r, k),
          c = Math.max(0, s - 1),
          u = Math.max(0, a - 1),
          h = Math.max(0, l - 1),
          f = Math.min(M - 1, s + 1),
          d = Math.min(N - 1, a + 1),
          p = Math.min(L - 1, l + 1)
        for (O = c; O <= f; ++O) {
          var m = O * I
          for (B = u; B <= d; ++B)
            for (var y = B * L, _ = h; _ <= p; ++_)
              for (
                var v = V[(P = m + y + _)], g = v + D[P], x = v;
                x < g;
                x++
              ) {
                var b = 4 * z[x],
                  w = C[b] - e,
                  S = C[1 + b] - t,
                  R = C[2 + b] - r,
                  b = C[3 + b] + n
                w * w + S * S + R * R <= b * b && (i[o++] = z[x])
              }
        }
        i[o] = -1
      })
  }
  function oi(e, t, r, n) {
    var N,
      i,
      o,
      O,
      B,
      V,
      D,
      L,
      I,
      z,
      F,
      U,
      G,
      j,
      H,
      W,
      Y,
      X = 4,
      q = e.posRad,
      $ = e.colors,
      Z = e.atoms,
      K = q.length / X,
      e = t.bbox,
      Q = e.minPosRad,
      s = e.maxPosRad,
      J = -1,
      ee = null,
      te = null,
      re = null,
      ne = new ae.Vector3(0, 0, 0),
      ie = new ae.Vector3(0, 0, 0),
      oe = new ae.Vector3(0, 0, 0)
    function a(e, t, r) {
      for (var n = 0; n < e.length; n++) e[n] = t + r * n
    }
    function l() {
      ;(O = r.scaleFactor),
        (V = t.dim),
        (Y = Math.min(5, 2 + Math.floor(o * O)))
      var e = V[0] * V[1] * V[2]
      ;(D = (function (e, t, r) {
        for (var n = le.allocateTyped(e, t), i = 0; i < t; ++i) n[i] = r
        return n
      })(Float32Array, e, -1001)),
        (L = le.allocateTyped(Float32Array, 3 * e)),
        (I = le.allocateTyped(Float32Array, e)),
        re && ((ee = le.allocateTyped(Float32Array, e)), (te = [])),
        (z = le.allocateTyped(Float32Array, V[0])),
        (F = le.allocateTyped(Float32Array, V[1])),
        (U = le.allocateTyped(Float32Array, V[2])),
        a(z, Q[0], 1 / O),
        a(F, Q[1], 1 / O),
        a(U, Q[2], 1 / O)
    }
    function c() {
      ;(o = r.probeRadius),
        (O = r.scaleFactor),
        (B = r.probePositions),
        (re = r.visibilitySelector),
        (N = le.allocateTyped(Float32Array, K))
      for (var e = (i = 0); e < K; ++e) {
        var t = (q[e * X + 3] += o)
        i < t && (i = t), (N[e] = t * t)
      }
      l(),
        (function () {
          var e = 0,
            t = (2 * Math.PI) / B
          ;(j = le.allocateTyped(Float32Array, B)),
            (G = le.allocateTyped(Float32Array, B))
          for (var r = 0; r < B; r++)
            (j[r] = Math.cos(e)), (G[r] = Math.sin(e)), (e += t)
        })(),
        (H = new ii(q, Q, s, 2.01 * i)),
        (W = new Int32Array(H.neighbourListLength)),
        (J = -1)
    }
    function u(e, t, r, n) {
      var i = X * e,
        e = N[e],
        t = q[i] - t,
        r = q[1 + i] - r,
        n = q[2 + i] - n
      return t * t + r * r + n * n < e
    }
    function se(e, t, r, n, i) {
      if (-1 !== J) {
        if ((s = J) !== n && s !== i && u(s, e, t, r)) return s
        J = -1
      }
      for (var o = 0, s = W[o]; 0 <= s; ) {
        if (s !== n && s !== i && u(s, e, t, r)) return (J = s)
        s = W[++o]
      }
      return (J = -1)
    }
    function h() {
      for (var e = 0; e < K; e++) {
        var t = X * e
        H.withinRadii(q[t], q[1 + t], q[2 + t], q[3 + t], W)
        for (var r = 0, n = W[r]; 0 <= n; )
          e < n &&
            (function (e, t) {
              var r = X * t,
                n = q[(f = X * e)],
                i = q[1 + f],
                o = q[2 + f],
                s = q[3 + f],
                a = (ne.x = q[r] - n),
                l = (ne.y = q[1 + r] - i),
                c = (ne.z = q[2 + r] - o),
                u = q[3 + r],
                h = a * a + l * l + c * c,
                f = Math.sqrt(h),
                r = s * ((s * s + f * f - u * u) / (2 * s * f))
              ne.normalize(),
                (u = ne),
                ((f = ie).x = f.y = f.z = 1),
                0 !== u.x
                  ? (f.x = (u.y + u.z) / -u.x)
                  : 0 !== u.y
                  ? (f.y = (u.x + u.z) / -u.y)
                  : 0 !== u.z && (f.z = (u.x + u.y) / -u.z),
                ie.normalize(),
                oe.crossVectors(ne, ie),
                oe.normalize(),
                (s = Math.sqrt(s * s - r * r)),
                ie.multiplyScalar(s),
                oe.multiplyScalar(s),
                ne.multiplyScalar(r),
                (ne.x += n),
                (ne.y += i),
                (ne.z += o),
                (J = -1)
              for (var d = Y, p = 0; p < B; p++) {
                var m = j[p],
                  y = G[p],
                  _ = ne.x + m * ie.x + y * oe.x,
                  v = ne.y + m * ie.y + y * oe.y,
                  g = ne.z + m * ie.z + y * oe.z
                if (-1 === se(_, v, g, e, t))
                  for (
                    var x = Math.floor(O * (_ - Q[0])),
                      b = Math.floor(O * (v - Q[1])),
                      m = Math.floor(O * (g - Q[2])),
                      w = Math.max(0, x - d),
                      S = Math.max(0, b - d),
                      y = Math.max(0, m - d),
                      R = Math.min(V[0], x + d + 2),
                      C = Math.min(V[1], b + d + 2),
                      A = Math.min(V[2], m + d + 2),
                      E = y;
                    E < A;
                    E++
                  )
                    for (
                      var c = g - U[E], k = V[1] * V[0] * E, T = S;
                      T < C;
                      T++
                    )
                      for (
                        var P = c * c + (l = v - F[T]) * l,
                          M = k + V[0] * T,
                          N = w;
                        N < R;
                        N++
                      ) {
                        var h = P + (a = _ - z[N]) * a,
                          L = N + M,
                          I = D[L]
                        0 < I && h < I * I && (D[L] = Math.sqrt(h))
                      }
              }
            })(e, n),
            (n = W[++r])
      }
    }
    function f() {
      c(),
        (function () {
          for (var e = 0; e < K; e++) {
            var t = X * e,
              r = q[t],
              n = q[1 + t],
              i = q[2 + t],
              o = q[3 + t],
              s = N[e]
            H.withinRadii(r, n, i, o, W)
            for (
              var a = Math.ceil(o * O),
                l = Math.floor(O * (r - Q[0])),
                c = Math.floor(O * (n - Q[1])),
                u = Math.floor(O * (i - Q[2])),
                h = Math.max(0, l - a),
                f = Math.max(0, c - a),
                t = Math.max(0, u - a),
                d = Math.min(V[0], l + a + 2),
                p = Math.min(V[1], c + a + 2),
                m = Math.min(V[2], u + a + 2),
                a = 3 * e,
                y = $[a],
                _ = $[1 + a],
                v = $[2 + a],
                g = t;
              g < m;
              g++
            )
              for (var x = U[g] - i, b = V[1] * V[0] * g, w = f; w < p; w++)
                for (
                  var S = F[w] - n, R = x * x + S * S, C = b + V[0] * w, A = h;
                  A < d;
                  A++
                ) {
                  var E,
                    k,
                    T = A + C,
                    P = z[A] - r,
                    M = R + P * P
                  M < s &&
                    ((E = Math.exp(0.28125 * -M)),
                    (L[(k = 3 * T)] += y * E),
                    (L[1 + k] += _ * E),
                    (L[2 + k] += v * E),
                    (I[T] += E),
                    null !== re && E > ee[T] && ((ee[T] = E), (te[T] = Z[e])),
                    D[T] < 0 && (D[T] = -D[T]),
                    (P = P * (E = o / (k = Math.sqrt(M)))),
                    (M = S * E),
                    (E = x * E),
                    -1 !== se((P += r), (M += n), (E += i), e, -1) ||
                      ((k = o - k) < D[T] && (D[T] = k)))
                }
          }
        })(),
        h(),
        (function () {
          for (var e = 0, t = D.length; e < t; e++) {
            D[e] < 0 && (D[e] = 0)
            var r,
              n = I[e]
            0 < n &&
              ((L[(r = 3 * e)] *= n = 1 / n), (L[1 + r] *= n), (L[2 + r] *= n))
          }
        })()
    }
    this.build = function () {
      f(),
        (this.volTexMap = L),
        (this.weightsMap = ee),
        (this.atomMap = te),
        (this.volMap = D)
    }
  }
  function si(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ai = hr.Volume,
    li = (function () {
      x(t, ei)
      var e = si(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_computeSurface',
            value: function (e, t, r, n) {
              n = new oi(e, r, n)
              return (
                n.build(),
                {
                  volMap: new ai(Float32Array, this.numVoxels, t, 1, n.volMap),
                  volTexMap: new ai(
                    Float32Array,
                    this.numVoxels,
                    t,
                    3,
                    n.volTexMap
                  ),
                  atomMap: n.atomMap,
                  atomWeightMap: new ai(
                    Float32Array,
                    this.numVoxels,
                    t,
                    1,
                    n.weightsMap
                  )
                }
              )
            }
          }
        ]),
        t
      )
    })(),
    ci = p(function e(t, r) {
      G(this, e),
        (this.coord = new ae.Vector3()),
        this.coord.copy(t),
        (this.radius = r),
        (this.colorX = 0.99999),
        (this.colorY = 0),
        (this.colorZ = 0),
        (this.atomType = 0),
        (this.srcAtom = null)
    }),
    ui = (function () {
      function o(e, t, r, n, i) {
        G(this, o),
          (this._numAtoms = e),
          (this._atoms = t),
          (this._vBoxMin = new ae.Vector3()),
          (this._vBoxMax = new ae.Vector3()),
          this._vBoxMin.copy(r),
          this._vBoxMax.copy(n),
          (this._probeRadius = i),
          (this._atomsList = null),
          (this._voxelList = null)
      }
      return (
        p(o, [
          {
            key: 'createVoxels',
            value: function () {
              for (
                var e,
                  t = 0 | this._numAtoms,
                  r = this._atoms,
                  n = this._vBoxMax.x - this._vBoxMin.x,
                  i = this._vBoxMax.y - this._vBoxMin.y,
                  o = this._vBoxMax.z - this._vBoxMin.z,
                  i = o < (i = n < i ? n : i) ? o : i,
                  s = 0,
                  a = 0,
                  l = 0;
                l < t;
                l++
              )
                (s = s < (R = 2 * (r[l].radius + this._probeRadius)) ? R : s),
                  (a += R)
              var c = Math.floor(i / s)
              ;(a /= t),
                (this._numCells = c = c < 2 ? 2 : c),
                (this._aveRad = a),
                (this._maxRad = s)
              var u = c,
                h = c * c,
                f = c * c * c,
                d = (this._xScale = 1 / (this._vBoxMax.x - this._vBoxMin.x)),
                p = (this._yScale = 1 / (this._vBoxMax.y - this._vBoxMin.y)),
                m = (this._zScale = 1 / (this._vBoxMax.z - this._vBoxMin.z)),
                y = 0,
                _ = d * c,
                v = p * c,
                g = m * c
              for (l = 0; l < t; l++) {
                var x = 2 * (4.5 * (r[l].radius + this._probeRadius)),
                  b = Math.floor(_ * x + 0.8),
                  w = Math.floor(v * x + 0.8),
                  x = Math.floor(g * x + 0.8)
                y += ++b * ++w * ++x
              }
              this._voxelList = le.allocateTyped(Int32Array, f)
              var S = []
              if (((S.length = y), null === this._voxelList || null === S))
                return -1
              for (l = 0; l < f; l++) this._voxelList[l] = -1
              for (l = e = 0; l < t; l++)
                for (
                  var R = 4.5 * (r[l].radius + this._probeRadius),
                    C = Math.floor(
                      (r[l].coord.x - this._vBoxMin.x - R) * c * d
                    ),
                    A = Math.floor(
                      (r[l].coord.y - this._vBoxMin.y - R) * c * p
                    ),
                    E = Math.floor(
                      (r[l].coord.z - this._vBoxMin.z - R) * c * m
                    ),
                    C = 0 <= C ? C : 0,
                    A = 0 <= A ? A : 0,
                    k =
                      (k = Math.floor(
                        (r[l].coord.x - this._vBoxMin.x + R) * c * d
                      )) < c
                        ? k
                        : c - 1,
                    T =
                      (T = Math.floor(
                        (r[l].coord.y - this._vBoxMin.y + R) * c * p
                      )) < c
                        ? T
                        : c - 1,
                    P =
                      (P = Math.floor(
                        (r[l].coord.z - this._vBoxMin.z + R) * c * m
                      )) < c
                        ? P
                        : c - 1,
                    M = (E = 0 <= E ? E : 0);
                  M <= P;
                  M++
                )
                  for (var N = A; N <= T; N++)
                    for (var L = C; L <= k; L++) {
                      var I,
                        O = L + N * u + M * h
                      this._voxelList[O] < 0
                        ? ((S[2 * e + 0] = l),
                          (S[2 * e + 1] = -1),
                          (this._voxelList[O] = e),
                          e++)
                        : ((I = this._voxelList[O]),
                          (S[2 * (this._voxelList[O] = e) + 0] = l),
                          (S[2 * e + 1] = I),
                          e++)
                    }
              return (this._atomsList = Int32Array.from(S)), 0
            }
          },
          {
            key: 'destroyVoxels',
            value: function () {
              ;(this._atomsList = null),
                (this._voxelList = null),
                (this._atoms = null),
                (this._vertices = null),
                (this._vBoxMin = null),
                (this._vBoxMax = null)
            }
          },
          {
            key: 'forEachRelatedAtom',
            value: function (e, t) {
              for (
                var r = Math.floor(
                    (e.x - this._vBoxMin.x) * this._numCells * this._xScale
                  ),
                  n = Math.floor(
                    (e.y - this._vBoxMin.y) * this._numCells * this._yScale
                  ),
                  e = Math.floor(
                    (e.z - this._vBoxMin.z) * this._numCells * this._zScale
                  ),
                  e =
                    r +
                    n * this._numCells +
                    e * this._numCells * this._numCells,
                  i = this._atoms,
                  o = this._voxelList[e];
                0 <= o;
                o = this._atomsList[2 * o + 1]
              )
                t(i[this._atomsList[2 * o]])
            }
          },
          {
            key: 'getClosestAtom',
            value: function (r) {
              var n = null,
                i = Number.MAX_VALUE
              return (
                this.forEachRelatedAtom(r, function (e) {
                  var t = r.distanceToSquared(e.coord)
                  t < i && ((i = t), (n = e))
                }),
                n
              )
            }
          },
          {
            key: 'buildNormals',
            value: function (e, t, r) {
              for (
                var i,
                  o,
                  s,
                  a,
                  l,
                  c = this,
                  u = 0,
                  h = 0,
                  f = 0,
                  d = 0,
                  p = 0,
                  n = 2.5 * this._aveRad,
                  m = n * n,
                  y = 0.1 * -this._aveRad,
                  _ = function (e) {
                    var t = i - e.coord.x,
                      r = o - e.coord.y,
                      n = s - e.coord.z
                    m < (a = t * t + r * r + n * n) ||
                      ((e = e.radius + c._probeRadius),
                      (p = a - e * e) < 0 && (p = -p),
                      (l = Math.exp(y * p)),
                      (h += t * l),
                      (f += r * l),
                      (d += n * l),
                      u++)
                  },
                  v = 0;
                v < e;
                v++
              )
                (i = t[v].x),
                  (o = t[v].y),
                  (s = t[v].z),
                  (h = f = d = u = 0),
                  this.forEachRelatedAtom(t[v], _),
                  (a = h * h + f * f + d * d),
                  0 < u &&
                    ((p = 1 / Math.sqrt(a)), (h *= p), (f *= p), (d *= p)),
                  (r[v].x = h),
                  (r[v].y = f),
                  (r[v].z = d)
              return 0
            }
          },
          {
            key: 'buildColors',
            value: function (e, t, r, n) {
              for (
                var i,
                  o,
                  s,
                  a,
                  l = this,
                  c = 0,
                  u = n * n,
                  h = [],
                  f = [],
                  d = 0,
                  p = function (e) {
                    var t = i - e.coord.x,
                      r = o - e.coord.y,
                      n = s - e.coord.z,
                      r = t * t + r * r + n * n
                    u < r ||
                      ((n = e.radius + l._probeRadius),
                      (a = 1 / (0.8 + (c = (c = r - n * n) < 0 ? -c : c))),
                      h.push([e.colorX, e.colorY, e.colorZ]),
                      f.push(a),
                      (d += a))
                  },
                  m = 0;
                m < e;
                m++
              ) {
                ;(i = t[m].x),
                  (o = t[m].y),
                  (s = t[m].z),
                  (h = []),
                  (f = []),
                  (d = 0),
                  this.forEachRelatedAtom(t[m], p)
                for (var y = 0; y < h.length; ++y) {
                  var _ = f[y] / d
                  ;(r[m].x += h[y][0] * _),
                    (r[m].y += h[y][1] * _),
                    (r[m].z += h[y][2] * _)
                }
              }
              return 0
            }
          }
        ]),
        o
      )
    })(),
    hi = (function () {
      function i(e, t, r) {
        var n
        for (
          G(this, i),
            this._maxNumVertices = e,
            this._maxNumTriangles = t,
            this._vertices = new Array(e),
            this._normals = new Array(e),
            this._colors = null,
            r && (this._colors = new Array(e)),
            this._indices = new Array(3 * t),
            this._numVertices = 0,
            n = this._numTriangles = 0;
          n < e;
          n++
        )
          (this._vertices[n] = new ae.Vector3()),
            (this._normals[n] = new ae.Vector3())
        for (n = 0; n < 3 * t; n++) this._indices[n] = -1
        if (r) for (n = 0; n < e; n++) this._colors[n] = new ae.Vector3()
      }
      return (
        p(i, [
          {
            key: 'destroy',
            value: function () {
              ;(this._vertices = null),
                (this._normals = null),
                (this._indices = null)
            }
          }
        ]),
        i
      )
    })()
  function fi(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var di = hr.Element
  function pi(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var mi = {
      InstancedSpheresGeometry: Gr,
      SimpleSpheresGeometry: Xr,
      Simple2CCylindersGeometry: Qr,
      Instanced2CCylindersGeometry: cn,
      ExtrudedObjectsGeometry: gn,
      ChunkedLinesGeometry: In,
      TwoColorLinesGeometry: Vn,
      CrossGeometry: jn,
      QuickSurfGeometry: ni,
      ContactSurfaceGeometry: li,
      SSIsosurfaceGeometry: (function () {
        x(t, Yn)
        var e = fi(t)
        function t() {
          return G(this, t), e.apply(this, arguments)
        }
        return (
          p(t, [
            {
              key: '_build',
              value: function () {
                this._innerBuild()
                var e = this.getGeo()
                this.destroy(), this._fromGeo(e)
              }
            },
            {
              key: '_fromGeo',
              value: function (e) {
                var t = null,
                  r = le.allocateTyped(Float32Array, 3 * e._numVertices),
                  n = le.allocateTyped(Float32Array, 3 * e._numVertices)
                null !== e._colors &&
                  (t = le.allocateTyped(Float32Array, 3 * e._numVertices))
                for (
                  var i = le.allocateTyped(Uint32Array, 3 * e._numTriangles),
                    o = 0,
                    s = 0;
                  o < e._numVertices;
                  o++
                )
                  (r[s + 0] = e._vertices[o].x),
                    (r[s + 1] = e._vertices[o].y),
                    (r[s + 2] = e._vertices[o].z),
                    (n[s + 0] = e._normals[o].x),
                    (n[s + 1] = e._normals[o].y),
                    (n[s + 2] = e._normals[o].z),
                    (s += 3)
                if (null !== t)
                  for (var a = 0, l = 0; a < e._numVertices; a++, l += 3)
                    (t[l + 0] = e._colors[a].x),
                      (t[l + 1] = e._colors[a].y),
                      (t[l + 2] = e._colors[a].z)
                for (var c = 3 * e._numTriangles, u = 0; u < c; u++)
                  i[u] = e._indices[u]
                this.setIndex(new ae.BufferAttribute(i, 1)),
                  this.setAttribute('position', new ae.BufferAttribute(r, 3)),
                  this.setAttribute('normal', new ae.BufferAttribute(n, 3)),
                  this.setAttribute('color', new ae.BufferAttribute(t, 3)),
                  this.computeBoundingBox(),
                  this.computeBoundingSphere(),
                  e.destroy()
              }
            },
            {
              key: 'convertToAtomsColored',
              value: function (e, t) {
                for (
                  var r = e.atoms, n = e.colors, i = 0, o = r.length;
                  i < o;
                  i++
                ) {
                  var s = r[i].position,
                    a = r[i].element.radius
                  t[i] = new ci(s, a)
                  a = r[i].element.number
                  t[i].atomType = this.getType(a)
                  a = 3 * i
                  ;(t[i].colorX = n[a++]),
                    (t[i].colorY = n[a++]),
                    (t[i].colorZ = n[a]),
                    (t[i].srcAtom = r[i])
                }
              }
            },
            {
              key: 'getGeo',
              value: function () {
                return this.geoOut
              }
            },
            {
              key: 'destroy',
              value: function () {
                ;(this.atoms = null),
                  (this.hashLines = null),
                  (this.hashEntries = null)
              }
            },
            {
              key: 'getBoundingBox',
              value: function (e, t, r) {
                ;(t.x = t.y = t.z = 1e7), (r.x = r.y = r.z = -1e7)
                for (
                  var n = this.probeRadius * this.atomRadiusScale,
                    i = 0,
                    o = 0,
                    s = e.length;
                  o < s;
                  o++
                ) {
                  var a = e[o].coord,
                    l = e[o].radius + n,
                    i = i < l ? l : i
                  a.x - l < t.x && (t.x = a.x - l),
                    a.y - l < t.y && (t.y = a.y - l),
                    a.z - l < t.z && (t.z = a.z - l),
                    a.x + l > r.x && (r.x = a.x + l),
                    a.y + l > r.y && (r.y = a.y + l),
                    a.z + l > r.z && (r.z = a.z + l)
                }
                ;(t.x -= i),
                  (t.y -= i),
                  (t.z -= i),
                  (r.x += i),
                  (r.y += i),
                  (r.z += i)
              }
            },
            {
              key: 'getCornerCoord',
              value: function (e, t, r, n, i, o, s) {
                ;(o = 1 / (o - 1)), (r *= o), (n *= o), (o *= i)
                ;(s.x = e.x * (1 - r) + t.x * r),
                  (s.y = e.y * (1 - n) + t.y * n),
                  (s.z = e.z * (1 - o) + t.z * o)
              }
            },
            {
              key: 'buildEdgePoint',
              value: function (e, t, r, n, i, o) {
                var s, a, l, c
                r[e] ^ r[t] &&
                  ((s =
                    (0 - n.pointsValuesLinear[i + 24 + e]) /
                    (n.pointsValuesLinear[i + 24 + t] -
                      n.pointsValuesLinear[i + 24 + e])),
                  (a = n.pointsValuesLinear[i + 3 * e + 0]),
                  (l = n.pointsValuesLinear[i + 3 * e + 1]),
                  (c = n.pointsValuesLinear[i + 3 * e + 2]),
                  (r = n.pointsValuesLinear[i + 3 * t + 0]),
                  (e = n.pointsValuesLinear[i + 3 * t + 1]),
                  (t = n.pointsValuesLinear[i + 3 * t + 2]),
                  (o.x = a * (1 - s) + r * s),
                  (o.y = l * (1 - s) + e * s),
                  (o.z = c * (1 - s) + t * s))
              }
            },
            {
              key: 'isTriangleVisible',
              value: function (e, t, r) {
                ;(e = this.voxelWorld.getClosestAtom(e)),
                  (t = this.voxelWorld.getClosestAtom(t)),
                  (r = this.voxelWorld.getClosestAtom(r))
                return (
                  null !== e &&
                  null !== t &&
                  null !== r &&
                  null !== e.srcAtom &&
                  null !== t.srcAtom &&
                  null !== r.srcAtom &&
                  this.visibilitySelector.includesAtom(e.srcAtom) &&
                  this.visibilitySelector.includesAtom(t.srcAtom) &&
                  this.visibilitySelector.includesAtom(r.srcAtom)
                )
              }
            },
            {
              key: 'addTriangle',
              value: function (e, t, r) {
                if (this.visibilitySelector && !this.isTriangleVisible(e, t, r))
                  return !0
                var n = this.geoOut
                if (n._numTriangles >= this.maxNumTriangles) return !1
                var i = this.addVertexToGeo(n, e),
                  e = this.addVertexToGeo(n, t),
                  t = this.addVertexToGeo(n, r)
                if ((i | e | t) < 0) return !1
                r = 3 * n._numTriangles
                return (
                  (n._indices[0 + r] = i),
                  (n._indices[1 + r] = e),
                  (n._indices[2 + r] = t),
                  n._numTriangles++,
                  !0
                )
              }
            },
            {
              key: 'buildGeoFromCorners',
              value: function (e, t, r, n, i, o) {
                for (var s = e - 1, a = new Array(12), l = 0; l < 12; l++)
                  a[l] = new ae.Vector3()
                for (var c = [], u = 0; u < 8; u++) c[u] = 1
                for (var h = new ae.Vector3(), f = 0, d = 0; d < s; d++, 0)
                  for (var p = 0; p < s; p++, 0)
                    for (var m = 0; m < s; m++)
                      if (o.hasIntersection[f]) {
                        var y = o.bitsInside[f]
                        this.getCornerCoord(t, r, m, d, p, e, h)
                        for (var _ = 32 * f, v = 0, g = 0; v < 8; v++)
                          (o.pointsValuesLinear[_ + g++] = h.x),
                            (o.pointsValuesLinear[_ + g++] = h.y),
                            (o.pointsValuesLinear[_ + g++] = h.z)
                        ;(o.pointsValuesLinear[3 + _] += i.x),
                          (o.pointsValuesLinear[6 + _] += i.x),
                          (o.pointsValuesLinear[15 + _] += i.x),
                          (o.pointsValuesLinear[18 + _] += i.x),
                          (o.pointsValuesLinear[6 + _ + 2] += i.z),
                          (o.pointsValuesLinear[9 + _ + 2] += i.z),
                          (o.pointsValuesLinear[18 + _ + 2] += i.z),
                          (o.pointsValuesLinear[21 + _ + 2] += i.z),
                          (o.pointsValuesLinear[12 + _ + 1] += i.y),
                          (o.pointsValuesLinear[15 + _ + 1] += i.y),
                          (o.pointsValuesLinear[18 + _ + 1] += i.y),
                          (o.pointsValuesLinear[21 + _ + 1] += i.y)
                        for (var x = 24 + _, b = 0; b < 8; ++b)
                          c[b] = o.pointsValuesLinear[x + b] < 0 ? 1 : 0
                        this.buildEdgePoint(0, 1, c, o, _, a[0]),
                          this.buildEdgePoint(1, 2, c, o, _, a[1]),
                          this.buildEdgePoint(2, 3, c, o, _, a[2]),
                          this.buildEdgePoint(3, 0, c, o, _, a[3]),
                          this.buildEdgePoint(4, 5, c, o, _, a[4]),
                          this.buildEdgePoint(5, 6, c, o, _, a[5]),
                          this.buildEdgePoint(6, 7, c, o, _, a[6]),
                          this.buildEdgePoint(7, 4, c, o, _, a[7]),
                          this.buildEdgePoint(0, 4, c, o, _, a[8]),
                          this.buildEdgePoint(1, 5, c, o, _, a[9]),
                          this.buildEdgePoint(2, 6, c, o, _, a[10]),
                          this.buildEdgePoint(3, 7, c, o, _, a[11])
                        for (var w = 16 * y, S = 0, R = 0; S < 6; S++, R += 3) {
                          var C = o.striIndicesMarchCube[w + R]
                          if (C < 0) break
                          var A = o.striIndicesMarchCube[w + R + 1],
                            E = o.striIndicesMarchCube[w + R + 2]
                          if (!this.addTriangle(a[C], a[A], a[E])) return -2
                        }
                        f++
                      } else f++
                return 0
              }
            },
            {
              key: 'getNumIntersectedCells',
              value: function (e, t, r, n) {
                for (
                  var i = e * e, o = 0, s = 0, a = 0, l = 0;
                  l < t;
                  l++, a += i
                )
                  for (var c = 0, u = 0; u < t; u++, c += e)
                    for (var h = 0; h < t; h++) {
                      var f = 32 * s + 24,
                        d = h + c + a
                      ;(n.pointsValuesLinear[f] = r[d]),
                        (n.pointsValuesLinear[1 + f] = r[d + 1]),
                        (n.pointsValuesLinear[2 + f] = r[d + e + 1]),
                        (n.pointsValuesLinear[3 + f] = r[d + e]),
                        (n.pointsValuesLinear[4 + f] = r[i + d]),
                        (n.pointsValuesLinear[5 + f] = r[i + d + 1]),
                        (n.pointsValuesLinear[6 + f] = r[i + d + e + 1]),
                        (n.pointsValuesLinear[7 + f] = r[i + d + e])
                      for (var p = 0, m = 0; m < 8; ++m)
                        n.pointsValuesLinear[f + m] < 0 && (p |= 1 << m)
                      0 === p || 255 === p
                        ? (n.hasIntersection[s] = !1)
                        : ((n.hasIntersection[s] = !0), o++),
                        (n.bitsInside[s] = p),
                        s++
                    }
                return o
              }
            },
            {
              key: 'getType',
              value: function (e) {
                var t = [
                  0, 0, 1, 1, 2, 6, 3, 6, 4, 6, 5, 6, 6, 0, 7, 3, 8, 2, 9, 6,
                  10, 6, 11, 6, 12, 6, 13, 6, 14, 6, 15, 4, 16, 5, 17, 6, 18, 6,
                  19, 6, 20, 6, 21, 6, 22, 6, 23, 6, 24, 6, 25, 6, 26, 6, 27, 6,
                  28, 6, 29, 6, 30, 6, 31, 6, 32, 6, 33, 6, 34, 6, 35, 6, 36, 6,
                  37, 6, 38, 6, 39, 6, 40, 6, 41, 6, 42, 6, 43, 6, 44, 6, 45, 6,
                  46, 6, 47, 6, 48, 6, 49, 6, 50, 6, 51, 6, 52, 6, 53, 6, 54, 6,
                  55, 6, 56, 6, 57, 6, 58, 6, 59, 6, 60, 6, 61, 6, 62, 6, 63, 6,
                  64, 6, 65, 6, 66, 6, 67, 6, 68, 6, 69, 6, 70, 6, 71, 6, 72, 6,
                  73, 6, 74, 6, 75, 6, 76, 6, 77, 6, 78, 6, 79, 6, 80, 6, 81, 6,
                  82, 6, 83, 6, 84, 6, 85, 6, 86, 6, 87, 6, 88, 6, 89, 6, 90, 6,
                  91, 6, 92, 6, 93, 6, 94, 6, 95, 6, 96, 6, 97, 6, 98, 6, 99, 6,
                  100, 6, 101, 6, 102, 6, 103, 6, 104, 6, 105, 6, 106, 6, 107,
                  6, 108, 6, 109, 6
                ]
                if (
                  e < 1 ||
                  t.length / 2 < e ||
                  2 * Object.keys(di.ByAtomicNumber).length !== t.length
                )
                  throw new Error(
                    'atomT.length  should be equal Element.ByAtomicNumber.length * 2'
                  )
                return t[2 * e]
              }
            },
            {
              key: 'calculateGridCorners',
              value: function (e, t, r, n, i, o) {
                for (
                  var s = t * t,
                    a = s * t,
                    l = new ae.Vector3(),
                    c = new ae.Vector3(),
                    u = 0;
                  u < a;
                  u++
                )
                  e[u] = 1e12
                for (
                  var h = (t - 1) / (n.x - r.x),
                    f = (t - 1) / (n.y - r.y),
                    d = (t - 1) / (n.z - r.z),
                    p = 0,
                    m = i.length;
                  p < m;
                  p++
                )
                  for (
                    var y = i[p],
                      _ = y.radius + o,
                      v = (y.coord.x - _ - r.x) * h,
                      g = (y.coord.y - _ - r.y) * f,
                      x = (y.coord.z - _ - r.z) * d,
                      b = Math.floor(v),
                      g = Math.floor(g),
                      w = Math.floor(x),
                      S = Math.floor((y.coord.x + _ - r.x) * h),
                      R = Math.floor((y.coord.y + _ - r.y) * f),
                      C = Math.floor((y.coord.z + _ - r.z) * d),
                      S = ++S <= t - 1 ? S : t - 1,
                      R = ++R <= t - 1 ? R : t - 1,
                      C = ++C <= t - 1 ? C : t - 1,
                      A = g;
                    A <= R;
                    A++
                  )
                    for (var E = A * s, k = w; k <= C; k++)
                      for (var T = k * t, P = b; P <= S; P++) {
                        var M = E + T + P
                        this.getCornerCoord(r, n, P, A, k, t, l),
                          (c.x = l.x - y.coord.x),
                          (c.y = l.y - y.coord.y),
                          (c.z = l.z - y.coord.z)
                        var N = Math.sqrt(c.x * c.x + c.y * c.y + c.z * c.z) - _
                        N < e[M] && (e[M] = N)
                      }
              }
            },
            {
              key: 'createVertexHash',
              value: function (e, t) {
                if (
                  ((this.hashLines = le.allocateTyped(Int32Array, 65536)),
                  null === this.hashLines)
                )
                  return -1
                for (var r = 0, n = 0; r < 32768; r++)
                  (this.hashLines[n++] = 0), (this.hashLines[n++] = -1)
                if (
                  ((this.maxNumVertices = e),
                  (this.maxNumTriangles = t),
                  (this.numHashEtriesAllocated = e),
                  (this.hashEntries = le.allocateTyped(
                    Int32Array,
                    2 * this.numHashEtriesAllocated
                  )),
                  null === this.hashEntries)
                )
                  return -1
                for (var i = 0, o = 0; i < this.numHashEtriesAllocated; i++)
                  (this.hashEntries[o++] = -1), (this.hashEntries[o++] = -1)
                return (this.numHashEntryIndex = 0)
              }
            },
            {
              key: 'getNewHashEntry',
              value: function () {
                if (this.numHashEntryIndex < this.numHashEtriesAllocated) {
                  var e = this.numHashEntryIndex
                  return this.numHashEntryIndex++, e
                }
                return -1
              }
            },
            {
              key: 'addVertexToGeo',
              value: function (e, t) {
                var r,
                  n = this.marCubeResoultion << 2,
                  i = new ae.Vector3(),
                  o = Math.floor(
                    (n * (t.x - this.vBoxMin.x)) /
                      (this.vBoxMax.x + 0.01 - this.vBoxMin.x)
                  ),
                  s = Math.floor(
                    (n * (t.y - this.vBoxMin.y)) /
                      (this.vBoxMax.y + 0.01 - this.vBoxMin.y)
                  ),
                  o =
                    815851 * o +
                    37633 *
                      Math.floor(
                        (n * (t.z - this.vBoxMin.z)) /
                          (this.vBoxMax.z + 0.01 - this.vBoxMin.z)
                      ) +
                    2453543 * s,
                  n = (o &= 32767) + o
                if (null !== this.vBoxMin && null !== this.vBoxMax)
                  for (
                    r = this.hashLines[1 + n];
                    0 <= r;
                    r = this.hashEntries[2 * r + 1]
                  ) {
                    var a = this.hashEntries[2 * r + 0]
                    if (
                      (i.copy(e._vertices[a]),
                      (i.x -= t.x),
                      (i.y -= t.y),
                      (i.z -= t.z),
                      i.x * i.x + i.y * i.y + i.z * i.z < 1e-6)
                    )
                      return a
                  }
                if (e._numVertices >= this.maxNumVertices) return -1
                s = e._numVertices
                if (
                  (e._vertices[s].copy(t),
                  null !== this.vBoxMin && null !== this.vBoxMax)
                ) {
                  if ((r = this.getNewHashEntry()) < 0) return -1
                  o = this.hashLines[1 + n]
                  ;(this.hashLines[1 + n] = r),
                    (this.hashEntries[2 * r + 0] = s),
                    (this.hashEntries[2 * r + 1] = o),
                    this.hashLines[n]++
                }
                return e._numVertices++, s
              }
            },
            {
              key: 'modifyExcludedFromGeo',
              value: function (e, t, r, n, i, o) {
                for (
                  var s = e * e,
                    a = (e - 1) / (n.x - r.x),
                    l = (e - 1) / (n.y - r.y),
                    c = (e - 1) / (n.z - r.z),
                    u = 2 * t * (2 * t),
                    h = 1 / (e - 1),
                    f = 0;
                  f < i._numVertices;
                  f++
                )
                  for (
                    var d = i._vertices[f],
                      p = 1.1 * t,
                      m = Math.floor((d.x - p - r.x) * a),
                      y = Math.floor((d.y - p - r.y) * l),
                      m = 0 <= m ? m : 0,
                      _ = 0 <= (_ = Math.floor((d.z - p - r.z) * c)) ? _ : 0,
                      v =
                        (v = Math.floor((d.x + p - r.x) * a)) <= e - 1
                          ? v
                          : e - 1,
                      g =
                        (g = Math.floor((d.y + p - r.y) * l)) <= e - 1
                          ? g
                          : e - 1,
                      x =
                        (x = Math.floor((d.z + p - r.z) * c)) <= e - 1
                          ? x
                          : e - 1,
                      b = (y = 0 <= y ? y : 0);
                    b <= g;
                    b++
                  )
                    for (var w = b * s, S = _; S <= x; S++)
                      for (var R = S * e, C = m; C <= v; C++) {
                        var A = w + R + C,
                          E = C * h,
                          k = r.x * (1 - E) + n.x * E,
                          T = r.y * (1 - (E = b * h)) + n.y * E,
                          E = r.z * (1 - (E = S * h)) + n.z * E,
                          k = k - d.x,
                          T = T - d.y,
                          E = E - d.z,
                          E = k * k + T * T + E * E
                        E < u &&
                          ((E = Math.sqrt(E)),
                          0 < (E = -(E - t)) && o[A] < 0 && (o[A] = E),
                          E > o[A] && (o[A] = E))
                      }
                return 0
              }
            },
            {
              key: '_innerBuild',
              value: function () {
                var e = {
                  posRad: this._posRad,
                  colors: this._colors,
                  atoms: this._opts.atoms
                }
                ;(this.complex = this._opts.parent),
                  (this.atoms = e.atoms),
                  (this.meshResolution = this._opts.gridSpacing),
                  (this.atomRadiusScale = this._opts.radScale),
                  (this.colorMode = this._opts.colorMode),
                  (this.probeRadius = this._opts.probeRadius),
                  (this.useVertexColors = !0),
                  (this.excludeProbe = this._opts.excludeProbe),
                  (this.visibilitySelector = this._opts.visibilitySelector),
                  (this.geoOut = null),
                  (this.hashLines = null),
                  (this.hashEntries = null),
                  (this.numHashEtriesAllocated = 0),
                  (this.numHashEntryIndex = 0),
                  (this.maxNumVertices = 0),
                  (this.maxNumTriangles = 0)
                var t = new Array(this.atoms.length)
                this.convertToAtomsColored(e, t)
                var r = (this.vBoxMin = new ae.Vector3()),
                  n = (this.vBoxMax = new ae.Vector3())
                this.getBoundingBox(t, r, n)
                var i = (this.marCubeResoultion = 4 * this.meshResolution),
                  o = i,
                  s = le.allocateTyped(Float32Array, o * o * o),
                  a = this.probeRadius * this.atomRadiusScale
                this.calculateGridCorners(s, o, r, n, t, a)
                var l,
                  c = i - 1,
                  u = new Xn()
                if ((l = u.create(c)) < 0) return l
                var h = new ae.Vector3()
                ;(h.x = (n.x - r.x) / c),
                  (h.y = (n.y - r.y) / c),
                  (h.z = (n.z - r.z) / c)
                var f = this.getNumIntersectedCells(o, c, s, u),
                  d = Math.floor(1.2 * f),
                  p = Math.floor(1.2 * f * 2)
                if (
                  ((this.geoOut = new hi(d, p, this.useVertexColors)),
                  (l = this.createVertexHash(d, p)) < 0)
                )
                  return l
                e = a
                if (
                  (this.excludeProbe && (e = 0.01),
                  (this.voxelWorld = new ui(t.length, t, r, n, e)),
                  this.voxelWorld.createVoxels(),
                  (l = this.buildGeoFromCorners(i, r, n, s, h, u)),
                  this.excludeProbe)
                ) {
                  if (
                    (this.modifyExcludedFromGeo(o, a, r, n, this.geoOut, s),
                    (this.geoOut._vertices = null),
                    (this.geoOut._colors = null),
                    (this.geoOut._indices = null),
                    (this.geoOut._normals = null),
                    (this.geoOut._numVertices = 0),
                    (this.geoOut._numTriangles = 0),
                    (this.geoOut = null),
                    (f = this.getNumIntersectedCells(o, c, s, u)),
                    (d = Math.floor(1.2 * f)),
                    (p = Math.floor(1.2 * f * 2)),
                    (this.geoOut = new hi(d, p, this.useVertexColors)),
                    (l = this.createVertexHash(d, p)) < 0)
                  )
                    return l
                  l = this.buildGeoFromCorners(o, r, n, s, h, u)
                }
                this.voxelWorld.buildNormals(
                  this.geoOut._vertices.length,
                  this.geoOut._vertices,
                  this.geoOut._normals
                )
                h = 6.5
                return (
                  this.excludeProbe && (h -= 1.5),
                  this.useVertexColors &&
                    this.voxelWorld.buildColors(
                      this.geoOut._vertices.length,
                      this.geoOut._vertices,
                      this.geoOut._colors,
                      h
                    ),
                  this.voxelWorld.destroyVoxels(),
                  (this.voxelWorld = null),
                  u.destroy(),
                  l
                )
              }
            }
          ]),
          t
        )
      })(),
      LabelsGeometry: (function () {
        x(s, T)
        var o = pi(s)
        function s(e, t) {
          var r
          G(this, s),
            ((r = o.call(this))._opts = t),
            (r.items = []),
            (r.needsUpdate = !1)
          var n = -50,
            i = -50
          switch (t.horizontalAlign) {
            case 'left':
              n = 0
              break
            case 'right':
              n = -100
          }
          switch (t.verticalAlign) {
            case 'top':
              i = -100
              break
            case 'bottom':
              i = 0
          }
          t = new ae.Vector3(t.dx || 0, t.dy || 0, t.dz || 0)
          return (
            (r.userData = {
              translation: 'translate('.concat(n, '%, ').concat(i, '%)'),
              offset: t
            }),
            r
          )
        }
        return (
          p(s, [
            {
              key: 'setItem',
              value: function (e, t, r) {
                var n = this._opts,
                  r =
                    this.items[e] ||
                    (function (e, t) {
                      var r = document.createElement('div')
                      if (((r.className = t), 'string' == typeof e)) {
                        var n = document.createElement('span')
                        n.style.fontSize = '150%'
                        for (
                          var i = e.split('\n'), o = 0, s = i.length;
                          o < s;
                          ++o
                        ) {
                          var a = document.createElement('span'),
                            l = document.createTextNode(i[o])
                          a.appendChild(l),
                            n.appendChild(a),
                            o < s - 1 &&
                              n.appendChild(document.createElement('br'))
                        }
                        r.appendChild(n)
                      } else r.appendChild(e)
                      return (r.worldPos = new ae.Vector3()), r
                    })(r, 'label')
                r.worldPos.copy(t),
                  (r.style.textAlign = n.horizontalAlign),
                  (r.style.verticalAlign = n.verticalAlign),
                  (this.items[e] = r)
              }
            },
            {
              key: 'setColor',
              value: function (e, t, r) {
                this.items[e].opts = { color: t, background: r }
              }
            },
            {
              key: 'startUpdate',
              value: function () {
                return !0
              }
            },
            {
              key: 'finishUpdate',
              value: function () {
                ;(this.needsUpdate = !0), this.dispatchEvent({ type: 'update' })
              }
            },
            {
              key: 'finalize',
              value: function () {
                this.finishUpdate()
              }
            },
            { key: 'raycast', value: function () {} },
            { key: 'setOpacity', value: function () {} },
            {
              key: 'getSubset',
              value: function () {
                return []
              }
            }
          ]),
          s
        )
      })()
    },
    yi = {
      precision: 'mediump',
      init: function (e) {
        this.precision = e.capabilities.getMaxPrecision('highp')
      }
    },
    _i = new Uint8Array([
      24, 52, 0, 254, 145, 0, 122, 0, 0, 7, 170, 0, 34, 214, 0, 173, 8, 0, 86,
      249, 0, 160, 4, 0, 226, 46, 0, 224, 211, 0, 3, 157, 0, 174, 247, 0, 12,
      182, 0, 220, 216, 0, 1, 109, 0, 253, 154, 0
    ]),
    vi = ae.RepeatWrapping,
    gi = ae.RepeatWrapping,
    xi = ae.NearestFilter,
    bi = ae.NearestFilter,
    wi = ae.UVMapping,
    Si = new ae.DataTexture(
      _i,
      4,
      4,
      ae.RGBFormat,
      ae.UnsignedByteType,
      wi,
      vi,
      gi,
      bi,
      xi,
      1
    )
  Si.needsUpdate = !0
  var Ri = { noiseWidth: 4, noiseHeight: 4, noiseTexture: Si }
  function Ci(t, e) {
    var r,
      n = Object.keys(t)
    return (
      Object.getOwnPropertySymbols &&
        ((r = Object.getOwnPropertySymbols(t)),
        e &&
          (r = r.filter(function (e) {
            return Object.getOwnPropertyDescriptor(t, e).enumerable
          })),
        n.push.apply(n, r)),
      n
    )
  }
  function Ai(t) {
    for (var e = 1; e < arguments.length; e++) {
      var r = null != arguments[e] ? arguments[e] : {}
      e % 2
        ? Ci(Object(r), !0).forEach(function (e) {
            be(t, e, r[e])
          })
        : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(r))
        : Ci(Object(r)).forEach(function (e) {
            Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(r, e))
          })
    }
    return t
  }
  function Ei(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ki = [
      new ae.Vector2(-0.541978, 0.840393),
      new ae.Vector2(0.125533, -0.992089),
      new ae.Vector2(0.374329, 0.927296),
      new ae.Vector2(-0.105475, 0.994422)
    ],
    Ti = ae.UniformsUtils.merge([
      ae.UniformsLib.fog,
      ae.UniformsLib.lights,
      {
        diffuse: { value: new ae.Color(15658734) },
        opacity: { value: 1 },
        specular: { type: 'c', value: new ae.Color(1118481) },
        shininess: { type: 'f', value: 30 },
        fixedColor: { type: 'c', value: new ae.Color(16777215) },
        zOffset: { type: 'f', value: 0 },
        zClipValue: { type: 'f', value: 0 },
        clipPlaneValue: { type: 'f', value: 0 },
        nearPlaneValue: { type: 'f', value: -0.5 },
        invModelViewMatrix: { type: '4fv', value: new ae.Matrix4() },
        world2colorMatrix: { type: '4fv', value: new ae.Matrix4() },
        dashedLineSize: { type: 'f', value: 0.1 },
        dashedLinePeriod: { type: 'f', value: 0.2 },
        projMatrixInv: { type: '4fv', value: new ae.Matrix4() },
        viewport: { type: 'v2', value: new ae.Vector2() },
        lineWidth: { type: 'f', value: 2 },
        fogAlpha: { type: 'f', value: 1 },
        samplesKernel: { type: 'v2v', value: null },
        noiseTex: { type: 't', value: null },
        noiseTexelSize: { type: 'v2', value: null },
        srcTexelSize: { type: 'v2', value: null }
      }
    ]),
    Pi = [
      'shininess',
      'opacity',
      'zOffset',
      'diffuse',
      'specular',
      'fixedColor',
      'zClipCoef',
      'zClipValue',
      'clipPlaneValue',
      'world2colorMatrix',
      'dashedLineSize',
      'dashedLinePeriod',
      'projMatrixInv',
      'viewport',
      'lineWidth',
      'fogAlpha',
      'samplesKernel',
      'noiseTex',
      'noiseTexelSize',
      'srcTexelSize'
    ],
    Mi = {
      diffuse: new ae.Color(16777215),
      specular: new ae.Color(1118481),
      shininess: 30,
      opacity: 1,
      fixedColor: new ae.Color(16777215),
      zOffset: 0,
      zClipCoef: 2,
      zClipValue: 0,
      clipPlaneValue: 0,
      world2colorMatrix: new ae.Matrix4(),
      dashedLineSize: 0.1,
      dashedLinePeriod: 0.3,
      projMatrixInv: new ae.Matrix4(),
      viewport: new ae.Vector2(800, 600),
      lineWidth: 2,
      fogAlpha: 1,
      samplesKernel: ki,
      noiseTex: Ri.noiseTexture,
      noiseTexelSize: new ae.Vector2(1 / Ri.noiseWidth, 1 / Ri.noiseHeight),
      srcTexelSize: new ae.Vector2(1 / 800, 1 / 600),
      copy: function (e) {
        this.diffuse.copy(e.diffuse),
          this.specular.copy(e.specular),
          (this.shininess = e.shininess),
          (this.opacity = e.opacity),
          this.fixedColor.copy(e.fixedColor),
          (this.zOffset = e.zOffset),
          (this.zClipCoef = e.zClipCoef),
          (this.zClipValue = e.zClipValue),
          (this.clipPlaneValue = e.clipPlaneValue),
          this.world2colorMatrix.copy(e.world2colorMatrix),
          (this.dashedLineSize = e.dashedLineSize),
          (this.dashedLinePeriod = e.dashedLinePeriod),
          (this.projMatrixInv = e.projMatrixInv),
          (this.viewport = e.viewport),
          (this.lineWidth = e.lineWidth),
          (this.toonShading = e.toonShading),
          (this.fogAlpha = e.fogAlpha),
          (this.samplesKernel = e.samplesKernel),
          (this.noiseTex = e.noiseTex),
          (this.noiseTexelSize = e.noiseTexelSize),
          (this.srcTexelSize = e.srcTexelSize)
      }
    },
    Ni = (function () {
      x(n, ae.RawShaderMaterial)
      var r = Ei(n)
      function n(e) {
        var t
        return (
          G(this, n),
          ((t = r.call(this, e)).fog = !0),
          (t.instancedPos = !1),
          (t.instancedMatrix = !1),
          (t.attrColor = !1),
          (t.attrColor2 = !1),
          (t.attrAlphaColor = !1),
          (t.overrideColor = !1),
          (t.sphereSprite = !1),
          (t.cylinderSprite = !1),
          (t.zClip = !1),
          (t.clipPlane = !1),
          (t.fakeOpacity = !1),
          (t.prepassTransparancy = !1),
          (t.colorFromPos = !1),
          (t.shadowmap = !1),
          (t.shadowmapType = 'random'),
          (t.colorFromDepth = !1),
          (t.orthoCam = !1),
          (t.dashedLine = !1),
          (t.transparent = !0),
          (t.thickLine = !1),
          (t.fogTransparent = !1),
          (t.normalsToGBuffer = !1),
          (t.toonShading = !1),
          (t.uberOptions = Mi),
          t.setValues(
            Ai(
              {
                uniforms: ae.UniformsUtils.clone(Ti),
                vertexShader:
                  t.precisionString() +
                  'float INSTANCED_SPRITE_OVERSCALE = 1.3;\r\n\r\nattribute vec3 normal;\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  varying vec3 viewNormal;\r\n#endif\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  varying vec3 vNormal;\r\n#endif\r\n\r\n#ifdef THICK_LINE\r\n  attribute vec4 position; // W contains vert pos or neg offset\r\n#else\r\n  attribute vec3 position;\r\n#endif\r\n\r\nvarying vec3 vWorldPosition;\r\nvarying vec3 vViewPosition;\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  attribute float alphaColor;\r\n  varying float alphaCol;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  attribute vec3 color;\r\n  varying vec3 vColor;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  attribute vec3 color2;\r\n  varying vec3 vColor2;\r\n  attribute vec2 uv;\r\n  #ifndef CYLINDER_SPRITE\r\n    varying vec2 vUv;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_POS\r\n  attribute vec4 offset;\r\n  #ifdef SPHERE_SPRITE\r\n    varying vec4 instOffset;\r\n  varying vec4 spritePosEye;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  attribute vec4 matVector1;\r\n  attribute vec4 matVector2;\r\n  attribute vec4 matVector3;\r\n  attribute vec4 invmatVector1;\r\n  attribute vec4 invmatVector2;\r\n  attribute vec4 invmatVector3;\r\n\r\n  #ifdef CYLINDER_SPRITE\r\n    varying vec4 matVec1;\r\n    varying vec4 matVec2;\r\n    varying vec4 matVec3;\r\n    varying vec4 invmatVec1;\r\n    varying vec4 invmatVec2;\r\n    varying vec4 invmatVec3;\r\n    varying vec4 spritePosEye;\r\n  #endif\r\n#endif\r\n\r\nuniform mat4 modelViewMatrix; // optional\r\nuniform mat4 projectionMatrix; // optional\r\nuniform mat3 normalMatrix; // optional\r\nuniform mat4 modelMatrix; // optional\r\n\r\n#ifdef DASHED_LINE\r\n  attribute float lineDistance;\r\n  varying float vLineDistance;\r\n#endif\r\n\r\n#ifdef THICK_LINE\r\n  attribute vec3 direction;\r\n  uniform mat4 projMatrixInv;\r\n  uniform vec2 viewport;\r\n  uniform float lineWidth;\r\n\r\n  vec4 transform(vec4 coord){\r\n    return projectionMatrix * modelViewMatrix * coord;\r\n  }\r\n\r\n  vec2 project(vec4 device){\r\n    vec3 device_normal = device.xyz/device.w;\r\n    vec2 clip_pos = (device_normal*0.5+0.5).xy;\r\n    return clip_pos * viewport;\r\n  }\r\n\r\n  vec4 unproject(vec2 screen, float z, float w){\r\n    vec2 clip_pos = screen/viewport;\r\n    vec2 device_normal = clip_pos*2.0-1.0;\r\n    return vec4(device_normal*w, z, w);\r\n  }\r\n#endif\r\n\r\n\r\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\r\nvoid main() {\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  alphaCol = alphaColor;\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  vec3 objectNormal = vec3(\r\n    dot(normal, matVector1.xyz),\r\n    dot(normal, matVector2.xyz),\r\n    dot(normal, matVector3.xyz));\r\n#else\r\n  vec3 objectNormal = vec3( normal );\r\n#endif\r\n\r\nvec3 transformedNormal = normalMatrix * objectNormal;\r\n\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  vNormal = normalize(transformedNormal);\r\n#endif\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  viewNormal = normalize(mat3(modelViewMatrix)*objectNormal);\r\n#endif\r\n\r\n  vec4 localPos = vec4(position.xyz, 1.0);\r\n  vec4 worldPos = modelMatrix * localPos;\r\n  vec4 mvPosition = modelViewMatrix * localPos;\r\n\r\n// make thick line offset\r\n#ifdef THICK_LINE\r\n   // get screen pos\r\n   vec4 dPos = transform(vec4(position.xyz, 1.0));\r\n   vec2 sPos = project(dPos);\r\n   // move pos forward\r\n   vec3 position2 = position.xyz + direction.xyz * 0.5;\r\n   // get screen offset pos\r\n   vec4 dPos2 = transform(vec4(position2.xyz, 1.0));\r\n   vec2 sPos2 = project(dPos2);\r\n   // screen line direction\r\n   vec2 sDir = normalize(sPos2 - sPos);\r\n   // vertex offset (orthogonal to line direction)\r\n   vec2 offset1 = vec2(-sDir.y, sDir.x);\r\n   // move screen vertex\r\n   vec2 newPos = sPos + offset1 * position.w * lineWidth;\r\n   // get moved pos in view space\r\n   vec4 dNewPos =  unproject(newPos, dPos.z, dPos.w);\r\n   mvPosition.xyz = (projMatrixInv * dNewPos).xyz;\r\n#endif // THICK_LINE\r\n\r\n#ifdef INSTANCED_POS\r\n  #ifdef SPHERE_SPRITE\r\n    instOffset = offset;\r\n\r\n    vec4 posEye = modelViewMatrix * vec4( offset.xyz, 1.0 );\r\n    float scale = length(modelViewMatrix[0]);\r\n    mvPosition = posEye + vec4( position.xyz * offset.w * scale * INSTANCED_SPRITE_OVERSCALE, 0.0 );\r\n    posEye.w = offset.w * scale;\r\n\r\n    spritePosEye = posEye;\r\n #else\r\n    localPos = vec4( offset.xyz + position.xyz * offset.w, 1.0 );\r\n    worldPos = modelMatrix * localPos;\r\n    mvPosition = modelViewMatrix * localPos;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  #ifdef CYLINDER_SPRITE\r\n    matVec1 = matVector1;\r\n    matVec2 = matVector2;\r\n    matVec3 = matVector3;\r\n    invmatVec1 = invmatVector1;\r\n    invmatVec2 = invmatVector2;\r\n    invmatVec3 = invmatVector3;\r\n\r\n    // calculate eye coords of cylinder endpoints\r\n    vec4 v = vec4(0, -0.5, 0, 1);\r\n    vec4 p1 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r\n    v.y = 0.5;\r\n    vec4 p2 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r\n\r\n    // sprite is placed at the center of cylinder\r\n    vec4 posEye;\r\n    posEye.xyz = mix(p1.xyz, p2.xyz, 0.5);\r\n    posEye.w = 1.0;\r\n    spritePosEye = posEye;\r\n\r\n    // cylinder radius in eye space\r\n    float rad = length(modelViewMatrix[0]) * length(vec3(matVector1.x, matVector2.x, matVector3.x));\r\n    vec2 spriteSize;\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // In ortho projection we skip z coordinate\r\n      // basic sprite size at screen plane (covers only cylinder axis)\r\n      vec2 spriteSizeScreen = abs(p2.xy - p1.xy);\r\n\r\n      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * (spriteSizeScreen + 2.0 * rad);\r\n    #else\r\n      // basic sprite size at screen plane (covers only cylinder axis)\r\n      vec2 spriteSizeScreen = abs(p2.xy / p2.z - p1.xy / p1.z);\r\n\r\n      // full sprite size in eye coords\r\n      float minZ = min(abs(p1.z), abs(p2.z));\r\n      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * abs(posEye.z) * (spriteSizeScreen + 2.0 * rad / minZ);\r\n    #endif\r\n\r\n    mvPosition = posEye + vec4( position.xy * 0.5 * spriteSize, 0, 0 );\r\n  #else\r\n    localPos = vec4(dot(localPos, matVector1), dot(localPos, matVector2), dot(localPos, matVector3), 1.0);\r\n    worldPos = modelMatrix * localPos;\r\n    mvPosition = modelViewMatrix * localPos;\r\n  #endif\r\n#endif\r\n\r\n  gl_Position = projectionMatrix * mvPosition;\r\n\r\n  vWorldPosition = worldPos.xyz;\r\n  vViewPosition = - mvPosition.xyz;\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t  vec4 worldPosition;\r\n\t  // see THREE.WebGLProgram.unrollLoops\r\n\t  #pragma unroll_loop_start\r\n\t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n      vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * vec4(vWorldPosition, 1.0);\r\n      vDirectionalShadowNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(objectNormal, 0.0))).xyz;\r\n\t  }\r\n\t  #pragma unroll_loop_end\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  vColor = color.xyz;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  vColor2 = color2;\r\n  #ifndef CYLINDER_SPRITE\r\n    vUv = uv;\r\n  #endif\r\n#endif\r\n\r\n#ifdef DASHED_LINE\r\n  vLineDistance = lineDistance;\r\n#endif\r\n}\r\n',
                fragmentShader:
                  t.precisionString() +
                  "#if defined (NORMALS_TO_G_BUFFER)\r\n  #define fragColor gl_FragData[0]\r\n#else\r\n  #define fragColor gl_FragColor\r\n#endif\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  varying float alphaCol;\r\n#endif\r\n\r\n#ifdef COLOR_FROM_POS\r\n  uniform mat4 world2colorMatrix;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\r\n    uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ]; //only for sprites\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r\n    vec4 vDirLightWorldCoord[ NUM_DIR_LIGHTS ];\r\n    vec3 vDirLightWorldNormal[ NUM_DIR_LIGHTS ];\r\n\r\n    #ifdef SHADOWMAP_PCF_RAND\r\n      // We use 4 instead uniform variable or define because this value is used in for(... i < value; ...) with\r\n      // unroll_loop and unroll_loop has pattern:\r\n      // /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g\r\n      uniform vec2 samplesKernel[4]; // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n      uniform sampler2D noiseTex;\r\n      uniform vec2 noiseTexelSize;\r\n      uniform vec2 srcTexelSize;\r\n      uniform mat4 projectionMatrix;\r\n    #endif\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  varying vec3 vColor;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  varying vec3 vColor2;\r\n  #ifndef CYLINDER_SPRITE\r\n    varying vec2 vUv;\r\n  #endif\r\n#endif\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform vec3 fixedColor;\r\nuniform float opacity;\r\nuniform float zClipValue;\r\nuniform float clipPlaneValue;\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  varying vec3 viewNormal;\r\n#endif\r\n\r\n#define PI 3.14159265359\r\n#define RECIPROCAL_PI 0.31830988618\r\n#define saturate(a) clamp( a, 0.0, 1.0 )\r\n\r\n#ifdef USE_FOG\r\n  uniform vec3 fogColor;\r\n  uniform float fogAlpha;\r\n  uniform float fogNear;\r\n  uniform float fogFar;\r\n#endif\r\n\r\nvarying vec3 vWorldPosition; // world position of the pixel (invalid when INSTANCED_SPRITE is defined)\r\nvarying vec3 vViewPosition;\r\n\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  varying vec3 vNormal;\r\n#endif\r\n\r\n/////////////////////////////////////////// ZSprites ////////////////////////////////////////////////\r\n#if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r\n  uniform float nearPlaneValue;\r\n#endif\r\n\r\n#ifdef SPHERE_SPRITE\r\n  varying vec4 spritePosEye;\r\n#endif\r\n\r\n#if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n  uniform float zOffset;\r\n\r\n  #if !defined(USE_LIGHTS) || !defined(SHADOWMAP) || !defined(SHADOWMAP_PCF_RAND) || !(NUM_DIR_LIGHTS > 0)\r\n    uniform mat4 projectionMatrix;\r\n  #endif\r\n\r\n  float calcDepthForSprites(vec4 pixelPosEye, float zOffset, mat4 projMatrix) {\r\n    vec4 pixelPosScreen = projMatrix * pixelPosEye;\r\n    return 0.5 * (pixelPosScreen.z / pixelPosScreen.w + 1.0) + zOffset;\r\n  }\r\n#endif\r\n\r\n#ifdef SPHERE_SPRITE\r\n  varying vec4 instOffset;\r\n  uniform mat4 modelMatrix;\r\n  uniform mat4 modelViewMatrix;\r\n  uniform mat4 invModelViewMatrix;\r\n  uniform mat3 normalMatrix;\r\n\r\n\r\n  bool intersect_ray_sphere(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r\n\r\n    // intersect XZ-projected ray with circle\r\n    float a = dot(ray, ray);\r\n    float b = dot(ray, origin);\r\n    float c = dot(origin, origin) - 1.0;\r\n    float det = b * b - a * c;\r\n    if (det < 0.0) return false;\r\n    float t1 = (-b - sqrt(det)) / a;\r\n    float t2 = (-b + sqrt(det)) / a;\r\n\r\n    // calculate both intersection points\r\n    vec3 p1 = origin + ray * t1;\r\n    vec3 p2 = origin + ray * t2;\r\n\r\n    // choose nearest point inside frustum\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // orthografic camera is used for dirLight sources. So in it for all spheres the point with smaller 't' is visible\r\n      // t1 is always smaller than t2 (from calculations)\r\n      point = p1;\r\n      frontFaced = 1.0;\r\n      return true;\r\n    #else\r\n      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r\n      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r\n      if (t1 >= 0.0) {\r\n        point = p1;\r\n        frontFaced = 1.0;\r\n        return true;\r\n      }\r\n      if (t2 >= 0.0) {\r\n        point = p2;\r\n        frontFaced = -1.0;\r\n        return true;\r\n      }\r\n    #endif\r\n\r\n    return false;\r\n  }\r\n\r\n  bool get_sphere_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r\n    vec3 origin, ray;\r\n\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // transform vector from sprite center to curPixel into sphere local coords\r\n      origin = pixelPosEye.xyz - spritePosEye.xyz;\r\n      origin = (invModelViewMatrix * vec4(origin, 0.0)).xyz / instOffset.w;\r\n\r\n      // transform camera orientation vector into sphere local coords\r\n      ray = (invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\r\n    #else\r\n      // find point of intersection near plane by the ray from camera to curPixel\r\n      vec4 v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r\n\r\n      // transform intersection point into sphere local coords\r\n      v = invModelViewMatrix * v;\r\n      origin = (v.xyz - instOffset.xyz) / instOffset.w;\r\n\r\n      // transform vector from camera pos to curPixel into sphere local coords\r\n      ray = (invModelViewMatrix * vec4(pixelPosEye, 0.0)).xyz;\r\n    #endif\r\n    ray = normalize(ray);\r\n\r\n    return intersect_ray_sphere(origin, ray, point, frontFaced);\r\n  }\r\n#endif\r\n\r\n#ifdef CYLINDER_SPRITE\r\n  varying vec4 matVec1;\r\n  varying vec4 matVec2;\r\n  varying vec4 matVec3;\r\n  varying vec4 invmatVec1;\r\n  varying vec4 invmatVec2;\r\n  varying vec4 invmatVec3;\r\n\r\n  uniform mat4 modelMatrix;\r\n  uniform mat4 modelViewMatrix;\r\n  uniform mat4 invModelViewMatrix;\r\n  uniform mat3 normalMatrix;\r\n\r\n  varying vec4 spritePosEye;\r\n\r\n  bool intersect_ray_cylinder(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r\n\r\n    // intersect XZ-projected ray with circle\r\n    float a = dot(ray.xz, ray.xz);\r\n    float b = dot(ray.xz, origin.xz);\r\n    float c = dot(origin.xz, origin.xz) - 1.0;\r\n    float det = b * b - a * c;\r\n    if (det < 0.0) return false;\r\n    float t1 = (-b - sqrt(det)) / a;\r\n    float t2 = (-b + sqrt(det)) / a;\r\n\r\n    // calculate both intersection points\r\n    vec3 p1 = origin + ray * t1;\r\n    vec3 p2 = origin + ray * t2;\r\n\r\n    float halfHeight = 0.5;\r\n\r\n    // choose nearest point\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // orthografic camera is used for dirLight sources. So in it for all cylinders the point with smaller 't' is visible\r\n      // if it is not outside of cylinnder (t1 is always smaller than t2).\r\n      if (p1.y >= -halfHeight && p1.y <= halfHeight) {\r\n        point = p1;\r\n        frontFaced = 1.0;\r\n        return true;\r\n      }\r\n      if (p2.y >= -halfHeight && p2.y <= halfHeight) {\r\n        point = p2;\r\n        frontFaced = -1.0;\r\n        return true;\r\n      }\r\n    #else\r\n      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r\n      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r\n      if (t1 >= 0.0 && p1.y >= -halfHeight && p1.y <= halfHeight) {\r\n        point = p1;\r\n        frontFaced = 1.0;\r\n        return true;\r\n      }\r\n      if (t2 >= 0.0 && p2.y >= -halfHeight && p2.y <= halfHeight) {\r\n        point = p2;\r\n        frontFaced = -1.0;\r\n        return true;\r\n      }\r\n    #endif\r\n\r\n    return false;\r\n  }\r\n\r\n  bool get_cylinder_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r\n    vec3 origin, ray;\r\n    vec4 v;\r\n\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // transform vector from sprite center to curPixel into cylinder local coords\r\n      v = invModelViewMatrix * vec4(pixelPosEye.xyz - spritePosEye.xyz, 0.0);\r\n      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n\r\n      // transform camera orientation vector into cylinder local coords\r\n      v = invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0);\r\n      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n    #else\r\n      // find point of intersection near plane by the ray from camera to curPixel\r\n      v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r\n\r\n      // transform intersection point into cylinder local coords\r\n      v = invModelViewMatrix * v;\r\n      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n\r\n      // transform vector from camera pos to curPixel into cylinder local coords\r\n      v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\r\n      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n    #endif\r\n    ray = normalize(ray);\r\n\r\n    return intersect_ray_cylinder(origin, ray, point, frontFaced);\r\n  }\r\n#endif\r\n\r\n///////////////////////////////////// Pack and unpack ///////////////////////////////////////////////\r\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r\n\r\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r\n\r\n\r\nconst float ShiftRight8 = 1. / 256.;\r\n\r\nvec4 packDepthToRGBA( const in float v ) {\r\n  vec4 r = vec4( fract( v * PackFactors ), v );\r\n  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\r\n  return r * PackUpscale;\r\n}\r\n\r\nfloat unpackRGBAToDepth( const in vec4 v ) {\r\n  return dot( v, UnpackFactors );\r\n}\r\n\r\n////////////////////////////////////////// All Lighting /////////////////////////////////////////////////\r\n#ifdef TOON_SHADING\r\n  #define LOW_TOON_BORDER 0.0\r\n  #define MEDIUM_TOON_BORDER 0.7\r\n  #define HIGH_TOON_BORDER 1.0\r\n\r\n  #define MEDIUM_TOON_RANGE 0.5\r\n  #define HIGH_TOON_RANGE 0.95\r\n#endif\r\n#if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r\n  struct ReflectedLight {\r\n    vec3 directDiffuse;\r\n    vec3 directSpecular;\r\n    vec3 indirectDiffuse;\r\n  };\r\n\r\n  struct BlinnPhongMaterial {\r\n    vec3  diffuseColor;\r\n    vec3  specularColor;\r\n    float specularShininess;\r\n  };\r\n\r\n  struct GeometricContext {\r\n    vec3 normal;\r\n    vec3 viewDir;\r\n  };\r\n\r\n  struct DirectionalLight {\r\n    vec3 direction;\r\n    vec3 color;\r\n  };\r\n  uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r\n\r\n  struct DirectionalLightShadow {\r\n     vec2 shadowMapSize;\r\n     float shadowBias;\r\n     float shadowRadius;\r\n   };\r\n  uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHTS ];\r\n\r\n  uniform vec3 ambientLightColor;\r\n\r\n  /////////////////////////////////////////// Shadowmap ////////////////////////////////////////////////\r\n\r\n  #if defined(SHADOWMAP)\r\n  \tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r\n  \t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r\n  \t}\r\n\r\n    float getShadow( sampler2D shadowMap, DirectionalLightShadow dirLight, vec4 shadowCoord, vec3 vViewPosition, vec3 vNormal ) {\r\n   \t  float shadow = 0.0;\r\n\r\n      // When shadows for sprites will appear use here for them normals as it done for G-buffer\r\n      shadowCoord.xyz += dirLight.shadowBias * vNormal;\r\n      shadowCoord.xyz /= shadowCoord.w;\r\n\r\n      bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n      bool inFrustum = all( inFrustumVec );\r\n      bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n      bool frustumTest = all( frustumTestVec );\r\n\r\n      if ( frustumTest ) {\r\n        #ifdef SHADOWMAP_BASIC\r\n      \t  shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n      \t#endif\r\n\r\n      \t#ifdef SHADOWMAP_PCF_SHARP\r\n      \t  vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r\n\r\n            float dx0 = - texelSize.x * dirLight.shadowRadius;\r\n            float dy0 = - texelSize.y * dirLight.shadowRadius;\r\n            float dx1 = + texelSize.x * dirLight.shadowRadius;\r\n            float dy1 = + texelSize.y * dirLight.shadowRadius;\r\n\r\n            shadow = (\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n            ) * ( 1.0 / 9.0 );\r\n        #endif\r\n\r\n        #ifdef SHADOWMAP_PCF_RAND\r\n          vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r\n\r\n          vec4 vUv = ((projectionMatrix * vec4(vViewPosition, 1.0)) + 1.0) / 2.0;\r\n          vec2 vUvNoise = vUv.xy / srcTexelSize * noiseTexelSize;\r\n\r\n          vec2 noiseVec = normalize(texture2D(noiseTex, vUvNoise).rg);\r\n          mat2 mNoise = mat2(noiseVec.x, noiseVec.y, -noiseVec.y, noiseVec.x);\r\n\r\n          vec2 offset;\r\n          #pragma unroll_loop_start\r\n          for ( int i = 0; i < 4; i ++ ) { // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n            offset = mNoise * ( normalize( samplesKernel[ i ]) * texelSize * dirLight.shadowRadius );\r\n            shadow +=  texture2DCompare( shadowMap, shadowCoord.xy + offset, shadowCoord.z );\r\n          }\r\n          #pragma unroll_loop_end\r\n          shadow /= float( 4 ); // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n        #endif\r\n      }\r\n      return shadow;//(shadow != 1.0) ? 0.5 : 1.0;//vec4(shadow, shadow, shadow, 1.0);\r\n   }\r\n  #endif\r\n\r\n  /////////////////////////////////////////// Lighting /////////////////////////////////////////////////\r\n\r\n  vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r\n    return RECIPROCAL_PI * diffuseColor;\r\n  } // validated\r\n\r\n  vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\r\n    // Original approximation by Christophe Schlick '94\r\n    //;float fresnel = pow( 1.0 - dotLH, 5.0 );\r\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\r\n    float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\r\n    return ( 1.0 - specularColor ) * fresnel + specularColor;\r\n  } // validated\r\n\r\n  float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\r\n    // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r\n    return 0.25;\r\n  }\r\n\r\n  float D_BlinnPhong( const in float shininess, const in float dotNH ) {\r\n    return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r\n  }\r\n\r\n  vec3 BRDF_Specular_BlinnPhong( const in DirectionalLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r\n    vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r\n    float dotNH = saturate(dot( geometry.normal, halfDir ));\r\n    float dotLH = saturate(dot( incidentLight.direction, halfDir ));\r\n\r\n    vec3 F = F_Schlick( specularColor, dotLH );\r\n    float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\r\n    float D = D_BlinnPhong( shininess, dotNH );\r\n\r\n    return F * ( G * D );\r\n  } // validated\r\n\r\n  void RE_Direct_BlinnPhong( const in DirectionalLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight, float penumbra ) {\r\n\r\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ));\r\n    #ifdef TOON_SHADING\r\n      if(dotNL < MEDIUM_TOON_RANGE){\r\n        dotNL = LOW_TOON_BORDER;\r\n      }\r\n      else if(dotNL < HIGH_TOON_RANGE){\r\n        dotNL = MEDIUM_TOON_BORDER;\r\n      }\r\n      else{\r\n        dotNL = HIGH_TOON_BORDER;\r\n      }\r\n    #endif\r\n\r\n    vec3 irradiance = dotNL * directLight.color * PI;\r\n    reflectedLight.directDiffuse += penumbra * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n    reflectedLight.directSpecular += penumbra * irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess );\r\n  }\r\n\r\n  void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n  }\r\n\r\n  vec3 calcLighting(const in GeometricContext geometry, const in BlinnPhongMaterial material, vec3 vViewPosition) {\r\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\r\n    vec3 irradiance = ambientLightColor * PI;\r\n\r\n    float shadowMask = 1.0;\r\n    // see THREE.WebGLProgram.unrollLoops\r\n  \t#pragma unroll_loop_start\r\n  \t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n  \t    #ifdef SHADOWMAP\r\n  \t      shadowMask = getShadow( directionalShadowMap[ i ], directionalLightShadows[ i ], vDirLightWorldCoord[ i ], vViewPosition, vDirLightWorldNormal[ i ] );\r\n        #endif\r\n\r\n  \t\t  if ( shadowMask > 0.0 ) RE_Direct_BlinnPhong( directionalLights[ i ], geometry, material, reflectedLight, shadowMask );\r\n  \t\t}\r\n  \t\t#pragma unroll_loop_end\r\n\r\n    RE_IndirectDiffuse_BlinnPhong(irradiance, material, reflectedLight);\r\n\r\n    return saturate(reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular);\r\n  }\r\n#endif\r\n\r\n/////////////////////////////////////////// Dashed Line ///////////////////////////////////////////////\r\n#ifdef DASHED_LINE\r\n  uniform float dashedLineSize;\r\n  uniform float dashedLinePeriod;\r\n  varying float vLineDistance;\r\n#endif\r\n\r\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\r\nvoid main() {\r\n\r\n#ifdef CLIP_PLANE\r\n  if (vViewPosition.z < clipPlaneValue) discard;\r\n#endif\r\n\r\n#ifdef ZCLIP\r\n  if (vViewPosition.z < zClipValue) discard;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n  #if NUM_DIR_LIGHTS > 0\r\n    // see THREE.WebGLProgram.unrollLoops\r\n    #pragma unroll_loop_start\r\n    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n      vDirLightWorldCoord[ i ] = vDirectionalShadowCoord[ i ];\r\n      vDirLightWorldNormal[ i ] = vDirectionalShadowNormal[ i ];\r\n    }\r\n    #pragma unroll_loop_end\r\n  #endif\r\n#endif\r\n\r\n  vec4 pixelPosWorld = vec4(vWorldPosition, 1.0);\r\n  vec4 pixelPosEye;\r\n\r\n#ifdef SPHERE_SPRITE\r\n\r\n  vec3 viewNormalSprites;\r\n  float frontFaced = 1.0;\r\n  vec3 normal;\r\n\r\n/* quick-and-dirty method\r\n  normal.xy = ' + INSTANCED_SPRITE_OVERSCALE + ' * (2.0 * vUv - 1.0);\r\n  float r2 = dot(normal.xy, normal.xy);\r\n  if (r2 > 1.0) discard;\r\n  float normalZ = sqrt(1.0 - r2);\r\n  normal.z = normalZ;\r\n  normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\r\n  pixelPosEye = vec4(spritePosEye.xyz, 1.0);\r\n  pixelPosEye.z += spritePosEye.w * normalZ;\r\n*/\r\n\r\n  // ray-trace sphere surface\r\n  {\r\n    vec3 p;\r\n    if (!get_sphere_point(-vViewPosition, p, frontFaced)) discard;\r\n    vec4 v = vec4(instOffset.xyz + p * instOffset.w, 1.0);\r\n    pixelPosWorld = modelMatrix * v;\r\n    pixelPosEye = modelViewMatrix * v;\r\n    normal = normalize(normalMatrix * p);\r\n    #ifdef NORMALS_TO_G_BUFFER\r\n      viewNormalSprites = normalize(mat3(modelViewMatrix)*p);\r\n    #endif\r\n\r\n    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n      #if NUM_DIR_LIGHTS > 0\r\n        // see THREE.WebGLProgram.unrollLoops\r\n        #pragma unroll_loop_start\r\n          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r\n            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(p, 0.0))).xyz;\r\n          }\r\n        #pragma unroll_loop_end\r\n      #endif\r\n    #endif\r\n  }\r\n#endif\r\n\r\n#ifdef CYLINDER_SPRITE\r\n  vec3 normal;\r\n  vec3 viewNormalSprites;\r\n  float frontFaced = 1.0;\r\n  float cylinderY = 0.0;\r\n\r\n  // ray-trace cylinder surface\r\n  {\r\n    vec3 p;\r\n    if (!get_cylinder_point(-vViewPosition, p, frontFaced)) discard;\r\n\r\n    cylinderY = 0.5 * (p.y + 1.0);\r\n\r\n    vec4 v = vec4(p, 1.0);\r\n    v = vec4(dot(v, matVec1), dot(v, matVec2), dot(v, matVec3), 1.0);\r\n    pixelPosWorld = modelMatrix * v;\r\n    pixelPosEye = modelViewMatrix * v;\r\n\r\n    vec3 localNormal = normalize(vec3(p.x, 0.0, p.z));\r\n    normal = vec3(\r\n      dot(localNormal, matVec1.xyz),\r\n      dot(localNormal, matVec2.xyz),\r\n      dot(localNormal, matVec3.xyz));\r\n    #ifdef NORMALS_TO_G_BUFFER\r\n      viewNormalSprites = normalize(mat3(modelViewMatrix)*normal);\r\n    #endif\r\n\r\n    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n      #if NUM_DIR_LIGHTS > 0\r\n        // see THREE.WebGLProgram.unrollLoops\r\n        #pragma unroll_loop_start\r\n          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r\n            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(normal, 0.0))).xyz;\r\n          }\r\n        #pragma unroll_loop_end\r\n      #endif\r\n    #endif\r\n\r\n    normal = normalize(normalMatrix * normal);\r\n  }\r\n#endif\r\n\r\n  #ifdef ATTR_COLOR\r\n    vec3 vertexColor = vColor;\r\n  #else\r\n    vec3 vertexColor = vec3(1.0, 1.0, 1.0);\r\n  #endif\r\n\r\n  #ifdef ATTR_COLOR2\r\n    #ifdef CYLINDER_SPRITE\r\n      float colorCoef = cylinderY; // cylinder parameter is calculated from ray-tracing\r\n    #else\r\n      float colorCoef = vUv.y; // cylinder parameter is interpolated as tex coord\r\n    #endif\r\n      // choose either color or color2\r\n    vertexColor = mix(vColor2, vColor, step(0.5, colorCoef));\r\n  #endif\r\n\r\n  // negative red component is a special condition\r\n  if (vertexColor.x < 0.0) discard;\r\n\r\n  #ifdef DASHED_LINE\r\n    if ( mod( vLineDistance, dashedLinePeriod ) > dashedLineSize ) discard;\r\n  #endif\r\n\r\n  // transparency prepass writes only z, so we don't need to calc the color\r\n  #ifdef PREPASS_TRANSP\r\n    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n    #endif\r\n    return;\r\n  #endif\r\n\r\n    float totalOpacity = opacity;\r\n\r\n  #ifdef ATTR_ALPHA_COLOR\r\n    totalOpacity *= alphaCol;\r\n  #endif\r\n\r\n  // discard fully transparent pixels\r\n  if (totalOpacity == 0.0) discard;\r\n\r\n  #ifdef FAKE_OPACITY\r\n    // discard pixels in checker pattern\r\n    vec2 dm_coord = floor(gl_FragCoord.xy);\r\n    dm_coord = fract(dm_coord * 0.5);\r\n    if (totalOpacity < 1.0 && (dm_coord.x < 0.5 ^^ dm_coord.y < 0.5)) discard;\r\n    vec4 diffuseColor = vec4(diffuse, 1.0);\r\n  #else\r\n    vec4 diffuseColor = vec4(diffuse, totalOpacity);\r\n  #endif\r\n\r\n  float flipNormal;\r\n  #if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n    flipNormal = 1.0;\r\n    #ifdef DOUBLE_SIDED\r\n      flipNormal = float( gl_FrontFacing );\r\n    #endif\r\n    vec3 normal = normalize( vNormal ) * flipNormal;\r\n  #endif\r\n\r\n    diffuseColor.rgb *= vertexColor;\r\n\r\n  #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n    gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n  #endif\r\n\r\n  #ifdef NORMALS_TO_G_BUFFER\r\n    #if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r\n      vec3 viewNormaInColor = viewNormalSprites;\r\n    #else\r\n      vec3 viewNormaInColor = viewNormal;\r\n      float frontFaced = float( gl_FrontFacing );\r\n    #endif\r\n    // [-1, 1] -> [0, 1]\r\n    viewNormaInColor = 0.5 * viewNormaInColor + 0.5;\r\n    gl_FragData[1] = vec4(viewNormaInColor, frontFaced);\r\n  #endif\r\n\r\n  #if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r\n    vec3 viewDir;\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      viewDir = -pixelPosEye.xyz;\r\n    #else\r\n      viewDir = vViewPosition;\r\n    #endif\r\n    GeometricContext geometry = GeometricContext(normal, normalize( viewDir ));\r\n    BlinnPhongMaterial material = BlinnPhongMaterial(diffuseColor.rgb, specular, shininess);\r\n    vec3 outgoingLight = calcLighting(geometry, material, viewDir);\r\n  #else\r\n    vec3 outgoingLight = diffuseColor.rgb;\r\n  #endif\r\n\r\n  #ifdef COLOR_FROM_DEPTH\r\n    float depth = 0.0;\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n      depth = gl_FragDepthEXT;\r\n    #else\r\n      depth = gl_FragCoord.z;\r\n    #endif\r\n    fragColor = packDepthToRGBA(depth);\r\n    return;\r\n  #endif\r\n\r\n  #ifdef COLOR_FROM_POS\r\n    fragColor = world2colorMatrix * pixelPosWorld;\r\n  #else\r\n    #ifdef OVERRIDE_COLOR\r\n      fragColor = vec4(fixedColor, diffuseColor.a);\r\n    #else\r\n      fragColor = vec4(outgoingLight, diffuseColor.a);//vec4(vNormal, 1.0);\r\n    #endif\r\n\r\n    #ifdef USE_FOG\r\n      float viewDistance;\r\n      #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n        viewDistance = abs(pixelPosEye.z);\r\n      #else\r\n        viewDistance = vViewPosition.z;\r\n      #endif\r\n      float fogFactor = smoothstep( fogNear, fogFar, viewDistance) * fogAlpha;\r\n      #ifdef FOG_TRANSPARENT\r\n        fragColor.a = fragColor.a * (1.0 - fogFactor);\r\n      #else\r\n        fragColor.rgb = mix( fragColor.rgb, fogColor, fogFactor );\r\n      #endif\r\n    #endif\r\n\r\n  #endif\r\n}\r\n",
                lights: !0,
                fog: !0,
                side: ae.DoubleSide
              },
              e
            )
          ),
          t
        )
      }
      return (
        p(n, [
          {
            key: 'precisionString',
            value: function () {
              var e = yi.precision
              return (
                'precision '.concat(e, ' float;\n') +
                'precision '.concat(e, ' int;\n\n')
              )
            }
          },
          {
            key: 'copy',
            value: function (e) {
              return (
                Xe(C(n.prototype), 'copy', this).call(this, e),
                (this.fragmentShader = e.fragmentShader),
                (this.vertexShader = e.vertexShader),
                (this.uniforms = ae.UniformsUtils.clone(e.uniforms)),
                (this.defines = Ai({}, e.defines)),
                (this.extensions = e.extensions),
                (this.fog = e.fog),
                (this.instancedPos = e.instancedPos),
                (this.instancedMatrix = e.instancedMatrix),
                (this.attrColor = e.attrColor),
                (this.attrColor2 = e.attrColor2),
                (this.attrAlphaColor = e.attrAlphaColor),
                (this.overrideColor = e.overrideColor),
                (this.sphereSprite = e.sphereSprite),
                (this.cylinderSprite = e.cylinderSprite),
                (this.zClip = e.zClip),
                (this.clipPlane = e.clipPlane),
                (this.fakeOpacity = e.fakeOpacity),
                (this.colorFromPos = e.colorFromPos),
                (this.shadowmap = e.shadowmap),
                (this.shadowmapType = e.shadowmapType),
                (this.colorFromDepth = e.colorFromDepth),
                (this.orthoCam = e.orthoCam),
                (this.prepassTransparancy = e.prepassTransparancy),
                (this.dashedLine = e.dashedLine),
                (this.thickLine = e.thickLine),
                (this.fogTransparent = e.fogTransparent),
                (this.normalsToGBuffer = e.normalsToGBuffer),
                (this.toonShading = e.toonShading),
                this.uberOptions.copy(e.uberOptions),
                this
              )
            }
          },
          {
            key: 'createInstance',
            value: function () {
              var e = new n()
              return (
                e.copy(this),
                (e.uberOptions = Object.create(this.uberOptions)),
                e
              )
            }
          },
          {
            key: 'setValues',
            value: function (e) {
              var t
              void 0 !== e &&
                (Xe(C(n.prototype), 'setValues', this).call(this, e),
                (t = {}),
                (e = {}),
                this.fog && (t.USE_FOG = 1),
                this.instancedPos && (t.INSTANCED_POS = 1),
                this.instancedMatrix && (t.INSTANCED_MATRIX = 1),
                this.attrColor && (t.ATTR_COLOR = 1),
                this.attrColor2 && (t.ATTR_COLOR2 = 1),
                this.attrAlphaColor && (t.ATTR_ALPHA_COLOR = 1),
                this.overrideColor && (t.OVERRIDE_COLOR = 1),
                this.sphereSprite && ((t.SPHERE_SPRITE = 1), (e.fragDepth = 1)),
                this.cylinderSprite &&
                  ((t.CYLINDER_SPRITE = 1), (e.fragDepth = 1)),
                this.zClip && (t.ZCLIP = 1),
                this.clipPlane && (t.CLIP_PLANE = 1),
                this.fakeOpacity && (t.FAKE_OPACITY = 1),
                this.lights && (t.USE_LIGHTS = 1),
                this.colorFromPos && (t.COLOR_FROM_POS = 1),
                this.shadowmap &&
                  ((t.SHADOWMAP = 1),
                  'pcf' === this.shadowmapType
                    ? (t.SHADOWMAP_PCF_SHARP = 1)
                    : 'random' === this.shadowmapType
                    ? (t.SHADOWMAP_PCF_RAND = 1)
                    : (t.SHADOWMAP_BASIC = 1)),
                this.colorFromDepth && (t.COLOR_FROM_DEPTH = 1),
                this.orthoCam && (t.ORTHOGRAPHIC_CAMERA = 1),
                this.prepassTransparancy && (t.PREPASS_TRANSP = 1),
                this.dashedLine && (t.DASHED_LINE = 1),
                this.thickLine && (t.THICK_LINE = 1),
                this.fogTransparent && (t.FOG_TRANSPARENT = 1),
                this.normalsToGBuffer &&
                  ((e.drawBuffers = 1), (t.NORMALS_TO_G_BUFFER = 1)),
                this.toonShading && (t.TOON_SHADING = 1),
                (this.defines = t),
                (this.extensions = e))
            }
          },
          {
            key: 'setUberOptions',
            value: function (e) {
              if (void 0 !== e)
                for (var t in e)
                  e.hasOwnProperty(t) &&
                    (this.uberOptions[t] instanceof ae.Color
                      ? (this.uberOptions[t] = e[t].clone())
                      : (this.uberOptions[t] = e[t]))
            }
          },
          {
            key: 'clone',
            value: function (e) {
              return e
                ? this.createInstance()
                : ae.Material.prototype.clone.call(this)
            }
          },
          {
            key: 'updateUniforms',
            value: function () {
              var t = this
              Pi.forEach(function (e) {
                t.uniforms.hasOwnProperty(e) &&
                  (t.uberOptions[e] instanceof ae.Color ||
                  t.uberOptions[e] instanceof ae.Matrix4
                    ? (t.uniforms[e].value = t.uberOptions[e].clone())
                    : (t.uniforms[e].value = t.uberOptions[e]))
              })
            }
          }
        ]),
        n
      )
    })()
  function Li(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function Ii(e) {
    return (function () {
      x(o, e)
      var i = Li(o)
      function o() {
        var e
        G(this, o)
        for (var t = arguments.length, r = new Array(t), n = 0; n < t; n++)
          r[n] = arguments[n]
        return (
          ((e = i.call.apply(i, [this].concat(r))).onBeforeRender =
            o.prototype.onBeforeRender),
          e
        )
      }
      return (
        p(o, [
          {
            key: 'onBeforeRender',
            value: function (e, t, r, n, i, o) {
              this._onBeforeRender(e, t, r, n, i, o), this._update()
            }
          },
          { key: '_onBeforeRender', value: function () {} },
          {
            key: '_update',
            value: function () {
              var e = this.material
              e && e instanceof Ni && e.updateUniforms()
            }
          }
        ]),
        o
      )
    })()
  }
  function Oi(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Bi = Ii(ae.Mesh),
    Vi = (function () {
      x(o, Bi)
      var i = Oi(o)
      function o() {
        var e
        G(this, o)
        for (var t = arguments.length, r = new Array(t), n = 0; n < t; n++)
          r[n] = arguments[n]
        return (
          ((e = i.call.apply(i, [this].concat(r))).castShadow = !0),
          (e.receiveShadow = !0),
          e
        )
      }
      return (
        p(o, [
          {
            key: '_onBeforeRender',
            value: function (e, t, r, n, i, o) {
              Bi.prototype._onBeforeRender.call(this, e, t, r)
              t = this.material
              t &&
                t.uniforms.invModelViewMatrix &&
                (this.modelViewMatrix.multiplyMatrices(
                  r.matrixWorldInverse,
                  this.matrixWorld
                ),
                t.uniforms.invModelViewMatrix.value
                  .copy(this.modelViewMatrix)
                  .invert(),
                (t.uniforms.nearPlaneValue.value = r.near),
                (t.uniformsNeedUpdate = !0))
            }
          }
        ]),
        o
      )
    })()
  function Di(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var zi = Ii(ae.Mesh),
    Fi = (function () {
      x(s, zi)
      var r = Di(s)
      function s(e, t) {
        return (
          G(this, s),
          ((t = r.call(this, e, t)).castShadow = !0),
          (t.receiveShadow = !0),
          t
        )
      }
      return (
        p(s, [
          {
            key: '_onBeforeRender',
            value: function (e, t, r) {
              zi.prototype._onBeforeRender.call(this, e, t, r)
              var n,
                i = this.geometry,
                o = this.material
              i.zClip &&
                o.uberOptions &&
                ((n = s._mvLength),
                (e = s._center),
                (t = s._modelView).multiplyMatrices(
                  this.matrixWorld,
                  r.matrixWorldInverse
                ),
                (t = n.setFromMatrixColumn(t, 0).length()),
                e.copy(i.boundingSphere.center),
                this.localToWorld(e),
                (o.uberOptions.zClipValue =
                  r.position.z - e.z - t * (0.5 * i.boundingSphere.radius)))
            }
          }
        ]),
        s
      )
    })()
  function Ui(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Fi, '_mvLength', new ae.Vector3()),
    be(Fi, '_center', new ae.Vector3()),
    be(Fi, '_modelView', new ae.Matrix4())
  var Gi = (function () {
    x(o, ae.Group)
    var i = Ui(o)
    function o(e, t) {
      var r
      G(this, o), ((r = i.call(this)).geometry = e)
      var n = S(r)
      return (
        (n.initialized = !1),
        r.geometry.addEventListener('update', function () {
          n.update()
        }),
        r
      )
    }
    return (
      p(o, [
        {
          key: 'init',
          value: function () {
            for (var e = this.children, t = e.length - 1; 0 <= t; --t)
              this.remove(e[t])
            for (
              var r = this.geometry,
                n = r.items,
                i = r.userData,
                o = 0,
                s = n.length;
              o < s;
              ++o
            ) {
              var a,
                l = n[o]
              l &&
                ((a = le.shallowCloneNode(l)),
                ((a = new dr(a)).userData = b.default.clone(i)),
                (a.getElement().style.visibility = 'visible'),
                (a.source = l),
                this.add(a))
            }
            this.initialized = !0
          }
        },
        {
          key: 'update',
          value: function () {
            if (this.geometry.needsUpdate) {
              var e = this.children
              this.initialized || this.init()
              for (var t = 0, r = e.length; t < r; ++t) {
                var n = e[t],
                  i = n.source
                n.position.copy(i.worldPos),
                  (n.userData.color = i.opts.color),
                  (n.userData.background = i.opts.background)
              }
            }
          }
        }
      ]),
      o
    )
  })()
  function ji(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Hi = Ii(ae.Mesh),
    Wi = (function () {
      x(n, Hi)
      var r = ji(n)
      function n(e, t) {
        return (
          G(this, n),
          ((t = r.call(this, e, t)).castShadow = !0),
          (t.receiveShadow = !0),
          t
        )
      }
      return p(n)
    })()
  function Yi(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Xi = Ii(ae.Mesh),
    qi = new ae.Vector2(),
    $i = (function () {
      x(t, Xi)
      var e = Yi(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_onBeforeRender',
            value: function (e, t, r, n, i, o) {
              var s = this.material
              s.uberOptions &&
                (s.uberOptions.projMatrixInv.copy(r.projectionMatrix).invert(),
                e.getSize(qi),
                s.uberOptions.viewport.set(qi.width, qi.height))
            }
          }
        ]),
        t
      )
    })()
  function Zi(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Ki = Ii(ae.Mesh),
    Qi = (function () {
      x(o, Ki)
      var i = Zi(o)
      function o() {
        var e
        G(this, o)
        for (var t = arguments.length, r = new Array(t), n = 0; n < t; n++)
          r[n] = arguments[n]
        return (
          ((e = i.call.apply(i, [this].concat(r))).castShadow = !0),
          (e.receiveShadow = !0),
          e
        )
      }
      return p(o)
    })(),
    Ji = {
      ZClipped: Fi,
      ZSprite: Vi,
      Text: Gi,
      Line: Ii(ae.Line),
      LineSegments: Ii(ae.LineSegments),
      Mesh: Wi,
      ThickLineMesh: $i,
      Instanced: Qi
    }
  function eo(t, r) {
    return function (e) {
      e.setValues(t), e.setUberOptions(r)
    }
  }
  function to(r, n) {
    return {
      Geometry: function (e, t) {
        return new mi.Instanced2CCylindersGeometry(e, t, r, n)
      },
      Object: r ? Ji.ZSprite : Ji.Instanced,
      initMaterial: eo({
        instancedMatrix: !0,
        attrColor: !0,
        attrColor2: !0,
        attrAlphaColor: !0,
        cylinderSprite: r
      })
    }
  }
  function ro(e, t) {
    var r = e.prototype instanceof An,
      t = t.lineWidth || 0
    return {
      Geometry: e,
      Object: r ? Ji.ThickLineMesh : Ji.LineSegments,
      initMaterial: eo(
        { lights: !1, attrColor: !0, attrAlphaColor: !0, thickLine: r },
        { lineWidth: t }
      )
    }
  }
  function no(e, t, r, n) {
    n = {
      wireframe: !!n.wireframe,
      fakeOpacity: r.now.isoSurfaceFakeOpacity,
      zClip: n.zClip
    }
    return {
      Geometry: e,
      Object: Ji.ZClipped,
      initMaterial: eo({
        attrColor: !0,
        attrAlphaColor: !1,
        wireframe: n.wireframe,
        fakeOpacity: n.fakeOpacity,
        zClip: n.zClip
      })
    }
  }
  var io = (function () {
    function e() {
      G(this, e)
    }
    return (
      p(e, null, [
        {
          key: 'createSpheres',
          value: function (e, t) {
            var r = t.now.zSprites
            return {
              Geometry: function (e, t) {
                return new mi.InstancedSpheresGeometry(e, t, r)
              },
              Object: r ? Ji.ZSprite : Ji.Instanced,
              initMaterial: eo({
                instancedPos: !0,
                attrColor: !0,
                attrAlphaColor: !0,
                sphereSprite: r
              })
            }
          }
        },
        {
          key: 'create2CClosedCylinders',
          value: function (e, t) {
            return to(!1, !1)
          }
        },
        {
          key: 'create2CCylinders',
          value: function (e, t) {
            return to(t.now.zSprites, !0)
          }
        },
        {
          key: 'create2CLines',
          value: function (e, t, r) {
            return ro(mi.TwoColorLinesGeometry, r)
          }
        },
        {
          key: 'createCrosses',
          value: function (e, t, r) {
            return ro(mi.CrossGeometry, r)
          }
        },
        {
          key: 'createExtrudedChains',
          value: function (e, t) {
            return {
              Geometry: mi.ExtrudedObjectsGeometry,
              Object: Ji.Mesh,
              initMaterial: eo({ attrColor: !0, attrAlphaColor: !0 })
            }
          }
        },
        {
          key: 'createChunkedLines',
          value: function (e, t, r) {
            return ro(mi.ChunkedLinesGeometry, r)
          }
        },
        {
          key: 'createQuickSurface',
          value: function (e, t, r) {
            return no(mi.QuickSurfGeometry, 0, t, r)
          }
        },
        {
          key: 'createContactSurface',
          value: function (e, t, r) {
            return no(mi.ContactSurfaceGeometry, 0, t, r)
          }
        },
        {
          key: 'createSASSES',
          value: function (e, t, r) {
            return no(mi.SSIsosurfaceGeometry, 0, t, r)
          }
        },
        {
          key: 'createLabels',
          value: function (e, t) {
            return {
              Geometry: mi.LabelsGeometry,
              Object: Ji.Text,
              initMaterial: function () {}
            }
          }
        }
      ]),
      e
    )
  })()
  function oo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var so = (function () {
    x(d, ae.Object3D)
    var l = oo(d)
    function d(e, t, r, n) {
      var i
      G(this, d), ((i = l.call(this))._geometry = e), (i._geoParams = t)
      r = r.createInstance()
      t.initMaterial(r),
        (i._material = r),
        (i._transforms = 0 < n.length ? n : [new ae.Matrix4()])
      for (var o = i._createMeshes(e), s = 0, a = o.length; s < a; ++s)
        i.add(o[s])
      return i
    }
    return (
      p(d, [
        {
          key: 'raycast',
          value: function (e, t) {
            var r = d._ray,
              n = d._inverseMatrix,
              i = this.children
            r.copy(e.ray)
            for (var o = 0, s = i.length; o < s; ++o) {
              var a = i[o]
              if (kr.belongToSelectLayers(a)) {
                a.updateMatrixWorld()
                var l = a.matrixWorld
                n.copy(l).invert(), e.ray.copy(r).applyMatrix4(n)
                var c = []
                this._geometry.raycast(e, c)
                for (var u = 0, h = c.length; u < h; ++u) {
                  var f = c[u]
                  f.point &&
                    (f.point.applyMatrix4(l),
                    (f.distance = r.origin.distanceTo(f.point))),
                    (f.object = a),
                    (t[t.length] = f)
                }
              }
            }
            e.ray.copy(r)
          }
        },
        {
          key: 'getSubset',
          value: function (e) {
            for (
              var t = this._geometry.getSubset(e),
                r = [],
                n = 0,
                i = 0,
                o = t.length;
              i < o;
              ++i
            )
              for (
                var s = this._createMeshes(t[i]), a = 0, l = s.length;
                a < l;
                ++a
              )
                r[n++] = s[a]
            return r
          }
        },
        {
          key: '_createMeshes',
          value: function (e) {
            for (
              var t = this._transforms,
                r = this._geoParams.Object,
                n = this._material,
                i = [],
                o = 0,
                s = t.length;
              o < s;
              ++o
            ) {
              var a = new r(e, n)
              a.applyMatrix4(t[o]), (i[o] = a)
            }
            return i
          }
        }
      ]),
      d
    )
  })()
  function ao(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(so, '_inverseMatrix', new ae.Matrix4()), be(so, '_ray', new ae.Ray())
  var lo = (function () {
    x(c, mr)
    var l = ao(c)
    function c(e, t, r, n, i, o, s) {
      var a
      if ((G(this, c), (a = l.call(this)).constructor === c))
        throw new Error('Can not instantiate abstract class!')
      return (
        (a._selection = t),
        (a._mode = n),
        (a._colorer = r),
        (a._chunksIdc = t.chunks),
        (a._polyComplexity = o),
        (a._geo =
          ((t = e.Geometry),
          (o = a._makeGeoArgs()),
          (o = [t].concat(o)),
          new (t.bind.apply(t, Nr(o)))())),
        (a._mesh = new so(a._geo, e, s, i)),
        a.add(a._mesh),
        a._build(),
        a
      )
    }
    return (
      p(c, [
        {
          key: '_makeGeoArgs',
          value: function () {
            throw new Error(
              'ChemGroup subclass must override _makeGeoArgs() method'
            )
          }
        },
        {
          key: 'getSubset',
          value: function (e, t) {
            t = this._calcChunksList(e, (t = void 0 !== t && t))
            return 0 === t.length ? [] : this._mesh.getSubset(t)
          }
        },
        {
          key: '_changeSubsetOpacity',
          value: function (e, t, r) {
            r = this._calcChunksList(e, r)
            0 !== r.length && this._geo.setOpacity(r, t)
          }
        },
        {
          key: 'enableSubset',
          value: function (e, t) {
            this._changeSubsetOpacity(e, 1, (t = void 0 === t || t))
          }
        },
        {
          key: 'disableSubset',
          value: function (e, t) {
            this._changeSubsetOpacity(e, 0, (t = void 0 === t || t))
          }
        }
      ]),
      c
    )
  })()
  function co(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var uo = (function () {
    x(t, lo)
    var e = co(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'raycast',
          value: function (e, t) {
            var r = this._selection.atoms,
              n = []
            this._mesh.raycast(e, n)
            for (var i, o = this._chunksIdc, s = 0, a = n.length; s < a; ++s)
              n[s].hasOwnProperty('chunkIdx') &&
                (i = o[n[s].chunkIdx]) < r.length &&
                ((n[s].atom = r[i]), t.push(n[s]))
          }
        },
        {
          key: '_calcChunksList',
          value: function (e) {
            for (
              var t = [],
                r = this._selection.atoms,
                n = this._chunksIdc,
                i = 0,
                o = n.length;
              i < o;
              ++i
            )
              0 != (r[n[i]].mask & e) && t.push(i)
            return t
          }
        }
      ]),
      t
    )
  })()
  function ho(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var fo = (function () {
    x(t, uo)
    var e = ho(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_makeGeoArgs',
          value: function () {
            return [this._selection.chunks.length, this._polyComplexity]
          }
        },
        {
          key: '_build',
          value: function () {
            for (
              var e = this._selection.chunks,
                t = this._selection,
                r = t.atoms,
                n = t.parent,
                i = this._mode,
                o = this._colorer,
                s = this._geo,
                a = 0,
                l = e.length;
              a < l;
              ++a
            ) {
              var c = r[e[a]]
              s.setItem(a, c.position, i.calcAtomRadius(c)),
                s.setColor(a, o.getAtomColor(c, n))
            }
            s.finalize()
          }
        },
        {
          key: 'updateToFrame',
          value: function (e) {
            for (
              var t = this._selection.chunks,
                r = this._selection.atoms,
                n = this._mode,
                i = this._colorer,
                o = e.needsColorUpdate(i),
                s = this._geo,
                a = 0,
                l = t.length;
              a < l;
              ++a
            ) {
              var c = r[t[a]]
              s.setItem(a, e.getAtomPos(t[a]), n.calcAtomRadius(c)),
                o && s.setColor(a, e.getAtomColor(i, c))
            }
            s.finalize()
          }
        }
      ]),
      t
    )
  })()
  function po(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var mo = (function () {
    x(t, fo)
    var e = po(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_makeGeoArgs',
          value: function () {
            for (
              var e = [],
                t = this._selection,
                r = t.atoms,
                n = t.chunks,
                i = n.length,
                o = 0;
              o < i;
              ++o
            )
              e[o] = r[n[o]]
            t = this._mode.getSurfaceOpts()
            return (t.atoms = e), [i, t]
          }
        }
      ]),
      t
    )
  })()
  function yo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var _o = (function () {
    x(t, fo)
    var e = yo(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_makeGeoArgs',
          value: function () {
            for (
              var e = [],
                t = this._selection,
                r = t.atoms,
                n = t.chunks,
                i = n.length,
                o = 0;
              o < i;
              ++o
            )
              e[o] = r[n[o]]
            t = this._mode.getSurfaceOpts()
            return (
              (t.atoms = e),
              (t.selection = this._selection),
              (t.colorMode = this._colorer),
              [i, t]
            )
          }
        }
      ]),
      t
    )
  })()
  function vo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function go(e) {
    return null !== e.name.getNode() ? e.name.getNode() : e.getVisualName()
  }
  var xo = {
    none: function (e) {
      return e
    },
    adjust: function (e) {
      var t = (e >> 16) & 255,
        r = (e >> 8) & 255,
        e =
          127 < 0.2126 * t + 0.7152 * r + 0.0722 * (e = 255 & e)
            ? ((t = (3 * t) / 10), (r = (3 * r) / 10), (3 * e) / 10)
            : ((t = 255 - (3 * (255 - t)) / 10),
              (r = 255 - (3 * (255 - r)) / 10),
              255 - (3 * (255 - e)) / 10)
      return (t << 16) | (r << 8) | e
    },
    inverse: function (e) {
      return (
        ((255 - ((e >> 16) & 255)) << 16) |
        ((255 - ((e >> 8) & 255)) << 8) |
        (255 - (255 & e))
      )
    }
  }
  function bo(e, t) {
    return xo.hasOwnProperty(t)
      ? le.hexColor(xo[t](e))
      : ((e = parseInt(t, 16)),
        !Number.isNaN(e) && t.toLowerCase().startsWith('0x')
          ? le.hexColor(e)
          : '#000000')
  }
  function wo(t, e) {
    return e.replace(/\{\{(\s*\w+\s*)\}\}/g, function (e) {
      e = (e = e.replace(/\s+/g, '')).substring(2, e.length - 2).toLowerCase()
      return So.hasOwnProperty(e) ? So[e](t) : 'null'
    })
  }
  var So = {
      serial: function (e) {
        return e.serial
      },
      name: function (e) {
        return e.getVisualName()
      },
      elem: function (e) {
        return e.element.name
      },
      residue: function (e) {
        return e.residue.getType().getName()
      },
      sequence: function (e) {
        return e.residue.getSequence()
      },
      chain: function (e) {
        return e.residue.getChain().getName()
      },
      hetatm: function (e) {
        return e.isHet()
      },
      water: function (e) {
        return (
          'HOH' === e.residue.getType().getName() ||
          'WAT' === e.residue.getType().getName()
        )
      }
    },
    Ro = (function () {
      x(t, uo)
      var e = vo(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_makeGeoArgs',
            value: function () {
              var e = this._mode.getLabelOpts()
              return [this._selection.chunks.length, e]
            }
          },
          {
            key: '_build',
            value: function () {
              for (
                var e = this._mode.getLabelOpts(),
                  t = this._selection.chunks,
                  r = this._selection,
                  n = r.atoms,
                  i = r.parent,
                  o = this._colorer,
                  s = this._geo,
                  a = 0,
                  l = t.length;
                a < l;
                ++a
              ) {
                var c,
                  u,
                  h = n[t[a]],
                  f = e.template ? wo(h, e.template) : go(h)
                f &&
                  ((u = o.getAtomColor(h, i)),
                  (c = parseInt(bo(u, e.fg).substring(1), 16)),
                  (u = e.showBg
                    ? parseInt(bo(u, e.bg).substring(1), 16)
                    : 'transparent'),
                  s.setItem(a, h.position, f),
                  s.setColor(a, c, u))
              }
              s.finalize()
            }
          },
          {
            key: 'updateToFrame',
            value: function (e) {
              for (
                var t = this._mode.getLabelOpts(),
                  r = this._selection.chunks,
                  n = this._selection.atoms,
                  i = this._colorer,
                  o = this._geo,
                  s = e.needsColorUpdate(i),
                  a = 0,
                  l = r.length;
                a < l;
                ++a
              ) {
                var c,
                  u = n[r[a]],
                  h = t.template ? wo(u, t.template) : go(u)
                h &&
                  ((c = e.getAtomColor(i, u)),
                  (u = parseInt(bo(c, t.fg).substring(1), 16)),
                  (c = t.showBg
                    ? parseInt(bo(c, t.bg).substring(1), 16)
                    : 'transparent'),
                  o.setItem(a, e.getAtomPos(r[a]), h),
                  s && o.setColor(a, u, c))
              }
              o.finalize()
            }
          }
        ]),
        t
      )
    })()
  function Co(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function Ao(e, t, r, n) {
    var i = Math.sin(e)
    return t
      .clone()
      .multiplyScalar(Math.sin((1 - n) * e) / i)
      .addScaledVector(r, Math.sin(n * e) / i)
  }
  var Eo = (function () {
    x(t, uo)
    var e = Co(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_buildInner',
          value: function (e, t) {
            for (
              var r = this._selection.chunks,
                n = new ae.Vector3(),
                i = new ae.Vector3(),
                o = this._segmentsHeight,
                s = 1 / o,
                a = this._colorer,
                l = this._selection,
                c = l.cycles,
                u = l.parent,
                h = 0,
                f = r[h],
                d = 0,
                p = c.length;
              d < p;
              ++d
            ) {
              var m = c[d],
                y = m.atoms,
                _ = [],
                v = [],
                g = m.center,
                x = m.radius - e,
                b = y.length,
                w = 0,
                m = y[b - 1].position,
                S = y[w].position
              n.subVectors(m, g), i.subVectors(S, g)
              for (var R = i.clone().cross(n).normalize(); w < b; ++w) {
                var C = n.angleTo(i)
                ;(v[w] = Ao(C, n, i, 0.5).normalize()),
                  (S = y[(w + 1) % b].position),
                  n.copy(i),
                  i.subVectors(S, g)
              }
              for (w = 0; w < b; ++w)
                if (y[w].index === f) {
                  for (
                    var A = v[w],
                      E = v[(w + 1) % b],
                      k = a.getAtomColor(y[w], u),
                      T = A.angleTo(E),
                      P = 0;
                    P <= o;
                    ++P
                  )
                    _[P] = Ao(T, A, E, P * s)
                      .multiplyScalar(x)
                      .add(g)
                  t(h++, k, _, g, R), (f = r[h])
                }
            }
          }
        }
      ]),
      t
    )
  })()
  function ko(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var To = kr.calcChunkMatrix,
    Po = (function () {
      x(t, Eo)
      var e = ko(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_build',
            value: function () {
              var l = this._segmentsHeight,
                e = this._mode.getAromRadius(),
                c = new ae.Vector2(e, e),
                e = this._mode.calcStickRadius() + 2 * e,
                u = new ae.Vector3(),
                h = [],
                f = this._geo
              this._buildInner(e, function (e, t, r, n, i) {
                for (var o = 0; o <= l; ++o) {
                  var s = r[o],
                    a = s.clone().sub(n).cross(i)
                  u.addVectors(s, a), (h[o] = To(s, u, i, c))
                }
                f.setItem(e, h), f.setColor(e, t)
              }),
                f.finalize()
            }
          },
          {
            key: '_makeGeoArgs',
            value: function () {
              return (
                (this._segmentsHeight = this._polyComplexity),
                [
                  (function (e, t) {
                    for (var r = [], n = 0; n < t; ++n) {
                      var i = ((-2 * n) / t) * Math.PI
                      r.push(
                        new ae.Vector3(Math.cos(i) * e, Math.sin(i) * e, 0)
                      )
                    }
                    return r
                  })(1, this._polyComplexity),
                  this._segmentsHeight + 1,
                  this._selection.chunks.length
                ]
              )
            }
          }
        ]),
        t
      )
    })()
  function Mo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var No = (function () {
    x(t, Eo)
    var e = Mo(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_build',
          value: function () {
            var s = this,
              a = this._geo,
              e = this._mode.getAromaticOffset()
            this._buildInner(e, function (e, t, r) {
              for (var n = r[0], i = 1; i <= s._segmentsHeight; ++i) {
                var o = r[i]
                a.setSegment(e, i - 1, n, o), (n = o)
              }
              a.setColor(e, t)
            }),
              a.finalize()
          }
        },
        {
          key: '_makeGeoArgs',
          value: function () {
            return (
              (this._segmentsHeight = this._mode.getAromaticArcChunks()),
              [this._selection.chunks.length, this._segmentsHeight, !0]
            )
          }
        }
      ]),
      t
    )
  })()
  function Lo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Io = (function () {
    x(t, lo)
    var e = Lo(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'raycast',
          value: function (e, t) {
            var r = this._selection.residues,
              n = []
            this._mesh.raycast(e, n)
            for (var i, o = this._chunksIdc, s = 0, a = n.length; s < a; ++s)
              n[s].hasOwnProperty('chunkIdx') &&
                (i = o[n[s].chunkIdx]) < r.length &&
                ((n[s].residue = r[i]), t.push(n[s]))
          }
        },
        {
          key: '_calcChunksList',
          value: function (e) {
            for (
              var t = [],
                r = this._selection.residues,
                n = this._chunksIdc,
                i = 0,
                o = n.length;
              i < o;
              ++i
            )
              0 != (r[n[i]]._mask & e) && t.push(i)
            return t
          }
        }
      ]),
      t
    )
  })()
  function Oo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Bo = (function () {
    x(t, Io)
    var e = Oo(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'raycast',
          value: function (e, t) {
            var r = this._selection.residues,
              n = []
            this._mesh.raycast(e, n)
            for (var i, o = this._chunksIdc, s = 0, a = n.length; s < a; ++s)
              n[s].hasOwnProperty('chunkIdx') &&
                (i = o[Math.floor(n[s].chunkIdx / 2)]) < r.length &&
                ((n[s].residue = r[i]), t.push(n[s]))
          }
        },
        {
          key: '_build',
          value: function () {
            for (
              var e = this._selection,
                t = e.residues,
                r = e.parent,
                n = this._colorer,
                e = this._geo,
                i = this._mode.calcStickRadius(),
                o = 0,
                s = this._selection.chunks,
                a = 0,
                l = s.length;
              a < l;
              ++a
            ) {
              var c = t[s[a]],
                u = n.getResidueColor(c, r)
              this._processItem(o++, c._cylinders[0], c._cylinders[1], i, u)
            }
            e.finalize()
          }
        },
        {
          key: '_calcChunksList',
          value: function (e) {
            for (
              var t = [],
                r = 0,
                n = this._selection.residues,
                i = this._chunksIdc,
                o = 0,
                s = i.length;
              o < s;
              ++o
            )
              0 != (n[i[o]]._mask & e) &&
                ((t[r++] = 2 * o), (t[r++] = 2 * o + 1))
            return t
          }
        },
        {
          key: 'updateToFrame',
          value: function (e) {
            for (
              var t = e.getResidues(),
                r = this._selection.parent,
                n = this._colorer,
                e = this._geo,
                i = this._mode.calcStickRadius(),
                o = 0,
                s = this._selection.chunks,
                a = 0,
                l = s.length;
              a < l;
              ++a
            ) {
              var c = t[s[a]],
                u = n.getResidueColor(c, r)
              this._processItem(o++, c._cylinders[0], c._cylinders[1], i, u)
            }
            e.finishUpdate()
          }
        }
      ]),
      t
    )
  })()
  function Vo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Do = (function () {
    x(t, Bo)
    var e = Vo(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_makeGeoArgs',
          value: function () {
            return [this._selection.chunks.length, this._polyComplexity]
          }
        },
        {
          key: '_processItem',
          value: function (e, t, r, n, i) {
            var o = this._geo
            o.setItem(e, t, r, n), o.setColor(e, i, i)
          }
        }
      ]),
      t
    )
  })()
  function zo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Fo,
    Uo = (function () {
      x(t, Bo)
      var e = zo(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_makeGeoArgs',
            value: function () {
              return [2 * this._selection.chunks.length, this._polyComplexity]
            }
          },
          {
            key: '_processItem',
            value: function (e, t, r, n, i) {
              var o = this._geo,
                e = 2 * e
              o.setItem(e, t, n),
                o.setColor(e, i),
                o.setItem(++e, r, n),
                o.setColor(e, i)
            }
          }
        ]),
        t
      )
    })(),
    Go = {}
  ;(Fo = Go),
    /*
  Smooth.js version 0.1.7

  Turn arrays into smooth functions.

  Copyright 2012 Spencer Cohen
  Licensed under MIT license (see "Smooth.js MIT license.txt")
  */
    function () {
      function e(e, t) {
        for (var r in t) E.call(t, r) && (e[r] = t[r])
        function n() {
          this.constructor = e
        }
        return (
          (n.prototype = t.prototype),
          (e.prototype = new n()),
          (e.__super__ = t.prototype),
          e
        )
      }
      var t,
        n,
        r,
        p,
        m,
        i,
        y,
        _,
        o,
        s,
        a,
        v,
        g,
        x,
        l,
        c,
        b,
        w,
        u,
        S,
        R,
        h,
        f,
        C,
        A,
        E = Object.prototype.hasOwnProperty
      function d(e, t) {
        if (
          ((this.array = e.slice(0)),
          (this.length = this.array.length),
          !(this.clipHelper = {
            clamp: this.clipHelperClamp,
            zero: this.clipHelperZero,
            periodic: this.clipHelperPeriodic,
            mirror: this.clipHelperMirror
          }[t.clip]))
        )
          throw 'Invalid clip: ' + t.clip
      }
      function k() {
        k.__super__.constructor.apply(this, arguments)
      }
      function T() {
        T.__super__.constructor.apply(this, arguments)
      }
      function P(e, t) {
        ;(this.tangentFactor = 1 - Math.max(-1, Math.min(1, t.cubicTension))),
          P.__super__.constructor.apply(this, arguments)
      }
      function M(e, t) {
        if (
          (M.__super__.constructor.apply(this, arguments),
          (this.a = t.sincFilterSize),
          !t.sincWindow)
        )
          throw 'No sincWindow provided'
        this.kernel = u(t.sincWindow)
      }
      for (c in ((v = {
        method: (r = {
          METHOD_NEAREST: 'nearest',
          METHOD_LINEAR: 'linear',
          METHOD_CUBIC: 'cubic',
          METHOD_LANCZOS: 'lanczos',
          METHOD_SINC: 'sinc',
          CLIP_CLAMP: 'clamp',
          CLIP_ZERO: 'zero',
          CLIP_PERIODIC: 'periodic',
          CLIP_MIRROR: 'mirror',
          CUBIC_TENSION_DEFAULT: 0,
          CUBIC_TENSION_CATMULL_ROM: 0
        }).METHOD_CUBIC,
        cubicTension: r.CUBIC_TENSION_DEFAULT,
        clip: r.CLIP_CLAMP,
        scaleTo: 0,
        sincFilterSize: 2,
        sincWindow: void 0
      }),
      (o = function (e, t) {
        return Math.max(0, Math.min(e, t - 1))
      }),
      (a = function (e, t) {
        return (e %= t) < 0 && (e += t), e
      }),
      (s = function (e, t) {
        var r = 2 * (t - 1)
        return (e = t - 1 < (e = a(e, r)) ? r - e : e)
      }),
      (d.prototype.getClippedInput = function (e) {
        return 0 <= e && e < this.length ? this.array[e] : this.clipHelper(e)
      }),
      (d.prototype.clipHelperClamp = function (e) {
        return this.array[o(e, this.length)]
      }),
      (d.prototype.clipHelperZero = function (e) {
        return 0
      }),
      (d.prototype.clipHelperPeriodic = function (e) {
        return this.array[a(e, this.length)]
      }),
      (d.prototype.clipHelperMirror = function (e) {
        return this.array[s(e, this.length)]
      }),
      (d.prototype.interpolate = function (e) {
        throw 'Subclasses of AbstractInterpolator must override the interpolate() method.'
      }),
      e(k, (t = d)),
      (k.prototype.interpolate = function (e) {
        return this.getClippedInput(Math.round(e))
      }),
      (m = k),
      e(T, t),
      (T.prototype.interpolate = function (e) {
        var t = Math.floor(e)
        return (
          (1 - (e -= t)) * this.getClippedInput(t) +
          e * this.getClippedInput(t + 1)
        )
      }),
      (p = T),
      e(P, t),
      (P.prototype.getTangent = function (e) {
        return (
          (this.tangentFactor *
            (this.getClippedInput(e + 1) - this.getClippedInput(e - 1))) /
          2
        )
      }),
      (P.prototype.interpolate = function (e) {
        var t,
          r = Math.floor(e),
          n = [this.getTangent(r), this.getTangent(r + 1)],
          i = [this.getClippedInput(r), this.getClippedInput(r + 1)]
        return (
          (2 * (r = (e -= r) * (t = e * e)) - 3 * t + 1) * i[0] +
          (r - 2 * t + e) * n[0] +
          (-2 * r + 3 * t) * i[1] +
          (r - t) * n[1]
        )
      }),
      (n = P),
      (h = Math.sin),
      (i = Math.PI),
      (f = function (e) {
        return 0 === e ? 1 : h(i * e) / (i * e)
      }),
      (b = function (t) {
        return function (e) {
          return f(e / t)
        }
      }),
      (u = function (t) {
        return function (e) {
          return f(e) * t(e)
        }
      }),
      e(M, t),
      (M.prototype.interpolate = function (e) {
        for (
          var t,
            r = Math.floor(e),
            n = 0,
            i = (t = r - this.a + 1),
            o = r + this.a;
          t <= o ? i <= o : o <= i;
          t <= o ? i++ : i--
        )
          n += this.kernel(e - i) * this.getClippedInput(i)
        return n
      }),
      (y = M),
      (g = function (e, t) {
        for (var r, n = [], i = 0, o = e.length; i < o; i++)
          (r = e[i]), n.push(r[t])
        return n
      }),
      (w = function (t, e, r) {
        var n, i
        return '0,1' === r.join
          ? t
          : ((n = e / (r[1] - r[0])),
            (i = r[0]),
            function (e) {
              return t(n * (e - i))
            })
      }),
      (x = function (e) {
        return Object.prototype.toString.call(e).slice('[object '.length, -1)
      }),
      (C = function (e) {
        if (isNaN(e)) throw 'NaN in Smooth() input'
        if ('Number' !== x(e)) throw 'Non-number in Smooth() input'
        if (!isFinite(e)) throw 'Infinity in Smooth() input'
      }),
      (A = function (e, t) {
        var r, n, i
        if ('Array' !== x(e)) throw 'Non-vector in Smooth() input'
        if (e.length !== t) throw 'Inconsistent dimension in Smooth() input'
        for (n = 0, i = e.length; n < i; n++) (r = e[n]), C(r)
      }),
      (l = function (e) {
        return 'Number' === x(e) && isFinite(e) && !isNaN(e)
      }),
      (S = function (e) {
        var t = 'scaleTo param must be number or array of two numbers'
        switch (x(e)) {
          case 'Number':
            if (!l(e)) throw t
            e = [0, e]
            break
          case 'Array':
            if (2 !== e.length) throw t
            if (!l(e[0]) || !l(e[1])) throw t
            break
          default:
            throw t
        }
        return e
      }),
      (R = function (e) {
        var t,
          r,
          n = {}
        for (t in e) E.call(e, t) && ((r = e[t]), (n[t] = r))
        return n
      }),
      (_ = function (i, o) {
        var e,
          s,
          a,
          l,
          c,
          u,
          t,
          h,
          r,
          f,
          d = {}
        for (t in ((o = R((o = null == o ? {} : o))),
        (d.config = R(o)),
        null == o.scaleTo && (o.scaleTo = o.period),
        null == o.sincFilterSize && (o.sincFilterSize = o.lanczosFilterSize),
        v))
          E.call(v, t) && ((f = v[t]), null == o[t] && (o[t] = f))
        if (
          !(c = { nearest: m, linear: p, cubic: n, lanczos: y, sinc: y }[
            o.method
          ])
        )
          throw 'Invalid method: ' + o.method
        if (
          ('lanczos' === o.method && (o.sincWindow = b(o.sincFilterSize)),
          i.length < 2)
        )
          throw 'Array must have at least two elements'
        for (t in ((d.count = i.length),
        (r = (function () {
          var e, t, r, n
          switch (x(i[0])) {
            case 'Number':
              if (((d.dimension = 'scalar'), _.deepValidation))
                for (e = 0, r = i.length; e < r; e++) (h = i[e]), C(h)
              return (
                (l = new c(i, o)),
                function (e) {
                  return l.interpolate(e)
                }
              )
            case 'Array':
              if (((d.dimension = s = i[0].length), !s))
                throw 'Vectors must be non-empty'
              if (_.deepValidation)
                for (t = 0, n = i.length; t < n; t++) (f = i[t]), A(f, s)
              return (
                (u = (function () {
                  var e = []
                  for (a = 0; 0 <= s ? a < s : s < a; 0 <= s ? a++ : a--)
                    e.push(new c(g(i, a), o))
                  return e
                })()),
                function (e) {
                  for (var t, r = [], n = 0, i = u.length; n < i; n++)
                    (t = u[n]), r.push(t.interpolate(e))
                  return r
                }
              )
            default:
              throw 'Invalid element type: ' + x(i[0])
          }
        })()),
        (e = 'periodic' === o.clip ? i.length : i.length - 1),
        o.scaleTo || (o.scaleTo = e),
        (d.domain = S(o.scaleTo)),
        (r = w(r, e, d.domain)),
        d.domain.sort(),
        d))
          E.call(d, t) && ((f = d[t]), (r[t] = f))
        return r
      }),
      r))
        E.call(r, c) && (_[c] = r[c])
      ;(_.deepValidation = !0), ((null !== Fo ? Fo : window).Smooth = _)
    }.call(Qe)
  var jo = hr.ResidueType,
    Ho = kr.calcChunkMatrix
  function Wo(r, e) {
    var n = Go.Smooth(r, {
      method: Go.Smooth.METHOD_CUBIC,
      clip: Go.Smooth.CLIP_CLAMP,
      cubicTension: e,
      scaleTo: 1
    })
    return function (e, t) {
      ;(e = (
        null === t
          ? function (e) {
              return (e * (r.length - 1 - 2) + 1) / (r.length - 1)
            }
          : t
      )(e)),
        (e = n(e))
      return new ae.Vector3(e[0], e[1], e[2])
    }
  }
  function Yo(e, t, r, n) {
    if (!n._isValid) return (e[r] = e[r - 1]), void (t[r] = t[r - 1])
    var i = n._controlPoint
    e[r] = [i.x, i.y, i.z]
    n = i.clone().add(n._wingVector)
    t[r] = [n.x, n.y, n.z]
  }
  function Xo(r, e, t, n) {
    var i = n.start,
      o = n.end
    function s(e) {
      return i < e && r[e - 1]._isValid ? e - 1 : e
    }
    function a(e) {
      return e < o && r[e + 1]._isValid ? e + 1 : e
    }
    var l = [],
      c = [],
      u = 0
    function h(e, t) {
      ;(t = r[e]._controlPoint.clone().lerp(r[t]._controlPoint, -0.25)),
        (e = t.clone().add(r[e]._wingVector))
      ;(c[u] = [t.x, t.y, t.z]),
        (l[u++] = [e.x, e.y, e.z]),
        (c[u] = [t.x, t.y, t.z]),
        (l[u++] = [e.x, e.y, e.z])
    }
    var f,
      d,
      p,
      m,
      y,
      _,
      v,
      g,
      x,
      b,
      w,
      S,
      R = s(e),
      C = a(t)
    if (R === C)
      return (
        (f = c),
        (d = l),
        (p = u),
        (m = r[e]),
        (b = 0 != (m._type.flags & jo.Flags.NUCLEIC)),
        (w = b ? "C5'" : 'N'),
        (S = b ? "C3'" : 'C'),
        m.forEachAtom(function (e) {
          var t = e.getVisualName()
          y || t !== w ? _ || t !== S || (_ = e.position) : (y = e.position)
        }),
        (y && _) || ((y = m._firstAtom.position), (_ = m._lastAtom.position)),
        y &&
          _ &&
          ((g = _.clone().sub(y)),
          (x = m._wingVector),
          (n = (v = m._controlPoint).clone().add(x)),
          (m = (b = v.clone().sub(g)).clone().add(x)),
          (f[p] = [b.x, b.y, b.z]),
          (d[p] = [m.x, m.y, m.z]),
          (f[++p] = [b.x, b.y, b.z]),
          (d[p] = [m.x, m.y, m.z]),
          (f[++p] = [v.x, v.y, v.z]),
          (d[p] = [n.x, n.y, n.z]),
          ++p,
          (x = (g = v.clone().add(g)).clone().add(x)),
          (f[p] = [g.x, g.y, g.z]),
          (d[p] = [x.x, x.y, x.z]),
          (f[++p] = [g.x, g.y, g.z]),
          (d[p] = [x.x, x.y, x.z])),
        { centerPoints: c, topPoints: l }
      )
    e === R ? h(e, a(e)) : (Yo(c, l, u++, r[s(R)]), Yo(c, l, u++, r[R]))
    for (var A = e; A <= t; ++A) Yo(c, l, u++, r[A])
    return (
      C === a(C) ? h(t, s(t)) : (Yo(c, l, u++, r[C]), Yo(c, l, u, r[a(C)])),
      { centerPoints: c, topPoints: l }
    )
  }
  var qo = (function () {
    function s(e, t, r, n, i, o) {
      G(this, s)
      o = Xo(e, t, r, o)
      ;(this._topInterp = Wo(o.topPoints, i)),
        (this._centerInterp = Wo(o.centerPoints, i)),
        (this._shift = 0.5 / (r - t + 2)),
        (this._valueStep = (1 - 2 * this._shift) / (2 * (r - t + 1) * (n - 1))),
        (this._segmentsCount = n)
    }
    return (
      p(s, [
        {
          key: 'prepareMatrices',
          value: function (e, t, r) {
            for (
              var n = this._segmentsCount,
                i = new Array(n),
                o = new ae.Vector2(0, 0),
                s = this._topInterp,
                a = this._centerInterp,
                l = this._shift + this._valueStep * (n - 1) * e,
                c = 0;
              c < n;
              ++c
            ) {
              var u = Math.min(1, c / (n - 1))
              o.lerpVectors(t, r, u)
              var h = s(l, null),
                f = a(l, null),
                u = a((l += this._valueStep), null)
              i[c] = Ho(f.clone(), u.clone(), h.clone().sub(f), o)
            }
            return i
          }
        }
      ]),
      s
    )
  })()
  function $o(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function Zo(e, t, r, n, i, o) {
    for (var s = 0, a = e.length; s < a; ++s)
      for (
        var l = e[s].arr, c = e[s].boundaries, u = 0, h = l.length;
        u < h;
        ++u
      )
        for (
          var f = [l[u].start, l[u].end],
            d = new qo(t, f[0], f[1], r, n, c),
            p = null,
            m = 2 * l[u].start,
            y = 2 * l[u].end + 1,
            _ = i.getResidueRadius(t[0], 0),
            v = m;
          v <= y;
          ++v
        ) {
          var g = t[(v / 2) | 0],
            x = i.getResidueRadius(g, v % 2),
            b = i.getResidueRadius(g, 1 + (v % 2)),
            w = d.prepareMatrices(v - 2 * f[0], x, b)
          w.unshift(null === p ? w[0] : p),
            o(g, w, x.x !== b.x || x.y !== b.y, x.x !== _.x || x.y !== _.y),
            (p = w[r]),
            (_ = b)
        }
  }
  var Ko = (function () {
    x(t, Io)
    var e = $o(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_makeGeoArgs',
          value: function () {
            var e = this._mode.getHeightSegmentsRatio()
            return (
              (this._segmentsHeight = (this._polyComplexity * e) | 0),
              [
                (function (e, t) {
                  for (var r = [], n = 0; n < t; ++n) {
                    var i = Math.PI / 2 - (2 * Math.PI * n) / t
                    r.push(new ae.Vector3(Math.cos(i) * e, Math.sin(i) * e, 0))
                  }
                  return r
                })(1, this._polyComplexity),
                this._segmentsHeight + 1,
                2 * this._selection.chunks.length
              ]
            )
          }
        },
        {
          key: '_build',
          value: function () {
            var e = this._selection,
              t = e.residues,
              o = e.parent,
              r = this._mode,
              s = this._colorer,
              e = r.getTension(),
              a = this._geo,
              l = 0,
              c = []
            Zo(
              this._selection.subdivs,
              t,
              this._segmentsHeight,
              e,
              r,
              function (e, t) {
                var r =
                    2 < arguments.length &&
                    void 0 !== arguments[2] &&
                    arguments[2],
                  n =
                    3 < arguments.length &&
                    void 0 !== arguments[3] &&
                    arguments[3],
                  i = s.getResidueColor(e, o)
                ;(c[l] = e._index), a.setItem(l, t, r, n), a.setColor(l++, i)
              }
            ),
              (this._chunksIdc = c),
              a.finalize()
          }
        },
        {
          key: 'updateToFrame',
          value: function (e) {
            var r = this._selection.parent,
              t = this._mode,
              n = this._colorer,
              i = t.getTension(),
              o = this._geo,
              s = e.getResidues(),
              a = 0,
              l = e.needsColorUpdate(n)
            Zo(
              this._selection.subdivs,
              s,
              this._segmentsHeight,
              i,
              t,
              function (e, t) {
                o.setItem(a, t),
                  l && o.setColor(a, n.getResidueColor(e, r)),
                  a++
              }
            ),
              o.finalize()
          }
        }
      ]),
      t
    )
  })()
  function Qo(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Jo = (function () {
    x(t, lo)
    var e = Qo(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_makeGeoArgs',
          value: function () {
            for (
              var e = this._selection.subdivs, t = 0, r = 0, n = e.length;
              r < n;
              ++r
            )
              for (var i = e[r].arr, o = 0, s = i.length; o < s; ++o)
                t += i[o].end - i[o].start
            return [t, this._polyComplexity]
          }
        },
        {
          key: '_build',
          value: function () {
            for (
              var e = this._selection,
                t = e.residues,
                r = e.parent,
                e = this._mode,
                n = this._colorer,
                i = this._geo,
                o = 0,
                s = [],
                a = this._selection.subdivs,
                l = e.calcStickRadius(),
                c = 0,
                u = a.length;
              c < u;
              ++c
            )
              for (var h = a[c].arr, f = 0, d = h.length; f < d; ++f)
                for (
                  var p = h[f].start, m = h[f].end, y = t[p], _ = p + 1;
                  _ <= m;
                  ++_
                ) {
                  var v = t[_]
                  ;(s[o] = { first: y._index, second: v._index }),
                    i.setItem(o, y._controlPoint, v._controlPoint, l),
                    i.setColor(
                      o,
                      n.getResidueColor(y, r),
                      n.getResidueColor(v, r)
                    ),
                    o++,
                    (y = v)
                }
            ;(this._chunksIdc = s), i.finalize()
          }
        },
        {
          key: 'updateToFrame',
          value: function (e) {
            for (
              var t = e.getResidues(),
                r = this._selection.parent,
                n = this._mode,
                i = this._colorer,
                o = this._geo,
                s = 0,
                a = this._selection.subdivs,
                l = n.calcStickRadius(),
                c = e.needsColorUpdate(i),
                u = 0,
                h = a.length;
              u < h;
              ++u
            )
              for (var f = a[u].arr, d = 0, p = f.length; d < p; ++d)
                for (
                  var m = f[d].start, y = f[d].end, _ = t[m], v = m + 1;
                  v <= y;
                  ++v
                ) {
                  var g = t[v]
                  o.setItem(s, _._controlPoint, g._controlPoint, l),
                    c &&
                      o.setColor(
                        s,
                        i.getResidueColor(_, r),
                        i.getResidueColor(g, r)
                      ),
                    s++,
                    (_ = g)
                }
            o.finalize()
          }
        },
        {
          key: 'raycast',
          value: function (e, t) {
            var r = [],
              n = this._selection.residues
            this._mesh.raycast(e, r)
            for (var i, o, s = this._chunksIdc, a = 0, l = r.length; a < l; ++a)
              r[a].hasOwnProperty('chunkIdx') &&
                ((i = r[a].chunkIdx),
                (o = s[Math.floor(i / 2)]),
                (o = i % 2 == 0 ? o.first : o.second) < n.length &&
                  ((r[a].residue = n[o]), t.push(r[a])))
          }
        },
        {
          key: '_calcChunksList',
          value: function (e) {
            for (
              var t = [],
                r = this._chunksIdc,
                n = this._selection.residues,
                i = 0,
                o = r.length;
              i < o;
              ++i
            ) {
              var s = r[i]
              n[s.first]._mask & e && t.push(2 * i),
                n[s.second]._mask & e && t.push(2 * i + 1)
            }
            return t
          }
        }
      ]),
      t
    )
  })()
  function es(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ts = (function () {
    x(t, lo)
    var e = es(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_makeGeoArgs',
          value: function () {
            for (
              var e = this._mode.drawMultiorderBonds(),
                t = this._mode.showAromaticLoops(),
                r = this._selection.chunks,
                n = this._selection.bonds,
                i = 0,
                o = 0,
                s = r.length;
              o < s;
              ++o
            )
              i += this.getBondOrder(n[r[o]], e, t)
            return [i, this._polyComplexity]
          }
        },
        {
          key: 'getBondOrder',
          value: function (e, t, r) {
            var n = 1
            return (n =
              t && (!r || e._type !== Ae.BondType.AROMATIC)
                ? (e = e._order) < 2
                  ? 1
                  : e
                : n)
          }
        },
        {
          key: 'raycast',
          value: function (e, t) {
            var r = this._selection.bonds,
              n = []
            this._mesh.raycast(e, n)
            for (var i, o, s = this._chunksIdc, a = 0, l = n.length; a < l; ++a)
              n[a].hasOwnProperty('chunkIdx') &&
                ((i = n[a].chunkIdx),
                (o = s[Math.floor(i / 2)]) < r.length &&
                  ((o = r[o]),
                  (n[a].atom = i % 2 == 0 ? o._left : o._right),
                  t.push(n[a])))
          }
        },
        {
          key: '_calcChunksList',
          value: function (e, t) {
            for (
              var r = [],
                n = this._selection.bonds,
                i = this._chunksIdc,
                o = 0,
                s = i.length;
              o < s;
              ++o
            ) {
              var a = n[i[o]]
              a._left.mask & e && (!t || a._right.mask & e) && r.push(2 * o),
                a._right.mask & e &&
                  (!t || a._left.mask & e) &&
                  r.push(2 * o + 1)
            }
            return r
          }
        }
      ]),
      t
    )
  })()
  function rs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function ns(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var is = {
    AtomsSphereGroup: fo,
    AtomsSurfaceGroup: mo,
    AtomsSASSESGroupStub: _o,
    AtomsTextGroup: Ro,
    AromaticTorusGroup: Po,
    AromaticLinesGroup: No,
    NucleicCylindersGroup: Do,
    NucleicSpheresGroup: Uo,
    ResiduesSubseqGroup: Ko,
    ResiduesTraceGroup: Jo,
    BondsCylinderGroup: (function () {
      x(t, ts)
      var e = rs(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_build',
            value: function () {
              for (
                var e = this._selection.chunks,
                  t = this._selection,
                  r = t.bonds,
                  n = t.parent,
                  i = this._mode,
                  o = this._colorer,
                  s = this._geo,
                  a = i.drawMultiorderBonds(),
                  l = i.showAromaticLoops(),
                  c = i.calcStickRadius(),
                  u = i.calcSpaceFraction(),
                  h = new ae.Vector3(),
                  f = new ae.Vector3(),
                  d = 0,
                  p = [],
                  m = 0,
                  y = e.length;
                m < y;
                ++m
              )
                for (
                  var _ = r[e[m]],
                    v = _._left,
                    g = _._right,
                    x = v.position,
                    b = g.position,
                    w = _.calcNormalDir(),
                    S = this.getBondOrder(_, a, l),
                    R =
                      (2 * Math.min(i.calcAtomRadius(v), i.calcAtomRadius(g))) /
                      S,
                    C = a ? Math.min(c, 0.5 * R * (1 - u)) : c,
                    A = 0;
                  A < S;
                  ++A
                ) {
                  var E =
                    R *
                    (S % 2 == 0
                      ? (0.5 + ((A / 2) | 0)) * (1 - (A % 2) * 2)
                      : (((A + 1) / 2) | 0) * ((A % 2) * 2 - 1))
                  ;(p[d] = _._index),
                    h.copy(x),
                    h.addScaledVector(w, E),
                    f.copy(b),
                    f.addScaledVector(w, E),
                    s.setItem(d, h, f, C),
                    s.setColor(d++, o.getAtomColor(v, n), o.getAtomColor(g, n))
                }
              s.finalize(), (this._chunksIdc = p)
            }
          },
          {
            key: 'updateToFrame',
            value: function (e) {
              for (
                var t = this._selection.chunks,
                  r = this._selection.bonds,
                  n = this._mode,
                  i = this._colorer,
                  o = this._geo,
                  s = n.drawMultiorderBonds(),
                  a = n.showAromaticLoops(),
                  l = n.calcStickRadius(),
                  c = n.calcSpaceFraction(),
                  u = new ae.Vector3(),
                  h = new ae.Vector3(),
                  f = 0,
                  d = e.needsColorUpdate(i),
                  p = 0,
                  m = t.length;
                p < m;
                ++p
              )
                for (
                  var y = r[t[p]],
                    _ = y._left,
                    v = y._right,
                    g = e.getAtomPos(_.index).clone(),
                    x = e.getAtomPos(v.index),
                    b = y.calcNormalDir(),
                    w = this.getBondOrder(y, s, a),
                    S =
                      (2 * Math.min(n.calcAtomRadius(_), n.calcAtomRadius(v))) /
                      w,
                    R = s ? Math.min(l, 0.5 * S * (1 - c)) : l,
                    C = 0;
                  C < w;
                  ++C
                ) {
                  var A =
                    S *
                    (w % 2 == 0
                      ? (0.5 + ((C / 2) | 0)) * (1 - (C % 2) * 2)
                      : (((C + 1) / 2) | 0) * ((C % 2) * 2 - 1))
                  u.copy(g),
                    u.addScaledVector(b, A),
                    h.copy(x),
                    h.addScaledVector(b, A),
                    o.setItem(f, u, h, R),
                    d &&
                      o.setColor(f, e.getAtomColor(i, _), e.getAtomColor(i, v)),
                    f++
                }
              o.finalize()
            }
          }
        ]),
        t
      )
    })(),
    BondsLinesGroup: (function () {
      x(t, ts)
      var e = ns(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_build',
            value: function () {
              for (
                var e = this._selection.chunks,
                  t = this._selection,
                  r = t.bonds,
                  n = t.parent,
                  t = this._mode,
                  i = this._colorer,
                  o = this._geo,
                  s = t.drawMultiorderBonds(),
                  a = t.showAromaticLoops(),
                  l = new ae.Vector3(),
                  c = new ae.Vector3(),
                  u = new ae.Vector3(),
                  h = 0,
                  f = [],
                  d = 0,
                  p = e.length;
                d < p;
                ++d
              ) {
                var m = r[e[d]],
                  y = m._left,
                  _ = m._right,
                  v = y.position,
                  g = _.position,
                  x = 1 === y.bonds.length,
                  b = 1 === _.bonds.length
                l.subVectors(g, v)
                for (
                  var w = l.length(),
                    S = m.calcNormalDir(),
                    R = this.getBondOrder(m, s, a),
                    C = 0;
                  C < R;
                  ++C
                ) {
                  c.copy(v), u.copy(g)
                  var A =
                    R % 2 == 0
                      ? (0.5 + ((C / 2) | 0)) * (1 - (C % 2) * 2)
                      : (((C + 1) / 2) | 0) * ((C % 2) * 2 - 1)
                  ;(f[h] = m._index),
                    2 !== R || x || b || ((A -= 0.5), (A *= -1)),
                    !x &&
                      !b &&
                      1 < R &&
                      0 !== A &&
                      (c.lerpVectors(v, g, 0.15 / w),
                      u.lerpVectors(v, g, 1 - 0.15 / w)),
                    (A *= 0.15),
                    c.addScaledVector(S, A),
                    u.addScaledVector(S, A),
                    o.setItem(h, c, u),
                    o.setColor(h++, i.getAtomColor(y, n), i.getAtomColor(_, n))
                }
              }
              o.finalize(), (this._chunksIdc = f)
            }
          },
          {
            key: 'updateToFrame',
            value: function (e) {
              for (
                var t = this._selection.chunks,
                  r = this._selection.bonds,
                  n = this._mode,
                  i = this._colorer,
                  o = this._geo,
                  s = n.drawMultiorderBonds(),
                  a = n.showAromaticLoops(),
                  l = new ae.Vector3(),
                  c = new ae.Vector3(),
                  u = new ae.Vector3(),
                  h = 0,
                  f = e.needsColorUpdate(i),
                  d = 0,
                  p = t.length;
                d < p;
                ++d
              ) {
                var m = r[t[d]],
                  y = m._left,
                  _ = m._right,
                  v = e.getAtomPos(y.index).clone(),
                  g = e.getAtomPos(_.index),
                  x = 1 === y.bonds.length,
                  b = 1 === _.bonds.length
                l.subVectors(g, v)
                for (
                  var w = l.length(),
                    S = m.calcNormalDir(),
                    R = this.getBondOrder(m, s, a),
                    C = 0;
                  C < R;
                  ++C
                ) {
                  c.copy(v), u.copy(g)
                  var A =
                    R % 2 == 0
                      ? (0.5 + ((C / 2) | 0)) * (1 - (C % 2) * 2)
                      : (((C + 1) / 2) | 0) * ((C % 2) * 2 - 1)
                  2 !== R || x || b || ((A -= 0.5), (A *= -1)),
                    !x &&
                      !b &&
                      1 < R &&
                      0 !== A &&
                      (c.lerpVectors(v, g, 0.15 / w),
                      u.lerpVectors(v, g, 1 - 0.15 / w)),
                    (A *= 0.15),
                    c.addScaledVector(S, A),
                    u.addScaledVector(S, A),
                    o.setItem(h, c, u),
                    f &&
                      o.setColor(h, e.getAtomColor(i, y), e.getAtomColor(i, _)),
                    h++
                }
              }
              o.finalize()
            }
          }
        ]),
        t
      )
    })()
  }
  function os(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ss = (function () {
    x(r, mr)
    var t = os(r)
    function r(i, o, s, a, l, c, u, h) {
      G(this, r)
      var e,
        f = S((e = t.call(this)))
      ;(e._complex = s), (e._mode = l)
      var d = s.getAtoms(),
        p = s.getTransforms()
      return (
        s.forEachComponent(function (e) {
          var t,
            r = [],
            n = 0
          e.forEachAtom(function (e) {
            f._checkAtom(e, u) && (r[n++] = e.index)
          }),
            0 !== n &&
              (((t = new i(
                o,
                { atoms: d, chunks: r, parent: s },
                a,
                l,
                p,
                c,
                h
              ))._component = e),
              f.add(t))
        }),
        e
      )
    }
    return (
      p(r, [
        {
          key: '_checkAtom',
          value: function (e, t) {
            return e.mask & t
          }
        },
        {
          key: 'getSubset',
          value: function (e, t) {
            for (
              var r = [], n = this.children, i = 0, o = 0, s = n.length;
              o < s;
              ++o
            )
              if (n[o].getSubset)
                for (
                  var a = n[o].getSubset(e, t), l = 0, c = a.length;
                  l < c;
                  ++l
                ) {
                  var u = a[l]
                  ;(u._component = n[o]._component), (r[i++] = u)
                }
            return r
          }
        }
      ]),
      r
    )
  })()
  function as(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ls = (function () {
    x(t, ss)
    var e = as(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_checkAtom',
          value: function (e, t) {
            if (!(e.mask & t)) return !1
            for (var r = e.bonds, n = 0, i = r.length; n < i; ++n)
              if (r[n]._left.mask & t && r[n]._right.mask & t) return !1
            return !0
          }
        }
      ]),
      t
    )
  })()
  function cs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var us = (function () {
    x(r, mr)
    var t = cs(r)
    function r(i, o, s, a, l, c, u, h) {
      G(this, r)
      var e,
        f = S((e = t.call(this))),
        d = (e._complex = s).getResidues(),
        p = s.getTransforms()
      return (
        s.forEachComponent(function (e) {
          var t,
            r = 0,
            n = []
          e.forEachResidue(function (e) {
            f._checkResidue(e, u) && (n[r++] = e._index)
          }),
            0 !== r &&
              (((t = new i(
                o,
                { residues: d, chunks: n, parent: s },
                a,
                l,
                p,
                c,
                h
              ))._component = e),
              f.add(t))
        }),
        e
      )
    }
    return (
      p(r, [
        {
          key: 'checkResidue',
          value: function (e, t) {
            return e._mask & t
          }
        },
        {
          key: 'getSubset',
          value: function (e, t) {
            for (
              var r = [], n = this.children, i = 0, o = 0, s = n.length;
              o < s;
              ++o
            )
              if (n[o].getSubset)
                for (
                  var a = n[o].getSubset(e, t), l = 0, c = a.length;
                  l < c;
                  ++l
                ) {
                  var u = a[l]
                  ;(u._component = n[o]._component), (r[i++] = u)
                }
            return r
          }
        }
      ]),
      r
    )
  })()
  function hs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function fs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function ds(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function ps(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ms = {
    Atoms: ss,
    OrphanAtoms: ls,
    Residues: us,
    Nucleic: (function () {
      x(t, us)
      var e = hs(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_checkResidue',
            value: function (e, t) {
              return t & e._mask && null !== e._cylinders
            }
          }
        ]),
        t
      )
    })(),
    Subseqs: (function () {
      x(r, mr)
      var t = fs(r)
      function r(f, d, p, m, y, _, v, g) {
        G(this, r)
        var e,
          x = S((e = t.call(this))),
          b = (e._complex = p).getResidues(),
          w = p.getTransforms()
        return (
          p.forEachComponent(function (e) {
            for (
              var t,
                r = e.getMaskedSubdivSequences(v),
                n = 0,
                i = [],
                o = 0,
                s = r.length;
              o < s;
              ++o
            )
              for (var a = r[o].arr, l = 0, c = a.length; l < c; ++l)
                for (var u = a[l].start, h = a[l].end; u <= h; ++u)
                  i[n++] = b[u]._index
            0 !== n &&
              (((t = new f(
                d,
                { residues: b, chunks: i, subdivs: r, parent: p },
                m,
                y,
                w,
                _,
                g
              ))._component = e),
              x.add(t))
          }),
          e
        )
      }
      return (
        p(r, [
          {
            key: 'getSubset',
            value: function (e, t) {
              for (
                var r = [], n = this.children, i = 0, o = 0, s = n.length;
                o < s;
                ++o
              )
                if (n[o].getSubset)
                  for (
                    var a = n[o].getSubset(e, t), l = 0, c = a.length;
                    l < c;
                    ++l
                  ) {
                    var u = a[l]
                    ;(u._component = n[o]._component), (r[i++] = u)
                  }
              return r
            }
          }
        ]),
        r
      )
    })(),
    Bonds: (function () {
      x(n, mr)
      var t = ds(n)
      function n(r, o, s, a, l, c, u, h) {
        G(this, n)
        var e,
          f = S((e = t.call(this))),
          d = (e._complex = s).getBonds(),
          p = s.getTransforms()
        return (
          s.forEachComponent(function (e) {
            var t,
              n = [],
              i = 0
            e.forEachBond(function (e) {
              var t = e._left,
                r = e._right
              t.mask & u && r.mask & u && (n[i++] = e._index)
            }),
              0 !== i &&
                (((t = new r(
                  o,
                  { bonds: d, chunks: n, parent: s },
                  a,
                  l,
                  p,
                  c,
                  h
                ))._component = e),
                f.add(t))
          }),
          e
        )
      }
      return (
        p(n, [
          {
            key: 'getSubset',
            value: function (e, t) {
              for (
                var r = [], n = this.children, i = 0, o = 0, s = n.length;
                o < s;
                ++o
              )
                if (n[o].getSubset)
                  for (
                    var a = n[o].getSubset(e, t), l = 0, c = a.length;
                    l < c;
                    ++l
                  ) {
                    var u = a[l]
                    ;(u._component = n[o]._component), (r[i++] = u)
                  }
              return r
            }
          }
        ]),
        n
      )
    })(),
    Aromatic: (function () {
      x(o, mr)
      var t = ps(o)
      function o(r, n, i, c, u, h, f, d) {
        G(this, o)
        var e,
          p = S((e = t.call(this))),
          m = (e._complex = i).getAtoms(),
          y = i.getTransforms()
        return u.showAromaticLoops()
          ? (i.forEachComponent(function (e) {
              var o = [],
                s = 0,
                a = [],
                l = 0
              e.forEachCycle(function (e) {
                for (var t = e.atoms, r = 0, n = 0, i = t.length; n < i; ++n)
                  0 != (t[n].mask & f) && (++r, (o[s++] = t[n].index))
                0 < r && (a[l++] = e)
              })
              var t = new r(
                n,
                { cycles: a, atoms: m, chunks: o, parent: i },
                c,
                u,
                y,
                h,
                d
              )
              ;(t._component = e), p.add(t)
            }),
            e)
          : R(e)
      }
      return (
        p(o, [
          {
            key: 'getSubset',
            value: function (e, t) {
              for (
                var r = [], n = this.children, i = 0, o = 0, s = n.length;
                o < s;
                ++o
              )
                if (n[o].getSubset)
                  for (
                    var a = n[o].getSubset(e, t), l = 0, c = a.length;
                    l < c;
                    ++l
                  ) {
                    var u = a[l]
                    ;(u._component = n[o]._component), (r[i++] = u)
                  }
              return r
            }
          }
        ]),
        o
      )
    })()
  }
  function ys(s, a, l) {
    return function (e, t, r, n, i, o) {
      return new a(l, s, e, t, r, n, i, o)
    }
  }
  var _s = (function () {
      function e() {
        G(this, e)
      }
      return (
        p(e, null, [
          {
            key: 'AtomsSpheres',
            value: function (e, t) {
              return ys(io.createSpheres(e, t), ms.Atoms, is.AtomsSphereGroup)
            }
          },
          {
            key: 'OrphanedAtomsCrosses',
            value: function (e, t, r) {
              return ys(
                io.createCrosses(e, t, r),
                ms.OrphanAtoms,
                is.AtomsSphereGroup
              )
            }
          },
          {
            key: 'BondsCylinders',
            value: function (e, t) {
              return ys(
                io.create2CCylinders(e, t),
                ms.Bonds,
                is.BondsCylinderGroup
              )
            }
          },
          {
            key: 'BondsLines',
            value: function (e, t, r) {
              return ys(io.create2CLines(e, t, r), ms.Bonds, is.BondsLinesGroup)
            }
          },
          {
            key: 'CartoonChains',
            value: function (e, t) {
              return ys(
                io.createExtrudedChains(e, t),
                ms.Subseqs,
                is.ResiduesSubseqGroup
              )
            }
          },
          {
            key: 'TraceChains',
            value: function (e, t) {
              return ys(
                io.create2CClosedCylinders(e, t),
                ms.Subseqs,
                is.ResiduesTraceGroup
              )
            }
          },
          {
            key: 'NucleicSpheres',
            value: function (e, t) {
              return ys(
                io.createSpheres(e, t),
                ms.Nucleic,
                is.NucleicSpheresGroup
              )
            }
          },
          {
            key: 'NucleicCylinders',
            value: function (e, t) {
              return ys(
                io.create2CCylinders(e, t),
                ms.Nucleic,
                is.NucleicCylindersGroup
              )
            }
          },
          {
            key: 'ALoopsTorus',
            value: function (e, t) {
              return ys(
                io.createExtrudedChains(e, t),
                ms.Aromatic,
                is.AromaticTorusGroup
              )
            }
          },
          {
            key: 'ALoopsLines',
            value: function (e, t, r) {
              return ys(
                io.createChunkedLines(e, t, r),
                ms.Aromatic,
                is.AromaticLinesGroup
              )
            }
          },
          {
            key: 'QuickSurfGeo',
            value: function (e, t, r) {
              return ys(
                io.createQuickSurface(e, t, r),
                ms.Atoms,
                is.AtomsSurfaceGroup
              )
            }
          },
          {
            key: 'ContactSurfaceGeo',
            value: function (e, t, r) {
              return ys(
                io.createContactSurface(e, t, r),
                ms.Atoms,
                is.AtomsSurfaceGroup
              )
            }
          },
          {
            key: 'SASSESSurfaceGeo',
            value: function (e, t, r) {
              return ys(
                io.createSASSES(e, t, r),
                ms.Atoms,
                is.AtomsSASSESGroupStub
              )
            }
          },
          {
            key: 'TextLabelsGeo',
            value: function (e, t) {
              return ys(io.createLabels(e, t), ms.Atoms, is.AtomsTextGroup)
            }
          }
        ]),
        e
      )
    })(),
    vs = (function () {
      function t(e) {
        if ((G(this, t), this.constructor === t))
          throw new Error('Can not instantiate abstract class!')
        this.opts = b.default.merge(
          le.deriveDeep(this.settings.now.modes[this.id], !0),
          e
        )
      }
      return (
        p(t, [
          {
            key: 'identify',
            value: function () {
              var e = le.objectsDiff(
                this.opts,
                this.settings.now.modes[this.id]
              )
              return b.default.isEmpty(e) ? this.id : [this.id, e]
            }
          },
          {
            key: 'buildGeometry',
            value: function (e, t, r, n) {
              for (
                var i = this.opts.polyComplexity
                    ? this.opts.polyComplexity[this.settings.now.resolution]
                    : 0,
                  o = this.depGroups,
                  s = o.length,
                  a = new kr.RCGroup(),
                  l = 0;
                l < s;
                ++l
              ) {
                var c = o[l],
                  u = {}
                b.default.isArray(c) &&
                  ((u = c[1].call(this)), (c = m(c, 1)[0]))
                u = new (_s[c](null, this.settings, u))(e, t, this, i, r, n)
                0 < u.children.length && a.add(u)
              }
              return a
            }
          }
        ]),
        t
      )
    })()
  function gs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function xs() {
    return { lineWidth: this.opts.lineWidth }
  }
  Or(vs.prototype), (vs.prototype.id = '__'), (vs.prototype.depGroups = [])
  var bs = (function () {
    x(o, vs)
    var i = gs(o)
    function o(e) {
      G(this, o), ((e = i.call(this, e)).depGroups = e.depGroups.slice(0))
      for (var t = e.depGroups, r = 0, n = t.length; r < n; ++r)
        t[r] = [t[r], xs]
      return e
    }
    return (
      p(o, [
        {
          key: 'drawMultiorderBonds',
          value: function () {
            return this.opts.multibond
          }
        },
        {
          key: 'calcAtomRadius',
          value: function () {
            return this.opts.atom
          }
        },
        {
          key: 'getAromaticOffset',
          value: function () {
            return this.opts.offsarom
          }
        },
        {
          key: 'getAromaticArcChunks',
          value: function () {
            return this.opts.chunkarom
          }
        },
        {
          key: 'showAromaticLoops',
          value: function () {
            return this.opts.showarom
          }
        }
      ]),
      o
    )
  })()
  function ws(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(bs, 'id', 'LN'),
    (bs.prototype.id = 'LN'),
    (bs.prototype.name = 'Lines'),
    (bs.prototype.shortName = 'Lines'),
    (bs.prototype.depGroups = [
      'ALoopsLines',
      'BondsLines',
      'OrphanedAtomsCrosses'
    ])
  var Ss = (function () {
    x(t, vs)
    var e = ws(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'calcAtomRadius',
          value: function (e) {
            return this.opts.bond
          }
        },
        {
          key: 'calcStickRadius',
          value: function () {
            return this.opts.bond
          }
        },
        {
          key: 'calcSpaceFraction',
          value: function () {
            return this.opts.space
          }
        },
        {
          key: 'getAromRadius',
          value: function () {
            return this.opts.aromrad
          }
        },
        {
          key: 'showAromaticLoops',
          value: function () {
            return this.opts.showarom
          }
        },
        {
          key: 'drawMultiorderBonds',
          value: function () {
            return this.opts.multibond
          }
        }
      ]),
      t
    )
  })()
  function Rs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Ss, 'id', 'LC'),
    (Ss.prototype.id = 'LC'),
    (Ss.prototype.name = 'Licorice'),
    (Ss.prototype.shortName = 'Licorice'),
    (Ss.prototype.depGroups = ['AtomsSpheres', 'BondsCylinders', 'ALoopsTorus'])
  var Cs = (function () {
    x(t, vs)
    var e = Rs(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'calcAtomRadius',
          value: function (e) {
            return e.element.radius * this.opts.atom
          }
        },
        {
          key: 'calcStickRadius',
          value: function () {
            return this.opts.bond
          }
        },
        {
          key: 'getAromRadius',
          value: function () {
            return this.opts.aromrad
          }
        },
        {
          key: 'showAromaticLoops',
          value: function () {
            return this.opts.showarom
          }
        },
        {
          key: 'calcSpaceFraction',
          value: function () {
            return this.opts.space
          }
        },
        {
          key: 'drawMultiorderBonds',
          value: function () {
            return this.opts.multibond
          }
        }
      ]),
      t
    )
  })()
  function As(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Cs, 'id', 'BS'),
    (Cs.prototype.id = 'BS'),
    (Cs.prototype.name = 'Balls and Sticks'),
    (Cs.prototype.shortName = 'Balls'),
    (Cs.prototype.depGroups = ['AtomsSpheres', 'BondsCylinders', 'ALoopsTorus'])
  var Es = (function () {
    x(t, vs)
    var e = As(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'calcAtomRadius',
          value: function (e) {
            return e.element.radius
          }
        }
      ]),
      t
    )
  })()
  function ks(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Es, 'id', 'VW'),
    (Es.prototype.id = 'VW'),
    (Es.prototype.name = 'Van der Waals'),
    (Es.prototype.shortName = 'VDW'),
    (Es.prototype.depGroups = ['AtomsSpheres'])
  var Ts = (function () {
    x(t, vs)
    var e = ks(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'calcStickRadius',
          value: function () {
            return this.opts.radius
          }
        }
      ]),
      t
    )
  })()
  function Ps(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Ts, 'id', 'TR'),
    (Ts.prototype.id = 'TR'),
    (Ts.prototype.name = 'Trace'),
    (Ts.prototype.shortName = 'Trace'),
    (Ts.prototype.depGroups = ['TraceChains'])
  var Ms = (function () {
    x(t, vs)
    var e = Ps(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getResidueRadius',
          value: function (e) {
            return this.TUBE_RADIUS
          }
        },
        {
          key: 'getHeightSegmentsRatio',
          value: function () {
            return this.opts.heightSegmentsRatio
          }
        },
        {
          key: 'getTension',
          value: function () {
            return this.opts.tension
          }
        },
        {
          key: 'buildGeometry',
          value: function (e, t, r, n) {
            var i = this.opts.radius
            return (
              (this.TUBE_RADIUS = new ae.Vector2(i, i)),
              vs.prototype.buildGeometry.call(this, e, t, r, n)
            )
          }
        }
      ]),
      t
    )
  })()
  function Ns(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Ms, 'id', 'TU'),
    (Ms.prototype.id = 'TU'),
    (Ms.prototype.name = 'Tube'),
    (Ms.prototype.shortName = 'Tube'),
    (Ms.prototype.depGroups = ['CartoonChains'])
  var Ls = (function () {
    x(r, vs)
    var t = Ns(r)
    function r(e) {
      return G(this, r), ((e = t.call(this, e)).secCache = {}), e
    }
    return (
      p(r, [
        {
          key: 'getResidueStartRadius',
          value: function (e) {
            var t = e.getSecondary()
            if (!t || !t.generic) return this.TUBE_RADIUS
            var r = this.secCache[t.generic]
            return r ? (t.term === e ? r.start : r.center) : this.TUBE_RADIUS
          }
        },
        {
          key: 'getResidueEndRadius',
          value: function (e) {
            var t = e.getSecondary()
            if (null === t || !t.generic) return this.TUBE_RADIUS
            var r = this.secCache[t.generic]
            return r
              ? t.term === e
                ? this.ARROW_END
                : r.center
              : this.TUBE_RADIUS
          }
        },
        {
          key: 'getResidueRadius',
          value: function (e, t) {
            var r = this.getResidueStartRadius(e)
            if (0 === t) return r
            e = this.getResidueEndRadius(e)
            return 2 === t ? e : r.clone().lerp(e, t / 2)
          }
        },
        {
          key: 'calcStickRadius',
          value: function (e) {
            return this.opts.radius
          }
        },
        {
          key: 'getHeightSegmentsRatio',
          value: function () {
            return this.opts.heightSegmentsRatio
          }
        },
        {
          key: 'getTension',
          value: function () {
            return this.opts.tension
          }
        },
        {
          key: 'buildGeometry',
          value: function (e, t, r, n) {
            var i = this.opts.radius,
              o = this.opts.depth
            ;(this.TUBE_RADIUS = new ae.Vector2(i, i)),
              (this.ARROW_END = new ae.Vector2(o, i))
            var s,
              a = {},
              l = this.opts.ss
            for (s in l)
              a[s] = {
                center: new ae.Vector2(o, l[s].width),
                start: new ae.Vector2(o, l[s].arrow)
              }
            return (
              (this.secCache = a),
              vs.prototype.buildGeometry.call(this, e, t, r, n)
            )
          }
        }
      ]),
      r
    )
  })()
  function Is(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Ls, 'id', 'CA'),
    (Ls.prototype.id = 'CA'),
    (Ls.prototype.name = 'Cartoon'),
    (Ls.prototype.shortName = 'Cartoon'),
    (Ls.prototype.depGroups = [
      'CartoonChains',
      'NucleicSpheres',
      'NucleicCylinders'
    ])
  var Os = hr.selectors
  function Bs() {
    return { wireframe: this.opts.wireframe, zClip: this.opts.zClip }
  }
  var Vs = (function () {
    x(s, vs)
    var o = Is(s)
    function s(e) {
      G(this, s), ((e = o.call(this, e)).depGroups = e.depGroups.slice(0))
      for (
        var t = e.surfaceNames, r = e.depGroups, n = 0, i = t.length;
        n < i;
        ++n
      )
        r[r.length] = [t[n], Bs]
      return e
    }
    return (
      p(s, [
        {
          key: 'calcAtomRadius',
          value: function (e) {
            return e.element.radius
          }
        },
        {
          key: 'getVisibilitySelector',
          value: function () {
            var e,
              t = null
            return (
              '' !== this.opts.subset &&
                ((e = Os.parse(this.opts.subset)).error || (t = e.selector)),
              t
            )
          }
        }
      ]),
      s
    )
  })()
  function Ds(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(Vs.prototype.isSurface = !0), (Vs.prototype.surfaceNames = [])
  var zs = (function () {
    x(t, Vs)
    var e = Ds(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getSurfaceOpts',
          value: function () {
            return {
              useBeads: !1,
              isoValue: this.opts.isoValue,
              gaussLim: this.opts.gaussLim[this.settings.now.resolution],
              radScale: this.opts.scale,
              gridSpacing: this.opts.gridSpacing[this.settings.now.resolution],
              zClip: this.opts.zClip,
              visibilitySelector: this.getVisibilitySelector()
            }
          }
        }
      ]),
      t
    )
  })()
  function Fs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(zs, 'id', 'QS'),
    (zs.prototype.id = 'QS'),
    (zs.prototype.name = 'Quick Surface'),
    (zs.prototype.shortName = 'Quick Surf'),
    (zs.prototype.surfaceNames = ['QuickSurfGeo'])
  var Us = (function () {
    x(n, Vs)
    var r = Fs(n)
    function n(e, t) {
      return G(this, n), ((t = r.call(this, t))._excludeProbe = e), t
    }
    return (
      p(n, [
        {
          key: 'calcAtomRadius',
          value: function (e) {
            return e.element.radius
          }
        },
        {
          key: 'getSurfaceOpts',
          value: function () {
            return {
              gridSpacing:
                this.opts.polyComplexity[this.settings.now.resolution],
              radScale: this._radScale,
              zClip: this.opts.zClip,
              visibilitySelector: this.getVisibilitySelector(),
              probeRadius: this.opts.probeRadius,
              excludeProbe: this._excludeProbe
            }
          }
        }
      ]),
      n
    )
  })()
  function Gs(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(Us.prototype.id = 'SU'),
    (Us.prototype.name = 'Surface'),
    (Us.prototype.shortName = 'Surface'),
    (Us.prototype.surfaceNames = ['SASSESSurfaceGeo']),
    (Us.prototype._radScale = 1),
    (Us.prototype._excludeProbe = !1)
  e = (function () {
    x(r, Us)
    var t = Gs(r)
    function r(e) {
      return G(this, r), t.call(this, !1, e)
    }
    return p(r)
  })()
  function js(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(e, 'id', 'SA'),
    (e.prototype.id = 'SA'),
    (e.prototype.name = 'Solvent Accessible Surface'),
    (e.prototype.shortName = 'SAS')
  var Hs = (function () {
    x(r, Us)
    var t = js(r)
    function r(e) {
      return G(this, r), t.call(this, !0, e)
    }
    return p(r)
  })()
  function Ws(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Hs, 'id', 'SE'),
    (Hs.prototype.id = 'SE'),
    (Hs.prototype.name = 'Solvent Excluded Surface'),
    (Hs.prototype.shortName = 'SES')
  Re = (function () {
    x(t, Vs)
    var e = Ws(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getSurfaceOpts',
          value: function () {
            return {
              probeRadius: this.opts.probeRadius,
              radScale: this.opts.polyComplexity[this.settings.now.resolution],
              scaleFactor:
                this.opts.polyComplexity[this.settings.now.resolution],
              gridSpacing:
                1 / this.opts.polyComplexity[this.settings.now.resolution],
              isoValue: this.opts.isoValue,
              probePositions: this.opts.probePositions,
              zClip: this.opts.zClip,
              visibilitySelector: this.getVisibilitySelector()
            }
          }
        }
      ]),
      t
    )
  })()
  function Ys(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Re, 'id', 'CS'),
    (Re.prototype.id = 'CS'),
    (Re.prototype.name = 'Contact Surface'),
    (Re.prototype.shortName = 'Contact Surf'),
    (Re.prototype.isSurface = !0),
    (Re.prototype.surfaceNames = ['ContactSurfaceGeo'])
  Oe = (function () {
    x(t, vs)
    var e = Ys(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getTemplateOptions',
          value: function () {
            return this.opts.template
          }
        },
        {
          key: 'getLabelOpts',
          value: function () {
            return b.default.merge(this.opts, {
              colors: !0,
              adjustColor: !0,
              transparent: !0
            })
          }
        }
      ]),
      t
    )
  })()
  be(Oe, 'id', 'TX'),
    (Oe.prototype.id = 'TX'),
    (Oe.prototype.name = 'Text mode'),
    (Oe.prototype.shortName = 'Text'),
    (Oe.prototype.depGroups = ['TextLabelsGeo'])
  var Xs = new Ir([bs, Ss, Cs, Es, Ts, Ms, Ls, zs, e, Hs, Re, Oe])
  function qs(e, t, r) {
    return e <= r ? (e < 0 ? 0 : e) : r
  }
  Ue = (function () {
    function r(e, t) {
      G(this, r), (this.name = e || 'Custom'), (this.id = t || 'CP')
    }
    return (
      p(r, [
        {
          key: 'getElementColor',
          value: function (e) {
            e = this.elementColors[e]
            return void 0 !== e ||
              (1 < arguments.length && void 0 !== arguments[1] && arguments[1])
              ? e
              : this.defaultElementColor
          }
        },
        {
          key: 'getResidueColor',
          value: function (e) {
            e = this.residueColors[e]
            return void 0 !== e ||
              (1 < arguments.length && void 0 !== arguments[1] && arguments[1])
              ? e
              : this.defaultResidueColor
          }
        },
        {
          key: 'getChainColor',
          value: function (e) {
            e =
              (31 & ((e = e.charCodeAt(0)) < 0 ? 0 : 256 <= e ? e - 256 : e)) %
              this.chainColors.length
            return this.chainColors[e]
          }
        },
        {
          key: 'getSecondaryColor',
          value: function (e) {
            e = this.secondaryColors[e]
            return void 0 !== e ||
              (1 < arguments.length && void 0 !== arguments[1] && arguments[1])
              ? e
              : this.defaultSecondaryColor
          }
        },
        {
          key: 'getSequentialColor',
          value: function (e) {
            var t = this.colors,
              r = t.length
            return e < 0 ? t[(e % r) + r] : t[e % r]
          }
        },
        {
          key: 'getGradientColor',
          value: function (e, t) {
            var r = this.gradients[t]
            if (!r) return this.defaultNamedColor
            var n = r.length,
              i = e * (n - 1),
              e = qs((t = Math.floor(i)) + 1, 0, n - 1),
              t = qs(t, 0, n - 1)
            return (
              (n = r[t]),
              (e = r[e]),
              (((t = 1 - (i = i - t)) * ((n >> 16) & 255) +
                i * ((e >> 16) & 255)) <<
                16) |
                ((t * ((n >> 8) & 255) + i * ((e >> 8) & 255)) << 8) |
                (t * (255 & n) + i * (255 & e))
            )
          }
        },
        {
          key: 'getNamedColor',
          value: function (e) {
            e = this.namedColors[e]
            return void 0 !== e ||
              (1 < arguments.length && void 0 !== arguments[1] && arguments[1])
              ? e
              : this.defaultNamedColor
          }
        }
      ]),
      r
    )
  })()
  b.default.assign(Ue.prototype, {
    colors: [16777215, 16711680, 65280, 255, 8421504],
    minRangeColor: 0,
    midRangeColor: 8355711,
    maxRangeColor: 16777215,
    defaultElementColor: 16777215,
    elementColors: {},
    defaultResidueColor: 16777215,
    residueColors: {},
    chainColors: [16777215],
    defaultSecondaryColor: 16777215,
    secondaryColors: {},
    defaultGradientColor: 0,
    defaultNamedColor: 16777215,
    namedColorsArray: [
      ['indianred', 13458524],
      ['lightcoral', 15761536],
      ['salmon', 16416882],
      ['darksalmon', 15308410],
      ['lightsalmon', 16752762],
      ['crimson', 14423100],
      ['red', 16711680],
      ['firebrick', 11674146],
      ['darkred', 9109504],
      ['pink', 16761035],
      ['lightpink', 16758465],
      ['hotpink', 16738740],
      ['deeppink', 16716947],
      ['mediumvioletred', 13047173],
      ['palevioletred', 14381203],
      ['coral', 16744272],
      ['tomato', 16737095],
      ['orangered', 16729344],
      ['darkorange', 16747520],
      ['orange', 16753920],
      ['gold', 16766720],
      ['yellow', 16776960],
      ['lightyellow', 16777184],
      ['lemonchiffon', 16775885],
      ['lightgoldenrodyellow', 16448210],
      ['papayawhip', 16773077],
      ['moccasin', 16770229],
      ['peachpuff', 16767673],
      ['palegoldenrod', 15657130],
      ['khaki', 15787660],
      ['darkkhaki', 12433259],
      ['lavender', 15132410],
      ['thistle', 14204888],
      ['plum', 14524637],
      ['violet', 15631086],
      ['orchid', 14315734],
      ['fuchsia', 16711935],
      ['magenta', 16711935],
      ['mediumorchid', 12211667],
      ['mediumpurple', 9662683],
      ['rebeccapurple', 6697881],
      ['blueviolet', 9055202],
      ['darkviolet', 9699539],
      ['darkorchid', 10040012],
      ['darkmagenta', 9109643],
      ['purple', 8388736],
      ['indigo', 4915330],
      ['slateblue', 6970061],
      ['mediumslateblue', 8087790],
      ['darkslateblue', 4734347],
      ['greenyellow', 11403055],
      ['chartreuse', 8388352],
      ['lawngreen', 8190976],
      ['lime', 65280],
      ['limegreen', 3329330],
      ['palegreen', 10025880],
      ['lightgreen', 9498256],
      ['mediumspringgreen', 64154],
      ['springgreen', 65407],
      ['mediumseagreen', 3978097],
      ['seagreen', 3050327],
      ['forestgreen', 2263842],
      ['green', 32768],
      ['darkgreen', 25600],
      ['yellowgreen', 10145074],
      ['olivedrab', 7048739],
      ['olive', 8421376],
      ['darkolivegreen', 5597999],
      ['mediumaquamarine', 6737322],
      ['darkseagreen', 9419919],
      ['lightseagreen', 2142890],
      ['darkcyan', 35723],
      ['teal', 32896],
      ['aqua', 65535],
      ['cyan', 65535],
      ['lightcyan', 14745599],
      ['paleturquoise', 11529966],
      ['aquamarine', 8388564],
      ['turquoise', 4251856],
      ['mediumturquoise', 4772300],
      ['darkturquoise', 52945],
      ['cadetblue', 6266528],
      ['steelblue', 4620980],
      ['lightsteelblue', 11584734],
      ['powderblue', 11591910],
      ['lightblue', 11393254],
      ['skyblue', 8900331],
      ['lightskyblue', 8900346],
      ['deepskyblue', 49151],
      ['dodgerblue', 2003199],
      ['cornflowerblue', 6591981],
      ['royalblue', 4286945],
      ['blue', 255],
      ['mediumblue', 205],
      ['darkblue', 139],
      ['navy', 128],
      ['midnightblue', 1644912],
      ['cornsilk', 16775388],
      ['blanchedalmond', 16772045],
      ['bisque', 16770244],
      ['navajowhite', 16768685],
      ['wheat', 16113331],
      ['burlywood', 14596231],
      ['tan', 13808780],
      ['rosybrown', 12357519],
      ['sandybrown', 16032864],
      ['goldenrod', 14329120],
      ['darkgoldenrod', 12092939],
      ['peru', 13468991],
      ['chocolate', 13789470],
      ['saddlebrown', 9127187],
      ['sienna', 10506797],
      ['brown', 10824234],
      ['maroon', 8388608],
      ['white', 16777215],
      ['snow', 16775930],
      ['honeydew', 15794160],
      ['mintcream', 16121850],
      ['azure', 15794175],
      ['aliceblue', 15792383],
      ['ghostwhite', 16316671],
      ['whitesmoke', 16119285],
      ['seashell', 16774638],
      ['beige', 16119260],
      ['oldlace', 16643558],
      ['floralwhite', 16775920],
      ['ivory', 16777200],
      ['antiquewhite', 16444375],
      ['linen', 16445670],
      ['lavenderblush', 16773365],
      ['mistyrose', 16770273],
      ['gainsboro', 14474460],
      ['lightgray', 13882323],
      ['silver', 12632256],
      ['darkgray', 11119017],
      ['gray', 8421504],
      ['dimgray', 6908265],
      ['lightslategray', 7833753],
      ['slategray', 7372944],
      ['darkslategray', 3100495],
      ['black', 0]
    ],
    namedColors: {},
    gradients: {
      rainbow: [255, 65535, 65280, 16776960, 16711680],
      temp: [255, 32767, 16777215, 16744192, 16711680],
      hot: [16777215, 16744192, 16711680],
      cold: [16777215, 32767, 255],
      'blue-red': [255, 16777215, 16711680],
      reds: [16777215, 16711680],
      blues: [16777215, 255]
    }
  })
  for (
    var Ge = Ue.prototype,
      $s = Ge.namedColorsArray,
      Zs = Ge.namedColors,
      Ks = 0,
      Qs = $s.length;
    Ks < Qs;
    ++Ks
  ) {
    var Js = m($s[Ks], 2),
      ea = Js[0],
      Js = Js[1]
    Zs[ea] = Js
  }
  var ta = new Ue('CPK', 'CP')
  ta.elementColors = {
    H: 16777215,
    C: 2105376,
    N: 2121983,
    O: 15605776,
    F: 65280,
    P: 8397055,
    S: 16776960,
    CL: 47872,
    FE: 13684944,
    CO: 13684944,
    NI: 13684944,
    CU: 13684944,
    BR: 34816,
    I: 21760
  }
  He = new Ue('Jmol', 'JM')
  ;(He.colors = [
    255, 22015, 44031, 65535, 65451, 65365, 65280, 5635840, 11271936, 16776960,
    16755456, 16733440, 16711680, 16711765, 16711851, 16711935, 11206911,
    5570815
  ]),
    (He.elementColors = {
      H: 16777215,
      D: 16777152,
      T: 16777120,
      HE: 14286847,
      LI: 13402367,
      BE: 12779264,
      B: 16758197,
      C: 9474192,
      N: 3166456,
      O: 16715021,
      F: 9494608,
      NE: 11789301,
      NA: 11230450,
      MG: 9109248,
      AL: 12560038,
      SI: 1578e4,
      P: 16744448,
      S: 16777008,
      CL: 2093087,
      AR: 8442339,
      K: 9388244,
      CA: 4062976,
      SC: 15132390,
      TI: 12567239,
      V: 10921643,
      CR: 9083335,
      MN: 10255047,
      FE: 14706227,
      CO: 15765664,
      NI: 5296208,
      CU: 13140019,
      ZN: 8224944,
      GA: 12750735,
      GE: 6721423,
      AS: 12419299,
      SE: 16752896,
      BR: 10889513,
      KR: 6076625,
      RB: 7351984,
      SR: 65280,
      Y: 9764863,
      ZR: 9756896,
      NB: 7586505,
      MO: 5551541,
      TC: 3907230,
      RU: 2396047,
      RH: 687500,
      PD: 27013,
      AG: 12632256,
      CD: 16767375,
      IN: 10909043,
      SN: 6717568,
      SB: 10380213,
      TE: 13924864,
      I: 9699476,
      XE: 4366e3,
      CS: 5707663,
      BA: 51456,
      LA: 7394559,
      CE: 16777159,
      PR: 14286791,
      ND: 13107143,
      PM: 10747847,
      SM: 9437127,
      EU: 6422471,
      GD: 4587463,
      TB: 3211207,
      DY: 2097095,
      HO: 65436,
      ER: 58997,
      TM: 54354,
      YB: 48952,
      LU: 43812,
      HF: 5096191,
      TA: 5089023,
      W: 2200790,
      RE: 2522539,
      OS: 2516630,
      IR: 1528967,
      PT: 13684960,
      AU: 16765219,
      HG: 12105936,
      TL: 10900557,
      PB: 5724513,
      BI: 10375093,
      PO: 11230208,
      AT: 7688005,
      RN: 4358806,
      FR: 4325478,
      RA: 32e3,
      AC: 7384058,
      TH: 47871,
      PA: 41471,
      U: 36863,
      NP: 33023,
      PU: 27647,
      AM: 5528818,
      CM: 7888099,
      BK: 9064419,
      CF: 10565332,
      ES: 11739092,
      FM: 11739066,
      MD: 11734438,
      NO: 12389767,
      LR: 13041766,
      RF: 13369433,
      DB: 13697103,
      SG: 14221381,
      BH: 14680120,
      HS: 15073326,
      MT: 15400998
    }),
    (He.defaultResidueColor = 12492910),
    (He.residueColors = {
      ALA: 13158600,
      ARG: 1334015,
      ASN: 56540,
      ASP: 15075850,
      CYS: 15132160,
      GLN: 56540,
      GLU: 15075850,
      GLY: 15461355,
      HIS: 8553170,
      ILE: 1016335,
      LEU: 1016335,
      LYS: 1334015,
      MET: 15132160,
      PHE: 3289770,
      PRO: 14456450,
      SER: 16422400,
      THR: 16422400,
      TRP: 11819700,
      TYR: 3289770,
      VAL: 1016335,
      A: 10526975,
      C: 16747595,
      G: 16740464,
      I: 8454143,
      T: 10551200,
      U: 16744576,
      DA: 10526975,
      DC: 16747595,
      DG: 16740464,
      DI: 8454143,
      DT: 10551200,
      DU: 16744576,
      '+A': 10526975,
      '+C': 16747595,
      '+G': 16740464,
      '+I': 8454143,
      '+T': 10551200,
      '+U': 16744576
    }),
    (He.chainColors = [
      4294967295, 4290826495, 4289789872, 4294951112, 4294967168, 4294951167,
      4289786096, 4294955120, 4293951616, 4294303411, 4278239231, 4291648604,
      4284927402, 4288335154, 4293821166, 4278243025, 4278255487, 4282168177,
      4278190219, 4290623339, 4278215680, 4286578688, 4286611456, 4286578816,
      4278222976, 4290283019, 4289864226
    ])
  var ra = Fe.Type
  He.secondaryColors =
    (be((vd = {}), ra.HELIX_ALPHA, 16711808),
    be(vd, ra.HELIX_PI, 6291584),
    be(vd, ra.HELIX_310, 10485888),
    be(vd, ra.STRAND, 16762880),
    be(vd, ra.TURN, 6324479),
    be(vd, 'dna', 11403518),
    be(vd, 'rna', 16580962),
    vd)
  var na = new Ue('VMD', 'VM')
  ;(na.colors = [
    255, 16711680, 6316128, 16744448, 16776960, 8421427, 10066329, 65280,
    16777215, 16751001, 4243648, 10879142, 8447590, 15099571, 8408320, 8421568
  ]),
    (na.defaultElementColor = 8408320),
    (na.elementColors = {
      H: 16777215,
      C: 4243391,
      N: 255,
      O: 16711680,
      P: 8421427,
      S: 16776960
    }),
    (na.defaultResidueColor = 4243648),
    (na.residueColors = {
      ALA: 255,
      ARG: 16777215,
      ASN: 8421427,
      ASP: 16711680,
      CYS: 16776960,
      GLN: 16744448,
      GLU: 16751001,
      GLY: 16777215,
      HIS: 4243648,
      ILE: 65280,
      LEU: 16751001,
      LYS: 4243648,
      MET: 16776960,
      PHE: 10879142,
      PRO: 8408064,
      SER: 16776960,
      THR: 15099571,
      TRP: 10066329,
      TYR: 65280,
      VAL: 8421427,
      A: 255,
      C: 16744448,
      G: 16776960,
      T: 10879142,
      U: 65280,
      DA: 255,
      DC: 16744448,
      DG: 16776960,
      DT: 10879142,
      DU: 65280,
      '+A': 255,
      '+C': 16744448,
      '+G': 16776960,
      '+T': 10879142,
      '+U': 65280,
      WAT: 4243648,
      H2O: 4243648,
      HOH: 4243648
    }),
    (na.chainColors = [16777215].concat(na.colors))
  var ia = Fe.Type
  na.secondaryColors =
    (be((gd = {}), ia.HELIX_ALPHA, 10879142),
    be(gd, ia.HELIX_310, 255),
    be(gd, ia.HELIX_PI, 16711680),
    be(gd, ia.STRAND, 16776960),
    be(gd, ia.BRIDGE, 8421427),
    be(gd, ia.TURN, 4243648),
    gd)
  var oa = new Ir([ta, He, na]),
    sa = (function () {
      function t(e) {
        if ((G(this, t), this.constructor === t))
          throw new Error('Can not instantiate abstract class!')
        ;(this.opts = b.default.merge(
          le.deriveDeep(Q.now.colorers[this.id], !0),
          e
        )),
          (this.palette = oa.first)
      }
      return (
        p(t, [
          {
            key: 'identify',
            value: function () {
              var e = le.objectsDiff(this.opts, Q.now.colorers[this.id])
              return b.default.isEmpty(e) ? this.id : [this.id, e]
            }
          }
        ]),
        t
      )
    })()
  function aa(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  sa.prototype.id = '__'
  var la = (function () {
    x(t, sa)
    var e = aa(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            e = e.element.name
            return 'C' === e && 0 <= this.opts.carbon
              ? this.opts.carbon
              : this.palette.getElementColor(e)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            return this.palette.defaultResidueColor
          }
        }
      ]),
      t
    )
  })()
  function ca(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(la, 'id', 'EL'),
    (la.prototype.id = 'EL'),
    (la.prototype.name = 'Element'),
    (la.prototype.shortName = 'Element')
  var ua = (function () {
    x(t, sa)
    var e = ca(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.getResidueColor(e.residue, t)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            return this.palette.getResidueColor(e._type._name)
          }
        }
      ]),
      t
    )
  })()
  function ha(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(ua, 'id', 'RT'),
    (ua.prototype.id = 'RT'),
    (ua.prototype.name = 'Residue Type'),
    (ua.prototype.shortName = 'Residue')
  var fa = (function () {
    x(t, sa)
    var e = ha(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.getResidueColor(e.residue, t)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            var r = e._chain
            if (
              r.minSequence === Number.POSITIVE_INFINITY &&
              r.maxSequence === Number.NEGATIVE_INFINITY
            )
              return this.palette.defaultNamedColor
            var n = r.minSequence,
              r = r.maxSequence > n ? r.maxSequence : n + 1
            return this.palette.getGradientColor(
              (e._sequence - n) / (r - n),
              this.opts.gradient
            )
          }
        }
      ]),
      t
    )
  })()
  function da(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(fa, 'id', 'SQ'),
    (fa.prototype.id = 'SQ'),
    (fa.prototype.name = 'Sequence'),
    (fa.prototype.shortName = 'Sequence')
  var pa = (function () {
    x(t, sa)
    var e = da(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.getResidueColor(e.residue, t)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            return this.palette.getChainColor(e.getChain()._name)
          }
        }
      ]),
      t
    )
  })()
  function ma(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(pa, 'id', 'CH'),
    (pa.prototype.id = 'CH'),
    (pa.prototype.name = 'Chain'),
    (pa.prototype.shortName = 'Chain')
  var ya = (function () {
    x(t, sa)
    var e = ma(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.getResidueColor(e.residue, t)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            if (e._type.flags & Le.Flags.DNA)
              return this.palette.getSecondaryColor('dna')
            if (e._type.flags & Le.Flags.RNA)
              return this.palette.getSecondaryColor('rna')
            var r = e.getSecondary()
            if (r) {
              e = this.palette.getSecondaryColor(r.type, !0)
              return (e =
                void 0 === e ? this.palette.getSecondaryColor(r.generic) : e)
            }
            return this.palette.defaultSecondaryColor
          }
        }
      ]),
      t
    )
  })()
  function _a(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(ya, 'id', 'SS'),
    (ya.prototype.id = 'SS'),
    (ya.prototype.name = 'Secondary Structure'),
    (ya.prototype.shortName = 'Structure')
  var va = (function () {
    x(t, sa)
    var e = _a(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.opts.color
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            return this.opts.color
          }
        }
      ]),
      t
    )
  })()
  function ga(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(va, 'id', 'UN'),
    (va.prototype.id = 'UN'),
    (va.prototype.name = 'Uniform'),
    (va.prototype.shortName = 'Uniform')
  var xa = (function () {
    x(n, sa)
    var r = ga(n)
    function n(e) {
      G(this, n)
      var t = r.call(this, e),
        e = Ct.parse(t.opts.subset)
      return (t._subsetCached = e.error ? Ct.none() : e.selector), t
    }
    return (
      p(n, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this._subsetCached.includesAtom(e)
              ? this.opts.color
              : this.opts.baseColor
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            for (
              var r = this._subsetCached, n = e._atoms, i = 0, o = n.length;
              i < o;
              ++i
            )
              if (!r.includesAtom(n[i])) return this.opts.baseColor
            return this.opts.color
          }
        }
      ]),
      n
    )
  })()
  function ba(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(xa, 'id', 'CO'),
    (xa.prototype.id = 'CO'),
    (xa.prototype.name = 'Conditional'),
    (xa.prototype.shortName = 'Conditional')
  var wa = (function () {
    x(t, sa)
    var e = ba(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.palette.getChainColor(String.fromCharCode(e.location))
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            return this.palette.defaultResidueColor
          }
        }
      ]),
      t
    )
  })()
  function Sa(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(wa, 'id', 'CF'),
    (wa.prototype.id = 'CF'),
    (wa.prototype.name = 'Conformation'),
    (wa.prototype.shortName = 'Conformation')
  var Ra = (function () {
    x(t, sa)
    var e = Sa(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            var r = this.opts,
              n = 1
            return e.temperature && r
              ? ((n =
                  r.min === r.max
                    ? e.temperature > r.max
                      ? 1
                      : 0
                    : (e.temperature - r.min) / (r.max - r.min)),
                this.palette.getGradientColor(n, r.gradient))
              : this.palette.defaultGradientColor
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            var r = this.opts
            if (!r) return this.palette.defaultGradientColor
            if (e.temperature) {
              var n = 0,
                n =
                  r.min === r.max
                    ? e.temperature > r.max
                      ? 1
                      : 0
                    : (e.temperature - r.min) / (r.max - r.min)
              return this.palette.getGradientColor(n, r.gradient)
            }
            return this.palette.defaultGradientColor
          }
        }
      ]),
      t
    )
  })()
  function Ca(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Ra, 'id', 'TM'),
    (Ra.prototype.id = 'TM'),
    (Ra.prototype.name = 'Temperature'),
    (Ra.prototype.shortName = 'Temperature')
  var Aa = (function () {
    x(t, sa)
    var e = Ca(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: '_getColorByOccupancy',
          value: function (e, t) {
            return void 0 === e
              ? this.palette.defaultGradientColor
              : this.palette.getGradientColor(1 - e, t.gradient)
          }
        },
        {
          key: 'getAtomColor',
          value: function (e, t) {
            var r = this.opts
            return this._getColorByOccupancy(e.occupancy, r)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            var r = this.opts
            return this._getColorByOccupancy(e.occupancy, r)
          }
        }
      ]),
      t
    )
  })()
  function Ea(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(Aa, 'id', 'OC'),
    (Aa.prototype.id = 'OC'),
    (Aa.prototype.name = 'Occupancy'),
    (Aa.prototype.shortName = 'Occupancy')
  pt = (function () {
    x(t, sa)
    var e = Ea(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.getResidueColor(e.residue, t)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            var r = this.palette.defaultResidueColor
            return (
              void 0 !== e._type.hydrophobicity &&
                (r = this.palette.getGradientColor(
                  (e._type.hydrophobicity - -4.5) / 9,
                  this.opts.gradient
                )),
              r
            )
          }
        }
      ]),
      t
    )
  })()
  function ka(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(pt, 'id', 'HY'),
    (pt.prototype.id = 'HY'),
    (pt.prototype.name = 'Hydrophobicity'),
    (pt.prototype.shortName = 'Hydrophobicity')
  dt = (function () {
    x(t, sa)
    var e = ka(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return this.getResidueColor(e.residue, t)
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            ;(e = e._molecule), (t = t.getMoleculeCount())
            return 1 < t
              ? this.palette.getGradientColor(
                  (e.index - 1) / (t - 1),
                  this.opts.gradient
                )
              : this.palette.getGradientColor(0, this.opts.gradient)
          }
        }
      ]),
      t
    )
  })()
  function Ta(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(dt, 'id', 'MO'),
    (dt.prototype.id = 'MO'),
    (dt.prototype.name = 'Molecule'),
    (dt.prototype.shortName = 'Molecule')
  nt = (function () {
    x(t, sa)
    var e = Ta(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(t, [
        {
          key: 'getAtomColor',
          value: function (e, t) {
            var r = this.opts.color,
              n =
                (((n = this.opts.factor) * ((r >> 16) & 255)) << 16) |
                ((n * ((r >> 8) & 255)) << 8) |
                (n * (255 & r))
            return e.flags & we.Flags.CARBON ? r : n
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            return this.opts.color
          }
        }
      ]),
      t
    )
  })()
  be(nt, 'id', 'CB'),
    (nt.prototype.id = 'CB'),
    (nt.prototype.name = 'Carbon'),
    (nt.prototype.shortName = 'Carbon')
  var Pa = new Ir([la, ua, fa, pa, ya, va, xa, wa, Ra, Aa, pt, dt, nt])
  function Ma(e) {
    return new ae.Color(e, e, e)
  }
  var Na,
    La,
    Ia,
    Oa = [
      {
        id: 'DF',
        name: 'Diffuse',
        shortName: 'Diffuse',
        uberOptions: {
          diffuse: Ma(1),
          specular: Ma(0),
          shininess: 1,
          opacity: 1
        },
        values: {
          lights: !0,
          fog: !0,
          depthWrite: !0,
          transparent: !1,
          toonShading: !1
        }
      },
      {
        id: 'SF',
        name: 'Soft Plastic',
        shortName: 'Soft',
        uberOptions: {
          diffuse: Ma(1),
          specular: Ma(0.1),
          shininess: 30,
          opacity: 1
        },
        values: {
          lights: !0,
          fog: !0,
          depthWrite: !0,
          transparent: !1,
          toonShading: !1
        }
      },
      {
        id: 'PL',
        name: 'Glossy Plastic',
        shortName: 'Glossy',
        uberOptions: {
          diffuse: Ma(0.56),
          specular: Ma(0.28),
          shininess: 100,
          opacity: 1
        },
        values: {
          lights: !0,
          fog: !0,
          depthWrite: !0,
          transparent: !1,
          toonShading: !1
        }
      },
      {
        id: 'ME',
        name: 'Metal',
        shortName: 'Metal',
        uberOptions: {
          diffuse: Ma(0.56),
          specular: Ma(0.55),
          shininess: 30,
          opacity: 1
        },
        values: {
          lights: !0,
          fog: !0,
          depthWrite: !0,
          transparent: !1,
          toonShading: !1
        }
      },
      {
        id: 'TR',
        name: 'Transparent',
        shortName: 'Transparent',
        uberOptions: {
          diffuse: Ma(1),
          specular: Ma(0),
          shininess: 1,
          opacity: 0.5
        },
        values: {
          lights: !0,
          fog: !0,
          depthWrite: !0,
          transparent: !0,
          toonShading: !1
        }
      },
      {
        id: 'GL',
        name: 'Glass',
        shortName: 'Glass',
        uberOptions: {
          diffuse: Ma(0.5),
          specular: Ma(0.65),
          shininess: 100,
          opacity: 0.5
        },
        values: {
          lights: !0,
          fog: !0,
          depthWrite: !0,
          transparent: !0,
          toonShading: !1
        }
      },
      {
        id: 'BA',
        name: 'Backdrop',
        shortName: 'Backdrop',
        uberOptions: {
          diffuse: Ma(1),
          specular: Ma(0),
          shininess: 1,
          opacity: 1
        },
        values: {
          lights: !1,
          fog: !1,
          depthWrite: !1,
          transparent: !1,
          toonShading: !1
        }
      },
      {
        id: 'TN',
        name: 'Toon',
        shortName: 'Toon',
        uberOptions: {
          diffuse: Ma(1),
          specular: Ma(0),
          shininess: 1,
          opacity: 1
        },
        values: {
          lights: !0,
          fog: !0,
          depthWrite: !0,
          transparent: !1,
          toonShading: !0
        }
      },
      {
        id: 'FL',
        name: 'Flat',
        shortName: 'Flat',
        uberOptions: {
          diffuse: Ma(1),
          specular: Ma(0),
          shininess: 0,
          opacity: 1
        },
        values: { lights: !1, fog: !0, depthWrite: !0, transparent: !1 }
      }
    ],
    Ba = new Ir(Oa)
  function Va(e, t, r) {
    var n = e.material.createInstance()
    n.setValues(t)
    n = new e.constructor(e.geometry, n)
    return (
      (n.material.needsUpdate = !0),
      n.applyMatrix4(e.matrix),
      n.layers.set(r),
      n
    )
  }
  function Da(e, t, r) {
    for (
      var n,
        i,
        o =
          ((n = t),
          (i = []),
          e.traverse(function (e) {
            for (var t = 0; t < n.length; t++)
              if (e instanceof n[t]) {
                i[i.length] = e
                break
              }
          }),
          i),
        s = 0,
        a = o.length;
      s < a;
      ++s
    ) {
      var l = o[s]
      l.parent && r(l)
    }
  }
  function za(e, i) {
    !(function e(t) {
      t instanceof ae.Mesh && i(t)
      for (var r = 0, n = t.children.length; r < n; r++) e(t.children[r])
    })(e)
  }
  var Fa = {
      applyTransformsToMeshes: function (e, n) {
        var i = n.length
        i < 1 ||
          Da(e, [ae.Mesh, ae.LineSegments, ae.Line], function (e) {
            e.applyMatrix4(n[0])
            for (var t = 1; t < i; ++t) {
              var r = new e.constructor(e.geometry, e.material)
              e.parent.add(r), r.applyMatrix4(n[t])
            }
          })
      },
      processTransparentMaterial: function (e, t) {
        t instanceof Ni &&
          Da(e, [ae.Mesh, ae.LineSegments], function (e) {
            e.material.setValues({ prepassTransparancy: !1, fakeOpacity: !1 }),
              (e.material.needsUpdate = !0),
              e.layers.set(kr.LAYERS.TRANSPARENT)
            var t = Va(e, Na, kr.LAYERS.PREPASS_TRANSPARENT)
            e.parent.add(t)
          })
      },
      processColFromPosMaterial: function (e, t) {
        t instanceof Ni &&
          Da(e, [ae.Mesh, ae.LineSegments], function (e) {
            var t = Va(e, La, kr.LAYERS.COLOR_FROM_POSITION)
            e.parent.add(t)
          })
      },
      createShadowmapMaterial:
        ((Ia = {
          colorFromDepth: !0,
          orthoCam: !0,
          lights: !(La = {
            colorFromPos: !0,
            transparent: !(Na = {
              prepassTransparancy: !0,
              fakeOpacity: !1,
              transparent: !1,
              colorFromDepth: !1,
              lights: !1,
              shadowmap: !1,
              fog: !1
            }),
            colorFromDepth: !1,
            lights: !1,
            shadowmap: !1,
            fog: !1,
            overrideColor: !1,
            fogTransparent: !1,
            attrColor: !1,
            attrColor2: !1,
            attrAlphaColor: !1,
            fakeOpacity: !1
          }),
          shadowmap: !1,
          fog: !1
        }),
        function (e, t) {
          t instanceof Ni &&
            Da(e, [ae.Mesh, ae.LineSegments], function (e) {
              var t
              !e.receiveShadow &&
                e.material.shadowmap &&
                e.material.setValues({ shadowmap: !1 }),
                e.material.lights &&
                  e.castShadow &&
                  kr.belongToSelectLayers(e) &&
                  (((t = Va(e, Ia, kr.LAYERS.SHADOWMAP)).isShadowmapMesh = !0),
                  e.parent.add(t))
            })
        }),
      removeShadowmapMaterial: function (e, t) {
        t instanceof Ni &&
          Da(e, [ae.Mesh, ae.LineSegments], function (e) {
            e.isShadowmapMesh && e.parent.remove(e)
          })
      },
      forEachMeshInGroup: za,
      countTriangles: function (e) {
        var t = 0
        return (
          za(e, function (e) {
            t += (function (e) {
              var t = e.geometry
              if (t instanceof ae.InstancedBufferGeometry) {
                var r,
                  n = t.attributes
                for (r in n)
                  if (
                    n.hasOwnProperty(r) &&
                    n[r] instanceof ae.InstancedBufferAttribute
                  ) {
                    var i = n[r]
                    return (
                      ((t.index ? t.index.array.length / 3 : 0) *
                        i.array.length) /
                      i.itemSize
                    )
                  }
                return 0
              }
              return t instanceof ae.BufferGeometry
                ? t.index
                  ? t.index.array.length / 3
                  : 0
                : t.faces
                ? t.faces.length
                : 0
            })(e)
          }),
          t
        )
      }
    },
    Ua = hr.selectors,
    Ga = (function () {
      function o(e, t, r, n) {
        G(this, o)
        var i = {
          clipPlane: Q.now.draft.clipPlane,
          fogTransparent: Q.now.bg.transparent,
          shadowmap: Q.now.shadow.on,
          shadowmapType: Q.now.shadow.type
        }
        ;(this.index = e),
          (this.mode = t),
          (this.colorer = r),
          (this.selector = n),
          (this.selectorString = ''),
          (this.count = 0),
          (this.material = new Ni()),
          this.material.setValues(i),
          this.material.setUberOptions({ fogAlpha: Q.now.fogAlpha }),
          (this.materialPreset = Ba.first),
          (this.needsRebuild = !0),
          (this.visible = !0),
          this.setMode(t)
      }
      return (
        p(o, [
          {
            key: 'markAtoms',
            value: function (e) {
              return (
                (this.count = e.markAtoms(this.selector, 1 << this.index)),
                (this.needsRebuild = !0),
                this.count
              )
            }
          },
          {
            key: 'unmarkAtoms',
            value: function (e) {
              e.clearAtomBits(1 << this.index), (this.count = 0)
            }
          },
          {
            key: 'setMode',
            value: function (e) {
              this.mode = e
            }
          },
          {
            key: 'setMaterialPreset',
            value: function (e) {
              ;(this.materialPreset = e),
                this.material.setUberOptions(e.uberOptions),
                this.material.setValues(e.values)
            }
          },
          {
            key: 'reset',
            value: function () {
              ;(this.geo = null), (this.selectionGeo = null)
            }
          },
          {
            key: 'buildGeometry',
            value: function (e) {
              return (
                this.reset(),
                (this.needsRebuild = !1),
                Q.now.ao &&
                  this.material.setValues({ normalsToGBuffer: Q.now.ao }),
                (this.geo = this.mode.buildGeometry(
                  e,
                  this.colorer,
                  1 << this.index,
                  this.material
                )),
                this.material.uberOptions.opacity < 0.99 &&
                  'prepass' === Q.now.transparency &&
                  Fa.processTransparentMaterial(this.geo, this.material),
                (this.geo.visible = this.visible),
                kr.processObjRenderOrder(this.geo, this.materialPreset.id),
                Fa.processColFromPosMaterial(this.geo, this.material),
                Q.now.shadow.on &&
                  Fa.createShadowmapMaterial(this.geo, this.material),
                this.geo
              )
            }
          },
          {
            key: 'buildSelectionGeometry',
            value: function (e) {
              var t = null
              if (this.geo && 'getSubset' in this.geo) {
                var r = this.geo.getSubset(e)
                if (r && 0 < r.length) {
                  ;((t = new ae.Group()).matrixAutoUpdate = !1),
                    (t.matrix = this.geo.matrix)
                  for (var n = 0; n < r.length; n++) {
                    var i = r[n]
                    t.add(i)
                  }
                }
              }
              return (
                t && (t.visible = this.visible),
                (this.selectionGeo = t),
                this.selectionGeo
              )
            }
          },
          {
            key: 'compare',
            value: function (e) {
              var t = {},
                r = String(this.selector)
              ;(e && r.valueOf() === String(e.selector).valueOf()) ||
                (t.selector = r)
              r = this.mode.identify()
              ;(e && !Array.isArray(r) && r === e.mode) || (t.mode = r)
              r = this.colorer.identify()
              return (
                (e && !Array.isArray(r) && r === e.colorer) || (t.colorer = r),
                (e && this.materialPreset.id === e.material) ||
                  (t.material = this.materialPreset.id),
                t
              )
            }
          },
          {
            key: 'change',
            value: function (e, t, r, n) {
              var i,
                o,
                s = {}
              return (
                e.selector &&
                  ((i = Ua.parse(e.selector).selector),
                  (o = String(i)),
                  this.selectorString !== o &&
                    ((s.selector = o),
                    (this.selectorString = o),
                    (this.selector = i),
                    this.markAtoms(t))),
                e.mode &&
                  ((t = e.mode),
                  b.default.isEqual(this.mode.identify(), t) ||
                    ((s.mode = t), this.setMode(r))),
                e.colorer &&
                  ((r = e.colorer),
                  b.default.isEqual(this.colorer.identify(), r) ||
                    ((s.colorer = r), (this.colorer = n))),
                e.material &&
                  ((n = e.material),
                  b.default.isEqual(this.materialPreset.id, n) ||
                    ((s.material = n),
                    this.setMaterialPreset(Ba.get(e.material)))),
                s
              )
            }
          },
          {
            key: 'show',
            value: function (e) {
              ;(this.visible = e),
                this.geo && (this.geo.visible = e),
                this.selectionGeo && (this.selectionGeo.visible = e)
            }
          }
        ]),
        o
      )
    })()
  function ja(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  function Ha() {}
  var Wa = {
    ComponentEditor: (function () {
      x(n, Ha)
      var r = ja(n)
      function n(e) {
        var t
        return (
          G(this, n),
          ((t = r.call(this))._complexVisual = e),
          (t._inProgress = !1),
          t
        )
      }
      return (
        p(n, [
          {
            key: 'begin',
            value: function () {
              var e = this._complexVisual.getComplex()
              this._componentTransforms = []
              for (var t = 0; t < e._components.length; ++t) {
                var r = e._components[t]
                this._componentTransforms[r._index] = new ae.Object3D()
              }
              return (this._inProgress = !0)
            }
          },
          {
            key: 'apply',
            value: function () {
              if (this._inProgress) {
                for (
                  var e = this._complexVisual.getComplex(), t = 0;
                  t < e._components.length;
                  ++t
                )
                  this._bakeComponentTransform(e._components[t])
                e.onAtomPositionChanged(),
                  this._resetComponentTransform(),
                  this._complexVisual.finalizeEdit()
              }
            }
          },
          {
            key: 'discard',
            value: function () {
              this._inProgress &&
                (this._resetComponentTransform(),
                this._complexVisual.finalizeEdit())
            }
          },
          {
            key: 'getAltObj',
            value: function () {
              var t = { objects: [], pivot: new ae.Vector3(0, 0, 0) },
                e = this._complexVisual,
                r = e.getSelectedComponent()
              if (null === r) return t
              var n,
                i,
                o,
                s,
                a = this._complexVisual.getSelectionGeo(),
                l = 1 << e.getSelectionBit()
              for (
                !(function e(t, r, n) {
                  var i = t.children
                  if (i)
                    for (var o = 0, s = i.length; o < s; ++o) {
                      var a = i[o]
                      a._component === r && n(a),
                        a instanceof kr.RCGroup && e(a, r, n)
                    }
                })(e, r, function (e) {
                  t.objects.push(e)
                }),
                  n = 0;
                n < a.children.length;
                ++n
              )
                for (o = a.children[n], i = 0; i < o.children.length; ++i)
                  (s = o.children[i]).hasOwnProperty('_component') &&
                    s._component === r &&
                    t.objects.push(s)
              t.objects.push(this._componentTransforms[r._index])
              var c = new ae.Vector3(
                  Number.MAX_VALUE,
                  Number.MAX_VALUE,
                  Number.MAX_VALUE
                ),
                u = new ae.Vector3(
                  -Number.MAX_VALUE,
                  -Number.MAX_VALUE,
                  -Number.MAX_VALUE
                )
              return (
                r.forEachResidue(function (e) {
                  var t = e._atoms
                  for (i = 0; i < t.length; ++i)
                    t[i].mask & l &&
                      (c.min(t[i].position), u.max(t[i].position))
                }),
                t.pivot.lerpVectors(c, u, 0.5),
                t
              )
            }
          },
          {
            key: '_bakeComponentTransform',
            value: function (e) {
              var n = this._componentTransforms[e._index]
              !n ||
                (0 === n.position.x &&
                  0 === n.position.y &&
                  0 === n.position.z &&
                  0 === n.quaternion.x &&
                  0 === n.quaternion.y &&
                  0 === n.quaternion.z &&
                  1 === n.quaternion.w) ||
                (n.updateMatrix(),
                e.forEachResidue(function (e) {
                  for (var t = e._atoms, r = 0; r < t.length; ++r)
                    t[r].position.applyMatrix4(n.matrix)
                }))
            }
          },
          {
            key: '_resetComponentTransform',
            value: function () {
              for (
                var e,
                  t,
                  r,
                  n = this._complexVisual,
                  i = this._complexVisual.getSelectionGeo(),
                  o = 0;
                o < this._componentTransforms.length;
                ++o
              )
                (r = this._componentTransforms[o]).position.set(0, 0, 0),
                  r.quaternion.set(0, 0, 0, 1)
              for (o = 0; o < n.children.length; ++o)
                for (t = n.children[o], e = 0; e < t.children.length; ++e)
                  (r = t.children[e]).hasOwnProperty('_component') &&
                    (r.position.set(0, 0, 0), r.quaternion.set(0, 0, 0, 1))
              for (o = 0; o < i.children.length; ++o)
                for (t = i.children[o], e = 0; e < t.children.length; ++e)
                  (r = t.children[e]).hasOwnProperty('_component') &&
                    (r.position.set(0, 0, 0), r.quaternion.set(0, 0, 0, 1))
            }
          }
        ]),
        n
      )
    })(),
    FragmentEditor: (function () {
      x(n, Ha)
      var r = ja(n)
      function n(e) {
        var t
        return (
          G(this, n),
          ((t = r.call(this))._complexVisual = e),
          (t._inProgress = !1),
          t
        )
      }
      return (
        p(n, [
          {
            key: 'begin',
            value: function () {
              var e = this._complexVisual,
                t = this._complexVisual.getSelectionGeo(),
                r = this._getSelectionBorderAtoms()
              if (r.length < 1 || 2 < r.length)
                return (
                  L.error(
                    'Can only edit fragments with one or two bound atoms.'
                  ),
                  !1
                )
              this._fragmentBoundAtoms = r
              var n = 1 << e.getSelectionBit()
              e.disableSubset(n, !0)
              for (var i = 0; i < t.children.length; ++i)
                t.children[i].visible = !1
              var o = r[0].position.clone()
              2 === r.length && o.lerp(r[1].position, 0.5),
                (this._fragmentGeo = new ae.Group()),
                e.add(this._fragmentGeo),
                this._fragmentGeo.position.copy(o),
                (this._fragmentSelectionGeo = new ae.Group()),
                t.add(this._fragmentSelectionGeo),
                this._fragmentSelectionGeo.position.copy(o)
              var s = o.clone()
              s.negate()
              for (var a = 0; a < e.children.length; ++a) {
                var l = e.children[a]
                if ('getSubset' in l) {
                  var c = new ae.Group()
                  this._fragmentGeo.add(c)
                  var u = new ae.Group()
                  this._fragmentSelectionGeo.add(u)
                  for (var h = l.getSubset(n, !0), f = 0; f < h.length; f++) {
                    var d = h[f]
                    c.add(d), d.position.copy(s)
                  }
                  for (var p = l.getSubset(n, !0), m = 0; m < p.length; m++) {
                    var y = p[m]
                    u.add(y), y.position.copy(s)
                  }
                }
              }
              return (
                kr.applySelectionMaterial(this._fragmentSelectionGeo),
                (this._inProgress = !0)
              )
            }
          },
          {
            key: 'apply',
            value: function () {
              var e, t, r, n
              this._inProgress &&
                ((t = (e = this._complexVisual).getSelectionBit()),
                (r = this._fragmentGeo.position),
                (n = this._fragmentGeo.matrix.clone()).multiply(
                  new ae.Matrix4().makeTranslation(-r.x, -r.y, -r.z)
                ),
                this._bakeAtomTransform(n, 1 << t),
                e.enableSubset(1 << t, !0),
                e.getComplex().onAtomPositionChanged(),
                e.finalizeEdit())
            }
          },
          {
            key: 'discard',
            value: function () {
              if (this._inProgress) {
                var e = this._complexVisual,
                  t = this._complexVisual.getSelectionGeo()
                this._fragmentGeo.parent.remove(this._fragmentGeo),
                  e.enableSubset(1 << e.getSelectionBit(), !0)
                for (var r = 0; r < t.children.length; ++r) {
                  var n = t.children[r]
                  n.visible ? t.remove(n) : (n.visible = !0)
                }
                e.finalizeEdit()
              }
            }
          },
          {
            key: 'isFreeRotationAllowed',
            value: function () {
              return this._fragmentBoundAtoms.length < 2
            }
          },
          {
            key: 'getAltObj',
            value: function () {
              var e = { objects: [], pivot: new ae.Vector3(0, 0, 0) }
              e.objects.push(this._fragmentGeo, this._fragmentSelectionGeo)
              var t,
                r = this._fragmentBoundAtoms
              return (
                1 === r.length
                  ? 1 === r[0].bonds.length &&
                    ((t = r[0].bonds[0]),
                    (e.axis = new ae.Vector3().subVectors(
                      t._right.position,
                      t._left.position
                    )),
                    e.axis.normalize(),
                    e.axis.transformDirection(this._complexVisual.matrixWorld))
                  : 2 === r.length &&
                    ((e.axis = new ae.Vector3().subVectors(
                      r[1].position,
                      r[0].position
                    )),
                    e.axis.normalize(),
                    e.axis.transformDirection(this._complexVisual.matrixWorld)),
                e
              )
            }
          },
          {
            key: '_getSelectionBorderAtoms',
            value: function () {
              var e = this._complexVisual.getComplex(),
                t = 1 << this._complexVisual.getSelectionBit(),
                r = {}
              e.forEachBond(function (e) {
                e._left.mask & t
                  ? 0 == (e._right.mask & t) && (r[e._left.index] = 1)
                  : e._right.mask & t && (r[e._right.index] = 1)
              })
              for (
                var n = [], i = Object.keys(r), o = 0, s = i.length;
                o < s;
                ++o
              ) {
                var a = i[o]
                n.push(e._atoms[a])
              }
              return n
            }
          },
          {
            key: '_bakeAtomTransform',
            value: function (t, r) {
              this._complexVisual.getComplex().forEachAtom(function (e) {
                e.mask & r && e.position.applyMatrix4(t)
              })
            }
          }
        ]),
        n
      )
    })()
  }
  function Ya(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Xa = hr.selectors
  function qa(e, t) {
    var r = m((t = !Array.isArray(t) ? [t] : t), 2),
      t = r[0],
      r = r[1]
    return new (e.get(t) || e.first)(r)
  }
  var $a = (function () {
    x(o, Mr)
    var r = Ya(o)
    function o(e, t) {
      return (
        G(this, o),
        ((e = r.call(this, e, t))._complex = t),
        (e._reprList = []),
        (e._repr = null),
        (e._reprListChanged = !0),
        (e._selectionBit = 0),
        (e._reprUsedBits = 0),
        (e._selectionCount = 0),
        (e._selectionGeometry = new ae.Group()),
        e
      )
    }
    return (
      p(o, [
        {
          key: 'getBoundaries',
          value: function () {
            return this._complex.getBoundaries()
          }
        },
        {
          key: 'release',
          value: function () {
            this._selectionGeometry.parent &&
              this._selectionGeometry.remove(this._selectionGeometry),
              Mr.prototype.release.call(this)
          }
        },
        {
          key: 'getComplex',
          value: function () {
            return this._complex
          }
        },
        {
          key: 'getSelectionCount',
          value: function () {
            return this._selectionCount
          }
        },
        {
          key: 'getSelectionGeo',
          value: function () {
            return this._selectionGeometry
          }
        },
        {
          key: 'getSelectionBit',
          value: function () {
            return this._selectionBit
          }
        },
        {
          key: 'getEditor',
          value: function () {
            return this._editor
          }
        },
        {
          key: 'resetReps',
          value: function (e) {
            this._complex && this._complex.clearAtomBits(-1),
              (this._reprListChanged = !0),
              (this._reprUsedBits = 0),
              (this._reprList.length = e.length)
            for (var t = 0, r = e.length; t < r; ++t) {
              var n = e[t],
                i = void 0,
                o = void 0
              'string' == typeof n.selector
                ? ((o = n.selector), (i = Xa.parse(o).selector))
                : void 0 === n.selector
                ? ((o = Q.now.presets.default[0].selector),
                  (i = Xa.parse(o).selector))
                : (o = (i = n.selector).toString())
              var s = qa(Xs, n.mode),
                a = qa(Pa, n.colorer),
                n = Ba.get(n.material) || Ba.first
              ;(this._reprList[t] = new Ga(t, s, a, i)),
                this._reprList[t].setMaterialPreset(n),
                (this._reprList[t].selectorString = o),
                this._complex && this._complex.markAtoms(i, 1 << t),
                (this._reprUsedBits |= 1 << t)
            }
            ;(this._repr = 0 < e.length ? this._reprList[0] : null),
              (this._selectionBit = e.length),
              (this._reprUsedBits |= 1 << this._selectionBit),
              (this._selectionCount = 0),
              this._complex && this._complex.update()
          }
        },
        {
          key: 'repCount',
          value: function () {
            return this._reprList.length
          }
        },
        {
          key: 'repCurrent',
          value: function (e) {
            return (
              0 <= e && e < this._reprList.length
                ? (this._repr = this._reprList[e])
                : (e = this._reprList.indexOf(this._repr)),
              e
            )
          }
        },
        {
          key: 'rep',
          value: function (e, t) {
            if (
              (!t &&
                (void 0 === e || e instanceof Object) &&
                ((t = e), (e = this.repCurrent())),
              e < 0 || e > this._reprList.length)
            )
              return L.error('Rep '.concat(e, ' does not exist!')), null
            if (e === this._reprList.length) {
              var r = this.repAdd(t)
              return (
                L.warn(
                  'Rep '.concat(
                    e,
                    ' does not exist! New representation was created.'
                  )
                ),
                { desc: r.desc, index: e, status: 'created' }
              )
            }
            var r = this._reprList[e],
              n = {
                selector: r.selectorString,
                mode: r.mode.identify(),
                colorer: r.colorer.identify(),
                material: r.materialPreset.id
              }
            if (t) {
              var i = r.change(
                t,
                this._complex,
                qa(Xs, t.mode),
                qa(Pa, t.colorer)
              )
              if (!b.default.isEmpty(i)) {
                for (var o in ((r.needsRebuild = !0), i))
                  i.hasOwnProperty(o) &&
                    ((n[o] = i[o]),
                    L.debug(
                      'rep['
                        .concat(e, '].')
                        .concat(o, ' changed to ')
                        .concat(i[o])
                    ))
                return (
                  i.mode &&
                    r.mode.isSurface &&
                    ('ultra' === Q.now.resolution ||
                      'high' === Q.now.resolution) &&
                    (L.report(
                      'Surface resolution was changed to "medium" to avoid hang-ups.'
                    ),
                    Q.set('resolution', 'medium')),
                  { desc: n, index: e, status: 'changed' }
                )
              }
            }
            return { desc: n, index: e, status: '' }
          }
        },
        {
          key: 'repGet',
          value: function (e) {
            return (e =
              void 0 === e || e instanceof Object ? this.repCurrent() : e) <
              0 || e >= this._reprList.length
              ? null
              : this._reprList[e]
          }
        },
        {
          key: '_getFreeReprIdx',
          value: function () {
            for (
              var e = this._reprUsedBits, t = 0;
              t <= o.NUM_REPRESENTATION_BITS;
              ++t, e >>= 1
            )
              if (0 == (1 & e)) return t
            return -1
          }
        },
        {
          key: 'repAdd',
          value: function (e) {
            if (this._reprList.length >= o.NUM_REPRESENTATION_BITS) return null
            var t = this._getFreeReprIdx()
            if (t < 0) return null
            var r = this.buildSelectorFromMask(1 << this._selectionBit),
              n = Q.now.presets.default[0],
              i = b.default.merge(
                {
                  selector: n.selector,
                  mode: n.mode,
                  colorer: n.colorer,
                  material: n.material
                },
                e
              ),
              n = ('string' == typeof i.selector ? Xa.parse(i.selector) : i)
                .selector,
              e = new Ga(
                this._selectionBit,
                qa(Xs, i.mode),
                qa(Pa, i.colorer),
                n
              )
            return (
              (e.selectorString = n.toString()),
              e.setMaterialPreset(Ba.get(i.material)),
              e.markAtoms(this._complex),
              this._reprList.push(e),
              (this._selectionBit = t),
              (this._reprUsedBits |= 1 << this._selectionBit),
              this._complex.markAtoms(r, 1 << this._selectionBit),
              { desc: i, index: this._reprList.length - 1 }
            )
          }
        },
        {
          key: 'repRemove',
          value: function (e) {
            void 0 === e && (e = this.repCurrent())
            var t,
              r = this._reprList.length
            e < 0 ||
              r <= e ||
              r <= 1 ||
              ((t = this._reprList[e]).unmarkAtoms(this._complex),
              (this._reprUsedBits &= ~(1 << t.index)),
              this._reprList.splice(e, 1),
              t === this._repr &&
                (this._repr = this._reprList[(e = e < --r ? e : r - 1)]),
              (this._reprListChanged = !0))
          }
        },
        {
          key: 'repHide',
          value: function (e, t) {
            void 0 === t && (t = !0),
              e < 0 || e >= this._reprList.length || this._reprList[e].show(!t)
          }
        },
        {
          key: 'select',
          value: function (e, t) {
            t
              ? (this._selectionCount += this._complex.markAtomsAdditionally(
                  e,
                  1 << this._selectionBit
                ))
              : (this._selectionCount = this._complex.markAtoms(
                  e,
                  1 << this._selectionBit
                )),
              this._complex.updateStructuresMask(),
              this.rebuildSelectionGeometry()
          }
        },
        {
          key: 'resetSelectionMask',
          value: function () {
            0 !== this._selectionCount &&
              ((this._selectionCount = 0),
              this._complex &&
                this._complex.clearAtomBits(1 << this._selectionBit))
          }
        },
        {
          key: 'updateSelectionMask',
          value: function (e) {
            var t = this,
              r = e.atom,
              n = e.residue,
              i = e.chain,
              e = e.molecule,
              o = 1 << this._selectionBit,
              s = ~o
            r
              ? ((n = r.residue),
                (i = n._chain),
                (e = n._molecule),
                r.mask & o
                  ? ((r.mask &= s),
                    (n._mask &= s),
                    (i._mask &= s),
                    e && (e.mask &= s),
                    this._selectionCount--)
                  : ((r.mask |= o),
                    this._selectionCount++,
                    n.collectMask(),
                    i.collectMask(),
                    e && e.collectMask()))
              : n
              ? ((i = n._chain),
                (e = n._molecule),
                n._mask & o
                  ? ((n._mask &= s),
                    (i._mask &= s),
                    n.forEachAtom(function (e) {
                      e.mask & o && ((e.mask &= s), t._selectionCount--)
                    }))
                  : ((n._mask |= o),
                    n.forEachAtom(function (e) {
                      e.mask & o || ((e.mask |= o), t._selectionCount++)
                    }),
                    i.collectMask(),
                    e && e.collectMask()))
              : i || e
              ? (e = i || e)._mask & o
                ? ((e._mask &= s),
                  e.forEachResidue(function (e) {
                    e._mask & o &&
                      ((e._mask &= s),
                      e.forEachAtom(function (e) {
                        e.mask & o && ((e.mask &= s), t._selectionCount--)
                      }),
                      (e._mask &= s))
                  }))
                : ((e._mask |= o),
                  e.forEachResidue(function (e) {
                    e._mask & o ||
                      ((e._mask |= o),
                      e.forEachAtom(function (e) {
                        e.mask & o || ((e.mask |= o), t._selectionCount++)
                      }),
                      (e = i ? e.getMolecule() : e.getChain()) &&
                        e.collectMask())
                  }))
              : this.resetSelectionMask()
          }
        },
        {
          key: 'expandSelection',
          value: function () {
            var t = this,
              r = 1 << this._selectionBit
            this._complex.forEachBond(function (e) {
              e._left.mask & r
                ? 0 == (e._right.mask & r) && (e._right.mask |= 1 << 31)
                : e._right.mask & r && (e._left.mask |= 1 << 31)
            })
            this._complex.forEachAtom(function (e) {
              e.mask & (1 << 31) &&
                ((e.mask = (e.mask & ~(1 << 31)) | r), ++t._selectionCount)
            }),
              this._complex.updateStructuresMask()
          }
        },
        {
          key: 'shrinkSelection',
          value: function () {
            var t = this,
              r = 1 << this._selectionBit
            this._complex.forEachBond(function (e) {
              e._left.mask & r
                ? 0 == (e._right.mask & r) && (e._left.mask |= 1 << 31)
                : e._right.mask & r && (e._right.mask |= 1 << 31)
            }),
              this._complex.forEachAtom(function (e) {
                e.mask & r && 1 === e.bonds.length && (e.mask |= 1 << 31)
              })
            var n = ~(r | (1 << 31))
            this._complex.forEachAtom(function (e) {
              e.mask & (1 << 31) && ((e.mask &= n), --t._selectionCount)
            }),
              this._complex.updateStructuresMask()
          }
        },
        {
          key: 'getSelectedComponent',
          value: function () {
            var t = 1 << this._selectionBit,
              r = null,
              n = !1
            return (
              this._complex.forEachAtom(function (e) {
                e.mask & t &&
                  (null === r
                    ? (r = e.residue._component)
                    : r !== e.residue._component && (n = !0))
              }),
              n ? null : r
            )
          }
        },
        {
          key: 'getSelectionCenter',
          value: function (t, r, n) {
            t.set(0, 0, 0)
            var i = 0
            return (
              this._complex.forEachAtom(function (e) {
                r(e, n) && (t.add(e.position), i++)
              }),
              0 !== i && (t.divideScalar(i), t.applyMatrix4(this.matrix), !0)
            )
          }
        },
        {
          key: 'needsRebuild',
          value: function () {
            if (this._reprListChanged) return !0
            for (var e = this._reprList, t = 0, r = e.length; t < r; ++t)
              if (e[t].needsRebuild) return !0
            return !1
          }
        },
        {
          key: 'rebuild',
          value: function () {
            var c = this
            return (
              kr.clearTree(this),
              new Promise(function (s) {
                var a,
                  l = c._complex
                l
                  ? ((a = !1),
                    setTimeout(function () {
                      for (
                        var e = c._reprList,
                          t = oa.get(Q.now.palette) || oa.first,
                          r = !1,
                          n = 0,
                          i = e.length;
                        n < i;
                        ++n
                      ) {
                        var o = e[n]
                        if (((o.colorer.palette = t), o.needsRebuild)) {
                          o.reset()
                          try {
                            o.buildGeometry(l)
                          } catch (e) {
                            if (!(e instanceof le.OutOfMemoryError)) throw e
                            ;(o.needsRebuild = !1),
                              o.reset(),
                              L.error(
                                'Not enough memory to build geometry for representation '.concat(
                                  o.index + 1
                                )
                              ),
                              (a = !0)
                          }
                        }
                        ;(r = a || r || kr.groupHasGeometryToRender(o.geo)),
                          o.geo && c.add(o.geo)
                      }
                      ;(c._reprListChanged = !1), s()
                    }, 10))
                  : s()
              })
            )
          }
        },
        {
          key: 'setNeedsRebuild',
          value: function () {
            for (var e = this._reprList, t = 0, r = e.length; t < r; ++t)
              e[t].needsRebuild = !0
          }
        },
        {
          key: 'rebuildSelectionGeometry',
          value: function () {
            var e = 1 << this._selectionBit
            kr.clearTree(this._selectionGeometry)
            for (var t = 0, r = this._reprList.length; t < r; ++t) {
              var n = this._reprList[t].buildSelectionGeometry(e)
              if (n) {
                this._selectionGeometry.add(n)
                for (var i = 0; i < n.children.length; i++) {
                  var o,
                    s = n.children[i]
                  this._editor &&
                    this._editor._componentTransforms &&
                    (o =
                      this._editor._componentTransforms[s._component._index]) &&
                    (s.position.copy(o.position),
                    s.quaternion.copy(o.quaternion))
                }
                kr.applySelectionMaterial(n)
              }
            }
          }
        },
        {
          key: '_buildSelectorFromSortedLists',
          value: function (e, t, r) {
            var n = this._complex
            function i(e) {
              for (
                var t = [], r = 0, n = NaN, i = NaN, o = 0, s = e.length;
                o < s;
                ++o
              ) {
                var a = e[o]
                a === i + 1
                  ? (i = a)
                  : (Number.isNaN(n) || (t[r++] = new Xa.Range(n, i)),
                    (n = i = a))
              }
              return Number.isNaN(n) || (t[r] = new Xa.Range(n, i)), t
            }
            var o,
              s = null
            if (r.length === n._chains.length) s = Xa.all()
            else {
              if (
                (0 < r.length && ((o = Xa.chain(r)), (s = s ? Xa.or(s, o) : o)),
                0 < Object.keys(t).length)
              )
                for (var a in t)
                  t.hasOwnProperty(a) &&
                    ((o = Xa.and(Xa.chain(a), Xa.residx(i(t[a])))),
                    (s = s ? Xa.or(s, o) : o))
              0 < e.length &&
                ((o = Xa.serial(i(e))), (s = s ? Xa.or(s, o) : o)),
                (s = s || Xa.none())
            }
            return s
          }
        },
        {
          key: 'buildSelectorFromMask',
          value: function (r) {
            var e = this._complex,
              t = [],
              n = {},
              i = []
            return (
              e.forEachChain(function (e) {
                e._mask & r && t.push(e._name)
              }),
              e.forEachResidue(function (e) {
                var t
                e._mask & r &&
                  !(e._chain._mask & r) &&
                  ((t = e._chain._name) in n
                    ? n[t].push(e._index)
                    : (n[t] = [e._index]))
              }),
              e.forEachAtom(function (e) {
                e.mask & r && !(e.residue._mask & r) && i.push(e.serial)
              }),
              this._buildSelectorFromSortedLists(i, n, t)
            )
          }
        },
        {
          key: 'forSelectedResidues',
          value: function (t) {
            var r = 1 << this._selectionBit
            this._complex.forEachResidue(function (e) {
              e._mask & r && t(e)
            })
          }
        },
        {
          key: 'beginComponentEdit',
          value: function () {
            if (this._editor) return null
            var e = new Wa.ComponentEditor(this)
            return e.begin() ? (this._editor = e) : null
          }
        },
        {
          key: 'beginFragmentEdit',
          value: function () {
            if (this._editor) return null
            var e = new Wa.FragmentEditor(this)
            return e.begin() ? (this._editor = e) : null
          }
        },
        {
          key: 'finalizeEdit',
          value: function () {
            this._editor = null
          }
        },
        {
          key: 'setMaterialValues',
          value: function (t) {
            for (
              var e =
                  1 < arguments.length &&
                  void 0 !== arguments[1] &&
                  arguments[1],
                r =
                  2 < arguments.length && void 0 !== arguments[2]
                    ? arguments[2]
                    : void 0,
                n = 0,
                i = this._reprList.length;
              n < i;
              ++n
            ) {
              var o = this._reprList[n]
              o.material.setValues(t),
                e &&
                  o.geo.traverse(function (e) {
                    e instanceof ae.Mesh &&
                      (e.material.setValues(t),
                      void 0 !== r && r(e),
                      (e.material.needsUpdate = !0))
                  })
            }
          }
        },
        {
          key: 'setUberOptions',
          value: function (e) {
            for (var t = 0, r = this._reprList.length; t < r; ++t)
              this._reprList[t].material.setUberOptions(e)
          }
        },
        {
          key: 'within',
          value: function (e, t) {
            var r = this._complex.getVoxelWorld()
            if (null === r) return !1
            var n = 1 << this._selectionBit
            return (
              this._complex.markAtoms(e, n),
              r &&
                r.forEachAtomWithinDistFromMasked(
                  this._complex,
                  n,
                  Number(t),
                  function (e) {
                    e.mask |= n
                  }
                ),
              (this._selectionCount = this._complex.countAtomsByMask(n)),
              this._complex.updateStructuresMask(),
              this.buildSelectorFromMask(n)
            )
          }
        }
      ]),
      o
    )
  })()
  $a.NUM_REPRESENTATION_BITS = 30
  var Za =
      "varying vec3 pos;\r\n\r\nvoid main() {\r\n  // we're assuming local position is in [-0.5, 0.5]\r\n  // we need to offset it to be represented in RGB\r\n  pos = position.xyz + 0.5;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",
    Ka =
      'varying vec3 pos;\r\n\r\nvoid main() {\r\n  gl_FragColor = vec4(pos, 0.5);\r\n}'
  function Qa(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Ja = ae.UniformsUtils.merge([
    {
      volumeDim: { type: 'v3', value: new ae.Vector3(512, 512, 512) },
      tileTex: { type: 't', value: null },
      tileTexSize: { type: 'v2', value: new ae.Vector2(512, 512) },
      tileStride: { type: 'v2', value: new ae.Vector2(512, 512) },
      boxAngles: { type: 'v3', value: new ae.Vector3(1, 1, 1) },
      delta: { type: 'v3', value: new ae.Vector3(0, 0, 0) },
      _isoLevel0: { type: 'v2', value: new ae.Vector3(0.5, 0.75, 1) },
      _flipV: { type: 'f', value: 0 },
      _BFLeft: { type: 't', value: null },
      _BFRight: { type: 't', value: null },
      _FFLeft: { type: 't', value: null },
      _FFRight: { type: 't', value: null },
      _WFFLeft: { type: 't', value: null },
      _WFFRight: { type: 't', value: null }
    }
  ])
  function el(e, t) {
    var r,
      n = ae.UniformsUtils.clone(t)
    for (r in e) n.hasOwnProperty(r) && (n[r].value = e[r])
    return n
  }
  function tl(e, t) {
    return {
      uniforms: el(e, {}),
      vertexShader: Za,
      fragmentShader: Ka,
      transparent: !1,
      depthTest: !1,
      depthWrite: !1,
      side: t
    }
  }
  var or = (function () {
      x(r, ae.ShaderMaterial)
      var t = Qa(r)
      function r(e) {
        G(this, r)
        e = tl(e, ae.BackSide)
        return t.call(this, e)
      }
      return p(r)
    })(),
    rl = p(function e(t, r, n, i) {
      G(this, e),
        (this.uniforms = el(t, r)),
        (this.vertexShader = n),
        (this.fragmentShader = i),
        (this.transparent = !1),
        (this.depthTest = !1),
        (this.depthWrite = !1),
        (this.side = ae.FrontSide)
    }),
    nl = {
      BackFacePosMaterial: or,
      BackFacePosMaterialFarPlane: (function () {
        x(n, ae.ShaderMaterial)
        var r = Qa(n)
        function n(e) {
          G(this, n)
          var t = ae.UniformsUtils.merge([
              {
                aspectRatio: { type: 'f', value: 0 },
                farZ: { type: 'f', value: 0 },
                tanHalfFOV: { type: 'f', value: 0 },
                matWorld2Volume: { type: '4fv', value: new ae.Matrix4() }
              }
            ]),
            t = new rl(
              e,
              t,
              "varying vec4 volPos;\r\nuniform float aspectRatio;\r\nuniform float farZ;\r\nuniform float tanHalfFOV;\r\nuniform mat4  matWorld2Volume;\r\n\r\nvoid main() {\r\n  // rescale plane to fill in the whole far plane area seen from camera\r\n  vec3 pos = position.xyz;\r\n  pos.x = pos.x * tanHalfFOV * farZ * aspectRatio;\r\n  pos.y = pos.y * tanHalfFOV * farZ;\r\n  // common transformation\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\r\n  // calc pos in volume CS\r\n  volPos = matWorld2Volume * modelMatrix * vec4(pos, 1.0);\r\n  // we're assuming local position is in [-0.5, 0.5]\r\n  // we need to offset it to be represented in RGB\r\n  volPos = volPos + 0.5;\r\n  volPos.w = 0.5;\r\n}\r\n",
              'varying vec4 volPos;\r\n\r\nvoid main() {\r\n  gl_FragColor = volPos;\r\n}'
            )
          return r.call(this, t)
        }
        return p(n)
      })(),
      FrontFacePosMaterial: (function () {
        x(r, ae.ShaderMaterial)
        var t = Qa(r)
        function r(e) {
          G(this, r)
          e = tl(e, ae.FrontSide)
          return t.call(this, e)
        }
        return p(r)
      })(),
      VolumeMaterial: (function () {
        x(r, ae.ShaderMaterial)
        var t = Qa(r)
        function r(e) {
          G(this, r)
          var e = new rl(
            e,
            Ja,
            'varying vec4 screenSpacePos;\r\n\r\nvoid main() {\r\n  screenSpacePos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n  gl_Position = screenSpacePos;\r\n}',
            "uniform mat4 projectionMatrix;\r\n\r\n// 3D volume texture\r\nuniform vec3 volumeDim;    // volume dimensions, pixels\r\nuniform sampler2D tileTex; // tiled texture containing all Z-slices of a 3D data\r\nuniform vec2 tileTexSize;  // size of tiled texture, pixels\r\nuniform vec2 tileStride;   // UV stride between slices in tile tex, pixels\r\n\r\nuniform vec3 boxAngles;//value of angles({x: alpha, y:beta, z:gamma}) types 1 - if angle is obtuse, 0 - if acute\r\nuniform vec3 delta; //Projection box delta's from non-orthogonal origin axes; {x: XY, y : XZ, z: YZ}\r\n\r\nuniform vec3 _isoLevel0;\r\nuniform float _flipV;\r\nuniform sampler2D _BFLeft;\r\nuniform sampler2D _BFRight;\r\nuniform sampler2D _FFLeft;\r\nuniform sampler2D _FFRight;\r\nuniform sampler2D _WFFLeft;\r\nuniform sampler2D _WFFRight;\r\n\r\nvarying vec4 screenSpacePos;\r\n\r\n#define NO_COLOR vec4(0., 0., 0., 0.)\r\n\r\nvec4 sample3DTexture(vec3 texCoord) {\r\n  // a pair of Z slices is determined by nearest slice border\r\n  float zSliceBorder = floor(texCoord.z * volumeDim.z + 0.5);\r\n  float zSliceNumber1 = max(zSliceBorder - 1.0, 0.0);\r\n  float zSliceNumber2 = min(zSliceBorder, volumeDim.z - 1.0);\r\n\r\n  float rowTiles = floor(tileTexSize.x / tileStride.x);\r\n\r\n  // calculate coords in tile texture for both slices\r\n  vec2 tileOffset = vec2(mod(zSliceNumber1, rowTiles), floor(zSliceNumber1 / rowTiles));\r\n  vec2 texCoordSlice1 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r\n  tileOffset = vec2(mod(zSliceNumber2, rowTiles), floor(zSliceNumber2 / rowTiles));\r\n  vec2 texCoordSlice2 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r\n\r\n  // bilinear filtering\r\n  vec4 colorSlice1 = texture2D(tileTex, texCoordSlice1);\r\n  vec4 colorSlice2 = texture2D(tileTex, texCoordSlice2);\r\n  float weightSlice2 = texCoord.z * volumeDim.z - (zSliceNumber1 + 0.5);\r\n  return mix(colorSlice1, colorSlice2, weightSlice2);\r\n}\r\n\r\nvec4 sample3DTextureInclined(vec3 boxCoord) { // delta:{ x: XY, y : XZ, z: YZ }\r\n  vec3 textCoord = boxCoord;\r\n  vec2 currDelta = mix(boxCoord.zz, vec2(1., 1.) - boxCoord.zz, boxAngles.yx) * delta.yz;\r\n\r\n  textCoord.y = (boxCoord.y  - currDelta.y) / (1. - delta.z);\r\n  if (textCoord.y < 0.0 || textCoord.y > 1.0)\r\n    return NO_COLOR;\r\n\r\n  currDelta.x += mix(textCoord.y, 1.0 - textCoord.y, boxAngles.z) * delta.x;\r\n\r\n  textCoord.x = (boxCoord.x - currDelta.x) / (1. - delta.x - delta.y);\r\n  if (textCoord.x < 0.0 || textCoord.x > 1.0)\r\n    return NO_COLOR;\r\n\r\n  return sample3DTexture(textCoord);\r\n}\r\n\r\nfloat CalcColor(vec3 iter, vec3 dir) {\r\n  float d = 1. / 128.;\r\n  vec3 dx = vec3(d, 0.0, 0.0);\r\n  vec3 dy = vec3(0.0, d, 0.0);\r\n  vec3 dz = vec3(0.0, 0.0, d);\r\n\r\n  // #Opt: coordInc.x:(iter + dx).x > 1. ? 0.: sample3DTextureInclined(iter + dx).x,\r\n  vec3 coordInc = mix(\r\n    vec3(\r\n      sample3DTextureInclined(iter + dx).x,\r\n      sample3DTextureInclined(iter + dy).x,\r\n      sample3DTextureInclined(iter + dz).x\r\n    ),\r\n    vec3(0. ,0. , 0.),\r\n    vec3(floor((iter + dx).x), floor((iter + dy).y), floor((iter + dz).z))\r\n  );\r\n\r\n  // #Opt: coordDec.x:(iter - dx).x < 0. ? 0.: sample3DTextureInclined(iter - dx).x,\r\n  vec3 coordDec = mix(\r\n    vec3(0. ,0. , 0.),\r\n    vec3(\r\n      sample3DTextureInclined(iter - dx).x,\r\n      sample3DTextureInclined(iter - dy).x,\r\n      sample3DTextureInclined(iter - dz).x\r\n    ),\r\n    vec3(ceil((iter - dx).x), ceil((iter - dy).y), ceil((iter - dz).z))\r\n  );\r\n\r\n  vec3 N = normalize(coordInc - coordDec);\r\n  float dif = max(0.0, dot(N, dir));\r\n  return dif;\r\n}\r\n\r\nvec3 AccuracyIso(vec3 left, vec3 right, float volLeft, float threshold) {\r\n  for (int i = 0; i < 5; i++) {\r\n    vec3 iterator = 0.5 * (left + right);\r\n    float vol = sample3DTextureInclined(iterator).r;\r\n    if ((volLeft - threshold) * (vol - threshold) < 0.)\r\n      right = iterator;\r\n    else\r\n      left = iterator;\r\n  }\r\n  return 0.5 * (left + right);\r\n}\r\n\r\nvec3 CorrectIso(vec3 left, vec3 right, float tr) {\r\n  for (int j = 0; j < 5; j++) {\r\n    vec3 iterator = 0.5 * (left + right);\r\n    float vol = sample3DTextureInclined(iterator).r;\r\n    if (vol < tr)\r\n      right = iterator;\r\n    else\r\n      left = iterator;\r\n  }\r\n  return 0.5 * (left + right);\r\n}\r\n\r\nvec4 GetIso1(vec3 start, vec3 back, float molDist, vec3 dir, float tr, int count) {\r\n  float vol, stepSize = (float(count) + 2.) / float(STEPS_COUNT);\r\n  vec3 step = stepSize * dir, iterator = start, left, right;\r\n  vec4 acc = NO_COLOR;\r\n\r\n  for (int i = 0; i < STEPS_COUNT; i++) {\r\n    iterator = iterator + step;\r\n    vol = sample3DTextureInclined(iterator).r;\r\n    if (length(iterator - back) <= stepSize || (vol > tr))\r\n      break;\r\n  }\r\n\r\n  if (vol > tr)\r\n    acc = vec4(CorrectIso(iterator, iterator - step, tr).xyz, 1.);\r\n\r\n  return acc;\r\n}\r\n\r\nfloat easeOut(float x0, float x1, float x) {\r\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r\n  return 1.0 - (1.0 - t) * (1.0 - t);\r\n}\r\n\r\nfloat easeIn(float x0, float x1, float x) {\r\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r\n  return t * t;\r\n}\r\n\r\nvec3 GetColSimple(float vol) {\r\n  float t = easeOut(_isoLevel0.x, _isoLevel0.y, vol);\r\n  float s = easeIn(_isoLevel0.y, _isoLevel0.z, vol);\r\n  return vec3(0.5, 0.6, 0.7) * (1.0 - t) + 2.0 * vec3(s, 0, 0);\r\n}\r\n\r\nvec4 VolRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  vec4 acc = NO_COLOR, iso;\r\n  vec3 iterator = start, sumColor = vec3(0., 0., 0.);\r\n  float stepSize, alpha, sumAlpha = 0.0, vol, curStepSize, molD;\r\n  vec3 step, col, colOld, right;\r\n  float tr0 = _isoLevel0.x;\r\n  float dif, r, kd, finish;\r\n  int count = 0, stopMol = 0;\r\n\r\n  for (int k = 0; k < 3; k++) {\r\n    stepSize = (float(k) + 2.) / float(STEPS_COUNT);\r\n    kd = 140. * tr0 * stepSize;\r\n    r = 1. - kd;\r\n    step = stepSize * dir;\r\n    iso = GetIso1(iterator, back, molDist, dir, tr0, k);\r\n    if (iso.a < 0.1 || length(iso.xyz - start) > molDist)\r\n      break;\r\n    iterator = iso.xyz;\r\n    dif = 1.;// CalcColor(iterator, dir);\r\n    colOld = GetColSimple(tr0);\r\n    curStepSize = stepSize;\r\n    for (int i = 0; i < STEPS_COUNT; i++) {\r\n      iterator = iterator + step;\r\n      molD = length(iterator - start);\r\n      vol = sample3DTextureInclined(iterator).r;\r\n      finish = distance(iterator, back) - stepSize;\r\n      if (finish < 0.0 || vol < tr0 || (sumAlpha > 0.97) || molD > molDist)\r\n        break;\r\n      alpha = (1. - r);\r\n      col = GetColSimple(vol);\r\n      vol = sample3DTextureInclined(iterator - 0.5 * step).r;\r\n      vec3 colMid = GetColSimple(vol);\r\n      sumColor += (1. - sumAlpha) * (colOld + 4.* colMid + col) * alpha / 6.;\r\n      sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r\n      colOld = col;\r\n    } // for i\r\n\r\n    if (finish < 0.0 || sumAlpha > 0.97)\r\n      break;\r\n\r\n    if (molD > molDist) {\r\n      curStepSize = stepSize - (molD - molDist);\r\n      right = iterator - (molD - molDist) * dir;\r\n      vol = sample3DTextureInclined(right).r;\r\n    } else {\r\n      vec3 left = iterator - step;\r\n      right = CorrectIso(left, iterator, tr0);\r\n      curStepSize = distance(left, right);\r\n      vol = tr0;\r\n    }\r\n\r\n    alpha = (1. - r) * curStepSize / stepSize;\r\n    dif = 1.;// CalcColor(right, dir);\r\n    col = GetColSimple(vol);\r\n    vol = sample3DTextureInclined(iterator - 0.5 * curStepSize / stepSize * step).r;\r\n    vec3 colMid = GetColSimple(vol);\r\n    sumColor += (1. - sumAlpha) * (colOld + 4. * colMid + col) * alpha / 6.;\r\n    sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r\n\r\n    if (molD > molDist)\r\n      break;\r\n  } // for k\r\n  acc.rgb = 1. * sumColor / sumAlpha;\r\n  acc.a = sumAlpha;\r\n  return acc;\r\n}\r\n\r\nvec4 VolRender1(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  float stepSize = 1.0 / float(STEPS_COUNT);\r\n  float len = length(back - start);\r\n  vec3 step = stepSize * dir;\r\n  vec3 iterator = start;\r\n  float acc = 0.0;\r\n\r\n  for (int i = 0; i < STEPS_COUNT; i++) {\r\n    if (float(i) * stepSize > len)\r\n      break;\r\n    iterator = iterator + step;\r\n    if (sample3DTextureInclined(iterator).r > _isoLevel0.x)\r\n      acc += 10. * sample3DTextureInclined(iterator).r / float(STEPS_COUNT);\r\n  }\r\n\r\n  return vec4(1.,1.,1., acc);\r\n}\r\n\r\nvec4 IsoRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  vec4 tst = GetIso1(start, back, 2., dir, _isoLevel0.x, 0);\r\n  vec4 col = NO_COLOR;\r\n\r\n  if (length(tst.xyz - start) < molDist && tst.a > 0.1) {\r\n    float dif =  CalcColor(tst.xyz, dir);\r\n    dif = 0.9 * dif * dif;\r\n    col = vec4(dif, dif, dif, 1);\r\n  }\r\n  return col;\r\n}\r\n\r\nvec4 VolRender2(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  return sample3DTexture(start);\r\n}\r\n\r\nvoid main() {\r\n  vec3 tc = screenSpacePos.xyz / screenSpacePos.w * 0.5 + 0.5;\r\n\r\n  if (_flipV > 0.0) {\r\n    tc.y = 1.0 - tc.y;\r\n  }\r\n\r\n  vec3 start;\r\n  vec3 back;\r\n  vec3 molBack;\r\n  if (projectionMatrix[0][2] < 0.0) {\r\n    start = texture2D(_FFLeft, tc.xy).xyz;\r\n    back = texture2D(_BFLeft, tc.xy).xyz;\r\n    molBack = texture2D(_WFFLeft, tc.xy).xyz;\r\n  } else {\r\n    start = texture2D(_FFRight, tc.xy).xyz;\r\n    back = texture2D(_BFRight, tc.xy).xyz;\r\n    molBack = texture2D(_WFFRight, tc.xy).xyz;\r\n  }\r\n\r\n  vec3 dir = normalize(back - start);\r\n\r\n  float molDist = 2.0;\r\n  if (length(molBack) > 0.001) {\r\n    molDist = distance(start, molBack);\r\n  }\r\n\r\n  #ifdef ISO_MODE\r\n    gl_FragColor = IsoRender(start, back, molDist, dir);\r\n  #else\r\n    gl_FragColor = VolRender(start, back, molDist, dir);\r\n  #endif\r\n}\r\n"
          )
          return (
            (e.transparent = !0),
            (e.depthTest = !0),
            (e = t.call(this, e)).updateDefines(),
            e
          )
        }
        return (
          p(r, [
            {
              key: 'updateDefines',
              value: function () {
                ;(this.defines = {
                  ISO_MODE: Q.now.modes.VD.isoMode,
                  STEPS_COUNT:
                    100 * Q.now.modes.VD.polyComplexity[Q.now.resolution]
                }),
                  (this.needsUpdate = !0)
              }
            }
          ]),
          r
        )
      })()
    }
  function il(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ol = (function () {
    x(b, ae.Mesh)
    var n = il(b)
    function b() {
      G(this, b)
      var e,
        t = new ae.BufferGeometry()
      be(S((e = n.call(this, t))), 'volumeInfo', {}),
        (e.clipPlane = new ae.Plane())
      var r = new ae.Vector3(0.5, 0.5, 0.5)
      return (
        (e.size = r),
        (e.cullFlag = [!0, !0, !0, !0, !0, !0, !0, !0, !1, !1, !1, !1, !1, !1]),
        (e.faces = [
          { indices: [], norm: new ae.Vector3(0, 0, -1) },
          { indices: [], norm: new ae.Vector3(0, 0, 1) },
          { indices: [], norm: new ae.Vector3(0, -1, 0) },
          { indices: [], norm: new ae.Vector3(0, 1, 0) },
          { indices: [], norm: new ae.Vector3(-1, 0, 0) },
          { indices: [], norm: new ae.Vector3(1, 0, 0) },
          { indices: [], norm: new ae.Vector3(0, 0, 0) }
        ]),
        (e.vertices = [
          new ae.Vector3(-r.x, -r.y, -r.z),
          new ae.Vector3(-r.x, r.y, -r.z),
          new ae.Vector3(r.x, -r.y, -r.z),
          new ae.Vector3(r.x, r.y, -r.z),
          new ae.Vector3(-r.x, -r.y, r.z),
          new ae.Vector3(-r.x, r.y, r.z),
          new ae.Vector3(r.x, -r.y, r.z),
          new ae.Vector3(r.x, r.y, r.z),
          new ae.Vector3(0, 0, 0),
          new ae.Vector3(0, 0, 0),
          new ae.Vector3(0, 0, 0),
          new ae.Vector3(0, 0, 0),
          new ae.Vector3(0, 0, 0),
          new ae.Vector3(0, 0, 0)
        ]),
        t.setAttribute(
          'position',
          new ae.BufferAttribute(new Float32Array(3 * e.vertices.length), 3)
        ),
        (e.name = 'VolumeMesh'),
        e
      )
    }
    return (
      p(b, [
        {
          key: '_updateVertices',
          value: function () {
            var e = b._corners,
              t = b._edges,
              r = b._edgeIntersections,
              n = this.clipPlane.normal,
              i = this.clipPlane.constant,
              o = this.vertices,
              s = this.size,
              a = [0, 0, 0, 0, 0, 0, 0, 0],
              l = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
              c = new ae.Vector3(),
              u = null
            for (var h = 0; h < 12; ++h) {
              var f = t[h],
                u = r[h]
              c.set(f[2], f[3], f[4]), c.multiply(s)
              var d = 0
              0 === f[2] &&
                (d = (function () {
                  if (0 === n.x) return 0
                  var e = -(n.dot(c) + i) / n.x
                  return -s.x <= e && e <= s.x
                    ? (u.set(e, c.y, c.z), e === s.x ? 2 : e == -s.x ? -2 : 1)
                    : 0
                })()),
                0 === f[3] &&
                  (d = (function () {
                    if (0 === n.y) return 0
                    var e = -(n.dot(c) + i) / n.y
                    return -s.y <= e && e <= s.y
                      ? (u.set(c.x, e, c.z), e === s.y ? 2 : e == -s.y ? -2 : 1)
                      : 0
                  })()),
                -2 ===
                (d =
                  0 === f[4]
                    ? (function () {
                        if (0 === n.z) return 0
                        var e = -(n.dot(c) + i) / n.z
                        return -s.z <= e && e <= s.z
                          ? (u.set(c.x, c.y, e),
                            e === s.z ? 2 : e == -s.z ? -2 : 1)
                          : 0
                      })()
                    : d)
                  ? (a[f[0]] = 1)
                  : 2 === d
                  ? (a[f[1]] = 1)
                  : 0 === d && (l[h] = 0)
            }
            for (
              var p = { indices: [], norm: n.clone().negate() }, m = 8, y = 0;
              y < 8;
              ++y
            )
              1 === a[y] &&
                (o[m].set(e[y][0], e[y][1], e[y][2]).multiply(s),
                p.indices.push(m++),
                (l[e[y][3]] = 0),
                (l[e[y][4]] = 0),
                (l[e[y][5]] = 0))
            for (y = 0; y < 12; ++y)
              1 === l[y] && (o[m].copy(r[y]), p.indices.push(m++))
            this.faces[6] = p
            var _ = new ae.Vector3(),
              v = new ae.Vector3()
            for (this.clipPlane.coplanarPoint(v), y = 0; y < o.length; ++y)
              (this.cullFlag[y] = !1),
                y < 8
                  ? (_.subVectors(o[y], v), (this.cullFlag[y] = 0 <= n.dot(_)))
                  : y < 8 + p.indices.length && (this.cullFlag[y] = !0)
            var g = this.geometry.getAttribute('position'),
              x = 0
            for (y = 0; y < o.length; ++y)
              (g.array[x++] = o[y].x),
                (g.array[x++] = o[y].y),
                (g.array[x++] = o[y].z)
            g.needsUpdate = !0
          }
        },
        {
          key: '_collectVertices',
          value: function (e, t) {
            var r,
              n = this.vertices
            for (e.indices = [], r = 0; r < n.length; ++r)
              this.cullFlag[r] && t(n[r]) && e.indices.push(r)
          }
        },
        {
          key: '_sortIndices',
          value: function (e, t) {
            for (
              var r, n, i = this.vertices, o = [], s = new ae.Vector3(), a = 1;
              a < e.indices.length;
              ++a
            )
              s.subVectors(i[e.indices[a]], i[e.indices[0]]),
                s.normalize(),
                s.cross(t),
                s.negate(),
                (o[a] = e.norm.dot(s))
            for (a = 1; a < e.indices.length - 1; ++a)
              for (r = a + 1; r < e.indices.length; ++r)
                o[r] < o[a] &&
                  ((n = o[a]),
                  (o[a] = o[r]),
                  (o[r] = n),
                  (n = e.indices[a]),
                  (e.indices[a] = e.indices[r]),
                  (e.indices[r] = n))
          }
        },
        {
          key: '_updateIndices',
          value: function () {
            var e,
              t = this.vertices,
              r = this.size
            this._collectVertices(this.faces[0], function (e) {
              return e.z === -r.z
            }),
              this._collectVertices(this.faces[1], function (e) {
                return e.z === r.z
              }),
              this._collectVertices(this.faces[2], function (e) {
                return e.y === -r.y
              }),
              this._collectVertices(this.faces[3], function (e) {
                return e.y === r.y
              }),
              this._collectVertices(this.faces[4], function (e) {
                return e.x === -r.x
              }),
              this._collectVertices(this.faces[5], function (e) {
                return e.x === r.x
              })
            for (
              var n = new ae.Vector3(),
                i = new ae.Vector3(),
                o = new ae.Vector3(),
                s = 0;
              s < this.faces.length;
              ++s
            )
              if (0 !== (e = this.faces[s]).indices.length) {
                for (n.set(0, 0, 0), c = 0; c < e.indices.length; ++c)
                  n.add(t[e.indices[c]])
                n.multiplyScalar(1 / e.indices.length),
                  i.subVectors(t[e.indices[0]], n),
                  i.normalize()
                for (var a, l = [], c = 0; c < e.indices.length; ++c)
                  o.subVectors(t[e.indices[c]], n), (l[c] = o.dot(i))
                for (c = 1; c < e.indices.length; ++c)
                  l[c] < l[0] &&
                    ((a = l[0]),
                    (l[0] = l[c]),
                    (l[c] = a),
                    (a = m(e.indices, 1)[0]),
                    (e.indices[0] = e.indices[c]),
                    (e.indices[c] = a))
                this._sortIndices(e, i)
              }
            var u = 0
            for (s = 0; s < this.faces.length; ++s)
              3 <= (e = this.faces[s]).indices.length &&
                (u += 3 * (e.indices.length - 2))
            var h = 0,
              f = new Uint16Array(u)
            for (s = 0; s < this.faces.length; ++s)
              for (e = this.faces[s], c = 0; c < e.indices.length - 2; ++c)
                (f[h] = e.indices[0]),
                  (f[h + 1] = e.indices[c + 1]),
                  (f[h + 2] = e.indices[c + 2]),
                  (h += 3)
            this.geometry.setIndex(new ae.BufferAttribute(f, 1))
          }
        },
        {
          key: 'setDataSource',
          value: function (e) {
            var t = new nl.VolumeMaterial(),
              r = e.getDimensions(),
              n = e.getTiledTextureStride(),
              i = e.buildTiledTexture(),
              o = e.getBox()
            t.uniforms.volumeDim.value.set(r[0], r[1], r[2]),
              (t.uniforms.tileTex.value = i),
              t.uniforms.tileTexSize.value.set(i.image.width, i.image.height),
              t.uniforms.tileStride.value.set(n[0], n[1]),
              Object.assign(this.volumeInfo, e.getVolumeInfo())
            e = this.volumeInfo
            t.uniforms.delta.value.copy(e.delta),
              t.uniforms.boxAngles.value.set(
                e.obtuseAngle[0],
                e.obtuseAngle[1],
                e.obtuseAngle[2]
              ),
              (this.material = t),
              o.getSize(this.scale),
              o.getCenter(this.position)
          }
        },
        {
          key: '_updateIsoLevel',
          value: function () {
            function e(e) {
              return (o + e * i.sd) / s
            }
            var t = Q.now.modes.VD,
              r = t.kSigma,
              n = t.kSigmaMed,
              t = t.kSigmaMax,
              i = this.volumeInfo,
              o = i.dmean - i.dmin,
              s = i.dmax - i.dmin
            this.material.uniforms._isoLevel0.value.set(e(r), e(n), e(t))
          }
        },
        {
          key: 'rebuild',
          value: function (e) {
            var t = b._nearClipPlaneOffset,
              r = b._pos,
              n = b._norm,
              i = b._norm4D,
              o = b._matrixWorldToLocal,
              s = b._clipPlane
            this._updateIsoLevel(),
              e.getWorldDirection(n),
              e.getWorldPosition(r),
              r.addScaledVector(n, e.near + t),
              o.copy(this.matrixWorld).invert(),
              r.applyMatrix4(o),
              i.set(n.x, n.y, n.z, 0),
              i.applyMatrix4(o),
              n.copy(i),
              n.normalize(),
              s.setFromNormalAndCoplanarPoint(n, r),
              this.clipPlane.equals(s) ||
                ((this.clipPlane = s.clone()),
                this._updateVertices(),
                this._updateIndices())
          }
        }
      ]),
      b
    )
  })()
  be(ol, '_corners', [
    [-1, -1, -1, 0, 4, 8],
    [1, -1, -1, 0, 5, 9],
    [1, 1, -1, 1, 5, 10],
    [-1, 1, -1, 1, 4, 11],
    [-1, -1, 1, 2, 6, 8],
    [1, -1, 1, 2, 7, 9],
    [1, 1, 1, 3, 7, 10],
    [-1, 1, 1, 3, 6, 11]
  ]),
    be(ol, '_edges', [
      [0, 1, 0, -1, -1],
      [2, 3, 0, 1, -1],
      [4, 5, 0, -1, 1],
      [6, 7, 0, 1, 1],
      [0, 3, -1, 0, -1],
      [1, 2, 1, 0, -1],
      [4, 7, -1, 0, 1],
      [5, 6, 1, 0, 1],
      [0, 4, -1, -1, 0],
      [1, 5, 1, -1, 0],
      [2, 6, -1, 1, 0],
      [3, 7, 1, 1, 0]
    ]),
    be(
      ol,
      '_edgeIntersections',
      (function () {
        for (var e = [], t = 0; t < 12; ++t) e.push(new ae.Vector3())
        return e
      })()
    ),
    be(ol, '_nearClipPlaneOffset', 0.2),
    be(ol, '_pos', new ae.Vector3()),
    be(ol, '_norm', new ae.Vector3()),
    be(ol, '_norm4D', new ae.Vector4()),
    be(ol, '_matrixWorldToLocal', new ae.Matrix4()),
    be(ol, '_clipPlane', new ae.Plane())
  var sl = (function () {
    function h(e, t) {
      G(this, h)
      var r = t.delta,
        t = t.obtuseAngle,
        n = new ae.Vector3()
      e.getSize(n), n.multiplyScalar(0.5)
      for (
        var i = this._getBaseVertices(r, t),
          t = new ae.BufferGeometry(),
          o = [],
          s = 0;
        s < 4;
        s++
      )
        o.push(i[s].clone().multiply(n)),
          o.push(i[(s + 1) % 4].clone().multiply(n))
      for (
        var a = new ae.Vector3(2 * n.x * (1 - r.x - r.y), 0, 0), l = 0;
        l < 8;
        l++
      )
        o.push(o[l].clone().add(a))
      for (var c = 0; c < 4; c++)
        o.push(o[2 * c].clone()), o.push(o[2 * c + 8].clone())
      var u = new ae.Vector3()
      e.getCenter(u),
        o.forEach(function (e) {
          return e.add(u)
        })
      e = (function (e) {
        for (var t = e.length, r = new Float32Array(3 * t), n = 0; n < t; ++n) {
          var i = 3 * n,
            o = e[n]
          ;(r[i] = o.x), (r[1 + i] = o.y), (r[2 + i] = o.z)
        }
        return r
      })(o)
      t.setAttribute('position', new ae.BufferAttribute(e, 3)),
        (this._lines = new ae.LineSegments(
          t,
          new ae.LineBasicMaterial({ color: 16777215 })
        )),
        this._lines.layers.set(kr.LAYERS.VOLUME)
    }
    return (
      p(h, [
        {
          key: '_getBaseVertices',
          value: function (n, i) {
            function e(e, t) {
              var r = n[o[e][0]]
              return (-0.5 * (t - 1) + t * i[o[e][1]]) * r
            }
            var o = h._projectionTable
            return [
              new ae.Vector3(
                2 * (e('XZ', 1) + e('XY', 1)) - 1,
                2 * e('YZ', 1) - 1,
                -1
              ),
              new ae.Vector3(
                2 * (e('XZ', -1) + e('XY', 1)) - 1,
                2 * e('YZ', -1) - 1,
                1
              ),
              new ae.Vector3(
                2 * (e('XZ', -1) + e('XY', -1)) - 1,
                1 - 2 * e('YZ', 1),
                1
              ),
              new ae.Vector3(
                2 * (e('XZ', 1) + e('XY', -1)) - 1,
                1 - 2 * e('YZ', -1),
                -1
              )
            ]
          }
        },
        {
          key: 'getMesh',
          value: function () {
            return this._lines
          }
        }
      ]),
      h
    )
  })()
  be(sl, '_projectionTable', { XY: ['x', 2], XZ: ['y', 1], YZ: ['z', 0] })
  var al = (function () {
    function r(l, e, t) {
      G(this, r)
      ;(e = this._initPlaneGeo(e, t)),
        (t = new nl.BackFacePosMaterialFarPlane())
      ;(this._plane = new Ji.Mesh(e, t)),
        (this._plane.frustumCulled = !1),
        (this._plane.doubleSided = !0)
      var c = new ae.Matrix4()
      ;(this._plane._onBeforeRender = function (e, t, r, n, i, o) {
        var s,
          a = this.material
        l &&
          a &&
          ((s = new ae.Vector4(0, 0, -(r.far - 0.1), 1)).applyMatrix4(
            r.matrixWorld
          ),
          this.matrix.identity(),
          this.matrix.makeTranslation(s.x, s.y, s.z),
          this.matrixWorld.copy(this.matrix),
          this.modelViewMatrix.multiplyMatrices(
            r.matrixWorldInverse,
            this.matrixWorld
          ),
          this.normalMatrix.getNormalMatrix(this.modelViewMatrix),
          (s = l.matrixWorld),
          c.copy(s).invert(),
          (a.uniforms.aspectRatio.value = r.aspect),
          (a.uniforms.farZ.value = r.far),
          (a.uniforms.tanHalfFOV.value = Math.tan(
            0.5 * ae.MathUtils.DEG2RAD * r.fov
          )),
          (a.uniforms.matWorld2Volume.value = c))
      }),
        this._plane.layers.set(kr.LAYERS.VOLUME_BFPLANE)
    }
    return (
      p(r, [
        {
          key: '_initPlaneGeo',
          value: function (e, t) {
            var r = new ae.BufferGeometry()
            ;(e = e || 1), (t = t || 1)
            t = new Float32Array([
              -0.5 * e,
              0.5 * t,
              0,
              0.5 * e,
              0.5 * t,
              0,
              -0.5 * e,
              -0.5 * t,
              0,
              0.5 * e,
              -0.5 * t,
              0
            ])
            return (
              r.setAttribute('position', new ae.BufferAttribute(t, 3)),
              r.setIndex([0, 2, 1, 2, 3, 1]),
              r
            )
          }
        },
        {
          key: 'getMesh',
          value: function () {
            return this._plane
          }
        }
      ]),
      r
    )
  })()
  function ll(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var cl = (function () {
    x(n, Mr)
    var r = ll(n)
    function n(e, t) {
      return (
        G(this, n),
        ((e = r.call(this, e, t))._mesh = new ol()),
        e._mesh.setDataSource(t),
        e.add(e._mesh),
        (e._frame = new sl(e.getBoundaries().boundingBox, e._mesh.volumeInfo)),
        e.add(e._frame.getMesh()),
        e.showFrame(Q.now.modes.VD.frame),
        (e._farPlane = new al(e._mesh, 2, 2)),
        e.add(e._farPlane.getMesh()),
        e
      )
    }
    return (
      p(n, [
        {
          key: 'getBoundaries',
          value: function () {
            var e = this._dataSource.getBox(),
              t = new ae.Sphere()
            return e.getBoundingSphere(t), { boundingBox: e, boundingSphere: t }
          }
        },
        {
          key: 'getMesh',
          value: function () {
            return this._mesh
          }
        },
        {
          key: 'showFrame',
          value: function (e) {
            this._frame.getMesh().material.visible = e
          }
        }
      ]),
      n
    )
  })()
  function ul(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var hl = (function () {
    x(r, Ir)
    var t = ul(r)
    function r() {
      var e =
        0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : []
      return G(this, r), t.call(this, e, ['types'])
    }
    return (
      p(r, [
        {
          key: 'find',
          value: function (t) {
            var e = []
            if (t.type) e = this._dict.types[t.type.toLowerCase()] || []
            else if (t.source)
              return this._list.filter(function (e) {
                return e.canProbablyLoad && e.canProbablyLoad(t.source)
              })
            return Nr(e)
          }
        }
      ]),
      r
    )
  })()
  function fl(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var dl = (function () {
    x(i, T)
    var n = fl(i)
    function i(e, t) {
      var r
      return (
        G(this, i),
        ((r = n.call(this))._source = e),
        (r._options = t || {}),
        (r._abort = !1),
        (r._agent = null),
        r
      )
    }
    return (
      p(
        i,
        [
          {
            key: 'load',
            value: function () {
              return Promise.reject(
                new Error('Loading from this source is not implemented')
              )
            }
          },
          {
            key: 'abort',
            value: function () {
              ;(this._abort = !0), this._agent && this._agent.abort()
            }
          }
        ],
        [{ key: 'extractName', value: function (e) {} }]
      ),
      i
    )
  })()
  function pl(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Or(dl.prototype)
  Ke = (function () {
    x(n, dl)
    var r = pl(n)
    function n(e, t) {
      return (
        G(this, n),
        (t = (e = r.call(this, e, t))._options),
        (e._binary = !0 === t.binary),
        e
      )
    }
    return (
      p(
        n,
        [
          {
            key: 'load',
            value: function () {
              var i = this
              return new Promise(function (e, t) {
                if (i._abort) throw new Error('Loading aborted')
                var r = i._source,
                  n = (i._agent = new FileReader())
                n.addEventListener('load', function () {
                  e(n.result)
                }),
                  n.addEventListener('error', function () {
                    t(n.error)
                  }),
                  n.addEventListener('abort', function () {
                    t(new Error('Loading aborted'))
                  }),
                  n.addEventListener('progress', function (e) {
                    i.dispatchEvent(e)
                  }),
                  i._binary ? n.readAsArrayBuffer(r) : n.readAsText(r)
              })
            }
          }
        ],
        [
          {
            key: 'canProbablyLoad',
            value: function (e) {
              return (File && e instanceof File) || (Blob && e instanceof Blob)
            }
          },
          {
            key: 'extractName',
            value: function (e) {
              return e && e.name
            }
          }
        ]
      ),
      n
    )
  })()
  function ml(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Ke.types = ['file', 'blob']
  var yl = /^(https?|ftp):\/\//i,
    Cr = (function () {
      x(n, dl)
      var r = ml(n)
      function n(e, t) {
        return (
          G(this, n),
          (t = (e = r.call(this, e, t))._options),
          (e._binary = !0 === t.binary),
          e
        )
      }
      return (
        p(
          n,
          [
            {
              key: 'load',
              value: function () {
                var i = this
                return new Promise(function (e, t) {
                  if (i._abort) throw new Error('Loading aborted')
                  var r = i._source,
                    n = (i._agent = new XMLHttpRequest())
                  n.addEventListener('load', function () {
                    200 === n.status
                      ? e(n.response)
                      : t(
                          new Error(
                            'HTTP '
                              .concat(n.status, ' while fetching ')
                              .concat(r)
                          )
                        )
                  }),
                    n.addEventListener('error', function () {
                      t(new Error('HTTP request failed'))
                    }),
                    n.addEventListener('abort', function () {
                      t(new Error('Loading aborted'))
                    }),
                    n.addEventListener('progress', function (e) {
                      i.dispatchEvent(e)
                    }),
                    n.open('GET', r),
                    i._binary
                      ? (n.responseType = 'arraybuffer')
                      : (n.responseType = 'text'),
                    n.send()
                })
              }
            }
          ],
          [
            {
              key: 'canProbablyLoad',
              value: function (e) {
                return b.default.isString(e) && yl.test(e)
              }
            },
            {
              key: 'extractName',
              value: function (e) {
                if (e) {
                  var t =
                    (e.indexOf('?') + 1 ||
                      e.lastIndexOf('#') + 1 ||
                      e.length + 1) - 1
                  return e.slice(e.lastIndexOf('/', t) + 1, t)
                }
              }
            }
          ]
        ),
        n
      )
    })()
  function _l(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Cr.types = ['url']
  xr = (function () {
    x(t, dl)
    var e = _l(t)
    function t() {
      return G(this, t), e.apply(this, arguments)
    }
    return (
      p(
        t,
        [
          {
            key: 'load',
            value: function () {
              var t = this
              return new Promise(function (e) {
                if (t._abort) throw new Error('Loading aborted')
                e(t._source)
              })
            }
          }
        ],
        [
          {
            key: 'canProbablyLoad',
            value: function (e) {
              return !1
            }
          }
        ]
      ),
      t
    )
  })()
  xr.types = ['immediate']
  Xr = new hl([Ke, Cr, xr])
  function vl(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var gn = (function () {
      x(r, Ir)
      var t = vl(r)
      function r() {
        var e =
          0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : []
        return G(this, r), t.call(this, e, ['formats', 'extensions'])
      }
      return (
        p(r, [
          {
            key: 'find',
            value: function (t) {
              var e = []
              return (
                t.format
                  ? (e = this._dict.formats[t.format.toLowerCase()] || [])
                  : t.ext &&
                    (e = this._dict.extensions[t.ext.toLowerCase()] || []),
                0 === e.length && !t.format && t.data
                  ? this._list.filter(function (e) {
                      return e.canProbablyParse && e.canProbablyParse(t.data)
                    })
                  : Nr(e)
              )
            }
          }
        ]),
        r
      )
    })(),
    gl = (function () {
      function r(e, t) {
        G(this, r),
          (this._data = e),
          (this._options = t || {}),
          (this._abort = !1)
      }
      return (
        p(r, [
          {
            key: 'parseSync',
            value: function () {
              throw new Error('Parsing this type of data is not implemented')
            }
          },
          {
            key: 'parse',
            value: function () {
              var r = this
              return new Promise(function (e, t) {
                setTimeout(function () {
                  try {
                    return r._abort
                      ? t(new Error('Parsing aborted'))
                      : e(r.parseSync())
                  } catch (e) {
                    return t(e)
                  }
                })
              })
            }
          },
          {
            key: 'getModel',
            value: function () {
              return this.model._parseHeader(this._data), this.model
            }
          },
          {
            key: 'abort',
            value: function () {
              this._abort = !0
            }
          }
        ]),
        r
      )
    })()
  Or(gl.prototype)
  Vn = (function () {
    function e() {
      G(this, e),
        (this.matrices = []),
        (this._matrix = null),
        (this._matrixIndex = -1)
    }
    return (
      p(e, [
        {
          key: 'parse',
          value: function (e) {
            var t,
              r,
              n = this._matrix
            '  SMTRY' === e.readString(12, 18) &&
              ((t = e.readCharCode(19) - 49),
              (r = e.readString(20, 80).trim().split(/\s+/)),
              (e = parseInt(r[0], 10)),
              (null !== this._matrix && e === this._matrixIndex) ||
                ((this._matrixIndex = e),
                (this._matrix = n = new ae.Matrix4()),
                (this.matrices[this.matrices.length] = n)),
              ((n = n.elements)[t] = parseFloat(r[1])),
              (n[4 + t] = parseFloat(r[2])),
              (n[8 + t] = parseFloat(r[3])),
              (n[12 + t] = parseFloat(r[4])))
          }
        }
      ]),
      e
    )
  })()
  Vn.prototype.id = 290
  var xl = hr.Assembly,
    jn = (function () {
      function t(e) {
        G(this, t),
          (this._complex = e),
          (this.assemblies = []),
          (this._assembly = null),
          (this._matrix = null),
          (this._matrixIndex = -1)
      }
      return (
        p(t, [
          {
            key: 'parse',
            value: function (e) {
              var t = this._assembly,
                r = this._matrix
              if (t && '  BIOMT' === e.readString(12, 18)) {
                var n = e.readCharCode(19) - 49,
                  i = e.readString(20, 80).trim().split(/\s+/),
                  o = parseInt(i[0], 10)
                ;(null !== this._matrix && o === this._matrixIndex) ||
                  ((this._matrixIndex = o),
                  (this._matrix = r = new ae.Matrix4()),
                  t.addMatrix(r))
                r = r.elements
                ;(r[n] = parseFloat(i[1])),
                  (r[4 + n] = parseFloat(i[2])),
                  (r[8 + n] = parseFloat(i[3])),
                  (r[12 + n] = parseFloat(i[4]))
              } else if (t && 'CHAINS:' === e.readString(35, 41))
                for (
                  var s = e.readString(42, 80).split(','), a = 0, l = s.length;
                  a < l;
                  ++a
                ) {
                  var c = s[a].trim()
                  0 < c.length && t.addChain(c)
                }
              else
                'BIOMOLECULE:' === e.readString(12, 23) &&
                  ((this._matrix = null),
                  (this._matrixIndex = -1),
                  (this._assembly = t = new xl(this._complex)),
                  this.assemblies.push(t))
            }
          }
        ]),
        t
      )
    })()
  jn.prototype.id = 350
  var bl = (function () {
    function t(e) {
      G(this, t),
        (this._data = e),
        (this._start = 0),
        (this._nextCR = -1),
        (this._nextLF = -1),
        (this._next = -1),
        (this._end = e.length),
        this.next()
    }
    return (
      p(t, [
        {
          key: 'readLine',
          value: function () {
            return this._data.slice(this._start, this._next)
          }
        },
        {
          key: 'readChar',
          value: function (e) {
            return (e = this._start + e - 1) < this._next ? this._data[e] : ' '
          }
        },
        {
          key: 'readCharCode',
          value: function (e) {
            return (e = this._start + e - 1) < this._next
              ? this._data.charCodeAt(e)
              : 32
          }
        },
        {
          key: 'readString',
          value: function (e, t) {
            ;(e = this._start + e - 1), (t = this._start + t)
            return this._data.slice(e, t < this._next ? t : this._next)
          }
        },
        {
          key: 'readInt',
          value: function (e, t) {
            return parseInt(this.readString(e, t), 10)
          }
        },
        {
          key: 'readFloat',
          value: function (e, t) {
            return parseFloat(this.readString(e, t))
          }
        },
        {
          key: 'end',
          value: function () {
            return this._start >= this._end
          }
        },
        {
          key: 'next',
          value: function () {
            var e = this._next + 1
            ;(this._start = e < this._end ? e : this._end),
              this._start > this._nextCR &&
                (this._nextCR =
                  (this._data.indexOf('\r', this._start) + 1 || this._end + 1) -
                  1),
              this._start > this._nextLF &&
                (this._nextLF =
                  (this._data.indexOf('\n', this._start) + 1 || this._end + 1) -
                  1),
              (this._next =
                this._nextCR + 1 < this._nextLF ? this._nextCR : this._nextLF)
          }
        }
      ]),
      t
    )
  })()
  function wl(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Sl = hr.Complex,
    Rl = hr.Element,
    Cl = hr.Helix,
    Al = hr.Sheet,
    El = hr.Strand,
    kl = hr.Bond,
    Tl = hr.Molecule
  var Pl = /^(HEADER\s|COMPND\s|REMARK\s|ATOM {2}|HETATM|MODEL )/i,
    Ml = { 290: Vn, 350: jn },
    ni = (function () {
      x(n, gl)
      var r = wl(n)
      function n(e, t) {
        return (
          G(this, n),
          ((t = r.call(this, e, t))._complex = null),
          (t._chain = null),
          (t._residue = null),
          (t._sheet = null),
          (t._serialAtomMap = null),
          (t._modelId = 1),
          (t._compaundFound = !1),
          (t._biomoleculeFound = !1),
          (t._allowedChainsIDs = null),
          (t._lastMolId = -1),
          (t._remarks = {}),
          (t._remark = null),
          (t._molecules = []),
          (t._molecule = null),
          (t._compndCurrToken = ''),
          (t._options.fileType = 'pdb'),
          t
        )
      }
      return (
        p(
          n,
          [
            {
              key: '_finalize',
              value: function () {
                this._fixBondsArray(), this._fixChains()
                var e = this._remarks[290]
                this._complex.symmetry = b.default.isUndefined(e)
                  ? []
                  : e.matrices
                e = this._remarks[350]
                ;(this._complex.units = this._complex.units.concat(
                  b.default.isUndefined(e) ? [] : e.assemblies
                )),
                  this._finalizeMolecules(),
                  this._complex.finalize({
                    needAutoBonding: !0,
                    detectAromaticLoops: this.settings.now.aromatic,
                    enableEditing: this.settings.now.editing,
                    serialAtomMap: this._serialAtomMap
                  })
              }
            },
            {
              key: '_finalizeMolecules',
              value: function () {
                for (
                  var e = {}, t = this._complex._chains, r = 0;
                  r < t.length;
                  ++r
                ) {
                  var n = t[r]
                  e[n._name] = n
                }
                for (r = 0; r < this._molecules.length; r++) {
                  for (
                    var i = this._molecules[r], o = [], s = 0;
                    s < i._chains.length;
                    s++
                  )
                    var a = e[i._chains[s]], o = o.concat(a._residues.slice())
                  var l = new Tl(this._complex, i._name, r + 1)
                  ;(l.residues = o), (this._complex._molecules[r] = l)
                }
              }
            },
            {
              key: '_fixChains',
              value: function () {
                for (
                  var e = {}, t = this._complex, r = 0;
                  r < t._chains.length;
                  r++
                ) {
                  var n = t._chains[r]
                  e[n._name.charCodeAt(0)] = n
                }
              }
            },
            {
              key: '_fixBondsArray',
              value: function () {
                for (
                  var e = (this._serialAtomMap = {}),
                    t = this._complex,
                    r = t._atoms,
                    n = 0,
                    i = r.length;
                  n < i;
                  ++n
                ) {
                  var o = r[n]
                  e[o.serial] = o
                }
                for (
                  var s = t._bonds, a = this.logger, l = 0, c = s.length;
                  l < c;
                  ++l
                ) {
                  var u = s[l]
                  u._right < u._left && a.debug('_fixBondsArray: Logic error.'),
                    (u._left = e[u._left] || null),
                    (u._right = e[u._right] || null)
                }
              }
            },
            {
              key: '_parseATOM',
              value: function (e) {
                var t, r, n, i, o, s, a, l, c, u, h, f, d, p, m, y
                1 === this._modelId &&
                  ((r = (t = 72 === e.readCharCode(1))
                    ? e.readInt(7, 11)
                    : e.readInt(6, 11)),
                  (f = e.readString(13, 16)),
                  (n = e.readChar(17)),
                  (i = e.readString(18, 20).trim()),
                  (m = e.readChar(22)),
                  (o = e.readInt(23, 26)),
                  (s = e.readChar(27)),
                  (a = e.readFloat(31, 38)),
                  (l = e.readFloat(39, 46)),
                  (y = e.readFloat(47, 54)),
                  (c = e.readFloat(55, 60)),
                  (u = e.readFloat(61, 66)),
                  (p =
                    e.readString(77, 78).trim() ||
                    ((d = 4 === (h = f).trim().length),
                    h.slice(0, d ? 1 : 2).trim())),
                  (h = e.readInt(79, 80) || 0),
                  (this.settings.now.nowater && ('HOH' === i || 'WAT' === i)) ||
                    ((f = f.trim()),
                    (d = Rl.getByName(p)),
                    (e = Rl.Role[f]),
                    ((p = this._chain) && p.getName() === m) ||
                      ((this._chain = p =
                        this._complex.getChain(m) || this._complex.addChain(m)),
                      (this._residue = null)),
                    ((m = this._residue) &&
                      m.getSequence() === o &&
                      m.getICode() === s) ||
                      (this._residue = m = p.addResidue(i, o, s)),
                    (y = new ae.Vector3(a, l, y)),
                    m.addAtom(f, d, y, e, t, r, n, c, u, h)))
              }
            },
            {
              key: '_parseENDMDL',
              value: function () {
                this._modelId += 1
              }
            },
            {
              key: '_parseCONECT',
              value: function (e) {
                var t = e.readInt(7, 11),
                  r = e.readInt(12, 16),
                  n = e.readInt(17, 21),
                  i = e.readInt(22, 26),
                  o = e.readInt(27, 31),
                  e = this._complex
                r && t < r && e.addBond(t, r, 0, kl.BondType.UNKNOWN, !0),
                  n && t < n && e.addBond(t, n, 0, kl.BondType.UNKNOWN, !0),
                  i && t < i && e.addBond(t, i, 0, kl.BondType.UNKNOWN, !0),
                  o && t < o && e.addBond(t, o, 0, kl.BondType.UNKNOWN, !0)
              }
            },
            {
              key: '_parseCOMPND',
              value: function (e) {
                var t = e.readString(11, 80),
                  e = t.indexOf(':')
                ;(this._compndCurrToken =
                  0 < e ? t.substring(0, e).trim() : this._compndCurrToken),
                  'MOL_ID' === this._compndCurrToken
                    ? ((this._molecule = { _index: '', _chains: [] }),
                      (this._molecule._index = parseInt(
                        t.substring(e + 1, t.indexOf(';')),
                        10
                      )),
                      this._molecules.push(this._molecule))
                    : 'MOLECULE' === this._compndCurrToken &&
                      null != this._molecule
                    ? (this._molecule._name = t
                        .substring(e + 1, t.indexOf(';'))
                        .trim())
                    : 'CHAIN' === this._compndCurrToken &&
                      null != this._molecule &&
                      ((t = (t = (t =
                        ';' ===
                          (e = (t = t.substring(e + 1, 80).trim())[
                            t.length - 1
                          ]) || ',' === e
                          ? t.slice(0, -1)
                          : t).replace(/\s+/g, '')).split(',')),
                      (this._molecule._chains =
                        this._molecule._chains.concat(t)))
              }
            },
            {
              key: '_parseREMARK',
              value: function (e) {
                var t,
                  r = e.readInt(8, 10),
                  n = this._remarks[r]
                !b.default.isUndefined(n) ||
                  ('function' == typeof (t = Ml[r]) &&
                    (this._remarks[r] = n = new t(this._complex))),
                  b.default.isUndefined(n) || n.parse(e)
              }
            },
            {
              key: '_parseHELIX',
              value: function (e) {
                var t = this
                this._parseSTRUCTURE(e, [20, 22, 32, 34], function (e) {
                  t._complex.addHelix(e), t._complex.structures.push(e)
                })
              }
            },
            {
              key: '_parseSHEET',
              value: function (e) {
                var t = this
                this._parseSTRUCTURE(e, [22, 23, 33, 34], function (e) {
                  t._complex.addSheet(e)
                })
              }
            },
            {
              key: '_parseSTRUCTURE',
              value: function (e, t, r) {
                var n = e.readInt(8, 10),
                  i = e.readString(12, 14).trim(),
                  o = e.readString(41, 70).trim(),
                  s = e.readInt(72, 76),
                  a = e.readInt(39, 40),
                  l = e.readInt(15, 16),
                  c = e.readInt(42, 45),
                  u = e.readInt(57, 60),
                  h = e.readString(t[0], t[2] + 1).charCodeAt(0),
                  f = e.readString(t[2], t[2] + 1).charCodeAt(0),
                  d = e.readInt(t[1], t[1] + 3),
                  p = e.readString(t[1] + 4, t[1] + 4),
                  m = 0
                0 < p.length && (m = p.charCodeAt(0))
                var y,
                  _ = e.readInt(t[3], t[3] + 3),
                  v = 0
                0 < (p = e.readString(t[3] + 4, t[3] + 4)).length &&
                  (v = p.charCodeAt(0))
                p = this._sheet
                83 === e.readCharCode(1)
                  ? (null !== p &&
                      p.getName() !== i &&
                      (this._sheet = p = null),
                    null === p
                      ? ((this._sheet = y = new Al(i, l)), r(y))
                      : (y = p),
                    (u = new El(
                      y,
                      this._complex.getUnifiedSerial(h, d, m),
                      this._complex.getUnifiedSerial(f, _, v),
                      a,
                      c,
                      u
                    )),
                    y.addStrand(u),
                    this._complex.structures.push(u))
                  : r(
                      (y = new Cl(
                        a,
                        this._complex.getUnifiedSerial(h, d, m),
                        this._complex.getUnifiedSerial(f, _, v),
                        n,
                        i,
                        o,
                        s
                      ))
                    )
              }
            },
            {
              key: '_parseHEADER',
              value: function (e) {
                var t = this._complex.metadata
                ;(t.classification = e.readString(11, 50).trim()),
                  (t.date = e.readString(51, 59).trim())
                e = e.readString(63, 66).trim()
                ;(t.id = e) && (this._complex.name = e), (t.format = 'pdb')
              }
            },
            {
              key: '_parseTITLE',
              value: function (e) {
                var t = this._complex.metadata
                t.title = t.title || []
                var r = e.readInt(9, 10) || 1
                t.title[r - 1] = e.readString(11, 80).trim()
              }
            },
            {
              key: 'parseSync',
              value: function () {
                for (
                  var e = new bl(this._data), t = (this._complex = new Sl());
                  !e.end();

                ) {
                  var r = e.readString(1, 6),
                    r = n.tagParsers[r]
                  'function' == typeof r && r.call(this, e), e.next()
                }
                if (
                  (this._finalize(),
                  (this._serialAtomMap = null),
                  (this._sheet = null),
                  (this._residue = null),
                  (this._chain = null),
                  (this._complex = null),
                  0 === t.getAtomCount())
                )
                  throw new Error('The data does not contain valid atoms')
                return t
              }
            }
          ],
          [
            {
              key: 'canProbablyParse',
              value: function (e) {
                return b.default.isString(e) && Pl.test(e)
              }
            }
          ]
        ),
        n
      )
    })()
  function Nl(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(ni, 'tagParsers', {
    HEADER: ni.prototype._parseHEADER,
    'TITLE ': ni.prototype._parseTITLE,
    'ATOM  ': ni.prototype._parseATOM,
    HETATM: ni.prototype._parseATOM,
    ENDMDL: ni.prototype._parseENDMDL,
    CONECT: ni.prototype._parseCONECT,
    COMPND: ni.prototype._parseCOMPND,
    REMARK: ni.prototype._parseREMARK,
    'HELIX ': ni.prototype._parseHELIX,
    'SHEET ': ni.prototype._parseSHEET,
    'ATOM 1': ni.prototype._parseATOM,
    'ATOM 2': ni.prototype._parseATOM,
    'ATOM 3': ni.prototype._parseATOM,
    'ATOM 4': ni.prototype._parseATOM,
    'ATOM 5': ni.prototype._parseATOM,
    'ATOM 6': ni.prototype._parseATOM,
    'ATOM 7': ni.prototype._parseATOM,
    'ATOM 8': ni.prototype._parseATOM,
    'ATOM 9': ni.prototype._parseATOM
  }),
    (ni.formats = ['pdb']),
    (ni.extensions = ['.pdb', '.ent'])
  var Ll = hr.Complex,
    Il = hr.Element,
    Ol = hr.SGroup,
    Bl = hr.Bond,
    Vl = { A: 0, S: 1, D: 2, T: 3 },
    Dl = /\s*<\?xml\b[^?>]*\?>\s*<(?:cml|molecule)\b/i,
    li = (function () {
      x(n, gl)
      var r = Nl(n)
      function n(e, t) {
        return (
          G(this, n),
          ((t = r.call(this, e, t))._complex = null),
          (t._residue = null),
          (t._serialAtomMap = null),
          (t._modelId = 1),
          (t._lastMolId = -1),
          (t._readOnlyOneMolecule = !1),
          (t._options.fileType = 'cml'),
          t
        )
      }
      return (
        p(
          n,
          [
            {
              key: '_rebuidBondIndexes',
              value: function (e, t) {
                for (var r = e.length, n = 0; n < r; n++)
                  for (var i = e[n].id, o = t.length, s = 0; s < o; s++) {
                    var a = t[s].atomRefs2.split(' ')
                    a[0] === i && (t[s].start = n), a[1] === i && (t[s].end = n)
                  }
              }
            },
            {
              key: '_createSGroup',
              value: function (e, t) {
                var r = new Ol(
                  e.id,
                  e.fieldData,
                  new ae.Vector3(parseFloat(e.x), parseFloat(e.y), 0),
                  e.atomRefs,
                  e
                )
                'Relative' === e.placement &&
                  (r._center = new ae.Vector3(0, 0, 0)),
                  'MDLBG_FRAGMENT_CHARGE' === e.fieldName &&
                    (r._charge = parseInt(e.fieldData, 10) || 0),
                  'MDLBG_FRAGMENT_COEFFICIENT' === e.fieldName &&
                    (r._repeat = parseInt(e.fieldData, 10) || 1),
                  t.push(r)
              }
            },
            {
              key: '_extractSGroup',
              value: function (e, t) {
                if ((Array.isArray(t) || (t = []), e))
                  if (Array.isArray(e))
                    for (var r = e.length, n = 0; n < r; n++)
                      e[n].molecule &&
                        (t = t.concat(this._extractSGroup(e[n].molecule))),
                        this._createSGroup(e[n], t)
                  else
                    e.molecule &&
                      e.molecule &&
                      (t = t.concat(this._extractSGroup(e.molecule))),
                      this._createSGroup(e, t)
                return t
              }
            },
            {
              key: '_extractSGroups',
              value: function (e, t) {
                for (
                  var r = this._extractSGroup(e), n = t.length, i = 0;
                  i < n;
                  i++
                )
                  for (var o = t[i].id, s = 0; s < r.length; s++)
                    r[s]._atoms.split(' ')[0] === o &&
                      (t[i].sgroupRef || (t[i].sgroupRef = []),
                      t[i].sgroupRef.push(r[s]))
                var a,
                  l = {},
                  c = null,
                  u = new ae.Vector3(1e8, 1e8, 1e8),
                  h = new ae.Vector3(-1e8, -1e8, -1e8)
                function f(e) {
                  ;(c = l[e]) && r[s]._atoms.push(c.a)
                }
                function d(e) {
                  ;(c = l[e]) &&
                    (u.set(
                      Math.min(u.x, c.x),
                      Math.min(u.y, c.y),
                      Math.min(u.z, c.z)
                    ),
                    h.set(
                      Math.max(h.x, c.x),
                      Math.max(h.y, c.y),
                      Math.max(h.z, c.z)
                    ),
                    f(e))
                }
                for (i = 0; i < t.length; i++)
                  (l[t[i].id] = {}),
                    (l[t[i].id].x = t[i].x2),
                    t[i].x3 && (l[t[i].id].x = t[i].x3),
                    (l[t[i].id].x = parseFloat(l[t[i].id].x)),
                    (l[t[i].id].y = t[i].y2),
                    t[i].y3 && (l[t[i].id].y = t[i].y3),
                    (l[t[i].id].y = parseFloat(l[t[i].id].y)),
                    (l[t[i].id].z = '0.0'),
                    t[i].z3 && (l[t[i].id].z = t[i].z3),
                    (l[t[i].id].z = parseFloat(l[t[i].id].z)),
                    (l[t[i].id].a = t[i])
                for (s = 0; s < r.length; s++)
                  null !== r[s]._center
                    ? (u.set(1e8, 1e8, 1e8),
                      h.set(-1e8, -1e8, -1e8),
                      (a = r[s]._atoms.split(' ')),
                      (r[s]._atoms = []),
                      a.forEach(d),
                      r[s]._center.addVectors(u, h),
                      r[s]._center.multiplyScalar(0.5))
                    : ((a = r[s]._atoms.split(' ')),
                      (r[s]._atoms = []),
                      a.forEach(f))
                l = null
              }
            },
            {
              key: '_traverseData',
              value: function (e) {
                function a(e, t) {
                  if ('#text' !== e.nodeName || '' !== e.nodeValue.trim()) {
                    var r,
                      n,
                      i = {},
                      o = t[(i.xmlNode = e).nodeName]
                    if (
                      (o
                        ? '[object Array]' !==
                          Object.prototype.toString.apply(o)
                          ? (t[e.nodeName] = [o, i])
                          : t[e.nodeName].push(i)
                        : (t[e.nodeName] = i),
                      e.attributes)
                    )
                      for (r = e.attributes.length, n = 0; n < r; n++) {
                        var s = e.attributes[n]
                        i[s.nodeName] = s.nodeValue
                      }
                    for (r = e.childNodes.length, n = 0; n < r; n++)
                      a(e.childNodes[n], i)
                  }
                }
                var t = {}
                return e.childNodes.length && a(e.childNodes[0], t), t
              }
            },
            {
              key: '_findSuitableMolecule',
              value: function (e, t) {
                for (var r in e)
                  if ('xmlNode' !== r)
                    if ('molecule' === r) {
                      if (
                        e.molecule &&
                        (e.molecule.atomArray &&
                          e.molecule.atomArray.atom &&
                          t.push(e),
                        Array.isArray(e.molecule))
                      )
                        for (var n = 0; n < e.molecule.length; n++)
                          e.molecule[n].atomArray &&
                            e.molecule[n].atomArray.atom &&
                            t.push({ molecule: e.molecule[n] })
                    } else
                      e[r] &&
                        null !== e[r] &&
                        'object' === w(e[r]) &&
                        this._findSuitableMolecule(e[r], t)
              }
            },
            {
              key: '_selectComponents',
              value: function (e) {
                var h = new DOMParser().parseFromString(e, 'application/xml'),
                  t = this._traverseData(h),
                  f = this
                function r(e) {
                  var t,
                    r = []
                  if (
                    e.molecule &&
                    e.molecule.atomArray &&
                    e.molecule.atomArray.atom
                  )
                    Array.isArray(e.molecule.atomArray.atom)
                      ? (r = e.molecule.atomArray.atom)
                      : r.push(e.molecule.atomArray.atom)
                  else if (!e.molecule) {
                    var n = { atomLabels: null, labelsCount: 1 }
                    return n
                  }
                  e.molecule.molecule &&
                    f._extractSGroups(e.molecule.molecule, r)
                  for (var i = r.length, o = 0; o < i; o++)
                    (t = r[o]).edges = []
                  var s = []
                  e.molecule.bondArray &&
                    e.molecule.bondArray.bond &&
                    (Array.isArray(e.molecule.bondArray.bond)
                      ? (s = e.molecule.bondArray.bond)
                      : s.push(e.molecule.bondArray.bond)),
                    (i = s.length),
                    f._rebuidBondIndexes(r, s)
                  for (var a, l, c = 0; c < i; c++)
                    (l = s[c]),
                      (t = r[l.start]) &&
                        (t.edges.push(l.end),
                        (t = r[l.end]) && (t.edges.push(l.start), 1)) &&
                        ((a = l.xmlNode.getAttribute('order')),
                        (l = parseInt(a, 10)),
                        (s[c].order = 0),
                        (s[c].type = Bl.BondType.UNKNOWN),
                        1 < l
                          ? (s[c].order = l)
                          : void 0 !== (l = Vl[a]) &&
                            ((s[c].order = l),
                            'A' === a && (s[c].type = Bl.BondType.AROMATIC)))
                  for (var i = r.length, u = 0; u < i; u++)
                    (t = r[u]).edges.sort()
                  ;(n = f._breadWidthSearch(r, 0)), (e = {})
                  return (
                    (e.atoms = r),
                    (e.bonds = s),
                    (e.labels = n.atomLabels),
                    (e.count = Math.min(1, n.labelsCount)),
                    (e.curr = -1),
                    (e.originalCML = h),
                    e
                  )
                }
                var e = t.cml || t,
                  n = [],
                  t = []
                return (
                  this._findSuitableMolecule(e, t),
                  this._readOnlyOneMolecule &&
                    1 < t.length &&
                    t.splice(1, t.length - 1),
                  t.forEach(function (e) {
                    e = r(e)
                    0 < e.atoms.length && n.push(e)
                  }),
                  n
                )
              }
            },
            {
              key: '_packLabel',
              value: function (e, t) {
                return (t << 16) + e
              }
            },
            {
              key: '_unpackLabel',
              value: function (e) {
                return { molId: e >>> 16, compId: 65535 & e }
              }
            },
            {
              key: '_breadWidthSearch',
              value: function (e, t) {
                var r = new Array(e.length)
                for (a = 0; a < r.length; a++) r[a] = this._packLabel(0, t)
                for (var n = [], i = 0, o = e.length; 0 < o; ) {
                  i++
                  for (var s = -1, a = 0; a < r.length; a++)
                    if (0 === this._unpackLabel(r[a]).compId) {
                      s = a
                      break
                    }
                  if (s < 0) break
                  for (
                    n.push(e[s]), r[s] = this._packLabel(i, t), o--;
                    0 < n.length;

                  ) {
                    var l = n.shift()
                    if (l)
                      for (var c = 0; c < l.edges.length; c++)
                        r[l.edges[c]] !== i &&
                          (n.push(e[l.edges[c]]), (r[l.edges[c]] = i), o--)
                  }
                }
                var u = {}
                return (u.atomLabels = r), (u.labelsCount = i), u
              }
            },
            {
              key: '_parseBond',
              value: function (e, t, r, n) {
                0 <= e &&
                  ((t = [Math.min(e, t), Math.max(e, t)]),
                  this._complex.addBond(t[0], t[1], r, n, !0))
              }
            },
            {
              key: '_fixBondsArray',
              value: function () {
                for (
                  var e = (this._serialAtomMap = {}),
                    t = this._complex,
                    r = t._atoms,
                    n = 0,
                    i = r.length;
                  n < i;
                  ++n
                ) {
                  var o = r[n]
                  e[o.serial] = o
                }
                for (
                  var s = t._bonds, a = this.logger, l = 0, c = s.length;
                  l < c;
                  ++l
                ) {
                  var u = s[l]
                  u._right < u._left && a.debug('_fixBondsArray: Logic error.'),
                    (u._left = e[u._left] || null),
                    (u._right = e[u._right] || null)
                }
              }
            },
            {
              key: '_parseSet',
              value: function (e) {
                var t = (this._complex = new Ll()),
                  r = e,
                  n = r.curr,
                  i = r.atoms,
                  o = r.labels,
                  s = null,
                  a = i.length
                for (var l = {}, c = [], u = 0; u < a; u++) c.push(u)
                for (
                  c.sort(function (e, t) {
                    return o[e] - o[t]
                  }),
                    u = 0;
                  u < a;
                  u++
                ) {
                  var h = o[c[u]]
                  if (
                    this._unpackLabel(h).molId === this._unpackLabel(n).molId
                  ) {
                    var f,
                      d,
                      p,
                      m = (s = i[c[u]]).elementType
                    if (s.sgroupRef)
                      for (var y = s.sgroupRef.length, _ = 0; _ < y; ++_)
                        t._sgroups.push(s.sgroupRef[_])
                    ;(s.x3 || s.x2) &&
                      (0,
                      1 ===
                        (f = (p = this._unpackLabel(h).compId).toString())
                          .length && (f = '0'.concat(f)),
                      (d = 'N'.concat(f)),
                      ((h = l[' ']) && ' ' === h.getName()) ||
                        ((l[' '] = h =
                          this._complex.getChain(' ') ||
                          this._complex.addChain(' ')),
                        (this._residue = null)),
                      ((f = this._residue) &&
                        f.getSequence() === p &&
                        ' ' === f.getICode()) ||
                        (this._residue = f = h.addResidue(d, p, ' ')),
                      (h = null),
                      s.x3
                        ? (h = new ae.Vector3(
                            parseFloat(s.x3),
                            parseFloat(s.y3),
                            parseFloat(s.z3)
                          ))
                        : s.x2 &&
                          (h = new ae.Vector3(
                            parseFloat(s.x2),
                            parseFloat(s.y2),
                            0
                          )),
                      (d = Il.ByName[s.elementType.toUpperCase()]) ||
                        (((d = JSON.parse(
                          JSON.stringify(
                            Il.ByName[
                              Object.keys(Il.ByName)[
                                Object.keys(Il.ByName).length - 1
                              ]
                            ]
                          )
                        )).number += 1),
                        (d.name = s.elementType.toUpperCase()),
                        (d.fullName = 'Unknown'),
                        (Il.ByName[s.elementType.toUpperCase()] = d)),
                      (p = parseInt(s.id.replace(/[^0-9]/, ''), 10)),
                      (p = f.addAtom(m, d, h, Il.Role.SG, !0, p, ' ', 1, 0, 0)),
                      s.hydrogenCount &&
                        (p.hydrogenCount = parseInt(s.hydrogenCount, 10)),
                      s.mrvValence && (p.valence = parseInt(s.mrvValence, 10)),
                      ((p = p).xmlNodeRef = s).x2 &&
                        ((s.x3 = s.x2), delete s.x2),
                      s.y2 && ((s.y3 = s.y2), delete s.y2),
                      s.z3 || (s.z3 = '0.0'),
                      (s.complexAtom = p))
                  }
                }
                for (l = null, u = 0; u < r.bonds.length; u++) {
                  var v = r.bonds[u]
                  this._unpackLabel(o[v.start]).molId ===
                    this._unpackLabel(n).molId &&
                    this._unpackLabel(o[v.end]).molId ===
                      this._unpackLabel(n).molId &&
                    (s = i[v.start]) &&
                    i[v.end] &&
                    this._parseBond(
                      parseInt(s.id.replace(/[^0-9]/, ''), 10),
                      parseInt(i[v.end].id.replace(/[^0-9]/, ''), 10),
                      v.order,
                      v.type
                    )
                }
                for (u = 0; u < this._complex.getSGroupCount(); u++)
                  for (
                    var g = this._complex.getSGroups()[u], x = 0;
                    x < g._atoms.length;
                    x++
                  )
                    g._atoms[x] = g._atoms[x].complexAtom
                for (u = 0; u < a; u++)
                  this._unpackLabel(o[u]).molId ===
                    this._unpackLabel(n).molId &&
                    (((s = i[u]).complexAtom = null), delete s.complexAtom)
                return (
                  (this._complex.originalCML = r.originalCML),
                  this._fixBondsArray(),
                  t.finalize({
                    needAutoBonding: !1,
                    detectAromaticLoops: this.settings.now.aromatic,
                    enableEditing: this.settings.now.editing,
                    serialAtomMap: this._serialAtomMap
                  }),
                  (this._serialAtomMap = null),
                  (this._complex = null),
                  t
                )
              }
            },
            {
              key: 'parseSync',
              value: function () {
                var r = [],
                  n = this
                this._selectComponents(this._data).forEach(function (e) {
                  ;(e.curr = 2), 0 === e.count && (e.count = 1)
                  for (var t = 0; t < e.count; t++)
                    (e.curr = t + 1), r.push(n._parseSet(e, !1))
                })
                var t = 0
                if (
                  (r.forEach(function (e) {
                    t += e.getAtomCount()
                  }),
                  t <= 0)
                )
                  throw new Error('The data does not contain valid atoms')
                if (1 < r.length) {
                  var e = new Ll()
                  return (
                    e.joinComplexes(r), (e.originalCML = r[0].originalCML), e
                  )
                }
                return 1 === r.length ? r[0] : new Ll()
              }
            }
          ],
          [
            {
              key: 'canProbablyParse',
              value: function (e) {
                return b.default.isString(e) && Dl.test(e)
              }
            }
          ]
        ),
        n
      )
    })()
  ;(li.formats = ['cml']), (li.extensions = ['.cml'])
  var zl,
    Fl,
    Ul,
    Gl,
    _i = { exports: {} }
  function jl(e, t, r) {
    for (var n = (e.byteLength, 0), i = r.length; n < i; n++) {
      var o = r.charCodeAt(n)
      if (o < 128) e.setUint8(t++, ((o >>> 0) & 127) | 0)
      else if (o < 2048)
        e.setUint8(t++, ((o >>> 6) & 31) | 192),
          e.setUint8(t++, ((o >>> 0) & 63) | 128)
      else if (o < 65536)
        e.setUint8(t++, ((o >>> 12) & 15) | 224),
          e.setUint8(t++, ((o >>> 6) & 63) | 128),
          e.setUint8(t++, ((o >>> 0) & 63) | 128)
      else {
        if (!(o < 1114112)) throw new Error('bad codepoint ' + o)
        e.setUint8(t++, ((o >>> 18) & 7) | 240),
          e.setUint8(t++, ((o >>> 12) & 63) | 128),
          e.setUint8(t++, ((o >>> 6) & 63) | 128),
          e.setUint8(t++, ((o >>> 0) & 63) | 128)
      }
    }
  }
  function Hl(e) {
    for (var t = 0, r = 0, n = e.length; r < n; r++) {
      var i = e.charCodeAt(r)
      if (i < 128) t += 1
      else if (i < 2048) t += 2
      else if (i < 65536) t += 3
      else {
        if (!(i < 1114112)) throw new Error('bad codepoint ' + i)
        t += 4
      }
    }
    return t
  }
  function Wl(e) {
    var t = new ArrayBuffer(
      (function e(t) {
        var r = typeof t
        if ('string' == r) {
          if ((n = Hl(t)) < 32) return 1 + n
          if (n < 256) return 2 + n
          if (n < 65536) return 3 + n
          if (n < 4294967296) return 5 + n
        }
        if (t instanceof Uint8Array) {
          if ((n = t.byteLength) < 256) return 2 + n
          if (n < 65536) return 3 + n
          if (n < 4294967296) return 5 + n
        }
        if ('number' == r) {
          if (Math.floor(t) !== t) return 9
          if (0 <= t) {
            if (t < 128) return 1
            if (t < 256) return 2
            if (t < 65536) return 3
            if (t < 4294967296) return 5
            throw new Error('Number too big 0x' + t.toString(16))
          }
          if (-32 <= t) return 1
          if (-128 <= t) return 2
          if (-32768 <= t) return 3
          if (-2147483648 <= t) return 5
          throw new Error('Number too small -0x' + t.toString(16).substr(1))
        }
        if ('boolean' == r || null === t) return 1
        if ('object' != r) throw new Error('Unknown type ' + r)
        var n,
          i = 0
        if (Array.isArray(t)) {
          n = t.length
          for (var o = 0; o < n; o++) i += e(t[o])
        } else {
          var s = Object.keys(t)
          for (n = s.length, o = 0; o < n; o++) {
            var a = s[o]
            i += e(a) + e(t[a])
          }
        }
        if (n < 16) return 1 + i
        if (n < 65536) return 3 + i
        if (n < 4294967296) return 5 + i
        throw new Error('Array or object too long 0x' + n.toString(16))
      })(e)
    )
    return (
      (function e(t, r, n) {
        var i = typeof t
        if ('string' == i) {
          if ((o = Hl(t)) < 32)
            return r.setUint8(n, 160 | o), jl(r, n + 1, t), 1 + o
          if (o < 256)
            return (
              r.setUint8(n, 217), r.setUint8(n + 1, o), jl(r, n + 2, t), 2 + o
            )
          if (o < 65536)
            return (
              r.setUint8(n, 218), r.setUint16(n + 1, o), jl(r, n + 3, t), 3 + o
            )
          if (o < 4294967296)
            return (
              r.setUint8(n, 219), r.setUint32(n + 1, o), jl(r, n + 5, t), 5 + o
            )
        }
        if (t instanceof Uint8Array) {
          var o = t.byteLength,
            s = new Uint8Array(r.buffer)
          if (o < 256)
            return (
              r.setUint8(n, 196), r.setUint8(n + 1, o), s.set(t, n + 2), 2 + o
            )
          if (o < 65536)
            return (
              r.setUint8(n, 197), r.setUint16(n + 1, o), s.set(t, n + 3), 3 + o
            )
          if (o < 4294967296)
            return (
              r.setUint8(n, 198), r.setUint32(n + 1, o), s.set(t, n + 5), 5 + o
            )
        }
        if ('number' == i) {
          if (!isFinite(t)) throw new Error('Number not finite: ' + t)
          if (Math.floor(t) !== t)
            return r.setUint8(n, 203), r.setFloat64(n + 1, t), 9
          if (0 <= t) {
            if (t < 128) return r.setUint8(n, t), 1
            if (t < 256) return r.setUint8(n, 204), r.setUint8(n + 1, t), 2
            if (t < 65536) return r.setUint8(n, 205), r.setUint16(n + 1, t), 3
            if (t < 4294967296)
              return r.setUint8(n, 206), r.setUint32(n + 1, t), 5
            throw new Error('Number too big 0x' + t.toString(16))
          }
          if (-32 <= t) return r.setInt8(n, t), 1
          if (-128 <= t) return r.setUint8(n, 208), r.setInt8(n + 1, t), 2
          if (-32768 <= t) return r.setUint8(n, 209), r.setInt16(n + 1, t), 3
          if (-2147483648 <= t)
            return r.setUint8(n, 210), r.setInt32(n + 1, t), 5
          throw new Error('Number too small -0x' + (-t).toString(16).substr(1))
        }
        if (null === t) return r.setUint8(n, 192), 1
        if ('boolean' == i) return r.setUint8(n, t ? 195 : 194), 1
        if ('object' != i) throw new Error('Unknown type ' + i)
        var a,
          l = 0,
          i = Array.isArray(t)
        if (
          ((o = (i ? t : (a = Object.keys(t))).length) < 16
            ? (r.setUint8(n, o | (i ? 144 : 128)), (l = 1))
            : o < 65536
            ? (r.setUint8(n, i ? 220 : 222), r.setUint16(n + 1, o), (l = 3))
            : o < 4294967296 &&
              (r.setUint8(n, i ? 221 : 223), r.setUint32(n + 1, o), (l = 5)),
          i)
        )
          for (var c = 0; c < o; c++) l += e(t[c], r, n + l)
        else
          for (c = 0; c < o; c++) {
            var u = a[c]
            ;(l += e(u, r, n + l)), (l += e(t[u], r, n + l))
          }
        return l
      })(e, new DataView(t), 0),
      new Uint8Array(t)
    )
  }
  function Yl(e, t, r) {
    return t ? new e(t.buffer, t.byteOffset, t.byteLength / (r || 1)) : void 0
  }
  function Xl(e) {
    return Yl(DataView, e)
  }
  function ql(e) {
    return Yl(Uint8Array, e)
  }
  function $l(e) {
    return Yl(Int8Array, e)
  }
  function Zl(e) {
    return Yl(Int32Array, e, 4)
  }
  function Kl(e, t) {
    var r = e.length / 2
    t = t || new Int16Array(r)
    for (var n = 0, i = 0; n < r; ++n, i += 2)
      t[n] = (e[i] << 8) ^ (e[i + 1] << 0)
    return t
  }
  function Ql(e, t) {
    var r = e.length / 4
    t = t || new Int32Array(r)
    for (var n = 0, i = 0; n < r; ++n, i += 4)
      t[n] = (e[i] << 24) ^ (e[i + 1] << 16) ^ (e[i + 2] << 8) ^ (e[i + 3] << 0)
    return t
  }
  function Jl(e, t) {
    for (
      var r = e.length, n = Xl((t = t || new Uint8Array(4 * r))), i = 0;
      i < r;
      ++i
    )
      n.setInt32(4 * i, e[i])
    return ql(t)
  }
  function ec(e, t, r) {
    var n = e.length,
      i = 1 / t
    r = r || new Float32Array(n)
    for (var o = 0; o < n; ++o) r[o] = e[o] * i
    return r
  }
  function tc(e, t, r) {
    var n = e.length
    r = r || new Int32Array(n)
    for (var i = 0; i < n; ++i) r[i] = Math.round(e[i] * t)
    return r
  }
  function rc(e, t) {
    if (!t) {
      for (var r = 0, n = 0, i = e.length; n < i; n += 2) r += e[n + 1]
      t = new e.constructor(r)
    }
    var o = 0
    for (n = 0, i = e.length; n < i; n += 2)
      for (var s = e[n], a = e[n + 1], l = 0; l < a; ++l) (t[o] = s), ++o
    return t
  }
  function nc(e) {
    if (0 === e.length) return new Int32Array()
    for (var t = 2, r = 1, n = e.length; r < n; ++r)
      e[r - 1] !== e[r] && (t += 2)
    var i = new Int32Array(t),
      o = 0,
      s = 1
    for (r = 1, n = e.length; r < n; ++r)
      e[r - 1] !== e[r]
        ? ((i[o] = e[r - 1]), (i[o + 1] = s), (s = 1), (o += 2))
        : ++s
    return (i[o] = e[e.length - 1]), (i[o + 1] = s), i
  }
  function ic(e, t) {
    var r = e.length
    ;(t = t || new e.constructor(r)), r && (t[0] = e[0])
    for (var n = 1; n < r; ++n) t[n] = e[n] + t[n - 1]
    return t
  }
  function oc(e, t) {
    var r = e.length
    ;(t = t || new e.constructor(r))[0] = e[0]
    for (var n = 1; n < r; ++n) t[n] = e[n] - e[n - 1]
    return t
  }
  function sc(e, t) {
    var r,
      n = e instanceof Int8Array ? 127 : 32767,
      i = -n - 1,
      o = e.length
    if (!t) {
      for (var s = 0, a = 0; a < o; ++a) e[a] < n && e[a] > i && ++s
      t = new Int32Array(s)
    }
    for (r = a = 0; a < o; ) {
      for (var l = 0; e[a] === n || e[a] === i; ) (l += e[a]), ++a
      ;(l += e[a]), ++a, (t[r] = l), ++r
    }
    return t
  }
  function ac(e, t, r) {
    return ec(sc(e, Zl(r)), t, r)
  }
  function lc(e, t, r) {
    var e = sc(e, Zl(r))
    return (
      (r = e), (t = t), (e = Yl(Float32Array, e, 4)), ec(ic(r, Zl(e)), t, e)
    )
  }
  function cc(e, t, r) {
    return (function (e, t) {
      for (
        var r = t ? 127 : 32767, n = -r - 1, i = e.length, o = 0, s = 0;
        s < i;
        ++s
      )
        0 === (a = e[s])
          ? ++o
          : (o +=
              a === r || a === n
                ? 2
                : 0 < a
                ? Math.ceil(a / r)
                : Math.ceil(a / n))
      var a,
        l = new (t ? Int8Array : Int16Array)(o),
        c = 0
      for (s = 0; s < i; ++s) {
        if (0 <= (a = e[s])) for (; r <= a; ) (l[c] = r), ++c, (a -= r)
        else for (; a <= n; ) (l[c] = n), ++c, (a -= n)
        ;(l[c] = a), ++c
      }
      return l
    })(oc(tc(e, t), n), r)
    var n
  }
  function uc(e, t, r, n) {
    var i = new ArrayBuffer(12 + n.byteLength),
      o = new Uint8Array(i),
      i = new DataView(i)
    return i.setInt32(0, e), i.setInt32(4, t), r && o.set(r, 8), o.set(n, 12), o
  }
  function hc(e) {
    return uc(2, e.length, void 0, ql(e))
  }
  function fc(e) {
    return uc(4, e.length, void 0, Jl(e))
  }
  function dc(e, t) {
    return uc(5, e.length / t, Jl([t]), ql(e))
  }
  function pc(e) {
    return uc(6, e.length, void 0, Jl(nc(e)))
  }
  function mc(e) {
    return uc(8, e.length, void 0, Jl(nc(oc(e))))
  }
  function yc(e, t) {
    return uc(9, e.length, Jl([t]), Jl(nc(tc(e, t))))
  }
  function _c(e, t) {
    return uc(
      10,
      e.length,
      Jl([t]),
      (function (e, t) {
        for (
          var r = e.length, n = Xl((t = t || new Uint8Array(2 * r))), i = 0;
          i < r;
          ++i
        )
          n.setInt16(2 * i, e[i])
        return ql(t)
      })(cc(e, t))
    )
  }
  function vc(t) {
    var r = {}
    return (
      zl.forEach(function (e) {
        void 0 !== t[e] && (r[e] = t[e])
      }),
      t.bondAtomList && (r.bondAtomList = fc(t.bondAtomList)),
      t.bondOrderList && (r.bondOrderList = hc(t.bondOrderList)),
      (r.xCoordList = _c(t.xCoordList, 1e3)),
      (r.yCoordList = _c(t.yCoordList, 1e3)),
      (r.zCoordList = _c(t.zCoordList, 1e3)),
      t.bFactorList && (r.bFactorList = _c(t.bFactorList, 100)),
      t.atomIdList && (r.atomIdList = mc(t.atomIdList)),
      t.altLocList && (r.altLocList = pc(t.altLocList)),
      t.occupancyList && (r.occupancyList = yc(t.occupancyList, 100)),
      (r.groupIdList = mc(t.groupIdList)),
      (r.groupTypeList = fc(t.groupTypeList)),
      t.secStructList && (r.secStructList = hc(t.secStructList)),
      t.insCodeList && (r.insCodeList = pc(t.insCodeList)),
      t.sequenceIndexList && (r.sequenceIndexList = mc(t.sequenceIndexList)),
      (r.chainIdList = dc(t.chainIdList, 4)),
      t.chainNameList && (r.chainNameList = dc(t.chainNameList, 4)),
      r
    )
  }
  function gc(i) {
    function n(e) {
      for (var t = {}, r = 0; r < e; r++) t[l()] = l()
      return t
    }
    function o(e) {
      var t = i.subarray(c, c + e)
      return (c += e), t
    }
    function s(e) {
      var t = i.subarray(c, c + e)
      c += e
      if (65535 < e) {
        for (var r = [], n = 0; n < t.length; n += 65535)
          r.push(String.fromCharCode.apply(null, t.subarray(n, n + 65535)))
        return r.join('')
      }
      return String.fromCharCode.apply(null, t)
    }
    function a(e) {
      for (var t = new Array(e), r = 0; r < e; r++) t[r] = l()
      return t
    }
    function l() {
      var e,
        t,
        r = i[c]
      if (0 == (128 & r)) return c++, r
      if (128 == (240 & r)) return c++, n((t = 15 & r))
      if (144 == (240 & r)) return c++, a((t = 15 & r))
      if (160 == (224 & r)) return c++, s((t = 31 & r))
      if (224 == (224 & r)) return (e = u.getInt8(c)), c++, e
      switch (r) {
        case 192:
          return c++, null
        case 194:
          return c++, !1
        case 195:
          return c++, !0
        case 196:
          return (t = u.getUint8(c + 1)), (c += 2), o(t)
        case 197:
          return (t = u.getUint16(c + 1)), (c += 3), o(t)
        case 198:
          return (t = u.getUint32(c + 1)), (c += 5), o(t)
        case 202:
          return (e = u.getFloat32(c + 1)), (c += 5), e
        case 203:
          return (e = u.getFloat64(c + 1)), (c += 9), e
        case 204:
          return (e = i[c + 1]), (c += 2), e
        case 205:
          return (e = u.getUint16(c + 1)), (c += 3), e
        case 206:
          return (e = u.getUint32(c + 1)), (c += 5), e
        case 208:
          return (e = u.getInt8(c + 1)), (c += 2), e
        case 209:
          return (e = u.getInt16(c + 1)), (c += 3), e
        case 210:
          return (e = u.getInt32(c + 1)), (c += 5), e
        case 217:
          return (t = u.getUint8(c + 1)), (c += 2), s(t)
        case 218:
          return (t = u.getUint16(c + 1)), (c += 3), s(t)
        case 219:
          return (t = u.getUint32(c + 1)), (c += 5), s(t)
        case 220:
          return (t = u.getUint16(c + 1)), (c += 3), a(t)
        case 221:
          return (t = u.getUint32(c + 1)), (c += 5), a(t)
        case 222:
          return (t = u.getUint16(c + 1)), (c += 3), n(t)
        case 223:
          return (t = u.getUint32(c + 1)), (c += 5), n(t)
      }
      throw new Error('Unknown type 0x' + r.toString(16))
    }
    var c = 0,
      u = new DataView(i.buffer)
    return l()
  }
  function xc(e, t, r, n) {
    switch (e) {
      case 1:
        return (function (e, t) {
          for (
            var r = e.length,
              n = Xl((t = t || new Float32Array(r / 4))),
              i = Xl(e),
              o = 0,
              s = 0,
              a = r / 4;
            o < a;
            ++o, s += 4
          )
            n.setFloat32(s, i.getFloat32(s), !0)
          return t
        })(t)
      case 2:
        return $l(t)
      case 3:
        return Kl(t)
      case 4:
        return Ql(t)
      case 5:
        return ql(t)
      case 6:
        return rc(Ql(t), new Uint8Array(r))
      case 7:
        return rc(Ql(t))
      case 8:
        return ic(rc(Ql(t)), a)
      case 9:
        return (i = Ql(t)), (o = Ql(n)[0]), ec(rc(i, Zl(s)), o, s)
      case 10:
        return lc(Kl(t), Ql(n)[0])
      case 11:
        return ec(Kl(t), Ql(n)[0])
      case 12:
        return ac(Kl(t), Ql(n)[0])
      case 13:
        return ac($l(t), Ql(n)[0])
      case 14:
        return sc(Kl(t))
      case 15:
        return sc($l(t))
    }
    var i, o, s, a
  }
  function bc(s, e) {
    var a = (e = e || {}).ignoreFields,
      l = {}
    return (
      Fl.forEach(function (e) {
        var t,
          r,
          n,
          i = !!a && -1 !== a.indexOf(e),
          o = s[e]
        i ||
          void 0 === o ||
          (o instanceof Uint8Array
            ? (l[e] = xc.apply(
                null,
                ((r = (n = Xl((t = o))).getInt32(0)),
                (i = n.getInt32(4)),
                (n = t.subarray(8, 12)),
                [r, (t = t.subarray(12)), i, n])
              ))
            : (l[e] = o))
      }),
      l
    )
  }
  function wc(e) {
    return String.fromCharCode.apply(null, e).replace(/\0/g, '')
  }
  function Sc(e, t) {
    return bc(
      (e = e instanceof ArrayBuffer ? new Uint8Array(e) : e) instanceof
        Uint8Array
        ? gc(e)
        : e,
      t
    )
  }
  function Rc(e, t, r, n) {
    var i = new XMLHttpRequest()
    i.addEventListener(
      'load',
      function () {
        try {
          var e = Sc(i.response)
          r(e)
        } catch (e) {
          n(e)
        }
      },
      !0
    ),
      i.addEventListener('error', n, !0),
      (i.responseType = 'arraybuffer'),
      i.open('GET', t + e.toUpperCase()),
      i.send()
  }
  ;(wi = _i.exports),
    (Fl = (zl = [
      'mmtfVersion',
      'mmtfProducer',
      'unitCell',
      'spaceGroup',
      'structureId',
      'title',
      'depositionDate',
      'releaseDate',
      'experimentalMethods',
      'resolution',
      'rFree',
      'rWork',
      'bioAssemblyList',
      'ncsOperatorList',
      'entityList',
      'groupList',
      'numBonds',
      'numAtoms',
      'numGroups',
      'numChains',
      'numModels',
      'groupsPerChain',
      'chainsPerModel'
    ]).concat([
      'xCoordList',
      'yCoordList',
      'zCoordList',
      'groupIdList',
      'groupTypeList',
      'chainIdList',
      'bFactorList',
      'atomIdList',
      'altLocList',
      'occupancyList',
      'secStructList',
      'insCodeList',
      'sequenceIndexList',
      'chainNameList',
      'bondAtomList',
      'bondOrderList'
    ])),
    (Ul = (vi = '//mmtf.rcsb.org/v1.0/') + 'full/'),
    (Gl = vi + 'reduced/'),
    (wi.encode = function (e) {
      return Wl(vc(e))
    }),
    (wi.decode = Sc),
    (wi.traverse = function (e, t, r) {
      var n,
        i,
        o,
        s,
        a,
        l,
        c = (r = r || {}).firstModelOnly,
        u = t.onModel,
        h = t.onChain,
        f = t.onGroup,
        d = t.onAtom,
        p = t.onBond,
        m = 0,
        y = 0,
        _ = 0,
        v = 0,
        g = 0,
        x = -1,
        b = e.chainNameList,
        w = e.secStructList,
        S = e.insCodeList,
        R = e.sequenceIndexList,
        C = e.atomIdList,
        A = e.bFactorList,
        E = e.altLocList,
        k = e.occupancyList,
        T = e.bondAtomList,
        P = e.bondOrderList
      for (n = 0, i = e.chainsPerModel.length; n < i && !(c && 0 < m); ++n) {
        var M = e.chainsPerModel[m]
        for (u && u({ chainCount: M, modelIndex: m }), o = 0; o < M; ++o) {
          var N,
            L,
            I = e.groupsPerChain[y]
          for (
            h &&
              ((N = wc(e.chainIdList.subarray(4 * y, 4 * y + 4))),
              (L = null),
              b && (L = wc(b.subarray(4 * y, 4 * y + 4))),
              h({
                groupCount: I,
                chainIndex: y,
                modelIndex: m,
                chainId: N,
                chainName: L
              })),
              s = 0;
            s < I;
            ++s
          ) {
            var O,
              B,
              V,
              D,
              z,
              F,
              U,
              G = e.groupList[e.groupTypeList[_]],
              j = G.atomNameList.length
            for (
              f &&
                ((O = null),
                w && (O = w[_]),
                (B = null),
                e.insCodeList && (B = String.fromCharCode(S[_])),
                (V = null),
                R && (V = R[_]),
                f({
                  atomCount: j,
                  groupIndex: _,
                  chainIndex: y,
                  modelIndex: m,
                  groupId: e.groupIdList[_],
                  groupType: e.groupTypeList[_],
                  groupName: G.groupName,
                  singleLetterCode: G.singleLetterCode,
                  chemCompType: G.chemCompType,
                  secStruct: O,
                  insCode: B,
                  sequenceIndex: V
                })),
                a = 0;
              a < j;
              ++a
            )
              d &&
                ((D = null),
                C && (D = C[v]),
                (z = null),
                A && (z = A[v]),
                (F = null),
                E && (F = String.fromCharCode(E[v])),
                (U = null),
                k && (U = k[v]),
                d({
                  atomIndex: v,
                  groupIndex: _,
                  chainIndex: y,
                  modelIndex: m,
                  atomId: D,
                  element: G.elementList[a],
                  atomName: G.atomNameList[a],
                  formalCharge: G.formalChargeList[a],
                  xCoord: e.xCoordList[v],
                  yCoord: e.yCoordList[v],
                  zCoord: e.zCoordList[v],
                  bFactor: z,
                  altLoc: F,
                  occupancy: U
                })),
                (v += 1)
            if (p) {
              var H = G.bondAtomList
              for (a = 0, l = G.bondOrderList.length; a < l; ++a)
                p({
                  atomIndex1: v - j + H[2 * a],
                  atomIndex2: v - j + H[2 * a + 1],
                  bondOrder: G.bondOrderList[a]
                })
            }
            _ += 1
          }
          y += 1
        }
        if (((g = x + 1), (x = v - 1), p && T))
          for (a = 0, l = T.length; a < l; a += 2) {
            var W = T[a],
              Y = T[a + 1]
            ;((g <= W && W <= x) || (g <= Y && Y <= x)) &&
              p({
                atomIndex1: W,
                atomIndex2: Y,
                bondOrder: P ? P[a / 2] : null
              })
          }
        m += 1
      }
    }),
    (wi.fetch = function (e, t, r) {
      Rc(e, Ul, t, r)
    }),
    (wi.fetchReduced = function (e, t, r) {
      Rc(e, Gl, t, r)
    }),
    (wi.version = 'v1.1.0dev'),
    (wi.fetchUrl = Ul),
    (wi.fetchReducedUrl = Gl),
    (wi.encodeMsgpack = Wl),
    (wi.encodeMmtf = vc),
    (wi.decodeMsgpack = gc),
    (wi.decodeMmtf = bc)
  var Cc = _i.exports
  function Ac(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Ec = hr.Complex,
    kc = hr.Chain,
    Tc = hr.Atom,
    Pc = hr.Element,
    Mc = hr.Helix,
    Nc = hr.Sheet,
    Lc = hr.Strand,
    Ic = hr.Bond,
    Oc = hr.Assembly,
    Bc = hr.Molecule,
    Vc = (function () {
      function r(e) {
        G(this, r), (this._original = Array.from(e)), this._original.sort()
        for (var t = (this._sum = 0); t < this._original.length; ++t)
          this._sum += this._original[t]
      }
      return (
        p(r, [
          {
            key: 'compare',
            value: function (e) {
              var t = e.length
              if (t !== this._original.length) return !1
              for (var r = 0, n = 0; n < t; ++n) r += e[n]
              if (r !== this._sum) return !1
              var i = Array.from(e)
              for (i.sort(), n = 0; n < t; ++n)
                if (i[n] !== this._original[n]) return !1
              return !0
            }
          }
        ]),
        r
      )
    })()
  Vc.prototype.constructor = Vc
  var gi = Fe.Type,
    Dc = [
      gi.HELIX_PI,
      gi.BEND,
      gi.HELIX_ALPHA,
      gi.STRAND,
      gi.HELIX_310,
      gi.BRIDGE,
      gi.TURN,
      gi.COIL
    ]
  bi = (function () {
    x(n, gl)
    var r = Ac(n)
    function n(e, t) {
      return (
        G(this, n), ((t = r.call(this, e, t))._options.fileType = 'mmtf'), t
      )
    }
    return (
      p(
        n,
        [
          { key: '_onModel', value: function (e) {} },
          {
            key: '_onChain',
            value: function (e) {
              var t
              0 === e.modelIndex &&
                ((t = new kc(this._complex, e.chainName)),
                ((this._complex._chains[e.chainIndex] = t)._index =
                  e.chainIndex))
            }
          },
          {
            key: '_onGroup',
            value: function (e) {
              var t, r
              0 === e.modelIndex &&
                ((this.settings.now.nowater &&
                  ('HOH' === e.groupName || 'WAT' === e.groupName)) ||
                  ((t = this._complex._chains[e.chainIndex]),
                  (r = e.insCode.charCodeAt(0) ? e.insCode : ''),
                  ((r = t.addResidue(e.groupName, e.groupId, r))._index =
                    e.groupIndex),
                  this._updateSecStructure(this._complex, r, e)))
            }
          },
          {
            key: '_onAtom',
            value: function (e) {
              var t
              0 === e.modelIndex &&
                ((t = e.altLoc.charCodeAt(0) ? e.altLoc : ''),
                (t = new Tc(
                  e.groupIndex,
                  e.atomName,
                  Pc.getByName(e.element.toUpperCase()),
                  new ae.Vector3(e.xCoord, e.yCoord, e.zCoord),
                  Pc.Role[e.atomName],
                  !1,
                  e.atomId,
                  t,
                  e.occupancy,
                  e.bFactor,
                  e.formalCharge
                )),
                ((this._complex._atoms[e.atomIndex] = t).index = e.atomIndex),
                (this._serialAtomMap[e.atomId] = t))
            }
          },
          {
            key: '_onBond',
            value: function (e) {
              var t,
                r = Math.max(e.atomIndex1, e.atomIndex2)
              r >= this._complex._atoms.length ||
                ((t = Math.min(e.atomIndex1, e.atomIndex2)),
                this._complex.addBond(
                  this._complex._atoms[t],
                  this._complex._atoms[r],
                  e.bondOrder,
                  Ic.BondType.UNKNOWN,
                  !0
                ))
            }
          },
          {
            key: '_updateSecStructure',
            value: function (e, t, r) {
              if (!b.default.isUndefined(r) && r.secStruct === this._ssType)
                return (
                  (t._secondary = this._ssStruct),
                  void (this._ssStruct && (this._ssStruct.term = t))
                )
              if (!b.default.isUndefined(r)) {
                var n = Dc[r.secStruct]
                ;(this._ssType = r.secStruct), (this._ssStart = t)
                var i = null
                switch (this._ssType) {
                  case -1:
                  case 7:
                    break
                  case 0:
                  case 2:
                  case 4:
                    ;(i = new Mc(
                      [3, -1, 1, -1, 5][this._ssType],
                      t,
                      t,
                      0,
                      '',
                      '',
                      0
                    )),
                      e._helices.push(i)
                    break
                  case 3:
                    var o = new Nc('', 0)
                    e._sheets.push(o), (i = new Lc(o, t, t, 0, null, null))
                    break
                  default:
                    void 0 !== n && (i = new Fe(n, t, t))
                }
                ;(this._ssStruct = i),
                  (t._secondary = i) && e.structures.push(i)
              }
            }
          },
          {
            key: '_updateMolecules',
            value: function (e) {
              var t = e.entityList
              if (t)
                for (var r = e.chainsPerModel[0], n = 0; n < t.length; n++) {
                  for (
                    var i = t[n], o = i.chainIndexList, s = [], a = 0;
                    a < o.length;
                    a++
                  ) {
                    var l = o[a]
                    r <= l ||
                      ((l = this._complex._chains[l]),
                      (s = s.concat(l._residues.slice())))
                  }
                  i = new Bc(this._complex, i.description, n + 1)
                  ;(i.residues = s), (this._complex._molecules[n] = i)
                }
            }
          },
          {
            key: '_traverse',
            value: function (e) {
              var t = this,
                r = this._complex.metadata
              ;(r.id = e.structureId),
                (r.title = []),
                (r.title[0] = e.title),
                (r.date = e.releaseDate),
                (r.format = 'mmtf')
              r = {
                onModel: function (e) {
                  t._onModel(e)
                },
                onChain: function (e) {
                  t._onChain(e)
                },
                onGroup: function (e) {
                  t._onGroup(e)
                },
                onAtom: function (e) {
                  t._onAtom(e)
                },
                onBond: function (e) {
                  t._onBond(e)
                }
              }
              ;(this._ssType = -1),
                (this._ssStruct = null),
                (this._ssStart = null),
                Cc.traverse(e, r),
                this._updateSecStructure(this._complex),
                this._updateMolecules(e)
            }
          },
          {
            key: '_linkAtomsToResidues',
            value: function () {
              for (var e = 0; e < this._complex._atoms.length; ++e) {
                var t = this._complex._atoms[e],
                  r = this._complex._residues[t.residue]
                ;(t.residue = r)._atoms.push(t)
              }
            }
          },
          {
            key: '_findSynonymousChains',
            value: function () {
              for (var e = {}, t = 0; t < this._complex._chains.length; ++t) {
                var r = this._complex._chains[t],
                  n = r.getName()
                e.hasOwnProperty(n) || (e[n] = []), e[n].push(r._index)
              }
              return e
            }
          },
          {
            key: '_parseAssemblyInfo',
            value: function (e) {
              for (
                var t = [], r = this.logger, n = 0;
                n < e.bioAssemblyList.length;
                ++n
              ) {
                var i = e.bioAssemblyList[n]
                if (0 !== i.transformList.length) {
                  for (
                    var o = i.transformList[0].chainIndexList,
                      s = new Vc(o),
                      a = {},
                      l = 0;
                    l < o.length;
                    ++l
                  )
                    a[this._complex._chains[o[l]].getName()] = 1
                  var c = [],
                    u = void 0
                  for (u in a)
                    a.hasOwnProperty(u) &&
                      Array.prototype.push.apply(c, this._chainsByName[u])
                  s.compare(c) ||
                    r.debug(
                      'MMTF: Assembly is missing some of the synonymous chains. Skipping...'
                    )
                  var h = new Oc(this._complex)
                  for (u in a) a.hasOwnProperty(u) && h.addChain(u)
                  for (
                    h.addMatrix(
                      new ae.Matrix4()
                        .fromArray(i.transformList[0].matrix)
                        .transpose()
                    ),
                      l = 1;
                    l < i.transformList.length;
                    ++l
                  ) {
                    var f = i.transformList[l]
                    if (s.compare(f.chainIndexList)) {
                      for (
                        var d = new ae.Matrix4()
                            .fromArray(f.matrix)
                            .transpose(),
                          p = 0;
                        p < h.matrices.length && !h.matrices[p].equals(d);
                        ++p
                      );
                      p === h.matrices.length && h.addMatrix(d)
                    } else
                      r.debug(
                        'MMTF: Chain lists differ for different transforms in one assembly. Skipping...'
                      )
                  }
                  h.finalize(), t.push(h)
                }
              }
              return t
            }
          },
          {
            key: '_markHeteroAtoms',
            value: function (e) {
              for (
                var t = e.chainsPerModel[0], r = 0;
                r < e.entityList.length;
                ++r
              ) {
                var n = e.entityList[r]
                if ('polymer' !== n.type)
                  for (var i = 0; i < n.chainIndexList.length; ++i) {
                    var o = n.chainIndexList[i]
                    if (!(t <= o))
                      for (
                        var s = this._complex._chains[o], a = 0;
                        a < s._residues.length;
                        ++a
                      )
                        for (
                          var l = s._residues[a], c = 0;
                          c < l._atoms.length;
                          ++c
                        )
                          l._atoms[c].het = !0
                  }
              }
            }
          },
          {
            key: '_joinSynonymousChains',
            value: function () {
              for (
                var e = [], t = {}, r = 0;
                r < this._complex._chains.length;
                ++r
              ) {
                var n = this._complex._chains[r],
                  i = n.getName()
                if (t.hasOwnProperty(i))
                  for (var o = t[i], s = 0; s < n._residues.length; ++s) {
                    var a = n._residues[s]
                    o._residues.push(a), (a._chain = o)
                  }
                else ((t[i] = n)._index = e.length), e.push(n)
              }
              this._complex._chains = e
            }
          },
          {
            key: 'parseSync',
            value: function () {
              var e = Cc.decode(this._data)
              return (
                (this._complex = new Ec()),
                (this._serialAtomMap = {}),
                this._traverse(e),
                this._linkAtomsToResidues(),
                this._markHeteroAtoms(e),
                (this._chainsByName = this._findSynonymousChains()),
                Array.prototype.push.apply(
                  this._complex.units,
                  this._parseAssemblyInfo(e)
                ),
                this._joinSynonymousChains(),
                this._complex.finalize({
                  needAutoBonding: !1,
                  detectAromaticLoops: this.settings.now.aromatic,
                  enableEditing: this.settings.now.editing,
                  serialAtomMap: this._serialAtomMap
                }),
                this._complex
              )
            }
          }
        ],
        [
          {
            key: 'canProbablyParse',
            value: function (e) {
              return (
                b.default.isArrayBuffer(e) &&
                223 == (1 | new Uint8Array(e, 0, 1)[0])
              )
            }
          }
        ]
      ),
      n
    )
  })()
  function zc(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(bi.formats = ['mmtf']), (bi.extensions = ['.mmtf']), (bi.binary = !0)
  var Fc = (function () {
    x(i, E(Error))
    var n = zc(i)
    function i(e, t, r) {
      return (
        G(this, i),
        (e = n.call(this, 'data:'.concat(t, ':').concat(r, ': ').concat(e))),
        Error.captureStackTrace && Error.captureStackTrace(S(e), i),
        (e.name = 'ParsingError'),
        (e.parseLine = t),
        (e.parseColumn = r),
        e
      )
    }
    return p(i)
  })()
  function Uc(e) {
    return 32 === e || 10 === e || 13 === e || 9 === e
  }
  function Gc(e, t, r) {
    for (
      var n = t.length, i = -1;
      r < n && (i = t.charCodeAt(r)) !== e && 10 !== i;

    )
      ++r
    return i === e ? r : -1
  }
  function jc(n) {
    var i,
      e,
      t,
      r,
      o = 0,
      s = 0,
      a = n.length,
      l = !0,
      c = 1,
      u = 1,
      h = 0,
      f = {},
      d = {},
      p = [],
      m = 0,
      y = '',
      _ = [],
      v = 0
    function g() {
      var e
      if ((46 === i || 63 === i) && (a <= o + 1 || Uc(n.charCodeAt(o + 1))))
        return ++u, void ++o
      if (l && 59 === i) {
        s = o
        var t = 0
        do {
          if (-1 === (s = Gc(10, n, s + 1)))
            throw new Fc('Unterminated text block found', c, u)
        } while ((++t, (s + 1 < a && n.charCodeAt(s + 1) !== i) || a <= s + 1))
        return (
          (e = n.substring(o + 1, s).replace(/\r/g, '')),
          (o = s + 2),
          (c += t),
          (l = !(u = 1)),
          e
        )
      }
      if (39 === i || 34 === i) {
        s = o
        do {
          if (-1 === (s = Gc(i, n, s + 1)))
            throw new Fc('Unterminated quoted string found', c, u)
        } while (s + 1 < a && !Uc(n.charCodeAt(s + 1)))
        return (e = n.substring(o + 1, s)), (u += s - o + 1), (o = s + 1), e
      }
      for (s = o; s < a && !Uc(n.charCodeAt(s)); ) ++s
      ;(e = n.substring(o, s)), (u += s - o), (o = s)
      var r = Number(e)
      return Number.isNaN(r) ? e : r
    }
    for (; o <= a; ) {
      if (13 !== (i = n.charCodeAt(o)))
        if (10 === i) (l = !0), ++c, (u = 1)
        else {
          if (32 !== i && 9 !== i) {
            if (35 === i) {
              if (-1 === (o = Gc(10, n, o + 1))) break
              continue
            }
            if (0 === h) {
              if (
                (68 !== i && 100 !== i) ||
                'ata_' !== n.substr(o + 1, 4).toLowerCase()
              ) {
                if (Number.isNaN(i)) break
                throw new Fc('Unexpected character in state '.concat(h), c, u)
              }
              for (e = s = o + 5; s < a && !Uc(n.charCodeAt(s)); ) ++s
              if (((u += s - o), e < (o = s))) {
                ;(f[n.substring(e, o)] = d = {}), (h = 1)
                continue
              }
              throw new Fc('Data block name missing', c, u)
            }
            if (1 === h) {
              if (
                (68 !== i && 100 !== i) ||
                'ata_' !== n.substr(o + 1, 4).toLowerCase()
              ) {
                if (95 === i) {
                  for (e = s = o + 1; s < a && !Uc(n.charCodeAt(s)); ) ++s
                  if (((u += s - o), e < (o = s))) {
                    ;(y = n.substring(e, o)), (h = 2)
                    continue
                  }
                  throw new Fc('Tag name missing', c, u)
                }
                if (
                  (76 !== i && 108 !== i) ||
                  'oop_' !== n.substr(o + 1, 4).toLowerCase()
                ) {
                  if (Number.isNaN(i)) break
                  throw new Fc('Unexpected character in state '.concat(h), c, u)
                }
                if (((u += 5), (o += 5) < a && !Uc(n.charCodeAt(o))))
                  throw new Fc('Unexpected character in state '.concat(h), c, u)
                ;(p = []), (_ = []), (v = m = 0), (h = 3)
                continue
              }
              h = 0
              continue
            }
            if (2 === h) {
              if (Number.isNaN(i)) break
              ;(t = g()), b.default.set(d, y, t), (h = 1)
              continue
            }
            if (3 === h) {
              if (95 === i) {
                for (e = s = o + 1; s < a && !Uc(n.charCodeAt(s)); ) ++s
                if (((u += s - o), e < (o = s))) {
                  ;(r = n.substring(e, o)), (p[m++] = r)
                  continue
                }
                throw new Fc('Tag name missing', c, u)
              }
              if (0 < m) {
                for (var x = 0; x < m; ++x)
                  (_[x] = t = []), b.default.set(d, p[x], t)
                h = 4
                continue
              }
              throw new Fc('Data tags are missing inside a loop', c, u)
            }
            if (4 !== h)
              throw new Fc('Unexpected internal state '.concat(h), c, u)
            ;(68 !== i && 100 !== i) ||
            'ata_' !== n.substr(o + 1, 4).toLowerCase()
              ? 95 !== i &&
                ((76 !== i && 108 !== i) ||
                  'oop_' !== n.substr(o + 1, 4).toLowerCase())
                ? Number.isNaN(i)
                  ? (h = 0)
                  : ((r = g()), _[v % m].push(r), ++v)
                : (h = 1)
              : (h = 0)
            continue
          }
          ;(l = !1), ++u
        }
      ++o
    }
    if (2 === h)
      throw new Fc('Unexpected end of file in state '.concat(h), c, u)
    return f
  }
  function Hc(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var Wc = hr.Complex,
    Yc = hr.Element,
    Xc = hr.Helix,
    qc = hr.Sheet,
    $c = hr.Strand,
    Zc = hr.Assembly,
    Kc = hr.Molecule,
    Qc = ['auth_seq_id', 'Cartn_x', 'Cartn_y', 'Cartn_z', 'label_atom_id'],
    Jc = { helx: 'helix', turn: 'turn', strn: 'strand' }
  function eu(e) {
    return null == e || b.default.isArray(e) ? e : [e]
  }
  var tu = (function () {
    x(n, E(Error))
    var r = Hc(n)
    function n(e) {
      var t
      return (
        G(this, n),
        ((t = r.call(this)).name = 'AtomDataError'),
        (t.message = e),
        t
      )
    }
    return p(n)
  })()
  function ru(e, t) {
    for (
      var r = (e = b.default.isString(e) ? e : ''.concat(e))
          .replace(/\)\s*\(/g, '!')
          .replace(/[()']/g, '')
          .split('!'),
        s = [],
        n = 0,
        i = r.length;
      n < i;
      ++n
    ) {
      for (
        var o = r[n].split(','), a = [], l = 0, c = 0, u = o.length;
        c < u;
        ++c
      ) {
        var h = o[c]
        if (h.includes('-'))
          for (
            var f = h.split('-'),
              d = parseInt(f[0], 10),
              p = parseInt(f[1], 10);
            d <= p;
            ++d
          )
            a[l++] = t[d]
        else a[l++] = t[h]
      }
      s.push(a)
    }
    var m = [],
      y = 0
    return (
      (function e(t, r) {
        for (var n = 0, i = s[t].length; n < i; ++n) {
          var o = r ? r.clone() : new ae.Matrix4()
          o.multiplyMatrices(s[t][n], o), 0 === t ? (m[y++] = o) : e(t - 1, o)
        }
      })(s.length - 1),
      m
    )
  }
  xi = (function () {
    x(n, gl)
    var r = Hc(n)
    function n(e, t) {
      return (
        G(this, n),
        ((t = r.call(this, e, t)).asymDict = {}),
        (t.molecules = []),
        (t._options.fileType = 'cif'),
        t
      )
    }
    return (
      p(
        n,
        [
          {
            key: 'parseSync',
            value: function () {
              this.logger.info('Parsing CIF file..')
              var e = jc(this._data)
              return this._toComplex(e)
            }
          },
          {
            key: '_toComplex',
            value: function (e) {
              var t = new Wc(),
                e = e[Object.keys(e)[0]]
              return (
                this._extractAtoms(t, e),
                this._extractSecondary(t, e),
                this._extractAssemblies(t, e),
                this._extractMolecules(t, e),
                this._extractMetadata(t, e),
                t.finalize({
                  needAutoBonding: !0,
                  detectAromaticLoops: this.settings.now.aromatic,
                  enableEditing: this.settings.now.editing
                }),
                t
              )
            }
          },
          {
            key: '_extractMetadata',
            value: function (e, t) {
              var r = e.metadata
              ;(r.id = t.entry.id),
                (r.classification = t.struct_keywords.pdbx_keywords)
              e = t.database_PDB_rev
              ;(r.date = e && e.date_original ? e.date_original : ''),
                (r.format = 'cif'),
                (r.title = []),
                (r.title[0] = t.struct.title)
            }
          },
          {
            key: '_extractMolecules',
            value: function (e, t) {
              for (
                var r = eu(t.entity.pdbx_description), n = r.length, i = 0;
                i < n;
                i++
              )
                this.molecules[i]
                  ? (this.molecules[i].name = r[i])
                  : (this.molecules[i] = { name: r[i], residues: [] })
              var o = e.getMolecules()
              for (i = 0; i < n; i++) {
                var s = this.molecules[i]
                ;(o[i] = new Kc(e, s.name, i + 1)), (o[i].residues = s.residues)
              }
            }
          },
          {
            key: '_extractAtoms',
            value: function (e, t) {
              var r = t.atom_site
              if (!r)
                throw new tu('CIF parsing error: atom_site is not specified!')
              for (var n = 0, i = Qc.length; n < i; ++n)
                if (!r[Qc[n]])
                  throw new tu(
                    'CIF parsing error: requires field '.concat(
                      Qc[n],
                      ' not found!'
                    )
                  )
              for (
                var o,
                  s,
                  a,
                  l,
                  c,
                  u,
                  h,
                  f,
                  d,
                  p,
                  m = this.asymDict,
                  y = eu(r.auth_seq_id),
                  _ = eu(r.Cartn_x),
                  v = eu(r.Cartn_y),
                  g = eu(r.Cartn_z),
                  x = eu(r.label_atom_id),
                  b = x.length,
                  w = eu(r.group_PDB) || [],
                  S = eu(r.auth_asym_id) || [],
                  R = eu(r.label_asym_id) || [],
                  C = eu(r.id) || [],
                  A = eu(r.pdbx_PDB_ins_code) || [],
                  E = eu(r.label_comp_id) || [],
                  k = eu(r.type_symbol) || [],
                  T = eu(r.B_iso_or_equiv) || [],
                  P = eu(r.occupancy) || [],
                  M = eu(r.pdbx_formal_charge) || [],
                  N = eu(r.label_alt_id) || [],
                  L = eu(r.pdbx_PDB_model_num) || [],
                  I = eu(r.label_entity_id) || [],
                  O = null,
                  B = null,
                  V = 0;
                V < b;
                ++V
              )
                1 === (L[V] || 1) &&
                  ((s = String(S[V] || ' ')),
                  (O && O.getName() === s) ||
                    (O = e.getChain(s) || e.addChain(s)),
                  (m[String(R[V] || ' ')] = s),
                  (l = y[V]),
                  (c = String(A[V] || ' ')),
                  (a = String(E[V] || '')),
                  (B && B.getSequence() === l && B.getICode() === c) ||
                    ((B = O.addResidue(a, l, c)),
                    (u = I[V] - 1),
                    (h = this.molecules[u]) ||
                      ((this.molecules[u] = { name: '', residues: [] }),
                      (h = this.molecules[u])),
                    h.residues.push(B)),
                  (o = x[V]),
                  (f =
                    k[V] ||
                    ((p = void 0),
                    (p = 4 === (d = o).trim().length),
                    d.slice(0, p ? 1 : 2).trim())),
                  (s = Yc.getByName(f)),
                  (a = Yc.Role[o.trim()]),
                  (l = new ae.Vector3(_[V], v[V], g[V])),
                  (c = 'HETATM' === w[V] || !1),
                  (u = C[V] || V),
                  (h = T[V] || 0),
                  (d = P[V] || 0),
                  (p = String(N[V] || '')),
                  (f = M[V] || 0),
                  B.addAtom(o, s, l, a, c, u, p, d, h, f))
            }
          },
          {
            key: '_extractSecondary',
            value: function (e, t) {
              t.struct_conf && this._extractConfs(e, t.struct_conf),
                t.struct_sheet_range &&
                  this._extractSheets(e, t.struct_sheet_range)
            }
          },
          {
            key: '_extractSheets',
            value: function (e, t) {
              var r = this.asymDict
              if (
                t.sheet_id &&
                t.id &&
                t.beg_label_seq_id &&
                t.end_label_seq_id &&
                t.beg_label_asym_id
              )
                for (
                  var n = e._sheets,
                    i = eu(t.sheet_id),
                    o = eu(t.id),
                    s = eu(t.beg_auth_seq_id),
                    a = eu(t.end_auth_seq_id),
                    l = eu(t.beg_label_asym_id),
                    c = eu(t.pdbx_beg_PDB_ins_code) || [],
                    u = eu(t.pdbx_end_PDB_ins_code) || [],
                    h = 0,
                    f = o.length;
                  h < f;
                  ++h
                ) {
                  var d = e.getChain(r[l[h]]),
                    p = (function (e) {
                      for (var t = n.length, r = 0; r < t; ++r)
                        if (n[r]._name === e) return n[r]
                      return (n[t] = new qc(e, 0)), n[t]
                    })(i[h]),
                    m = s[h],
                    y = a[h],
                    _ = c[h] || ' ',
                    v = u[h] || ' ',
                    _ = d.findResidue(m, _),
                    g = d.findResidue(y, v)
                  if (_ && g) {
                    for (
                      var x = new $c(p, _[0], g[0], 0, null, null),
                        b = d.getResidues(),
                        w = _[1];
                      w <= g[1];
                      ++w
                    )
                      b[w]._secondary = x
                    p.addStrand(x), e.structures.push(x)
                  }
                }
            }
          },
          {
            key: '_extractConfs',
            value: function (e, t) {
              var r = this.asymDict
              if (
                t.conf_type_id &&
                t.beg_label_seq_id &&
                t.end_label_seq_id &&
                t.beg_label_asym_id
              )
                for (
                  var n = eu(t.conf_type_id),
                    i = eu(t.beg_auth_seq_id),
                    o = eu(t.pdbx_beg_PDB_ins_code) || [],
                    s = eu(t.end_auth_seq_id),
                    a = eu(t.pdbx_end_PDB_ins_code) || [],
                    l = eu(t.details) || [],
                    c = eu(t.pdbx_PDB_helix_length) || [],
                    u = eu(t.pdbx_PDB_helix_class) || [],
                    h = eu(t.id) || [],
                    f = eu(t.beg_label_asym_id),
                    d = 0,
                    p = n.length;
                  d < p;
                  ++d
                ) {
                  var m =
                    ((w = n[d]),
                    (w = /[A-Za-z]+/.exec(w)) ? Jc[w[0].toLowerCase()] : null)
                  if (m) {
                    var y = h[d] || n[d],
                      _ = e.getChain(r[f[d]]),
                      v = i[d],
                      g = s[d],
                      x = o[d] || ' ',
                      b = a[d] || ' ',
                      w = _.findResidue(v, x),
                      S = _.findResidue(g, b)
                    if (w && S) {
                      var v = l[d] || '',
                        x = c[d] || 0,
                        g = u[d] || ' ',
                        R = void 0
                      if (
                        ('helix' === m
                          ? ((b = e._helices.length),
                            (R = new Xc(g, w[0], S[0], b, y, v, x)),
                            e.addHelix(R),
                            e.structures.push(R))
                          : 'turn' === m
                          ? ((R = new Fe(Fe.Type.TURN, w[0], S[0])),
                            e.structures.push(R))
                          : (R = null),
                        R)
                      )
                        for (var C = _.getResidues(), A = w[1]; A <= S[1]; ++A)
                          C[A]._secondary = R
                    }
                  }
                }
            }
          },
          {
            key: '_extractAssemblies',
            value: function (e, t) {
              var r = this.asymDict,
                n = t.pdbx_struct_assembly_gen
              if (n) {
                var i = eu(n.assembly_id),
                  o = eu(n.oper_expression),
                  s = eu(n.asym_id_list)
                if (i && o && s) {
                  var a = (function (e) {
                    if (!e) return null
                    var t = eu(e.id),
                      r = e.matrix,
                      n = e.vector
                    if (!t || !r || !n) return null
                    for (var i = [], o = 0, s = t.length; o < s; ++o) {
                      for (
                        var a = new ae.Matrix4(), l = a.elements, c = 0;
                        c < 3;
                        ++c
                      ) {
                        var u = r[c + 1]
                        ;(l[c] = eu(u[1])[o]),
                          (l[c + 4] = eu(u[2])[o]),
                          (l[c + 8] = eu(u[3])[o]),
                          (l[c + 12] = eu(n[c + 1])[o])
                      }
                      i[t[o]] = a
                    }
                    return i
                  })(t.pdbx_struct_oper_list)
                  if (a)
                    for (var l = 0, c = i.length; l < c; ++l) {
                      for (
                        var u = new Zc(e),
                          h = ru(o[l], a),
                          f = s[l].split(','),
                          d = 0,
                          p = f.length;
                        d < p;
                        ++d
                      ) {
                        var m = f[d].trim()
                        0 < m.length && u.addChain(r[m])
                      }
                      ;(u.matrices = h), e.units.push(u)
                    }
                }
              }
            }
          }
        ],
        [
          {
            key: 'canProbablyParse',
            value: function (e) {
              return b.default.isString(e) && /^\s*data_/i.test(e)
            }
          }
        ]
      ),
      n
    )
  })()
  ;(xi.formats = ['cif', 'mmcif']), (xi.extensions = ['.cif', '.mmcif'])
  var nu = 0,
    iu = 1,
    ou = 2,
    su = 3,
    au = (function () {
      function e() {
        G(this, e),
          be(this, '_xyz2crs', []),
          be(this, '_origin', new ae.Vector3(0, 0, 0)),
          (this._header = {}),
          (this._boxSize = new ae.Vector3()),
          (this._boxStart = new ae.Vector3()),
          (this._header.delta = {}),
          (this._header.extent = []),
          (this._header.nstart = []),
          (this._header.grid = []),
          (this._header.crs2xyz = []),
          (this._header.cellDims = new ae.Vector3()),
          (this._header.angles = []),
          (this._header.origin = new ae.Vector3(0, 0, 0)),
          (this._header.dmin = 0),
          (this._header.dmean = 0),
          (this._header.dmax = 0)
      }
      return (
        p(e, [
          {
            key: '_typedCheck',
            value: function () {
              if (b.default.isTypedArray(this._buff))
                this._buff = this._buff.buffer
              else if (!b.default.isArrayBuffer(this._buff))
                throw new TypeError('Expected ArrayBuffer or TypedArray')
            }
          },
          {
            key: '_fillHeader',
            value: function (e, t) {
              for (var r in e)
                if (e.hasOwnProperty(r))
                  switch (e[r][0]) {
                    case nu:
                      this._header[r] = t[e[r][1]][e[r][2]]
                      break
                    case ou:
                      this._parseArray(this._header[r], t[e[r][1]], e[r][2])
                      break
                    case iu:
                      this._parseVector(this._header[r], t[e[r][1]], e[r][2])
                      break
                    case su:
                      this._header[r] = new Uint8Array(
                        t[e[r][1]],
                        4 * [e[r][2]],
                        4 * [e[r][3]]
                      )
                  }
            }
          },
          {
            key: '_parseVector',
            value: function (e, t, r) {
              r = [t[r], t[r + 1], t[r + 2]]
              ;(e.x = r[0]), (e.y = r[1]), (e.z = r[2])
            }
          },
          {
            key: '_parseArray',
            value: function (e, t, r) {
              ;(e[0] = t[r]), (e[1] = t[r + 1]), (e[2] = t[r + 2])
            }
          },
          { key: '_parseHeader', value: function (e) {} },
          { key: '_setAxisIndices', value: function () {} },
          { key: '_setOrigins', value: function () {} },
          {
            key: '_getAxis',
            value: function () {
              var e = this._header,
                t = e.cellDims.x / e.grid[0],
                r = e.cellDims.y / e.grid[1],
                n = e.cellDims.z / e.grid[2],
                i = m(e.angles, 3),
                o = i[0],
                s = i[1],
                e = i[2],
                i = Math.cos(s),
                o = (Math.cos(o) - Math.cos(s) * Math.cos(e)) / Math.sin(e),
                s = Math.sqrt(1 - i * i - o * o)
              return [
                new ae.Vector3(t, 0, 0),
                new ae.Vector3(Math.cos(e) * r, Math.sin(e) * r, 0),
                new ae.Vector3(i * n, o * n, s * n)
              ]
            }
          },
          {
            key: '_getXYZdim',
            value: function () {
              return [
                this._header.extent[this._xyz2crs[0]],
                this._header.extent[this._xyz2crs[1]],
                this._header.extent[this._xyz2crs[2]]
              ]
            }
          },
          {
            key: '_getVolumeInfo',
            value: function () {
              var e = b.default.pick(this._header, [
                'dmean',
                'dmin',
                'dmax',
                'sd',
                'delta'
              ])
              return (
                (e.obtuseAngle = this._header.angles.map(function (e) {
                  return Number(e >= Math.PI / 2)
                })),
                e
              )
            }
          },
          {
            key: '_setBoxParams',
            value: function (e, t, r) {
              var n = this,
                i = 0,
                o = 0,
                s = m(this._header.angles, 3),
                a = s[0],
                l = s[1]
              s[2] >= Math.PI / 2 && (i += Math.abs(t.x)),
                l >= Math.PI / 2 && (i += Math.abs(r.x)),
                a >= Math.PI / 2 && (o += Math.abs(r.y)),
                (this._boxStart = new ae.Vector3(
                  this._origin.x - i,
                  this._origin.y - o,
                  this._origin.z
                )),
                (this._boxSize = new ae.Vector3(
                  Math.abs(e.x) + Math.abs(t.x) + Math.abs(r.x),
                  Math.abs(t.y) + Math.abs(r.y),
                  Math.abs(r.z)
                ))
              function c(e, t) {
                return Math.abs(e[t]) / n._boxSize[t]
              }
              ;(this._header.delta.x = c(t, 'x')),
                (this._header.delta.y = c(r, 'x')),
                (this._header.delta.z = c(r, 'y'))
            }
          },
          {
            key: '_getXYZbox',
            value: function () {
              return new ae.Box3(
                this._boxStart.clone(),
                this._boxStart.clone().add(this._boxSize)
              )
            }
          },
          { key: '_toXYZData', value: function () {} },
          {
            key: 'parse',
            value: function (e) {
              return (
                this._parseHeader(e),
                this._setOrigins(),
                new ur(
                  Float32Array,
                  this._getXYZdim(),
                  this._getXYZbox(),
                  1,
                  this._toXYZData(),
                  this._getVolumeInfo()
                )
              )
            }
          }
        ]),
        e
      )
    })()
  function lu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var cu = {
      extent: [ou, 'u32', 0],
      type: [nu, 'u32', 3],
      nstart: [ou, 'i32', 4],
      grid: [ou, 'u32', 7],
      cellDims: [iu, 'f32', 10],
      angles: [ou, 'f32', 13],
      crs2xyz: [ou, 'i32', 16],
      dmin: [nu, 'f32', 19],
      dmax: [nu, 'f32', 20],
      dmean: [nu, 'f32', 21],
      ispg: [nu, 'u32', 22],
      nsymbt: [nu, 'u32', 23],
      lksflg: [nu, 'u32', 24],
      customData: [su, 'buffer', 25, 9],
      origin: [iu, 'f32', 34],
      map: [su, 'buffer', 52, 1],
      machine: [nu, 'u32', 53],
      sd: [nu, 'f32', 54],
      nlabel: [nu, 'f32', 55],
      label: [su, 'buffer', 56, 200]
    },
    uu = (function () {
      x(t, au)
      var e = lu(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_parseHeader',
            value: function (e) {
              ;(this._buff = e), this._typedCheck()
              var t = {}
              ;(t.u32 = new Uint32Array(this._buff, 0, 56)),
                (t.i32 = new Int32Array(this._buff, 0, 56)),
                (t.f32 = new Float32Array(this._buff, 0, 56)),
                (t.buffer = this._buff)
              e = this._header
              this._fillHeader(cu, t),
                e.angles.forEach(function (e, t, r) {
                  r[t] *= Math.PI / 180
                })
            }
          },
          {
            key: '_setAxisIndices',
            value: function () {
              var e = this._header
              0 === e.cellDims.x &&
                0 === e.cellDims.y &&
                0 === e.cellDims.z &&
                e.cellDims.set(1, 1, 1)
              var t = this._header.crs2xyz
              0 === t[0] &&
                0 === t[1] &&
                0 === t[2] &&
                ((t[0] = 1), (t[1] = 2), (t[2] = 3))
              e = this._xyz2crs
              ;(e[t[0] - 1] = 0), (e[t[1] - 1] = 1), (e[t[2] - 1] = 2)
            }
          },
          {
            key: '_setOrigins',
            value: function () {
              var e = m(this._getAxis(), 3),
                t = e[0],
                r = e[1],
                n = e[2]
              this._setAxisIndices()
              var i = this._header,
                e = this._xyz2crs
              if (
                (0 === i.origin.x && 0 === i.origin.y && 0 === i.origin.z
                  ? (this._origin.addScaledVector(t, i.nstart[e[0]]),
                    this._origin.addScaledVector(r, i.nstart[e[1]]),
                    this._origin.addScaledVector(n, i.nstart[e[2]]))
                  : (this._origin = i.origin),
                t.multiplyScalar(i.extent[e[0]] - 1),
                r.multiplyScalar(i.extent[e[1]] - 1),
                n.multiplyScalar(i.extent[e[2]] - 1),
                2 !== i.type)
              )
                throw new Error('CCP4: Unsupported format '.concat(i.type))
              ;(this._data = new Float32Array(
                this._buff,
                1024 + i.nsymbt,
                i.extent[0] * i.extent[1] * i.extent[2]
              )),
                this._setBoxParams(t, r, n)
            }
          },
          {
            key: '_toXYZData',
            value: function () {
              var e = this._header,
                t = this._data,
                r = this._xyz2crs,
                n = new Float32Array(t.length),
                i = this._getXYZdim(),
                o = i[0],
                s = i[1],
                a = 0,
                l = []
              for (l[2] = 0; l[2] < e.extent[2]; l[2]++)
                for (l[1] = 0; l[1] < e.extent[1]; l[1]++)
                  for (l[0] = 0; l[0] < e.extent[0]; l[0]++, a++)
                    n[l[r[0]] + o * (l[r[1]] + s * l[r[2]])] = t[a]
              return n
            }
          }
        ]),
        t
      )
    })(),
    Si = (function () {
      x(n, gl)
      var r = lu(n)
      function n(e, t) {
        return (
          G(this, n),
          ((t = r.call(this, e, t))._options.fileType = 'ccp4'),
          (t.model = new uu()),
          t
        )
      }
      return (
        p(
          n,
          [
            {
              key: 'parseSync',
              value: function () {
                return this.model.parse(this._data)
              }
            }
          ],
          [
            {
              key: 'canProbablyParse',
              value: function (e) {
                return !1
              }
            }
          ]
        ),
        n
      )
    })()
  function hu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(Si.formats = ['ccp4']),
    (Si.extensions = ['.ccp4', '.map', '.mrc']),
    (Si.binary = !0)
  var fu = hr.Complex,
    du = hr.Element,
    pu = hr.Molecule,
    ki = (function () {
      x(n, gl)
      var r = hu(n)
      function n(e, t) {
        return (
          G(this, n),
          ((e = r.call(this, e, t))._complex = null),
          (e._atomsInf = null),
          (e._options.fileType = 'xyz'),
          (e._fileName = t.name),
          e
        )
      }
      return (
        p(
          n,
          [
            {
              key: '_parseToAtomsInf',
              value: function (e) {
                var t = e.indexOf('\n'),
                  r = parseInt(e.substring(0, t), 10),
                  n = e.indexOf('\n', t + 1),
                  t = e.slice(t + 1, n).trim()
                0 === t.length && (t = this._fileName)
                n += e.substring(n).search(/\S/)
                ;(this._atomsInf = e.substring(n).split(/[\s,]*\n[\s,]*/)),
                  Number.isNaN(r) || this._atomsInf.length - 1 === r
                    ? ((this._complex.metadata.format = 'xyz'),
                      (this._complex.name = t))
                    : (this._complex.error = {
                        message: 'wrong number of atoms'
                      })
              }
            },
            {
              key: '_parseAtomsInf',
              value: function () {
                for (
                  var e = this._complex.addChain('A').addResidue('UNK', 1, ' '),
                    t = 0;
                  t < this._atomsInf.length - 1;
                  t++
                ) {
                  var r = this._atomsInf[t].split(/[\s,]+/)
                  if (4 !== r.length) {
                    this._complex.error = { message: 'missed parameters' }
                    break
                  }
                  var n = t + 1,
                    i = r[0],
                    o = new ae.Vector3(
                      parseFloat(r[1]),
                      parseFloat(r[2]),
                      parseFloat(r[3])
                    ),
                    r = du.getByName(i)
                  e.addAtom(i, r, o, void 0, !0, n, ' ', 1, 1, 0)
                }
                var s = new pu(this._complex, this._complex.name, 1)
                ;(s.residues = e), (this._complex._molecules[0] = s)
              }
            },
            {
              key: 'parseSync',
              value: function () {
                var e = (this._complex = new fu())
                if (
                  (this._parseToAtomsInf(this._data),
                  this._parseAtomsInf(),
                  this._complex.finalize({
                    needAutoBonding: !0,
                    detectAromaticLoops: this.settings.now.aromatic,
                    enableEditing: this.settings.now.editing,
                    serialAtomMap: this._serialAtomMap
                  }),
                  (this._complex = null),
                  (this._atomsInf = null),
                  e.error)
                )
                  throw new Error(e.error.message)
                return e
              }
            }
          ],
          [
            {
              key: 'canProbablyParse',
              value: function (e) {
                return (
                  b.default.isString(e) &&
                  /^\s*\d+ *\n[^\n]*\n\s*\w{1,3}\s+-?\d/.test(e)
                )
              }
            }
          ]
        ),
        n
      )
    })()
  function mu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  be(ki, 'formats', ['xyz']), be(ki, 'extensions', ['.xyz'])
  var yu = hr.Complex,
    _u = hr.Element,
    Fi = (function () {
      x(n, gl)
      var r = mu(n)
      function n(e, t) {
        return (
          G(this, n),
          ((t = r.call(this, e, t))._options.fileType = 'pubchem+json'),
          t
        )
      }
      return (
        p(
          n,
          [
            {
              key: 'parseSync',
              value: function () {
                return (
                  this.logger.info('Parsing PubChem JSON file...'),
                  this._toComplex(JSON.parse(this._data))
                )
              }
            },
            {
              key: '_toComplex',
              value: function (e) {
                var t = new yu(),
                  e = e.PC_Compounds && e.PC_Compounds[0]
                return (
                  e &&
                    (this._extractAtoms(t, e),
                    t.finalize({
                      needAutoBonding: !1,
                      detectAromaticLoops: this.settings.now.aromatic,
                      enableEditing: this.settings.now.editing
                    })),
                  t
                )
              }
            },
            {
              key: '_extractAtoms',
              value: function (e, t) {
                var r = t.atoms && t.atoms.aid
                if (!(n = r && t.atoms.element) || r.length !== n.length)
                  throw new Error('Unable to parse atom elements')
                var n = b.default.fromPairs(b.default.zip(r, n)),
                  i = {},
                  o = t.coords && t.coords[0],
                  s = o && o.conformers && o.conformers[0],
                  a = s && s.x,
                  l = s && s.y,
                  c = (s && s.z) || []
                if (!(r = o && o.aid) || !a || !l)
                  throw new Error('Coordinates are not found in the file')
                for (
                  var u = e.addChain(' ').addResidue('UNK', 1, ' '),
                    h = 0,
                    f = r.length;
                  h < f;
                  ++h
                ) {
                  var d = r[h],
                    p = _u.ByAtomicNumber[n[d]],
                    m = new ae.Vector3(a[h], l[h], c[h] || 0)
                  i[d] = u.addAtom(p.name, p, m, void 0, !0, d, ' ', 1, 0, 0)
                }
                var y = t.bonds && t.bonds.aid1,
                  _ = t.bonds && t.bonds.aid2,
                  v = (t.bonds && t.bonds.order) || []
                if (y && _ && y.length === _.length)
                  for (var g = 0, x = y.length; g < x; ++g)
                    e.addBond(i[y[g]], i[_[g]], v[g] || 1, 0, !0)
              }
            }
          ],
          [
            {
              key: 'canProbablyParse',
              value: function (e) {
                return b.default.isString(e) && '{' === e[0]
              }
            }
          ]
        ),
        n
      )
    })()
  ;(Fi.formats = ['pubchem', 'pubchem+json', 'pc']), (Fi.extensions = ['.json'])
  var vu = (function () {
    function t(e) {
      G(this, t),
        (this._strings = e.split(/\r?\n|\r/)),
        (this._currentStart = 0),
        (this._currentStringIndx = 0)
    }
    return (
      p(t, [
        {
          key: 'setStart',
          value: function (e) {
            e >= this._strings.length
              ? ((this._currentStart = this._strings.length - 1),
                (this._currentStringIndx = this._strings.length - 1))
              : ((this._currentStart = e), (this._currentStringIndx = e))
          }
        },
        {
          key: 'getNextString',
          value: function () {
            return this._strings[++this._currentStringIndx]
          }
        },
        {
          key: 'getCurrentString',
          value: function () {
            return this._strings[this._currentStringIndx]
          }
        },
        {
          key: 'getStringFromStart',
          value: function (e) {
            return (
              (this._currentStringIndx = this._currentStart + e),
              this._strings[this._currentStart + e]
            )
          }
        },
        {
          key: 'findNextDataItem',
          value: function () {
            for (
              var e = this.getNextString(), t = !1;
              !b.default.isUndefined(e) && '$$$$' !== e.trim();

            ) {
              if (e.match(/>\s+<(.*)>/)) {
                t = !0
                break
              }
              e = this.getNextString()
            }
            return t
          }
        },
        {
          key: 'findNextCompoundStart',
          value: function () {
            for (
              var e = this.getCurrentString();
              !b.default.isUndefined(e) && '$$$$' !== e.trim();

            )
              e = this.getNextString()
            return (
              this.setStart(++this._currentStringIndx),
              this.probablyHaveDataToParse()
            )
          }
        },
        {
          key: 'probablyHaveDataToParse',
          value: function () {
            return this._currentStringIndx < this._strings.length - 2
          }
        }
      ]),
      t
    )
  })()
  function gu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var xu = hr.Complex,
    bu = hr.Element,
    wu = hr.Bond,
    Su = hr.Molecule,
    Ru = [0, 3, 2, 1, 0, -1, -2, -3],
    Cu = [0, 1, 2, 3, 1, 1, 1, 2],
    Au = [
      wu.BondType.UNKNOWN,
      wu.BondType.COVALENT,
      wu.BondType.COVALENT,
      wu.BondType.COVALENT,
      wu.BondType.AROMATIC,
      wu.BondType.UNKNOWN,
      wu.BondType.AROMATIC,
      wu.BondType.AROMATIC
    ],
    Eu = /.*(M\s\sEND).*|.*(^$$$$).*|.*>\s+<(.+)>.*/,
    ku = /.*($$$$).*|.*>\s+<(.+)>.*/,
    Tu = 'sdf',
    Pu = 'mol',
    Mu = ['name', 'id', 'title'],
    Nu = {
      name: [
        'PUBCHEM_IUPAC_TRADITIONAL_NAME',
        /PUBCHEM_(.+)_NAME/,
        /(.+)name/,
        /(.+)NAME/
      ],
      id: ['PUBCHEM_COMPOUND_CID', 'id', 'ID', /.*CID/, /.*ID/, /.*id/],
      title: ['msg', 'MSG', 'message', 'title', 'description', 'desc']
    }
  Gi = (function () {
    x(n, gl)
    var r = gu(n)
    function n(e, t) {
      return (
        G(this, n),
        ((t = r.call(this, e, t))._format = 'sdf'),
        (t._complex = null),
        (t._chain = null),
        (t._residue = null),
        (t._molecules = null),
        (t._metadata = {}),
        (t._metadata.molecules = []),
        (t._currentMolProps = {}),
        (t._compoundIndx = -1),
        (t._assemblies = []),
        (t._atomsParsed = 0),
        (t._atomsIndexes = []),
        t
      )
    }
    return (
      p(n, [
        {
          key: 'canProbablyParse',
          value: function (e) {
            return b.default.isString(e) && Eu.test(e)
          }
        },
        {
          key: '_parseHeader',
          value: function (e) {
            var t = {}
            t.name = e.getStringFromStart(0)
            var r = parseInt(e.getStringFromStart(1).substr(10, 6).trim(), 10)
            ;(t.date = r.toString() || ''),
              (t.title = e.getStringFromStart(2)),
              this._metadata.molecules.push(t)
          }
        },
        {
          key: '_parseAtoms',
          value: function (e, t) {
            var r = this._atomsParsed,
              n = (function (e) {
                if (!e) return 'A'
                for (var t = []; e; )
                  t.push(65 + (e % 26)), (e = Math.trunc(e / 26))
                return (
                  1 < t.length && (t.reverse(), --t[0]),
                  String.fromCharCode.apply(String, t)
                )
              })(this._compoundIndx)
            ;(this._chain =
              this._complex.getChain(n) || this._complex.addChain(n)),
              (this._residue = this._chain.addResidue('UNK', 1, ' '))
            for (var i = 0; i < t; i++) {
              ;(c = e.getNextString()), r++
              var o = parseFloat(c.substr(0, 10)),
                s = parseFloat(c.substr(10, 10)),
                a = parseFloat(c.substr(20, 10)),
                l = Ru[parseInt(c.substr(36, 3), 10)],
                s = new ae.Vector3(o, s, a),
                a = c.substr(31, 3).trim().toUpperCase(),
                c = bu.getByName(a)
              this._atomsIndexes[a] || (this._atomsIndexes[a] = 0),
                (this._atomsIndexes[a] += 1),
                (a += this._atomsIndexes[a]),
                this._residue.addAtom(a, c, s, void 0, !0, r, ' ', 1, 0, l)
            }
          }
        },
        {
          key: '_parseBonds',
          value: function (e, t) {
            for (var r = 0; r < t; r++) {
              var n = e.getNextString(),
                i = parseInt(n.substr(0, 3), 10) + this._atomsParsed,
                o = parseInt(n.substr(3, 3), 10) + this._atomsParsed,
                s = parseInt(n.substr(6, 3), 10)
              o < i && ((i = (n = [o, i])[0]), (o = n[1])),
                this._complex.addBond(
                  i,
                  o,
                  Cu[s] || 1,
                  Au[s] || wu.BondType.UNKNOWN,
                  !0
                )
            }
          }
        },
        {
          key: '_parseMOL',
          value: function (e) {
            this._compoundIndx++, this._parseHeader(e)
            var t = e.getStringFromStart(3),
              r = parseInt(t.substr(0, 3), 10),
              t = parseInt(t.substr(3, 3), 10)
            this._parseAtoms(e, r),
              this._parseBonds(e, t),
              (this._atomsParsed += r),
              (this._metadata.molecules[this._compoundIndx]._residues = []),
              this._metadata.molecules[this._compoundIndx]._residues.push(
                this._residue
              )
          }
        },
        {
          key: '_parseDataItem',
          value: function (e) {
            for (
              var t = e.getCurrentString(), r = [], n = e.getNextString();
              '' !== n.trim();

            )
              r.push(n), (n = e.getNextString())
            1 === r.length && (r = m(r, 1)[0]),
              (this._currentMolProps[t.replace(/[<>]/g, '').trim()] = r)
          }
        },
        {
          key: '_parseCompound',
          value: function (e) {
            if ((this._parseMOL(e), this._format === Tu)) {
              for (this._currentMolProps = {}; e.findNextDataItem(); )
                this._parseDataItem(e)
              var t
              0 !== Object.keys(this._currentMolProps).length &&
                (((t = this._metadata.molecules[this._compoundIndx]).props =
                  this._currentMolProps),
                this._tryToUpdateMoleculeData(t))
            }
          }
        },
        {
          key: '_fixBondsArray',
          value: function () {
            for (
              var e = this._serialAtomMap, t = this._complex._bonds, r = 0;
              r < t.length;
              r++
            ) {
              var n = t[r]
              n._right,
                n._left,
                (n._left = e[n._left] || null),
                (n._right = e[n._right] || null)
            }
          }
        },
        {
          key: '_buildAssemblies',
          value: function () {
            var e = this._complex._chains
            if (1 === e.length) return this._assemblies
            for (var t = 0; t < e.length; t++) {
              var r = new kt(this._complex),
                n = new ae.Matrix4()
              r.addMatrix(n), r.addChain(e[t]._name), this._assemblies.push(r)
            }
            return this._assemblies
          }
        },
        {
          key: '_buildMolecules',
          value: function () {
            this._complex._molecules = []
            for (var e = this._metadata.molecules, t = 0; t < e.length; t++) {
              var r = new Su(this._complex, e[t].name, t + 1)
              ;(r.residues = e[t]._residues), (this._complex._molecules[t] = r)
            }
            return this._complex._molecules
          }
        },
        {
          key: '_searchTag',
          value: function (e, t) {
            for (var r = 0; r < t.length; r++)
              if ((e instanceof RegExp && e.test(t[r].tag)) || e === t[r].tag)
                return t[r].data
          }
        },
        {
          key: '_tryToFind',
          value: function (e, t) {
            for (var r = 0; r < e.length; r++) {
              var n = this._searchTag(e[r], t)
              if (n) return n
            }
          }
        },
        {
          key: '_tryToUpdateMoleculeData',
          value: function (e) {
            for (var t = !1, r = 0; r < Mu.length; r++) {
              var n = this._tryToFind(Nu[Mu[r]], e.props)
              n && ((e[Mu[r]] = n), (t = !0))
            }
            return (
              (e.name = e.name || e.id),
              e.name.match(/^\d+$/) && (e.name = 'CID: '.concat(e.name)),
              t
            )
          }
        },
        {
          key: '_finalizeMetadata',
          value: function () {
            var e = this._metadata.molecules,
              t = this._complex.metadata,
              r = this._complex
            if (1 === e.length)
              (r.name = e[0].name),
                (t.title = e[0].title),
                (t.date = e[0].date),
                (t.properties = e[0].props)
            else if (1 < e.length) {
              t.molecules = []
              for (var n = 0; n < e.length; n++)
                t.molecules.push({
                  name: e[n].name,
                  date: e[n].date,
                  title: e[n].title,
                  properties: e[n].props
                })
            }
          }
        },
        {
          key: '_finalize',
          value: function () {
            for (
              var e = (this._serialAtomMap = {}),
                t = this._complex._atoms,
                r = 0;
              r < t.length;
              r++
            ) {
              var n = t[r]
              e[n.serial] = n
            }
            this._complex._finalizeBonds(),
              this._fixBondsArray(),
              this._finalizeMetadata(),
              this._buildAssemblies(),
              (this._complex.units = this._complex.units.concat(
                this._assemblies
              )),
              this._buildMolecules(),
              this._complex.finalize({
                needAutoBonding: !1,
                detectAromaticLoops: !1,
                enableEditing: !1,
                serialAtomMap: this._serialAtomMap
              })
          }
        },
        {
          key: 'defineFormat',
          value: function (e) {
            e = ku.test(e) ? Tu : Pu
            return e
          }
        },
        {
          key: 'parseSync',
          value: function () {
            var e = (this._complex = new xu()),
              t = new vu(this._data)
            for (
              this._format = this.defineFormat(this._data),
                e.metadata.format = this._format;
              this._parseCompound(t), t.findNextCompoundStart();

            );
            return this._finalize(), e
          }
        }
      ]),
      n
    )
  })()
  function Lu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(Gi.formats = ['mol', 'sdf']), (Gi.extensions = ['.mol', '.sdf'])
  var Iu = {
      nstart: [ou, 'i16', 0],
      extent: [ou, 'i16', 3],
      grid: [ou, 'i16', 6],
      cellDims: [iu, 'i16', 9],
      angles: [ou, 'i16', 12],
      div: [nu, 'i16', 15],
      adder: [nu, 'i16', 16],
      scaleFactor: [nu, 'i16', 17]
    },
    Ou = (function () {
      x(t, au)
      var e = Lu(t)
      function t() {
        return G(this, t), e.apply(this, arguments)
      }
      return (
        p(t, [
          {
            key: '_parseHeader',
            value: function (e) {
              ;(this._buff = e), this._typedCheck()
              var t = {}
              if (((t.i16 = new Int16Array(this._buff)), 100 !== t.i16[18]))
                for (var r = 0, n = t.i16.length; r < n; ++r) {
                  var i = t.i16[r]
                  t.i16[r] = ((255 & i) << 8) | ((i >> 8) & 255)
                }
              if (100 !== t.i16[18]) throw new Error('DSN6: Incorrect format ')
              var o = this._header
              this._fillHeader(Iu, t),
                o.cellDims.multiplyScalar(1 / o.scaleFactor),
                o.angles.forEach(function (e, t, r) {
                  r[t] *= Math.PI / 180 / o.scaleFactor
                }),
                (o.div /= 100)
            }
          },
          {
            key: '_setAxisIndices',
            value: function () {
              ;(this._xyz2crs[0] = 0),
                (this._xyz2crs[1] = 1),
                (this._xyz2crs[2] = 2)
            }
          },
          {
            key: '_setOrigins',
            value: function () {
              var e = this._header,
                t = m(this._getAxis(), 3),
                r = t[0],
                n = t[1],
                t = t[2]
              this._setAxisIndices(),
                this._origin.addScaledVector(r, e.nstart[0]),
                this._origin.addScaledVector(n, e.nstart[1]),
                this._origin.addScaledVector(t, e.nstart[2]),
                r.multiplyScalar(e.extent[0]),
                n.multiplyScalar(e.extent[1]),
                t.multiplyScalar(e.extent[2]),
                this._setBoxParams(r, n, t)
            }
          },
          {
            key: '_pointCalculate',
            value: function (e, t, r, n, i, o, s) {
              var a = this._header
              return i < a.extent[0] && n < a.extent[1] && r < a.extent[2]
                ? ((e[i + a.extent[0] * (n + a.extent[1] * r)] =
                    (t[o.counter] - a.adder) / a.div),
                  ++o.counter,
                  !0)
                : ((o.counter += 8 - s), !1)
            }
          },
          {
            key: '_blockCalculate',
            value: function (e, t, r, n, i, o) {
              for (var s = 0; s < 8; ++s)
                for (var a = 8 * r + s, l = 0; l < 8; ++l)
                  for (var c = 8 * n + l, u = !0, h = 0; u && h < 8; ) {
                    u = this._pointCalculate(e, t, a, c, 8 * i + h, o, h)
                    h++
                  }
            }
          },
          {
            key: '_toXYZData',
            value: function () {
              for (
                var e = this._header,
                  t = new Uint8Array(this._buff),
                  r = new Float32Array(e.extent[0] * e.extent[1] * e.extent[2]),
                  n = new ae.Vector3(
                    e.extent[0] / 8,
                    e.extent[1] / 8,
                    e.extent[2] / 8
                  ),
                  i = { counter: 512 },
                  o = 0;
                o < n.z;
                ++o
              )
                for (var s = 0; s < n.y; ++s)
                  for (var a = 0; a < n.x; ++a)
                    this._blockCalculate(r, t, o, s, a, i)
              return this._calculateInfoParams(r), r
            }
          },
          {
            key: '_calculateInfoParams',
            value: function (e) {
              this._header.dmean /= e.length
              for (var t = 0, r = e[0], n = e[0], i = 0; i < e.length; i++)
                (t += Math.pow(this._header.dmean - e[i], 2)),
                  e[i] < r && (r = e[i]),
                  e[i] > n && (n = e[i])
              ;(this._header.sd = Math.sqrt(t / e.length)),
                (this._header.dmax = n),
                (this._header.dmin = r)
            }
          }
        ]),
        t
      )
    })(),
    Wi = (function () {
      x(n, gl)
      var r = Lu(n)
      function n(e, t) {
        return (
          G(this, n),
          ((t = r.call(this, e, t))._options.fileType = 'dsn6'),
          (t.model = new Ou()),
          t
        )
      }
      return (
        p(
          n,
          [
            {
              key: 'parseSync',
              value: function () {
                return this.model.parse(this._data)
              }
            }
          ],
          [
            {
              key: 'canParse',
              value: function (e, t) {
                return (
                  !!e &&
                  e instanceof ArrayBuffer &&
                  gl.checkDataTypeOptions(t, 'dsn6')
                )
              }
            },
            {
              key: 'canProbablyParse',
              value: function (e) {
                return !1
              }
            }
          ]
        ),
        n
      )
    })()
  function Bu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(Wi.formats = ['dsn6']),
    (Wi.extensions = ['.dsn6', '.omap']),
    (Wi.binary = !0)
  var Vu = (function () {
    x(r, bl)
    var t = Bu(r)
    function r(e) {
      return G(this, r), ((e = t.call(this, e))._next = -1), e.next(), e
    }
    return (
      p(r, [
        {
          key: 'getNext',
          value: function () {
            return this._next
          }
        }
      ]),
      r
    )
  })()
  function Du(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var zu = hr.Complex,
    Fu = hr.Element,
    Uu = hr.Molecule,
    Qi = (function () {
      x(n, gl)
      var r = Du(n)
      function n(e, t) {
        return (
          G(this, n),
          ((t = r.call(this, e, t))._time = null),
          (t._numAtoms = null),
          (t._residueNumber = null),
          (t._residueName = ''),
          (t._atomName = ''),
          (t._atomNumber = null),
          (t._atomPosition = []),
          (t._atomVelocity = []),
          (t._complex = null),
          (t._molecules = []),
          (t._molecule = null),
          (t._options.filetype = 'gro'),
          t
        )
      }
      return (
        p(n, [
          {
            key: 'canProbablyParse',
            value: function (e) {
              return (
                b.default.isString(this._data) &&
                /^\s*[^\n]*\n\s*\d+ *\n\s*\d+[^\n\d]{3}\s*\w+\s*\d+\s*-?\d/.test(
                  e
                )
              )
            }
          },
          {
            key: '_parseTitle',
            value: function (e) {
              var t = this._complex.metadata
              ;(t.id = e.readLine().trim()),
                (t.name = t.id.slice(
                  t.id.lastIndexOf('\\') + 1,
                  t.id.lastIndexOf('.')
                )),
                (t.format = 'gro')
            }
          },
          {
            key: '_parseNumberOfAtoms',
            value: function (e) {
              if (
                ((this._numAtoms = e.readInt(0, e.getNext())),
                Number.isNaN(this._numAtoms))
              )
                throw new Error(
                  'Line 2 is not representing atom number. Consider checking input file'
                )
            }
          },
          {
            key: '_parseAtom',
            value: function (e) {
              ;(this._residueNumber = e.readInt(1, 5)),
                (this._residueName = e.readString(6, 10).trim()),
                (this._atomName = e.readString(11, 15).trim()),
                (this._atomNumber = e.readInt(16, 20))
              var t,
                r,
                n,
                i = 10 * e.readFloat(21, 28),
                o = 10 * e.readFloat(29, 36),
                s = 10 * e.readFloat(37, 45)
              Number.isNaN(i) || Number.isNaN(o) || Number.isNaN(s)
                ? (this._complex.error = {
                    message: 'Atom position is invalid in "'.concat(
                      e.readLine(),
                      '"'
                    )
                  })
                : 'Unknown' !== (t = Fu.getByName(this._atomName[0])).fullName
                ? ((r = Fu.Role[this._atomName]),
                  (n = this._chain) ||
                    (this._chain = n = this._complex.addChain('A')),
                  ((e = this._residue) &&
                    e.getSequence() === this._residueNumber) ||
                    (this._residue = e =
                      n.addResidue(
                        this._residueName,
                        this._residueNumber,
                        ' '
                      )),
                  (this._atomPosition = new ae.Vector3(i, o, s)),
                  e.addAtom(
                    this._atomName,
                    t,
                    this._atomPosition,
                    r,
                    !0,
                    this._atomNumber,
                    ' ',
                    1,
                    1,
                    0
                  ))
                : (this._complex.error = {
                    message: ''.concat(
                      this._atomName[0],
                      " hasn't been recognised as an atom name."
                    )
                  })
            }
          },
          {
            key: '_finalize',
            value: function () {
              var e = new Uu(this._complex, this._complex.metadata.name, 1)
              ;(e.residues = this._chain._residues),
                (e._chains = this._chain),
                (this._complex._molecules[0] = e),
                this._molecules.push(e),
                this._complex.finalize({
                  needAutoBonding: !0,
                  detectAromaticLoops: this.settings.now.aromatic,
                  enableEditing: this.settings.now.editing,
                  serialAtomMap: this._serialAtomMap
                })
            }
          },
          {
            key: 'parseSync',
            value: function () {
              var e = (this._complex = new zu()),
                t = new Vu(this._data),
                r = 0
              for (
                this._parseTitle(t),
                  t.next(),
                  this._parseNumberOfAtoms(t),
                  t.next(),
                  r = 0;
                r < this._numAtoms && !t.end();
                ++r
              )
                this._parseAtom(t), t.next()
              if (
                (r < this._numAtoms &&
                  (this._complex.error = {
                    message: 'File ended unexpectedly.'
                  }),
                e.error)
              )
                throw new Error(e.error.message)
              return (
                this._finalize(),
                (this._atomPosition = null),
                (this._complex = null),
                (this._molecules = null),
                (this._molecule = null),
                e
              )
            }
          }
        ]),
        n
      )
    })()
  function Gu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  ;(Qi.formats = ['gro']), (Qi.extensions = ['.gro'])
  var ju = hr.Complex,
    Hu = hr.Element,
    Wu = hr.Bond,
    Yu = hr.Molecule,
    Xu = { un: 0, 1: 1, 2: 2, 3: 3, ar: 1, am: 1, nc: 0, du: 1 },
    qu = {
      un: Wu.BondType.UNKNOWN,
      1: Wu.BondType.COVALENT,
      2: Wu.BondType.COVALENT,
      3: Wu.BondType.COVALENT,
      ar: Wu.BondType.AROMATIC,
      am: Wu.BondType.COVALENT,
      nc: Wu.BondType.UNKNOWN,
      du: Wu.BondType.COVALENT
    },
    $u = /\d+$/,
    Zu = /\s+/
  function Ku(e) {
    return e.trim().split(Zu)
  }
  Qe = (function () {
    x(n, gl)
    var r = Gu(n)
    function n(e, t) {
      return (
        G(this, n),
        ((t = r.call(this, e, t))._complex = null),
        (t._chain = null),
        (t._residue = null),
        (t._compoundIndx = -1),
        (t._molecules = []),
        (t._molecule = null),
        (t._currPosIdx = 0),
        (t._currStartIdx = 0),
        (t._serialAtomMap = {}),
        (t._options.fileType = 'mol2'),
        t
      )
    }
    return (
      p(n, [
        {
          key: '_parseRawStrings',
          value: function (e) {
            return e.split(/\r?\n|\r/)
          }
        },
        {
          key: '_toStringFromStart',
          value: function (e, t) {
            e = this._currStartIdx + e
            this._currPosIdx = e < t.length ? e : this._currStartIdx
          }
        },
        {
          key: '_toHeaderString',
          value: function (e, t) {
            for (this._toStringFromStart(0, t); this._currPosIdx < t.length; ) {
              if (t[this._currPosIdx].match('@<TRIPOS>'.concat(e))) return
              this._currPosIdx++
            }
            this._toStringFromStart(0, t)
          }
        },
        {
          key: '_toStringFromHeader',
          value: function (e, t, r) {
            this._toHeaderString(e, r)
            t = this._currPosIdx + t
            r[this._currPosIdx].match('@<TRIPOS>'.concat(e)) &&
              t < r.length &&
              (this._currPosIdx = t)
          }
        },
        {
          key: '_setStart',
          value: function (e, t) {
            e >= t.length
              ? (this._currStartIdx = this._currPosIdx = t.length - 1)
              : (this._currStartIdx = this._currPosIdx = e)
          }
        },
        {
          key: '_probablyHaveDataToParse',
          value: function (e) {
            return this._currPosIdx < e.length - 2
          }
        },
        {
          key: '_findNextCompoundStart',
          value: function (e) {
            for (
              ;
              this._currPosIdx < e.length &&
              '@<TRIPOS>MOLECULE>' !== e[this._currPosIdx].trim();

            )
              this._currPosIdx++
            return (
              this._setStart(++this._currPosIdx, e),
              this._probablyHaveDataToParse(e)
            )
          }
        },
        {
          key: '_parseMolecule',
          value: function (e) {
            this._toHeaderString('MOLECULE', e)
            var t = this._complex.metadata
            ;(t.name = e[++this._currPosIdx]),
              (t.format = 'mol2'),
              (this._molecule = { _index: '', _chains: [] }),
              (this._molecule._index = this._compoundIndx + 1),
              this._molecules.push(this._molecule)
          }
        },
        {
          key: '_parseAtoms',
          value: function (e, t) {
            this._toHeaderString('ATOM', t)
            for (var r = 0; r < e; r++) {
              var n = Ku(t[++this._currPosIdx])
              if (n.length < 6)
                throw new Error(
                  'MOL2 parsing error: Not enough information to create atom!'
                )
              var i = parseInt(n[0], 10),
                o = n[1],
                s = parseFloat(n[2]),
                a = parseFloat(n[3]),
                l = parseFloat(n[4]),
                c = n[5].split('.')[0].toUpperCase(),
                u = 0
              9 <= n.length && (u = parseFloat(n[8]) || 0),
                this._chain ||
                  ((this._chain =
                    this._complex.getChain('A') || this._complex.addChain('A')),
                  (this._residue = null)),
                this._setResidue(n) &&
                  ((n = Hu.getByName(c)),
                  (c = Hu.Role[o]),
                  (l = new ae.Vector3(s, a, l)),
                  this._residue.addAtom(o, n, l, c, !1, i, ' ', 1, 0, u))
            }
          }
        },
        {
          key: '_setResidue',
          value: function (e) {
            var t = 1,
              r = 'UNK'
            if (
              (7 <= e.length && (t = parseInt(e[6], 10)),
              8 <= e.length && '<0>' !== e[7] && (r = e[7].replace($u, '')),
              this.settings.now.nowater && ('HOH' === r || 'WAT' === r))
            )
              return !1
            var n = this._residue,
              e = this._chain
            return (
              (n && n.getSequence() === t) ||
                (this._residue = e.addResidue(r, t, 'A')),
              !0
            )
          }
        },
        {
          key: '_parseBonds',
          value: function (e, t) {
            this._toHeaderString('BOND', t)
            for (var r = 0; r < e; r++) {
              var n = Ku(t[++this._currPosIdx])
              if (n.length < 3)
                throw new Error(
                  'MOL2 parsing error: Missing information about bonds!'
                )
              var i = parseInt(n[1], 10),
                o = parseInt(n[2], 10),
                s = n[3]
              o < i && ((i = (n = [o, i])[0]), (o = n[1])),
                this._complex.addBond(
                  i,
                  o,
                  Xu[s] || 0,
                  qu[s] || Wu.BondType.UNKNOWN,
                  !0
                )
            }
          }
        },
        {
          key: '_fixSerialAtoms',
          value: function () {
            for (var e = this._complex._atoms, t = 0; t < e.length; t++) {
              var r = e[t]
              this._serialAtomMap[r.serial] = r
            }
          }
        },
        {
          key: '_fixBondsArray',
          value: function () {
            var e = this._serialAtomMap,
              t = this._complex
            if (0 === Object.keys(e).length)
              throw new Error('MOL2 parsing error: Missing atom information!')
            for (var r = t._bonds, n = 0; n < r.length; n++) {
              var i = r[n]
              ;(i._left = e[i._left] || null), (i._right = e[i._right] || null)
            }
          }
        },
        {
          key: '_finalizeMolecules',
          value: function () {
            var e = this._complex._chains[0]
            this._complex._molecules = []
            for (var t = 0; t < this._molecules.length; t++) {
              var r = this._molecules[t],
                n = e._residues,
                r = new Yu(this._complex, r._name, t + 1)
              ;(r.residues = n), (this._complex._molecules[t] = r)
            }
          }
        },
        {
          key: '_finalize',
          value: function () {
            this._complex._finalizeBonds(),
              this._fixSerialAtoms(),
              this._fixBondsArray(),
              this._finalizeMolecules(),
              this._complex.finalize({
                needAutoBonding: !1,
                detectAromaticLoops: this.settings.now.aromatic,
                enableEditing: this.settings.now.editing,
                serialAtomMap: this._serialAtomMap
              })
          }
        },
        {
          key: '_parseCompound',
          value: function (e) {
            this._compoundIndx++,
              this._parseMolecule(e),
              this._toStringFromHeader('MOLECULE', 2, e)
            var t = e[this._currPosIdx].trim().split(Zu),
              r = t[0],
              t = t[1]
            this._parseAtoms(r, e), this._parseBonds(t, e)
          }
        },
        {
          key: 'parseSync',
          value: function () {
            for (
              var e = (this._complex = new ju()),
                t = this._parseRawStrings(this._data);
              this._parseCompound(t), this._findNextCompoundStart(t);

            );
            return this._finalize(), e
          }
        }
      ]),
      n
    )
  })()
  ;(Qe.formats = ['mol2']), (Qe.extensions = ['.mol2', '.ml2', '.sy2'])
  mo = new gn([ni, xi, bi, ki, li, Fi, Gi, Si, Wi, Qi, Qe])
  function Qu(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var _o = (function () {
      x(r, Ir)
      var t = Qu(r)
      function r() {
        var e =
          0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : []
        return G(this, r), t.call(this, e, ['formats'])
      }
      return (
        p(r, [
          {
            key: 'find',
            value: function (e) {
              var t = []
              return Nr(
                (t = e.format
                  ? this._dict.formats[e.format.toLowerCase()] || []
                  : t)
              )
            }
          }
        ]),
        r
      )
    })(),
    Ju = (function () {
      function r(e, t) {
        G(this, r),
          (this._source = e),
          (this._options = t || {}),
          (this._abort = !1)
      }
      return (
        p(r, [
          {
            key: 'exportSync',
            value: function () {
              throw new Error('Exporting to this source is not implemented')
            }
          },
          {
            key: 'export',
            value: function () {
              var r = this
              return new Promise(function (e, t) {
                setTimeout(function () {
                  try {
                    return r._abort
                      ? t(new Error('Export aborted'))
                      : e(r.exportSync())
                  } catch (e) {
                    return t(e)
                  }
                })
              })
            }
          },
          {
            key: 'abort',
            value: function () {
              this._abort = !0
            }
          }
        ]),
        r
      )
    })()
  Or(Ju.prototype)
  var eh = (function () {
    function e() {
      G(this, e),
        (this._resultArray = []),
        (this._currentStr = -1),
        (this._tag = null),
        (this._fixedNumeration = !1),
        (this._numeration = !1),
        (this._tagStrNum = 0)
    }
    return (
      p(e, [
        {
          key: 'getResult',
          value: function () {
            return this.writeString('\n', 81, 81), this._resultArray.join('')
          }
        },
        {
          key: '_currentStrLength',
          value: function () {
            var e = this._resultArray[this._currentStr]
            return e ? e.length : 0
          }
        },
        {
          key: 'newTag',
          value: function (e, t) {
            ;(this._tag = e || null),
              b.default.isUndefined(t)
                ? ((this._numeration = !1),
                  (this._fixedNumeration = !1),
                  (this._tagStrNum = 0))
                : b.default.isNumber(t)
                ? ((this._tagStrNum = t),
                  (this._numeration = !0),
                  (this._fixedNumeration = !0))
                : b.default.isBoolean(t) &&
                  ((this._tagStrNum = 0),
                  (this._numeration = t),
                  (this._fixedNumeration = !1))
          }
        },
        {
          key: 'newString',
          value: function (e) {
            this.writeString('\n', 81, 81),
              this._currentStr++,
              this._resultArray.push(''),
              e
                ? this.writeString(e, 1, 6)
                : this._tag && this.writeString(this._tag, 1, 6),
              this._numeration &&
                (this._fixedNumeration || this._tagStrNum++,
                1 !== this._tagStrNum &&
                  this.writeString(this._tagStrNum.toString(), 10, 8))
          }
        },
        {
          key: 'writeEntireString',
          value: function (e, t, r) {
            t = t || 81
            for (var n = 0; n < e.length; n++)
              this._currentStrLength() === t &&
                n !== e.length - 1 &&
                (this.newString(),
                r && this.writeString(r.tag, r.begin, r.end)),
                '\n' === e[n] ? this.newString() : this.writeString(e[n])
          }
        },
        {
          key: 'writeString',
          value: function (e, t, r) {
            var n,
              i,
              o = this._resultArray[this._currentStr],
              s = o ? o.length : 0
            b.default.isUndefined(e) ||
              ((n =
                (t = !b.default.isNumber(t) ? s + 1 : t) <
                (r = !b.default.isNumber(r) ? s + e.length : r)
                  ? r
                  : t),
              (i = t < r ? t : r),
              (e = b.default.isString(e) ? e : e.toString()).length >
                Math.abs(t - r) + 1 && (e = e.substr(0, Math.abs(t - r + 1))),
              s + 1 < i
                ? (this._resultArray[this._currentStr] += ' '.repeat(i - s - 1))
                : i <= s &&
                  ((s = this._resultArray[this._currentStr]),
                  (this._resultArray[this._currentStr] = s.slice(0, i - 1))),
              r < t && (e = ' '.repeat(t - r + 1 - e.length) + e),
              11 === i &&
                this._numeration &&
                1 !== this._tagStrNum &&
                (e = ' '.concat(e)),
              (this._resultArray[this._currentStr] += e),
              n > (o = this._resultArray[this._currentStr]).length &&
                (this._resultArray[this._currentStr] += ' '.repeat(
                  n - o.length
                )))
          }
        },
        {
          key: 'writeBondsArray',
          value: function (e, t) {
            for (var r = this._getSubArrays(e, 4), n = 0; n < r.length; n++) {
              this.newString(), this.writeString(t.serial, 11, 7)
              for (var i = 0; i < r[n].length; i++) {
                var o = (
                  r[n][i]._left.serial === t.serial
                    ? r[n][i]._right
                    : r[n][i]._left
                ).serial
                this.writeString(o, 16 + 5 * i, 12 + 5 * i)
              }
            }
          }
        },
        {
          key: '_getSubArrays',
          value: function (e, t) {
            for (var r = [], n = 0; n < e.length; n += t)
              r.push(e.slice(n, n + t))
            return r
          }
        },
        {
          key: 'writeMatrix',
          value: function (e, t, r) {
            for (var n = 0; n < 3; n++) {
              this.newString(),
                this.writeString(r, 14, 18),
                this.writeString((n + 1).toString(), 19, 19),
                this.writeString(t.toString(), 23, 20)
              for (var i = 0; i < 3; i++) {
                var o = parseFloat(e.elements[4 * n + i]).toFixed(6)
                this.writeString(o.toString(), 33 + 10 * i, 24 + 10 * i)
              }
              var s = parseFloat(e.elements[4 * n + 3]).toFixed(5)
              this.writeString(s.toString(), 68, 55)
            }
          }
        },
        {
          key: 'writeMatrices',
          value: function (e, t) {
            if (e)
              for (var r = new i.Matrix4(), n = 0; n < e.length; n++)
                r.copy(e[n]).transpose(), this.writeMatrix(r, n + 1, t)
          }
        }
      ]),
      e
    )
  })()
  function th(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Ro = (function () {
    x(n, Ju)
    var r = th(n)
    function n(e, t) {
      return (
        G(this, n),
        ((t = r.call(this, e, t))._tags = [
          'HEADER',
          'TITLE',
          'COMPND',
          'REMARK',
          'HELIX',
          'SHEET',
          'ATOM and HETATM',
          'CONECT'
        ]),
        (t._result = null),
        (t._tagExtractors = {
          HEADER: t._extractHEADER,
          TITLE: t._extractTITLE,
          'ATOM and HETATM': t._extractATOM,
          CONECT: t._extractCONECT,
          COMPND: t._extractCOMPND,
          REMARK: t._extractREMARK,
          HELIX: t._extractHELIX,
          SHEET: t._extractSHEET
        }),
        (t._stringForRemark350 =
          'COORDINATES FOR A COMPLETE MULTIMER REPRESENTING THE KNOWN\nBIOLOGICALLY SIGNIFICANT OLIGOMERIZATION STATE OF THE\nMOLECULE CAN BE GENERATED BY APPLYING BIOMT TRANSFORMATIONS\nGIVEN BELOW.  BOTH NON-CRYSTALLOGRAPHIC AND\nCRYSTALLOGRAPHIC OPERATIONS ARE GIVEN.'),
        (t._stringForRemark290 =
          'CRYSTALLOGRAPHIC SYMMETRY TRANSFORMATIONS\nTHE FOLLOWING TRANSFORMATIONS OPERATE ON THE ATOM/HETATM\nRECORDS IN THIS ENTRY TO PRODUCE CRYSTALLOGRAPHICALLY\nRELATED MOLECULES.'),
        t
      )
    }
    return (
      p(n, [
        {
          key: 'exportSync',
          value: function () {
            var e = new eh()
            if (!this._source) return this._result
            for (var t = 0; t < this._tags.length; t++) {
              var r = this._tags[t],
                r = this._tagExtractors[r]
              'function' == typeof r && r.call(this, e)
            }
            return (this._result = e.getResult()), this._result
          }
        },
        {
          key: '_extractHEADER',
          value: function (e) {
            var t
            this._source.metadata &&
              ((t = this._source.metadata),
              e.newTag('HEADER'),
              e.newString(),
              t.classification && e.writeString(t.classification, 11, 50),
              t.date && e.writeString(t.date, 51, 59),
              t.id && e.writeString(t.id, 63, 66))
          }
        },
        {
          key: '_extractTITLE',
          value: function (e) {
            if (this._source.metadata) {
              var t = this._source.metadata
              if (t.title) {
                e.newTag('TITLE', !0)
                for (var r = 0; r < t.title.length; r++)
                  e.newString(), e.writeString(t.title[r], 11, 80)
              }
            }
          }
        },
        {
          key: '_extractCONECT',
          value: function (e) {
            if (this._source._atoms) {
              var t = this._source._atoms
              e.newTag('CONECT')
              for (var r = 0; r < t.length; r++) {
                var n = t[r].bonds.filter(function (e) {
                  return e._fixed
                })
                0 !== n.length && e.writeBondsArray(n.reverse(), t[r])
              }
            }
          }
        },
        {
          key: '_extractSHEET',
          value: function (e) {
            if (this._source._sheets) {
              e.newTag('SHEET')
              for (var t = this._source._sheets, r = 0; r < t.length; r++)
                if (t[r]._strands)
                  for (var n = t[r]._strands, i = 0; i < n.length; i++)
                    e.newString(),
                      e.writeString(i + 1, 10, 8),
                      e.writeString(t[r]._name, 14, 12),
                      e.writeString(n.length, 16, 15),
                      e.writeString(n[i].init._type._name, 18, 20),
                      e.writeString(n[i].init._chain._name, 22, 22),
                      e.writeString(n[i].init._sequence, 26, 23),
                      e.writeString(n[i].init._icode, 27, 27),
                      e.writeString(n[i].term._type._name, 29, 31),
                      e.writeString(n[i].init._chain._name, 33, 33),
                      e.writeString(n[i].term._sequence, 37, 34),
                      e.writeString(n[i].term._icode, 38, 38),
                      e.writeString(n[i].sense, 40, 39)
            }
          }
        },
        {
          key: '_extractHELIX',
          value: function (e) {
            if (this._source._helices) {
              e.newTag('HELIX')
              for (var t = this._source._helices, r = 0; r < t.length; r++) {
                var n = t[r],
                  i = b.default.invert(We)
                e.newString(),
                  e.writeString(n.serial, 10, 8),
                  e.writeString(n.name, 14, 12),
                  e.writeString(n.init._type._name, 16, 18),
                  e.writeString(n.init._chain._name, 20, 20),
                  e.writeString(n.init._sequence, 25, 22),
                  e.writeString(n.init._icode, 26, 26),
                  e.writeString(n.term._type._name, 28, 30),
                  e.writeString(n.term._chain._name, 32, 32),
                  e.writeString(n.term._sequence, 37, 34),
                  e.writeString(n.term._icode, 38, 38),
                  e.writeString(i[n.type], 40, 39),
                  e.writeString(n.comment, 41, 70),
                  e.writeString(n.length, 76, 72)
              }
            }
          }
        },
        {
          key: '_extractATOM',
          value: function (e) {
            if (this._source._atoms)
              for (var t = this._source._atoms, r = 0; r < t.length; r++) {
                var n = t[r].het ? 'HETATM' : 'ATOM'
                e.newString(n)
                n =
                  1 < t[r].element.name.length || 3 < t[r].name.length ? 13 : 14
                e.writeString(t[r].serial, 11, 7),
                  e.writeString(t[r].name, n, 16),
                  e.writeString(String.fromCharCode(t[r].location), 17, 17),
                  e.writeString(t[r].residue._type._name, 20, 18),
                  e.writeString(t[r].residue._chain._name, 22, 22),
                  e.writeString(t[r].residue._sequence, 26, 23),
                  e.writeString(t[r].residue._icode, 27, 27),
                  e.writeString(t[r].position.x.toFixed(3), 38, 31),
                  e.writeString(t[r].position.y.toFixed(3), 46, 39),
                  e.writeString(t[r].position.z.toFixed(3), 54, 47),
                  e.writeString(t[r].occupancy.toFixed(2), 60, 55),
                  e.writeString(t[r].temperature.toFixed(2), 66, 61),
                  e.writeString(t[r].element.name, 78, 77),
                  t[r].charge && e.writeString(t[r].charge, 79, 80)
              }
          }
        },
        {
          key: '_extractCOMPND',
          value: function (e) {
            if (this._source._molecules) {
              var t = this._source._molecules
              e.newTag('COMPND', !0)
              for (var r = 0; r < t.length; r++) {
                var n = this._getMoleculeChains(t[r])
                e.newString(),
                  e.writeString('MOL_ID: '.concat(t[r].index, ';'), 11, 80),
                  e.newString(),
                  e.writeString('MOLECULE: '.concat(t[r].name, ';'), 11, 80),
                  e.newString(),
                  e.writeString('CHAIN: ', 11, 18)
                n = ''.concat(n.join(', '), ';')
                e.writeEntireString(n, 81)
              }
            }
          }
        },
        {
          key: '_extractREMARK',
          value: function (e) {
            this._Remark290(e), this._Remark350(e)
          }
        },
        {
          key: '_Remark290',
          value: function (e) {
            var t
            this._source.symmetry &&
              0 !== this._source.symmetry.length &&
              ((t = this._source.symmetry),
              e.newTag('REMARK', 290),
              e.newString(),
              e.newString(),
              e.writeEntireString(this._stringForRemark290),
              e.writeMatrices(t, 'SMTRY'),
              e.newString(),
              e.newString(),
              e.writeString('REMARK: NULL', 11, 80))
          }
        },
        {
          key: '_Remark350',
          value: function (e) {
            if (this._source.units) {
              var t = this._source.units,
                r = 0
              e.newTag('REMARK', 350),
                e.newString(),
                e.newString(),
                e.writeEntireString(this._stringForRemark350)
              for (
                var n = t.filter(function (e) {
                    return e instanceof kt
                  }),
                  i = 0;
                i < n.length;
                i++
              ) {
                e.newString(),
                  e.newString(),
                  r++,
                  e.writeString('BIOMOLECULE: '.concat(r), 11, 80)
                var o = n[i].chains.join(', ')
                e.newString(),
                  e.writeString('APPLY THE FOLLOWING TO CHAINS: '),
                  e.writeEntireString(o, 69, {
                    tag: 'AND CHAINS: ',
                    begin: 31,
                    end: 42
                  })
                o = n[i].matrices
                e.writeMatrices(o, 'BIOMT')
              }
            }
          }
        },
        {
          key: '_getMoleculeChains',
          value: function (e) {
            var r = e.residues.map(function (e) {
              return e._chain._name
            })
            return r.filter(function (e, t) {
              return r.indexOf(e) === t
            })
          }
        }
      ]),
      n
    )
  })()
  ;(Ro.formats = ['pdb']), (Ro.SourceClass = lr)
  function rh(e, t, r, n) {
    ;(r[n] = e[t]), (r[n + 1] = e[t + 1]), (r[n + 2] = e[t + 2])
  }
  function nh(e, t, r, n, i) {
    ;(r[n] = e[t]), (r[n + 1] = e[t + 1]), (r[n + 2] = e[t + 2]), (r[n + 3] = i)
  }
  var ih = new ae.Vector4()
  function oh(e, t, r, n, i) {
    ih.set(e[t], e[t + 1], e[t + 2], i.w),
      ih.applyMatrix4(i.matrix),
      (r[n] = ih.x),
      (r[n + 1] = ih.y),
      (r[n + 2] = ih.z)
  }
  function sh(e, t, r, n, i) {
    if (
      !(
        (t.array.length - t.start) / t.stride < r ||
        (e.array.length - e.start) / e.stride < r
      )
    )
      if (e.stride === t.stride) t.array.set(e.array, t.start)
      else
        for (
          var o = t.start, s = e.start, a = 0;
          a < r;
          ++a, o += t.stride, s += e.stride
        )
          n(e.array, s, t.array, o, i)
  }
  var ah = (function () {
      function e() {
        G(this, e),
          (this.positions = null),
          (this.normals = null),
          (this.colors = null),
          (this.indices = null),
          (this.lastPos = 0),
          (this.lastNorm = 0),
          (this.lastCol = 0),
          (this.lastIdx = 0)
      }
      return (
        p(e, [
          {
            key: 'init',
            value: function (e, t) {
              ;(this.positions = new Float32Array(3 * e)),
                (this.normals = new Float32Array(3 * e)),
                (this.colors = new Float32Array(4 * e)),
                (this.indices = new Int32Array(t))
            }
          },
          {
            key: 'setPositions',
            value: function (e, t, r, n) {
              sh(
                { array: e, start: t, stride: n },
                { array: this.positions, start: this.lastPos, stride: 3 },
                r,
                rh
              ),
                (this.lastPos += 3 * r)
            }
          },
          {
            key: 'setTransformedPositions',
            value: function (e, t, r, n, i) {
              for (
                var o = this.lastPos, s = t, a = { matrix: i, w: 1 }, l = 0;
                l < r;
                ++l, s += n, o += 3
              )
                oh(e, s, this.positions, o, a)
              this.lastPos += 3 * r
            }
          },
          {
            key: 'setNormals',
            value: function (e, t, r, n) {
              sh(
                { array: e, start: t, stride: n },
                { array: this.normals, start: this.lastNorm, stride: 3 },
                r,
                rh
              ),
                (this.lastNorm += 3 * r)
            }
          },
          {
            key: 'setTransformedNormals',
            value: function (e, t, r, n, i) {
              for (
                var o = this.lastNorm, s = t, a = { matrix: i, w: 0 }, l = 0;
                l < r;
                ++l, s += n, o += 3
              )
                oh(e, s, this.normals, o, a)
              this.lastNorm += 3 * r
            }
          },
          {
            key: 'setColors',
            value: function (e, t, r, n) {
              sh(
                { array: e, start: t, stride: n },
                { array: this.colors, start: this.lastCol, stride: 4 },
                r,
                nh,
                1
              ),
                (this.lastCol += 4 * r)
            }
          },
          {
            key: 'setIndices',
            value: function (e, t, r) {
              this.indices.set(e, this.lastIdx), (this.lastIdx += r)
            }
          },
          {
            key: 'setShiftedIndices',
            value: function (e, t, r) {
              e = e.map(function (e) {
                return e + r
              })
              this.setIndices(e, 0, t)
            }
          },
          {
            key: 'getVerticesNumber',
            value: function () {
              return this.lastPos / 3
            }
          },
          {
            key: 'addInstance',
            value: function (e, t) {
              var r = this.getVerticesNumber()
              this.setShiftedIndices(t.indices, t.indices.length, r)
              r = t.itemSize
              this.setTransformedPositions(
                t.positions,
                0,
                t.vertsCount,
                r.position,
                e
              ),
                this.setTransformedNormals(
                  t.normals,
                  0,
                  t.vertsCount,
                  r.normal,
                  e
                ),
                this.setColors(t.colors, 0, t.vertsCount, r.color)
            }
          }
        ]),
        e
      )
    })(),
    lh = (function () {
      function e() {
        G(this, e),
          (this.positions = null),
          (this.normals = null),
          (this.colors = null),
          (this.indices = null),
          (this.vertsCount = 0),
          (this.itemSize = null)
      }
      return (
        p(e, [
          {
            key: 'init',
            value: function (e, t) {
              e = e.attributes
              this.itemSize = {
                position: e.position.itemSize,
                normal: e.normal.itemSize,
                color: e.color.itemSize
              }
            }
          }
        ]),
        e
      )
    })()
  function ch(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var uh = (function () {
    x(n, lh)
    var e = ch(n)
    function n() {
      return G(this, n), e.apply(this, arguments)
    }
    return (
      p(n, [
        {
          key: 'init',
          value: function (e, t) {
            Xe(C(n.prototype), 'init', this).call(this, e, t)
            var r = e.attributes,
              t = r.position,
              r = r.normal,
              e = e.index
            ;(this.vertsCount = t.count),
              (this.positions = t.array),
              (this.normals = r.array),
              (this.colors = new Float32Array(
                this.vertsCount * this.itemSize.color
              )),
              (this.indices = e.array)
          }
        },
        {
          key: 'setColors',
          value: function (e) {
            for (
              var t = 0, r = 0, n = this.colors.length, i = this.itemSize.color;
              r < n;
              r += i
            )
              (this.colors[t++] = e.r),
                (this.colors[t++] = e.g),
                (this.colors[t++] = e.b)
          }
        }
      ]),
      n
    )
  })()
  function hh(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var fh = (function () {
      x(i, lh)
      var t = hh(i)
      function i() {
        var e
        return (
          G(this, i),
          ((e = t.call(this))._cutRawStart = 0),
          (e._cutRawEnd = 0),
          (e._facesPerSlice = 0),
          e
        )
      }
      return (
        p(i, [
          {
            key: 'init',
            value: function (e, t) {
              Xe(C(i.prototype), 'init', this).call(this, e, t)
              var r = e.attributes.position,
                n = e.index
              ;(this.vertsCount = r.count + t.addPerCylinder),
                (this._facesPerSlice = t.addPerCylinder),
                (this.positions = new Float32Array(
                  this.vertsCount * r.itemSize
                )),
                (this.normals = new Float32Array(
                  this.vertsCount * this.itemSize.normal
                )),
                (this.colors = new Float32Array(
                  this.vertsCount * this.itemSize.color
                )),
                this._extendVertices(e, t),
                (this.indices = new Uint32Array(n.count)),
                this._extendIndices(e, t)
            }
          },
          {
            key: '_extendVertices',
            value: function (e, t) {
              var r = e.attributes.position,
                n = e.attributes.normal,
                e = e.getGeoParams()
              ;(this._cutRawStart = +e.radialSegments),
                (this._cutRawEnd = this._cutRawStart + t.addPerCylinder)
              t = r.array.slice(0, this._cutRawEnd * r.itemSize)
              this.positions.set(t, 0),
                (t = n.array.slice(0, this._cutRawEnd * n.itemSize)),
                this.normals.set(t, 0)
              t = r.array.slice(this._cutRawStart * r.itemSize, r.array.length)
              this.positions.set(t, this._cutRawEnd * r.itemSize),
                (t = n.array.slice(
                  this._cutRawStart * n.itemSize,
                  n.array.length
                )),
                this.normals.set(t, this._cutRawEnd * n.itemSize)
            }
          },
          {
            key: '_extendIndices',
            value: function (e, t) {
              var r = e.index,
                e = 6 * t.addPerCylinder,
                n = t.addPerCylinder,
                t = (t = r.array.slice(e, r.count)).map(function (e) {
                  return e + n
                })
              this.indices.set(r.array, 0), this.indices.set(t, e)
            }
          },
          {
            key: '_setColorRange',
            value: function (e, t, r, n) {
              for (var i = n.length, o = e; o < t; o += i) r.set(n, o)
            }
          },
          {
            key: 'setColors',
            value: function (e, t) {
              var r = this.itemSize.color,
                n = this._cutRawEnd * r,
                i = 2 * n
              this._setColorRange(0, n, this.colors, e.toArray()),
                this._setColorRange(n, i, this.colors, t.toArray()),
                i < this.colors.length &&
                  ((r = (this._facesPerSlice + 1) * r),
                  this._setColorRange(i, (i = i + r), this.colors, t.toArray()),
                  this._setColorRange(i, i + r, this.colors, e.toArray()))
            }
          }
        ]),
        i
      )
    })(),
    dh = (function () {
      function e() {
        G(this, e), (this._materials = []), (this._models = [])
      }
      return (
        p(e, [
          {
            key: 'process',
            value: function (e) {
              this._extractModelsAndMaterials(e)
              var t = this._flattenModels()
              return { name: e.name, models: t, materials: this._materials }
            }
          },
          {
            key: '_extractModelsAndMaterials',
            value: function (e) {
              var t = this,
                r = new ae.Layers()
              r.set(kr.LAYERS.DEFAULT),
                r.enable(kr.LAYERS.TRANSPARENT),
                e.traverse(function (e) {
                  e instanceof ae.Mesh &&
                    e.layers.test(r) &&
                    t.checkExportAbility(e) &&
                    ('InstancedBufferGeometry' === e.geometry.type
                      ? t._collectInstancedGeoInfo(e)
                      : t._collectGeoInfo(e))
                })
            }
          },
          {
            key: '_reworkIndices',
            value: function (e) {
              for (var t = 2; t < e.length; t += 3) (e[t] *= -1), e[t]--
            }
          },
          {
            key: '_flattenModels',
            value: function () {
              var t = 0
              function e(e) {
                return e + t
              }
              for (var r = [], n = 0, i = this._models.length; n < i; n++) {
                for (
                  var o = this._models[n],
                    s = [],
                    a = [],
                    l = [],
                    c = [],
                    t = 0,
                    u = 0;
                  u < o.length;
                  u++
                ) {
                  var h = o[u]
                  s.push(h.indices.map(e)),
                    (t += h.getVerticesNumber()),
                    a.push(h.positions),
                    l.push(h.normals),
                    c.push(h.colors)
                }
                ;(s = le.mergeTypedArraysUnsafe(s)),
                  this._reworkIndices(s),
                  (a = le.mergeTypedArraysUnsafe(a)),
                  (l = le.mergeTypedArraysUnsafe(l)),
                  (c = le.mergeTypedArraysUnsafe(c)),
                  r.push({
                    indices: s,
                    positions: a,
                    normals: l,
                    colors: c,
                    verticesCount: t
                  })
              }
              return r
            }
          },
          {
            key: 'checkExportAbility',
            value: function (e) {
              return (
                0 !== e.geometry.attributes.position.count &&
                (e instanceof Vi
                  ? (L.warn(
                      "Currently we cannot export 'sprites' modes, like BS, WV, LC. Please turn of settings 'zSprites' and try again"
                    ),
                    !1)
                  : !(e instanceof $i) ||
                    (L.warn('Currently we cannot export Lines mode'), !1))
              )
            }
          },
          {
            key: '_collectGeoInfo',
            value: function (e) {
              var t = e.geometry,
                r = t.attributes,
                n = r.position,
                i = r.color,
                o = r.normal,
                s = t.index,
                a = e.matrix,
                r = new ah(),
                t = n.count
              r.init(t, s.count),
                a.isIdentity()
                  ? (r.setPositions(n.array, 0, t, n.itemSize),
                    r.setNormals(o.array, 0, t, o.itemSize))
                  : (r.setTransformedPositions(n.array, 0, t, n.itemSize, a),
                    r.setTransformedNormals(o.array, 0, t, o.itemSize, a)),
                r.setColors(i.array, 0, t, i.itemSize),
                r.setIndices(s.array, 0, s.count)
              e = this._collectMaterialInfo(e)
              this._addToPool(r, e)
            }
          },
          {
            key: '_collectSpheresInfo',
            value: function (e) {
              var t = e.geometry,
                r = t.attributes,
                n = r.position,
                i = r.color,
                t = t.index,
                o = e.matrix,
                s = new ah(),
                a = e.geometry.instanceCount,
                n = n.count,
                t = t.count
              s.init(a * n, a * t)
              var l = new uh()
              l.init(e.geometry)
              for (
                var c = new ae.Matrix4(),
                  u = new ae.Matrix4(),
                  h = new ae.Color(),
                  f = 0;
                f < a;
                ++f
              ) {
                var d = f * i.itemSize
                h.fromArray(i.array, d),
                  l.setColors(h),
                  this._getSphereInstanceMatrix(e.geometry, f, c),
                  u.multiplyMatrices(o, c),
                  s.addInstance(u, l)
              }
              t = this._collectMaterialInfo(e)
              this._addToPool(s, t)
            }
          },
          {
            key: '_collectCylindersInfo',
            value: function (e) {
              var t = e.geometry,
                r = t.attributes,
                n = r.position,
                i = r.color,
                o = r.color2,
                r = t.index,
                s = e.matrix,
                a = new ah(),
                l = e.geometry.instanceCount,
                c = new uh()
              c.init(e.geometry)
              var u = this._gatherCylindersColoringInfo(e.geometry),
                h = null
              0 < u.needToSplit && (h = new fh()).init(e.geometry, u)
              ;(t = u.addPerCylinder * u.needToSplit),
                (n = n.count),
                (r = r.count)
              a.init(l * n + t, l * r)
              for (
                var f = new ae.Matrix4(),
                  d = new ae.Matrix4(),
                  p = new ae.Color(),
                  m = new ae.Color(),
                  y = {},
                  _ = 0;
                _ < l;
                ++_
              ) {
                var v = _ * i.itemSize
                u.is2Colored[_]
                  ? (p.fromArray(o.array, v),
                    m.fromArray(i.array, v),
                    h && (h.setColors(p, m), (y = h)))
                  : (p.fromArray(i.array, v), c.setColors(p), (y = c)),
                  this._getCylinderInstanceMatrix(e.geometry, _, f),
                  d.multiplyMatrices(s, f),
                  a.addInstance(d, y)
              }
              r = this._collectMaterialInfo(e)
              this._addToPool(a, r)
            }
          },
          {
            key: '_addToPool',
            value: function (e, t) {
              var r = this._checkExistingMaterial(t)
              r < 0
                ? (this._models.push([e]), this._materials.push(t))
                : this._models[r].push(e)
            }
          },
          {
            key: '_checkExistingMaterial',
            value: function (t) {
              return b.default.findIndex(this._materials, function (e) {
                return b.default.isEqual(e, t)
              })
            }
          },
          {
            key: '_gatherCylindersColoringInfo',
            value: function (e) {
              for (
                var t = e.instanceCount,
                  r = e.attributes.color.array,
                  n = e.attributes.color2.array,
                  i = e.attributes.color.itemSize,
                  o = new Array(t),
                  s = 0,
                  a = 0,
                  l = 0;
                l < t;
                l++, a += i
              ) {
                var c =
                  1e-7 < Math.abs(r[a] - n[a]) ||
                  1e-7 < Math.abs(r[a + 1] - n[a + 1]) ||
                  1e-7 < Math.abs(r[a + 2] - n[a + 2])
                s += o[l] = c
              }
              return {
                is2Colored: o,
                needToSplit: s,
                addPerCylinder: e.getGeoParams().radialSegments
              }
            }
          },
          {
            key: '_collectInstancedGeoInfo',
            value: function (e) {
              e.geometry instanceof Gr
                ? this._collectSpheresInfo(e)
                : e.geometry instanceof cn && this._collectCylindersInfo(e)
            }
          },
          {
            key: '_collectMaterialInfo',
            value: function (e) {
              e = e.material.uberOptions
              return {
                diffuse: e.diffuse.toArray(),
                opacity: e.opacity,
                shininess: e.shininess,
                specular: e.specular.toArray()
              }
            }
          },
          {
            key: '_getCylinderInstanceMatrix',
            value: function (e, t, r) {
              var n = e.attributes.matVector1.array,
                i = e.attributes.matVector2.array,
                e = e.attributes.matVector3.array,
                t = 4 * t
              r.set(
                n[t],
                n[1 + t],
                n[2 + t],
                n[3 + t],
                i[t],
                i[1 + t],
                i[2 + t],
                i[3 + t],
                e[t],
                e[1 + t],
                e[2 + t],
                e[3 + t],
                0,
                0,
                0,
                1
              )
            }
          },
          {
            key: '_getSphereInstanceMatrix',
            value: function (e, t, r) {
              var n = e.attributes.offset,
                i = t * n.itemSize,
                o = n.array[i],
                e = n.array[1 + i],
                t = n.array[2 + i],
                i = n.array[3 + i]
              r.set(i, 0, 0, o, 0, i, 0, e, 0, 0, i, t, 0, 0, 0, 1)
            }
          }
        ]),
        e
      )
    })(),
    ph = (function () {
      function e() {
        G(this, e), (this._resultArray = []), (this._info = null)
      }
      return (
        p(e, [
          {
            key: 'getResult',
            value: function (e) {
              return (
                (this._info = e),
                this._resultArray.push(this._writeHeader()),
                this._resultArray.push(this._writeDefinitions()),
                this._resultArray.push(
                  this._writeObjects(e.models, e.materials)
                ),
                this._resultArray.push(this._writeRelations()),
                this._resultArray.push(this._writeConnections()),
                (this._info = null),
                this._resultArray.join('')
              )
            }
          },
          {
            key: '_writeHeader',
            value: function () {
              var e = new Date(),
                t = 'Miew FBX Exporter v'.concat(this._info.version)
              return '; FBX 6.1.0 project file\n; Created by '
                .concat(
                  t,
                  ' Copyright (c) 2015-2020 EPAM Systems, Inc.\n; For support please contact miew@epam.com\n; ----------------------------------------------------\n\nFBXHeaderExtension:  {\n  FBXHeaderVersion: '
                )
                .concat(1003, '\n  FBXVersion: ')
                .concat(6100, '\n  CreationTimeStamp:  {\n    Version: ')
                .concat(1e3, '\n    Year: ')
                .concat(e.getFullYear(), '\n    Month: ')
                .concat(e.getMonth() + 1, ' \n    Day: ')
                .concat(e.getDate(), '\n    Hour: ')
                .concat(e.getHours(), '\n    Minute: ')
                .concat(e.getMinutes(), '\n    Second: ')
                .concat(e.getSeconds(), '\n    Millisecond: ')
                .concat(e.getMilliseconds(), '\n  }\n  Creator: "')
                .concat(
                  t,
                  '"\n  OtherFlags:  {\n    FlagPLE: 0\n  }\n}\nCreationTime: "'
                )
                .concat(e, '"\nCreator: "')
                .concat(t, '"  \n')
            }
          },
          {
            key: '_writeDefinitions',
            value: function () {
              return '\n; Object definitions\n;------------------------------------------------------------------\n\n'.concat(
                '\nDefinitions:  {\n  Version: 100\n  Count: 3\n  ObjectType: "Model" {\n    Count: 1\n  }\n  ObjectType: "Geometry" {\n    Count: 1\n  }\n  ObjectType: "Material" {\n    Count: 1\n  }\n  ObjectType: "Pose" {\n    Count: 1\n  }\n  ObjectType: "GlobalSettings" {\n    Count: 1\n  }\n} ',
                '\n'
              )
            }
          },
          {
            key: '_models',
            value: function () {
              for (
                var e = '', t = this._info.models, r = 0;
                r < t.length;
                ++r
              ) {
                var n = t[r],
                  i = n.verticesCount
                e += '\n  Model: "Model::'
                  .concat(this._info.name, '_')
                  .concat(r, '", "Mesh" {\n    Version: ')
                  .concat(232, ' \n    ')
                  .concat(
                    'Properties60: {\n      Property: "QuaternionInterpolate", "bool", "",0\n      Property: "Visibility", "Visibility", "A",1\n      Property: "Lcl Translation", "Lcl Translation", "A",0.000000000000000,0.000000000000000,-1789.238037109375000\n      Property: "Lcl Rotation", "Lcl Rotation", "A",0.000009334667643,-0.000000000000000,0.000000000000000\n      Property: "Lcl Scaling", "Lcl Scaling", "A",1.000000000000000,1.000000000000000,1.000000000000000\n      Property: "RotationOffset", "Vector3D", "",0,0,0\n      Property: "RotationPivot", "Vector3D", "",0,0,0\n      Property: "ScalingOffset", "Vector3D", "",0,0,0\n      Property: "ScalingPivot", "Vector3D", "",0,0,0\n      Property: "TranslationActive", "bool", "",0\n      Property: "TranslationMin", "Vector3D", "",0,0,0\n      Property: "TranslationMax", "Vector3D", "",0,0,0\n      Property: "TranslationMinX", "bool", "",0\n      Property: "TranslationMinY", "bool", "",0\n      Property: "TranslationMinZ", "bool", "",0\n      Property: "TranslationMaxX", "bool", "",0\n      Property: "TranslationMaxY", "bool", "",0\n      Property: "TranslationMaxZ", "bool", "",0\n      Property: "RotationOrder", "enum", "",0\n      Property: "RotationSpaceForLimitOnly", "bool", "",0\n      Property: "AxisLen", "double", "",10\n      Property: "PreRotation", "Vector3D", "",0,0,0\n      Property: "PostRotation", "Vector3D", "",0,0,0\n      Property: "RotationActive", "bool", "",0\n      Property: "RotationMin", "Vector3D", "",0,0,0\n      Property: "RotationMax", "Vector3D", "",0,0,0\n      Property: "RotationMinX", "bool", "",0\n      Property: "RotationMinY", "bool", "",0\n      Property: "RotationMinZ", "bool", "",0\n      Property: "RotationMaxX", "bool", "",0\n      Property: "RotationMaxY", "bool", "",0\n      Property: "RotationMaxZ", "bool", "",0\n      Property: "RotationStiffnessX", "double", "",0\n      Property: "RotationStiffnessY", "double", "",0\n      Property: "RotationStiffnessZ", "double", "",0\n      Property: "MinDampRangeX", "double", "",0\n      Property: "MinDampRangeY", "double", "",0\n      Property: "MinDampRangeZ", "double", "",0\n      Property: "MaxDampRangeX", "double", "",0\n      Property: "MaxDampRangeY", "double", "",0\n      Property: "MaxDampRangeZ", "double", "",0\n      Property: "MinDampStrengthX", "double", "",0\n      Property: "MinDampStrengthY", "double", "",0\n      Property: "MinDampStrengthZ", "double", "",0\n      Property: "MaxDampStrengthX", "double", "",0\n      Property: "MaxDampStrengthY", "double", "",0\n      Property: "MaxDampStrengthZ", "double", "",0\n      Property: "PreferedAngleX", "double", "",0\n      Property: "PreferedAngleY", "double", "",0\n      Property: "PreferedAngleZ", "double", "",0\n      Property: "InheritType", "enum", "",0\n      Property: "ScalingActive", "bool", "",0\n      Property: "ScalingMin", "Vector3D", "",1,1,1\n      Property: "ScalingMax", "Vector3D", "",1,1,1\n      Property: "ScalingMinX", "bool", "",0\n      Property: "ScalingMinY", "bool", "",0\n      Property: "ScalingMinZ", "bool", "",0\n      Property: "ScalingMaxX", "bool", "",0\n      Property: "ScalingMaxY", "bool", "",0\n      Property: "ScalingMaxZ", "bool", "",0\n      Property: "GeometricTranslation", "Vector3D", "",0,0,0\n      Property: "GeometricRotation", "Vector3D", "",0,0,0\n      Property: "GeometricScaling", "Vector3D", "",1,1,1\n      Property: "LookAtProperty", "object", ""\n      Property: "UpVectorProperty", "object", ""\n      Property: "Show", "bool", "",1\n      Property: "NegativePercentShapeSupport", "bool", "",1\n      Property: "DefaultAttributeIndex", "int", "",0\n      Property: "Color", "Color", "A+",0,0,0\n      Property: "Size", "double", "",100\n      Property: "Look", "enum", "",1\n    }',
                    '\n    '
                  )
                  .concat(
                    this._verticesIndices(n.positions, n.indices),
                    '\n    '
                  )
                  .concat(this._normalLayer(n.normals), ' \n    ')
                  .concat(this._colorLayer(n.colors, i), ' \n    ')
                  .concat(
                    '\n    LayerElementMaterial: 0 {\n      Version: 101\n      Name: ""\n      MappingInformationType: "AllSame"\n      ReferenceInformationType: "Direct"\n      Materials: 0\n    }',
                    '  \n    '
                  )
                  .concat(
                    '\n    Layer: 0 {\n      Version: 100\n      LayerElement:  {\n        Type: "LayerElementNormal"\n        TypedIndex: 0\n      }\n      LayerElement:  {\n        Type: "LayerElementColor"\n        TypedIndex: 0\n      }\n      LayerElement:  {\n        Type: "LayerElementMaterial"\n        TypedIndex: 0\n      }\n    }',
                    '\n  }'
                  )
              }
              return e
            }
          },
          {
            key: '_materials',
            value: function () {
              for (
                var e = '', t = this._info.materials, r = 0;
                r < t.length;
                ++r
              ) {
                var n = t[r]
                e += '\n  Material: "Material::'
                  .concat(this._info.name, '_')
                  .concat(r, '_default", "" {\n    Version: ')
                  .concat(
                    102,
                    '\n    ShadingModel: "lambert"\n    MultiLayer: 0\n    '
                  )
                  .concat(this._materialProperties(n), '\n  }')
              }
              return e
            }
          },
          {
            key: '_writeObjects',
            value: function () {
              return '\n; Object properties\n;------------------------------------------------------------------\n\nObjects:  {\n  '
                .concat(this._models(), '\n  ')
                .concat(this._materials(), '\n  ')
                .concat(
                  'GlobalSettings: {\n    Version: 1000\n    Properties60:  {\n      Property: "UpAxis", "int", "",1\n      Property: "UpAxisSign", "int", "",1\n      Property: "FrontAxis", "int", "",2\n      Property: "FrontAxisSign", "int", "",1\n      Property: "CoordAxis", "int", "",0\n      Property: "CoordAxisSign", "int", "",1\n      Property: "UnitScaleFactor", "double", "",1\n    }\n  }',
                  '\n}\n'
                )
            }
          },
          {
            key: '_writeRelations',
            value: function () {
              for (var e = '', t = 0; t < this._info.models.length; ++t)
                e += '\n  Model: "Model::'
                  .concat(this._info.name, '_')
                  .concat(t, '", "Mesh" {\n  }')
              for (var r = '', n = 0; n < this._info.materials.length; ++n)
                r += '\n  Material: "Material::'
                  .concat(this._info.name, '_')
                  .concat(n, '_default", "" {\n  }')
              return '\n; Object relations\n;------------------------------------------------------------------\n\nRelations:  {\n  '
                .concat(
                  e,
                  '\n  Model: "Model::Producer Perspective", "Camera" {\n  }\n  Model: "Model::Producer Top", "Camera" {\n  }\n  Model: "Model::Producer Bottom", "Camera" {\n  }\n  Model: "Model::Producer Front", "Camera" {\n  }\n  Model: "Model::Producer Back", "Camera" {\n  }\n  Model: "Model::Producer Right", "Camera" {\n  }\n  Model: "Model::Producer Left", "Camera" {\n  }\n  Model: "Model::Camera Switcher", "CameraSwitcher" {\n  }\n  '
                )
                .concat(r, '\n}')
            }
          },
          {
            key: '_writeConnections',
            value: function () {
              for (
                var e = '', t = this._info.name, r = 0;
                r < this._info.models.length;
                ++r
              )
                e += '\n  Connect: "OO", "Model::'
                  .concat(t, '_')
                  .concat(r, '", "Model::Scene"')
              for (var n = '', i = 0; i < this._info.materials.length; ++i)
                n += '\n  Connect: "OO", "Material::'
                  .concat(t, '_')
                  .concat(i, '_default", "Model::')
                  .concat(t, '_')
                  .concat(i, '"')
              return '\n; Object connections\n;------------------------------------------------------------------\n\nConnections:  {\n  '
                .concat(e, '\n  ')
                .concat(n, '\n}')
            }
          },
          {
            key: '_floatArrayToString',
            value: function (e) {
              for (var t = [], r = 0; r < e.length; ++r) t[r] = e[r].toFixed(6)
              return t.join(',')
            }
          },
          {
            key: '_colorLayer',
            value: function (e, t) {
              ;(e = this._floatArrayToString(e)), (t = Nr(Array(t).keys()))
              return '\n    LayerElementColor: '
                .concat(0, ' {\n      Version: ')
                .concat(101, '\n      Name: "')
                .concat(
                  '',
                  '"\n      MappingInformationType: "ByVertice"\n      ReferenceInformationType: "Direct"\n      Colors: '
                )
                .concat(e, '\n      ColorIndex: ')
                .concat(t, '\n    }')
            }
          },
          {
            key: '_normalLayer',
            value: function (e) {
              e = this._floatArrayToString(e)
              return '\n    LayerElementNormal: '
                .concat(0, ' {\n      Version: ')
                .concat(101, '\n      Name: "')
                .concat(
                  '',
                  '"\n      MappingInformationType: "ByVertice"\n      ReferenceInformationType: "Direct" \n      Normals: '
                )
                .concat(e, '\n    }')
            }
          },
          {
            key: '_verticesIndices',
            value: function (e, t) {
              e = this._floatArrayToString(e)
              return 'MultiLayer: '
                .concat(0, '\n    MultiTake: ')
                .concat(1, '\n    Shading: ')
                .concat('Y', '\n    Culling: "')
                .concat('CullingOff', '"\n    Vertices: ')
                .concat(e, '\n    PolygonVertexIndex: ')
                .concat(t, '\n    GeometryVersion: ')
                .concat(124)
            }
          },
          {
            key: '_materialProperties',
            value: function (e) {
              return 'Properties60:  {\n      Property: "ShadingModel", "KString", "", "Lambert"\n      Property: "MultiLayer", "bool", "",0\n      Property: "EmissiveColor", "ColorRGB", "",0,0,0\n      Property: "EmissiveFactor", "double", "",0.0000\n      Property: "AmbientColor", "ColorRGB", "",1,1,1\n      Property: "AmbientFactor", "double", "",0.0000\n      Property: "DiffuseColor", "ColorRGB", "",'
                .concat(
                  e.diffuse,
                  '\n      Property: "DiffuseFactor", "double", "",1.0000\n      Property: "Bump", "Vector3D", "",0,0,0\n      Property: "TransparentColor", "ColorRGB", "",1,1,1\n      Property: "TransparencyFactor", "double", "",0.0000\n      Property: "SpecularColor", "ColorRGB", "",'
                )
                .concat(
                  e.specular,
                  '\n      Property: "SpecularFactor", "double", "",1.0000\n      Property: "ShininessExponent", "double", "",'
                )
                .concat(
                  e.shininess,
                  '\n      Property: "ReflectionColor", "ColorRGB", "",0,0,0\n      Property: "ReflectionFactor", "double", "",1\n      Property: "Ambient", "ColorRGB", "",1,1,1\n      Property: "Diffuse", "ColorRGB", "",'
                )
                .concat(
                  e.diffuse,
                  '\n      Property: "Specular", "ColorRGB", "",'
                )
                .concat(
                  e.specular,
                  '\n      Property: "Shininess", "double", "",'
                )
                .concat(
                  e.shininess,
                  '\n      Property: "Opacity", "double", "",'
                )
                .concat(
                  e.opacity,
                  '\n      Property: "Reflectivity", "double", "",0\n    }'
                )
            }
          }
        ]),
        e
      )
    })()
  function mh(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Po = (function () {
    x(i, Ju)
    var n = mh(i)
    function i(e, t) {
      var r
      return (
        G(this, i),
        ((r = n.call(this, e, t))._data = e),
        (r._version = t.miewVersion || '0.0-UNSPECIFIED'),
        (r._extractor = new dh()),
        r
      )
    }
    return (
      p(i, [
        {
          key: 'exportSync',
          value: function () {
            var e = new ph()
            if (!this._source) return this._result
            var t = this._extractor.process(this._data)
            return (
              (t.version = this._version),
              (this._result = e.getResult(t)),
              this._result
            )
          }
        }
      ]),
      i
    )
  })()
  ;(Po.formats = ['fbx']), (Po.SourceClass = $a)
  var yh,
    _h,
    vh,
    gh,
    xh,
    bh,
    wh,
    Sh,
    Rh,
    Ch,
    Ah,
    Eh,
    kh,
    Th,
    Ph,
    Mh,
    Nh,
    Lh,
    Ih,
    Oh = { loaders: Xr, parsers: mo, exporters: new _o([Ro, Po]) },
    Bh = new ae.Color(),
    Vh = (function () {
      function e() {
        G(this, e),
          (this._width = 0),
          (this._height = 0),
          (this._widthHalf = 0),
          (this._heightHalf = 0),
          (this._vector = new ae.Vector3()),
          (this._viewMatrix = new ae.Matrix4()),
          (this._projectionMatrix = new ae.Matrix4()),
          (this._domElement = document.createElement('div')),
          (this._domElement.style.overflow = 'hidden'),
          (this._domElement.style.position = 'absolute'),
          (this._domElement.style.top = '0'),
          (this._domElement.style.zIndex = '0'),
          (this._domElement.style.pointerEvents = 'none')
      }
      return (
        p(e, [
          {
            key: 'getElement',
            value: function () {
              return this._domElement
            }
          },
          {
            key: 'reset',
            value: function () {
              for (var e = this.getElement(); e.firstChild; )
                e.removeChild(e.firstChild)
            }
          },
          {
            key: 'setSize',
            value: function (e, t) {
              ;(this._width = e),
                (this._height = t),
                (this._widthHalf = this._width / 2),
                (this._heightHalf = this._height / 2),
                (this._domElement.style.width = ''.concat(e, 'px')),
                (this._domElement.style.height = ''.concat(t, 'px'))
            }
          },
          {
            key: '_renderObject',
            value: function (e, t, r) {
              function n(e, t, r) {
                return (
                  Bh.setHex(e), Bh.lerp(t, r), '#'.concat(Bh.getHexString())
                )
              }
              function i(e) {
                return Bh.setHex(e), '#'.concat(Bh.getHexString())
              }
              var o, s, a, l
              e instanceof dr &&
                (this._vector.setFromMatrixPosition(e.matrixWorld),
                void 0 !== e.userData &&
                  void 0 !== e.userData.offset &&
                  ((a = new ae.Vector3(
                    e.userData.offset.x,
                    e.userData.offset.y,
                    0
                  )),
                  this._vector.add(
                    a.multiplyScalar(e.matrixWorld.getMaxScaleOnAxis())
                  )),
                this._vector.applyMatrix4(this._viewMatrix),
                (o = this._vector.z > -t.near ? 'hidden' : 'visible'),
                (s = (1e4 * (t.far - -this._vector.z)) / (t.far - t.near)),
                (a = e.getElement()),
                void 0 === r.fog
                  ? ((a.style.color = i(e.userData.color)),
                    'transparent' !== e.userData.background &&
                      (a.style.background = i(e.userData.background)))
                  : ((l = ae.MathUtils.smoothstep(
                      -this._vector.z,
                      r.fog.near,
                      r.fog.far
                    )),
                    (a.style.color = n(e.userData.color, r.fog.color, l)),
                    'transparent' !== e.userData.background &&
                      (a.style.background = n(
                        e.userData.background,
                        r.fog.color,
                        l
                      ))),
                this._vector.applyMatrix4(this._projectionMatrix),
                (l = ''
                  .concat(
                    e.userData !== {}
                      ? e.userData.translation
                      : 'translate(-50%, -50%) ',
                    'translate('
                  )
                  .concat(
                    this._vector.x * this._widthHalf + this._widthHalf,
                    'px,'
                  )
                  .concat(
                    -this._vector.y * this._heightHalf + this._heightHalf,
                    'px)'
                  )),
                (a.style.visibility = o),
                (a.style.WebkitTransform = l),
                (a.style.MozTransform = l),
                (a.style.oTransform = l),
                (a.style.transform = l),
                (a.style.zIndex = Number(s).toFixed(0)),
                a.parentNode !== this._domElement &&
                  this._domElement.appendChild(a))
              for (var c = 0, u = e.children.length; c < u; c++)
                this._renderObject(e.children[c], t, r)
            }
          },
          {
            key: 'render',
            value: function (e, t) {
              e.updateMatrixWorld(),
                null === t.parent && t.updateMatrixWorld(),
                t.matrixWorldInverse.copy(t.matrixWorld).invert(),
                this._viewMatrix.copy(t.matrixWorldInverse),
                this._projectionMatrix.copy(t.projectionMatrix),
                this._renderObject(e, t, e)
            }
          }
        ]),
        e
      )
    })(),
    Dh = -1,
    zh = 0,
    Fh = 1,
    Uh = 2,
    Gh = 3,
    jh = new ae.Quaternion(),
    Hh = new ae.Matrix4()
  function Wh(e, t, r, n) {
    e = m((this.objects = e), 1)
    ;(this.object = e[0]),
      (this.camera = t),
      (this.pivot = r),
      (this.axis = new ae.Vector3(0, 0, 1)),
      (this.options = n),
      (this.lastRotation = { axis: new ae.Vector3(), angle: 0 })
  }
  function Yh(e, t, r, n, i) {
    T.call(this)
    var o = this
    ;(this.object = e),
      (this.objectPivot = t),
      (this.camera = r),
      (this.domElement = void 0 !== n ? n : document),
      (this.getAltObj = i),
      (this.enabled = !0),
      (this.hotkeysEnabled = !0),
      (this.screen = { left: 0, top: 0, width: 0, height: 0 }),
      (this.options = {
        rotateFactor: Math.PI,
        axisRotateFactor: 4 * Math.PI,
        intertia: !0,
        dynamicDampingFactor: 0.1,
        intertiaThreshold: 0.001
      }),
      (this._state = Dh),
      (this._mousePrevPos = new ae.Vector2()),
      (this._mouseCurPos = new ae.Vector2()),
      (this._mainObj = new Wh(
        [this.object],
        this.camera,
        new ae.Vector3(0, 0, 0),
        this.options
      )),
      (this._altObj = new Wh(
        [this.object],
        this.camera,
        new ae.Vector3(0, 0, 0),
        this.options
      )),
      (this._affectedObj = this._mainObj),
      (this._isAltObjFreeRotationAllowed = !0),
      (this._isTranslationAllowed = !0),
      (this._isKeysTranslatingObj = !1),
      (this._pressedKeys = []),
      (this._clock = new d()),
      this._clock.start(),
      (this._lastUpdateTime = this._clock.getElapsedTime()),
      (this._listeners = [
        {
          obj: o.domElement,
          type: 'mousedown',
          handler: function (e) {
            o.mousedown(e)
          }
        },
        {
          obj: o.domElement,
          type: 'mouseup',
          handler: function (e) {
            o.mouseup(e)
          }
        },
        {
          obj: o.domElement,
          type: 'mousemove',
          handler: function (e) {
            o.mousemove(e)
          }
        },
        {
          obj: o.domElement,
          type: 'mousewheel',
          handler: function (e) {
            o.mousewheel(e)
          }
        },
        {
          obj: o.domElement,
          type: 'DOMMouseScroll',
          handler: function (e) {
            o.mousewheel(e)
          }
        },
        {
          obj: o.domElement,
          type: 'mouseout',
          handler: function (e) {
            o.mouseup(e)
          }
        },
        {
          obj: o.domElement,
          type: 'touchstart',
          handler: function (e) {
            o.touchstartend(e)
          }
        },
        {
          obj: o.domElement,
          type: 'touchend',
          handler: function (e) {
            o.touchstartend(e)
          }
        },
        {
          obj: o.domElement,
          type: 'touchmove',
          handler: function (e) {
            o.touchmove(e)
          }
        },
        {
          obj: o.getKeyBindObject(),
          type: 'keydown',
          handler: function (e) {
            o.keydownup(e)
          }
        },
        {
          obj: o.getKeyBindObject(),
          type: 'keyup',
          handler: function (e) {
            o.keydownup(e)
          }
        },
        {
          obj: window,
          type: 'resize',
          handler: function () {
            o.handleResize()
          }
        },
        {
          obj: window,
          type: 'blur',
          handler: function () {
            o.resetKeys()
          }
        },
        {
          obj: o.domElement,
          type: 'contextmenu',
          handler: function (e) {
            o.contextmenu(e)
          }
        }
      ])
    for (var s = 0; s < this._listeners.length; s++) {
      var a = this._listeners[s]
      a.obj.addEventListener(a.type, a.handler)
    }
    this.handleResize(), this.resetKeys(), this.update()
  }
  function Xh(e, t, r) {
    T.call(this)
    var n = this
    ;(this.gfxObj = e),
      (this.camera = t),
      (this.domElement = void 0 !== r ? r : document),
      (this.screen = { left: 0, top: 0, width: 0, height: 0 }),
      (this._lastMousePos = new ae.Vector2(0, 0)),
      (this._mouseTotalDist = 0),
      (this._lastClickBeginTime = -1e3),
      (this._lastClickPos = new ae.Vector2(0, 0)),
      (this._clickBeginTime = 0),
      (this._clock = new d()),
      this._clock.start(),
      (this._listeners = [
        {
          obj: n.domElement,
          type: 'mousedown',
          handler: function (e) {
            n.mousedown(e)
          }
        },
        {
          obj: n.domElement,
          type: 'mouseup',
          handler: function (e) {
            n.mouseup(e)
          }
        },
        {
          obj: n.domElement,
          type: 'mousemove',
          handler: function (e) {
            n.mousemove(e)
          }
        },
        {
          obj: n.domElement,
          type: 'touchstart',
          handler: function (e) {
            n.touchstart(e)
          }
        },
        {
          obj: n.domElement,
          type: 'touchend',
          handler: function (e) {
            n.touchend(e)
          }
        },
        {
          obj: window,
          type: 'resize',
          handler: function () {
            n.handleResize()
          }
        }
      ])
    for (var i = 0; i < this._listeners.length; i++) {
      var o = this._listeners[i]
      o.obj.addEventListener(o.type, o.handler)
    }
    this.handleResize()
  }
  ;(Wh.prototype._rotate =
    ((yh = new ae.Vector3()),
    (_h = new ae.Quaternion()),
    (vh = new ae.Vector3()),
    (gh = new ae.Matrix4()),
    function (e) {
      var t = 0 === this.pivot.x && 0 === this.pivot.y && 0 === this.pivot.z
      if (
        (gh.copy(this.object.matrix),
        t
          ? gh.multiply(Hh.makeRotationFromQuaternion(e))
          : (gh.multiply(
              Hh.makeTranslation(this.pivot.x, this.pivot.y, this.pivot.z)
            ),
            gh.multiply(Hh.makeRotationFromQuaternion(e)),
            gh.multiply(
              Hh.makeTranslation(-this.pivot.x, -this.pivot.y, -this.pivot.z)
            )),
        gh.decompose(yh, _h, vh),
        !t)
      )
        for (var r = 0; r < this.objects.length; ++r)
          this.objects[r].position.copy(yh)
      for (var n = 0; n < this.objects.length; ++n)
        this.objects[n].quaternion.copy(_h), this.objects[n].updateMatrix()
    })),
    (Wh.prototype.setObjects = function (e) {
      e = m((this.objects = e), 1)
      this.object = e[0]
    }),
    (Wh.prototype.rotate =
      ((xh = { axis: new ae.Vector3(), angle: 0 }),
      function (e, t, r, n) {
        this.mouse2rotation(xh, t, r, n),
          e.setFromAxisAngle(xh.axis, xh.angle),
          xh.angle && this._rotate(e),
          (this.lastRotation = xh)
      })),
    (Wh.prototype.translate =
      ((bh = new ae.Vector3()),
      (wh = new ae.Vector3()),
      function (e) {
        bh.set(
          e.x / this.camera.projectionMatrix.elements[0],
          e.y / this.camera.projectionMatrix.elements[5],
          0
        )
        var t = bh.length()
        bh.normalize(),
          bh.transformDirection(Hh.copy(this.object.matrixWorld).invert()),
          wh.copy(this.pivot),
          this.object.localToWorld(wh),
          (t *= Math.abs(wh.z - this.camera.position.z)),
          (t /= this.object.matrixWorld.getMaxScaleOnAxis())
        for (var r = 0; r < this.objects.length; ++r)
          this.objects[r].translateOnAxis(bh, t)
      })),
    (Wh.prototype.update =
      ((Sh = new ae.Vector3()),
      function (e, t) {
        if (0 !== Q.now.autoRotation)
          return (
            Q.now.autoRotationAxisFixed || 0 === this.lastRotation.axis.length()
              ? Sh.set(0, 1, 0).transformDirection(
                  Hh.copy(this.object.matrixWorld).invert()
                )
              : Sh.copy(this.lastRotation.axis),
            this._rotate(jh.setFromAxisAngle(Sh, Q.now.autoRotation * e)),
            !0
          )
        if (this.options.intertia && this.lastRotation.angle) {
          t =
            this.lastRotation.angle *
            Math.pow(1 - this.options.dynamicDampingFactor, 40 * t)
          if (!(Math.abs(t) <= this.options.intertiaThreshold))
            return (
              this._rotate(jh.setFromAxisAngle(this.lastRotation.axis, t)), !0
            )
          this.lastRotation.angle = 0
        }
        return !1
      })),
    (Wh.prototype.stop = function () {
      this.lastRotation.angle = 0
    }),
    (Wh.prototype.mouse2rotation =
      ((Rh = new ae.Vector3()),
      (Ch = new ae.Vector3()),
      (Ah = new ae.Vector3()),
      (Eh = new ae.Vector3()),
      (kh = new ae.Vector3()),
      (Th = new ae.Vector3()),
      (Ph = new ae.Vector2()),
      function (e, t, r, n) {
        if (n)
          e.axis.copy(this.axis),
            (e.angle = this.options.axisRotateFactor * (r.y - t.y))
        else {
          Ph.subVectors(r, t)
          t = Ph.length()
          if (0 === t) return
          Rh.copy(this.pivot),
            this.object.localToWorld(Rh),
            Ch.subVectors(this.camera.position, Rh),
            Ah.copy(Ch).normalize(),
            Eh.copy(this.camera.up).normalize(),
            kh.crossVectors(Eh, Ah).normalize(),
            Eh.setLength(Ph.y),
            kh.setLength(Ph.x),
            Th.copy(Eh.add(kh)),
            e.axis.crossVectors(Th, Ch),
            (e.angle = -t * this.options.rotateFactor)
        }
        e.axis.transformDirection(Hh.copy(this.object.matrixWorld).invert()),
          e.angle < 0 && (e.axis.negate(), (e.angle = -e.angle))
      })),
    (((Yh.prototype = Object.create(T.prototype)).constructor =
      Yh).prototype.resetKeys = function () {
      ;(this._pressedKeys[37] = !1),
        (this._pressedKeys[38] = !1),
        (this._pressedKeys[39] = !1),
        (this._pressedKeys[40] = !1)
    }),
    (Yh.prototype.contextmenu = function (e) {
      e.stopPropagation(), e.preventDefault()
    }),
    (Yh.prototype.handleResize = function () {
      var e, t
      this.domElement === document
        ? ((this.screen.left = 0),
          (this.screen.top = 0),
          (this.screen.width = window.innerWidth),
          (this.screen.height = window.innerHeight))
        : ((e = this.domElement.getBoundingClientRect()),
          (t = this.domElement.ownerDocument.documentElement),
          (this.screen.left = e.left + window.pageXOffset - t.clientLeft),
          (this.screen.top = e.top + window.pageYOffset - t.clientTop),
          (this.screen.width = e.width),
          (this.screen.height = e.height))
    }),
    (Yh.prototype.enable = function (e) {
      this.enabled = e
    }),
    (Yh.prototype.enableHotkeys = function (e) {
      this.hotkeysEnabled = e
    }),
    (Yh.prototype.allowTranslation = function (e) {
      this._isTranslationAllowed = e
    }),
    (Yh.prototype.allowAltObjFreeRotation = function (e) {
      this._isAltObjFreeRotationAllowed = e
    }),
    (Yh.prototype.keysTranslateObj = function (e) {
      this._isKeysTranslatingObj = e
    }),
    (Yh.prototype.isEditingAltObj = function () {
      return (
        (this._state === zh || this._state === Fh) &&
        this._affectedObj === this._altObj
      )
    }),
    (Yh.prototype.convertMouseToOnCircle = function (e, t, r) {
      var n = Math.min(this.screen.width, this.screen.height)
      0 !== n
        ? e.set(
            (t - 0.5 * this.screen.width - this.screen.left) / n,
            (0.5 * this.screen.height + this.screen.top - r) / n
          )
        : e.set(0, 0)
    }),
    (Yh.prototype.convertMouseToViewport = function (e, t, r) {
      0 !== this.screen.width && 0 !== this.screen.height
        ? e.set(
            (2 * (t - 0.5 * this.screen.width - this.screen.left)) /
              this.screen.width,
            (2 * (0.5 * this.screen.height + this.screen.top - r)) /
              this.screen.height
          )
        : e.set(0, 0)
    }),
    (Yh.prototype.stop = function () {
      this._mainObj.stop(), this._altObj.stop()
    }),
    (Yh.prototype.rotateByMouse =
      ((Mh = new ae.Quaternion()),
      function (e) {
        this._affectedObj.rotate(Mh, this._mousePrevPos, this._mouseCurPos, e),
          this.dispatchEvent({
            type: 'change',
            action: 'rotate',
            quaternion: Mh
          })
      })),
    (Yh.prototype.rotate = function (e) {
      this.object.quaternion.multiply(e),
        this.dispatchEvent({ type: 'change', action: 'rotate', quaternion: e })
    }),
    (Yh.prototype.getOrientation = function () {
      return this.object.quaternion
    }),
    (Yh.prototype.setOrientation = function (e) {
      this.object.quaternion.copy(e)
    }),
    (Yh.prototype.translate =
      ((Nh = new ae.Vector2()),
      function () {
        Nh.subVectors(this._mouseCurPos, this._mousePrevPos),
          this._affectedObj.translate(Nh),
          this.dispatchEvent({ type: 'change', action: 'translate' })
      })),
    (Yh.prototype.getScale = function () {
      return this.object.scale.x
    }),
    (Yh.prototype.setScale = function (e) {
      this.object.scale.set(e, e, e)
    }),
    (Yh.prototype.scale = function (e) {
      e <= 0 ||
        (this.setScale(this.object.scale.x * e),
        this.dispatchEvent({ type: 'change', action: 'zoom', factor: e }))
    }),
    (Yh.prototype.update =
      ((Lh = new ae.Vector2()),
      function () {
        var e,
          t,
          r,
          n = this._clock.getElapsedTime(),
          i = n - this._lastUpdateTime
        this._state === Dh &&
          ((r = n - this._lastMouseMoveTime),
          (this._mainObj.update(i, r) || this._altObj.update(i, r)) &&
            this.dispatchEvent({ type: 'change', action: 'auto' })),
          this._isKeysTranslatingObj &&
            ((e =
              Number(this._pressedKeys[39]) - Number(this._pressedKeys[37])),
            (t = Number(this._pressedKeys[38]) - Number(this._pressedKeys[40])),
            (0 == e && 0 == t) ||
              ((r = i),
              0 < (i = this.getAltObj()).objects.length &&
                (this._altObj.setObjects(i.objects),
                (this._altObj.pivot = i.pivot),
                'axis' in i
                  ? (this._altObj.axis = i.axis.clone())
                  : this._altObj.axis.set(0, 0, 1),
                Lh.set(r * e, r * t),
                this._altObj.translate(Lh),
                this.dispatchEvent({ type: 'change', action: 'translate' })))),
          (this._lastUpdateTime = n)
      })),
    (Yh.prototype.reset = function () {
      ;(this._state = Dh), this.object.quaternion.copy(jh.set(0, 0, 0, 1))
    }),
    (Yh.prototype.mousedown = function (e) {
      var t, r
      !1 !== this.enabled &&
        this._state === Dh &&
        (e.preventDefault(),
        e.stopPropagation(),
        this._state === Dh &&
          (0 === e.button
            ? (this._affectedObj.stop(),
              (r = !1),
              !e.altKey ||
                ((r = 0 < (t = this.getAltObj()).objects.length) &&
                  (this._altObj.setObjects(t.objects),
                  (this._altObj.pivot = t.pivot),
                  'axis' in t
                    ? (this._altObj.axis = t.axis.clone())
                    : this._altObj.axis.set(0, 0, 1))),
              (this._affectedObj = r ? this._altObj : this._mainObj),
              (this._state =
                r && e.ctrlKey && this._isTranslationAllowed ? Fh : zh))
            : 2 === e.button && (this._state = Gh)),
        this._state === zh &&
          (this.convertMouseToOnCircle(this._mouseCurPos, e.pageX, e.pageY),
          this._mousePrevPos.copy(this._mouseCurPos)),
        (this._state !== Fh && this._state !== Gh) ||
          (this.convertMouseToViewport(this._mouseCurPos, e.pageX, e.pageY),
          this._mousePrevPos.copy(this._mouseCurPos)))
    }),
    (Yh.prototype.mousemove = function (e) {
      if (!1 !== this.enabled && this._state !== Dh)
        switch ((e.preventDefault(), e.stopPropagation(), this._state)) {
          case zh:
            this._mousePrevPos.copy(this._mouseCurPos),
              this.convertMouseToOnCircle(this._mouseCurPos, e.pageX, e.pageY),
              this.rotateByMouse(
                (e.altKey && !this._isAltObjFreeRotationAllowed) || e.shiftKey
              ),
              (this._lastMouseMoveTime = this._clock.getElapsedTime())
            break
          case Fh:
            this._mousePrevPos.copy(this._mouseCurPos),
              this.convertMouseToViewport(this._mouseCurPos, e.pageX, e.pageY),
              this.translate()
            break
          case Gh:
            this._mousePrevPos.copy(this._mouseCurPos),
              this.convertMouseToViewport(this._mouseCurPos, e.pageX, e.pageY),
              this.translatePivotByMouse()
        }
    }),
    (Yh.prototype.mousewheel = function (e) {
      var t
      !1 !== this.enabled &&
        Q.now.zooming &&
        this._state === Dh &&
        !e.shiftKey &&
        (e.preventDefault(),
        (t = 0),
        e.wheelDelta
          ? (t = e.wheelDelta / 40)
          : e.detail && (t = -e.detail / 3),
        (t = 1 + 0.05 * t),
        (t = Math.max(t, 0.01)),
        this.scale(t))
    }),
    (Yh.prototype.mouseup = function (e) {
      !1 !== this.enabled &&
        this._state !== Dh &&
        (e.preventDefault(),
        e.stopPropagation(),
        (this._state = Dh),
        0.1 < this._clock.getElapsedTime() - this._lastMouseMoveTime &&
          this._affectedObj.stop())
    }),
    (Yh.prototype.touchstartend = function (e) {
      if (!1 !== this.enabled)
        switch ((e.preventDefault(), e.stopPropagation(), e.touches.length)) {
          case 1:
            ;(this._state = zh),
              this.convertMouseToOnCircle(
                this._mouseCurPos,
                e.touches[0].pageX,
                e.touches[0].pageY
              ),
              this._mousePrevPos.copy(this._mouseCurPos)
            break
          case 2:
            this._mainObj.stop(), this._altObj.stop(), (this._state = Uh)
            var t = e.touches[0].pageX - e.touches[1].pageX,
              r = e.touches[0].pageY - e.touches[1].pageY
            ;(this._touchDistanceCur = this._touchDistanceStart =
              Math.sqrt(t * t + r * r)),
              (this._scaleStart = this.object.scale.x)
            break
          default:
            this._state = Dh
        }
    }),
    (Yh.prototype.touchmove = function (e) {
      if (!1 !== this.enabled && this._state !== Dh)
        switch ((e.preventDefault(), e.stopPropagation(), this._state)) {
          case zh:
            this._mousePrevPos.copy(this._mouseCurPos),
              this.convertMouseToOnCircle(
                this._mouseCurPos,
                e.touches[0].pageX,
                e.touches[0].pageY
              ),
              this.rotateByMouse(!1),
              (this._lastMouseMoveTime = this._clock.getElapsedTime())
            break
          case Uh:
            var t, r
            Q.now.zooming &&
              ((t = e.touches[0].pageX - e.touches[1].pageX),
              (r = e.touches[0].pageY - e.touches[1].pageY),
              (this._touchDistanceCur = Math.sqrt(t * t + r * r)),
              (r =
                (this._scaleStart * this._touchDistanceCur) /
                this._touchDistanceStart /
                this.object.scale.x),
              this.scale(r))
        }
    }),
    (Yh.prototype.keydownup = function (e) {
      if (!1 !== this.enabled && !1 !== this.hotkeysEnabled)
        switch (e.keyCode) {
          case 37:
          case 38:
          case 39:
          case 40:
            ;(this._pressedKeys[e.keyCode] = 'keydown' === e.type),
              e.preventDefault(),
              e.stopPropagation()
        }
    }),
    (Yh.prototype.getKeyBindObject = function () {
      return window.top
    }),
    (Yh.prototype.dispose = function () {
      for (var e = 0; e < this._listeners.length; e++) {
        var t = this._listeners[e]
        t.obj.removeEventListener(t.type, t.handler)
      }
    }),
    (Yh.prototype.translatePivotByMouse =
      ((Ih = new ae.Vector2()),
      function () {
        Ih.subVectors(this._mouseCurPos, this._mousePrevPos),
          this.translatePivotInWorld(
            Q.now.translationSpeed * Ih.x,
            Q.now.translationSpeed * Ih.y,
            0
          )
      })),
    (Yh.prototype.translatePivotInWorld = function (e, t, r) {
      var n = this.objectPivot.position
      n.applyMatrix4(this.object.matrixWorld),
        n.setX(n.x + e),
        n.setY(n.y + t),
        n.setZ(n.z + r),
        n.applyMatrix4(Hh.copy(this.object.matrixWorld).invert()),
        this.dispatchEvent({ type: 'change', action: 'translatePivot' })
    }),
    (Yh.prototype.translatePivot = function (e, t, r) {
      var n = this.objectPivot.position
      n.setX(n.x + e),
        n.setY(n.y + t),
        n.setZ(n.z + r),
        this.dispatchEvent({ type: 'change', action: 'translatePivot' })
    }),
    (Yh.prototype.setPivot = function (e) {
      this.objectPivot.position.copy(e),
        this.dispatchEvent({ type: 'change', action: 'translatePivot' })
    }),
    (((Xh.prototype = Object.create(T.prototype)).constructor =
      Xh).prototype.reset = function () {
      ;(this.picked = {}), this.dispatchEvent({ type: 'newpick', obj: {} })
    }),
    (Xh.prototype.handleResize = function () {
      var e, t
      this.domElement === document
        ? ((this.screen.left = 0),
          (this.screen.top = 0),
          (this.screen.width = window.innerWidth),
          (this.screen.height = window.innerHeight))
        : ((e = this.domElement.getBoundingClientRect()),
          (t = this.domElement.ownerDocument.documentElement),
          (this.screen.left = e.left + window.pageXOffset - t.clientLeft),
          (this.screen.top = e.top + window.pageYOffset - t.clientTop),
          (this.screen.width = e.width),
          (this.screen.height = e.height))
    }),
    (Xh.prototype.pickObject = function (e) {
      if (!this.gfxObj)
        return (
          (this.picked = {}),
          void this.dispatchEvent({ type: 'newpick', obj: {} })
        )
      var t = this.gfxObj,
        r = new ae.Raycaster()
      r.ray.origin.setFromMatrixPosition(this.camera.matrixWorld),
        r.ray.direction
          .set(e.x, e.y, 0.5)
          .unproject(this.camera)
          .sub(r.ray.origin)
          .normalize()
      var n =
          Q.now.draft.clipPlane && this.clipPlaneValue
            ? this.clipPlaneValue
            : 1 / 0,
        e = Q.now.fog && this.fogFarValue ? this.fogFarValue : 1 / 0,
        t = r.intersectVisibleObject(t, this.camera, n, e)
      if (!t)
        return (
          (this.picked = {}),
          void this.dispatchEvent({ type: 'newpick', obj: {} })
        )
      n = {}
      ;(t.residue || t.atom) &&
        ((e = t.residue || t.atom.residue),
        'chain' === Q.now.pick
          ? (n = { chain: e.getChain() })
          : 'molecule' === Q.now.pick
          ? (n = { molecule: e.getMolecule() })
          : t.residue || 'residue' === Q.now.pick
          ? (n = { residue: e })
          : t.atom && (n = { atom: t.atom })),
        (this.picked = n),
        this.dispatchEvent({ type: 'newpick', obj: n })
    }),
    (Xh.prototype.getMouseInViewport = function (e, t) {
      return new ae.Vector2(
        ((e - this.screen.left) / this.screen.width) * 2 - 1,
        (-(t - this.screen.top) / this.screen.height) * 2 + 1
      )
    }),
    (Xh.prototype.mousedown = function (e) {
      e.preventDefault(),
        e.stopPropagation(),
        0 === e.button &&
          ((this._lastMousePos = this.getMouseInViewport(e.pageX, e.pageY)),
          (this._mouseTotalDist = 0),
          (this._clickBeginTime = this._clock.getElapsedTime()))
    }),
    (Xh.prototype.mousemove = function (e) {
      e.preventDefault(), e.stopPropagation()
      e = this.getMouseInViewport(e.pageX, e.pageY)
      this._mouseTotalDist += e.sub(this._lastMousePos).length()
    }),
    (Xh.prototype.mouseup = function (e) {
      var t = this
      if (
        (e.preventDefault(),
        e.stopPropagation(),
        0 === e.button && this._mouseTotalDist < 0.01)
      ) {
        var r = this._clock.getElapsedTime(),
          n = this.getMouseInViewport(e.pageX, e.pageY),
          r = r - this._lastClickBeginTime
        if (r < 0.7)
          if (
            new ae.Vector2().subVectors(n, this._lastClickPos).length() < 0.01
          )
            return (
              this.dispatchEvent({ type: 'dblclick', obj: this.picked }),
              (this._lastClickPos = n),
              void (this._lastClickBeginTime = -1e3)
            )
        setTimeout(function () {
          t.pickObject(n)
        }, 0),
          (this._lastClickPos = n),
          (this._lastClickBeginTime = this._clickBeginTime)
      }
    }),
    (Xh.prototype.touchstart = function (e) {
      e.preventDefault(),
        e.stopPropagation(),
        1 === e.touches.length &&
          (this._lastTouchdownPos = this.getMouseInViewport(
            e.touches[0].pageX,
            e.touches[0].pageY
          ))
    }),
    (Xh.prototype.touchend = function (e) {
      var t = this
      e.preventDefault(),
        e.stopPropagation(),
        0 === e.touches.length &&
          1 === e.changedTouches.length &&
          this.getMouseInViewport(
            e.changedTouches[0].pageX,
            e.changedTouches[0].pageY
          )
            .sub(this._lastTouchdownPos)
            .length() < 0.01 &&
          setTimeout(function () {
            t.pickObject(t._lastTouchdownPos)
          }, 0)
    }),
    (Xh.prototype.dispose = function () {
      for (var e = 0; e < this._listeners.length; e++) {
        var t = this._listeners[e]
        t.obj.removeEventListener(t.type, t.handler)
      }
    })
  var qh = (function () {
      function r(e, t) {
        G(this, r),
          (this._target = e),
          (this._targetCamera = t),
          (this._camera = new ae.PerspectiveCamera(t.fov, t.aspect, 1, 100)),
          (this._object = new ae.AxesHelper(1)),
          (this._scene = new ae.Scene()),
          this._scene.add(this._object),
          (this._full = new ae.Vector2()),
          this._update()
      }
      return (
        p(r, [
          {
            key: '_update',
            value: function () {
              var e = this._targetCamera.fov,
                t = this._camera
              ;(t.aspect = this._targetCamera.aspect),
                t.setMinimalFov(e),
                t.setDistanceToFit(1, e),
                t.updateProjectionMatrix(),
                this._object.quaternion.copy(this._target.quaternion)
            }
          },
          {
            key: 'render',
            value: function (e) {
              this._update(), e.getSize(this._full)
              var t = 0.25 * this._full.width,
                r = 0.25 * this._full.height,
                n = e.autoClear
              ;(e.autoClear = !1),
                e.setViewport(0, 0, t, r),
                e.clear(!1, !0, !1),
                e.render(this._scene, this._camera),
                e.setViewport(0, 0, this._full.width, this._full.height),
                (e.autoClear = n)
            }
          }
        ]),
        r
      )
    })(),
    $h = ['helix', 'strand'],
    Zh = ['fs', 'ps', 'ns', 'us']
  function Kh(e) {
    return 1 << 19 <= e ? e - (1 << 20) : e
  }
  var Qh = (function () {
    function n(e, t, r) {
      G(this, n),
        (this._complex = e),
        (this._secondary = null),
        (this.isLoading = !1),
        (this._framesRange = { start: 0, end: -1 }),
        (this.frameIsReady = !1),
        (this._buffer = null),
        (this._frameRequest = null),
        (this._callbacks = r),
        'function' == typeof t
          ? ((this._framesRequestLength = 1), (this._downloadDataFn = t))
          : this.parseBinaryData(t, !0),
        this.reset(),
        this.setFrame(0)
    }
    return (
      p(n, [
        {
          key: '_prepareBuffer',
          value: function (t, r) {
            var n
            null == t && (t = 0),
              null == r && (r = t + this._framesRequestLength),
              void 0 !== this._framesCount &&
                (r = Math.min(this._framesCount - 1, r)),
              this._downloadDataFn &&
                ((n = this)._buffer || (this._buffer = {}),
                (this._buffer.state = 'downloading'),
                (this.isLoading = !0),
                n._callbacks &&
                  'function' == typeof n._callbacks.onLoadStatusChanged &&
                  n._callbacks.onLoadStatusChanged(),
                this._downloadDataFn(
                  { start: t, end: r + 1 },
                  function (e) {
                    ;(n.isLoading = !1),
                      n._callbacks &&
                        'function' == typeof n._callbacks.onLoadStatusChanged &&
                        n._callbacks.onLoadStatusChanged(),
                      (n._buffer = {
                        data: e,
                        state: 'ready',
                        start: t,
                        end: r
                      }),
                      null !== n._frameRequest &&
                        ((e = n._frameRequest),
                        (n._frameRequest = null),
                        n.setFrame(e))
                  },
                  function () {
                    ;(n.isLoading = !1),
                      n._callbacks &&
                        'function' == typeof n._callbacks.onError &&
                        n._callbacks.onError('Streaming failed')
                  }
                ))
          }
        },
        {
          key: '_parseBuffer',
          value: function () {
            var e
            this._buffer &&
              'ready' === this._buffer.state &&
              ((this._framesRange = {
                start: this._buffer.start,
                end: this._buffer.end
              }),
              this.parseBinaryData(this._buffer.data, !1),
              (e = (this._buffer.end + 1) % this._framesCount) >=
                this._framesCount && (e = 0),
              (this._buffer = { state: 'none' }),
              this._prepareBuffer(e, e + this._framesRequestLength),
              null !== this._frameRequest &&
                ((e = this._frameRequest),
                (this._frameRequest = null),
                this.setFrame(e)))
          }
        },
        {
          key: 'parseBinaryData',
          value: function (e) {
            var t = new DataView(e),
              r = 0,
              n = t.getUint32(r, !0),
              i = t.getUint32((r += 4), !0)
            ;(this._framesCount = i),
              (this._framesRange.end =
                0 < this._framesRange.end
                  ? Math.min(this._framesRange.end, i - 1)
                  : i - 1),
              (r += 4),
              (this._atomsCount = n)
            this._framesRequestLength = Math.ceil(1048576 / (8 * n))
            var o = this._framesRange.end - this._framesRange.start + 1
            if (
              n !== this._complex._atoms.length ||
              e.byteLength !== 12 + o * n * 8
            )
              throw new Error()
            for (
              var s = this._complex, a = t.getUint32(r, !0), l = 0;
              1e3 < a && l < Zh.length - 1;

            )
              (a /= 1e3), ++l
            ;(this._timeStep = ''.concat(a.toString(), ' ').concat(Zh[l])),
              (r += 4)
            for (
              var c = [],
                u = new Float32Array(o * n * 3),
                h = 0,
                f = new Int8Array(n),
                d = 0;
              d < o;
              ++d
            ) {
              for (var p = 0; p < n; ++p) {
                var m = t.getUint32(r, !0)
                r += 4
                var y = t.getUint32(r, !0)
                r += 4
                var _ = (4026531840 & y) >>> 28,
                  v = Kh(((268435200 & y) >>> 8) >> 0),
                  y = Kh((((255 & y) << 12) | ((4293918720 & m) >>> 20)) >> 0),
                  m = Kh((1048575 & m) >> 0)
                ;(f[p] = 0) < _ && _ < 4 ? (f[p] = 1) : 4 == _ && (f[p] = 2),
                  (u[h++] = v / 100),
                  (u[h++] = y / 100),
                  (u[h++] = m / 100)
              }
              c.push(
                (function (e, t) {
                  for (
                    var r = t._residues,
                      n = r.length,
                      i = new Uint8Array(n),
                      o = t._atoms,
                      s = 0,
                      a = e.length;
                    s < a;
                    ++s
                  )
                    i[o[s].residue._index] = e[s]
                  for (var l = [], c = 0; c < n; ) {
                    if (0 !== i[c]) {
                      for (
                        var u = c, h = i[c];
                        c < n - 1 &&
                        i[c + 1] === h &&
                        r[c].isConnected(r[c + 1]);

                      )
                        ++c
                      l.push({ start: u, end: c, type: $h[h - 1] })
                    }
                    ++c
                  }
                  return l
                })(f, s)
              )
            }
            ;(this._secondaryData = c), (this._data = u)
          }
        },
        {
          key: 'nextFrame',
          value: function () {
            this.setFrame((this._currFrame + 1) % this._framesCount)
          }
        },
        {
          key: 'needsColorUpdate',
          value: function (e) {
            return e instanceof ya
          }
        },
        {
          key: 'getAtomColor',
          value: function (e, t) {
            return e.getResidueColor(
              this._residues[t.residue._index],
              this._complex
            )
          }
        },
        {
          key: 'getResidueColor',
          value: function (e, t) {
            return e.getResidueColor(this._residues[t._index], this._complex)
          }
        },
        {
          key: '_updateSecondary',
          value: function () {
            for (var e = this._residues, t = e.length, r = 0; r < t; ++r)
              e[r]._secondary = null
            var n =
              this._secondaryData[this._currFrame - this._framesRange.start]
            for (r = 0, t = n.length; r < t; ++r)
              for (
                var i = n[r],
                  o = i.start,
                  s = i.end,
                  a = {
                    _start: e[o],
                    _end: e[s],
                    type: i.type,
                    generic: i.generic
                  },
                  l = o;
                l <= s;
                ++l
              )
                e[l]._secondary = a
          }
        },
        {
          key: 'reset',
          value: function () {
            var e = this._complex._residues,
              t = e.length
            this._residues = new Array(t)
            for (
              var r = this._residues,
                n = function () {
                  return this._secondary
                },
                i = 0;
              i < t;
              ++i
            )
              r[i] = {
                _type: e[i]._type,
                _isValid: e[i]._isValid,
                _controlPoint: null,
                _wingVector: null,
                _secondary: null,
                getSecondary: n
              }
          }
        },
        {
          key: 'setFrame',
          value: function (e) {
            if (
              ((this.frameIsReady = !1),
              e >= this._framesRange.start && e <= this._framesRange.end)
            )
              (this._currFrame = e),
                (this._cachedResidues = !1),
                this._updateSecondary(),
                (this.frameIsReady = !0)
            else if (((this._frameRequest = e), this._buffer))
              switch (this._buffer.state) {
                case 'none':
                  this._prepareBuffer(e)
                  break
                case 'ready':
                  this._parseBuffer()
              }
            else this._prepareBuffer(e)
          }
        },
        {
          key: 'disableEvents',
          value: function () {
            this._callbacks = null
          }
        },
        {
          key: 'getAtomPos',
          value: function (e) {
            var t = n._vec,
              r = this._data,
              e =
                3 *
                (this._atomsCount *
                  (this._currFrame - this._framesRange.start) +
                  e)
            return t.set(r[e], r[1 + e], r[2 + e]), t
          }
        },
        {
          key: 'getResidues',
          value: function () {
            return (
              this._cachedResidues || this._complex.updateToFrame(this),
              this._residues
            )
          }
        }
      ]),
      n
    )
  })()
  be(Qh, '_vec', new ae.Vector3())
  var Jh = (function () {
    function r(e, t) {
      if ((G(this, r), this.constructor === r))
        throw new Error('Can not instantiate abstract class!')
      ;(this.params = e),
        (this.opts = b.default.merge(
          le.deriveDeep(Q.now.objects[this.type], !0),
          t
        )),
        (this.needsRebuild = !1),
        (this._mesh = null),
        (this.id = null)
    }
    return (
      p(r, [
        {
          key: 'identify',
          value: function () {
            var e = { type: this.type, params: this.params },
              t = le.objectsDiff(this.opts, Q.now.modes[this.id])
            return b.default.isEmpty(t) || (e.opts = t), e
          }
        },
        {
          key: 'toString',
          value: function () {
            return (
              'o='.concat(this.type, ',').concat(this.params.join(',')) +
              le.compareOptionsWithDefaults(
                this.opts,
                Q.defaults.objects[this.type]
              )
            )
          }
        },
        {
          key: 'getGeometry',
          value: function () {
            return this._mesh
          }
        },
        {
          key: 'destroy',
          value: function () {
            this._mesh && kr.destroyObject(this._mesh)
          }
        }
      ]),
      r
    )
  })()
  function ef(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Jh.prototype.type = '__'
  var tf = (function () {
    x(n, Jh)
    var r = ef(n)
    function n(e, t) {
      if ((G(this, n), (t = r.call(this, e, t)), e.length < 2))
        throw new Error('Wrong number of argumets on line object creation!')
      e = m(e, 2)
      return (t._id1 = e[0]), (t._id2 = e[1]), t
    }
    return (
      p(n, [
        {
          key: '_getAtomFromName',
          value: function (e, t) {
            e = e.getAtomByFullname(t)
            if (!e)
              throw new Error(
                t +
                  " - Wrong atom format it must be '#CHAIN_NAME.#RESIDUE_NUMBER.#ATOM_NAME' (e.g. 'A.38.CO1')"
              )
            return e
          }
        },
        {
          key: 'build',
          value: function (e) {
            var t = new ae.BufferGeometry()
            ;(this._atom1 = this._getAtomFromName(e, this._id1)),
              (this._atom2 = this._getAtomFromName(e, this._id2))
            var r = this._atom1.position,
              n = this._atom2.position,
              n = new Float32Array([r.x, r.y, r.z, n.x, n.y, n.z])
            t.setAttribute('position', new ae.BufferAttribute(n, 3)),
              t.computeBoundingBox()
            n = new Ni()
            n.setValues({
              lights: !1,
              overrideColor: !0,
              dashedLine: !0,
              fogTransparent: Q.now.bg.transparent
            }),
              (this._line = new Ji.Line(t, n)),
              this._line.computeLineDistances(),
              this._line.material.setUberOptions({
                fixedColor: new ae.Color(this.opts.color),
                dashedLineSize: this.opts.dashSize,
                dashedLinePeriod: this.opts.dashSize + this.opts.gapSize
              }),
              this._line.material.updateUniforms(),
              (this._line.raycast = function (e, t) {}),
              (this._mesh = this._line)
            e = e.getTransforms()
            0 < e.length &&
              ((this._mesh = new ae.Group()),
              this._mesh.add(this._line),
              Fa.applyTransformsToMeshes(this._mesh, e))
          }
        },
        {
          key: 'updateToFrame',
          value: function (e) {
            var t
            this._atom1 &&
              this._atom2 &&
              this._line &&
              ((t = this._line.geometry).vertices[0].copy(
                e.getAtomPos(this._atom1.index)
              ),
              t.vertices[1].copy(e.getAtomPos(this._atom2.index)),
              this._line.computeLineDistances(),
              t.computeBoundingSphere(),
              (t.verticesNeedUpdate = !0))
          }
        }
      ]),
      n
    )
  })()
  ;(tf.prototype.constructor = tf).prototype.type = 'line'
  function rf(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  No = (function () {
    x(n, ae.RawShaderMaterial)
    var r = rf(n)
    function n(e) {
      G(this, n)
      var t = r.call(this, e),
        e = {
          uniforms: {
            srcTex: { type: 't', value: null },
            srcDepthTex: { type: 't', value: null },
            srcTexSize: { type: 'v2', value: new ae.Vector2(512, 512) },
            color: { type: 'v3', value: null },
            threshold: { type: 'f', value: null },
            opacity: { type: 'f', value: 1 },
            thickness: { type: 'v2', value: new ae.Vector2(1, 1) }
          },
          vertexShader: yr,
          fragmentShader:
            'precision highp float;\r\n\r\nuniform sampler2D srcTex;\r\nuniform vec2 srcTexSize;\r\nuniform vec2 thickness;\r\nvarying vec2 vUv;\r\n\r\n#ifdef DEPTH_OUTLINE\r\n  uniform sampler2D srcDepthTex; //depthTexture\r\n  uniform vec3 color;\r\n  uniform float threshold;\r\n#endif\r\n\r\nvoid main() {\r\n\r\n  vec2 pixelSize = thickness / srcTexSize;\r\n\r\n  #ifdef DEPTH_OUTLINE\r\n    float c00 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,-pixelSize.y)).x;\r\n    float c01 = texture2D(srcDepthTex, vUv + vec2(0,-pixelSize.y)).x;\r\n    float c02 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,-pixelSize.y)).x;\r\n    float c10 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,0)).x;\r\n    float c12 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,0)).x;\r\n    float c20 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,pixelSize.y)).x;\r\n    float c21 = texture2D(srcDepthTex, vUv + vec2(0,pixelSize.y)).x;\r\n    float c22 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,pixelSize.y)).x;\r\n\r\n    float horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r\n    float vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r\n\r\n    float grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r\n\r\n    gl_FragColor = ( grad > threshold ) ? vec4(color.rgb, 1.0) : gl_FragColor = texture2D(srcTex, vUv);\r\n\r\n  #else\r\n    vec4 c00 = texture2D(srcTex, vUv + vec2(-pixelSize.x,-pixelSize.y));\r\n    vec4 c01 = texture2D(srcTex, vUv + vec2(0,-pixelSize.y));\r\n    vec4 c02 = texture2D(srcTex, vUv + vec2(pixelSize.x,-pixelSize.y));\r\n    vec4 c10 = texture2D(srcTex, vUv + vec2(-pixelSize.x,0));\r\n    vec4 c12 = texture2D(srcTex, vUv + vec2(pixelSize.x,0));\r\n    vec4 c20 = texture2D(srcTex, vUv + vec2(-pixelSize.x,pixelSize.y));\r\n    vec4 c21 = texture2D(srcTex, vUv + vec2(0,pixelSize.y));\r\n    vec4 c22 = texture2D(srcTex, vUv + vec2(pixelSize.x,pixelSize.y));\r\n\r\n    vec4 horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r\n    vec4 vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r\n\r\n    vec4 grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r\n    gl_FragColor = grad;\r\n  #endif\r\n}\r\n',
          transparent: !0,
          depthTest: !1,
          depthWrite: !1
        }
      return t.setValues(e), t
    }
    return (
      p(n, [
        {
          key: 'copy',
          value: function (e) {
            Xe(C(n.prototype), 'copy', this).call(this, e),
              (this.depth = e.depth)
          }
        },
        {
          key: 'setValues',
          value: function (e) {
            void 0 !== e &&
              (Xe(C(n.prototype), 'setValues', this).call(this, e),
              (e = {}),
              this.depth && (e.DEPTH_OUTLINE = 1),
              (this.defines = e))
          }
        }
      ]),
      n
    )
  })()
  No.prototype.depth = !1
  function nf(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  Do = (function () {
    x(n, ae.RawShaderMaterial)
    var r = nf(n)
    function n(e) {
      var t
      return (
        G(this, n),
        (t = r.call(this, e)).setValues({
          uniforms: {
            srcTex: { type: 't', value: null },
            srcTexelSize: {
              type: 'v2',
              value: new ae.Vector2(1 / 512, 1 / 512)
            },
            bgColor: { type: 'c', value: new ae.Color(16777215) }
          },
          vertexShader: yr,
          fragmentShader:
            "precision highp float;\r\n\r\n// edge end finding algorithm parameters\r\n#define FXAA_QUALITY_PS 8\r\n#define FXAA_QUALITY_P0 1.0\r\n#define FXAA_QUALITY_P1 1.5\r\n#define FXAA_QUALITY_P2 2.0\r\n#define FXAA_QUALITY_P3 2.0\r\n#define FXAA_QUALITY_P4 2.0\r\n#define FXAA_QUALITY_P5 2.0\r\n#define FXAA_QUALITY_P6 4.0\r\n#define FXAA_QUALITY_P7 12.0\r\n// constants\r\nfloat fxaaQualityEdgeThreshold = 0.125;\r\nfloat fxaaQualityEdgeThresholdMin = 0.0625;\r\nfloat fxaaQualitySubpix = 0.7; //0.65;\r\n// global params\r\nuniform sampler2D srcTex;\r\nuniform vec2 srcTexelSize;\r\nuniform vec3 bgColor;\r\n// from vs\r\nvarying vec2 vUv;\r\n//=====================================================================//\r\n// calc luminance from rgb\r\n//'float FxaaLuma(vec3 rgb) {return rgb.y * (0.587/0.299) + rgb.x; } // Lotte's idea about game luminance\r\nfloat FxaaLuma(vec3 rgb) {return dot(rgb, vec3(0.299, 0.587, 0.114)); } // real luminance calculation\r\n                                                                           // for non-real scene rendering\r\n// texture sampling by pixel position(coords) and offset(in pixels)\r\n vec3 FxaaTex(sampler2D tex, vec2 pos, vec2 off,  vec2 res ) {\r\n  #ifdef BG_TRANSPARENT\r\n    vec4 color = texture2D( tex, pos + off * res );\r\n    return mix(color.rgb, bgColor, 1.0 - color.a);\r\n  #else\r\n    return texture2D( tex, pos + off * res ).xyz;\r\n  #endif\r\n}\r\nvec3 FxaaTexTop(sampler2D tex, vec2 pos) {\r\n  #ifdef BG_TRANSPARENT\r\n    vec4 color = texture2D( tex, pos );\r\n    return mix(color.rgb, bgColor, 1.0 - color.a);\r\n  #else\r\n    return texture2D( tex, pos).xyz;\r\n  #endif\r\n}\r\nvec4 FxaaTexTopAlpha(sampler2D tex, vec2 pos) {\r\n  return texture2D( tex, pos);\r\n}\r\n\r\n//=====================================================================//\r\nvoid main() {\r\n  // renaming\r\n  vec2 posM = vUv;\r\n  // get luminance for neighbours\r\n  float lumaS = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, 1.0 ), srcTexelSize));\r\n  float lumaE = FxaaLuma(FxaaTex(srcTex, posM, vec2( 1.0, 0.0 ), srcTexelSize));\r\n  float lumaN = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, -1.0 ), srcTexelSize));\r\n  float lumaW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, 0.0 ), srcTexelSize));\r\n  float lumaM = FxaaLuma(FxaaTexTop(srcTex, posM));\r\n  // find max and min luminance\r\n  float rangeMax = max(max(lumaN, lumaW), max(lumaE, max(lumaS, lumaM)));\r\n  float rangeMin = min(min(lumaN, lumaW), min(lumaE, min(lumaS, lumaM)));\r\n  // calc maximum non-edge range\r\n  float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\r\n  float range = rangeMax - rangeMin;\r\n  float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\r\n  // exit when luma contrast is small (is not edge)\r\n  if(range < rangeMaxClamped){\r\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r\n    return;\r\n  }\r\n  float subpixRcpRange = 1.0/range;\r\n  // note: the sampling coordinates can be calculated in vertex shader but the approach doesn't affect performance\r\n  // visibly, thus we decided to leave calculation here for better readability.\r\n  // calc other neighbours luminance\r\n  float lumaNE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0, -1.0 ), srcTexelSize));\r\n  float lumaSW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0,  1.0 ), srcTexelSize));\r\n  float lumaSE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0,  1.0 ), srcTexelSize));\r\n  float lumaNW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, -1.0 ), srcTexelSize));\r\n/*--------------span calculation and subpix amount calulation-----------------*/\r\n  float lumaNS = lumaN + lumaS;\r\n  float lumaWE = lumaW + lumaE;\r\n  float subpixNSWE = lumaNS + lumaWE;\r\n  float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\r\n  float edgeVert1 = (-2.0 * lumaM) + lumaWE;\r\n/*--------------------------------------------------------------------------*/\r\n  float lumaNESE = lumaNE + lumaSE;\r\n  float lumaNWNE = lumaNW + lumaNE;\r\n  float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\r\n  float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\r\n/*--------------------------------------------------------------------------*/\r\n  float lumaNWSW = lumaNW + lumaSW;\r\n  float lumaSWSE = lumaSW + lumaSE;\r\n  float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\r\n  float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\r\n  float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\r\n  float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\r\n  float edgeHorz = abs(edgeHorz3) + edgeHorz4;\r\n  float edgeVert = abs(edgeVert3) + edgeVert4;\r\n/*--------------------subpix amount calulation------------------------------*/\r\n  float subpixNWSWNESE = lumaNWSW + lumaNESE;\r\n  float lengthSign = srcTexelSize.x;\r\n  bool horzSpan = edgeHorz >= edgeVert;\r\n   // debug  code edge span visualization\r\n/*'  if (horzSpan)\r\n      gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\r\n  else\r\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r\n  return;*/\r\n  float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\r\n/*--------------------------------------------------------------------------*/\r\n  if(!horzSpan) lumaN = lumaW;\r\n  if(!horzSpan) lumaS = lumaE;\r\n  if(horzSpan) lengthSign = srcTexelSize.y;\r\n  float subpixB = (subpixA * (1.0/12.0)) - lumaM;\r\n/*--------------------------------------------------------------------------*/\r\n  float gradientN = lumaN - lumaM;\r\n  float gradientS = lumaS - lumaM;\r\n  float lumaNN = lumaN + lumaM;\r\n  float lumaSS = lumaS + lumaM;\r\n  bool pairN = abs(gradientN) >= abs(gradientS);\r\n  float gradient = max(abs(gradientN), abs(gradientS));\r\n  if(pairN) lengthSign = -lengthSign;\r\n  float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\r\n/*--------------------------------------------------------------------------*/\r\n  vec2 posB;\r\n  posB = posM;\r\n  vec2 offNP;\r\n  offNP.x = (!horzSpan) ? 0.0 : srcTexelSize.x;\r\n  offNP.y = ( horzSpan) ? 0.0 : srcTexelSize.y;\r\n  if(!horzSpan) posB.x += lengthSign * 0.5;\r\n  if( horzSpan) posB.y += lengthSign * 0.5;\r\n/*--------------------------------------------------------------------------*/\r\n  vec2 posN;\r\n  posN = posB - offNP * FXAA_QUALITY_P0;\r\n  vec2 posP;\r\n  posP = posB + offNP * FXAA_QUALITY_P0;\r\n  float subpixD = ((-2.0)*subpixC) + 3.0;\r\n  float lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN));\r\n  float subpixE = subpixC * subpixC;\r\n  float lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP));\r\n/*--------------------------------------------------------------------------*/\r\n  if(!pairN) lumaNN = lumaSS;\r\n  float gradientScaled = gradient * 1.0/4.0;\r\n  float lumaMM = lumaM - lumaNN * 0.5;\r\n  float subpixF = subpixD * subpixE;\r\n  bool lumaMLTZero = lumaMM < 0.0;\r\n/*---------------------looped edge-end search-------------------------------*/\r\n  lumaEndN -= lumaNN * 0.5;\r\n  lumaEndP -= lumaNN * 0.5;\r\n  bool doneN = abs(lumaEndN) >= gradientScaled;\r\n  bool doneP = abs(lumaEndP) >= gradientScaled;\r\n  if(!doneN) posN -= offNP * FXAA_QUALITY_P1;\r\n  bool doneNP = (!doneN) || (!doneP);\r\n  if(!doneP) posP += offNP * FXAA_QUALITY_P1;\r\n/*--------------------------------------------------------------------------*/\r\n  if(doneNP) {\r\n    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n    doneN = abs(lumaEndN) >= gradientScaled;\r\n    doneP = abs(lumaEndP) >= gradientScaled;\r\n    if(!doneN) posN -= offNP * FXAA_QUALITY_P2;\r\n    doneNP = (!doneN) || (!doneP);\r\n    if(!doneP) posP += offNP * FXAA_QUALITY_P2;\r\n/*--------------------------------------------------------------------------*/\r\n    #if (FXAA_QUALITY_PS > 3)\r\n      if(doneNP) {\r\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n        doneN = abs(lumaEndN) >= gradientScaled;\r\n        doneP = abs(lumaEndP) >= gradientScaled;\r\n        if(!doneN) posN -= offNP * FXAA_QUALITY_P3;\r\n        doneNP = (!doneN) || (!doneP);\r\n        if(!doneP) posP += offNP * FXAA_QUALITY_P3;\r\n/*--------------------------------------------------------------------------*/\r\n        #if (FXAA_QUALITY_PS > 4)\r\n          if(doneNP) {\r\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n            doneN = abs(lumaEndN) >= gradientScaled;\r\n            doneP = abs(lumaEndP) >= gradientScaled;\r\n            if(!doneN) posN -= offNP * FXAA_QUALITY_P4;\r\n            doneNP = (!doneN) || (!doneP);\r\n            if(!doneP) posP += offNP * FXAA_QUALITY_P4;\r\n/*--------------------------------------------------------------------------*/\r\n            #if (FXAA_QUALITY_PS > 5)\r\n               if(doneNP) {\r\n                 if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                 if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                 if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                 if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                 doneN = abs(lumaEndN) >= gradientScaled;\r\n                 doneP = abs(lumaEndP) >= gradientScaled;\r\n                 if(!doneN) posN -= offNP * FXAA_QUALITY_P5;\r\n                 doneNP = (!doneN) || (!doneP);\r\n                 if(!doneP) posP += offNP * FXAA_QUALITY_P5;\r\n/*--------------------------------------------------------------------------*/\r\n                 #if (FXAA_QUALITY_PS > 6)\r\n                   if(doneNP) {\r\n                     if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                     if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                     if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                     if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                     doneN = abs(lumaEndN) >= gradientScaled;\r\n                     doneP = abs(lumaEndP) >= gradientScaled;\r\n                     if(!doneN) posN -= offNP * FXAA_QUALITY_P6;\r\n                     doneNP = (!doneN) || (!doneP);\r\n                     if(!doneP) posP += offNP * FXAA_QUALITY_P6;\r\n/*--------------------------------------------------------------------------*/\r\n                     #if (FXAA_QUALITY_PS > 7)\r\n                       if(doneNP) {\r\n                         if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                         if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                         if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                         if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                         doneN = abs(lumaEndN) >= gradientScaled;\r\n                         doneP = abs(lumaEndP) >= gradientScaled;\r\n                         if(!doneN) posN -= offNP * FXAA_QUALITY_P7;\r\n                         doneNP = (!doneN) || (!doneP);\r\n                         if(!doneP) posP += offNP * FXAA_QUALITY_P7;\r\n/*--------------------------------------------------------------------------*/\r\n                       }\r\n                     #endif\r\n                   }\r\n                 #endif\r\n               }\r\n             #endif\r\n           }\r\n         #endif\r\n      }\r\n    #endif\r\n  }\r\n/*----------------calculate subpix offset due to edge ends-------------------*/\r\n  float dstN = posM.x - posN.x;\r\n  float dstP = posP.x - posM.x;\r\n  if(!horzSpan) dstN = posM.y - posN.y;\r\n  if(!horzSpan) dstP = posP.y - posM.y;\r\n/*--------------------------------------------------------------------------*/\r\n  bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\r\n  float spanLength = (dstP + dstN);\r\n  bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\r\n  float spanLengthRcp = 1.0 / spanLength;\r\n/*--------------------------------------------------------------------------*/\r\n  bool directionN = dstN < dstP;\r\n  float dst = min(dstN, dstP);\r\n  bool goodSpan = directionN ? goodSpanN : goodSpanP;\r\n  float subpixG = subpixF * subpixF;\r\n  float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\r\n  float subpixH = subpixG * fxaaQualitySubpix;\r\n/*-----------------calc texture offest using subpix-------------------------*/\r\n  float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\r\n  float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\r\n\r\n  float offset = pixelOffsetSubpix * lengthSign;\r\n  #ifdef BG_TRANSPARENT\r\n    // get original texel\r\n    vec4 rgbaA = FxaaTexTopAlpha(srcTex, posM);\r\n    // calc step to blended texel\r\n    vec2 step = sign((!horzSpan) ? vec2 (offset, 0.0) : vec2 (0.0, offset));\r\n    // get neighboring texel\r\n    vec4 rgbaB = FxaaTexTopAlpha(srcTex, posM + step * srcTexelSize);\r\n    //  calc blend factor from offset\r\n    float f = (!horzSpan) ? offset / srcTexelSize.x : offset / srcTexelSize.y;\r\n    f = abs(f);\r\n    // calc alpha (special formula to emulate blending with bg)\r\n    gl_FragColor.a = 1.0 - mix(1.0 - rgbaA.a, 1.0 - rgbaB.a, f);\r\n    // calc color (special formula to emulate blending with bg)\r\n    gl_FragColor.rgb = mix(rgbaA.rgb * rgbaA.a, rgbaB.rgb * rgbaB.a, f) / gl_FragColor.a;\r\n  #else\r\n    if(!horzSpan) {\r\n       posM.x += offset;\r\n    } else {\r\n       posM.y += offset;\r\n    }\r\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r\n  #endif\r\n  return;\r\n}\r\n",
          transparent: !1,
          depthTest: !1,
          depthWrite: !1
        }),
        t.setValues(e),
        t
      )
    }
    return (
      p(n, [
        {
          key: 'copy',
          value: function (e) {
            Xe(C(n.prototype), 'copy', this).call(this, e),
              (this.depth = e.depth)
          }
        },
        {
          key: 'setValues',
          value: function (e) {
            void 0 !== e &&
              (Xe(C(n.prototype), 'setValues', this).call(this, e),
              (e = {}),
              this.bgTransparent && (e.BG_TRANSPARENT = 1),
              (this.defines = e))
          }
        }
      ]),
      n
    )
  })()
  Do.prototype.bgTransparent = !1
  function of(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var sf = [
      new ae.Vector3(0.295184, 0.077723, 0.068429),
      new ae.Vector3(-0.271976, -0.365221, 0.838363),
      new ae.Vector3(0.547713, 0.467576, 0.488515),
      new ae.Vector3(0.662808, -0.031733, 0.584758),
      new ae.Vector3(-0.025717, 0.218955, 0.657094),
      new ae.Vector3(-0.310153, -0.365223, 0.370701),
      new ae.Vector3(-0.101407, -0.006313, 0.747665),
      new ae.Vector3(-0.769138, 0.360399, 0.086847),
      new ae.Vector3(-0.271988, -0.27514, 0.905353),
      new ae.Vector3(0.09674, -0.566901, 0.700151),
      new ae.Vector3(0.562872, -0.735136, 0.094647),
      new ae.Vector3(0.379877, 0.359278, 0.190061),
      new ae.Vector3(0.519064, -0.023055, 0.405068),
      new ae.Vector3(-0.301036, 0.114696, 0.088885),
      new ae.Vector3(-0.282922, 0.598305, 0.487214),
      new ae.Vector3(-0.181859, 0.25167, 0.679702),
      new ae.Vector3(-0.191463, -0.635818, 0.512919),
      new ae.Vector3(-0.293655, 0.427423, 0.078921),
      new ae.Vector3(-0.267983, 0.680534, 0.13288),
      new ae.Vector3(0.139611, 0.319637, 0.477439),
      new ae.Vector3(-0.352086, 0.31104, 0.653913),
      new ae.Vector3(0.321032, 0.805279, 0.487345),
      new ae.Vector3(0.073516, 0.820734, 0.414183),
      new ae.Vector3(-0.155324, 0.589983, 0.41146),
      new ae.Vector3(0.335976, 0.170782, 0.527627),
      new ae.Vector3(0.46346, -0.355658, 0.167689),
      new ae.Vector3(0.222654, 0.59655, 0.769406),
      new ae.Vector3(0.922138, -0.04207, 0.147555),
      new ae.Vector3(-0.72705, -0.329192, 0.369826),
      new ae.Vector3(-0.090731, 0.53382, 0.463767),
      new ae.Vector3(-0.323457, -0.876559, 0.238524),
      new ae.Vector3(-0.663277, -0.372384, 0.342856)
    ],
    Uo = (function () {
      x(r, ae.RawShaderMaterial)
      var t = of(r)
      function r() {
        var e
        return (
          G(this, r),
          (e = t.call(this)).setValues({
            uniforms: {
              noiseTexture: { type: 't', value: Ri.noiseTexture },
              noiseTexelSize: {
                type: 'v2',
                value: new ae.Vector2(1 / Ri.noiseWidth, 1 / Ri.noiseHeight)
              },
              diffuseTexture: { type: 't', value: null },
              normalTexture: { type: 't', value: null },
              depthTexture: { type: 't', value: null },
              srcTexelSize: {
                type: 'v2',
                value: new ae.Vector2(1 / 512, 1 / 512)
              },
              camNearFar: { type: 'v2', value: new ae.Vector2(1, 10) },
              projMatrix: { type: 'mat4', value: new ae.Matrix4() },
              aspectRatio: { type: 'f', value: 0 },
              tanHalfFOV: { type: 'f', value: 0 },
              samplesKernel: { type: 'v3v', value: sf },
              kernelRadius: { type: 'f', value: 1 },
              depthThreshold: { type: 'f', value: 1 },
              factor: { type: 'f', value: 1 }
            },
            vertexShader: yr,
            fragmentShader:
              "precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 32\r\nuniform vec3 samplesKernel[MAX_SAMPLES_COUNT];\r\nuniform sampler2D noiseTexture;\r\nuniform vec2      noiseTexelSize;\r\nuniform sampler2D diffuseTexture;\r\nuniform sampler2D depthTexture;\r\nuniform sampler2D normalTexture;\r\nuniform vec2      srcTexelSize;\r\nuniform vec2      camNearFar;\r\nuniform mat4      projMatrix;\r\n\r\nuniform float aspectRatio;\r\nuniform float tanHalfFOV;\r\n\r\nuniform float kernelRadius;\r\nuniform float depthThreshold;\r\nuniform float factor;\r\n\r\nvarying vec2 vUv;\r\n\r\nfloat CalcViewZ(vec2 screenPos)\r\n{\r\n  float depth = texture2D(depthTexture, screenPos).x;\r\n  // [0, 1]->[-1, 1]\r\n  float clipedZ = 2.0 * depth - 1.0;\r\n  // see THREE.js camera.makeFrustum for projection details\r\n  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r\n}\r\n\r\nvec3 ViewPosFromDepth(vec2 screenPos)\r\n{\r\n  vec3 viewPos;\r\n  viewPos.z = CalcViewZ(screenPos);\r\n  //[0, 1]->[-1, 1]\r\n  vec2 projPos = 2.0 * screenPos - 1.0;\r\n  // reconstruct viewposition in right-handed sc with z to viewer\r\n  viewPos.xy = vec2(\r\n                    projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r\n                    projPos.y * tanHalfFOV * abs(viewPos.z)\r\n                   );\r\n  return viewPos;\r\n}\r\n\r\nvoid main() {\r\n  vec3 viewPos = ViewPosFromDepth(vUv);\r\n  // remap coordinates to prevent noise exture rescale\r\n  vec2 vUvNoise = vUv / srcTexelSize * noiseTexelSize;\r\n  vec4 normalData = texture2D(normalTexture, vUv);\r\n  // return for background fragments (their normals are zero vectors)\r\n  if (length(normalData.rgb) < EPSILON) {\r\n    // 0.0 in alpha component means that it is background fragment\r\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n    return;\r\n  }\r\n  //[0, 1] -> [-1, 1]\r\n  vec3 normal = (normalData.rgb * 2.0 - 1.0);\r\n  // normalData.a store 1.0 if normal was build for frontfaced surface\r\n  // and 0.0 in other case\r\n  if (normalData.a < EPSILON) {\r\n    normal *= -1.0;\r\n  }\r\n  // get random vector for sampling sphere rotation\r\n  vec3 randN = texture2D(noiseTexture, vUvNoise).rgb * 2.0 - 1.0;\r\n  randN = normalize(randN);\r\n  // build TBN (randomly rotated around normal)\r\n  vec3 tangent   = normalize(randN - normal * dot(randN, normal));\r\n  vec3 bitangent = cross(tangent, normal);\r\n  mat3 TBN = mat3(tangent, bitangent, normal);\r\n  // calc AO value\r\n  float AO = 0.0;\r\n  for (int i = 0 ; i < MAX_SAMPLES_COUNT ; i++) {\r\n    // rotate sampling kernel around normal\r\n    vec3 reflectedSample = TBN * samplesKernel[i];\r\n    // get sample\r\n    vec3 samplePos = viewPos + reflectedSample * kernelRadius;\r\n\r\n    // project sample to screen to get sample's screen pos\r\n    vec4 SampleScrPos = vec4(samplePos, 1.0);\r\n    // eye -> clip\r\n    SampleScrPos = projMatrix * SampleScrPos;\r\n    // normalize\r\n    SampleScrPos.xy /= SampleScrPos.w;\r\n    //[-1, 1] -> [0, 1]\r\n    SampleScrPos.xy = (SampleScrPos.xy + vec2(1.0)) * 0.5;\r\n\r\n    // get view z for sample projected to the objct surface\r\n    float sampleDepth = CalcViewZ(SampleScrPos.xy);\r\n    // calc occlusion made by object surface at the sample\r\n    AO += step(samplePos.z, sampleDepth);\r\n  }\r\n  // calc result AO-map color\r\n  AO = 1.0 - max(0.0, AO / float(MAX_SAMPLES_COUNT) * factor);\r\n  // write value to AO-map\r\n  gl_FragColor = vec4(AO, AO, AO, 1.0);\r\n}\r\n",
            transparent: !1,
            depthTest: !1,
            depthWrite: !1
          }),
          e
        )
      }
      return p(r)
    })()
  function af(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var lf = [-2, -1, 0, 1, 2],
    Ko = (function () {
      x(r, ae.RawShaderMaterial)
      var t = af(r)
      function r() {
        var e
        return (
          G(this, r),
          (e = t.call(this)).setValues({
            uniforms: {
              depthTexture: { type: 't', value: null },
              srcTexelSize: {
                type: 'v2',
                value: new ae.Vector2(1 / 512, 1 / 512)
              },
              aoMap: { type: 't', value: null },
              samplesOffsets: { type: 'fv1', value: lf }
            },
            vertexShader: yr,
            fragmentShader:
              'precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 5\r\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\r\nuniform sampler2D aoMap;\r\nuniform sampler2D depthTexture;\r\nuniform vec2      srcTexelSize;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  float x = vUv.x;\r\n  float y = vUv.y;\r\n  vec4 res = vec4(0.0);\r\n  res.a = texture2D(aoMap, vec2(x, y )).a;\r\n  // return for background fragments (0.0 in alpha component means that it is background fragment)\r\n  if (res.a < EPSILON) {\r\n    gl_FragColor = res;\r\n    return;\r\n  }\r\n\r\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r\n  float weightSum = 0.0;\r\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r\n    if (texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).a < EPSILON) {\r\n      continue;\r\n    }\r\n    vec2 samplePos = vec2(x + samplesOffsets[i] * srcTexelSize.x, y);\r\n    float depth = texture2D(depthTexture, samplePos).x;\r\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r\n    res.rgb += texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).rgb * weight;\r\n    weightSum += weight;\r\n  }\r\n  res.rgb = res.rgb / weightSum;\r\n  gl_FragColor = res;\r\n}\r\n',
            transparent: !1,
            depthTest: !1,
            depthWrite: !1
          }),
          e
        )
      }
      return p(r)
    })()
  function cf(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var uf = [-2, -1, 0, 1, 2],
    Jo = (function () {
      x(n, ae.RawShaderMaterial)
      var r = cf(n)
      function n(e) {
        var t
        return (
          G(this, n),
          (t = r.call(this, e)).setValues({
            uniforms: {
              diffuseTexture: { type: 't', value: null },
              depthTexture: { type: 't', value: null },
              srcTexelSize: {
                type: 'v2',
                value: new ae.Vector2(1 / 512, 1 / 512)
              },
              aoMap: { type: 't', value: null },
              samplesOffsets: { type: 'fv1', value: uf },
              projMatrix: { type: 'mat4', value: new ae.Matrix4() },
              aspectRatio: { type: 'f', value: 0 },
              tanHalfFOV: { type: 'f', value: 0 },
              fogNearFar: { type: 'v2', value: new ae.Vector2(100, 100) },
              fogColor: { type: 'v4', value: new ae.Vector4(0, 0.5, 0, 1) }
            },
            vertexShader: yr,
            fragmentShader:
              "precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 5\r\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\r\nuniform sampler2D diffuseTexture;\r\nuniform sampler2D aoMap;\r\nuniform sampler2D depthTexture;\r\nuniform vec2      srcTexelSize;\r\n\r\nuniform mat4  projMatrix;\r\nuniform float aspectRatio;\r\nuniform float tanHalfFOV;\r\n\r\n#ifdef USE_FOG\r\n  uniform vec2 fogNearFar;\r\n  uniform vec4 fogColor;\r\n#endif\r\nvarying vec2 vUv;\r\n\r\nfloat CalcViewZ(vec2 screenPos)\r\n{\r\n  float depth = texture2D(depthTexture, screenPos).x;\r\n  // [0, 1]->[-1, 1]\r\n  float clipedZ = 2.0 * depth - 1.0;\r\n  // see THREE.js camera.makeFrustum for projection details\r\n  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r\n}\r\n\r\nvec3 ViewPosFromDepth(vec2 screenPos)\r\n{\r\n  vec3 viewPos;\r\n  viewPos.z = CalcViewZ(screenPos);\r\n  //[0, 1]->[-1, 1]\r\n  vec2 projPos = 2.0 * screenPos - 1.0;\r\n  // reconstruct viewposition in right-handed sc with z to viewer\r\n  viewPos.xy = vec2(\r\n  projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r\n  projPos.y * tanHalfFOV * abs(viewPos.z)\r\n  );\r\n  return viewPos;\r\n}\r\n\r\nvoid main() {\r\n  vec3 viewPos = ViewPosFromDepth(vUv);\r\n  float x = vUv.x;\r\n  float y = vUv.y;\r\n  vec4 color = texture2D(diffuseTexture, vec2(x, y));\r\n  vec4 res = vec4(0.0);\r\n  res.a = texture2D(aoMap, vec2(x, y )).a;\r\n  // return for background fragments (0.0 in alpha component means that it is background fragment)\r\n  if (res.a < EPSILON) {\r\n    gl_FragColor = color;\r\n    return;\r\n  }\r\n\r\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r\n  float weightSum = 0.0;\r\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r\n    if (texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).a < EPSILON) {\r\n      continue;\r\n    }\r\n    vec2 samplePos = vec2(x, y + samplesOffsets[i] * srcTexelSize.y);\r\n    float depth = texture2D(depthTexture, samplePos).x;\r\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r\n    res.rgb += texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).rgb * weight;\r\n    weightSum += weight;\r\n  }\r\n  res.rgb /= weightSum;\r\n\r\n  #if defined(USE_FOG) && !defined(FOG_TRANSPARENT)\r\n    // Add fog to the result value\r\n    // Proper way to get an image with fog and ao requires formula:\r\n    //          gl_FragColor = fragColor*AO*(1-fogFactor) + fogColor*fogFactor\r\n    // But we have already fogged molecule to add AO too. Let's split the straight formula into our real steps!\r\n    // We have:  AO, fogFactor, fogColor,\r\n    //          color = fragColor*(1-fogFactor) + fogColor*fogFactor (it comes from diffuseTexture,\r\n    //                                                                where molecule has been already drawn with fog)\r\n    // Transform:\r\n    //          fragColor*AO*(1-fogFactor) + fogColor*fogFactor =\r\n    //        = [fragColor*(1-fogFactor) = color - fogColor*fogFactor] =\r\n    //        = (color - fogColor*fogFactor)*AO + fogColor*fogFactor =\r\n    //        = color*AO + fogColor*fogFactor*(1 - AO)\r\n    // Result:  gl_FragColor = color*AO + fogColor*fogFactor*(1 - AO)\r\n    float fogFactor = smoothstep(fogNearFar.x, fogNearFar.y, - viewPos.z) * fogColor.a;\r\n    gl_FragColor.rgb = color.rgb * res.rgb + fogColor.rgb * fogFactor *(vec3(1.0, 1.0, 1.0) - res.rgb);\r\n  #else\r\n    gl_FragColor.rgb = color.rgb * res.rgb;\r\n  #endif\r\n  gl_FragColor.a = color.a;\r\n}\r\n",
            transparent: !1,
            depthTest: !1,
            depthWrite: !1
          }),
          t.setValues(e),
          t
        )
      }
      return (
        p(n, [
          {
            key: 'setValues',
            value: function (e) {
              void 0 !== e &&
                (Xe(C(n.prototype), 'setValues', this).call(this, e),
                (e = {}),
                this.useFog && (e.USE_FOG = 1),
                this.fogTransparent && (e.FOG_TRANSPARENT = 1),
                (this.defines = e))
            }
          }
        ]),
        n
      )
    })()
  ;(Jo.prototype.useFog = !0), (Jo.prototype.fogTransparent = !1)
  function hf(r) {
    var n = (function () {
      if ('undefined' == typeof Reflect || !Reflect.construct) return !1
      if (Reflect.construct.sham) return !1
      if ('function' == typeof Proxy) return !0
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {})
          ),
          !0
        )
      } catch (e) {
        return !1
      }
    })()
    return function () {
      var e,
        t = C(r)
      return R(
        this,
        n
          ? ((e = C(this).constructor), Reflect.construct(t, arguments, e))
          : t.apply(this, arguments)
      )
    }
  }
  var ls = (function () {
      x(r, ae.RawShaderMaterial)
      var t = hf(r)
      function r() {
        var e
        return (
          G(this, r),
          (e = t.call(this)).setValues({
            uniforms: {
              srcL: { type: 't', value: null },
              srcR: { type: 't', value: null }
            },
            vertexShader: yr,
            fragmentShader:
              'precision highp float;\r\n\r\nuniform sampler2D srcL;\r\nuniform sampler2D srcR;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vec4 l = texture2D(srcL, vUv);\r\n  vec4 r = texture2D(srcR, vUv);\r\n  gl_FragColor = vec4(l.r, r.g, r.b, 1.0);\r\n}\r\n',
            transparent: !1,
            depthTest: !1,
            depthWrite: !1
          }),
          e
        )
      }
      return p(r)
    })(),
    ff = (function () {
      function e() {
        G(this, e),
          (this.position = new ae.Vector3(0, 0, 0)),
          (this.scale = 1),
          (this.orientation = new ae.Quaternion(0, 0, 0, 1))
      }
      return (
        p(e, [
          {
            key: 'set',
            value: function (e, t, r) {
              ;(this.position = e), (this.scale = t), (this.orientation = r)
            }
          }
        ]),
        e
      )
    })(),
    df = (function () {
      function e() {
        G(this, e)
      }
      return (
        p(e, [
          {
            key: 'setup',
            value: function (e, t) {
              ;(this._startTime = void 0),
                (this._endTime = void 0),
                (this._isPaused = !1),
                (this._srcView = e),
                (this._dstView = t),
                (this._isMoving = !1)
            }
          },
          {
            key: 'isMoving',
            value: function () {
              return this._isMoving
            }
          },
          {
            key: 'wasStarted',
            value: function () {
              return void 0 !== this._startTime && void 0 !== this._endTime
            }
          },
          {
            key: 'start',
            value: function () {
              this._startTime = Date.now()
              var e = Q.now.interpolateViews ? 1500 : 0
              ;(this._endTime = this._startTime + e), (this._isMoving = !0)
            }
          },
          {
            key: 'getCurrentView',
            value: function () {
              if (
                void 0 === this._srcView ||
                void 0 === this._dstView ||
                !this._isMoving ||
                !this.wasStarted()
              )
                return { success: !1 }
              var e = this.createView(),
                t = Date.now()
              if (t > this._endTime)
                return (
                  (e = this._dstView), this.reset(), { success: !0, view: e }
                )
              t = (t - this._startTime) / (this._endTime - this._startTime)
              return (
                e.position.copy(this._srcView.position),
                e.position.lerp(this._dstView.position, t),
                (e.scale =
                  (1 - t) * this._srcView.scale + t * this._dstView.scale),
                e.orientation.copy(this._srcView.orientation),
                e.orientation.slerp(this._dstView.orientation, t),
                { success: !0, view: e }
              )
            }
          },
          {
            key: 'reset',
            value: function () {
              ;(this._startTime = this._endTime = 0), (this._isMoving = !1)
            }
          },
          {
            key: 'pause',
            value: function () {
              this._isPaused ||
                (this.setup(this.getCurrentView().view, this._dstView),
                (this._isPaused = !0))
            }
          },
          {
            key: 'resume',
            value: function () {
              this._isPaused = !1
            }
          },
          {
            key: 'createView',
            value: function () {
              return new ff()
            }
          }
        ]),
        e
      )
    })()
  function pf(e, t) {
    ;(this.context = e), (this._opts = b.default.merge({ path: '/' }, t))
  }
  function mf(i) {
    function e(e) {
      ;(e.style.position = 'absolute'),
        (e.style.bottom = '20px'),
        (e.style.padding = '12px 6px'),
        (e.style.border = '1px solid #fff'),
        (e.style.borderRadius = '4px'),
        (e.style.background = 'transparent'),
        (e.style.color = '#fff'),
        (e.style.font = 'normal 13px sans-serif'),
        (e.style.textAlign = 'center'),
        (e.style.opacity = '0.5'),
        (e.style.outline = 'none'),
        (e.style.zIndex = '999')
    }
    if ('xr' in navigator) {
      var t = document.createElement('button')
      return (
        (t.style.display = 'none'),
        e(t),
        navigator.xr.isSessionSupported('immersive-vr').then(function (e) {
          return e
            ? (function (t) {
                ;(t.style.display = ''),
                  (t.style.cursor = 'pointer'),
                  (t.style.left = 'calc(50% - 50px)'),
                  (t.style.width = '100px'),
                  (t.textContent = 'ENTER VR')
                var r = null
                function n() {
                  r.removeEventListener('end', n),
                    (t.textContent = 'ENTER VR'),
                    (r = null)
                }
                function e(e) {
                  e.addEventListener('end', n),
                    i._gfx.renderer.xr.setReferenceSpaceType('local'),
                    i._gfx.renderer.xr.setSession(e),
                    (t.textContent = 'EXIT VR'),
                    (r = e)
                }
                ;(t.onmouseenter = function () {
                  t.style.opacity = '1.0'
                }),
                  (t.onmouseleave = function () {
                    t.style.opacity = '0.5'
                  }),
                  (t.onclick = function () {
                    null === r
                      ? (navigator.xr
                          .requestSession('immersive-vr', {
                            optionalFeatures: ['local-floor', 'bounded-floor']
                          })
                          .then(e),
                        i.moveSceneBehindHeadset())
                      : r.end()
                  })
              })(t)
            : (((e = t).style.display = ''),
              (e.style.cursor = 'auto'),
              (e.style.left = 'calc(50% - 75px)'),
              (e.style.width = '150px'),
              (e.textContent = 'VR NOT FOUND'),
              (e.onmouseenter = null),
              (e.onmouseleave = null),
              void (e.onclick = null))
        }),
        t
      )
    }
    var r = document.createElement('a')
    return (
      (r.href = 'https://webvr.info'),
      (r.innerHTML = 'WEBXR NOT SUPPORTED'),
      (r.style.left = 'calc(50% - 90px)'),
      (r.style.width = '180px'),
      (r.style.textDecoration = 'none'),
      e(r),
      r
    )
  }
  Or(pf.prototype),
    (pf.prototype.removeCookie = function (e) {
      var t = this._toCount(e)
      if ((r = this._getSimpleCookie(t))) {
        this._removeSimpleCookie(t)
        for (var r = parseInt(r, 10), n = 0; n < r; ++n)
          this._removeSimpleCookie(e + n)
      } else this._removeSimpleCookie(e)
    }),
    (pf.prototype.setCookie = function (e, t) {
      this.removeCookie(e)
      var r = (function (e, t) {
          for (var r = e.length, n = [], i = 0, o = 0; o < r; i++, o += t)
            n[i] = e.slice(o, o + t)
          return n
        })((t = encodeURIComponent(t)), 4e3 - e.length - 1),
        n = r.length
      if (1 !== n) {
        var i = this._toCount(e)
        this._setSimpleCookie(i, n.toString())
        for (var o = 0; o < n; ++o) this._setSimpleCookie(e + o, r[o])
      } else this._setSimpleCookie(e, t)
    }),
    (pf.prototype.getCookie = function (e) {
      var t = this._toCount(e)
      if (!(r = this._getSimpleCookie(t))) return this._getSimpleCookie(e)
      for (var r = parseInt(r, 10), n = [], i = 0; i < r; ++i)
        n[i] = this._getSimpleCookie(e + i)
      return n.join('')
    }),
    (pf.prototype._toCount = function (e) {
      return e + 'Cnt'
    }),
    (pf.prototype._removeSimpleCookie = function (e) {
      document.cookie = ''.concat(
        e,
        '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;'
      )
    }),
    (pf.prototype._getExpirationDate = function () {
      var e = new Date()
      return e.setFullYear(e.getFullYear() + 10), e
    }),
    (pf.prototype._setSimpleCookie = function (e, t) {
      document.cookie = ''
        .concat(e, '=')
        .concat(t, ';expires=')
        .concat(this._getExpirationDate().toUTCString(), ';path=')
        .concat(this._opts.path)
    }),
    (pf.prototype._getSimpleCookie = function (e) {
      e = document.cookie.match(new RegExp('(?:^|; )'.concat(e, '=([^;]*)')))
      return e ? decodeURIComponent(e[1]) : ''
    }),
    (pf.prototype._exists = function (e) {
      return document.cookie.match(new RegExp('(?:^|; )'.concat(e, '=([^;]*)')))
    })
  var yf,
    _f,
    vf,
    gf,
    xf,
    bf,
    wf,
    Sf,
    Rf,
    Cf,
    Af,
    Ef,
    kf,
    Tf,
    Pf,
    Mf,
    Nf,
    Lf,
    If,
    Of,
    Bf,
    Vf,
    Df,
    zf,
    Ff,
    Uf,
    Gf = (function () {
      function t(e) {
        G(this, t),
          (this._mainCamera = new ae.PerspectiveCamera()),
          (this._button = null),
          (this._onToggle = e),
          (this._molContainer = new kr.RCGroup()),
          (this._user = new kr.RCGroup()),
          (this._scalingPivot = new ae.Object3D()),
          this._user.add(this._scalingPivot),
          (this._controller1 = null),
          (this._controller2 = null),
          (this._pressedGripsCounter = 0),
          (this._distance = 0),
          (this._gfx = null)
      }
      return (
        p(t, [
          {
            key: 'startScalingByControllers',
            value: function () {
              ;(this._distance = this._controller1.position.distanceTo(
                this._controller2.position
              )),
                kr.getMiddlePoint(
                  this._controller1.position,
                  this._controller2.position,
                  this._scalingPivot.position
                ),
                this._scalingPivot.scale.set(1, 1, 1),
                this._scalingPivot.updateMatrix(),
                this._scalingPivot.updateMatrixWorld(),
                this._scalingPivot.addSavingWorldTransform(this._molContainer)
            }
          },
          {
            key: 'stopScalingByControllers',
            value: function () {
              this._gfx.scene.addSavingWorldTransform(this._molContainer)
            }
          },
          {
            key: 'handleGripsDown',
            value: function (e) {
              this._pressedGripsCounter++,
                2 === this._pressedGripsCounter
                  ? this.startScalingByControllers()
                  : 1 === this._pressedGripsCounter &&
                    e.target.addSavingWorldTransform(this._molContainer)
            }
          },
          {
            key: 'handleGripsUp',
            value: function (e) {
              this._pressedGripsCounter--,
                1 === this._pressedGripsCounter
                  ? (this.stopScalingByControllers(),
                    (e.target === this._controller1
                      ? this._controller2
                      : this._controller1
                    ).addSavingWorldTransform(this._molContainer))
                  : 0 === this._pressedGripsCounter &&
                    this._gfx.scene.addSavingWorldTransform(this._molContainer)
            }
          },
          {
            key: 'enable',
            value: function (e) {
              if (e) {
                var t = (this._gfx = e).renderer,
                  r = e.camera
                if (!t)
                  throw new Error('No renderer is available to toggle WebVR')
                if (!r)
                  throw new Error('No camera is available to toggle WebVR')
                ;(t.xr.enabled = !0),
                  this._button
                    ? (this._button.style.display = 'block')
                    : ((this._button = mf(this)),
                      document.body.appendChild(this._button)),
                  (this._mainFog = Q.now.fog),
                  Q.set('fog', !1),
                  this._plugVRNodesIntoScene(e, t),
                  this._setControllersListeners(),
                  this._onToggle && this._onToggle(!0)
              } else
                L.warn("WebVR couldn't be enabled, because gfx is not defined")
            }
          },
          {
            key: '_plugVRNodesIntoScene',
            value: function (e, t) {
              this._mainCamera.copy(e.camera),
                e.scene.add(this._user),
                e.scene.add(this._molContainer),
                this._molContainer.add(e.root),
                (this._controller1 = t.xr.getController(0)),
                (this._controller2 = t.xr.getController(1))
              t = this._createControllerMesh()
              this._controller1.add(t),
                this._controller2.add(t.clone()),
                this._user.add(this._controller1),
                this._user.add(this._controller2)
            }
          },
          {
            key: '_setControllersListeners',
            value: function () {
              var t = this
              this._controller1.addEventListener('selectstart', function (e) {
                t.handleGripsDown(e)
              }),
                this._controller1.addEventListener('selectend', function (e) {
                  t.handleGripsUp(e)
                }),
                this._controller2.addEventListener('selectstart', function (e) {
                  t.handleGripsDown(e)
                }),
                this._controller2.addEventListener('selectend', function (e) {
                  t.handleGripsUp(e)
                }),
                this._controller1.addEventListener(
                  'squeezestart',
                  function (e) {
                    t.handleGripsDown(e)
                  }
                ),
                this._controller1.addEventListener('squeezeend', function (e) {
                  t.handleGripsUp(e)
                }),
                this._controller2.addEventListener(
                  'squeezestart',
                  function (e) {
                    t.handleGripsDown(e)
                  }
                ),
                this._controller2.addEventListener('squeezeend', function (e) {
                  t.handleGripsUp(e)
                })
            }
          },
          {
            key: 'disable',
            value: function () {
              if (this._gfx) {
                var e = this._gfx,
                  t = e.renderer,
                  r = e.camera
                if (!t)
                  throw new Error('No renderer is available to toggle WebVR')
                t.setAnimationLoop(null)
                e = t.xr.getSession()
                e && e.end(),
                  (t.xr.enabled = !1),
                  this._button && (this._button.style.display = 'none'),
                  Q.set('fog', this._mainFog),
                  this._unplugVRNodesFromScene(r),
                  this._onToggle && this._onToggle(!1)
              }
            }
          },
          {
            key: '_unplugVRNodesFromScene',
            value: function (e) {
              this._mainCamera && e && e.copy(this._mainCamera)
              e = this._molContainer.children[0]
              e && this._gfx.scene.add(e),
                this._molContainer.parent.remove(this._molContainer),
                this._user && this._gfx.scene.remove(this._user),
                (this._molContainer = null),
                (this._user = null),
                (this._scalingPivot = null),
                (this._user = null),
                (this._controller1 = null),
                (this._controller2 = null)
            }
          },
          {
            key: '_createControllerMesh',
            value: function () {
              var e = new ae.CylinderGeometry(0.04, 0.04, 0.3),
                t = new Ni()
              t.setValues({ lights: !1, overrideColor: !0 }),
                t.setUberOptions({ fixedColor: new ae.Color(4474111) }),
                t.updateUniforms()
              t = new ae.Mesh(e, t)
              return t.rotateX(-Math.PI / 2), t
            }
          },
          {
            key: 'updateMoleculeScale',
            value: function () {
              var e, t
              this._controller1 &&
                this._controller2 &&
                2 === this._pressedGripsCounter &&
                (kr.getMiddlePoint(
                  this._controller1.position,
                  this._controller2.position,
                  this._scalingPivot.position
                ),
                (t =
                  (e = this._controller1.position.distanceTo(
                    this._controller2.position
                  )) / this._distance),
                this._scalingPivot.scale.multiplyScalar(t),
                (this._distance = e))
            }
          },
          {
            key: 'moveSceneBehindHeadset',
            value: function () {
              var e = this._gfx,
                t = e.camera,
                r = this._molContainer
              r.matrix.identity(),
                r.position.set(0, 0, -4),
                r.updateMatrix(),
                r.matrixWorld.multiplyMatrices(t.matrixWorld, r.matrix),
                e.scene.addSavingWorldTransform(r),
                this._onToggle && this._onToggle(!0)
            }
          },
          {
            key: 'getCanvas',
            value: function () {
              var e = this._gfx
              return e && e.renderer ? e.renderer.domElement : null
            }
          }
        ]),
        t
      )
    })(),
    jf = hr.selectors,
    Hf = hr.Atom,
    Wf = hr.Residue,
    Yf = hr.Chain,
    Xf = hr.Molecule,
    qf = 0,
    $f = 1,
    Zf = 2,
    Kf = 'Could not find suitable loader for this source',
    Qf = le.createElement
  function Jf(e) {
    var t = e.lastIndexOf('.')
    return (e = 0 <= t ? e.substr(0, t) : e)
  }
  function ed(e, t, r) {
    void 0 !== r
      ? e.debug(''.concat(t, '... ').concat(Math.floor(100 * r), '%'))
      : e.debug(''.concat(t, '...'))
  }
  function td() {
    return Q.now.fogColorEnable ? Q.now.fogColor : Q.now.bg.color
  }
  function rd(e) {
    T.call(this),
      (this._opts = b.default.merge(
        { settingsCookie: 'settings', cookiePath: '/' },
        e
      )),
      (this._gfx = null),
      (this._interpolator = new df()),
      (this._container =
        (e && e.container) ||
        document.getElementById('miew-container') ||
        b.default.head(document.getElementsByClassName('miew-container')) ||
        document.body),
      (this._containerRoot = this._container),
      (this._running = !1),
      (this._halting = !1),
      (this._building = !1),
      (this._needRender = !0),
      (this._hotKeysEnabled = !0),
      (this.settings = Q)
    var t = L
    ;(t.console = !1),
      (t.level = 'info'),
      (this.logger = t),
      (this._cookies = new pf(this)),
      this.restoreSettings(),
      e && e.settings && this.settings.set(e.settings),
      (this._spinner = null),
      (this._loading = []),
      (this._animInterval = null),
      (this._visuals = {}),
      (this._curVisualName = null),
      (this._objects = []),
      (this._sourceWindow = null),
      this.reset(),
      this._repr &&
        t.debug(
          'Selected '
            .concat(this._repr.mode.name, ' mode with ')
            .concat(this._repr.colorer.name, ' colorer.')
        )
    var r = this
    rd.registeredPlugins.forEach(function (e) {
      e.call(r)
    }),
      this._initOnSettingsChanged()
  }
  function nd(e, t) {
    for (var r = e; r.firstChild; ) r.removeChild(r.firstChild)
    r.appendChild(t)
  }
  function id(e) {
    return e.getExtension('EXT_frag_depth')
  }
  function od(e) {
    return (
      e.getExtension('WEBGL_depth_texture') &&
      e.getExtension('WEBGL_draw_buffers')
    )
  }
  ;(((rd.prototype = Object.create(T.prototype)).constructor =
    rd).prototype.getMaxRepresentationCount = function () {
    return $a.NUM_REPRESENTATION_BITS
  }),
    (rd.prototype._updateShadowCamera =
      ((yf = new ae.Matrix4()),
      (_f = new ae.Vector3()),
      (vf = { center: new ae.Vector3(), halfSize: new ae.Vector3() }),
      function () {
        this._gfx.scene.updateMatrixWorld()
        for (var e, t = 0; t < this._gfx.scene.children.length; t++)
          'DirectionalLight' === this._gfx.scene.children[t].type &&
            ((e = this._gfx.scene.children[t]),
            yf.copy(e.shadow.camera.matrixWorldInverse),
            this.getOBB(yf, vf),
            _f.subVectors(e.target.position, e.position),
            e.position.subVectors(vf.center, _f),
            e.target.position.copy(vf.center),
            (e.shadow.bias = 0.09),
            (e.shadow.camera.bottom = -vf.halfSize.y),
            (e.shadow.camera.top = vf.halfSize.y),
            (e.shadow.camera.right = vf.halfSize.x),
            (e.shadow.camera.left = -vf.halfSize.x),
            (e.shadow.camera.near = _f.length() - vf.halfSize.z),
            (e.shadow.camera.far = _f.length() + vf.halfSize.z),
            e.shadow.camera.updateProjectionMatrix())
      })),
    (rd.prototype.init = function () {
      var e = this._container,
        t = le.createElement('div', { class: 'miew-canvas' })
      nd(e, t), (this._container = t)
      t = document.createDocumentFragment()
      if (
        (t.appendChild(
          (this._msgMode = Qf(
            'div',
            { class: 'mode-message overlay' },
            Qf('p', {}, 'COMPONENT EDIT MODE')
          ))
        ),
        t.appendChild(
          (this._msgAtomInfo = Qf(
            'div',
            { class: 'atom-info overlay' },
            Qf('p', {}, '')
          ))
        ),
        e.appendChild(t),
        null !== this._gfx)
      )
        return !0
      var r = this
      this._showMessage('Viewer is being initialized...')
      try {
        this._initGfx(),
          this._initListeners(),
          (this._spinner = new l({
            lines: 13,
            length: 28,
            width: 14,
            radius: 42,
            color: '#fff',
            zIndex: 700
          })),
          window.top.addEventListener('keydown', function (e) {
            r._onKeyDown(e)
          }),
          window.top.addEventListener('keyup', function (e) {
            r._onKeyUp(e)
          }),
          (this._objectControls = new Yh(
            this._gfx.root,
            this._gfx.pivot,
            this._gfx.camera,
            this._gfx.renderer.domElement,
            function () {
              return r._getAltObj()
            }
          )),
          this._objectControls.addEventListener('change', function (e) {
            switch ((Q.now.shadow.on && r._updateShadowCamera(), e.action)) {
              case 'rotate':
                r.dispatchEvent({ type: 'rotate', quaternion: e.quaternion })
                break
              case 'zoom':
                r.dispatchEvent({ type: 'zoom', factor: e.factor })
                break
              default:
                r.dispatchEvent({ type: e.action })
            }
            r.dispatchEvent({ type: 'transform' }), (r._needRender = !0)
          })
        var n = this._gfx
        ;(this._picker = new Xh(n.root, n.camera, n.renderer.domElement)),
          this._picker.addEventListener('newpick', function (e) {
            r._onPick(e)
          }),
          this._picker.addEventListener('dblclick', function (e) {
            r.center(e)
          })
      } catch (e) {
        if (
          'TypeError' === e.name &&
          "Cannot read property 'getExtension' of null" === e.message
        )
          this._showMessage('Could not create WebGL context.')
        else {
          if (!(1 < e.message.search(/webgl/i)))
            throw (this._showMessage('Viewer initialization failed.'), e)
          this._showMessage(e.message)
        }
        return !1
      }
      t = this._opts && this._opts.load
      return (
        t &&
          ((n = this._opts && this._opts.type),
          this.load(t, { fileType: n, keepRepsInfo: !0 })),
        !0
      )
    }),
    (rd.prototype.term = function () {
      this._showMessage('Viewer has been terminated.'),
        this._loading.forEach(function (e) {
          e.cancel()
        }),
        (this._loading.length = 0),
        this.halt(),
        (this._gfx = null)
    }),
    (rd.prototype._showMessage = function (e) {
      var t = document.createElement('div')
      t.setAttribute('class', 'miew-message'),
        t
          .appendChild(document.createElement('p'))
          .appendChild(document.createTextNode(e)),
        nd(this._container, t)
    }),
    (rd.prototype._showCanvas = function () {
      nd(this._container, this._gfx.renderer.domElement)
    }),
    (rd.prototype._requestAnimationFrame = function (e) {
      var t = this._gfx.renderer.xr
      t && t.enabled
        ? this._gfx.renderer.setAnimationLoop(e)
        : requestAnimationFrame(e)
    }),
    (rd.prototype._initGfx = function () {
      var e = {
          width: this._container.clientWidth,
          height: this._container.clientHeight
        },
        t = { preserveDrawingBuffer: !0, alpha: !0, premultipliedAlpha: !1 }
      Q.now.antialias && (t.antialias = !0),
        (e.renderer2d = new Vh()),
        (e.renderer = new ae.WebGL1Renderer(t)),
        (e.renderer.shadowMap.enabled = Q.now.shadow.on),
        (e.renderer.shadowMap.autoUpdate = !1),
        (e.renderer.shadowMap.type = ae.PCFShadowMap),
        yi.init(e.renderer),
        id(e.renderer.getContext()) || Q.set('zSprites', !1),
        od(e.renderer.getContext()) || Q.set('ao', !1),
        (e.renderer.autoClear = !1),
        e.renderer.setPixelRatio(window.devicePixelRatio),
        e.renderer.setSize(e.width, e.height),
        e.renderer.setClearColor(Q.now.bg.color, Number(!Q.now.bg.transparent)),
        e.renderer.clearColor(),
        e.renderer2d.setSize(e.width, e.height),
        (e.camera = new ae.PerspectiveCamera(
          Q.now.camFov,
          e.width / e.height,
          Q.now.camNear,
          Q.now.camFar
        )),
        e.camera.setMinimalFov(Q.now.camFov),
        (e.camera.position.z = Q.now.camDistance),
        e.camera.updateProjectionMatrix(),
        e.camera.layers.set(kr.LAYERS.DEFAULT),
        e.camera.layers.enable(kr.LAYERS.VOLUME),
        e.camera.layers.enable(kr.LAYERS.VOLUME_BFPLANE),
        (e.stereoCam = new ae.StereoCamera()),
        (e.scene = new ae.Scene())
      var r = td()
      ;(e.scene.fog = new ae.Fog(r, Q.now.camNear, Q.now.camFar)),
        (e.root = new kr.RCGroup()),
        e.scene.add(e.root),
        (e.pivot = new kr.RCGroup()),
        e.root.add(e.pivot),
        (e.selectionScene = new ae.Scene()),
        (e.selectionRoot = new ae.Group()),
        (e.selectionRoot.matrixAutoUpdate = !1),
        e.selectionScene.add(e.selectionRoot),
        (e.selectionPivot = new ae.Group()),
        (e.selectionPivot.matrixAutoUpdate = !1),
        e.selectionRoot.add(e.selectionPivot)
      var n = new ae.DirectionalLight(16777215, 0.45)
      n.position.set(0, 0.414, 1),
        n.layers.enable(kr.LAYERS.TRANSPARENT),
        (n.castShadow = !0),
        (n.shadow.bias = 0.09),
        (n.shadow.radius = Q.now.shadow.radius),
        n.shadow.camera.layers.set(kr.LAYERS.SHADOWMAP)
      ;(t = e.renderer.getPixelRatio()), (r = Math.max(e.width, e.height) * t)
      ;(n.shadow.mapSize.width = r),
        (n.shadow.mapSize.height = r),
        n.target.position.set(0, 0, 0),
        e.scene.add(n),
        e.scene.add(n.target)
      n = new ae.AmbientLight(6710886)
      n.layers.enable(kr.LAYERS.TRANSPARENT),
        e.scene.add(n),
        (e.axes = new qh(e.root, e.camera))
      ;(n = e.width * t), (t = e.height * t)
      ;(e.offscreenBuf = new ae.WebGLRenderTarget(n, t, {
        minFilter: ae.LinearFilter,
        magFilter: ae.NearestFilter,
        format: ae.RGBAFormat,
        depthBuffer: !0
      })),
        e.renderer.getContext().getExtension('WEBGL_depth_texture') &&
          ((e.offscreenBuf.depthTexture = new ae.DepthTexture()),
          (e.offscreenBuf.depthTexture.type = ae.UnsignedShortType)),
        (e.offscreenBuf2 = new ae.WebGLRenderTarget(n, t, {
          minFilter: ae.LinearFilter,
          magFilter: ae.LinearFilter,
          format: ae.RGBAFormat,
          depthBuffer: !1
        })),
        (e.offscreenBuf3 = new ae.WebGLRenderTarget(n, t, {
          minFilter: ae.LinearFilter,
          magFilter: ae.LinearFilter,
          format: ae.RGBAFormat,
          depthBuffer: !1
        })),
        (e.offscreenBuf4 = new ae.WebGLRenderTarget(n, t, {
          minFilter: ae.LinearFilter,
          magFilter: ae.LinearFilter,
          format: ae.RGBAFormat,
          depthBuffer: !1
        })),
        (e.volBFTex = e.offscreenBuf3),
        (e.volFFTex = e.offscreenBuf4),
        (e.volWFFTex = e.offscreenBuf),
        e.renderer.getContext().getExtension('OES_texture_float')
          ? ((e.offscreenBuf5 = new ae.WebGLRenderTarget(n, t, {
              minFilter: ae.LinearFilter,
              magFilter: ae.LinearFilter,
              format: ae.RGBAFormat,
              type: ae.FloatType,
              depthBuffer: !1
            })),
            (e.offscreenBuf6 = new ae.WebGLRenderTarget(n, t, {
              minFilter: ae.LinearFilter,
              magFilter: ae.LinearFilter,
              format: ae.RGBAFormat,
              type: ae.FloatType,
              depthBuffer: !1
            })),
            (e.offscreenBuf7 = new ae.WebGLRenderTarget(n, t, {
              minFilter: ae.LinearFilter,
              magFilter: ae.LinearFilter,
              format: ae.RGBAFormat,
              type: ae.FloatType,
              depthBuffer: !0
            })),
            (e.volBFTex = e.offscreenBuf5),
            (e.volFFTex = e.offscreenBuf6),
            (e.volWFFTex = e.offscreenBuf7))
          : this.logger.warn(
              "Device doesn't support OES_texture_float extension"
            ),
        (e.stereoBufL = new ae.WebGLRenderTarget(n, t, {
          minFilter: ae.LinearFilter,
          magFilter: ae.LinearFilter,
          format: ae.RGBAFormat,
          depthBuffer: !1
        })),
        (e.stereoBufR = new ae.WebGLRenderTarget(n, t, {
          minFilter: ae.LinearFilter,
          magFilter: ae.LinearFilter,
          format: ae.RGBAFormat,
          depthBuffer: !1
        })),
        (this._gfx = e),
        this._showCanvas(),
        this._embedWebXR('WEBVR' === Q.now.stereo),
        this._container.appendChild(e.renderer2d.getElement())
      e = new v()
      ;(e.domElement.style.position = 'absolute'),
        (e.domElement.style.right = '0'),
        (e.domElement.style.bottom = '0'),
        this._container.appendChild(e.domElement),
        (this._fps = e),
        this._fps.show(Q.now.fps)
    }),
    (rd.prototype._initListeners = function () {
      var e = this
      window.addEventListener('resize', function () {
        e._onResize()
      })
    }),
    (rd.prototype._makeUniqueVisualName = function (e) {
      if (!e) return Math.random().toString()
      for (var t = e, r = 1; this._visuals.hasOwnProperty(t); )
        (t = ''.concat(e, ' (').concat(r.toString(), ')')), r++
      return t
    }),
    (rd.prototype._addVisual = function (e) {
      if (!e) return null
      var t = this._makeUniqueVisualName(e.name)
      return (
        (e.name = t),
        (this._visuals[t] = e),
        this._gfx.pivot.add(e),
        e.getSelectionGeo && this._gfx.selectionPivot.add(e.getSelectionGeo()),
        t
      )
    }),
    (rd.prototype._removeVisual = function (e) {
      var t = '',
        r = null
      e instanceof Mr
        ? ((t = e.name), (r = e))
        : 'string' == typeof e && (r = this._visuals[(t = e)]),
        r &&
          this._visuals.hasOwnProperty(t) &&
          this._visuals[t] === r &&
          (t === this._curVisualName && (this._curVisualName = void 0),
          delete this._visuals[t],
          r.release(),
          (this._needRender = !0))
    }),
    (rd.prototype._forEachVisual = function (e) {
      for (var t in this._visuals)
        this._visuals.hasOwnProperty(t) && e(this._visuals[t])
    }),
    (rd.prototype._releaseAllVisuals = function () {
      if (this._gfx && this._gfx.pivot) {
        for (var e in this._visuals)
          this._visuals.hasOwnProperty(e) && this._visuals[e].release()
        this._visuals = {}
      }
    }),
    (rd.prototype._forEachComplexVisual = function (e) {
      if (this._gfx && this._gfx.pivot)
        for (var t in this._visuals)
          this._visuals.hasOwnProperty(t) &&
            this._visuals[t] instanceof $a &&
            e(this._visuals[t])
    }),
    (rd.prototype._getComplexVisual = function (t) {
      t = t || this._curVisualName
      var r = null,
        n = null
      return (
        this._forEachComplexVisual(function (e) {
          ;(r = e).name === t && (n = e)
        }),
        n || r
      )
    }),
    (rd.prototype._getVolumeVisual = function () {
      var t = null
      return (
        this._forEachVisual(function (e) {
          e instanceof cl && (t = e)
        }),
        t
      )
    }),
    (rd.prototype._getVisualForComplex = function (t) {
      if (!t) return null
      var r = null
      return (
        this._forEachComplexVisual(function (e) {
          e.getComplex() === t && (r = e)
        }),
        r
      )
    }),
    (rd.prototype.getVisuals = function () {
      return Object.keys(this._visuals)
    }),
    (rd.prototype.getComplexVisualsCount = function () {
      var e = 0
      return (
        this._forEachComplexVisual(function () {
          return e++
        }),
        e
      )
    }),
    (rd.prototype.getCurrentVisual = function () {
      return this._curVisualName
    }),
    (rd.prototype.setCurrentVisual = function (e) {
      this._visuals[e] && (this._curVisualName = e)
    }),
    (rd.prototype.run = function () {
      var e = this
      this._running ||
        ((this._running = !0),
        this._halting
          ? (this._halting = !1)
          : (this._objectControls.enable(!0),
            this._interpolator.resume(),
            this._requestAnimationFrame(function () {
              return e._onTick()
            })))
    }),
    (rd.prototype.halt = function () {
      this._running &&
        (this._discardComponentEdit(),
        this._discardFragmentEdit(),
        this._objectControls.enable(!1),
        this._interpolator.pause(),
        (this._halting = !0))
    }),
    (rd.prototype.enableHotKeys = function (e) {
      ;(this._hotKeysEnabled = e), this._objectControls.enableHotkeys(e)
    }),
    (rd.prototype._onResize = function () {
      this._needRender = !0
      var e = this._gfx
      ;(e.width = this._container.clientWidth),
        (e.height = this._container.clientHeight),
        (e.camera.aspect = e.width / e.height),
        e.camera.setMinimalFov(Q.now.camFov),
        e.camera.updateProjectionMatrix(),
        e.renderer.setSize(e.width, e.height),
        e.renderer2d.setSize(e.width, e.height),
        this.dispatchEvent({ type: 'resize' })
    }),
    (rd.prototype._resizeOffscreenBuffers = function (e, t, r) {
      var n = this._gfx,
        i = 'NONE' === (r = r || 'NONE') || 'ANAGLYPH' === r,
        r = i ? 1 : 0.5
      n.offscreenBuf.setSize(r * e, t),
        n.offscreenBuf2.setSize(r * e, t),
        n.offscreenBuf3.setSize(r * e, t),
        n.offscreenBuf4.setSize(r * e, t),
        n.offscreenBuf5 && n.offscreenBuf5.setSize(r * e, t),
        n.offscreenBuf6 && n.offscreenBuf6.setSize(r * e, t),
        n.offscreenBuf7 && n.offscreenBuf7.setSize(r * e, t),
        i && (n.stereoBufL.setSize(e, t), n.stereoBufR.setSize(e, t))
    }),
    (rd.prototype._onTick = function () {
      var e = this
      if (this._halting) return (this._running = !1), void (this._halting = !1)
      this._fps.update(),
        this._requestAnimationFrame(function () {
          return e._onTick()
        }),
        this._onUpdate(),
        this._needRender &&
          (this._onRender(),
          (this._needRender = !Q.now.suspendRender || 'WEBVR' === Q.now.stereo))
    }),
    (rd.prototype._getBSphereRadius = function () {
      var t = 0
      return (
        this._forEachVisual(function (e) {
          t = Math.max(t, e.getBoundaries().boundingSphere.radius)
        }),
        t * this._objectControls.getScale()
      )
    }),
    (rd.prototype.getOBB =
      ((gf = new ae.Sphere()),
      (xf = new ae.Box3()),
      (bf = new ae.Box3()),
      (wf = new ae.Matrix4()),
      (Sf = [
        new ae.Vector3(),
        new ae.Vector3(),
        new ae.Vector3(),
        new ae.Vector3()
      ]),
      function (t, e) {
        bf.makeEmpty(),
          this._forEachVisual(function (e) {
            gf.copy(e.getBoundaries().boundingSphere),
              gf.applyMatrix4(e.matrixWorld).applyMatrix4(t),
              gf.getBoundingBox(xf),
              bf.union(xf)
          }),
          bf.getCenter(e.center),
          wf.copy(t).invert(),
          e.center.applyMatrix4(wf)
        var r = bf.min,
          n = bf.max
        Sf[0].set(r.x, r.y, r.z),
          Sf[1].set(n.x, r.y, r.z),
          Sf[2].set(r.x, n.y, r.z),
          Sf[3].set(r.x, r.y, n.z)
        for (var i = 0, o = Sf.length; i < o; i++) Sf[i].applyMatrix4(wf)
        e.halfSize
          .set(
            Math.abs(Sf[0].x - Sf[1].x),
            Math.abs(Sf[0].y - Sf[2].y),
            Math.abs(Sf[0].z - Sf[3].z)
          )
          .multiplyScalar(0.5)
      })),
    (rd.prototype._updateFog = function () {
      var e,
        t,
        r,
        n = this._gfx
      Q.now.fog
        ? ((void 0 !== n.scene.fog && null !== n.scene.fog) ||
            ((r = td()),
            (n.scene.fog = new ae.Fog(r)),
            this._setUberMaterialValues({ fog: Q.now.fog })),
          (e = n.scene.fog),
          (t = n.camera.position.z),
          (r = this._getBSphereRadius()),
          (e.near = t - r * Q.now.fogNearFactor),
          (e.far = t + r * Q.now.fogFarFactor))
        : n.scene.fog &&
          ((n.scene.fog = void 0),
          this._setUberMaterialValues({ fog: Q.now.fog }))
    }),
    (rd.prototype._onUpdate = function () {
      void 0 !== this.isScriptingCommandAvailable &&
        this.isScriptingCommandAvailable() &&
        !this._building &&
        this.callNextCmd(),
        this._objectControls.update(),
        this._forEachComplexVisual(function (e) {
          e.getComplex().update()
        }),
        Q.now.autobuild &&
          !this._loading.length &&
          !this._building &&
          this._needRebuild() &&
          this.rebuild(),
        this._loading.length ||
          this._building ||
          this._needRebuild() ||
          this._updateView(),
        this._updateFog(),
        this._gfx.renderer.xr.enabled && this.webVR.updateMoleculeScale()
    }),
    (rd.prototype._onRender = function () {
      var e = this._gfx
      e.scene.updateMatrixWorld(),
        e.camera.updateMatrixWorld(),
        this._clipPlaneUpdateValue(this._getBSphereRadius()),
        this._fogFarUpdateValue(),
        e.renderer.setRenderTarget(null),
        e.renderer.clear(),
        this._renderFrame(Q.now.stereo)
    }),
    (rd.prototype._renderFrame =
      ((Rf = new ls()),
      (Cf = new ae.Vector2()),
      function (e) {
        var t = this._gfx,
          r = t.renderer
        r.getSize(Cf),
          'NONE' !== e &&
            ((t.camera.focus = t.camera.position.z),
            (t.stereoCam.aspect = 1),
            'ANAGLYPH' === e
              ? t.stereoCam.update(t.camera)
              : t.stereoCam.updateHalfSized(t.camera, Q.now.camFov))
        var n = t.renderer.getPixelRatio()
        switch (
          (this._resizeOffscreenBuffers(Cf.width * n, Cf.height * n, e),
          this._renderShadowMap(),
          e)
        ) {
          case 'WEBVR':
          case 'NONE':
            this._renderScene(t.camera, !1)
            break
          case 'SIMPLE':
          case 'DISTORTED':
            r.setScissorTest(!0),
              r.setScissor(0, 0, Cf.width / 2, Cf.height),
              r.setViewport(0, 0, Cf.width / 2, Cf.height),
              this._renderScene(this._gfx.stereoCam.cameraL, 'DISTORTED' === e),
              r.setScissor(Cf.width / 2, 0, Cf.width / 2, Cf.height),
              r.setViewport(Cf.width / 2, 0, Cf.width / 2, Cf.height),
              this._renderScene(this._gfx.stereoCam.cameraR, 'DISTORTED' === e),
              r.setScissorTest(!1)
            break
          case 'ANAGLYPH':
            this._renderScene(this._gfx.stereoCam.cameraL, !1, t.stereoBufL),
              this._renderScene(this._gfx.stereoCam.cameraR, !1, t.stereoBufR),
              r.setRenderTarget(null),
              (Rf.uniforms.srcL.value = t.stereoBufL.texture),
              (Rf.uniforms.srcR.value = t.stereoBufR.texture),
              t.renderer.renderScreenQuad(Rf)
        }
        t.renderer2d.render(t.scene, t.camera),
          Q.now.axes && t.axes && !t.renderer.xr.enabled && t.axes.render(r)
      })),
    (rd.prototype._onBgColorChanged = function () {
      var e = this._gfx,
        t = td()
      e &&
        (e.scene.fog && e.scene.fog.color.set(t),
        e.renderer.setClearColor(
          Q.now.bg.color,
          Number(!Q.now.bg.transparent)
        )),
        (this._needRender = !0)
    }),
    (rd.prototype._onFogColorChanged = function () {
      var e = this._gfx,
        t = td()
      e && e.scene.fog && e.scene.fog.color.set(t), (this._needRender = !0)
    }),
    (rd.prototype._setUberMaterialValues = function (t) {
      this._gfx.root.traverse(function (e) {
        ;(e instanceof ae.Mesh ||
          e instanceof ae.LineSegments ||
          e instanceof ae.Line) &&
          e.material instanceof Ni &&
          (e.material.setValues(t), (e.material.needsUpdate = !0))
      })
    }),
    (rd.prototype._enableMRT = function (e, t, r) {
      var n = this._gfx,
        i = n.renderer.getContext(),
        o = i.getExtension('WEBGL_draw_buffers'),
        s = n.renderer.properties
      e
        ? (n.renderer.setRenderTarget(r),
          (r = s.get(r.texture).__webglTexture),
          i.bindTexture(i.TEXTURE_2D, r),
          n.renderer.setRenderTarget(t),
          (n = s.get(t).__webglFramebuffer),
          (s = s.get(t.texture).__webglTexture),
          i.bindFramebuffer(i.FRAMEBUFFER, n),
          (n.width = t.width),
          (n.height = t.height),
          i.framebufferTexture2D(
            i.FRAMEBUFFER,
            i.COLOR_ATTACHMENT0,
            i.TEXTURE_2D,
            s,
            0
          ),
          i.framebufferTexture2D(
            i.FRAMEBUFFER,
            o.COLOR_ATTACHMENT1_WEBGL,
            i.TEXTURE_2D,
            r,
            0
          ),
          o.drawBuffersWEBGL([i.COLOR_ATTACHMENT0, o.COLOR_ATTACHMENT1_WEBGL]))
        : o.drawBuffersWEBGL([i.COLOR_ATTACHMENT0, null])
    }),
    (rd.prototype._renderScene = function (e, t, r) {
      ;(t = t || !1), (r = r || null)
      var n,
        i,
        o,
        s,
        a,
        l,
        c,
        u = this._gfx
      u.renderer.setClearColor(Q.now.bg.color, Number(!Q.now.bg.transparent)),
        u.renderer.setRenderTarget(r),
        u.renderer.clear(),
        u.renderer.xr.enabled
          ? u.renderer.render(u.scene, e)
          : (u.renderer.setClearColor(0, 0),
            u.renderer.setRenderTarget(u.offscreenBuf4),
            u.renderer.clearColor(),
            u.renderer.setClearColor(
              Q.now.bg.color,
              Number(!Q.now.bg.transparent)
            ),
            u.renderer.setRenderTarget(u.offscreenBuf),
            u.renderer.clear(),
            (c = null !== this._getComplexVisual()),
            (n = this._getVolumeVisual()),
            (i = c && Q.now.ao) &&
              this._enableMRT(!0, u.offscreenBuf, u.offscreenBuf4),
            'prepass' === Q.now.transparency
              ? this._renderWithPrepassTransparency(e, u.offscreenBuf)
              : 'standard' === Q.now.transparency &&
                (u.renderer.setRenderTarget(u.offscreenBuf),
                u.renderer.render(u.scene, e)),
            i && this._enableMRT(!1, null, null),
            (o = c && Q.now.outline.on),
            (s = c && Q.now.fxaa),
            (a = null !== n && null != n.getMesh().material),
            (l = i || o || a || s || t ? u.offscreenBuf2 : r),
            (c = u.offscreenBuf),
            i
              ? (this._performAO(
                  c,
                  u.offscreenBuf4,
                  u.offscreenBuf.depthTexture,
                  l,
                  u.offscreenBuf3,
                  u.offscreenBuf2
                ),
                s ||
                  t ||
                  a ||
                  o ||
                  ((c = l),
                  (l = r),
                  u.renderer.setRenderTarget(l),
                  u.renderer.renderScreenQuadFromTex(c.texture, 1)))
              : (u.renderer.setRenderTarget(l),
                u.renderer.renderScreenQuadFromTex(c.texture, 1)),
            o &&
              ((c = l),
              (l = a || s || t ? u.offscreenBuf3 : r),
              null != c && this._renderOutline(e, u.offscreenBuf, c, l)),
            this._renderSelection(e, u.offscreenBuf, l),
            a &&
              (u.renderer.setRenderTarget(u.offscreenBuf),
              u.renderer.renderScreenQuadFromTex(l.texture, 1),
              (l = u.offscreenBuf),
              this._renderVolume(n, e, l, u.volBFTex, u.volFFTex, u.volWFFTex),
              s ||
                t ||
                (u.renderer.setRenderTarget(r),
                u.renderer.renderScreenQuadFromTex(l.texture, 1))),
            (c = l),
            s &&
              ((l = t ? u.offscreenBuf4 : r), this._performFXAA(c, l), (c = l)),
            t && ((l = r), this._performDistortion(c, l, !0)))
    }),
    (rd.prototype._performDistortion =
      ((Af = new ae.Scene()),
      (Ef = new ae.OrthographicCamera(-1, 1, 1, -1, -500, 1e3)),
      (kf = new ae.RawShaderMaterial({
        uniforms: {
          srcTex: { type: 't', value: null },
          aberration: { type: 'fv3', value: new ae.Vector3(1) }
        },
        vertexShader: yr,
        fragmentShader:
          'precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform vec3 aberration;\r\n\r\nvoid main() {\r\n  vec2 uv = vUv * 2.0 - 1.0;\r\n  \r\n  gl_FragColor.r = texture2D(srcTex, 0.5 * (uv * aberration[0] + 1.0)).r;\r\n  gl_FragColor.g = texture2D(srcTex, 0.5 * (uv * aberration[1] + 1.0)).g;\r\n  gl_FragColor.b = texture2D(srcTex, 0.5 * (uv * aberration[2] + 1.0)).b;\r\n  gl_FragColor.a = 1.0;\r\n}',
        transparent: !1,
        depthTest: !1,
        depthWrite: !1
      })),
      (bs = kr.buildDistorionMesh(10, 10, Q.now.debug.stereoBarrel)),
      Af.add(new Ji.Mesh(bs, kf)),
      function (e, t, r) {
        this._gfx.renderer.setRenderTarget(t),
          this._gfx.renderer.clear(),
          r
            ? ((kf.uniforms.srcTex.value = e.texture),
              kf.uniforms.aberration.value.set(0.995, 1, 1.01),
              this._gfx.renderer.render(Af, Ef))
            : this._gfx.renderer.renderScreenQuadFromTexWithDistortion(
                e,
                Q.now.debug.stereoBarrel
              )
      })),
    (rd.prototype._renderOutline =
      ((Tf = new No({ depth: !0 })),
      function (e, t, r, n) {
        var i = this._gfx
        ;(Tf.uniforms.srcTex.value = r.texture),
          (Tf.uniforms.srcDepthTex.value = t.depthTexture),
          Tf.uniforms.srcTexSize.value.set(t.width, t.height),
          (Tf.uniforms.color.value = new ae.Color(Q.now.outline.color)),
          (Tf.uniforms.threshold.value = Q.now.outline.threshold),
          (Tf.uniforms.thickness.value = new ae.Vector2(
            Q.now.outline.thickness,
            Q.now.outline.thickness
          )),
          i.renderer.setRenderTarget(n),
          i.renderer.renderScreenQuad(Tf)
      })),
    (rd.prototype._renderShadowMap =
      ((Pf = {
        minFilter: ae.NearestFilter,
        magFilter: ae.NearestFilter,
        format: ae.RGBAFormat
      }),
      function () {
        if (Q.now.shadow.on) {
          var e = this._gfx,
            t = e.renderer.getRenderTarget(),
            r = e.renderer.getActiveCubeFace(),
            n = e.renderer.getActiveMipmapLevel(),
            i = e.renderer.state
          i.setBlending(ae.NoBlending),
            i.buffers.color.setClear(1, 1, 1, 1),
            i.buffers.depth.setTest(!0),
            i.setScissorTest(!1)
          for (var o, s = 0; s < e.scene.children.length; s++)
            'DirectionalLight' === e.scene.children[s].type &&
              (null == (o = e.scene.children[s]).shadow.map &&
                ((o.shadow.map = new ae.WebGLRenderTarget(
                  o.shadow.mapSize.width,
                  o.shadow.mapSize.height,
                  Pf
                )),
                o.shadow.camera.updateProjectionMatrix()),
              o.shadow.updateMatrices(o),
              e.renderer.setRenderTarget(o.shadow.map),
              e.renderer.clear(),
              e.renderer.render(e.scene, o.shadow.camera))
          e.renderer.setRenderTarget(t, r, n)
        }
      })),
    (rd.prototype._hasSelectionToRender = function () {
      for (var e = this._gfx.selectionPivot, t = 0; t < e.children.length; t++)
        if (0 < e.children[t].children.length) return !0
      return !1
    }),
    (rd.prototype._renderSelection =
      ((Mf = new No()),
      function (e, t, r) {
        var n = this._gfx
        n.renderer.setClearColor('black', 0),
          n.renderer.setRenderTarget(t),
          n.renderer.clear(!0, !1, !1),
          this._hasSelectionToRender()
            ? ((n.selectionRoot.matrix = n.root.matrix),
              (n.selectionPivot.matrix = n.pivot.matrix),
              n.renderer.render(n.selectionScene, e))
            : n.renderer.renderDummyQuad(),
          n.renderer.setRenderTarget(r),
          n.renderer.renderScreenQuadFromTex(t.texture, 0.6),
          (Mf.uniforms.srcTex.value = t.texture),
          Mf.uniforms.srcTexSize.value.set(t.width, t.height),
          n.renderer.renderScreenQuad(Mf)
      })),
    (rd.prototype._checkVolumeRenderingSupport = function (e) {
      if (!e) return !1
      var t = this._gfx,
        r = t.renderer.getRenderTarget()
      t.renderer.setRenderTarget(e)
      var n = t.renderer.getContext(),
        e = n.checkFramebufferStatus(n.FRAMEBUFFER)
      return (
        t.renderer.setRenderTarget(r),
        e === n.FRAMEBUFFER_COMPLETE ||
          (this.logger.warn(
            "Device doesn't support electron density rendering"
          ),
          !1)
      )
    }),
    (rd.prototype._renderVolume =
      ((Lf = new nl.BackFacePosMaterial()),
      (If = new nl.FrontFacePosMaterial()),
      (Of = new ae.Matrix4().makeTranslation(0.5, 0.5, 0.5)),
      (Bf = new ae.Matrix4()),
      function (e, t, r, n, i, o) {
        var s = this._gfx
        ;(Nf = void 0 === Nf ? this._checkVolumeRenderingSupport(n) : Nf) &&
          ((e = e.getMesh()).rebuild(s.camera),
          s.renderer.setClearColor('black', 0),
          s.renderer.setRenderTarget(n),
          s.renderer.clear(),
          s.renderer.setRenderTarget(i),
          s.renderer.clear(),
          s.renderer.setRenderTarget(o),
          s.renderer.clear(),
          s.renderer.setRenderTarget(n),
          t.layers.set(kr.LAYERS.VOLUME_BFPLANE),
          s.renderer.render(s.scene, t),
          t.layers.set(kr.LAYERS.VOLUME),
          (s.scene.overrideMaterial = Lf),
          s.renderer.render(s.scene, t),
          s.renderer.setRenderTarget(i),
          t.layers.set(kr.LAYERS.VOLUME),
          (s.scene.overrideMaterial = If),
          s.renderer.render(s.scene, t),
          (s.scene.overrideMaterial = null),
          t.layers.set(kr.LAYERS.DEFAULT),
          Bf.copy(e.matrixWorld).invert(),
          Ni.prototype.uberOptions.world2colorMatrix.multiplyMatrices(Of, Bf),
          t.layers.set(kr.LAYERS.COLOR_FROM_POSITION),
          s.renderer.setRenderTarget(o),
          s.renderer.render(s.scene, t),
          ((e = e.material).uniforms._BFRight.value = n.texture),
          (e.uniforms._FFRight.value = i.texture),
          (e.uniforms._WFFRight.value = o.texture),
          t.layers.set(kr.LAYERS.VOLUME),
          s.renderer.setRenderTarget(r),
          s.renderer.render(s.scene, t),
          t.layers.set(kr.LAYERS.DEFAULT))
      })),
    (rd.prototype._renderWithPrepassTransparency = function (e, t) {
      var r = this._gfx
      r.renderer.setRenderTarget(t),
        e.layers.set(kr.LAYERS.DEFAULT),
        r.renderer.render(r.scene, e),
        e.layers.set(kr.LAYERS.PREPASS_TRANSPARENT),
        r.renderer.getContext().colorMask(!1, !1, !1, !1),
        r.renderer.render(r.scene, e),
        r.renderer.getContext().colorMask(!0, !0, !0, !0),
        e.layers.set(kr.LAYERS.TRANSPARENT),
        r.renderer.render(r.scene, e),
        e.layers.set(kr.LAYERS.DEFAULT)
    }),
    (rd.prototype._performFXAA =
      ((Vf = new Do()),
      function (e, t) {
        var r
        void 0 !== e &&
          void 0 !== t &&
          ((r = this._gfx).renderer.setClearColor(
            Q.now.bg.color,
            Number(!Q.now.bg.transparent)
          ),
          r.renderer.setRenderTarget(t),
          r.renderer.clear(),
          (Vf.uniforms.srcTex.value = e.texture),
          Vf.uniforms.srcTexelSize.value.set(1 / e.width, 1 / e.height),
          Vf.uniforms.bgColor.value.set(Q.now.bg.color),
          Vf.bgTransparent !== Q.now.bg.transparent &&
            (Vf.setValues({ bgTransparent: Q.now.bg.transparent }),
            (Vf.needsUpdate = !0)),
          r.renderer.renderScreenQuad(Vf))
      })),
    (rd.prototype._performAO =
      ((Df = new Uo()),
      (zf = new Ko()),
      (Ff = new Jo()),
      (Uf = new ae.Vector3()),
      function (e, t, r, n, i, o) {
        var s, a
        e &&
          t &&
          r &&
          n &&
          i &&
          o &&
          ((s = this._gfx),
          (a = Math.tan(0.5 * ae.MathUtils.DEG2RAD * s.camera.fov)),
          (Df.uniforms.diffuseTexture.value = e.texture),
          (Df.uniforms.depthTexture.value = r),
          (Df.uniforms.normalTexture.value = t.texture),
          Df.uniforms.srcTexelSize.value.set(1 / e.width, 1 / e.height),
          Df.uniforms.camNearFar.value.set(s.camera.near, s.camera.far),
          (Df.uniforms.projMatrix.value = s.camera.projectionMatrix),
          (Df.uniforms.aspectRatio.value = s.camera.aspect),
          (Df.uniforms.tanHalfFOV.value = a),
          s.root.matrix.extractScale(Uf),
          (Df.uniforms.kernelRadius.value =
            Q.now.debug.ssaoKernelRadius * Uf.x),
          (Df.uniforms.depthThreshold.value = 2 * this._getBSphereRadius()),
          (Df.uniforms.factor.value = Q.now.debug.ssaoFactor),
          s.renderer.setRenderTarget(o),
          s.renderer.renderScreenQuad(Df),
          (zf.uniforms.aoMap.value = o.texture),
          zf.uniforms.srcTexelSize.value.set(1 / o.width, 1 / o.height),
          (zf.uniforms.depthTexture.value = r),
          s.renderer.setRenderTarget(i),
          s.renderer.renderScreenQuad(zf),
          (Ff.uniforms.aoMap.value = i.texture),
          (Ff.uniforms.diffuseTexture.value = e.texture),
          Ff.uniforms.srcTexelSize.value.set(1 / i.width, 1 / i.height),
          (Ff.uniforms.depthTexture.value = r),
          (Ff.uniforms.projMatrix.value = s.camera.projectionMatrix),
          (Ff.uniforms.aspectRatio.value = s.camera.aspect),
          (Ff.uniforms.tanHalfFOV.value = a),
          (a = s.scene.fog) &&
            (Ff.uniforms.fogNearFar.value.set(a.near, a.far),
            Ff.uniforms.fogColor.value.set(
              a.color.r,
              a.color.g,
              a.color.b,
              Q.now.fogAlpha
            )),
          (Ff.useFog === Q.now.fog &&
            Ff.fogTransparent === Q.now.bg.transparent) ||
            (Ff.setValues({
              useFog: Q.now.fog,
              fogTransparent: Q.now.bg.transparent
            }),
            (Ff.needsUpdate = !0)),
          s.renderer.setRenderTarget(n),
          s.renderer.renderScreenQuad(Ff))
      })),
    (rd.prototype.reset = function () {
      this._picker && this._picker.reset(),
        (this._lastPick = null),
        this._releaseAllVisuals(),
        this._setEditMode(qf),
        this._resetObjects(),
        this._gfx &&
          (kr.clearTree(this._gfx.pivot), this._gfx.renderer2d.reset()),
        this.setNeedRender()
    }),
    (rd.prototype._resetScene = function () {
      this._objectControls.reset(),
        this._objectControls.allowTranslation(!0),
        this._objectControls.allowAltObjFreeRotation(!0),
        this.resetReps(),
        this.resetPivot(),
        this.rebuildAll()
    }),
    (rd.prototype.resetView = function () {
      this._picker && this._picker.reset(),
        this._setEditMode(qf),
        this._resetScene(),
        this._forEachComplexVisual(function (e) {
          e.updateSelectionMask({}), e.rebuildSelectionGeometry()
        })
    }),
    (rd.prototype._export = function (e) {
      var t = b.default.head(Oh.exporters.find({ format: e }))
      if (!t)
        return (
          this.logger.error('Could not find suitable exporter for this source'),
          Promise.reject(
            new Error('Could not find suitable exporter for this source')
          )
        )
      if (
        (this.dispatchEvent({ type: 'exporting' }),
        this._visuals[this._curVisualName] instanceof $a)
      ) {
        e = null
        return (
          t.SourceClass === $a
            ? (e = this._visuals[this._curVisualName])
            : t.SourceClass === lr &&
              (e = this._visuals[this._curVisualName]._complex),
          new t(e, { miewVersion: rd.VERSION }).export().then(function (e) {
            return e
          })
        )
      }
      return this._visuals[this._curVisualName] instanceof cl
        ? Promise.reject(
            new Error('Sorry, exporter for volume data not implemented yet')
          )
        : Promise.reject(new Error('Unexpected format of data'))
    })
  var sd,
    ad,
    ld,
    cd,
    ud,
    hd,
    fd = /^(?:(pdb|cif|mmtf|ccp4|dsn6):\s*)?(\d[a-z\d]{3})$/i,
    dd = /^(?:pc|pubchem):\s*([a-z]+)$/i,
    pd = /^([a-z][a-z\d\-+.]*):/i
  function md(f, d, p) {
    return new Promise(function (e) {
      if (p.shouldCancel()) throw new Error('Operation cancelled')
      p.notify({ type: 'fetching' }),
        (f = (function (e, t) {
          if (!b.default.isString(e)) return e
          if ((r = fd.exec(e))) {
            var r = m(r, 3),
              n = r[1],
              n = void 0 === n ? 'pdb' : n,
              i = r[2],
              n = n.toLowerCase(),
              i = i.toUpperCase()
            switch (n) {
              case 'pdb':
                e = 'https://files.rcsb.org/download/'.concat(i, '.pdb')
                break
              case 'cif':
                e = 'https://files.rcsb.org/download/'.concat(i, '.cif')
                break
              case 'mmtf':
                e = 'https://mmtf.rcsb.org/v1.0/full/'.concat(i)
                break
              case 'ccp4':
                e = 'https://www.ebi.ac.uk/pdbe/coordinates/files/'.concat(
                  i.toLowerCase(),
                  '.ccp4'
                )
                break
              case 'dsn6':
                e = 'https://edmaps.rcsb.org/maps/'.concat(
                  i.toLowerCase(),
                  '_2fofc.dsn6'
                )
                break
              default:
                throw new Error('Unexpected data format shortcut')
            }
            return (
              (t.fileType = n),
              (t.fileName = ''.concat(i, '.').concat(n)),
              (t.sourceType = 'url'),
              e
            )
          }
          if ((n = dd.exec(e))) {
            n = n[1].toLowerCase()
            return (
              (e =
                'https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/'.concat(
                  n,
                  '/JSON?record_type=3d'
                )),
              (t.fileType = 'pubchem'),
              (t.fileName = ''.concat(n, '.json')),
              (t.sourceType = 'url'),
              e
            )
          }
          return (
            ('url' !== t.sourceType && void 0 !== t.sourceType) ||
              ((t.sourceType = 'url'), pd.test(e) || (e = le.resolveURL(e))),
            e
          )
        })(f, d))
      var t = b.default.head(Oh.loaders.find({ type: d.sourceType, source: f }))
      if (!t) throw new Error(Kf)
      var r,
        n,
        i = d.fileName || t.extractName(f)
      i &&
        ((r = (n = m(le.splitFileName(i), 2))[0]),
        (n = n[1]),
        b.default.defaults(d, { name: r, fileExt: n, fileName: i })),
        (function (e) {
          var t = e.binary
          if (void 0 !== e.fileType) {
            var r = b.default.head(Oh.parsers.find({ format: e.fileType }))
            if (!r)
              throw new Error('Could not find suitable parser for this format')
            t = r.binary || !1
          }
          void 0 !== t ||
            void 0 === e.fileExt ||
            ((r = b.default.head(Oh.parsers.find({ ext: e.fileExt }))) &&
              (t = r.binary || !1)),
            void 0 !== e.fileExt &&
              '.man' === e.fileExt.toLowerCase() &&
              ((e.binary = !0), (e.animation = !0)),
            void 0 !== t &&
              void 0 !== e.binary &&
              e.binary !== t &&
              e.context.logger.warn('Overriding incorrect binary mode'),
            (e.binary = t || !1)
        })(d)
      var o = b.default.get(d, 'preset.expression')
      if (!b.default.isUndefined(o) && (o = JSON.parse(o)) && o.settings)
        for (var s = ['singleUnit'], a = 0, l = s.length; a < l; ++a) {
          var c = s[a],
            u = b.default.get(o.settings, c)
          b.default.isUndefined(u) || Q.set(c, u)
        }
      var h = new t(f, d)
      ;(h.context = d.context),
        p.addEventListener('cancel', function () {
          return h.abort()
        }),
        h.addEventListener('progress', function (e) {
          e.lengthComputable && 0 < e.total
            ? ed(h.logger, 'Fetching', e.loaded / e.total)
            : ed(h.logger, 'Fetching')
        }),
        e(
          h
            .load()
            .then(function (e) {
              return (
                d.context.logger.info('Fetching finished'),
                p.notify({ type: 'fetchingDone', data: e }),
                e
              )
            })
            .catch(function (e) {
              throw (
                (d.context.logger.debug(e.message),
                e.stack && d.context.logger.debug(e.stack),
                d.context.logger.error('Fetching failed'),
                p.notify({ type: 'fetchingDone', error: e }),
                e)
              )
            })
        )
    })
  }
  function yd(e, t) {
    return e.mask & (1 << t)
  }
  function _d(e, t) {
    return t.selector.includesAtom(e)
  }
  ;(rd.prototype.load = function (e, t) {
    var r = this
    ;(t = b.default.merge({}, t, { context: this })),
      this.settings.now.use.multiFile ||
        (this._loading.length &&
          (this._loading.forEach(function (e) {
            e.cancel()
          }),
          (this._loading.length = 0)),
        t.animation || this.reset(!0)),
      this._interpolator.reset(),
      this.dispatchEvent({ type: 'loading', options: t, source: e })
    var n = new $()
    this._loading.push(n),
      n.addEventListener('notification', function (e) {
        r.dispatchEvent(e.slaveEvent)
      }),
      this._spinner.spin(this._container)
    function i(e) {
      var t = r._loading.indexOf(n)
      return (
        -1 !== t && r._loading.splice(t, 1),
        r._spinner.stop(),
        r._refreshTitle(),
        n.notify({ type: 'loadingDone', anything: e }),
        e
      )
    }
    return md(e, t, n)
      .then(function (e) {
        return (function (e, t, r) {
          if (r.shouldCancel())
            return Promise.reject(new Error('Operation cancelled'))
          r.notify({ type: 'parsing' })
          var n = b.default.head(
            Oh.parsers.find({ format: t.fileType, ext: t.fileExt, data: e })
          )
          if (!n)
            return Promise.reject(new Error('Could not find suitable parser'))
          var i = new n(e, t)
          return (
            (i.context = t.context),
            r.addEventListener('cancel', function () {
              return i.abort()
            }),
            i
              .parse()
              .then(function (e) {
                return r.notify({ type: 'parsingDone', data: e }), e
              })
              .catch(function (e) {
                throw (
                  ((t.error = e),
                  t.context.logger.debug(e.message),
                  e.stack && t.context.logger.debug(e.stack),
                  t.context.logger.error('Parsing failed'),
                  r.notify({ type: 'parsingDone', error: e }),
                  e)
                )
              })
          )
        })(e, t, n)
      })
      .then(function (e) {
        e = r._onLoad(e, t)
        return i(e)
      })
      .catch(function (e) {
        throw (r.logger.error('Could not load data'), r.logger.debug(e), i(e))
      })
  }),
    (rd.prototype.unload = function (e) {
      this._removeVisual(e || this.getCurrentVisual()),
        this.resetPivot(),
        Q.now.shadow.on && this._updateShadowCamera()
    }),
    (rd.prototype._startAnimation = function (e) {
      this._stopAnimation()
      var t = this,
        r = this._getComplexVisual()
      if (null !== r) {
        try {
          this._frameInfo = new Qh(r.getComplex(), e, {
            onLoadStatusChanged: function () {
              t.dispatchEvent({
                type: 'mdPlayerStateChanged',
                state: {
                  isPlaying: t._isAnimating,
                  isLoading: !t._frameInfo || t._frameInfo.isLoading
                }
              })
            },
            onError: function (e) {
              t._stopAnimation(), t.logger.error(e)
            }
          })
        } catch (e) {
          return void this.logger.error(
            'Animation file does not fit to current complex!'
          )
        }
        this._continueAnimation()
      } else
        this.logger.error('Unable to start animation - no molecule is loaded.')
    }),
    (rd.prototype._pauseAnimation = function () {
      null !== this._animInterval &&
        ((this._isAnimating = !1),
        clearInterval(this._animInterval),
        (this._animInterval = null),
        this._frameInfo &&
          this.dispatchEvent({
            type: 'mdPlayerStateChanged',
            state: {
              isPlaying: this._isAnimating,
              isLoading: this._frameInfo.isLoading
            }
          }))
    }),
    (rd.prototype._continueAnimation = function () {
      this._isAnimating = !0
      var e = 1e3 / Q.now.maxfps,
        e = Number.isNaN(e) ? 0 : e,
        t = this,
        r = t._gfx.pivot,
        n = this._getComplexVisual()
      n &&
        (n.resetSelectionMask(),
        n.rebuildSelectionGeometry(),
        (this._msgAtomInfo.style.opacity = 0)),
        (this._animInterval = setInterval(function () {
          if (
            (t.dispatchEvent({
              type: 'mdPlayerStateChanged',
              state: {
                isPlaying: t._isAnimating,
                isLoading: t._frameInfo.isLoading
              }
            }),
            t._frameInfo.frameIsReady)
          ) {
            r.updateToFrame(t._frameInfo),
              t._updateObjsToFrame(t._frameInfo),
              t._refreshTitle(
                ' Frame '
                  .concat(t._frameInfo._currFrame, ' of ')
                  .concat(t._frameInfo._framesCount, ' time interval - ')
                  .concat(t._frameInfo._timeStep)
              )
            try {
              t._frameInfo.nextFrame()
            } catch (e) {
              return (
                t.logger.error('Error during animation'),
                void t._stopAnimation()
              )
            }
            t._needRender = !0
          }
        }, e))
    }),
    (rd.prototype._stopAnimation = function () {
      null !== this._animInterval &&
        (clearInterval(this._animInterval),
        this._frameInfo.disableEvents(),
        (this._frameInfo = null),
        (this._animInterval = null),
        this.dispatchEvent({ type: 'mdPlayerStateChanged', state: null }))
    }),
    (rd.prototype._onLoad = function (e, t) {
      var r,
        n = this._gfx,
        i = null
      if (t.animation)
        return this._refreshTitle(), this._startAnimation(e), null
      if (
        (this._stopAnimation(),
        (t && t.keepRepsInfo) ||
          ((this._opts.reps = null), (this._opts._objects = null)),
        'Complex' === e.id)
      ) {
        var o = e
        t.fileName
          ? (o.name = o.name || Jf(t.fileName).toUpperCase())
          : t.amberFileName
          ? (o.name = o.name || Jf(t.amberFileName).toUpperCase())
          : (o.name = 'Dynamic '.concat(t.fileType, ' molecule')),
          (i = this._addVisual(new $a(o.name, o))),
          (this._curVisualName = i)
        var s = this.info()
        if (
          (this.logger.info(
            'Parsed '
              .concat(t.fileName, ' (')
              .concat(s.atoms, ' atoms, ')
              .concat(s.bonds, ' bonds, ')
              .concat(s.residues, ' residues, ')
              .concat(s.chains, ' chains).')
          ),
          b.default.isNumber(this._opts.unit) &&
            o.setCurrentUnit(this._opts.unit),
          !t.preset)
        )
          if (Q.now.autoPreset)
            switch (t.fileType) {
              case 'cml':
                this.resetReps('small')
                break
              case 'pdb':
              case 'mmtf':
              case 'cif':
                ;(r = !1),
                  o.forEachComponent(function (e) {
                    e.forEachResidue(function (e) {
                      e._isValid && (r = !0)
                    })
                  }),
                  r ? this.resetReps('macro') : this.resetReps('small')
                break
              default:
                this.resetReps('default')
            }
          else this.resetReps('default')
      } else 'Volume' === e.id && (this.resetEd(), (i = this._onLoadEd(e)))
      return (
        n.camera.updateProjectionMatrix(),
        this._updateFog(),
        n.root.resetTransform(),
        this.resetPivot(),
        this._objectControls.setScale(
          Q.now.radiusToFit / this._getBSphereRadius()
        ),
        this._resetObjects(),
        Q.now.autoResolution && this._tweakResolution(),
        Q.now.shadow.on && this._updateShadowCamera(),
        this._opts.view && (this.view(this._opts.view), delete this._opts.view),
        this._refreshTitle(),
        i
      )
    }),
    (rd.prototype.resetEd = function () {
      this._edLoader && (this._edLoader.abort(), (this._edLoader = null)),
        this._removeVisual(this._getVolumeVisual()),
        (this._needRender = !0)
    }),
    (rd.prototype.loadEd = function (e) {
      var r = this
      this.resetEd()
      var t = b.default.head(Oh.loaders.find({ source: e }))
      if (!t) return this.logger.error(Kf), Promise.reject(new Error(Kf))
      e = this._edLoader = new t(e, { binary: !0 })
      return (
        (e.context = this),
        e
          .load()
          .then(function (e) {
            var t = b.default.head(Oh.parsers.find({ format: 'ccp4' }))
            if (!t)
              throw new Error('Could not find suitable parser for this source')
            e = new t(e)
            return (
              (e.context = r),
              e.parse().then(function (e) {
                r._onLoadEd(e)
              })
            )
          })
          .catch(function (e) {
            r.logger.error('Could not load ED data'), r.logger.debug(e)
          })
      )
    }),
    (rd.prototype._onLoadEd = function (e) {
      e.normalize()
      e = new cl('volume', e)
      e.getMesh().layers.set(kr.LAYERS.VOLUME)
      e = this._addVisual(e)
      return (this._needRender = !0), e
    }),
    (rd.prototype._needRebuild = function () {
      var t = !1
      return (
        this._forEachComplexVisual(function (e) {
          t = t || e.needsRebuild()
        }),
        t
      )
    }),
    (rd.prototype._rebuildObjects = function () {
      for (
        var r, n = this, i = this._gfx, e = [], o = 0;
        o < i.pivot.children.length;
        ++o
      ) {
        var t = i.pivot.children[o]
        t instanceof Mr || e.push(t)
      }
      for (o = 0; o < e.length; ++o) e[o].parent.remove(e[o])
      setTimeout(function () {
        var e = n._objects
        for (o = 0, r = e.length; o < r; ++o) {
          var t = e[o]
          t.needsRebuild && t.build(),
            t.getGeometry() && i.pivot.add(t.getGeometry())
        }
      }, 10)
    }),
    (rd.prototype.changeUnit = function (e, t) {
      var r = this._getComplexVisual(t)
      if (!r) throw new Error('There is no complex to change!')
      function n() {
        var e = r ? r.getComplex().getCurrentUnit() : 0,
          t = 0 < e ? 'Bio molecule '.concat(e) : 'Asymmetric unit'
        return 'Current unit: '.concat(e, ' (').concat(t, ')')
      }
      return (
        void 0 === e ||
          (b.default.isString(e) && (e = Math.max(parseInt(e, 10), 0)),
          r.getComplex().setCurrentUnit(e) &&
            (this._resetScene(), this._updateInfoPanel())),
        n()
      )
    }),
    (rd.prototype.rebuild = function () {
      var e,
        t,
        r = this
      this._building
        ? this.logger.warn('Miew.rebuild(): already building!')
        : ((this._building = !0),
          this.dispatchEvent({ type: 'rebuilding' }),
          this._rebuildObjects(),
          this._gfx.renderer2d.reset(),
          (e = []),
          this._forEachComplexVisual(function (t) {
            t.needsRebuild() &&
              e.push(
                t.rebuild().then(function () {
                  return new Promise(function (e) {
                    t.rebuildSelectionGeometry(), e()
                  })
                })
              )
          }),
          (t = this)._spinner.spin(this._container),
          Promise.all(e).then(function () {
            t._spinner.stop(),
              (t._needRender = !0),
              t._refreshTitle(),
              r.dispatchEvent({ type: 'buildingDone' }),
              (t._building = !1)
          }))
    }),
    (rd.prototype.rebuildAll = function () {
      this._forEachComplexVisual(function (e) {
        e.setNeedsRebuild()
      })
    }),
    (rd.prototype._refreshTitle = function (e) {
      e = void 0 === e ? '' : e
      var t,
        r = this._getComplexVisual()
      r
        ? ((t = r.getComplex().name),
          (t += (r = r.repGet(r.repCurrent()))
            ? '  '.concat(r.mode.name, ' Mode')
            : ''))
        : (t = 0 < Object.keys(this._visuals).length ? 'Unknown' : 'No Data'),
        this.dispatchEvent({ type: 'titleChanged', data: (t += e) })
    }),
    (rd.prototype.setNeedRender = function () {
      this._needRender = !0
    }),
    (rd.prototype._extractRepresentation = function () {
      var n = this,
        i = []
      this._forEachComplexVisual(function (e) {
        var t, r
        0 !== e.getSelectionCount() &&
          ((t = e.buildSelectorFromMask(1 << e.getSelectionBit())),
          (r = Q.now.presets.default),
          (r = e.repAdd({
            selector: t,
            mode: r[0].mode.id,
            colorer: r[0].colorer.id,
            material: r[0].material.id
          }))
            ? (n.dispatchEvent({
                type: 'repAdded',
                index: r.index,
                name: e.name
              }),
              e.repCurrent(r.index),
              i.push(e.name))
            : e.repCount() === $a.NUM_REPRESENTATION_BITS &&
              n.logger.warn(
                'Number of representations is limited to '.concat(
                  $a.NUM_REPRESENTATION_BITS
                )
              ))
      }),
        0 < i.length &&
          this.logger.report(
            'New representation from selection for complexes: '.concat(
              i.join(', ')
            )
          )
    }),
    (rd.prototype._setReps = function (t) {
      ;(t = t || (this._opts && this._opts.reps) || []),
        this._forEachComplexVisual(function (e) {
          return e.resetReps(t)
        })
    }),
    (rd.prototype.applyPreset = function (e) {
      for (
        var t = Q.now.presets,
          r = [e || Q.defaults.preset, Q.defaults.preset, Object.keys(t)[0]],
          n = null,
          i = 0;
        !n && i < r.length;
        ++i
      )
        Q.set('preset', r[i]),
          (n = t[Q.now.preset]) ||
            this.logger.warn('Unknown preset "'.concat(Q.now.preset, '"'))
      this._setReps(n)
    }),
    (rd.prototype.resetReps = function (e) {
      var t = this._opts && this._opts.reps
      t ? this._setReps(t) : this.applyPreset(e)
    }),
    (rd.prototype.repCount = function (e) {
      e = this._getComplexVisual(e)
      return e ? e.repCount() : 0
    }),
    (rd.prototype.repCurrent = function (e, t) {
      ;(t = this._getComplexVisual(t)), (t = t ? t.repCurrent(e) : -1)
      return (
        e &&
          t !== e &&
          this.logger.warn(
            'Representation '.concat(
              e,
              ' was not found. Current rep remains unchanged.'
            )
          ),
        t
      )
    }),
    (rd.prototype.rep = function (e, t) {
      var r = this._getComplexVisual('')
      if (!r) return null
      t = r.rep(e, t)
      return (
        'created' === t.status
          ? this.dispatchEvent({
              type: 'repAdded',
              index: t.index,
              name: r.name
            })
          : 'changed' === t.status &&
            this.dispatchEvent({
              type: 'repChanged',
              index: t.index,
              name: r.name
            }),
        t.desc
      )
    }),
    (rd.prototype.repGet = function (e, t) {
      t = this._getComplexVisual(t)
      return t ? t.repGet(e) : null
    }),
    (rd.prototype.repAdd = function (e, t) {
      var r = this._getComplexVisual(t)
      if (!r) return -1
      e = r.repAdd(e)
      return e
        ? (this.dispatchEvent({ type: 'repAdded', index: e.index, name: t }),
          e.index)
        : -1
    }),
    (rd.prototype.repRemove = function (e, t) {
      var r = this._getComplexVisual(t)
      r &&
        (r.repRemove(e),
        this.dispatchEvent({ type: 'repRemoved', index: e, name: t }))
    }),
    (rd.prototype.repHide = function (e, t, r) {
      this._needRender = !0
      r = this._getComplexVisual(r)
      return r ? r.repHide(e, t) : null
    }),
    (rd.prototype._setEditMode = function (e) {
      this._editMode = e
      var t = this._msgMode
      t &&
        ((t.style.opacity = e === qf ? 0 : 1),
        e !== qf &&
          (t.getElementsByTagName('p')[0].innerHTML =
            e === $f ? 'COMPONENT EDIT MODE' : 'FRAGMENT EDIT MODE')),
        this.dispatchEvent({ type: 'editModeChanged', data: e === qf })
    }),
    (rd.prototype._enterComponentEditMode = function () {
      var t
      this._editMode === qf &&
        ((t = []),
        this._forEachComplexVisual(function (e) {
          e = e.beginComponentEdit()
          e && t.push(e)
        }),
        t !== [] &&
          ((this._editors = t),
          this.logger.info('COMPONENT EDIT MODE -- ON'),
          this._setEditMode($f),
          this._objectControls.keysTranslateObj(!0)))
    }),
    (rd.prototype._applyComponentEdit = function () {
      if (this._editMode === $f) {
        this._objectControls.stop(), this._objectControls.keysTranslateObj(!1)
        for (var e = 0; e < this._editors.length; ++e) this._editors[e].apply()
        ;(this._editors = []),
          this.logger.info('COMPONENT EDIT MODE -- OFF (applied)'),
          this._setEditMode(qf),
          this.rebuildAll()
      }
    }),
    (rd.prototype._discardComponentEdit = function () {
      if (this._editMode === $f) {
        this._objectControls.stop(), this._objectControls.keysTranslateObj(!1)
        for (var e = 0; e < this._editors.length; ++e)
          this._editors[e].discard()
        ;(this._editors = []),
          this.logger.info('COMPONENT EDIT MODE -- OFF (discarded)'),
          this._setEditMode(qf),
          (this._needRender = !0),
          this.rebuildAll()
      }
    }),
    (rd.prototype._enterFragmentEditMode = function () {
      var t, e
      this._editMode === qf &&
        ((t = []),
        this._forEachComplexVisual(function (e) {
          e instanceof $a && 0 < e.getSelectionCount() && t.push(e)
        }),
        1 !== t.length ||
          ((e = t[0].beginFragmentEdit()) &&
            ((this._editors = [e]),
            this.logger.info('FRAGMENT EDIT MODE -- ON (single bond)'),
            this._setEditMode(Zf),
            this._objectControls.allowTranslation(!1),
            this._objectControls.allowAltObjFreeRotation(
              e.isFreeRotationAllowed()
            ),
            (this._needRender = !0))))
    }),
    (rd.prototype._applyFragmentEdit = function () {
      if (this._editMode === Zf) {
        this._objectControls.stop()
        for (var e = 0; e < this._editors.length; ++e) this._editors[e].apply()
        ;(this._editors = []),
          this.logger.info('FRAGMENT EDIT MODE -- OFF (applied)'),
          this._setEditMode(qf),
          this._objectControls.allowTranslation(!0),
          this._objectControls.allowAltObjFreeRotation(!0),
          this.rebuildAll()
      }
    }),
    (rd.prototype._discardFragmentEdit = function () {
      if (this._editMode === Zf) {
        this._objectControls.stop()
        for (var e = 0; e < this._editors.length; ++e)
          this._editors[e].discard()
        ;(this._editors = []),
          this.logger.info('FRAGMENT EDIT MODE -- OFF (discarded)'),
          this._setEditMode(qf),
          this._objectControls.allowTranslation(!0),
          this._objectControls.allowAltObjFreeRotation(!0),
          (this._needRender = !0)
      }
    }),
    (rd.prototype._onPick = function (t) {
      var e
      function r(e) {
        e.updateSelectionMask(t.obj), e.rebuildSelectionGeometry()
      }
      Q.now.picking &&
        null === this._animInterval &&
        this._editMode !== Zf &&
        (this._objectControls.isEditingAltObj() ||
          ((e = null),
          t.obj.atom
            ? ((e = t.obj.atom.residue.getChain().getComplex()),
              (this._lastPick = t.obj.atom))
            : t.obj.residue
            ? ((e = t.obj.residue.getChain().getComplex()),
              (this._lastPick = t.obj.residue))
            : t.obj.chain
            ? ((e = t.obj.chain.getComplex()), (this._lastPick = t.obj.chain))
            : t.obj.molecule
            ? ((e = t.obj.molecule.complex), (this._lastPick = t.obj.molecule))
            : (this._lastPick = null),
          e
            ? (e = this._getVisualForComplex(e)) &&
              (r(e), (this._needRender = !0))
            : (this._forEachComplexVisual(r), (this._needRender = !0)),
          this._updateInfoPanel(),
          this.dispatchEvent(t)))
    }),
    (rd.prototype._onKeyDown = function (e) {
      if (this._running && this._hotKeysEnabled)
        switch (e.keyCode) {
          case 'C'.charCodeAt(0):
            Q.now.editing && this._enterComponentEditMode()
            break
          case 'F'.charCodeAt(0):
            Q.now.editing && this._enterFragmentEditMode()
            break
          case 'A'.charCodeAt(0):
            switch (this._editMode) {
              case $f:
                this._applyComponentEdit()
                break
              case Zf:
                this._applyFragmentEdit()
            }
            break
          case 'D'.charCodeAt(0):
            switch (this._editMode) {
              case $f:
                this._discardComponentEdit()
                break
              case Zf:
                this._discardFragmentEdit()
            }
            break
          case 'S'.charCodeAt(0):
            e.preventDefault(),
              e.stopPropagation(),
              Q.set('ao', !Q.now.ao),
              (this._needRender = !0)
            break
          case 107:
            e.preventDefault(),
              e.stopPropagation(),
              this._forEachComplexVisual(function (e) {
                e.expandSelection(), e.rebuildSelectionGeometry()
              }),
              this._updateInfoPanel(),
              (this._needRender = !0)
            break
          case 109:
            e.preventDefault(),
              e.stopPropagation(),
              this._forEachComplexVisual(function (e) {
                e.shrinkSelection(), e.rebuildSelectionGeometry()
              }),
              this._updateInfoPanel(),
              (this._needRender = !0)
        }
    }),
    (rd.prototype._onKeyUp = function (e) {
      this._running &&
        this._hotKeysEnabled &&
        e.keyCode === 'X'.charCodeAt(0) &&
        this._extractRepresentation()
    }),
    (rd.prototype._updateInfoPanel = function () {
      var e,
        t,
        r,
        n,
        i,
        o,
        s,
        a = this._msgAtomInfo.getElementsByTagName('p')[0],
        l = 0
      for (
        this._forEachComplexVisual(function (e) {
          l += e.getSelectionCount()
        });
        a.firstChild;

      )
        a.removeChild(a.firstChild)
      0 !== l
        ? ((e = ''
            .concat(String(l), ' atom')
            .concat(1 !== l ? 's' : '', ' selected')),
          null !== this._lastPick && (e += ', the last pick:'),
          (t = i = s = ''),
          this._lastPick instanceof Hf
            ? ((n = (r = this._lastPick).residue),
              (i = r.name),
              (o = 32 !== r.location ? String.fromCharCode(r.location) : ''),
              (s = ''
                .concat(r.element.fullName, ' #')
                .concat(r.serial)
                .concat(o, ':       ')
                .concat(n._chain._name, '.')
                .concat(n._type._name)
                .concat(n._sequence)
                .concat(n._icode.trim(), '.')),
              (s += i),
              (t = 'Coord: ('
                .concat(r.position.x.toFixed(2).toString(), ',     ')
                .concat(r.position.y.toFixed(2).toString(), ',     ')
                .concat(r.position.z.toFixed(2).toString(), ')')))
            : this._lastPick instanceof Wf
            ? ((n = this._lastPick),
              (s = ''
                .concat(n._type._fullName, ':       ')
                .concat(n._chain._name, '.')
                .concat(n._type._name)
                .concat(n._sequence)
                .concat(n._icode.trim())))
            : this._lastPick instanceof Yf
            ? (s = 'chain '.concat(this._lastPick._name))
            : this._lastPick instanceof Xf &&
              (s = 'molecule '.concat(this._lastPick._name)),
          a.appendChild(document.createTextNode(e)),
          '' !== s &&
            (a.appendChild(document.createElement('br')),
            a.appendChild(document.createTextNode(s))),
          '' !== t &&
            (a.appendChild(document.createElement('br')),
            a.appendChild(document.createTextNode(t))),
          (this._msgAtomInfo.style.opacity = 1))
        : (this._msgAtomInfo.style.opacity = 0)
    }),
    (rd.prototype._getAltObj = function () {
      if (this._editors) {
        for (var e = null, t = 0; t < this._editors.length; ++t) {
          var r = this._editors[t].getAltObj()
          if (0 < r.objects.length) {
            if (e) {
              e = null
              break
            }
            e = r
          }
        }
        if (e) return e
      }
      return { objects: [], pivot: new ae.Vector3(0, 0, 0) }
    }),
    (rd.prototype.resetPivot =
      ((sd = new ae.Box3()),
      (ad = new ae.Vector3()),
      function () {
        sd.makeEmpty(),
          this._forEachVisual(function (e) {
            sd.union(e.getBoundaries().boundingBox)
          }),
          sd.getCenter(ad),
          this._objectControls.setPivot(ad.negate()),
          this.dispatchEvent({ type: 'transform' })
      })),
    (rd.prototype.setPivotResidue =
      ((ld = new ae.Vector3()),
      function (e) {
        var t = this._getVisualForComplex(e.getChain().getComplex())
        if (t) {
          if (e._controlPoint) ld.copy(e._controlPoint)
          else {
            for (
              var r = 0, n = 0, i = 0, o = e._atoms.length, s = 0;
              s < o;
              ++s
            ) {
              var a = e._atoms[s].position
              ;(r += a.x / o), (n += a.y / o), (i += a.z / o)
            }
            ld.set(r, n, i)
          }
          ld.applyMatrix4(t.matrix).negate(),
            this._objectControls.setPivot(ld),
            this.dispatchEvent({ type: 'transform' })
        }
      })),
    (rd.prototype.setPivotAtom =
      ((cd = new ae.Vector3()),
      function (e) {
        var t = this._getVisualForComplex(e.residue.getChain().getComplex())
        t &&
          (cd.copy(e.position),
          cd.applyMatrix4(t.matrix).negate(),
          this._objectControls.setPivot(cd),
          this.dispatchEvent({ type: 'transform' }))
      })),
    (rd.prototype.getSelectionCenter =
      ((ud = new ae.Vector3(0, 0, 0)),
      function (t, r, n) {
        t.set(0, 0, 0)
        var i = 0
        return (
          this._forEachComplexVisual(function (e) {
            e.getSelectionCenter(ud, r, n || e.getSelectionBit()) &&
              (t.add(ud), i++)
          }),
          0 !== i && (t.divideScalar(i), t.negate(), !0)
        )
      })),
    (rd.prototype.setPivotSubset =
      ((hd = new ae.Vector3(0, 0, 0)),
      function (e) {
        this.getSelectionCenter(hd, e ? _d : yd, e)
          ? (this._objectControls.setPivot(hd),
            this.dispatchEvent({ type: 'transform' }))
          : this.logger.warn(
              'selection is empty. Center operation not performed'
            )
      })),
    (rd.prototype.screenshot = function (r, n) {
      var e,
        t,
        i,
        o,
        s,
        a = this._gfx,
        l = a.renderer.domElement.width,
        c = a.renderer.domElement.height
      function u() {
        var e,
          t =
            le.getBrowser() === le.browserType.SAFARI
              ? ((e = (t = document.createElement('canvas')).getContext('2d')),
                (t.width = void 0 === r ? l : r),
                (t.height = void 0 === n ? c : n),
                e.drawImage(a.renderer.domElement, 0, 0, t.width, t.height),
                t.toDataURL('image/png'))
              : a.renderer.domElement.toDataURL('image/png')
        return t
      }
      return (
        (n = n || r),
        (void 0 === r && void 0 === n) || (r === l && n === c)
          ? (e = u())
          : ((t = a.camera.aspect),
            (i = a.camera.fov),
            (o =
              (((s = a.camera.fov), Math.tan(ae.MathUtils.degToRad(0.5 * s))) *
                Math.min(a.width, a.height)) /
              a.height),
            (s = r / n),
            a.renderer.setPixelRatio(1),
            (a.camera.aspect = s),
            (a.camera.fov =
              ((s = o / Math.min(s, 1)),
              2 * ae.MathUtils.radToDeg(Math.atan(s)))),
            a.camera.updateProjectionMatrix(),
            a.renderer.setDrawingBufferSize(r, n, 1),
            this._renderFrame(Q.now.stereo),
            (e = u()),
            a.renderer.setPixelRatio(window.devicePixelRatio),
            (a.camera.aspect = t),
            (a.camera.fov = i),
            a.camera.updateProjectionMatrix(),
            a.renderer.setDrawingBufferSize(
              a.width,
              a.height,
              window.devicePixelRatio
            ),
            (this._needRender = !0)),
        e
      )
    }),
    (rd.prototype.screenshotSave = function (e, t, r) {
      r = this.screenshot(t, r)
      le.shotDownload(r, e)
    }),
    (rd.prototype.save = function (r) {
      var n = this
      this._export(r.fileType)
        .then(function (e) {
          var t = n._visuals[n._curVisualName]._complex.name
          le.download(e, t, r.fileType),
            n._refreshTitle(),
            n.dispatchEvent({ type: 'exportingDone' })
        })
        .catch(function (e) {
          n.logger.error('Could not export data'),
            n.logger.debug(e),
            n._refreshTitle(),
            n.dispatchEvent({ type: 'exportingDone', error: e })
        })
    }),
    (rd.prototype._tweakResolution = function () {
      var e = [
          ['poor', 100],
          ['low', 500],
          ['medium', 1e3],
          ['high', 5e3],
          ['ultra', Number.MAX_VALUE]
        ],
        t = 0
      if (
        (this._forEachComplexVisual(function (e) {
          t += e.getComplex().getAtomCount()
        }),
        0 < t)
      )
        for (var r = (1e6 * this._gfxScore) / t, n = 0; n < e.length; ++n)
          if (r < e[n][1]) {
            this._autoChangeResolution(e[n][0])
            break
          }
    }),
    (rd.prototype._autoChangeResolution = function (e) {
      e !== Q.now.resolution &&
        this.logger.report(
          'Your rendering resolution was changed to "'.concat(
            e,
            '" for best performance.'
          )
        ),
        (Q.now.resolution = e)
    }),
    (rd.prototype.saveSettings = function () {
      this._cookies.setCookie(
        this._opts.settingsCookie,
        JSON.stringify(this.settings.getDiffs(!0))
      )
    }),
    (rd.prototype.restoreSettings = function () {
      try {
        var e = this._cookies.getCookie(this._opts.settingsCookie),
          t = e ? JSON.parse(e) : {}
        this.settings.applyDiffs(t, !0)
      } catch (e) {
        this.logger.error('Cookies parse error: '.concat(e.message))
      }
    }),
    (rd.prototype.resetSettings = function () {
      this.settings.reset()
    }),
    (rd.prototype.setOptions = function (e) {
      ;(e = 'string' == typeof e ? rd.options.fromAttr(e) : e).reps &&
        (this._opts.reps = null),
        b.default.merge(this._opts, e),
        e.settings && this.set(e.settings),
        (this._opts._objects = e._objects),
        this._resetObjects(),
        e.load && this.load(e.load, { fileType: e.type }),
        e.preset && (Q.now.preset = e.preset),
        e.reps && this.resetReps(e.preset),
        this._opts.view && (this.view(this._opts.view), delete this._opts.view)
      var t = this._getComplexVisual()
      t &&
        (t.getComplex().resetCurrentUnit(),
        b.default.isNumber(e.unit) && t.getComplex().setCurrentUnit(e.unit),
        this.resetView(),
        this.rebuildAll())
    }),
    (rd.prototype.info = function (e) {
      var t = this._getComplexVisual(e)
      if (!t) return {}
      ;(e = t.getComplex()), (t = e.metadata)
      return {
        id: t.id || e.name || 'UNKNOWN',
        title: (t.title && t.title.join(' ')) || 'UNKNOWN DATA',
        atoms: e.getAtomCount(),
        bonds: e.getBondCount(),
        residues: e.getResidueCount(),
        chains: e.getChainCount()
      }
    }),
    (rd.prototype.addObject = function (e, t) {
      var r = null
      if (null === (r = e.type === tf.prototype.type ? tf : r))
        throw new Error('Unknown scene object type - '.concat(e.type))
      try {
        var n = new r(e.params, e.opts)
        this._addSceneObject(n)
      } catch (e) {
        if (t) throw e
        this.logger.debug(
          'Error during scene object creation: '.concat(e.message)
        )
      }
      this._needRender = !0
    }),
    (rd.prototype._addSceneObject = function (e) {
      var t = this._getComplexVisual()
      e.build &&
        t &&
        (e.build(t.getComplex()), this._gfx.pivot.add(e.getGeometry()))
      t = this._objects
      t[t.length] = e
    }),
    (rd.prototype._updateObjsToFrame = function (e) {
      for (var t = this._objects, r = 0, n = t.length; r < n; ++r)
        t[r].updateToFrame && t[r].updateToFrame(e)
    }),
    (rd.prototype._resetObjects = function () {
      var e = this._opts._objects
      if (((this._objects = []), e))
        for (var t = 0, r = e.length; t < r; ++t) this.addObject(e[t], !1)
    }),
    (rd.prototype.removeObject = function (e) {
      var t = this._objects[e]
      if (!t)
        throw new Error('Scene object with index '.concat(e, ' does not exist'))
      t.destroy(), this._objects.splice(e, 1), (this._needRender = !0)
    }),
    (rd.prototype.getURL = function (e) {
      return xe.toURL(
        this.getState(
          b.default.defaults(e, { compact: !0, settings: !1, view: !1 })
        )
      )
    }),
    (rd.prototype.getScript = function (e) {
      return xe.toScript(
        this.getState(
          b.default.defaults(e, { compact: !0, settings: !0, view: !0 })
        )
      )
    }),
    (rd.prototype._compareReps = function (e, t) {
      var r = {},
        n = 0
      e && (n = e.repCount())
      var i = Q.defaults.presets[Q.now.preset],
        o = t
      void 0 === i || i.length > n
        ? ((o = !1), (r.preset = 'empty'))
        : Q.now.preset !== Q.defaults.preset && (r.preset = Q.now.preset)
      for (var s = [], a = !0, l = 0, c = n; l < c; ++l)
        (s[l] = e.repGet(l).compare(o ? i[l] : null)),
          b.default.isEmpty(s[l]) || (a = !1)
      return a || (r.reps = s), r
    }),
    (rd.prototype.getState = function (e) {
      var t = {}
      e = b.default.defaults(e, { compact: !0, settings: !1, view: !1 })
      var r,
        n,
        i,
        o = this._getComplexVisual()
      null !== o &&
        ((r = (i = o.getComplex()).metadata).id &&
          ((n = r.format ? ''.concat(r.format, ':') : ''), (t.load = n + r.id)),
        1 !== (i = i.getCurrentUnit()) && (t.unit = i))
      o = this._compareReps(o, e.compact)
      o.preset && (t.preset = o.preset), o.reps && (t.reps = o.reps)
      for (var s = this._objects, a = [], l = 0, c = s.length; l < c; ++l)
        a[l] = s[l].identify()
      return (
        0 < s.length && (t._objects = a),
        e.view && (t.view = this.view()),
        e.settings &&
          ((e = this.settings.getDiffs(!1)),
          b.default.isEmpty(e) || (t.settings = e)),
        t
      )
    }),
    (rd.prototype.get = function (e, t) {
      return Q.get(e, t)
    }),
    (rd.prototype._clipPlaneUpdateValue = function (e) {
      var e = Math.max(
          this._gfx.camera.position.z - e * Q.now.draft.clipPlaneFactor,
          Q.now.camNear
        ),
        t = { clipPlaneValue: e }
      this._forEachComplexVisual(function (e) {
        e.setUberOptions(t)
      })
      for (var r = 0, n = this._objects.length; r < n; ++r) {
        var i = this._objects[r]
        i._line && i._line.material.setUberOptions(t)
      }
      null !== this._picker && (this._picker.clipPlaneValue = e)
    }),
    (rd.prototype._fogFarUpdateValue = function () {
      null !== this._picker &&
        (this._gfx.scene.fog
          ? (this._picker.fogFarValue = this._gfx.scene.fog.far)
          : (this._picker.fogFarValue = void 0))
    }),
    (rd.prototype._updateShadowmapMeshes = function (o) {
      this._forEachComplexVisual(function (e) {
        for (var t = e._reprList, r = 0, n = t.length; r < n; ++r) {
          var i = t[r]
          o(i.geo, i.material)
        }
      })
    }),
    (rd.prototype._updateMaterials = function (t) {
      var r = 1 < arguments.length && void 0 !== arguments[1] && arguments[1],
        n =
          2 < arguments.length && void 0 !== arguments[2]
            ? arguments[2]
            : void 0
      this._forEachComplexVisual(function (e) {
        return e.setMaterialValues(t, r, n)
      })
      for (var e = 0, i = this._objects.length; e < i; ++e) {
        var o = this._objects[e]
        o._line &&
          (o._line.material.setValues(t), (o._line.material.needsUpdate = !0))
      }
    }),
    (rd.prototype._fogAlphaChanged = function () {
      this._forEachComplexVisual(function (e) {
        e.setUberOptions({ fogAlpha: Q.now.fogAlpha })
      })
    }),
    (rd.prototype._embedWebXR = function () {
      var e = this
      if ('WEBVR' !== Q.now.stereo)
        return this.webVR && this.webVR.disable(), void (this.webVR = null)
      this.webVR ||
        (this.webVR = new Gf(function () {
          e._requestAnimationFrame(function () {
            return e._onTick()
          }),
            (e._needRender = !0),
            e._onResize()
        })),
        this.webVR.enable(this._gfx)
    }),
    (rd.prototype._initOnSettingsChanged = function () {
      function e(e, t) {
        ;(e = b.default.isArray(e) ? e : [e]).forEach(function (e) {
          r.settings.addEventListener('change:'.concat(e), t)
        })
      }
      var r = this
      e('modes.VD.frame', function () {
        var e = r._getVolumeVisual()
        null !== e && (e.showFrame(Q.now.modes.VD.frame), (r._needRender = !0))
      }),
        e('modes.VD.isoMode', function () {
          var e = r._getVolumeVisual()
          null !== e &&
            (e.getMesh().material.updateDefines(), (r._needRender = !0))
        }),
        e('bg.color', function () {
          r._onBgColorChanged()
        }),
        e('ao', function () {
          var e
          Q.now.ao && !od(r._gfx.renderer.getContext())
            ? (r.logger.warn('Your device or browser does not support ao'),
              Q.set('ao', !1))
            : ((e = { normalsToGBuffer: Q.now.ao }),
              r._setUberMaterialValues(e))
        }),
        e('zSprites', function () {
          Q.now.zSprites &&
            !id(r._gfx.renderer.getContext()) &&
            (r.logger.warn('Your device or browser does not support zSprites'),
            Q.set('zSprites', !1)),
            r.rebuildAll()
        }),
        e('fogColor', function () {
          r._onFogColorChanged()
        }),
        e('fogColorEnable', function () {
          r._onFogColorChanged()
        }),
        e('bg.transparent', function (e) {
          var t = r._gfx
          t &&
            t.renderer.setClearColor(
              Q.now.bg.color,
              Number(!Q.now.bg.transparent)
            ),
            r._updateMaterials({ fogTransparent: e.value }),
            r.rebuildAll()
        }),
        e('draft.clipPlane', function (e) {
          r._updateMaterials({ clipPlane: e.value }), r.rebuildAll()
        }),
        e('shadow.on', function (e) {
          var t = { shadowmap: e.value, shadowmapType: Q.now.shadow.type },
            e = r._gfx
          e && (e.renderer.shadowMap.enabled = Boolean(t.shadowmap)),
            r._updateMaterials(t, !0),
            t.shadowmap
              ? (r._updateShadowCamera(),
                r._updateShadowmapMeshes(Fa.createShadowmapMaterial))
              : r._updateShadowmapMeshes(Fa.removeShadowmapMaterial),
            (r._needRender = !0)
        }),
        e('shadow.type', function (e) {
          Q.now.shadow.on &&
            (r._updateMaterials({ shadowmapType: e.value }, !0),
            (r._needRender = !0))
        }),
        e('shadow.radius', function (e) {
          for (var t = 0; t < r._gfx.scene.children.length; t++)
            void 0 !== r._gfx.scene.children[t].shadow &&
              ((r._gfx.scene.children[t].shadow.radius = e.value),
              (r._needRender = !0))
        }),
        e('fps', function () {
          r._fps.show(Q.now.fps)
        }),
        e(['fog', 'fogNearFactor', 'fogFarFactor'], function () {
          r._updateFog(), (r._needRender = !0)
        }),
        e('fogAlpha', function () {
          var e = Q.now.fogAlpha
          ;(e < 0 || 1 < e) &&
            r.logger.warn('fogAlpha must belong range [0,1]'),
            r._fogAlphaChanged(),
            (r._needRender = !0)
        }),
        e('autoResolution', function (e) {
          e.value &&
            !r._gfxScore &&
            r.logger.warn(
              'Benchmarks are missed, autoresolution will not work! Autoresolution should be set during miew startup.'
            )
        }),
        e('stereo', function () {
          r._embedWebXR('WEBVR' === Q.now.stereo), (r._needRender = !0)
        }),
        e(['transparency', 'palette'], function () {
          r.rebuildAll()
        }),
        e('resolution', function () {
          r.rebuildAll()
          var e = r._getVolumeVisual()
          e && (e.getMesh().material.updateDefines(), (r._needRender = !0))
        }),
        e(
          [
            'axes',
            'fxaa',
            'ao',
            'outline.on',
            'outline.color',
            'outline.threshold',
            'outline.thickness'
          ],
          function () {
            r._needRender = !0
          }
        )
    }),
    (rd.prototype.set = function (e, t) {
      Q.set(e, t)
    }),
    (rd.prototype.select = function (e, t) {
      var r,
        n = this._getComplexVisual()
      n &&
        (b.default.isString((r = e)) && (r = jf.parse(e).selector),
        n.select(r, t),
        (this._lastPick = null),
        this._updateInfoPanel(),
        (this._needRender = !0))
    })
  var vd, gd
  function xd(e, t, r, n) {
    for (r = r || {}, n = e.length; n--; r[e[n]] = t);
    return r
  }
  function bd() {
    this.yy = {}
  }
  ;(rd.prototype.view = function (n) {
    var e,
      t,
      r,
      i = this,
      o = this._gfx.pivot,
      s = []
    return void 0 === n
      ? ((e = o.position),
        (t = i._objectControls.getScale() / Q.now.radiusToFit),
        (r = new ae.Euler()).setFromQuaternion(
          i._objectControls.getOrientation(),
          'ZXY'
        ),
        (s = [e.x, e.y, e.z, t, r.x, r.y, r.z]),
        '1' + le.arrayToBase64(s, Float32Array))
      : ((function () {
          var e = (n = 40 === n.length ? '0'.concat(n) : n)[0]
          if (
            ((s = le.arrayFromBase64(n.substr(1), Float32Array)), '1' !== e)
          ) {
            if ('0' !== e)
              return i.logger.warn(
                'Encoded view version mismatch, stored as '
                  .concat(e, ' vs ')
                  .concat('1', ' expected')
              )
            s[3] /= 8
          }
          var t = i._interpolator,
            r = t.createView()
          r.position.copy(o.position),
            (r.scale = i._objectControls.getScale()),
            r.orientation.copy(i._objectControls.getOrientation()),
            (e = t.createView()).position.set(s[0], s[1], s[2]),
            i._getComplexVisual() &&
              e.position.sub(i._getComplexVisual().position),
            (e.scale = s[3]),
            e.orientation.setFromEuler(new ae.Euler(s[4], s[5], s[6], 'ZXY')),
            t.setup(r, e)
        })(),
        n)
  }),
    (rd.prototype._updateView = function () {
      var e = this._gfx.pivot,
        t = this._interpolator
      t.wasStarted() || t.start(),
        !t.isMoving() ||
          ((t = t.getCurrentView()).success &&
            ((t = t.view),
            e.position.copy(t.position),
            this._objectControls.setScale(t.scale * Q.now.radiusToFit),
            this._objectControls.setOrientation(t.orientation),
            this.dispatchEvent({ type: 'transform' }),
            (this._needRender = !0)))
    }),
    (rd.prototype.translate = function (e, t, r) {
      this._objectControls.translatePivot(e, t, r),
        this.dispatchEvent({ type: 'transform' }),
        (this._needRender = !0)
    }),
    (rd.prototype.rotate = function (e, t, r) {
      this._objectControls.rotate(
        new ae.Quaternion().setFromEuler(new ae.Euler(e, t, r, 'XYZ'))
      ),
        this.dispatchEvent({ type: 'transform' }),
        (this._needRender = !0)
    }),
    (rd.prototype.scale = function (e) {
      if (e <= 0) throw new RangeError('Scale should be greater than zero')
      this._objectControls.scale(e),
        this.dispatchEvent({ type: 'transform' }),
        (this._needRender = !0)
    }),
    (rd.prototype.center = function (e) {
      if (void 0 === e)
        return this.setPivotSubset(), void (this._needRender = !0)
      if (void 0 !== e.obj && ('atom' in e.obj || 'residue' in e.obj))
        return (
          'atom' in e.obj
            ? this.setPivotAtom(e.obj.atom)
            : this.setPivotResidue(e.obj.residue),
          void (this._needRender = !0)
        )
      if (void 0 === e.obj && '' !== e) {
        e = jf.parse(e)
        if (void 0 === e.error)
          return this.setPivotSubset(e), void (this._needRender = !0)
      }
      this.resetPivot(), (this._needRender = !0)
    }),
    (rd.prototype.within = function (e, t) {
      var r = this._getComplexVisual()
      if (!r) return jf.None()
      e instanceof String && (e = jf.parse(e))
      t = r.within(e, t)
      return t && (r.rebuildSelectionGeometry(), (this._needRender = !0)), t
    }),
    (rd.prototype.projected = function (e, t) {
      t = this._getComplexVisual(t)
      if (!t) return !1
      e = t.getComplex().getAtomByFullname(e)
      if (null === e) return !1
      e = e.position.clone()
      return (
        this._gfx.pivot.updateMatrixWorldRecursive(),
        this._gfx.camera.updateMatrixWorldRecursive(),
        this._gfx.pivot.localToWorld(e),
        e.project(this._gfx.camera),
        {
          x: 0.5 * (e.x + 1) * this._gfx.width,
          y: 0.5 * (1 - e.y) * this._gfx.height
        }
      )
    }),
    (rd.prototype.dssp = function (e) {
      e = this._getComplexVisual(e)
      e &&
        (e.getComplex().dssp(),
        e._reprList.forEach(function (e) {
          ;('CA' !== e.mode.id && 'SS' !== e.colorer.id) ||
            (e.needsRebuild = !0)
        }))
    }),
    (rd.prototype.exportCML = function () {
      var u = this
      function e(e) {
        var t,
          r,
          n,
          i = u._gfx.root,
          o =
            ((t = i.matrixWorld),
            (r = new ae.Vector3()),
            (n = new ae.Vector3()),
            (i = new ae.Vector3()),
            t.extractBasis(r, n, i),
            r.normalize(),
            n.normalize(),
            i.normalize(),
            (t = new ae.Matrix4()).identity(),
            t.makeBasis(r, n, i),
            t),
          s = new ae.Vector4(0, 0, 0, 0),
          a = new ae.Vector4(0, 0, 0, 0),
          l = null,
          c = null
        e.forEachAtom(function (e) {
          e.xmlNodeRef &&
            e.xmlNodeRef.xmlNode &&
            ((l = e.xmlNodeRef.xmlNode),
            (c = e.position),
            s.set(c.x, c.y, c.z, 1),
            s.applyMatrix4(o),
            l.setAttribute('x3', s.x.toString()),
            l.setAttribute('y3', s.y.toString()),
            l.setAttribute('z3', s.z.toString()),
            l.removeAttribute('x2'),
            l.removeAttribute('y2'))
        }),
          e.forEachSGroup(function (e) {
            e.xmlNodeRef &&
              e.xmlNodeRef.xmlNode &&
              ((l = e.xmlNodeRef.xmlNode),
              (c = e.getPosition()),
              s.set(c.x, c.y, c.z, 1),
              null === (e = e.getCentralPoint())
                ? s.applyMatrix4(o)
                : (a.set(e.x, e.y, e.z, 0),
                  s.add(a),
                  s.applyMatrix4(o),
                  a.set(e.x, e.y, e.z, 1),
                  a.applyMatrix4(o),
                  s.sub(a)),
              l.setAttribute('x', s.x.toString()),
              l.setAttribute('y', s.y.toString()),
              l.setAttribute('z', s.z.toString()))
          })
      }
      var t = u._getComplexVisual(),
        t = t ? t.getComplex() : null
      return t && t.originalCML
        ? (e(t), new XMLSerializer().serializeToString(t.originalCML))
        : null
    }),
    (rd.prototype.motm = function () {
      Q.set({
        fogColorEnable: !0,
        fogColor: 0,
        outline: { on: !0, threshold: 0.01 },
        bg: { color: 16777215 }
      }),
        this._forEachComplexVisual(function (e) {
          for (
            var t = [], r = e.getComplex(), n = oa.get(Q.now.palette), i = 0;
            i < r.getChainCount();
            i++
          ) {
            var o = r._chains[i]._name,
              s = n.getChainColor(o)
            t[i] = {
              selector: 'chain '.concat(o),
              mode: 'VW',
              colorer: ['CB', { color: s, factor: 0.9 }],
              material: 'FL'
            }
          }
          e.resetReps(t)
        })
    }),
    b.default.assign(rd, {
      VERSION: (rd.prototype.VERSION = '0.9.0+20211216.153701.b82b229'),
      registeredPlugins: [],
      chem: hr,
      io: Oh,
      modes: Xs,
      colorers: Pa,
      materials: Ba,
      palettes: oa,
      options: xe,
      settings: Q,
      utils: le,
      gfx: { Representation: Ga },
      thirdParty: { lodash: b.default, three: ae }
    })
  var wd = {
      parser:
        ((Ss = [
          5, 6, 7, 9, 13, 14, 15, 17, 18, 19, 20, 23, 25, 26, 27, 30, 33, 34,
          35, 37, 38, 41, 43, 45, 46, 49, 52, 54, 55, 56, 58, 59, 62, 64, 65,
          66, 70, 71, 72, 74, 77, 78, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91,
          92, 93, 94, 95, 96, 97, 98, 99, 101
        ]),
        (Cs = [
          5, 6, 7, 9, 13, 15, 17, 18, 19, 20, 23, 25, 26, 27, 30, 33, 34, 37,
          38, 41, 43, 45, 46, 49, 52, 54, 55, 56, 58, 59, 62, 64, 65, 66, 70,
          72, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95
        ]),
        (Es = [5, 70, 72]),
        (Ts = [5, 74]),
        (Ms = [71, 101]),
        ((Ms = {
          trace: function () {},
          yy: {},
          symbols_: {
            error: 2,
            Program: 3,
            Command: 4,
            EOF: 5,
            RESET: 6,
            BUILD: 7,
            ALL: 8,
            HELP: 9,
            Path: 10,
            MOTM: 11,
            OneArgCommand: 12,
            GET: 13,
            STRING: 14,
            SET: 15,
            Value: 16,
            SET_SAVE: 17,
            SET_RESTORE: 18,
            SET_RESET: 19,
            PRESET: 20,
            AddRepresentation: 21,
            EditRepresentation: 22,
            REMOVE: 23,
            RepresentationReference: 24,
            HIDE: 25,
            SHOW: 26,
            LIST: 27,
            EXPAND_KEY: 28,
            SELECTOR_KEY: 29,
            SELECT: 30,
            AS: 31,
            WordAll: 32,
            SELECTOR: 33,
            WITHIN: 34,
            NUMBER: 35,
            OF: 36,
            MATERIAL: 37,
            IDENTIFIER: 38,
            ModeCMD: 39,
            ColorCMD: 40,
            VIEW: 41,
            BASE_64: 42,
            UNIT: 43,
            DSSP: 44,
            SCALE: 45,
            ROTATE: 46,
            AxesList: 47,
            TRANSLATE: 48,
            CENTER: 49,
            GetURLBranch: 50,
            Screenshot: 51,
            LINE: 52,
            ArgList: 53,
            LISTOBJ: 54,
            REMOVEOBJ: 55,
            URL: 56,
            VIEW_KEY: 57,
            SCREENSHOT: 58,
            LOAD: 59,
            Url: 60,
            FILE_KEY: 61,
            ADD: 62,
            Description: 63,
            REP: 64,
            MODE: 65,
            COLOR: 66,
            Descriptor: 67,
            RepresentationOwnProperty: 68,
            RepresentationOwnPropertyOpts: 69,
            DESC_KEY: 70,
            '=': 71,
            DESC_KEY_OPTS: 72,
            AxesArg: 73,
            DESC_KEY_AXES: 74,
            Arg: 75,
            PathWoDescKey: 76,
            HEX: 77,
            BOOL: 78,
            Word: 79,
            CommandSetWoDESC_KEY: 80,
            DescKeys: 81,
            CLEAR: 82,
            FILE_LIST: 83,
            FILE_REGISTER: 84,
            FILE_DELETE: 85,
            PRESET_ADD: 86,
            PRESET_DELETE: 87,
            PRESET_UPDATE: 88,
            PRESET_RENAME: 89,
            PRESET_OPEN: 90,
            CREATE_SCENARIO: 91,
            RESET_SCENARIO: 92,
            DELETE_SCENARIO: 93,
            ADD_SCENARIO_ITEM: 94,
            LIST_SCENARIO: 95,
            PDB_KEY: 96,
            DELAY_KEY: 97,
            PRST_KEY: 98,
            DESCRIPTION_KEY: 99,
            CommandSet: 100,
            '.': 101,
            PresetPath: 102,
            '/': 103,
            HexOrNumber: 104,
            $accept: 0,
            $end: 1
          },
          terminals_: {
            2: 'error',
            5: 'EOF',
            6: 'RESET',
            7: 'BUILD',
            8: 'ALL',
            9: 'HELP',
            11: 'MOTM',
            13: 'GET',
            14: 'STRING',
            15: 'SET',
            17: 'SET_SAVE',
            18: 'SET_RESTORE',
            19: 'SET_RESET',
            20: 'PRESET',
            23: 'REMOVE',
            25: 'HIDE',
            26: 'SHOW',
            27: 'LIST',
            28: 'EXPAND_KEY',
            29: 'SELECTOR_KEY',
            30: 'SELECT',
            31: 'AS',
            33: 'SELECTOR',
            34: 'WITHIN',
            35: 'NUMBER',
            36: 'OF',
            37: 'MATERIAL',
            38: 'IDENTIFIER',
            41: 'VIEW',
            42: 'BASE_64',
            43: 'UNIT',
            44: 'DSSP',
            45: 'SCALE',
            46: 'ROTATE',
            48: 'TRANSLATE',
            49: 'CENTER',
            52: 'LINE',
            54: 'LISTOBJ',
            55: 'REMOVEOBJ',
            56: 'URL',
            57: 'VIEW_KEY',
            58: 'SCREENSHOT',
            59: 'LOAD',
            61: 'FILE_KEY',
            62: 'ADD',
            64: 'REP',
            65: 'MODE',
            66: 'COLOR',
            70: 'DESC_KEY',
            71: '=',
            72: 'DESC_KEY_OPTS',
            74: 'DESC_KEY_AXES',
            77: 'HEX',
            78: 'BOOL',
            82: 'CLEAR',
            83: 'FILE_LIST',
            84: 'FILE_REGISTER',
            85: 'FILE_DELETE',
            86: 'PRESET_ADD',
            87: 'PRESET_DELETE',
            88: 'PRESET_UPDATE',
            89: 'PRESET_RENAME',
            90: 'PRESET_OPEN',
            91: 'CREATE_SCENARIO',
            92: 'RESET_SCENARIO',
            93: 'DELETE_SCENARIO',
            94: 'ADD_SCENARIO_ITEM',
            95: 'LIST_SCENARIO',
            96: 'PDB_KEY',
            97: 'DELAY_KEY',
            98: 'PRST_KEY',
            99: 'DESCRIPTION_KEY',
            101: '.',
            103: '/'
          },
          productions_: [
            0,
            [3, 2],
            [3, 1],
            [4, 1],
            [4, 1],
            [4, 2],
            [4, 1],
            [4, 2],
            [4, 1],
            [4, 1],
            [4, 2],
            [4, 2],
            [4, 3],
            [4, 3],
            [4, 1],
            [4, 1],
            [4, 1],
            [4, 1],
            [4, 2],
            [4, 1],
            [4, 1],
            [4, 2],
            [4, 2],
            [4, 2],
            [4, 2],
            [4, 1],
            [4, 2],
            [4, 2],
            [4, 2],
            [4, 4],
            [4, 2],
            [4, 6],
            [4, 2],
            [4, 1],
            [4, 1],
            [4, 1],
            [4, 2],
            [4, 2],
            [4, 1],
            [4, 2],
            [4, 1],
            [4, 2],
            [4, 2],
            [4, 2],
            [4, 1],
            [4, 2],
            [4, 1],
            [4, 1],
            [4, 3],
            [4, 3],
            [4, 4],
            [4, 4],
            [4, 1],
            [4, 2],
            [50, 1],
            [50, 2],
            [50, 2],
            [50, 3],
            [50, 3],
            [51, 1],
            [51, 2],
            [51, 3],
            [12, 2],
            [12, 2],
            [12, 2],
            [21, 1],
            [21, 2],
            [21, 2],
            [21, 3],
            [22, 2],
            [22, 3],
            [39, 2],
            [39, 3],
            [40, 2],
            [40, 3],
            [24, 1],
            [24, 1],
            [63, 1],
            [63, 2],
            [63, 3],
            [63, 4],
            [67, 1],
            [67, 1],
            [67, 2],
            [68, 3],
            [69, 3],
            [47, 1],
            [47, 2],
            [73, 2],
            [53, 1],
            [53, 2],
            [75, 3],
            [16, 1],
            [16, 1],
            [16, 1],
            [16, 1],
            [16, 1],
            [79, 1],
            [79, 1],
            [32, 1],
            [32, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [80, 1],
            [81, 1],
            [81, 1],
            [81, 1],
            [81, 1],
            [81, 1],
            [81, 1],
            [81, 1],
            [100, 1],
            [100, 1],
            [76, 1],
            [76, 3],
            [76, 3],
            [10, 1],
            [10, 1],
            [10, 3],
            [10, 3],
            [10, 3],
            [60, 1],
            [102, 1],
            [102, 3],
            [104, 1],
            [104, 1]
          ],
          performAction: function (e, t, r, n, i, o, s) {
            var a = o.length - 1
            switch (i) {
              case 1:
                return o[a - 1]
              case 3:
                ;(this.$ = n.miew.reset(!1)),
                  n.ClearContext(),
                  n.miew.resetReps('empty')
                break
              case 4:
                this.$ = n.miew.rebuild()
                break
              case 5:
                ;(this.$ = n.miew.rebuildAll()), n.miew.rebuild()
                break
              case 6:
                this.$ = n.echo(n.utils.help().toString())
                break
              case 7:
                this.$ = n.echo(n.utils.help(o[a]).toString())
                break
              case 8:
                this.$ = n.miew.motm()
                break
              case 10:
              case 11:
                ;(this.$ = n.utils.propagateProp(o[a])),
                  n.echo(n.miew.get(o[a]).toString())
                break
              case 12:
              case 13:
                this.$ = n.miew.set(
                  o[a - 1],
                  n.utils.propagateProp(o[a - 1], o[a])
                )
                break
              case 14:
                this.$ = n.miew.saveSettings()
                break
              case 15:
                this.$ = n.miew.restoreSettings()
                break
              case 16:
                this.$ = n.miew.resetSettings()
                break
              case 17:
                this.$ = n.miew.resetReps()
                break
              case 18:
                this.$ = n.miew.applyPreset(o[a])
                break
              case 21:
                ;(this.$ = n.miew.repRemove(o[a])),
                  n.representations.remove(o[a])
                break
              case 22:
                this.$ = n.miew.repHide(o[a])
                break
              case 23:
                this.$ = n.miew.repHide(o[a], !1)
                break
              case 24:
                this.$ = n.echo(
                  n.utils.listRep(n.miew, n.representations, o[a], '-e')
                )
                break
              case 25:
                this.$ = n.echo(n.utils.list(n.miew, n.representations))
                break
              case 26:
                this.$ = n.echo(n.utils.list(n.miew, n.representations, o[a]))
                break
              case 27:
                this.$ = n.echo(n.utils.listSelector(n.miew, n.Context))
                break
              case 28:
                this.$ = n.miew.select(
                  n.utils.checkArg(o[a - 1].toLowerCase(), o[a], !0)
                )
                break
              case 29:
                ;(this.$ = n.Context[o[a].toLowerCase()] =
                  n.utils.checkArg(o[a - 3].toLowerCase(), o[a - 2], !0)),
                  n.miew.select(n.Context[o[a].toLowerCase()])
                break
              case 30:
                this.$ = n.miew.rep(n.miew.repCurrent(), {
                  selector: n.utils.checkArg(o[a - 1].toLowerCase(), o[a])
                })
                break
              case 31:
                this.$ = n.Context[o[a].toLowerCase()] = n.miew.within(
                  n.utils.checkArg('select', o[a - 2], !0),
                  Number(o[a - 4])
                )
                break
              case 32:
                this.$ = n.miew.rep(n.miew.repCurrent(), {
                  material: n.utils.checkArg(
                    o[a - 1].toLowerCase(),
                    o[a].toUpperCase()
                  )
                })
                break
              case 35:
                this.$ = n.echo(n.miew.view())
                break
              case 36:
              case 37:
                this.$ = n.miew.view(o[a])
                break
              case 38:
                this.$ = n.echo(n.miew.changeUnit())
                break
              case 39:
                this.$ = n.echo(n.miew.changeUnit(o[a]))
                break
              case 40:
                this.$ = n.miew.dssp()
                break
              case 41:
                this.$ = n.miew.scale(o[a])
                break
              case 42:
                for (var l = 0, c = o[a].length; l < c; l++)
                  n.miew.rotate(
                    (o[a][l].x * Math.PI) / 180,
                    (o[a][l].y * Math.PI) / 180,
                    (o[a][l].z * Math.PI) / 180
                  )
                break
              case 43:
                for (l = 0, c = o[a].length; l < c; l++)
                  n.miew.translate(
                    o[a][l].x || 0,
                    o[a][l].y || 0,
                    o[a][l].z || 0
                  )
                break
              case 44:
                this.$ = n.miew.center()
                break
              case 45:
                this.$ = n.miew.center(o[a])
                break
              case 48:
              case 49:
                this.$ = n.miew.addObject(
                  { type: 'line', params: [o[a - 1], o[a]] },
                  !0
                )
                break
              case 50:
              case 51:
                this.$ = n.miew.addObject(
                  {
                    type: 'line',
                    params: [o[a - 2], o[a - 1]],
                    opts: o[a].toJSO(n.utils, 'objects', 'line')
                  },
                  !0
                )
                break
              case 52:
                this.$ = n.echo(n.utils.listObjs(n.miew))
                break
              case 53:
                this.$ = n.miew.removeObject(o[a])
                break
              case 54:
                this.$ = n.echo(n.miew.getURL({ view: !1, settings: !1 }))
                break
              case 55:
                this.$ = n.echo(n.miew.getURL({ view: !1, settings: !0 }))
                break
              case 56:
                this.$ = n.echo(n.miew.getURL({ view: !0, settings: !1 }))
                break
              case 57:
              case 58:
                this.$ = n.echo(n.miew.getURL({ view: !0, settings: !0 }))
                break
              case 59:
                this.$ = n.miew.screenshotSave()
                break
              case 60:
                this.$ = n.miew.screenshotSave('', Number(o[a]))
                break
              case 61:
                this.$ = n.miew.screenshotSave(
                  '',
                  Number(o[a - 1]),
                  Number(o[a])
                )
                break
              case 62:
              case 63:
              case 64:
                ;(this.$ = n.utils.load(n.miew, o[a])),
                  n.representations.clear()
                break
              case 65:
                this.$ = n.echo(n.representations.add(n.miew.repAdd()))
                break
              case 66:
                this.$ = n.echo(n.representations.add(o[a], n.miew.repAdd()))
                break
              case 67:
                this.$ = n.echo(n.representations.add(n.miew.repAdd(o[a])))
                break
              case 68:
                this.$ = n.echo(
                  n.representations.add(o[a - 1], n.miew.repAdd(o[a]))
                )
                break
              case 69:
                ;(this.$ = n.miew.rep(o[a])), n.miew.repCurrent(o[a])
                break
              case 70:
                ;(this.$ = n.miew.rep(o[a - 1], o[a])),
                  n.miew.repCurrent(o[a - 1])
                break
              case 71:
                this.$ = n.miew.rep(n.miew.repCurrent(), {
                  mode: n.utils.checkArg(
                    o[a - 1].toLowerCase(),
                    o[a].toUpperCase()
                  )
                })
                break
              case 72:
                this.$ = n.miew.rep(n.miew.repCurrent(), {
                  mode: new Array(
                    n.utils.checkArg(
                      o[a - 2].toLowerCase(),
                      o[a - 1].toUpperCase()
                    ),
                    o[a].toJSO(n.utils, o[a - 2], o[a - 1].toUpperCase())
                  )
                })
                break
              case 73:
                this.$ = n.miew.rep(n.miew.repCurrent(), {
                  colorer: n.utils.checkArg(
                    o[a - 1].toLowerCase(),
                    o[a].toUpperCase()
                  )
                })
                break
              case 74:
                this.$ = n.miew.rep(n.miew.repCurrent(), {
                  colorer: new Array(
                    n.utils.checkArg(
                      o[a - 2].toLowerCase(),
                      o[a - 1].toUpperCase()
                    ),
                    o[a].toJSO(n.utils, o[a - 2], o[a - 1].toUpperCase())
                  )
                })
                break
              case 75:
                this.$ = Number(n.representations.get(o[a]))
                break
              case 76:
              case 92:
                this.$ = Number(o[a])
                break
              case 77:
                this.$ = o[a]
                break
              case 78:
                this.$ = n._.assign(o[a - 1], o[a])
                break
              case 79:
                this.$ = n._.assign(o[a - 2], o[a - 1], o[a])
                break
              case 80:
                this.$ = n._.assign(o[a - 3], o[a - 2], o[a - 1], o[a])
                break
              case 81:
              case 82:
                this.$ = n.CreateObjectPair(o[a].key, o[a].val)
                break
              case 83:
                this.$ = n.CreateObjectPair(
                  o[a - 1].key,
                  new Array(
                    o[a - 1].val,
                    o[a].toJSO(n.utils, o[a - 1].key, o[a - 1].val)
                  )
                )
                break
              case 84:
              case 85:
                this.$ = Object.create({
                  key: n.keyRemap(o[a - 2]),
                  val: n.utils.checkArg(o[a - 2], o[a])
                })
                break
              case 86:
                this.$ = [o[a]]
                break
              case 87:
                this.$ = o[a - 1].concat(o[a])
                break
              case 88:
                this.$ = n.CreateObjectPair(
                  o[a - 1].toLowerCase(),
                  Number(o[a])
                )
                break
              case 89:
                this.$ = new n.ArgList(o[a])
                break
              case 90:
                this.$ = o[a - 1].append(o[a])
                break
              case 91:
                this.$ = new n.Arg(o[a - 2], o[a])
                break
              case 93:
                this.$ = parseInt(o[a])
                break
              case 94:
                this.$ = JSON.parse(o[a])
                break
              case 95:
              case 96:
                this.$ = String(o[a])
                break
              case 157:
              case 158:
              case 161:
              case 162:
              case 163:
                this.$ = o[a - 2] + o[a - 1] + o[a]
                break
              case 166:
                this.$ = o[a - 2] = o[a - 2] + o[a - 1] + o[a]
            }
          },
          table: [
            {
              3: 1,
              4: 2,
              5: [1, 3],
              6: [1, 4],
              7: [1, 5],
              9: [1, 6],
              11: [1, 7],
              12: 8,
              13: [1, 9],
              15: [1, 10],
              17: [1, 11],
              18: [1, 12],
              19: [1, 13],
              20: [1, 14],
              21: 15,
              22: 16,
              23: [1, 17],
              25: [1, 18],
              26: [1, 19],
              27: [1, 20],
              30: [1, 21],
              33: [1, 22],
              34: [1, 23],
              37: [1, 24],
              39: 25,
              40: 26,
              41: [1, 27],
              43: [1, 28],
              44: [1, 29],
              45: [1, 30],
              46: [1, 31],
              48: [1, 32],
              49: [1, 33],
              50: 34,
              51: 35,
              52: [1, 36],
              54: [1, 37],
              55: [1, 38],
              56: [1, 44],
              58: [1, 45],
              59: [1, 39],
              62: [1, 40],
              64: [1, 41],
              65: [1, 42],
              66: [1, 43]
            },
            { 1: [3] },
            { 5: [1, 46] },
            { 1: [2, 2] },
            { 5: [2, 3] },
            { 5: [2, 4], 8: [1, 47] },
            {
              5: [2, 6],
              6: (Ls = [1, 60]),
              7: (zs = [1, 62]),
              9: (e = [1, 63]),
              10: 48,
              13: (Hs = [1, 65]),
              15: (Re = [1, 66]),
              17: (Oe = [1, 67]),
              18: (Ge = [1, 68]),
              19: (ra = [1, 69]),
              20: (vd = [1, 80]),
              23: (Ue = [1, 72]),
              25: (ia = [1, 73]),
              26: (gd = [1, 74]),
              27: (ta = [1, 75]),
              30: (He = [1, 99]),
              33: (na = [1, 76]),
              34: (la = [1, 100]),
              37: (ua = [1, 79]),
              38: (fa = [1, 51]),
              41: (pa = [1, 81]),
              43: (va = [1, 82]),
              45: (xa = [1, 84]),
              46: (wa = [1, 83]),
              49: (Ra = [1, 85]),
              52: (Aa = [1, 96]),
              54: (pt = [1, 97]),
              55: (dt = [1, 98]),
              56: (nt = [1, 86]),
              58: (Oa = [1, 87]),
              59: (or = [1, 64]),
              62: (hl = [1, 70]),
              64: (Ke = [1, 71]),
              65: (Cr = [1, 77]),
              66: (xr = [1, 78]),
              70: (Vn = [1, 53]),
              72: (jn = [1, 54]),
              74: (vi = [1, 55]),
              79: 49,
              80: 52,
              81: 50,
              82: (wi = [1, 61]),
              83: (_i = [1, 88]),
              84: (gi = [1, 89]),
              85: (gn = [1, 90]),
              86: (ni = [1, 91]),
              87: (xi = [1, 92]),
              88: (bi = [1, 93]),
              89: (ki = [1, 94]),
              90: (li = [1, 95]),
              91: (Fi = [1, 101]),
              92: (Gi = [1, 102]),
              93: (Si = [1, 103]),
              94: (Wi = [1, 104]),
              95: (Qi = [1, 105]),
              96: (Qe = [1, 56]),
              97: (Xr = [1, 57]),
              98: (mo = [1, 58]),
              99: (_o = [1, 59])
            },
            { 5: [2, 8] },
            { 5: [2, 9] },
            {
              6: Ls,
              7: zs,
              9: e,
              10: 106,
              13: Hs,
              14: [1, 107],
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              70: Vn,
              72: jn,
              74: vi,
              79: 49,
              80: 52,
              81: 50,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              96: Qe,
              97: Xr,
              98: mo,
              99: _o
            },
            {
              6: Ls,
              7: zs,
              9: e,
              10: 108,
              13: Hs,
              14: [1, 109],
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              70: Vn,
              72: jn,
              74: vi,
              79: 49,
              80: 52,
              81: 50,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              96: Qe,
              97: Xr,
              98: mo,
              99: _o
            },
            { 5: [2, 14] },
            { 5: [2, 15] },
            { 5: [2, 16] },
            {
              5: [2, 17],
              14: (Ro = [1, 115]),
              16: 110,
              35: (Po = [1, 111]),
              38: (ls = [1, 114]),
              77: (bs = [1, 112]),
              78: (No = [1, 113])
            },
            { 5: [2, 19] },
            { 5: [2, 20] },
            { 24: 116, 35: (Do = [1, 118]), 38: (Uo = [1, 117]) },
            { 24: 119, 35: Do, 38: Uo },
            { 24: 120, 35: Do, 38: Uo },
            { 5: [2, 25], 24: 121, 28: [1, 122], 29: [1, 123], 35: Do, 38: Uo },
            { 14: [1, 124] },
            { 14: [1, 125] },
            { 35: [1, 126] },
            { 38: [1, 127] },
            { 5: [2, 33] },
            { 5: [2, 34] },
            { 5: [2, 35], 14: [1, 128], 42: [1, 129] },
            { 5: [2, 38], 35: [1, 130] },
            { 5: [2, 40] },
            { 35: [1, 131] },
            { 47: 132, 73: 133, 74: (Ko = [1, 134]) },
            { 47: 135, 73: 133, 74: Ko },
            { 5: [2, 44], 14: [1, 136] },
            { 5: [2, 46] },
            { 5: [2, 47] },
            {
              6: Ls,
              7: zs,
              9: e,
              10: 138,
              13: Hs,
              14: [1, 137],
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              70: Vn,
              72: jn,
              74: vi,
              79: 49,
              80: 52,
              81: 50,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              96: Qe,
              97: Xr,
              98: mo,
              99: _o
            },
            { 5: [2, 52] },
            { 35: [1, 139] },
            { 14: [1, 143], 38: [1, 141], 60: 140, 61: [1, 142] },
            {
              5: [2, 65],
              38: [1, 144],
              63: 145,
              67: 146,
              68: 147,
              69: 148,
              70: (Jo = [1, 149]),
              72: (hr = [1, 150])
            },
            { 24: 151, 35: Do, 38: Uo },
            { 38: [1, 152] },
            { 38: [1, 153] },
            { 5: [2, 54], 29: [1, 154], 57: [1, 155] },
            { 5: [2, 59], 35: [1, 156] },
            { 1: [2, 1] },
            { 5: [2, 5] },
            { 5: [2, 7], 101: (Do = [1, 157]) },
            xd(
              (Uo = [
                5, 6, 7, 9, 13, 14, 15, 17, 18, 19, 20, 23, 25, 26, 27, 30, 33,
                34, 35, 37, 38, 41, 43, 45, 46, 49, 52, 54, 55, 56, 58, 59, 62,
                64, 65, 66, 70, 72, 74, 77, 78, 82, 83, 84, 85, 86, 87, 88, 89,
                90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 101
              ]),
              [2, 159]
            ),
            xd(Uo, [2, 160]),
            xd(Ss, [2, 97]),
            xd(Ss, [2, 98]),
            xd(Uo, [2, 147]),
            xd(Uo, [2, 148]),
            xd(Uo, [2, 149]),
            xd(Uo, [2, 150]),
            xd(Uo, [2, 151]),
            xd(Uo, [2, 152]),
            xd(Uo, [2, 153]),
            xd(Ss, [2, 101]),
            xd(Ss, [2, 102]),
            xd(Ss, [2, 103]),
            xd(Ss, [2, 104]),
            xd(Ss, [2, 105]),
            xd(Ss, [2, 106]),
            xd(Ss, [2, 107]),
            xd(Ss, [2, 108]),
            xd(Ss, [2, 109]),
            xd(Ss, [2, 110]),
            xd(Ss, [2, 111]),
            xd(Ss, [2, 112]),
            xd(Ss, [2, 113]),
            xd(Ss, [2, 114]),
            xd(Ss, [2, 115]),
            xd(Ss, [2, 116]),
            xd(Ss, [2, 117]),
            xd(Ss, [2, 118]),
            xd(Ss, [2, 119]),
            xd(Ss, [2, 120]),
            xd(Ss, [2, 121]),
            xd(Ss, [2, 122]),
            xd(Ss, [2, 123]),
            xd(Ss, [2, 124]),
            xd(Ss, [2, 125]),
            xd(Ss, [2, 126]),
            xd(Ss, [2, 127]),
            xd(Ss, [2, 128]),
            xd(Ss, [2, 129]),
            xd(Ss, [2, 130]),
            xd(Ss, [2, 131]),
            xd(Ss, [2, 132]),
            xd(Ss, [2, 133]),
            xd(Ss, [2, 134]),
            xd(Ss, [2, 135]),
            xd(Ss, [2, 136]),
            xd(Ss, [2, 137]),
            xd(Ss, [2, 138]),
            xd(Ss, [2, 139]),
            xd(Ss, [2, 140]),
            xd(Ss, [2, 141]),
            xd(Ss, [2, 142]),
            xd(Ss, [2, 143]),
            xd(Ss, [2, 144]),
            xd(Ss, [2, 145]),
            xd(Ss, [2, 146]),
            { 5: [2, 10], 101: Do },
            { 5: [2, 11] },
            { 14: Ro, 16: 158, 35: Po, 38: ls, 77: bs, 78: No, 101: Do },
            { 14: Ro, 16: 159, 35: Po, 38: ls, 77: bs, 78: No },
            { 5: [2, 18] },
            xd(Cs, [2, 92]),
            xd(Cs, [2, 93]),
            xd(Cs, [2, 94]),
            xd(Cs, [2, 95]),
            xd(Cs, [2, 96]),
            { 5: [2, 21] },
            xd(Es, [2, 75]),
            xd(Es, [2, 76]),
            { 5: [2, 22] },
            { 5: [2, 23] },
            { 5: [2, 24] },
            { 5: [2, 26] },
            { 5: [2, 27] },
            { 5: [2, 28], 31: [1, 160] },
            { 5: [2, 30] },
            { 36: [1, 161] },
            { 5: [2, 32] },
            { 5: [2, 36] },
            { 5: [2, 37] },
            { 5: [2, 39] },
            { 5: [2, 41] },
            { 5: [2, 42], 73: 162, 74: Ko },
            xd(Ts, [2, 86]),
            { 35: [1, 163] },
            { 5: [2, 43], 73: 162, 74: Ko },
            { 5: [2, 45] },
            { 14: [1, 164] },
            {
              6: Ls,
              7: zs,
              9: e,
              10: 165,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              70: Vn,
              72: jn,
              74: vi,
              79: 49,
              80: 52,
              81: 50,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              96: Qe,
              97: Xr,
              98: mo,
              99: _o,
              101: Do
            },
            { 5: [2, 53] },
            { 5: [2, 62] },
            { 5: [2, 63] },
            { 5: [2, 64] },
            { 5: [2, 164] },
            { 5: [2, 66], 63: 166, 67: 146, 68: 147, 69: 148, 70: Jo, 72: hr },
            { 5: [2, 67] },
            { 5: [2, 77], 67: 167, 68: 147, 69: 148, 70: Jo, 72: hr },
            xd(Es, [2, 81]),
            xd(Es, [2, 82], {
              80: 52,
              53: 168,
              75: 169,
              76: 170,
              79: 171,
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            }),
            { 71: [1, 172] },
            { 71: [1, 173] },
            { 5: [2, 69], 63: 174, 67: 146, 68: 147, 69: 148, 70: Jo, 72: hr },
            {
              5: [2, 71],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              53: 175,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 169,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            {
              5: [2, 73],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              53: 176,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 169,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            { 5: [2, 55], 57: [1, 177] },
            { 5: [2, 56], 29: [1, 178] },
            { 5: [2, 60], 35: [1, 179] },
            {
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              35: [1, 181],
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              70: Vn,
              72: jn,
              74: vi,
              79: 180,
              80: 52,
              81: 182,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              96: Qe,
              97: Xr,
              98: mo,
              99: _o
            },
            { 5: [2, 12] },
            { 5: [2, 13] },
            {
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              32: 183,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              70: Vn,
              72: jn,
              74: vi,
              79: 184,
              80: 52,
              81: 185,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              96: Qe,
              97: Xr,
              98: mo,
              99: _o
            },
            { 14: [1, 186] },
            xd(Ts, [2, 87]),
            xd(Ts, [2, 88]),
            {
              5: [2, 48],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              53: 187,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 169,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            {
              5: [2, 49],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              53: 188,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 169,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              101: Do
            },
            { 5: [2, 68] },
            { 5: [2, 78], 67: 189, 68: 147, 69: 148, 70: Jo, 72: hr },
            xd(Es, [2, 83], {
              80: 52,
              76: 170,
              79: 171,
              75: 190,
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            }),
            xd(Cs, [2, 89]),
            { 71: [1, 191], 101: [1, 192] },
            xd(Ms, [2, 156]),
            { 14: Ro, 16: 193, 35: Po, 38: ls, 77: bs, 78: No },
            { 14: Ro, 16: 194, 35: Po, 38: ls, 77: bs, 78: No },
            { 5: [2, 70] },
            {
              5: [2, 72],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 190,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            {
              5: [2, 74],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 190,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            { 5: [2, 57] },
            { 5: [2, 58] },
            { 5: [2, 61] },
            xd(Uo, [2, 161]),
            xd(Uo, [2, 162]),
            xd(Uo, [2, 163]),
            { 5: [2, 29] },
            { 5: [2, 99] },
            { 5: [2, 100] },
            { 31: [1, 195] },
            {
              5: [2, 50],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 190,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            {
              5: [2, 51],
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              75: 190,
              76: 170,
              79: 171,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            { 5: [2, 79], 67: 196, 68: 147, 69: 148, 70: Jo, 72: hr },
            xd(Cs, [2, 90]),
            { 14: Ro, 16: 197, 35: Po, 38: ls, 77: bs, 78: No },
            {
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              33: na,
              34: la,
              35: [1, 199],
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              79: 198,
              80: 52,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi
            },
            xd(Es, [2, 84]),
            xd(Cs, [2, 85]),
            {
              6: Ls,
              7: zs,
              9: e,
              13: Hs,
              15: Re,
              17: Oe,
              18: Ge,
              19: ra,
              20: vd,
              23: Ue,
              25: ia,
              26: gd,
              27: ta,
              30: He,
              32: 200,
              33: na,
              34: la,
              37: ua,
              38: fa,
              41: pa,
              43: va,
              45: xa,
              46: wa,
              49: Ra,
              52: Aa,
              54: pt,
              55: dt,
              56: nt,
              58: Oa,
              59: or,
              62: hl,
              64: Ke,
              65: Cr,
              66: xr,
              70: Vn,
              72: jn,
              74: vi,
              79: 184,
              80: 52,
              81: 185,
              82: wi,
              83: _i,
              84: gi,
              85: gn,
              86: ni,
              87: xi,
              88: bi,
              89: ki,
              90: li,
              91: Fi,
              92: Gi,
              93: Si,
              94: Wi,
              95: Qi,
              96: Qe,
              97: Xr,
              98: mo,
              99: _o
            },
            { 5: [2, 80] },
            xd(Cs, [2, 91]),
            xd(Ms, [2, 157]),
            xd(Ms, [2, 158]),
            { 5: [2, 31] }
          ],
          defaultActions: {
            3: [2, 2],
            4: [2, 3],
            7: [2, 8],
            8: [2, 9],
            11: [2, 14],
            12: [2, 15],
            13: [2, 16],
            15: [2, 19],
            16: [2, 20],
            25: [2, 33],
            26: [2, 34],
            29: [2, 40],
            34: [2, 46],
            35: [2, 47],
            37: [2, 52],
            46: [2, 1],
            47: [2, 5],
            107: [2, 11],
            110: [2, 18],
            116: [2, 21],
            119: [2, 22],
            120: [2, 23],
            121: [2, 24],
            122: [2, 26],
            123: [2, 27],
            125: [2, 30],
            127: [2, 32],
            128: [2, 36],
            129: [2, 37],
            130: [2, 39],
            131: [2, 41],
            136: [2, 45],
            139: [2, 53],
            140: [2, 62],
            141: [2, 63],
            142: [2, 64],
            143: [2, 164],
            145: [2, 67],
            158: [2, 12],
            159: [2, 13],
            166: [2, 68],
            174: [2, 70],
            177: [2, 57],
            178: [2, 58],
            179: [2, 61],
            183: [2, 29],
            184: [2, 99],
            185: [2, 100],
            196: [2, 80],
            200: [2, 31]
          },
          parseError: function (e, t) {
            if (!t.recoverable) {
              var r = new Error(e)
              throw ((r.hash = t), r)
            }
            this.trace(e)
          },
          parse: function (e) {
            var t,
              r = this,
              n = [0],
              i = [],
              o = [null],
              s = [],
              a = this.table,
              l = '',
              c = 0,
              u = 0,
              h = 1,
              f = s.slice.call(arguments, 1),
              d = Object.create(this.lexer),
              p = { yy: {} }
            for (t in this.yy)
              Object.prototype.hasOwnProperty.call(this.yy, t) &&
                (p.yy[t] = this.yy[t])
            d.setInput(e, p.yy),
              (p.yy.lexer = d),
              (p.yy.parser = this),
              void 0 === d.yylloc && (d.yylloc = {})
            var m = d.yylloc
            s.push(m)
            var y = d.options && d.options.ranges
            'function' == typeof p.yy.parseError
              ? (this.parseError = p.yy.parseError)
              : (this.parseError = Object.getPrototypeOf(this).parseError)
            for (var _, v, g, x, b, w, S = {}; ; ) {
              if (
                ((v = n[n.length - 1]),
                void 0 ===
                  (g =
                    this.defaultActions[v] ||
                    (null == _ &&
                      ((R = void 0),
                      'number' != typeof (R = i.pop() || d.lex() || h) &&
                        (R instanceof Array && (R = (i = R).pop()),
                        (R = r.symbols_[R] || R)),
                      (_ = R)),
                    a[v] && a[v][_])) ||
                  !g.length ||
                  !g[0])
              ) {
                var R = '',
                  C = []
                for (b in a[v])
                  this.terminals_[b] &&
                    2 < b &&
                    C.push("'" + this.terminals_[b] + "'")
                ;(R = d.showPosition
                  ? 'Parse error on line ' +
                    (c + 1) +
                    ':\n' +
                    d.showPosition() +
                    '\nExpecting ' +
                    C.join(', ') +
                    ", got '" +
                    (this.terminals_[_] || _) +
                    "'"
                  : 'Parse error on line ' +
                    (c + 1) +
                    ': Unexpected ' +
                    (_ == h
                      ? 'end of input'
                      : "'" + (this.terminals_[_] || _) + "'")),
                  this.parseError(R, {
                    text: d.match,
                    token: this.terminals_[_] || _,
                    line: d.yylineno,
                    loc: m,
                    expected: C
                  })
              }
              if (g[0] instanceof Array && 1 < g.length)
                throw new Error(
                  'Parse Error: multiple actions possible at state: ' +
                    v +
                    ', token: ' +
                    _
                )
              switch (g[0]) {
                case 1:
                  n.push(_),
                    o.push(d.yytext),
                    s.push(d.yylloc),
                    n.push(g[1]),
                    (_ = null),
                    (u = d.yyleng),
                    (l = d.yytext),
                    (c = d.yylineno),
                    (m = d.yylloc)
                  break
                case 2:
                  if (
                    ((w = this.productions_[g[1]][1]),
                    (S.$ = o[o.length - w]),
                    (S._$ = {
                      first_line: s[s.length - (w || 1)].first_line,
                      last_line: s[s.length - 1].last_line,
                      first_column: s[s.length - (w || 1)].first_column,
                      last_column: s[s.length - 1].last_column
                    }),
                    y &&
                      (S._$.range = [
                        s[s.length - (w || 1)].range[0],
                        s[s.length - 1].range[1]
                      ]),
                    void 0 !==
                      (x = this.performAction.apply(
                        S,
                        [l, u, c, p.yy, g[1], o, s].concat(f)
                      )))
                  )
                    return x
                  w &&
                    ((n = n.slice(0, -1 * w * 2)),
                    (o = o.slice(0, -1 * w)),
                    (s = s.slice(0, -1 * w))),
                    n.push(this.productions_[g[1]][0]),
                    o.push(S.$),
                    s.push(S._$),
                    (w = a[n[n.length - 2]][n[n.length - 1]]),
                    n.push(w)
                  break
                case 3:
                  return !0
              }
            }
            return !0
          }
        }).lexer = {
          EOF: 1,
          parseError: function (e, t) {
            if (!this.yy.parser) throw new Error(e)
            this.yy.parser.parseError(e, t)
          },
          setInput: function (e, t) {
            return (
              (this.yy = t || this.yy || {}),
              (this._input = e),
              (this._more = this._backtrack = this.done = !1),
              (this.yylineno = this.yyleng = 0),
              (this.yytext = this.matched = this.match = ''),
              (this.conditionStack = ['INITIAL']),
              (this.yylloc = {
                first_line: 1,
                first_column: 0,
                last_line: 1,
                last_column: 0
              }),
              this.options.ranges && (this.yylloc.range = [0, 0]),
              (this.offset = 0),
              this
            )
          },
          input: function () {
            var e = this._input[0]
            return (
              (this.yytext += e),
              this.yyleng++,
              this.offset++,
              (this.match += e),
              (this.matched += e),
              e.match(/(?:\r\n?|\n).*/g)
                ? (this.yylineno++, this.yylloc.last_line++)
                : this.yylloc.last_column++,
              this.options.ranges && this.yylloc.range[1]++,
              (this._input = this._input.slice(1)),
              e
            )
          },
          unput: function (e) {
            var t = e.length,
              r = e.split(/(?:\r\n?|\n)/g)
            ;(this._input = e + this._input),
              (this.yytext = this.yytext.substr(0, this.yytext.length - t)),
              (this.offset -= t)
            var n = this.match.split(/(?:\r\n?|\n)/g)
            ;(this.match = this.match.substr(0, this.match.length - 1)),
              (this.matched = this.matched.substr(0, this.matched.length - 1)),
              r.length - 1 && (this.yylineno -= r.length - 1)
            e = this.yylloc.range
            return (
              (this.yylloc = {
                first_line: this.yylloc.first_line,
                last_line: this.yylineno + 1,
                first_column: this.yylloc.first_column,
                last_column: r
                  ? (r.length === n.length ? this.yylloc.first_column : 0) +
                    n[n.length - r.length].length -
                    r[0].length
                  : this.yylloc.first_column - t
              }),
              this.options.ranges &&
                (this.yylloc.range = [e[0], e[0] + this.yyleng - t]),
              (this.yyleng = this.yytext.length),
              this
            )
          },
          more: function () {
            return (this._more = !0), this
          },
          reject: function () {
            return this.options.backtrack_lexer
              ? ((this._backtrack = !0), this)
              : this.parseError(
                  'Lexical error on line ' +
                    (this.yylineno + 1) +
                    '. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n' +
                    this.showPosition(),
                  { text: '', token: null, line: this.yylineno }
                )
          },
          less: function (e) {
            this.unput(this.match.slice(e))
          },
          pastInput: function () {
            var e = this.matched.substr(
              0,
              this.matched.length - this.match.length
            )
            return (
              (20 < e.length ? '...' : '') + e.substr(-20).replace(/\n/g, '')
            )
          },
          upcomingInput: function () {
            var e = this.match
            return (
              e.length < 20 && (e += this._input.substr(0, 20 - e.length)),
              (e.substr(0, 20) + (20 < e.length ? '...' : '')).replace(
                /\n/g,
                ''
              )
            )
          },
          showPosition: function () {
            var e = this.pastInput(),
              t = new Array(e.length + 1).join('-')
            return e + this.upcomingInput() + '\n' + t + '^'
          },
          test_match: function (e, t) {
            var r, n
            if (
              (this.options.backtrack_lexer &&
                ((n = {
                  yylineno: this.yylineno,
                  yylloc: {
                    first_line: this.yylloc.first_line,
                    last_line: this.last_line,
                    first_column: this.yylloc.first_column,
                    last_column: this.yylloc.last_column
                  },
                  yytext: this.yytext,
                  match: this.match,
                  matches: this.matches,
                  matched: this.matched,
                  yyleng: this.yyleng,
                  offset: this.offset,
                  _more: this._more,
                  _input: this._input,
                  yy: this.yy,
                  conditionStack: this.conditionStack.slice(0),
                  done: this.done
                }),
                this.options.ranges &&
                  (n.yylloc.range = this.yylloc.range.slice(0))),
              (r = e[0].match(/(?:\r\n?|\n).*/g)) &&
                (this.yylineno += r.length),
              (this.yylloc = {
                first_line: this.yylloc.last_line,
                last_line: this.yylineno + 1,
                first_column: this.yylloc.last_column,
                last_column: r
                  ? r[r.length - 1].length -
                    r[r.length - 1].match(/\r?\n?/)[0].length
                  : this.yylloc.last_column + e[0].length
              }),
              (this.yytext += e[0]),
              (this.match += e[0]),
              (this.matches = e),
              (this.yyleng = this.yytext.length),
              this.options.ranges &&
                (this.yylloc.range = [
                  this.offset,
                  (this.offset += this.yyleng)
                ]),
              (this._more = !1),
              (this._backtrack = !1),
              (this._input = this._input.slice(e[0].length)),
              (this.matched += e[0]),
              (t = this.performAction.call(
                this,
                this.yy,
                this,
                t,
                this.conditionStack[this.conditionStack.length - 1]
              )),
              this.done && this._input && (this.done = !1),
              t)
            )
              return t
            if (this._backtrack) {
              for (var i in n) this[i] = n[i]
              return !1
            }
            return !1
          },
          next: function () {
            if (this.done) return this.EOF
            var e, t, r, n
            this._input || (this.done = !0),
              this._more || ((this.yytext = ''), (this.match = ''))
            for (var i = this._currentRules(), o = 0; o < i.length; o++)
              if (
                (r = this._input.match(this.rules[i[o]])) &&
                (!t || r[0].length > t[0].length)
              )
                if (((t = r), (n = o), this.options.backtrack_lexer)) {
                  if (!1 !== (e = this.test_match(r, i[o]))) return e
                  if (!this._backtrack) return !1
                  t = !1
                } else if (!this.options.flex) break
            return t
              ? !1 !== (e = this.test_match(t, i[n])) && e
              : '' === this._input
              ? this.EOF
              : this.parseError(
                  'Lexical error on line ' +
                    (this.yylineno + 1) +
                    '. Unrecognized text.\n' +
                    this.showPosition(),
                  { text: '', token: null, line: this.yylineno }
                )
          },
          lex: function () {
            var e = this.next()
            return e || this.lex()
          },
          begin: function (e) {
            this.conditionStack.push(e)
          },
          popState: function () {
            return 0 < this.conditionStack.length - 1
              ? this.conditionStack.pop()
              : this.conditionStack[0]
          },
          _currentRules: function () {
            return (
              this.conditionStack.length &&
              this.conditionStack[this.conditionStack.length - 1]
                ? this.conditions[
                    this.conditionStack[this.conditionStack.length - 1]
                  ]
                : this.conditions.INITIAL
            ).rules
          },
          topState: function (e) {
            return 0 <= (e = this.conditionStack.length - 1 - Math.abs(e || 0))
              ? this.conditionStack[e]
              : 'INITIAL'
          },
          pushState: function (e) {
            this.begin(e)
          },
          stateStackSize: function () {
            return this.conditionStack.length
          },
          options: { 'case-insensitive': !0 },
          performAction: function (e, t, r, n) {
            switch (r) {
              case 0:
                break
              case 1:
              case 2:
                return ''
              case 3:
                return 42
              case 4:
                return 35
              case 5:
                return 77
              case 6:
              case 7:
                return 78
              case 8:
                return 8
              case 9:
                return 6
              case 10:
                return 82
              case 11:
                return 7
              case 12:
                return 9
              case 13:
                return 59
              case 14:
                return 13
              case 15:
                return 15
              case 16:
                return 17
              case 17:
                return 18
              case 18:
                return 19
              case 19:
                return 20
              case 20:
                return 11
              case 21:
                return 62
              case 22:
                return 64
              case 23:
                return 23
              case 24:
                return 25
              case 25:
                return 26
              case 26:
                return 27
              case 27:
                return 30
              case 28:
                return 34
              case 29:
                return 33
              case 30:
                return 65
              case 31:
                return 66
              case 32:
                return 37
              case 33:
                return 41
              case 34:
                return 43
              case 35:
                return 52
              case 36:
                return 54
              case 37:
                return 55
              case 38:
                return 46
              case 39:
                return 48
              case 40:
                return 45
              case 41:
                return 49
              case 42:
                return 56
              case 43:
                return 58
              case 44:
                return 44
              case 45:
                return 83
              case 46:
                return 84
              case 47:
                return 85
              case 48:
                return 86
              case 49:
                return 87
              case 50:
                return 88
              case 51:
                return 89
              case 52:
                return 90
              case 53:
                return 91
              case 54:
                return 92
              case 55:
                return 93
              case 56:
                return 94
              case 57:
                return 95
              case 58:
              case 59:
                return 70
              case 60:
              case 61:
                return 72
              case 62:
              case 63:
              case 64:
                return 74
              case 65:
                return 31
              case 66:
                return 36
              case 67:
                return 96
              case 68:
                return 97
              case 69:
                return 98
              case 70:
                return 99
              case 71:
                return (t.yytext = e.utils.unquoteString(t.yytext)), 14
              case 72:
                return 38
              case 73:
                return 5
              case 74:
                return 101
              case 75:
                return 103
              case 76:
                return '\\'
              case 77:
                return 28
              case 78:
                return 61
              case 79:
                return 29
              case 80:
                return 57
              case 81:
                return 71
            }
          },
          rules: [
            /^(?:\s+)/i,
            /^(?:[#].*)/i,
            /^(?:\/\/.*)/i,
            /^(?:([_A-Z0-9\/\+]+==))/i,
            /^(?:-?[0-9]+(\.[0-9]+)?\b)/i,
            /^(?:0[xX][0-9A-F]+\b)/i,
            /^(?:false\b)/i,
            /^(?:true\b)/i,
            /^(?:all\b)/i,
            /^(?:reset\b)/i,
            /^(?:clear\b)/i,
            /^(?:build\b)/i,
            /^(?:help\b)/i,
            /^(?:load\b)/i,
            /^(?:get\b)/i,
            /^(?:set\b)/i,
            /^(?:set_save\b)/i,
            /^(?:set_restore\b)/i,
            /^(?:set_reset\b)/i,
            /^(?:preset\b)/i,
            /^(?:motm\b)/i,
            /^(?:add\b)/i,
            /^(?:rep\b)/i,
            /^(?:remove\b)/i,
            /^(?:hide\b)/i,
            /^(?:show\b)/i,
            /^(?:list\b)/i,
            /^(?:select\b)/i,
            /^(?:within\b)/i,
            /^(?:selector\b)/i,
            /^(?:mode\b)/i,
            /^(?:color\b)/i,
            /^(?:material\b)/i,
            /^(?:view\b)/i,
            /^(?:unit\b)/i,
            /^(?:line\b)/i,
            /^(?:listobj\b)/i,
            /^(?:removeobj\b)/i,
            /^(?:rotate\b)/i,
            /^(?:translate\b)/i,
            /^(?:scale\b)/i,
            /^(?:center\b)/i,
            /^(?:url\b)/i,
            /^(?:screenshot\b)/i,
            /^(?:dssp\b)/i,
            /^(?:file_list\b)/i,
            /^(?:file_register\b)/i,
            /^(?:file_delete\b)/i,
            /^(?:preset_add\b)/i,
            /^(?:preset_delete\b)/i,
            /^(?:preset_update\b)/i,
            /^(?:preset_rename\b)/i,
            /^(?:preset_open\b)/i,
            /^(?:create_scenario\b)/i,
            /^(?:reset_scenario\b)/i,
            /^(?:delete_scenario\b)/i,
            /^(?:add_scenario_item\b)/i,
            /^(?:list_scenario\b)/i,
            /^(?:s\b)/i,
            /^(?:mt\b)/i,
            /^(?:m\b)/i,
            /^(?:c\b)/i,
            /^(?:x\b)/i,
            /^(?:y\b)/i,
            /^(?:z\b)/i,
            /^(?:as\b)/i,
            /^(?:of\b)/i,
            /^(?:pdb\b)/i,
            /^(?:delay\b)/i,
            /^(?:prst\b)/i,
            /^(?:desc\b)/i,
            /^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,
            /^(?:([_A-Z0-9]+))/i,
            /^(?:$)/i,
            /^(?:\.)/i,
            /^(?:\/)/i,
            /^(?:\\)/i,
            /^(?:-e\b)/i,
            /^(?:-f\b)/i,
            /^(?:-s\b)/i,
            /^(?:-v\b)/i,
            /^(?:=)/i
          ],
          conditions: {
            INITIAL: {
              rules: [
                0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,
                34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
                50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65,
                66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81
              ],
              inclusive: !0
            }
          }
        }),
        new ((bd.prototype = Ms).Parser = bd)())
    },
    Xr = {
      $help: [
        'Rendering mode shortcut',
        '    BS - balls and sticks mode',
        '    LN - lines mode',
        '    LC - licorice mode',
        '    VW - van der waals mode',
        '    TR - trace mode',
        '    TU - tube mode',
        '    CA - cartoon mode',
        '    SA - isosurface mode',
        '    QS - quick surface mode',
        '    SE - solvent excluded mode',
        '    TX - text mode'
      ],
      BS: {
        $help: [
          '   Balls and sticks',
          '      aromrad = <number> #aromatic radius',
          '      atom = <number>    #atom radius',
          '      bond = <number>    #bond radius',
          '      multibond = <bool> #use multibond',
          '      showarom = <bool>  #show aromatic',
          '      space = <number>   #space value\n'
        ]
      },
      CA: {
        $help: [
          '   Cartoon',
          '      arrow = <number>   #arrow size',
          '      depth = <number>   #depth of surface',
          '      heightSegmentsRatio = <number>',
          '      radius = <number>  #tube radius',
          '      tension = <number> #',
          '      width = <number>  #secondary width\n'
        ]
      },
      LN: {
        $help: [
          '   Lines',
          '      atom = <number>    #atom radius',
          '      chunkarom = <number>',
          '      multibond = <bool> #use multibond',
          '      showarom = <bool>  #show aromatic',
          '      offsarom = <number>\n'
        ]
      },
      LC: {
        $help: [
          '   Licorice',
          '      aromrad = <number> #aromatic radius',
          '      bond = <number>    #bond radius',
          '      multibond = <bool> #use multibond',
          '      showarom = <bool>  #show aromatic',
          '      space = <number>   #space value\n'
        ]
      },
      VW: { $help: ['   Van der Waals', '      nothing\n'] },
      TR: { $help: ['   Trace', '      radius = <number>  #tube radius\n'] },
      TU: {
        $help: [
          '   Tube',
          '      heightSegmentsRatio = <number>',
          '      radius = <number>  #tube radius',
          '      tension = <number> \n'
        ]
      },
      SA: { $help: ['   Surface', '      zClip = <bool> #clip z plane\n'] },
      QS: {
        $help: [
          '   Quick surface',
          '      isoValue = <number>',
          '      scale = <number>',
          '      wireframe = <bool>',
          '      zClip = <bool> #clip z plane\n'
        ]
      },
      SE: {
        $help: [
          '   Solvent excluded surface',
          '      zClip = <bool> #clip z plane\n'
        ]
      },
      TX: {
        $help: [
          '   Text mode',
          '      template = <format string> string that can include "{{ id }}"',
          '          it will be replaced by value, id can be one of next:',
          '          serial, name, type, sequence, residue, chain, hetatm, water\n',
          '      horizontalAlign = <string> {"left", "right", "center"}',
          '      verticalAlign = <string> {"top", "bottom", "middle"}',
          '      dx = <number> #offset along x',
          '      dy = <number> #offset along y',
          '      dz = <number> #offset along z',
          '      fg = <string> #text color modificator',
          '           could be keyword, named color or hex',
          '      fg = <string> #back color modificator',
          '           could be keyword, named color or hex',
          '      showBg = <bool> #if set show background',
          '           plate under text'
        ]
      }
    },
    mo = {
      $help: [
        'Coloring mode shortcut',
        '    EL - color by element',
        '    CH - color by chain',
        '    SQ - color by sequence',
        '    RT - color by residue type',
        '    SS - color by secondary structure',
        '    UN - uniform'
      ],
      UN: {
        $help: [
          'Parameters of coloring modes customization',
          '   Uniform',
          '      color = <number|color> #RGB->HEX->dec\n'
        ],
        color: {
          $help: Object.keys(oa.get(Q.now.palette).namedColors)
            .sort()
            .join('\n')
        }
      }
    },
    _o = {
      $help: [
        'Material shortcut',
        '    DF - diffuse',
        '    TR - transparent',
        '    SF - soft plastic',
        '    PL - glossy plastic',
        '    ME - metal',
        '    GL - glass'
      ]
    },
    Cs = {
      $help: [
        'Short (packed) representation description as a set of variables',
        '    s=<EXPRESSION>',
        '        selector property',
        '    m=<MODE_ID>[!<PARAMETER>:<VALUE>[,...]]',
        '        render mode property',
        '    c=<COLORER_ID>[!<PARAMETER>:<VALUE>[,...]]',
        '        color mode property',
        '    mt=<MATERIAL_ID>',
        '        material property'
      ],
      s: {
        $help:
          'Selection expression string as it is in menu->representations->selection'
      },
      m: Xr,
      c: mo,
      mt: _o
    },
    Ms = {
      $help: [
        'Parameters of rendering modes customization: modes',
        'Parameters of colorer customization: colorers',
        'Autobuild: autobuild = (<number>|<bool>)'
      ],
      modes: Xr,
      colorers: mo
    },
    Sd = {
      $help: [
        'help (<cmd name>| <path to property>)',
        'You can get detailed information about command options',
        '   using "help cmd.opt.opt.[...]"\n',
        '   you can use one line comments',
        '   everything started from (#|//) will be skipped',
        '   Example: >build //some comment\n',
        'List of available commands:'
      ],
      reset: {
        $help: [
          'Reload current object, delete all representations',
          '    Nothing will work until load new object'
        ]
      },
      load: {
        $help: [
          'load (<PDBID>|<URL>|-f [<*.NC FILE URL STRING>])',
          '    Load new pdb object from selected source'
        ],
        PDBID: { $help: 'pdb id in remote molecule database' },
        URL: { $help: 'url to source file' },
        f: {
          $help: [
            'open file system dialog to fetch local file',
            'optionally you can determine trajectory file',
            'via URL for *.top model'
          ]
        }
      },
      clear: { $help: 'No args. Clear terminal' },
      add: {
        $help: [
          'add [<REP_NAME>] [<DESCRIPTION>]',
          '    Add new item to representation set with',
          '    default or <DESCRIPTION> params'
        ],
        REP_NAME: {
          $help: 'Identifier string [_,a-z,A-Z,0-9] can not start from digit'
        },
        DESCRIPTION: Cs
      },
      rep: {
        $help: [
          'rep [<REP_NAME>|<REP_INDEX>] [<DESCRIPTION>]',
          '    set current representation by name or index',
          '    edit current representation by <DESCRIPTION>'
        ],
        REP_NAME: {
          $help: [
            'Identifier string [_,a-z,A-Z,0-9] can not start from digit',
            'Must be declared before'
          ]
        },
        REP_INDEX: { $help: 'Index of available representation' },
        DESCRIPTION: Cs
      },
      remove: {
        $help: [
          'remove (<REP_NAME>|<REP_INDEX>)',
          'Remove representation by name or index'
        ],
        REP_NAME: {
          $help: [
            'Identifier string [_,a-z,A-Z,0-9] can not start from digit',
            'Must be declared before'
          ]
        },
        REP_INDEX: { $help: 'Index of available representation' }
      },
      selector: {
        $help: [
          'selector <EXPRESSION>',
          '   set selector from EXPRESSION to current representation'
        ],
        EXPRESSION: {
          $help:
            'Selection expression string as it is in menu->representations->selection'
        }
      },
      mode: {
        $help: [
          'mode <MODE_ID> [<PARAMETER>=<VALUE>...]',
          '   set rendering mode and apply parameters to current representation'
        ],
        MODE_ID: Xr
      },
      color: {
        $help: [
          'color <COLORER_ID> [<PARAMETER>=<VALUE>...]',
          '   set colorer and apply parameters to current representation'
        ],
        COLORER_ID: mo
      },
      material: {
        $help: [
          'material <MATERIAL_ID>',
          '   set material to current representation'
        ],
        MATERIAL_ID: _o
      },
      build: {
        $help: 'build help str',
        add: {
          $help: 'build.add',
          new: {
            $help: [
              'add.new',
              'add.new new line 1',
              'add.new new line 2',
              'add.new new line 3'
            ]
          }
        },
        del: { $help: 'build.del' }
      },
      list: {
        $help: [
          'list [-e|-s|<REP_NAME>|<REP_INDEX>]',
          'Print representations if no args print list of representations',
          '    -e expand list and show all representations',
          '    -s show all user-registered selectors',
          '    <REP_NAME>|<REP_INDEX> show only current representation'
        ]
      },
      hide: {
        $help: [
          'hide (<REP_NAME>|<REP_INDEX>)',
          'Hide representation referenced in args'
        ]
      },
      show: {
        $help: [
          'show (<REP_NAME>|<REP_INDEX>)',
          'Show representation referenced in args'
        ]
      },
      get: {
        $help: [
          'get <PARAMETER>',
          'Print <PARAMETER> value',
          '    <PARAMETER> - path to option use get.PARAMETER to get more info'
        ],
        PARAMETER: Ms
      },
      set: {
        $help: [
          'set <PARAMETER> <VALUE>',
          'Set <PARAMETER> with <VALUE>',
          '    <PARAMETER> - path to option use set.PARAMETER to get more info'
        ],
        PARAMETER: Ms
      },
      set_save: { $help: ['set_save', 'Save current settings to cookie'] },
      set_restore: {
        $help: ['set_restore', 'Load and apply settings from cookie']
      },
      set_reset: {
        $help: ['set_reset', 'Reset current settings to the defaults']
      },
      preset: {
        $help: [
          'preset [<PRESET>]',
          'Reset current representation or set preset to <PRESET>'
        ],
        PRESET: { $help: ['default', 'wire', 'small', 'macro'] }
      },
      unit: {
        $help: [
          'unit [<unit_id>]',
          'Change current biological structure view. Zero <unit_id> value means asymmetric unit,',
          'positive values set an assembly with corresponding number.',
          'Being called with no parameters command prints current unit information.'
        ]
      },
      view: {
        $help: [
          'view [<ENCODED_VIEW>]',
          'Get current encoded view or set if ENCODED_VIEW placed as argument'
        ],
        ENCODED_VIEW: { $help: ['encoded view matrix string (binary code)'] }
      },
      rotate: {
        $help: [
          'rotate (x|y|z) [<DEGREES>] [(x|y|z) [<DEGREES>]]...',
          'Rotate scene'
        ]
      },
      scale: { $help: ['scale <SCALE>', 'Scale scene'] },
      select: {
        $help: [
          'select <SELECTOR_STRING> [as <SELECTOR_NAME>]',
          'Select atoms using selector defined in SELECTOR_STRING',
          '    and if SELECTOR_NAME is defined register it in viewer',
          '    you can use it later as a complex selector'
        ]
      },
      within: {
        $help: [
          'within <DISTANCE> of <SELECTOR_STRING> as <SELECTOR_NAME>',
          'Build within named selector',
          '    DISTANCE        <number>',
          '    SELECTOR_STRING <string(selection language)>',
          '    SELECTOR_NAME   <identifier>'
        ]
      },
      url: {
        $help: [
          'url [-s] [-v]',
          'Report URL encoded scene',
          '    if -s set that include settings in the URL',
          '    if -v set that include view in the URL'
        ]
      },
      screenshot: {
        $help: [
          'screenshot [<WIDTH> [<HEIGHT>]]',
          'Make a screenshot of the scene',
          '    WIDTH  <number> in pixels',
          '    HEIGHT <number> in pixels, equal to WIDTH by default'
        ]
      },
      line: {
        $help: [
          'line <first_atom_path> <second_atom_path> [<PARAMETER>=<VALUE>]',
          'Draw dashed line between two specified atoms'
        ]
      },
      removeobj: {
        $help: [
          'removeobj <id>',
          'Remove scene object by its index. Indices could be obtained by <listobj> command'
        ]
      },
      listobj: {
        $help: ['listobj', 'Display the list of all existing scene objects']
      }
    },
    Rd = rd.chem.selectors,
    Cd = rd.modes,
    Ad = rd.colorers,
    Ed = rd.materials,
    kd = rd.palettes,
    Td = rd.options,
    Pd = rd.settings
  function Md() {}
  var Nd,
    Ld =
      ((Nd = new Md()),
      function () {
        return Nd
      }),
    mo = new ((function () {
      function e() {
        G(this, e), (this.representationMap = {}), (this.representationID = {})
      }
      return (
        p(e, [
          {
            key: 'get',
            value: function (e) {
              return (
                this.representationMap[e] ||
                this.representationID[e] ||
                '<no name>'
              )
            }
          },
          {
            key: 'add',
            value: function (e, t) {
              if (-1 === e)
                return 'Can not create representation: there is no data'
              if (void 0 !== t) {
                if (this.representationMap.hasOwnProperty(e))
                  return 'This name has already existed, registered without name'
                ;(this.representationMap[e.toString()] = t),
                  (this.representationID[t] = e.toString())
              }
              return 'Representation '.concat(e, ' successfully added')
            }
          },
          {
            key: 'remove',
            value: function (e) {
              e &&
                this.representationID.hasOwnProperty(e) &&
                (delete this.representationMap[this.representationID[e]],
                delete this.representationID[e])
              var t,
                r,
                n = Object.keys(this.representationID).sort()
              for (t in n)
                !n.hasOwnProperty(t) ||
                  (e < (r = n[t]) &&
                    ((this.representationID[r - 1] = this.representationID[r]),
                    --this.representationMap[this.representationID[r]],
                    delete this.representationID[r]))
            }
          },
          {
            key: 'clear',
            value: function () {
              ;(this.representationMap = {}), (this.representationID = {})
            }
          }
        ]),
        e
      )
    })())()
  function Id(e) {
    var t = {
      s: 'selector',
      m: 'mode',
      c: 'colorer',
      mt: 'material',
      mode: 'modes',
      color: 'colorers',
      colorer: 'colorers',
      select: 'selector',
      material: 'materials',
      selector: 'selector'
    }[e]
    return void 0 === t ? e : t
  }
  _o = new ((function () {
    function e() {
      G(this, e)
    }
    return (
      p(e, [
        {
          key: 'list',
          value: function (e, t, r) {
            var n = ''
            if (e && void 0 !== t && (void 0 === r || '-e' === r))
              for (var i = e.repCount(), o = 0; o < i; o++)
                n += this.listRep(e, t, o, r)
            return n
          }
        },
        {
          key: 'listRep',
          value: function (e, t, r, n) {
            var i = '',
              o = e.repGet(r)
            if (!o) return L.warn('Rep '.concat(r, ' does not exist!')), i
            var s = r,
              a = t.get(s),
              e = o.mode,
              r = o.colorer,
              t = o.selectorString,
              o = o.materialPreset
            return (
              (i += '#'
                .concat(s, ' : ')
                .concat(e.name)
                .concat('<no name>' === a ? '' : ', '.concat(a), '\n')),
              void 0 !== n &&
                ((i += '    selection : "'.concat(t, '"\n')),
                (i += '    mode      : ('
                  .concat(e.id, '), ')
                  .concat(e.name, '\n')),
                (i += '    colorer   : ('
                  .concat(r.id, '), ')
                  .concat(r.name, '\n')),
                (i += '    material  : ('
                  .concat(o.id, '), ')
                  .concat(o.name, '\n'))),
              i
            )
          }
        },
        {
          key: 'listSelector',
          value: function (e, t) {
            var r,
              n = ''
            for (r in t)
              t.hasOwnProperty(r) &&
                (n += ''.concat(r, ' : "').concat(t[r], '"\n'))
            return n
          }
        },
        {
          key: 'listObjs',
          value: function (e) {
            var t = e._objects
            if (!t || !Array.isArray(t) || 0 === t.length)
              return 'There are no objects on the scene'
            for (var r = [], n = 0, i = t.length; n < i; ++n)
              r[n] = ''.concat(n, ': ').concat(t[n].toString())
            return r.join('\n')
          }
        },
        {
          key: 'joinHelpStr',
          value: function (e) {
            return e instanceof Array ? e.join('\n') : e
          }
        },
        {
          key: 'help',
          value: function (e) {
            if (b.default.isUndefined(e))
              return ''
                .concat(this.joinHelpStr(Sd.$help), '\n')
                .concat(
                  b.default
                    .slice(b.default.sortBy(b.default.keys(Sd)), 1)
                    .join(', '),
                  '\n'
                )
            e = b.default.get(Sd, e)
            return b.default.isUndefined(e)
              ? this.help()
              : ''.concat(this.joinHelpStr(e.$help), '\n')
          }
        },
        {
          key: 'load',
          value: function (e, t) {
            var r
            void 0 !== e &&
              void 0 !== t &&
              '-f' !== t &&
              (e.awaitWhileCMDisInProcess(),
              (r = function () {
                return e.finishAwaitingCMDInProcess()
              }),
              e.load(t).then(r, r))
          }
        },
        {
          key: 'checkArg',
          value: function (e, t, r) {
            if (void 0 === e || void 0 === t) return Ld
            if ('selector' === Id(e)) {
              var n = Rd.parse(t)
              if (void 0 === n.error) return void 0 !== r && r ? n.selector : t
              throw { message: n.error }
            }
            for (
              var i, n = { colorers: Ad, modes: Cd, materials: Ed }, o = e;
              o !== i;

            )
              o = Id((i = o))
            if (void 0 !== n[o].get(t)) return t
            throw { message: ''.concat(t, ' is not existed in ').concat(o) }
          }
        },
        {
          key: 'propagateProp',
          value: function (e, t) {
            if (void 0 !== e) {
              var r,
                n = Td.adapters[w(b.default.get(Pd.defaults, e))]
              if (void 0 === n)
                throw { message: ''.concat(e, ' is not existed') }
              if (
                ((e.endsWith('.color') ||
                  e.endsWith('.baseColor') ||
                  e.endsWith('.EL.carbon')) &&
                  'number' != typeof t &&
                  (t = kd.get(Pd.now.palette).getNamedColor(t)),
                (e.endsWith('.fg') || e.endsWith('.bg')) &&
                  ('number' != typeof t
                    ? void 0 !==
                        (r = kd.get(Pd.now.palette).getNamedColor(t, !0)) &&
                      (t = '0x'.concat(r.toString(16)))
                    : (t = '0x'.concat(t.toString(16)))),
                void 0 !==
                  (t = e.endsWith('.template') ? t.replace(/\\n/g, '\n') : t) &&
                  n(t) !== t &&
                  n(t) !== 0 < t)
              )
                throw {
                  message: ''
                    .concat(e, ' must be a "')
                    .concat(w(b.default.get(Pd.defaults, e)), '"')
                }
            }
            return t
          }
        },
        {
          key: 'unquoteString',
          value: function (e) {
            return le.unquoteString(e)
          }
        }
      ]),
      e
    )
  })())()
  function Od(e) {
    if (e instanceof this.constructor) return e
    e instanceof Array
      ? (this._values = e.slice(0))
      : (this._values = e ? [e] : [])
  }
  ;(Od.prototype.append = function (e) {
    var t = this._values
    return (t[t.length] = e), this
  }),
    (Od.prototype.remove = function (e) {
      var t = this._values,
        e = t.indexOf(e)
      return 0 <= e && t.splice(e, 1), this
    }),
    (Od.prototype.toJSO = function (e, t, r) {
      for (var n = {}, i = this._values, o = 0, s = i.length; o < s; ++o)
        b.default.set(
          n,
          i[o].id,
          e.propagateProp(
            ''.concat(Id(t), '.').concat(r, '.').concat(i[o].id),
            i[o].val
          )
        )
      return n
    })
  Ms = Object.create({})
  return (
    (Ms.Arg = function (e, t) {
      ;(this.id = e), (this.val = t)
    }),
    (Ms.ArgList = Od),
    (Ms.miew = null),
    (Ms.echo = null),
    (Ms.representations = mo),
    (Ms.utils = _o),
    (Ms._ = b.default),
    (Ms.CreateObjectPair = function (e, t) {
      var r = {}
      return (r[e] = t), r
    }),
    (Ms.keyRemap = Id),
    (Ms.Context = Rd.Context),
    (Ms.ClearContext = Rd.ClearContext),
    (Ms.NULL = Ld),
    (Ms.notimplemented = function () {
      return this.NULL
    }),
    (rd.prototype.script = function (e, t, r) {
      ;(wd.parser.yy.miew = this),
        (wd.parser.yy.echo = t),
        (wd.parser.yy.error = r),
        void 0 === this.cmdQueue && (this.cmdQueue = []),
        void 0 === this.commandInAction && (this.commandInAction = !1),
        (this.cmdQueue = this.cmdQueue.concat(e.split('\n')))
    }),
    (rd.prototype.awaitWhileCMDisInProcess = function () {
      this.commandInAction = !0
    }),
    (rd.prototype.finishAwaitingCMDInProcess = function () {
      this.commandInAction = !1
    }),
    (rd.prototype.isScriptingCommandAvailable = function () {
      return (
        void 0 !== this.commandInAction &&
        !this.commandInAction &&
        void 0 !== this.cmdQueue &&
        0 < this.cmdQueue.length
      )
    }),
    (rd.prototype.callNextCmd = function () {
      if (this.isScriptingCommandAvailable()) {
        var e = this.cmdQueue.shift(),
          t = { success: !1 }
        try {
          wd.parser.parse(e), (t.success = !0)
        } catch (e) {
          ;(t.error = e.message),
            wd.parser.yy.error(t.error),
            this.finishAwaitingCMDInProcess()
        }
        return t
      }
      return ''
    }),
    (wd.parser.yy = Ms),
    (wd.parser.yy.parseError = wd.parser.parseError),
    rd
  )
})
//# sourceMappingURL=Miew.min.js.map
