!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=23)}([function(e,t,n){"use strict";e.exports=n(22)},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){"use strict";e.exports=n(15)},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(13);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(14),i=n(7);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,l=a(e),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))i.call(n,u)&&(l[u]=n[u]);if(r){s=r(n);for(var h=0;h<s.length;h++)o.call(n,s[h])&&(l[s[h]]=n[s[h]])}}return l}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE){0;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}}(),e.exports=n(16)},function(e,t,n){(function(t){var r;r=function(e,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var o=r(e),a=i(n);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},h={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",animation:"spinner-line-fade-default",rotate:0,direction:1,speed:1,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"0 0 1px transparent",position:"absolute"},f=function(){function e(e){void 0===e&&(e={}),this.opts=u(u({},h),e)}return e.prototype.spin=function(e){return this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),d(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")"}),e&&e.insertBefore(this.el,e.firstChild||null),function(e,t){var n=Math.round(t.corners*t.width*500)/1e3+"px",r="none";!0===t.shadow?r="0 2px 4px #000":"string"==typeof t.shadow&&(r=t.shadow);for(var i=function(e){for(var t=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,n=[],r=0,i=e.split(",");r<i.length;r++){var o=i[r].match(t);if(null!==o){var a=+o[2],s=+o[5],l=o[4],c=o[7];0!==a||l||(l=c),0!==s||c||(c=l),l===c&&n.push({prefix:o[1]||"",x:a,y:s,xUnits:l,yUnits:c,end:o[8]})}}return n}(r),o=0;o<t.lines;o++){var a=~~(360/t.lines*o+t.rotate),s=d(document.createElement("div"),{position:"absolute",top:-t.width/2+"px",width:t.length+t.width+"px",height:t.width+"px",background:p(t.fadeColor,o),borderRadius:n,transformOrigin:"left",transform:"rotate("+a+"deg) translateX("+t.radius+"px)"}),l=o*t.direction/t.lines/t.speed;l-=1/t.speed;var c=d(document.createElement("div"),{width:"100%",height:"100%",background:p(t.color,o),borderRadius:n,boxShadow:m(i,a),animation:1/t.speed+"s linear "+l+"s infinite "+t.animation});s.appendChild(c),e.appendChild(s)}}(this.el,this.opts),this},e.prototype.stop=function(){return this.el&&("undefined"!=typeof requestAnimationFrame?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},e}();function d(e,t){for(var n in t)e.style[n]=t[n];return e}function p(e,t){return"string"==typeof e?e:e[t%e.length]}function m(e,t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=v(o.x,o.y,t);n.push(o.prefix+a[0]+o.xUnits+" "+a[1]+o.yUnits+o.end)}return n.join(", ")}function v(e,t,n){var r=n*Math.PI/180,i=Math.sin(r),o=Math.cos(r);return[Math.round(1e3*(e*o+t*i))/1e3,Math.round(1e3*(-e*i+t*o))/1e3]}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}var x,b=function(){function e(){g(this,e),this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return _(e,[{key:"start",value:function(){this.startTime=e.now(),this.oldTime=this.startTime,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1}},{key:"getElapsedTime",value:function(){return this.update(),this.elapsedTime}},{key:"update",value:function(){var t=0;if(this.running){var n=e.now();t=.001*(n-this.oldTime),this.oldTime=n,this.elapsedTime+=t}return t}}]),e}();b.now=(x="undefined"!=typeof window&&window.performance)&&x.now?x.now.bind(x):Date.now;var w=b.now;function S(e,t,n){var r=document.createElement(e);return r.id=t,r.style.cssText=n,r}var M=function(){function e(){g(this,e),this.domElement=S("div","stats","padding:8px"),this._text=S("p","fps","margin:0;color:silver;font-size:large"),this.domElement.appendChild(this._text),this._startTime=w(),this._prevTime=this._startTime,this._deltas=new Array(20),this._index=0,this._total=0,this._count=0}return _(e,[{key:"end",value:function(){var e=w(),t=e-this._startTime;return this._count<this._deltas.length?this._count++:this._total-=this._deltas[this._index],this._total+=t,this._deltas[this._index]=t,this._index=(this._index+1)%this._deltas.length,this.ms=this._total/this._count,this.fps=1e3/this.ms,e>this._prevTime+1e3&&(this._text.textContent=this.fps.toPrecision(2),this._prevTime=e),e}},{key:"update",value:function(){this._startTime=this.end()}},{key:"show",value:function(e){void 0===e&&(e=!0),this.domElement.style.display=e?"block":"none"}}]),e}();function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t){if(t&&("object"===A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return C(e)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function k(e,t,n){return(k=L()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&E(i,n.prototype),i}).apply(null,arguments)}function I(e){var t="function"==typeof Map?new Map:void 0;return(I=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return k(e,arguments,P(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),E(r,e)})(e)}function N(e,t){return!e||e===t}function O(){this._handlers={}}O.prototype.addEventListener=function(e,t,n){var r=this._handlers[e];r||(this._handlers[e]=[],r=this._handlers[e]);var i=[t,n];void 0===o.default.find(r,(function(e){return e[0]===i[0]&&e[1]===i[1]}))&&r.push(i)},O.prototype.removeEventListener=function(e,t,n){var r=this;o.default.forEach(r._handlers,(function(i,a){o.default.remove(i,(function(i){return N(e,a)&&N(t,i[0])&&N(n,i[1]||r)}))})),this._handlers=o.default.omitBy(r._handlers,(function(e){return 0===e.length}))},O.prototype.dispatchEvent=function(e){var t=this;o.default.forEach(this._handlers[e.type],(function(n){var r=n[1]||t;n[0].apply(r,[e])}))};var D={debug:0,info:1,report:2,warn:3,error:4};function B(){O.call(this),this.console=!1,this._priority=D.warn}function z(e){if(!o.default.isNumber(e))throw new Error("Wrong log level specified!");return e}B.prototype=Object.create(O.prototype),B.prototype.constructor=B,B.prototype.instantiate=function(){return new B},Object.defineProperty(B.prototype,"level",{get:function(){var e=this;return o.default.findKey(D,(function(t){return t===e._priority}))},set:function(e){this._priority=z(D[e])}}),B.prototype.levels=function(){return Object.keys(D)},B.prototype.message=function(e,t){var n=z(D[e]);this._message(n,t)},B.prototype.debug=function(e){this._message(D.debug,e)},B.prototype.info=function(e){this._message(D.info,e)},B.prototype.report=function(e){this._message(D.report,e)},B.prototype.warn=function(e){this._message(D.warn,e)},B.prototype.error=function(e){this._message(D.error,e)},B.prototype._message=function(e,t){if(!(e<this._priority)){var n=o.default.findKey(D,(function(t){return t===e}));if(t=String(t),this.console){var r="miew:".concat(n,": ").concat(t);"error"===n?console.error(r):"warn"===n?console.warn(r):console.log(r)}this.dispatchEvent({type:"message",level:n,message:t})}};var F=new B;function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var U={DEFAULT:0,SAFARI:1};function G(e){return decodeURIComponent(e.replace(/\+/g," "))}function H(e){for(var t,n=(e=e||window.location.search).substring(e.indexOf("?")+1),r=/([^&=]+)=?([^&]*)/g,i=[];null!==(t=r.exec(n));)i.push([G(t[1]),G(t[2])]);return i}function j(e){var t=!1;this.enable=function(e){t=e};var n=0,r=Object.keys(e);function i(e,r){return function(){var i=j.spaces.substr(0,2*n);t&&F.debug("".concat(i+r," {")),n++;for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];var l=e.apply(this,a);return n--,t&&F.debug("".concat(i,"} // ").concat(r)),l}}for(var o=0,a=r.length;o<a;++o){var s=r[o],l=e[s];l instanceof Function&&"constructor"!==s&&(e[s]=i(l,s))}}j.spaces="                                                                                          ";var W=function(e){T(n,e);var t=V(n);function n(e){var r;return g(this,n),(r=t.call(this)).name="OutOfMemoryError",r.message=e,r}return n}(I(Error));function q(e){for(var t=new Uint8Array(e),n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return window.btoa(n)}function X(e){for(var t=window.atob(e),n=new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=t[r].charCodeAt(0);return n.buffer}function Y(e){if(o.default.isPlainObject(e))return!0;var t=e&&Object.getPrototypeOf(e);return!!t&&!t.hasOwnProperty("constructor")&&Y(t)}function Z(e){return e.slice(Math.max(0,e.lastIndexOf("."))||1/0)}function $(e){var t=e.split(/[:;,]/),n=t.length;return n>=3&&"base64"===t[n-2]?new Blob([X(t[n-1])]):null}var J=/^[a-zA-Z0-9_]*$/,K=['"',"",'"'],Q={browserType:U,encodeQueryComponent:function(e,t){return encodeURIComponent(e).replace(t,(function(e){return String.fromCharCode(parseInt(e.substr(1),16))})).replace(/%20/g,"+")},decodeQueryComponent:G,getUrlParameters:H,getUrlParametersAsDict:function(e){for(var t={},n=H(e),r=0;r<n.length;++r){var i=c(n[r],2),o=i[0],a=i[1];t[o]=a}return t},resolveURL:function(e){if("undefined"!=typeof URL)try{return"undefined"!=typeof window?new URL(e,window.location).href:new URL(e).href}catch(e){}if("undefined"!=typeof document){var t=document.createElement("a");return t.href=e,t.href}return e},generateRegExp:function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[t.length]=e[n].charCodeAt(0).toString(16);var i=t.join("|");return new RegExp("%(?:".concat(i,")"),"gi")},createElement:function(e,t,n){var r,i,o=document.createElement(e);if(t){var a=Object.keys(t);for(r=0,i=a.length;r<i;++r){var s=a[r];o.setAttribute(s,t[s])}}if(n)for(n instanceof Array||(n=[n]),r=0,i=n.length;r<i;++r){var l=n[r];"string"==typeof l?o.appendChild(document.createTextNode(l)):l instanceof HTMLElement&&o.appendChild(l)}return o},deriveClass:function(e,t,n,r){return e.prototype=o.default.assign(Object.create(t.prototype),{constructor:e},n),r&&o.default.assign(e,r),e},deriveDeep:function e(t,n){var r,i,o=t;if(t instanceof Array)for(o=new Array(t.length),r=0,i=t.length;r<i;++r)o[r]=e(t[r]);else if(t instanceof Object){o=Object.create(t);var a=Object.keys(t);for(r=0,i=a.length;r<i;++r){var s=a[r],l=t[s],c=e(l);c!==l&&(o[s]=c)}n&&Object.keys(o).length>0&&(o=Object.create(o))}return o},hexColor:function(e){var t="0000000".concat(e.toString(16)).substr(-6);return"#".concat(t)},DebugTracer:j,OutOfMemoryError:W,allocateTyped:function(e,t){var n=null;try{n=new e(t)}catch(e){throw e instanceof RangeError?new W(e.message):e}return n},bytesFromBase64:X,bytesToBase64:q,arrayFromBase64:function(e,t){return Array.prototype.slice.call(new t(X(e)))},arrayToBase64:function(e,t){return q(new t(e).buffer)},compareOptionsWithDefaults:function(e,t){var n=[];if(t&&e){for(var r=Object.keys(e),i=0;i<r.length;++i){var o=r[i],a=e[o];a instanceof Object||void 0===t[o]||t[o]===a||n.push("".concat(o,":").concat(a))}if(n.length>0)return"!".concat(n.join())}return""},objectsDiff:function e(t,n){var r={};return o.default.forIn(t,(function(t,i){var a=n[i];if(Y(t)&&Y(a)){var s=e(t,a);o.default.isEmpty(s)||(r[i]=s)}else o.default.isEqual(t,a)||(r[i]=t)})),r},forInRecursive:function(e,t){!function e(n,r){o.default.forIn(n,(function(n,i){var o=r+(r.length>0?".":"");n instanceof Object?e(n,o+i):void 0!==n&&t(n,o+i)}))}(e,"")},enquoteString:function(e){return o.default.isString(e)?'"'.concat(e.replace(/"/g,'\\"'),'"'):e},unquoteString:function(e){if(!o.default.isString(e))return e;if('"'===e[0]&&'"'===e[e.length-1])return(e=e.slice(1,e.length-1)).replace(/\\"/g,'"');if("'"===e[0]&&"'"===e[e.length-1])return(e=e.slice(1,e.length-1)).replace(/\\'/g,"'");throw new SyntaxError("Incorrect string format, can't unqute it")},getBrowser:function(){return navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1===navigator.userAgent.indexOf("CriOS")&&-1===navigator.userAgent.indexOf("FxiOS")?U.SAFARI:U.DEFAULT},shotOpen:function(e){"undefined"!=typeof window&&window.open().document.write('<body style="margin:0"><img src="'.concat(e,'" /></body>'))},shotDownload:function(e,t){if(e&&"data:"===e.substr(0,5))if(t||(t=["screenshot-",+new Date,".png"].join("")),"undefined"!=typeof window&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob($(e),t);else if("undefined"!=typeof document){var n=document.createElement("a");n.download=t,n.innerHTML="download",n.href=window.URL.createObjectURL($(e)),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},copySubArrays:function(e,t,n,r){for(var i=0,o=n.length;i<o;++i)for(var a=0;a<r;++a)t[i*r+a]=e[n[i]*r+a]},shallowCloneNode:function(e){var t=e.cloneNode(!0);return t.worldPos=e.worldPos,t},correctSelectorIdentifier:function(e){return J.test(e)?e:(K[1]=e,K.join(""))},getFileExtension:Z,splitFileName:function(e){var t=Z(e);return[e.slice(0,e.length-t.length),t]},download:function(e,t,n){var r=new Blob([e]);if(t||(t=["data",+new Date].join("")),t+=n?".".concat(n):r.type||".bin","undefined"!=typeof window&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(r,t);else if("undefined"!=typeof document){var i=document.createElement("a");i.download=t,i.innerHTML="download",i.href=window.URL.createObjectURL(r),document.body.appendChild(i),i.click(),document.body.removeChild(i)}},concatTypedArraysUnsafe:function(e,t){var n=new e.constructor(e.length+t.length);return n.set(e),n.set(t,e.length),n},mergeTypedArraysUnsafe:function(e){if(e.length<=0)return null;for(var t=e.reduce((function(e,t){return e+t.length}),0),n=new e[0].constructor(t),r=0,i=0;r<e.length;r++){var o=e[r].length;n.set(e[r],i),i+=o}return n}};function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var te=function(e){T(n,e);var t=ee(n);function n(){var e;return g(this,n),(e=t.call(this))._shouldCancel=!1,e}return _(n,[{key:"cancel",value:function(){this._shouldCancel=!0,this.dispatchEvent({type:"cancel"})}},{key:"shouldCancel",value:function(){return this._shouldCancel}},{key:"notify",value:function(e){this.dispatchEvent({type:"notification",slaveEvent:e})}}]),n}(O),ne={modes:{BS:{atom:.23,bond:.15,space:.5,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},VW:{polyComplexity:{poor:4,low:6,medium:8,high:16,ultra:32}},LN:{multibond:!0,showarom:!0,offsarom:.2,chunkarom:10,atom:.23,lineWidth:2},LC:{bond:.2,space:0,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},SA:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},SE:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},QS:{isoValue:.5,gaussLim:{poor:1.5,low:2,medium:2.5,high:3,ultra:4},scale:1,wireframe:!1,gridSpacing:{poor:2,low:1.5,medium:1,high:.5,ultra:.25},subset:"",zClip:!1},CS:{probeRadius:1.4,isoValue:1.5,wireframe:!1,probePositions:30,polyComplexity:{poor:.5,low:1,medium:1.5,high:1.75,ultra:2},subset:"",zClip:!1},TR:{radius:.3,polyComplexity:{poor:12,low:16,medium:32,high:64,ultra:64}},TU:{radius:.3,heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},CA:{radius:.3,depth:.25,ss:{helix:{width:1,arrow:2},strand:{width:1,arrow:2}},heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},TX:{template:"{{Chain}}.{{Residue}}{{Sequence}}.{{Name}}",horizontalAlign:"center",verticalAlign:"middle",dx:0,dy:0,dz:1,fg:"none",bg:"0x202020",showBg:!0},VD:{kSigma:1,kSigmaMed:2,kSigmaMax:4,frame:!0,isoMode:!1,polyComplexity:{poor:2,low:3,medium:4,high:8,ultra:10}}},colorers:{EL:{carbon:-1},UN:{color:16777215},CO:{subset:"charged",color:16711680,baseColor:16777215},CB:{color:9474192,factor:.6},SQ:{gradient:"rainbow"},TM:{gradient:"temp",min:5,max:40},OC:{gradient:"reds"},HY:{gradient:"blue-red"},MO:{gradient:"rainbow"}},antialias:!0,camFov:45,camNear:.5,camFar:100,camDistance:2.5,radiusToFit:1,fogNearFactor:.5,fogFarFactor:1,fogAlpha:1,fogColor:0,fogColorEnable:!1,palette:"JM",resolution:"medium",autoResolution:!1,autoPreset:!0,preset:"default",presets:{default:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],empty:[],wire:[{mode:"LN",colorer:"EL",selector:"all",material:"SF"}],small:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],macro:[{mode:"CA",colorer:"SS",selector:"not hetatm",material:"SF"},{mode:"BS",colorer:"EL",selector:"hetatm and not water",material:"SF"}]},objects:{line:{color:4294967295,dashSize:.3,gapSize:.05}},bg:{color:2105376,transparent:!1},draft:{clipPlane:!1,clipPlaneFactor:.5,clipPlaneSpeed:3e-5},plugins:{},axes:!0,fog:!0,fps:!0,zSprites:!0,isoSurfaceFakeOpacity:!0,suspendRender:!0,nowater:!1,autobuild:!0,fxaa:!0,outline:{on:!1,color:0,threshold:.1,thickness:1},ao:!1,shadow:{on:!1,type:"random",radius:1},autoRotation:0,maxfps:30,fbxprec:4,autoRotationAxisFixed:!0,zooming:!0,picking:!0,pick:"atom",editing:!1,aromatic:!1,singleUnit:!0,stereo:"NONE",interpolateViews:!0,transparency:"prepass",translationSpeed:2,debug:{example:3.5,text:"hello!",good:!0,ssaoKernelRadius:.7,ssaoFactor:.7,stereoBarrel:.25},use:{multiFile:!1}};function re(){O.call(this),this.old=null,this.now={},this._changed={},this.reset()}Q.deriveClass(re,O,{defaults:ne,set:function(e,t){if(o.default.isString(e))o.default.get(this.now,e)!==t&&(o.default.set(this.now,e,t),this._notifyChange(e,t));else{var n=Q.objectsDiff(e,this.now);o.default.isEmpty(n)||(o.default.merge(this.now,n),this._notifyChanges(n))}},get:function(e,t){return o.default.get(this.now,e,t)},reset:function(){var e=Q.objectsDiff(ne,this.now);this.now=o.default.cloneDeep(ne),this.old=null,this._notifyChanges(e),this._changed={}},checkpoint:function(){this.old=o.default.cloneDeep(this.now),this._changed={}},_notifyChange:function(e,t){this._changed[e]=!0,this.dispatchEvent({type:"change:".concat(e),value:t})},_notifyChanges:function(e){var t=this;Q.forInRecursive(e,(function(e,n){t._notifyChange(n,e)}))},changed:function(){if(!this.old)return[];var e=this.old,t=this.now;return o.default.filter(Object.keys(this._changed),(function(n){return o.default.get(e,n)!==o.default.get(t,n)}))},applyDiffs:function(e){if(e.hasOwnProperty("VERSION")&&0!==e.VERSION)throw new Error("Settings version does not match!");delete e.VERSION,this.reset(),this.set(e)},getDiffs:function(e){var t=Q.objectsDiff(this.now,ne);return e&&(t.VERSION=0),t},setPluginOpts:function(e,t){ne.plugins[e]=o.default.cloneDeep(t),this.now.plugins[e]=o.default.cloneDeep(t)}});var ie=new re,oe=0;function ae(e){return!(!e||"0"===e||o.default.isString(e)&&"false"===e.toLowerCase())}var se={string:String,number:Number,boolean:ae},le=Q.generateRegExp("$;@/?:,");function ce(e){return Q.encodeQueryComponent(e,le)}var ue=Q.generateRegExp("$;@/? ");function he(e){return Q.encodeQueryComponent(e,ue)}function fe(e){var t=e.reps;if(!t){var n=ie.now.presets,r=e.preset||ie.now.preset;(t=n[r])||(F.warn('Unknown preset "'.concat(r,'"')),t=n[r=c(Object.keys(n),1)[0]]),e.preset=r,e.reps=Q.deriveDeep(t,!0)}}function de(e,t,n){fe(e);var r=e.reps[oe];r.hasOwnProperty(t)&&(oe=e.reps.length,e.reps[oe]=Q.deriveDeep(r,!0)),void 0!==n&&(e.reps[oe][t]=n)}function pe(e,t,n){if(e){var r=e.indexOf("!"),i=function(e,t){var n=e.indexOf(",");return n>=0?(t.push(e.substr(n+1).split(",")),e.substr(0,n)):e}(e.substr(0,r>=0?r:void 0),n);if(r>=0){var a=e.substr(r+1).split(",");if(e=i,t){var s=t[e],l=Q.deriveDeep(s,!0);a.forEach((function(t){var n=t.split(":",2),r=decodeURIComponent(n[0]),i=decodeURIComponent(n[1]),a=se[A(o.default.get(s,r))];a?o.default.set(l,r,a(i)):F.warn('Unknown argument "'.concat(r,'" for option "').concat(e,'"'))})),Object.keys(l).length>0&&(e=[e,l])}}else e=i}return e}var me={l:"load",load:String,t:"type",type:String,v:"view",view:String,u:"unit",unit:Number,menu:ae,o:"object",object:function(e,t){var n=[],r=pe(e,ie.defaults.objects,n);Array.isArray(r)||(r=[r]),function(e,t,n){void 0===e._objects&&(e._objects=[]);var r=c(n,2),i=r[0],o=r[1],a={type:i,params:t};void 0!==o&&(a.opts=o),e._objects[e._objects.length]=a}(t,n[0],r)},p:"preset",preset:function(e,t){t.preset=e,t.reps=null,fe(t)},r:"rep",rep:function(e,t){fe(t),(oe=(oe=Number(e))<=t.reps.length?oe<0?0:oe:t.reps.length)===t.reps.length&&(t.reps[oe]=oe>0?Q.deriveDeep(t.reps[oe-1],!0):Q.deriveDeep(ie.defaults.presets.default[0],!0))},s:"select",select:function(e,t){de(t,"selector",e)},m:"mode",mode:function(e,t){de(t,"mode",pe(e,ie.defaults.modes))},c:"color",color:function(e,t){de(t,"colorer",pe(e,ie.defaults.colorers))},mt:"material",material:function(e,t){de(t,"material",pe(e,ie.defaults.materials))},dup:function(e,t){fe(t);var n=t.reps,r=n[oe];n[oe=n.length]=Q.deriveDeep(r,!0)},ar:"autoResolution"};function ve(e){oe=0;for(var t={},n=0,r=e.length;n<r;++n){for(var i=e[n],a=i[0],s=i[1],l=me[a];o.default.isString(l);)l=me[a=l];if(l){if(o.default.isFunction(l)){var c=l(s,t);void 0!==c&&(t[a]=c)}}else{var u=se[A(o.default.get(ie.defaults,a))];u?o.default.set(t,"settings.".concat(a),u(s)):F.warn('Unknown option "'.concat(a,'"'))}}return t}function ge(e){var t=[],n=0;return Q.forInRecursive(e,(function(e,r){t[n++]=he(r)+":"+he(e)})),t.join(",")}function ye(e){return o.default.isArray(e)?e.length<2?e[0]:"".concat(e[0]).concat("!").concat(ge(e[1])):e}function _e(e){if(e&&e.type){var t=e.type;return o.default.isArray(e.params)&&e.params.length>0&&(t+=",".concat(e.params.join(","))),e.opts&&(t+="!"+ge(e.opts)),t}}function xe(e){var t=[],n=0;return Q.forInRecursive(e,(function(e,r){t[n++]="".concat(r,"=").concat(Q.enquoteString(e))})),t.join(" ")}function be(e){return o.default.isArray(e)?e.length<2?e[0]:"".concat(e[0]," ").concat(xe(e[1])):e}function we(e){if(e&&e.type){var t=e.type;return o.default.isArray(e.params)&&e.params.length>0&&(t+=" ".concat(e.params.map(Q.enquoteString).join(" "))),e.opts&&(t+=" ".concat(xe(e.opts))),t}}function Se(e,t){var n=[],r=0;function i(e,t){null!=t&&(n[r++]=e+t)}return o.default.isEmpty(e)?null:(i("",t),i("s=",Q.enquoteString(e.selector)),i("m=",be(e.mode)),i("c=",be(e.colorer)),i("mt=",be(e.material)),n.join(" "))}var Me={fromURL:function(e){return ve(Q.getUrlParameters(e))},fromAttr:function(e){return ve(Q.getUrlParameters("?".concat(e||"")))},adapters:se,toURL:function(e){var t=[],n=0;function r(e,r){null!=r&&(t[n++]=ce(e)+"="+ce(r))}r("l",e.load),r("u",e.unit),r("p",e.preset),function(e){if(e)for(var t=0,n=e.length;t<n;++t)o.default.isEmpty(e[t])||(r("r",t),r("s",e[t].selector),r("m",ye(e[t].mode)),r("c",ye(e[t].colorer)),r("mt",ye(e[t].material)))}(e.reps),function(e){if(e)for(var t=0,n=e.length;t<n;++t)r("o",_e(e[t]))}(e._objects),r("v",e.view),Q.forInRecursive(e.settings,(function(e,t){"preset"!==t&&r(t,e)}));var i="";if("undefined"!=typeof window){var a=window.location;i="".concat(a.protocol,"//").concat(a.host).concat(a.pathname)}return t.length>0&&(i+="?".concat(t.join("&"))),i},toScript:function(e){var t=[],n=0;function r(e,r,i){if(null!=r){var o="string"==typeof r&&i?'"':"";t[n++]="".concat(e," ").concat(o).concat(r).concat(o).trim()}}return r("set","autobuild false"),r("load",e.load,!0),r("unit",e.unit),r("preset",e.preset),function(e){if(e)for(var t=0,n=e.length;t<n;++t)r("rep",Se(e[t],t))}(e.reps),function(e){if(e)for(var t=0,n=e.length;t<n;++t)r("",we(e[t]))}(e._objects),Q.forInRecursive(e.settings,(function(e,t){"preset"!==t&&r("set ".concat(t),e,!0)})),r("view",e.view),r("set","autobuild true"),t.join("\n")}};function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Te=function(){function e(t,n,r,i,o,a,s,l,c,u,h){g(this,e),this.index=-1,this.residue=t,this.name=n,this.element=r,this.position=i,this.role=o,this.mask=1,this.het=a,this.serial=s,this.location=(l||" ").charCodeAt(0),this.occupancy=c||1,this.temperature=u,this.charge=h,this.hydrogenCount=-1,this.radicalCount=0,this.valence=-1,this.bonds=[],this.flags=0,"H"===r.name?this.flags|=e.Flags.HYDROGEN:"C"===r.name&&(this.flags|=e.Flags.CARBON)}return _(e,[{key:"isHet",value:function(){return this.het}},{key:"isHydrogen",value:function(){return 1===this.element.number}},{key:"getVisualName",value:function(){var e=this.name;return e.length>0?e:this.element.name.trim()}},{key:"forEachBond",value:function(e){for(var t=this.bonds,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"getFullName",value:function(){var e="";return null!==this.residue&&(null!==this.residue._chain&&(e+="".concat(this.residue._chain.getName(),".")),e+="".concat(this.residue._sequence,".")),e+=this.name}}]),e}();Ee(Te,"Flags",{CARBON:1,HYDROGEN:8,NONPOLARH:4104});var Ae=function e(t,n,r,i,o,a,s){g(this,e),this.number=t,this.name=n,this.fullName=r,this.weight=i,this.radius=o,this.radiusBonding=a,this.hydrogenValency=s};Ee(Ae,"Constants",{U1:1,Lead:2,U2:3,Wing:4,U18:18}),Ee(Ae,"Role",{N:Ae.Constants.U1,CA:Ae.Constants.Lead,C:Ae.Constants.U2,O:Ae.Constants.Wing,SG:Ae.Constants.U18}),Ee(Ae,"ByAtomicNumber",[null,new Ae(1,"H","Hydrogen",1.008,1.2,.23,[1]),new Ae(2,"HE","Helium",4.003,1.4,.93,[0]),new Ae(3,"LI","Lithium",6.941,1.82,.68,[1]),new Ae(4,"BE","Beryllium",9.012,1.7,.35,[2]),new Ae(5,"B","Boron",10.81,2.08,.83,[3]),new Ae(6,"C","Carbon",12.011,1.95,.68,[4]),new Ae(7,"N","Nitrogen",14.007,1.85,.68,[3,5]),new Ae(8,"O","Oxygen",15.999,1.7,.68,[2,4]),new Ae(9,"F","Fluorine",18.998,1.73,.64,[1]),new Ae(10,"NE","Neon",20.18,1.54,1.12,[0]),new Ae(11,"NA","Sodium",22.99,2.27,.97,[1]),new Ae(12,"MG","Magnesium",24.305,1.73,1.1,[2]),new Ae(13,"AL","Aluminum",26.981,2.05,1.35,[3]),new Ae(14,"SI","Silicon",28.086,2.1,1.2,[4]),new Ae(15,"P","Phosphorus",30.974,2.08,.75,[3,5]),new Ae(16,"S","Sulfur",32.07,2,1.02,[2,4,6]),new Ae(17,"CL","Chlorine",35.453,1.97,.99,[1,3,5,7]),new Ae(18,"AR","Argon",39.948,1.88,1.57,[0]),new Ae(19,"K","Potassium",39.1,2.75,1.33,[1]),new Ae(20,"CA","Calcium",40.08,1.973,.99,[2]),new Ae(21,"SC","Scandium",44.956,1.7,1.44,[0]),new Ae(22,"TI","Titanium",47.88,1.7,1.47,[0]),new Ae(23,"V","Vanadium",50.941,1.7,1.33,[0]),new Ae(24,"CR","Chromium",52,1.7,1.35,[0]),new Ae(25,"MN","Manganese",54.938,1.7,1.35,[0]),new Ae(26,"FE","Iron",55.847,1.7,1.34,[0]),new Ae(27,"CO","Cobalt",58.93,1.7,1.33,[0]),new Ae(28,"NI","Nickel",58.69,1.63,1.5,[0]),new Ae(29,"CU","Copper",63.55,1.4,1.52,[0]),new Ae(30,"ZN","Zinc",65.39,1.39,1.45,[0]),new Ae(31,"GA","Gallium",69.72,1.87,1.22,[3]),new Ae(32,"GE","Germanium",72.61,1.7,1.17,[4]),new Ae(33,"AS","Arsenic",74.92,1.85,1.21,[3,5]),new Ae(34,"SE","Selenium",78.96,1.9,1.22,[2,4,6]),new Ae(35,"BR","Bromine",79.9,2.1,1.21,[1,3,5,7]),new Ae(36,"KR","Krypton",83.8,2.02,1.91,[0]),new Ae(37,"RB","Rubidium",85.47,1.7,1.47,[1]),new Ae(38,"SR","Strontium",87.62,1.7,1.12,[2]),new Ae(39,"Y","Yttrium",88.91,1.7,1.78,[0]),new Ae(40,"ZR","Zirconium",91.22,1.7,1.56,[0]),new Ae(41,"NB","Niobium",92.91,1.7,1.48,[0]),new Ae(42,"MO","Molybdenum",95.94,1.7,1.47,[0]),new Ae(43,"TC","Technetium",98.91,1.7,1.35,[0]),new Ae(44,"RU","Ruthenium",101.07,1.7,1.4,[0]),new Ae(45,"RH","Rhodium",102.91,1.7,1.45,[0]),new Ae(46,"PD","Palladium",106.42,1.63,1.5,[0]),new Ae(47,"AG","Silver",107.87,1.72,1.59,[0]),new Ae(48,"CD","Cadmium",112.41,1.58,1.69,[0]),new Ae(49,"IN","Indium",114.82,1.93,1.63,[3]),new Ae(50,"SN","Tin",118.71,2.17,1.46,[2,4]),new Ae(51,"SB","Antimony",121.75,2.2,1.46,[3,5]),new Ae(52,"TE","Tellurium",127.6,2.06,1.47,[2,4,6]),new Ae(53,"I","Iodine",126.91,2.15,1.4,[1,3,5,7]),new Ae(54,"XE","Xenon",131.29,2.16,1.98,[0]),new Ae(55,"CS","Cesium",132.91,1.7,1.67,[1]),new Ae(56,"BA","Barium",137.33,1.7,1.34,[2]),new Ae(57,"LA","Lanthanum",138.91,1.7,1.87,[0]),new Ae(58,"CE","Cerium",140.12,1.7,1.83,[0]),new Ae(59,"PR","Praseodymium",140.91,1.7,1.82,[0]),new Ae(60,"ND","Neodymium",144.24,1.7,1.81,[0]),new Ae(61,"PM","Promethium",144.9,1.7,1.8,[0]),new Ae(62,"SM","Samarium",150.36,1.7,1.8,[0]),new Ae(63,"EU","Europium",151.96,1.7,1.99,[0]),new Ae(64,"GD","Gadolinium",157.25,1.7,1.79,[0]),new Ae(65,"TB","Terbium",158.93,1.7,1.76,[0]),new Ae(66,"DY","Dysprosium",162.5,1.7,1.75,[0]),new Ae(67,"HO","Holmium",164.93,1.7,1.74,[0]),new Ae(68,"ER","Erbium",167.26,1.7,1.73,[0]),new Ae(69,"TM","Thulium",168.93,1.7,1.72,[0]),new Ae(70,"YB","Ytterbium",173.04,1.7,1.94,[0]),new Ae(71,"LU","Lutetium",174.97,1.7,1.72,[0]),new Ae(72,"HF","Hafnium",178.49,1.7,1.57,[0]),new Ae(73,"TA","Tantalum",180.95,1.7,1.43,[0]),new Ae(74,"W","Tungsten",183.85,1.7,1.37,[0]),new Ae(75,"RE","Rhenium",186.21,1.7,1.35,[0]),new Ae(76,"OS","Osmium",190.2,1.7,1.37,[0]),new Ae(77,"IR","Iridium",192.22,1.7,1.32,[0]),new Ae(78,"PT","Platinum",195.08,1.72,1.5,[0]),new Ae(79,"AU","Gold",196.97,1.66,1.5,[0]),new Ae(80,"HG","Mercury",200.59,1.55,1.7,[0]),new Ae(81,"TL","Thallium",204.38,1.96,1.55,[1,3]),new Ae(82,"PB","Lead",207.2,2.02,1.54,[2,4]),new Ae(83,"BI","Bismuth",208.98,1.7,1.54,[3,5]),new Ae(84,"PO","Polonium",210,1.7,1.68,[2,4,6]),new Ae(85,"AT","Astatine",210,1.7,1.7,[1,3,5,7]),new Ae(86,"RN","Radon",222,1.7,2.4,[0]),new Ae(87,"FR","Francium",223,1.7,2,[1]),new Ae(88,"RA","Radium",226.03,1.7,1.9,[2]),new Ae(89,"AC","Actinium",227.03,1.7,1.88,[0]),new Ae(90,"TH","Thorium",232.04,1.7,1.79,[0]),new Ae(91,"PA","Protactinium",231.04,1.7,1.61,[0]),new Ae(92,"U","Uranium",238.03,1.86,1.58,[0]),new Ae(93,"NP","Neptunium",237.05,1.7,1.55,[0]),new Ae(94,"PU","Plutonium",239.1,1.7,1.53,[0]),new Ae(95,"AM","Americium",243.1,1.7,1.51,[0]),new Ae(96,"CM","Curium",247.1,1.7,1.5,[0]),new Ae(97,"BK","Berkelium",247.1,1.7,1.5,[0]),new Ae(98,"CF","Californium",252.1,1.7,1.5,[0]),new Ae(99,"ES","Einsteinium",252.1,1.7,1.5,[0]),new Ae(100,"FM","Fermium",257.1,1.7,1.5,[0]),new Ae(101,"MD","Mendelevium",256.1,1.7,1.5,[0]),new Ae(102,"NO","Nobelium",259.1,1.7,1.5,[0]),new Ae(103,"LR","Lawrencium",260.1,1.7,1.5,[0]),new Ae(104,"RF","Rutherfordium",261,1.7,1.6,[0]),new Ae(105,"DB","Dubnium",262,1.7,1.6,[0]),new Ae(106,"SG","Seaborgium",263,1.7,1.6,[0]),new Ae(107,"BH","Bohrium",262,1.7,1.6,[0]),new Ae(108,"HS","Hassium",265,1.7,1.6,[0]),new Ae(109,"MT","Meitnerium",268,1.7,1.6,[0])]),Ee(Ae,"ByName",{D:new Ae(1,"D","Deuterium",2.014,1.2,.23,[1]),T:new Ae(1,"T","Tritium",3.016,1.2,.23,[1])}),function(){for(var e=Ae.ByAtomicNumber,t=Ae.ByName,n=0,r=e.length;n<r;++n){var i=e[n];i&&(t[i.name]=i)}}(),Ae.getByName=function(e){var t=Ae.ByName[e];return t||(t=Ae.ByName[e]=new Ae(0,e,"Unknown",0,1,.01,[0])),t};var Ce={UNKNOWN:0,COVALENT:1,AROMATIC:2};function Re(e){return e.position}var Pe=function(){function e(t,n,r,i,o){if(g(this,e),this._left=t,this._right=n,this._fixed=o,this._index=-1,t>n)throw new Error("In a bond atom indices must be in increasing order");this._order=r,this._type=i}return _(e,[{key:"getLeft",value:function(){return this._left}},{key:"getRight",value:function(){return this._right}},{key:"getOrder",value:function(){return this._order}},{key:"calcLength",value:function(){return this._left.position.distanceTo(this._right.position)}},{key:"_forEachNeighbour",value:function(e,t){for(var n=e.bonds,r=0,i=n.length;r<i;++r)t(n[r]._left!==e?n[r]._left:n[r]._right)}},{key:"forEachLevelOne",value:function(e){var t=this._left,n=this._right;this._forEachNeighbour(t,(function(t){t!==n&&e(t)})),this._forEachNeighbour(n,(function(n){n!==t&&e(n)}))}},{key:"forEachLevelTwo",value:function(e){var t=this._left,n=this._right,r=this;r._forEachNeighbour(t,(function(i){i!==n&&r._forEachNeighbour(i,(function(n){n!==t&&e(n)}))})),r._forEachNeighbour(n,(function(i){i!==t&&r._forEachNeighbour(i,(function(t){t!==n&&e(t)}))}))}},{key:"_fixDir",value:function(e,t,n){var r=0,i=0,o=e.clone();function a(a){o.copy(n(a)),o.sub(e),t.dot(o)>0?++r:++i}function s(e){"C"===e.element.name&&a(e)}for(var l=[[this.forEachLevelOne,s],[this.forEachLevelOne,a],[this.forEachLevelTwo,s],[this.forEachLevelTwo,a]],c=0;c<l.length;++c){if(l[c][0].call(this,l[c][1]),i>r)return t.multiplyScalar(-1);if(i<r)return t}return t}},{key:"calcNormalDir",value:function(e){var t=this._left,n=this._right,r=t,i=n;e=void 0===e?Re:e,t.bonds.length>n.bonds.length&&(r=n,i=t);for(var o=r,a=0,s=i.bonds,l=0,c=s.length;l<c;++l){var u=s[l]._left;s[l]._left===i&&(u=s[l]._right),u.bonds.length>a&&u!==r&&(o=u,a=u.bonds.length)}var h=e(i),f=e(r).clone().sub(h),d=e(o).clone().sub(h);return d.crossVectors(f,d),d.lengthSq()<1e-4&&d.set(0,1,0),f.normalize(),d.normalize(),f.crossVectors(d,f),f.lengthSq()<1e-4&&f.set(0,1,0),f.normalize(),this._fixDir(h,f,e)}}]),e}();Ee(Pe,"BondType",Ce),Pe.prototype.BondType=Ce;var Le=["C3'","C3*","P","H5T","H3T"],ke=["OP1","O1P"],Ie=["OP2","O2P"],Ne=["C3'","C3*","C1","C1'","C1*","P"],Oe=[{types:["A","DA","G","DG"],atoms:["N1"]},{types:["C","DC"],atoms:["N3"]},{types:["T","DT","U","DU"],atoms:["O4"]}],De=function(){function e(t,n,r,i){g(this,e),this._chain=t,this._component=null,this._type=n,this._sequence=r,this._icode=i,this._mask=1,this._index=-1,this._atoms=[],this._secondary=null,this._firstAtom=null,this._leadAtom=null,this._wingAtom=null,this._lastAtom=null,this._controlPoint=null,this._midPoint=null,this._wingVector=null,this._cylinders=null,this._isValid=!0,this._het=!1,this._molecule=null,this.temperature=null,this.occupancy=null}return _(e,[{key:"getChain",value:function(){return this._chain}},{key:"getMolecule",value:function(){return this._molecule}},{key:"getType",value:function(){return this._type}},{key:"getSequence",value:function(){return this._sequence}},{key:"getSecondary",value:function(){return this._secondary}},{key:"getICode",value:function(){return this._icode}},{key:"addAtom",value:function(e,t,n,r,i,o,a,s,l,c){var u=new Te(this,e,t,n,r,i,o,a,s,l,c);return this._chain.getComplex().addAtom(u),this._atoms.push(u),this._het=this._het||i,u}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"forEachAtom",value:function(e){for(var t=this._atoms,n=0,r=t.length;n<r&&!e(t[n]);++n);}},{key:"_findAtomByName",value:function(e){var t=null;return this.forEachAtom((function(n){return n.name===e&&(t=n,!0)})),t}},{key:"_findFirstAtomInList",value:function(e){for(var t=null,n=0;n<e.length;++n)if(null!==(t=this._findAtomByName(e[n])))return t;return t}},{key:"collectMask",value:function(){for(var e=4294967295,t=this._atoms,n=0,r=t.length;n<r;++n)e&=t[n].mask;this._mask=e}},{key:"getCylinderTargetList",value:function(){for(var e=this._type._name,t=0,n=Oe.length;t<n;++t)for(var r=0,i=Oe[t].types.length;r<i;++r)if(e===Oe[t].types[r])return Oe[t].atoms;return null}},{key:"_detectLeadWing",value:function(e,t,n){var r=this._findFirstAtomInList(Le),i=this._findFirstAtomInList(ke),o=this._findFirstAtomInList(Ie);if(null===i&&null!==t&&(i=t._findFirstAtomInList(ke)),null===o&&null!==t&&(o=t._findFirstAtomInList(Ie)),null!==r&&null!==i&&null!==o){e._leadAtom=r,e._controlPoint=n(r),e._wingVector=n(o).clone().sub(n(i)),e._isValid=!0;var a=this._findFirstAtomInList(Ne),s=this.getCylinderTargetList(),l=null!==s?this._findFirstAtomInList(s):null;null!==a&&null!==l&&(e._cylinders=[n(a),n(l)])}}},{key:"calcWing",value:function(e,t,n,r){var i=t.clone().sub(e),o=e.clone().sub(n);return o.crossVectors(i,o),o.crossVectors(i,o).normalize(),null!==r&&r.length()>1e-4&&o.length()>1e-4&&Math.abs(r.angleTo(o))>Math.PI/2&&o.negate(),o}},{key:"_innerFinalize",value:function(e,t,n,r,i,o){var s=null===t,l=o(this._leadAtom),c=new a.Vector3(l.x,l.y,l.z);if(i)this._detectLeadWing(r,n,o);else{if(s)r._midPoint=o(this._firstAtom).clone();else{var u=t._controlPoint;r._midPoint=u.clone().lerp(c,.5),r._wingVector=this.calcWing(u,c,o(e._wingAtom),t._wingVector)}r._controlPoint=c}}},{key:"_finalize2",value:function(e,t,n){this._innerFinalize(e,e,t,this,n,(function(e){return e.position}))}},{key:"isConnected",value:function(e){if(this._chain!==e._chain)return!1;if(this===e)return!0;var t=!1;return this.forEachAtom((function(n){for(var r=n.bonds,i=0,o=r.length;i<o;++i){var a=r[i];if(a._left.residue===e||a._right.residue===e)return t=!0,!0}return!1})),t}},{key:"_finalize",value:function(){var e=this,t=c(this._atoms,1);this._firstAtom=t[0],this._lastAtom=this._atoms[this._atoms.length-1],this._leadAtom=null,this._wingAtom=null;var n=0,r=0,i=0,o=0;this.forEachAtom((function(t){return null===e._leadAtom&&t.role===Ae.Constants.Lead&&(e._leadAtom=t),null===e._wingAtom&&t.role===Ae.Constants.Wing&&(e._wingAtom=t),t.temperature&&(r+=t.temperature,n++),t.occupancy&&(o+=t.occupancy,i++),null!==e._leadAtom&&null!==e._wingAtom})),n>0&&(this.temperature=r/n),i>0&&(this.occupancy=o/i),null!==this._leadAtom&&null!==this._wingAtom||(this._isValid=!1),null===this._leadAtom&&(this._leadAtom=this._firstAtom),null===this._wingAtom&&(this._wingAtom=this._lastAtom)}}]),e}(),Be=function(){function e(t,n,r){g(this,e),this._name=t,this._fullName=n,this.letterCode=r,this.flags=0}return _(e,[{key:"getName",value:function(){return this._name}}]),e}();function ze(e,t){for(var n=0,r=t.length;n<r;++n){var i=Be.StandardTypes[t[n]];i&&(i.flags|=e)}}Ee(Be,"StandardTypes",{ALA:new Be("ALA","Alanine","A"),ARG:new Be("ARG","Arginine","R"),ASN:new Be("ASN","Asparagine","N"),ASP:new Be("ASP","Aspartic Acid","D"),CYS:new Be("CYS","Cysteine","C"),GLN:new Be("GLN","Glutamine","Q"),GLU:new Be("GLU","Glutamic Acid","E"),GLY:new Be("GLY","Glycine","G"),HIS:new Be("HIS","Histidine","H"),ILE:new Be("ILE","Isoleucine","I"),LEU:new Be("LEU","Leucine","L"),LYS:new Be("LYS","Lysine","K"),MET:new Be("MET","Methionine","M"),PHE:new Be("PHE","Phenylalanine","F"),PRO:new Be("PRO","Proline","P"),PYL:new Be("PYL","Pyrrolysine","O"),SEC:new Be("SEC","Selenocysteine","U"),SER:new Be("SER","Serine","S"),THR:new Be("THR","Threonine","T"),TRP:new Be("TRP","Tryptophan","W"),TYR:new Be("TYR","Tyrosine","Y"),VAL:new Be("VAL","Valine","V"),A:new Be("A","Adenine","A"),C:new Be("C","Cytosine","C"),G:new Be("G","Guanine","G"),I:new Be("I","Inosine","I"),T:new Be("T","Thymine","T"),U:new Be("U","Uracil","U"),DA:new Be("DA","Adenine","A"),DC:new Be("DC","Cytosine","C"),DG:new Be("DG","Guanine","G"),DI:new Be("DI","Inosine","I"),DT:new Be("DT","Thymine","T"),DU:new Be("DU","Uracil","U"),"+A":new Be("+A","Adenine","A"),"+C":new Be("+C","Cytosine","C"),"+G":new Be("+G","Guanine","G"),"+I":new Be("+I","Inosine","I"),"+T":new Be("+T","Thymine","T"),"+U":new Be("+U","Uracil","U"),WAT:new Be("WAT","Water",""),H2O:new Be("H2O","Water",""),HOH:new Be("HOH","Water",""),DOD:new Be("DOD","Water",""),UNK:new Be("UNK","Unknown",""),UNL:new Be("UNL","Unknown Ligand","")}),Ee(Be,"Flags",{PROTEIN:1,BASIC:2,ACIDIC:4,POLAR:8,NONPOLAR:16,AROMATIC:32,NUCLEIC:256,PURINE:512,PYRIMIDINE:1024,DNA:2048,RNA:4096,WATER:65536});var Fe=Be.Flags;ze(Fe.WATER,["WAT","H2O","HOH","DOD"]),ze(Fe.PROTEIN,["ALA","ARG","ASN","ASP","CYS","GLY","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","PRO","PYL","SEC","SER","THR","TRP","TYR","VAL"]),ze(Fe.BASIC,["ARG","HIS","LYS"]),ze(Fe.ACIDIC,["ASP","GLU"]),ze(Fe.POLAR,["ASN","CYS","GLN","SER","THR","TYR"]),ze(Fe.NONPOLAR,["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL","GLY"]),ze(Fe.AROMATIC,["PHE","TRP","TYR"]),ze(Fe.NUCLEIC,["A","G","I","DA","DG","DI","+A","+G","+I","C","T","U","DC","DT","DU","+C","+T","+U"]),ze(Fe.PURINE,["A","G","I","DA","DG","DI","+A","+G","+I"]),ze(Fe.PYRIMIDINE,["C","T","U","DC","DT","DU","+C","+T","+U"]),ze(Fe.DNA,["DA","DG","DI","DC","DT","DU"]),ze(Fe.RNA,["A","G","I","C","T","U"]),function(e,t){for(var n=Object.keys(t),r=0,i=n.length;r<i;++r){var o=n[r],a=t[o];Be.StandardTypes[o][e]=a}}("hydrophobicity",{ILE:4.5,VAL:4.2,LEU:3.8,PHE:2.8,CYS:2.5,MET:1.9,ALA:1.8,GLY:-.4,THR:-.7,SER:-.8,TRP:-.9,TYR:-1.3,PRO:-1.6,HIS:-3.2,GLU:-3.5,GLN:-3.5,ASP:-3.5,ASN:-3.5,LYS:-3.9,ARG:-4.5});var Ve,Ue=0,Ge=1,He=2,je=function(){function e(t,n){g(this,e),this._complex=t,this._name=n,this._mask=1,this._index=-1,this._residues=[],this.minSequence=Number.POSITIVE_INFINITY,this.maxSequence=Number.NEGATIVE_INFINITY}return _(e,[{key:"getComplex",value:function(){return this._complex}},{key:"getName",value:function(){return this._name}},{key:"getResidues",value:function(){return this._residues}},{key:"_determineType",value:function(){var e=this._residues,t=Be.Flags,n=t.PROTEIN,r=t.NUCLEIC;this.type=Ue;for(var i=0,o=e.length;i<o;++i){var a=e[i]._type.flags;if(0!=(a&r)){this.type=He;break}if(0!=(a&n)){this.type=Ge;break}}}},{key:"findResidue",value:function(e,t){for(var n=this._residues,r=0,i=n.length;r<i;++r){var o=n[r];if(o._sequence===e&&o._icode===t)return[o,r]}return null}},{key:"_finalize",value:function(){this._determineType();for(var e=this._residues,t=null,n=0,r=e.length;n<r;++n){var i=n+1<r?e[n+1]:null,o=e[n];o._finalize2(t,i,this.type===He),t=o}if(e.length>1&&e[1]._wingVector){var s=e[1]._wingVector;e[0]._wingVector=new a.Vector3(s.x,s.y,s.z)}else e.length>0&&(e[0]._wingVector=new a.Vector3(1,0,0))}},{key:"updateToFrame",value:function(e){var t=this._residues,n=null,r=null,i=e._residues,o=t.length;function s(t){return e.getAtomPos(t.index)}for(var l=0;l<o;++l){var c=t[l],u=i[c._index],h=l+1<o?t[l+1]:null;c._innerFinalize(n,r,h,u,this.type===He,s),n=c,r=u}i[t[0]._index]._wingVector=o>1?i[t[1]._index]._wingVector:new a.Vector3(1,0,0)}},{key:"addResidue",value:function(e,t,n){var r=this._complex.getResidueType(e);null===r&&(r=this._complex.addResidueType(e));var i=new De(this,r,t,n);return this._complex.addResidue(i),this._residues.push(i),r.flags&(Be.Flags.NUCLEIC|Be.Flags.PROTEIN)&&(this.maxSequence<t&&(this.maxSequence=t),this.minSequence>t&&(this.minSequence=t)),i}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"forEachResidue",value:function(e){for(var t=this._residues,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"collectMask",value:function(){for(var e=4294967295,t=this._residues,n=0,r=t.length;n<r;++n)e&=t[n]._mask;this._mask=e}}]),e}(),We=function(){function e(t,n,r){g(this,e),this.type=t,this.generic=e.genericByType[this.type]||"loop",this.init=n,this.term=r}return _(e,[{key:"_finalize",value:function(e,t,n){if(!(this.init instanceof De&&this.term instanceof De)){for(var r=n.splitUnifiedSerial(this.init),i=n.splitUnifiedSerial(this.term),o=r.chain;o<=i.chain;o++)for(var a=r.serial;a<=i.serial;a++)for(var s=r.iCode;s<=i.iCode;s++){var l=n.getUnifiedSerial(o,a,s);t[l]&&(t[l]._secondary=this)}this.init=t[this.init],this.term=t[this.term]}}}]),e}();We.Type={STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",HELIX:"X",TURN_310:"3",TURN_ALPHA:"4",TURN_PI:"5",TURN:"T",BEND:"S",COIL:"C"},We.Generic={STRAND:"strand",HELIX:"helix",LOOP:"loop"};var qe=We.Type,Xe=We.Generic;function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}We.genericByType=(Ee(Ve={},qe.STRAND,Xe.STRAND),Ee(Ve,qe.HELIX_310,Xe.HELIX),Ee(Ve,qe.HELIX_ALPHA,Xe.HELIX),Ee(Ve,qe.HELIX_PI,Xe.HELIX),Ee(Ve,qe.HELIX,Xe.HELIX),Ve);var Ze=We.Type,$e={1:Ze.HELIX_ALPHA,3:Ze.HELIX_PI,5:Ze.HELIX_310},Je=function(e){T(n,e);var t=Ye(n);function n(e,r,i,o,a,s,l){var c;return g(this,n),(c=t.call(this,$e[e]||We.Type.HELIX,r,i)).serial=o,c.name=a,c.comment=s,c.length=l,c}return n}(We);function Ke(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}function Qe(){return(Qe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Ke(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var tt=function(e){T(n,e);var t=et(n);function n(e,r,i,o,a,s){var l;return g(this,n),(l=t.call(this,We.Type.STRAND,r,i)).sheet=e,l.sense=o,l.atomCur=a,l.atomPrev=s,l}return _(n,[{key:"_finalize",value:function(e,t,r){Qe(P(n.prototype),"_finalize",this).call(this,e,t,r);var i=this.atomCur;null===i||Number.isNaN(i)||(this.atomCur=e[i]),null===(i=this.atomPrev)||Number.isNaN(i)||(this.atomPrev=e[i])}}]),n}(We),nt=function(){function e(t,n){g(this,e),this._name=t,this._width=n,this._strands=[]}return _(e,[{key:"getName",value:function(){return this._name}},{key:"getWidth",value:function(){return this._width}},{key:"addStrand",value:function(e){this._strands.push(e),this._width=this._strands.length}},{key:"addEmptyStrand",value:function(){this._strands.push(new tt(null,null,null,null,null,null))}},{key:"_finalize",value:function(e,t,n){for(var r=this._strands,i=0,o=r.length;i<o;++i)r[i]._finalize(e,t,n);if(this._width||(this._width=r.length),r.length!==this._width)throw new Error("Sheet ".concat(this._name," is inconsistent."))}}]),e}(),rt=function(){function e(t,n,r,i,o){g(this,e),this._id=t,this._name=n,this._position=r||new a.Vector3,this._atoms=i||[],this._charge=0,this._repeat=1,this._center=null,this.xmlNodeRef=o||null}return _(e,[{key:"getName",value:function(){return this._name}},{key:"getPosition",value:function(){return this._position}},{key:"getCentralPoint",value:function(){return this._center}},{key:"_rebuildSGroupOnAtomChange",value:function(){var e=1e8;if(null!==this._center){for(var t=new a.Vector3(e,e,e),n=new a.Vector3(-e,-e,-e),r=0,i=this._atoms.length;r<i;r++){var o=this._atoms[r].position;t.set(Math.min(t.x,o.x),Math.min(t.y,o.y),Math.min(t.z,o.z)),n.set(Math.max(n.x,o.x),Math.max(n.y,o.y),Math.max(n.z,o.z))}this._center.addVectors(t,n),this._center.multiplyScalar(.5)}}}]),e}(),it="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},ot={parser:function(){var e=function(e,t,n,r){for(n=n||{},r=e.length;r--;n[e[r]]=t);return n},t=[1,4],n=[1,5],r=[1,6],i=[1,7],o=[1,8],a=[1,9],s=[1,11],l=[1,12],c=[5,7,8,11],u=[1,17],h=[1,22],f=[1,20],d=[1,21],p=[5,7,8,11,19],m={trace:function(){},yy:{},symbols_:{error:2,Program:3,Expression:4,EOF:5,Selector:6,OR:7,AND:8,NOT:9,"(":10,")":11,SELECTOR:12,NAMED_SELECTOR:13,SELECTOR_RANGED:14,RangeList:15,SELECTOR_NAMED:16,NameList:17,Range:18,",":19,NUMBER:20,":":21,Name:22,IDENTIFIER:23,STRING:24,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"OR",8:"AND",9:"NOT",10:"(",11:")",12:"SELECTOR",13:"NAMED_SELECTOR",14:"SELECTOR_RANGED",16:"SELECTOR_NAMED",19:",",20:"NUMBER",21:":",23:"IDENTIFIER",24:"STRING"},productions_:[0,[3,2],[4,1],[4,3],[4,3],[4,2],[4,3],[6,1],[6,1],[6,2],[6,2],[15,1],[15,3],[18,1],[18,3],[17,1],[17,3],[22,1],[22,1],[22,1]],performAction:function(e,t,n,r,i,o,a){var s=o.length-1;switch(i){case 1:return o[s-1];case 3:this.$=r.keyword("or")(o[s-2],o[s]);break;case 4:this.$=r.keyword("and")(o[s-2],o[s]);break;case 5:this.$=r.keyword("not")(o[s]);break;case 6:this.$=o[s-1];break;case 7:this.$=r.keyword(o[s])();break;case 8:this.$=r.GetSelector(o[s].toLowerCase().slice(1,o[s].length));break;case 9:case 10:this.$=r.keyword(o[s-1])(o[s]);break;case 11:this.$=new r.RangeList(o[s]);break;case 12:case 16:this.$=o[s-2].append(o[s]);break;case 13:this.$=new r.Range(Number(o[s]));break;case 14:this.$=new r.Range(Number(o[s-2]),Number(o[s]));break;case 15:this.$=new r.ValueList(o[s])}},table:[{3:1,4:2,6:3,9:t,10:n,12:r,13:i,14:o,16:a},{1:[3]},{5:[1,10],7:s,8:l},e(c,[2,2]),{4:13,6:3,9:t,10:n,12:r,13:i,14:o,16:a},{4:14,6:3,9:t,10:n,12:r,13:i,14:o,16:a},e(c,[2,7]),e(c,[2,8]),{15:15,18:16,20:u},{17:18,20:h,22:19,23:f,24:d},{1:[2,1]},{4:23,6:3,9:t,10:n,12:r,13:i,14:o,16:a},{4:24,6:3,9:t,10:n,12:r,13:i,14:o,16:a},e(c,[2,5]),{7:s,8:l,11:[1,25]},e(c,[2,9],{19:[1,26]}),e(p,[2,11]),e(p,[2,13],{21:[1,27]}),e(c,[2,10],{19:[1,28]}),e(p,[2,15]),e(p,[2,17]),e(p,[2,18]),e(p,[2,19]),e([5,7,11],[2,3],{8:l}),e(c,[2,4]),e(c,[2,6]),{18:29,20:u},{20:[1,30]},{20:h,22:31,23:f,24:d},e(p,[2,12]),e(p,[2,14]),e(p,[2,16])],defaultActions:{10:[2,1]},parseError:function(e,t){if(!t.recoverable){var n=new Error(e);throw n.hash=t,n}this.trace(e)},parse:function(e){var t=this,n=[0],r=[],i=[null],o=[],a=this.table,s="",l=0,c=0,u=2,h=1,f=o.slice.call(arguments,1),d=Object.create(this.lexer),p={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(p.yy[m]=this.yy[m]);d.setInput(e,p.yy),p.yy.lexer=d,p.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var v=d.yylloc;o.push(v);var g=d.options&&d.options.ranges;function y(){var e;return"number"!=typeof(e=r.pop()||d.lex()||h)&&(e instanceof Array&&(e=(r=e).pop()),e=t.symbols_[e]||e),e}"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,x,b,w,S,M,E,T,A={};;){if(x=n[n.length-1],this.defaultActions[x]?b=this.defaultActions[x]:(null==_&&(_=y()),b=a[x]&&a[x][_]),void 0===b||!b.length||!b[0]){var C="";for(S in T=[],a[x])this.terminals_[S]&&S>u&&T.push("'"+this.terminals_[S]+"'");C=d.showPosition?"Parse error on line "+(l+1)+":\n"+d.showPosition()+"\nExpecting "+T.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(l+1)+": Unexpected "+(_==h?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(C,{text:d.match,token:this.terminals_[_]||_,line:d.yylineno,loc:v,expected:T})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+_);switch(b[0]){case 1:n.push(_),i.push(d.yytext),o.push(d.yylloc),n.push(b[1]),_=null,c=d.yyleng,s=d.yytext,l=d.yylineno,v=d.yylloc;break;case 2:if(M=this.productions_[b[1]][1],A.$=i[i.length-M],A._$={first_line:o[o.length-(M||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(M||1)].first_column,last_column:o[o.length-1].last_column},g&&(A._$.range=[o[o.length-(M||1)].range[0],o[o.length-1].range[1]]),void 0!==(w=this.performAction.apply(A,[s,c,l,p.yy,b[1],i,o].concat(f))))return w;M&&(n=n.slice(0,-1*M*2),i=i.slice(0,-1*M),o=o.slice(0,-1*M)),n.push(this.productions_[b[1]][0]),i.push(A.$),o.push(A._$),E=a[n[n.length-2]][n[n.length-1]],n.push(E);break;case 3:return!0}}return!0}},v={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if((n=this._input.match(this.rules[i[o]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,i[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,i[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(e,t,n,r){switch(n){case 0:break;case 1:return 20;case 2:return 7;case 3:return 8;case 4:return 9;case 5:return 12;case 6:return 16;case 7:return 14;case 8:return 10;case 9:return 11;case 10:return 19;case 11:return 21;case 12:return"<=";case 13:return">=";case 14:return"<";case 15:return">";case 16:return t.yytext=t.yytext.substr(1,t.yyleng-2),24;case 17:return 13;case 18:return 23;case 19:return 5;case 20:return"INVALID"}},rules:[/^(?:\s+)/i,/^(?:(-?(?:[1-9][0-9]+|[0-9]))\b)/i,/^(?:OR\b)/i,/^(?:AND\b)/i,/^(?:NOT\b)/i,/^(?:((ALL|NONE|HETATM|PROTEIN|BASIC|ACIDIC|CHARGED|POLAR|NONPOLAR|AROMATIC|NUCLEIC|PURINE|PYRIMIDINE|WATER|POLARH|NONPOLARH))\b)/i,/^(?:((NAME|ELEM|TYPE|RESIDUE|ICODE|CHAIN|ALTLOC))\b)/i,/^(?:((SERIAL|SEQUENCE|RESIDX))\b)/i,/^(?:\()/i,/^(?:\))/i,/^(?:,)/i,/^(?::)/i,/^(?:<=)/i,/^(?:>=)/i,/^(?:<)/i,/^(?:>)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:(@[_A-Z0-9]+))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],inclusive:!0}}};function g(){this.yy={}}return m.lexer=v,g.prototype=m,m.Parser=g,new g}()};function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var st=function(){function e(t,n){g(this,e),this.min=t,this.max=void 0===n?t:n}return _(e,[{key:"includes",value:function(e){return this.min<=e&&e<=this.max}},{key:"toString",value:function(){var e=this.min,t=this.max;return e===t?String(e):[e,t].join(":")}},{key:"toJSON",value:function(){return[this.min,this.max]}}]),e}(),lt=function(){function e(t){if(g(this,e),t instanceof this.constructor)return t;this._values=t instanceof Array?t.slice(0):t?[t]:[]}return _(e,[{key:"append",value:function(e){var t=this._values;return t[t.length]=e,this}},{key:"remove",value:function(e){var t=this._values,n=t.indexOf(e);return n>=0&&t.splice(n,1),this}},{key:"toString",value:function(){return this._values.join(",")}},{key:"toJSON",value:function(){for(var e=this._values,t=[],n=0,r=e.length;n<r;++n){var i=e[n];t[n]=i.toJSON?i.toJSON():i}return t}}]),e}(),ct=function(e){T(n,e);var t=at(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includes",value:function(e){for(var t=this._values,n=0,r=t.length;n<r;++n)if(t[n].includes(e))return!0;return!1}}]),n}(lt),ut=[],ht=function(e){T(n,e);var t=at(n);function n(e,r){var i;g(this,n);var o=i=t.call(this,e);if(r){i.upperOnly=!0;for(var a=o._values,s=0,l=a.length;s<l;++s){var c=a[s];"string"==typeof c&&(a[s]=c.toUpperCase())}}else i.upperOnly=!1;return R(i,o)}return _(n,[{key:"includes",value:function(e){return-1!==this._values.indexOf(e)}},{key:"toString",value:function(){var e=this._values;ut.length=0;for(var t=0,n=e.length;t<n;++t)ut[t]=Q.correctSelectorIdentifier(String(e[t]));return ut.join(",")}},{key:"_validate",value:function(e){return this.upperOnly&&"string"==typeof e?e.toUpperCase():e}},{key:"append",value:function(e){return Qe(P(n.prototype),"append",this).call(this,this._validate(e)),this}},{key:"remove",value:function(e){return Qe(P(n.prototype),"remove",this).call(this,this._validate(e)),this}}]),n}(lt);function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var dt=function(){function e(){g(this,e)}return _(e,[{key:"toString",value:function(){return this.keyword}},{key:"toJSON",value:function(){return[this.name]}}]),e}();dt.prototype.name="Error",dt.prototype.keyword="error";var pt=function(e){T(n,e);var t=ft(n);function n(e){var r;return g(this,n),(r=t.call(this)).list=e,r}return _(n,[{key:"toString",value:function(){return"".concat(this.keyword," ").concat(this.list)}},{key:"toJSON",value:function(){return[this.name,this.list.toJSON()]}}]),n}(dt),mt=function(e){T(n,e);var t=ft(n);function n(e){return g(this,n),t.call(this,new ct(e))}return n}(pt),vt=function(e){T(n,e);var t=ft(n);function n(e,r){return g(this,n),t.call(this,new ht(e,!r))}return n}(pt),gt=function(e){T(n,e);var t=ft(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return!1}}]),n}(dt);gt.prototype.name="None",gt.prototype.keyword="none";var yt=function(e){T(n,e);var t=ft(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return!0}}]),n}(dt);function _t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}yt.prototype.name="All",yt.prototype.keyword="all";var xt=new gt,bt=function(e){T(n,e);var t=_t(n);function n(e){var r;return g(this,n),(r=t.call(this)).rhs=e||xt,r}return _(n,[{key:"toString",value:function(){var e=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(this.keyword," ").concat(e)}},{key:"toJSON",value:function(){return[this.name,this.rhs.toJSON()]}}]),n}(dt);bt.prototype.priority=1;var wt=function(e){T(n,e);var t=_t(n);function n(e,r){var i;return g(this,n),(i=t.call(this)).lhs=e||xt,i.rhs=r||xt,i}return _(n,[{key:"toString",value:function(){var e=this.lhs.priority&&this.lhs.priority>this.priority?"(".concat(this.lhs,")"):this.lhs,t=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(e," ").concat(this.keyword," ").concat(t)}},{key:"toJSON",value:function(){return[this.name,this.lhs.toJSON(),this.rhs.toJSON()]}}]),n}(dt);function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}wt.prototype.priority=1e3;var Mt={};function Et(e,t){var n=e.toLowerCase();t.prototype.keyword=n,t.prototype.name=e;var r=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return k(t,n)};return r.SelectorClass=t,Mt[n]=r,t}Et("Serial",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.serial)}}]),n}(mt)),Et("Name",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.name)}}]),n}(vt)),Et("AltLoc",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(String.fromCharCode(e.location))}}]),n}(vt)),Et("Elem",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.element.name)}}]),n}(vt)),Et("Residue",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.residue._type._name)}}]),n}(vt)),Et("Sequence",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.residue._sequence)}}]),n}(mt)),Et("ICode",function(e){T(n,e);var t=St(n);function n(e){return g(this,n),t.call(this,e,!0)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.residue._icode)}}]),n}(vt)),Et("ResIdx",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.residue._index)}}]),n}(mt)),Et("Chain",function(e){T(n,e);var t=St(n);function n(e){return g(this,n),t.call(this,e,!0)}return _(n,[{key:"includesAtom",value:function(e){return this.list.includes(e.residue._chain._name)}}]),n}(vt)),Et("Hetatm",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return e.het}}]),n}(dt)),Et("PolarH",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return(e.flags&Te.Flags.NONPOLARH)===Te.Flags.HYDROGEN}}]),n}(dt)),Et("NonPolarH",function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return(e.flags&Te.Flags.NONPOLARH)===Te.Flags.NONPOLARH}}]),n}(dt)),Et("All",yt),Et("None",gt);var Tt=Mt.none();function At(e,t,n){return n.prototype.priority=t,Et(e,n)}function Ct(e,t){return Et(t,function(t){T(r,t);var n=St(r);function r(){return g(this,r),n.apply(this,arguments)}return _(r,[{key:"includesAtom",value:function(t){return 0!=(t.residue._type.flags&e)}}]),r}(dt))}At("Not",1,function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return!this.rhs.includesAtom(e)}}]),n}(bt)),At("And",2,function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.lhs.includesAtom(e)&&this.rhs.includesAtom(e)}}]),n}(wt)),At("Or",3,function(e){T(n,e);var t=St(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"includesAtom",value:function(e){return this.lhs.includesAtom(e)||this.rhs.includesAtom(e)}}]),n}(wt)),Ct(Be.Flags.PROTEIN,"Protein"),Ct(Be.Flags.BASIC,"Basic"),Ct(Be.Flags.ACIDIC,"Acidic"),Ct(Be.Flags.BASIC|Be.Flags.ACIDIC,"Charged"),Ct(Be.Flags.POLAR,"Polar"),Ct(Be.Flags.NONPOLAR,"NonPolar"),Ct(Be.Flags.AROMATIC,"Aromatic"),Ct(Be.Flags.NUCLEIC,"Nucleic"),Ct(Be.Flags.PURINE,"Purine"),Ct(Be.Flags.PYRIMIDINE,"Pyrimidine"),Ct(Be.Flags.WATER,"Water");var Rt=Object.create(Mt);Rt.Selector=dt,Rt.RangeListSelector=mt,Rt.ValueListSelector=vt,Rt.Range=st,Rt.RangeList=ct,Rt.ValueList=ht,Rt.PrefixOperator=bt,Rt.InfixOperator=wt,Rt.Context=Object.create({}),Rt.GetSelector=function(e){if(!Rt.Context.hasOwnProperty(e))throw{message:"selector ".concat(e," is not registered")};return Rt.Context[e]||Tt},Rt.ClearContext=function(){Object.keys(Rt.Context).forEach((function(e){delete Rt.Context[e]}))},Rt.keyword=function(e){return Mt[e.toLowerCase()]||Mt.none},Rt.parse=function(e){var t={};try{t.selector=ot.parser.parse(e)}catch(e){t.selector=Tt,t.error=e.message}return t},ot.parser.yy=Rt,ot.parser.yy.parseError=ot.parser.parseError;var Pt=function(){function e(t){g(this,e),this._complex=t,this._selector=Rt.keyword("All")(),this._boundaries={boundingBox:new a.Box3,boundingSphere:new a.Sphere}}return _(e,[{key:"computeBoundaries",value:function(){var e=this._complex._atoms,t=e.length,n=this._selector,r=this._boundaries.boundingBox;if(r.makeEmpty(),1===t){r.expandByPoint(e[0].position);var i=new a.Vector3;r.getCenter(i);var o=2*e[0].element.radius;r.setFromCenterAndSize(i,new a.Vector3(o,o,o))}else for(var s=0;s<t;++s)n.includesAtom(e[s])&&r.expandByPoint(e[s].position);var l=0,c=new a.Vector3;if(r.getCenter(c),1===t)this._boundaries.boundingSphere.set(c,e[0].element.radius);else{for(var u=0;u<t;++u)if(n.includesAtom(e[u])){var h=e[u].position,f=c.distanceToSquared(h);l<f&&(l=f)}this._boundaries.boundingSphere.set(c,Math.sqrt(l))}}},{key:"getTransforms",value:function(){return[]}},{key:"getSelector",value:function(){return this._selector}},{key:"getBoundaries",value:function(){return this._boundaries}},{key:"finalize",value:function(){}}]),e}();function Lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var kt=function(e){T(n,e);var t=Lt(n);function n(e){var r;return g(this,n),(r=t.call(this,e)).chains=[],r.matrices=[],r}return _(n,[{key:"computeBoundaries",value:function(){Qe(P(n.prototype),"computeBoundaries",this).call(this);var e=this.matrices,t=this._boundaries.boundingSphere.center,r=this._boundaries.boundingSphere.radius,i=this._boundaries.boundingBox=new a.Box3;i.makeEmpty();for(var o=0,s=e.length;o<s;++o)i.expandByPoint(t.clone().applyMatrix4(e[o]));var l=i.max.distanceTo(i.min)/2+r,c=new a.Vector3;i.getCenter(c),this._boundaries.boundingSphere=(new a.Sphere).set(c,l),i.max.addScalar(r),i.min.subScalar(r)}},{key:"addChain",value:function(e){this.chains[this.chains.length]=e}},{key:"addMatrix",value:function(e){this.matrices[this.matrices.length]=e}},{key:"getTransforms",value:function(){return this.matrices}},{key:"finalize",value:function(){this.chains.length>0?this._selector=Rt.keyword("Chain")(this.chains):this._selector=Rt.keyword("None")()}}]),n}(Pt),It=function(){function e(t){g(this,e),this._complex=t,this._index=-1,this._residueIndices=[],this._cycles=[],this._subDivs=[],this._residueCount=0}return _(e,[{key:"getResidues",value:function(){return this._complex._residues}},{key:"getResidueCount",value:function(){return this._residueCount}},{key:"forEachResidue",value:function(e){for(var t=this._complex._residues,n=this._residueIndices,r=0,i=n.length;r<i;++r)for(var o=n[r].start,a=n[r].end;o<=a;++o)e(t[o])}},{key:"setSubDivs",value:function(e){this._subDivs=e;for(var t=0,n=[],r=0,i=0,o=e.length;i<o;++i)if(i===o-1||e[i].end+1!==e[i+1].start){var a=e[t].start,s=e[i].end;n[n.length]={start:a,end:s},r+=s-a+1,t=i+1}this._residueIndices=n,this._residueCount=r}},{key:"getComplex",value:function(){return this._complex}},{key:"forEachBond",value:function(e){for(var t=this._complex._bonds,n=0,r=t.length;n<r;++n){var i=t[n];i._left.residue._component===this&&e(i)}}},{key:"update",value:function(){this.forEachCycle((function(e){e.update()}))}},{key:"forEachAtom",value:function(e){this.forEachResidue((function(t){t.forEachAtom(e)}))}},{key:"addCycle",value:function(e){this._cycles.push(e)}},{key:"forEachCycle",value:function(e){for(var t=this._cycles,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"markResidues",value:function(){var e=this;e.forEachResidue((function(t){t._component=e}))}},{key:"_forEachSubChain",value:function(e,t){for(var n=this._complex._residues,r=this._subDivs,i=0,o=r.length;i<o;++i)for(var a=r[i].start,s=r[i].end;a<=s;++a){var l=n[a];if(e&l._mask&&l._isValid){for(var c=a+1;c<=s;++c){var u=n[c];if(!(e&u._mask&&u._isValid))break}t(i,a,c-1),a=c}}}},{key:"getMaskedSequences",value:function(e){var t=[],n=0;return this._forEachSubChain(e,(function(e,r,i){t[n++]={start:r,end:i}})),t}},{key:"getMaskedSubdivSequences",value:function(e){var t=[],n=-1,r=-1,i=this._subDivs;return this._forEachSubChain(e,(function(e,o,a){r!==e&&(++n,t[n]={arr:[],boundaries:i[e]},r=e),t[n].arr[t[n].arr.length]={start:o,end:a}})),t}}]),e}(),Nt=function(){function e(t){g(this,e),this.numPairs=0,this.numMaxPairs=t,this.intBuffer=Q.allocateTyped(Int32Array,4*t);for(var n=0;n<4*t;n++)this.intBuffer[n]=-1;this.hashBuffer=Q.allocateTyped(Int32Array,33554432);for(var r=0;r<33554432;r++)this.hashBuffer[r]=-1}return _(e,[{key:"destroy",value:function(){this.intBuffer=null,this.hashBuffer=null}},{key:"addPair",value:function(e,t){for(var n=e<t?e:t,r=e>t?e:t,i=n+(r<<14),o=32*(n+89237*r&1048575),a=0;a<32;a++){var s=this.hashBuffer[o+a];if(-1===s)break;if(s===i)return!1}if(a>=32)throw new Error("addPair: increase cMaxPairsForHashCode");if(this.hashBuffer[o+a]=i,this.numPairs>=this.numMaxPairs)throw new Error("addPair: increase num pairs");return o=4*this.numPairs,this.intBuffer[o]=n,this.intBuffer[o+1]=r,this.intBuffer[o+2]=i,this.numPairs++,!0}}]),e}();function Ot(e){var t=e.element;if(t)return t.radiusBonding;throw new Error("_getBondingRadius: Logic error.")}var Dt,Bt,zt,Ft=function(){function e(t){g(this,e),this._complex=t,this._maxRad=1.8;var n=this._complex.getDefaultBoundaries().boundingBox;this._vBoxMin=n.min.clone(),this._vBoxMax=n.max.clone(),this._pairCollection=null}return _(e,[{key:"_addExistingPairs",value:function(){for(var e=this._complex.getAtoms(),t=e.length,n=0,r=this._pairCollection;n<t;n++)for(var i=e[n].bonds,o=i.length,a=0;a<o;a++){var s=i[a];s._left.index===n&&r.addPair(n,s._right.index)}return 0}},{key:"_findPairs",value:function(){var e=this._complex.getVoxelWorld();if(null!==e)for(var t,n,r,i,o,a,s=this._complex._atoms,l=s.length,c=this,u=function(e){if(!n||!e.isHydrogen()){var a=e.location;if(32===i||32===a||i===a){var s=r.distanceToSquared(e.position),l=e.element.radiusBonding,u=t+l+.45;s>u*u||s<.001||c._pairCollection.addPair(o.index,e.index)}}},h=0;h<l;++h)o=s[h],(!(a=o).isHet()||a.bonds&&0===a.bonds.length)&&(t=o.element.radiusBonding,n=o.isHydrogen(),r=o.position,i=o.location,e.forEachAtomWithinRadius(r,2*this._maxRad+.45,u))}},{key:"_addPairs",value:function(){for(var e=this._complex._atoms,t=0,n=0;t<this._pairCollection.numPairs;t++,n+=4){var r=this._pairCollection.intBuffer[n],i=this._pairCollection.intBuffer[n+1];this._addPair(e[r],e[i])}}},{key:"_addPair",value:function(e,t){for(var n=e.bonds,r=e.index,i=t.index,o=0,a=n.length;o<a;++o){var s=n[o];if(s._left.index===i||s._right.index===i)return}var l=r<i?e:t,c=r<i?t:e,u=this._complex.addBond(l,c,0,Pe.BondType.UNKNOWN,!1);n.push(u),t.bonds.push(u)}},{key:"build",value:function(){this._buildInner()}},{key:"_buildInner",value:function(){var e=this._complex._atoms;if(!(e.length<2)){if(e[0].index<0)throw new Error("AutoBond: Atoms in complex were not indexed.");this._calcBoundingBox(),this._pairCollection=new Nt(4*e.length),this._addExistingPairs(),this._findPairs(),this._addPairs()}}},{key:"_calcBoundingBox",value:function(){for(var e=this._complex._atoms,t=e.length,n=Ot(e[0]),r=1;r<t;++r)n=Math.max(n,Ot(e[r]));this._vBoxMax.addScalar(n),this._vBoxMin.addScalar(-n),this._maxRad=1.2*n}},{key:"destroy",value:function(){this._pairCollection&&this._pairCollection.destroy()}}]),e}(),Vt=Pe.BondType.AROMATIC,Ut=[Ae.ByName.C.number,Ae.ByName.N.number],Gt=(Dt=new a.Vector3,Bt=new a.Vector3,zt=new a.Vector3,function(e,t){return Dt.copy(e).normalize(),Bt.copy(t).normalize(),zt.crossVectors(Dt,Bt),!(zt.length()>.1)&&Dt.dot(Bt)>=0});function Ht(e,t){for(var n=0;n<e.length&&e[n]<t;)++n;e.splice(n,0,t)}function jt(e,t){return e._left===t?e._right:e._left}function Wt(e){e._type=Vt}var qt=function(){function e(t){g(this,e),this.atoms=t,this.update()}return _(e,[{key:"update",value:function(){for(var e=this.atoms,t=new a.Vector3,n=e.length,r=0;r<n;++r)t.add(e[r].position);t.multiplyScalar(1/n),this.center=t,this.radius=t.distanceTo(e[0].position.clone().lerp(e[1].position,.5))}},{key:"forEachBond",value:function(e){var t,n=this.atoms,r=n.length,i=n[0];function o(n){n._left!==t&&n._right!==t||e(n)}for(var a=0;a<r;++a)t=n[(a+1)%r],i.forEachBond(o),i=t}}]),e}();function Xt(e){return e._type===Vt}function Yt(e){if(e.type===Vt)return!0;var t=Ut.indexOf(e._right.element.number),n=Ut.indexOf(e._left.element.number);return-1!==t&&-1!==n}function Zt(e){return e.length>3}function $t(e){return console.assert(e.length>2),!0}var Jt=function(){function e(t){g(this,e),this._complex=t;for(var n=new Array(t._bonds.length),r=new Array(t._bonds.length),i=0,o=n.length;i<o;++i)n[i]=[],r[i]=!1;this._bondsData=n,this._bondMarks=r,this._resetCycles()}return _(e,[{key:"_resetCycles",value:function(){this._cycles=[],this._currIdx=-1}},{key:"_haveSameCycle",value:function(e,t,n){for(var r=e[t._index],i=e[n._index],o=r.length,a=i.length,s=0,l=0;s<o&&l<a;){if(r[s]===i[l])return!0;r[s]>i[l]?++l:++s}return!1}},{key:"_tryBond",value:function(e,t,n){var r=[],i=this._bondsData,o=jt(e,t),s=t.position.clone().sub(o.position),l=this._currStart,c=this,u=this._bondMarks,h=this._checkBond;u[e._index]=!0,h=void 0===h?Xt:h,t.forEachBond((function(o){if(h(o)&&o!==e&&!u[o._index]&&!c._haveSameCycle(i,e,o)){var f,d,p,m=jt(o,t),v=m.position.clone().sub(t.position),g=m===l?-2:1-(d=v,p=(f=s).dot(d)/Math.sqrt(f.lengthSq()*d.lengthSq()),a.MathUtils.clamp(p,-1,1)),y=v.cross(s);if(Gt(y,n)){for(var _=0;_<r.length&&r[_].val<g;)++_;r.splice(_,0,{bond:o,val:g,dir:y})}}}));for(var f=0,d=r.length;f<d;++f){var p=r[f].bond,m=p._left===t?p._right:p._left;if(m===l)return++this._currIdx,this._cycles.push([t]),u[e._index]=!1,!0;if(this._tryBond(p,m,r[f].dir))return Ht(i[p._index],this._currIdx),this._cycles[this._currIdx].push(t),u[e._index]=!1,!0}return u[e._index]=!1,!1}},{key:"_startCycle",value:function(e){this._currStart=e._left,this._tryBond(e,e._right,new a.Vector3)&&(Ht(this._bondsData[e._index],this._currIdx),this._cycles[this._currIdx].push(e._left))}},{key:"_findLoops",value:function(e,t){this._checkBond=e;var n=this._complex,r=this;n.forEachComponent((function(n){r._resetCycles(),n.forEachBond((function(t){e(t)&&r._startCycle(t)}));for(var i=r._cycles,o=0,a=i.length;o<a;++o){var s=i[o];if(t(s)){var l=new qt(s);l.forEachBond(Wt),n.addCycle(l)}}}))}},{key:"markCycles",value:function(){this._findLoops(Xt,Zt)}},{key:"detectCycles",value:function(){this._findLoops(Yt,$t)}}]),e}();function Kt(e,t,n,r){var i=n-e.z,o=r-e.z,a=Math.sqrt(Math.max(t*t-i*i,0)),s=Math.sqrt(Math.max(t*t-o*o,0));return[Math.min(a,s),n<=e.z&&r>=e.z?t:Math.max(a,s)]}function Qt(e,t,n,r){var i=n-e.y,o=r-e.y,a=Math.sqrt(Math.max(t*t-i*i,0)),s=Math.sqrt(Math.max(t*t-o*o,0));return[Math.min(a,s),n<=e.y&&r>=e.y?t:Math.max(a,s)]}var en=function(){function e(t,n){g(this,e),this._box=t.clone();var r=new a.Vector3;t.getSize(r),this._count=r.clone().divide(n).floor().max(new a.Vector3(1,1,1)),this._last=this._count.clone().subScalar(1),this._cellSize=r.clone().divide(this._count),this._cellInnerR=.5*Math.min(Math.min(this._cellSize.x,this._cellSize.y),this._cellSize.z),this._cellOuterR=.5*Math.sqrt(this._cellSize.dot(this._cellSize));var i=this._count.x*this._count.y*this._count.z;this._voxels=Q.allocateTyped(Int32Array,i);for(var o=0;o<i;++o)this._voxels[o]=-1;this._atoms=[]}return _(e,[{key:"addAtoms",value:function(e){var t=this,n=this._atoms.length;this._atoms.length+=2*e.getAtomCount(),e.forEachAtom((function(e){var r=t._findVoxel(e.position);t._atoms[n]=e,t._atoms[n+1]=t._voxels[r],t._voxels[r]=n,n+=2}))}},{key:"_findVoxel",value:function(t){var n=e._zero,r=e._voxel;return r.copy(t).sub(this._box.min).divide(this._cellSize).floor().clamp(n,this._last),r.x+this._count.x*(r.y+this._count.y*r.z)}},{key:"_forEachAtomInVoxel",value:function(e,t){for(var n=this._voxels[e];n>=0;n=this._atoms[n+1])t(this._atoms[n])}},{key:"_forEachVoxelWithinRadius",value:function(t,n,r){var i=e._xRange,o=e._yRange,a=e._zRange;if(n/this._cellInnerR<10)this._forEachVoxelWithinRadiusSimple(t,n,r);else{var s,l,c,u,h,f,d,p;a.set(t.z-n,t.z+n),a.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor().clampScalar(0,this._count.z-1);for(var m=a.x;m<=a.y;++m){h=[this._box.min.z+m*this._cellSize.z,this._box.min.z+(m+1)*this._cellSize.z],p=t.z-n<=h[0]&&h[1]<=t.z+n,s=Kt(t,n,h[0],h[1]),o.set(t.y-s[1],t.y+s[1]),o.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor().clampScalar(0,this._count.y-1);for(var v=o.x;v<=o.y;++v){u=[this._box.min.y+v*this._cellSize.y,this._box.min.y+(v+1)*this._cellSize.y],d=t.y-s[0]<=u[0]&&u[1]<=t.y+s[0],l=Qt(t,s[1],u[0],u[1]),i.set(t.x-l[1],t.x+l[1]),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor().clampScalar(0,this._count.x-1);for(var g=i.x;g<=i.y;++g)c=[this._box.min.x+g*this._cellSize.x,this._box.min.x+(g+1)*this._cellSize.x],f=t.x-l[0]<=c[0]&&c[1]<=t.x+l[0],r(g+this._count.x*(v+this._count.y*m),f&&d&&p)}}}}},{key:"_forEachVoxelWithinRadiusSimple",value:function(t,n,r){var i=e._xRange,o=e._yRange,a=e._zRange,s=e._vCenter,l=(n+this._cellOuterR)*(n+this._cellOuterR),c=-1;n>this._cellOuterR&&(c=(n-this._cellOuterR)*(n-this._cellOuterR)),i.set(t.x-n,t.x+n),i.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor(),i.x=Math.min(Math.max(i.x,0),this._count.x-1),i.y=Math.min(Math.max(i.y,0),this._count.x-1),o.set(t.y-n,t.y+n),o.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor(),o.x=Math.min(Math.max(o.x,0),this._count.y-1),o.y=Math.min(Math.max(o.y,0),this._count.y-1),a.set(t.z-n,t.z+n),a.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor(),a.x=Math.min(Math.max(a.x,0),this._count.z-1),a.y=Math.min(Math.max(a.y,0),this._count.z-1);for(var u=a.x;u<=a.y;++u){var h=[this._box.min.z+u*this._cellSize.z,this._box.min.z+(u+1)*this._cellSize.z];s.z=.5*(h[0]+h[1]);for(var f=o.x;f<=o.y;++f){var d=[this._box.min.y+f*this._cellSize.y,this._box.min.y+(f+1)*this._cellSize.y];s.y=.5*(d[0]+d[1]);for(var p=i.x;p<=i.y;++p){var m=[this._box.min.x+p*this._cellSize.x,this._box.min.x+(p+1)*this._cellSize.x];s.x=.5*(m[0]+m[1]);var v=t.distanceToSquared(s);v<=l&&r(p+this._count.x*(f+this._count.y*u),v<=c)}}}}},{key:"forEachAtomWithinRadius",value:function(e,t,n){var r=this,i=t*t;r._forEachVoxelWithinRadius(e,t,(function(t,o){o?r._forEachAtomInVoxel(t,n):r._forEachAtomInVoxel(t,(function(t){e.distanceToSquared(t.position)<=i&&n(t)}))}))}},{key:"forEachAtomWithinDistFromMasked",value:function(e,t,n,r){this._forEachAtomWithinDistFromGroup((function(n){e.forEachAtom((function(e){0!=(e.mask&t)&&n(e)}))}),n,r)}},{key:"forEachAtomWithinDistFromSelected",value:function(e,t,n,r){this._forEachAtomWithinDistFromGroup((function(n){e.forEachAtom((function(e){t.includesAtom(e)&&n(e)}))}),n,r)}},{key:"_forEachAtomWithinDistFromGroup",value:function(e,t,n){var r,i=this,o=t*t,a=[],s=[],l=0;e((function(e){i._forEachVoxelWithinRadius(e.position,t,(function(t,n){n?a[t]=-1:void 0===a[t]?(s.push(e),s.push(-1),a[t]=l,l+=2):-1!==a[t]&&(s.push(e),s.push(a[t]),a[t]=l,l+=2)}))}));var c=function(e){if(void 0!==a[r])if(-1!==(l=a[r])){for(;l>=0;l=s[l+1])if(e.position.distanceToSquared(s[l].position)<o){n(e);break}}else n(e)};for(r in a)a.hasOwnProperty(r)&&i._forEachAtomInVoxel(r,c)}}]),e}();Ee(en,"_zero",new a.Vector3(0,0,0)),Ee(en,"_voxel",new a.Vector3),Ee(en,"_xRange",new a.Vector2),Ee(en,"_yRange",new a.Vector2),Ee(en,"_zRange",new a.Vector2),Ee(en,"_vCenter",new a.Vector3);var tn=function(){function e(t){g(this,e),this._complex=t,this._hbonds=[],this._complex._residues.length>1e3?this._buildVW():this._build()}return _(e,[{key:"isBond",value:function(e,t){if(this._hbonds[e]){var n=c(this._hbonds[e].acceptor,2),r=n[0],i=n[1];if(r&&r.residue===t&&r.energy<-.5)return!0;if(i&&i.residue===t&&i.energy<-.5)return!0}return!1}},{key:"_build",value:function(){for(var e=0;e<this._complex._residues.length-1;++e){var t=this._complex._residues[e];if(0!=(t.getType().flags&Be.Flags.PROTEIN)){var n=null;e>0&&this._complex._residues[e-1].getType().flags&Be.Flags.PROTEIN&&t._sequence===this._complex._residues[e-1]._sequence+1&&(n=this._complex._residues[e-1]);for(var r=e+1;r<this._complex._residues.length;++r){var i=this._complex._residues[r];if(0!=(i.getType().flags&Be.Flags.PROTEIN)){var o=null;this._complex._residues[r-1].getType().flags&Be.Flags.PROTEIN&&i._sequence===this._complex._residues[r-1]._sequence+1&&(o=this._complex._residues[r-1]),this._calcHBondEnergy(n,t,i),r!==e+1&&this._calcHBondEnergy(o,i,t)}}}}}},{key:"_buildVW",value:function(){var e,t,n=this,r=this._complex._residues,i=this._complex.getVoxelWorld();if(null!==i)for(var o=new Nt(this._complex._residues.length*this._complex._residues.length/2),a=0;a<r.length-1;++a)0!=((e=r[a]).getType().flags&Be.Flags.PROTEIN)&&(!(t=a>0?r[a-1]:null)||0!=(t.getType().flags&Be.Flags.PROTEIN)&&e._sequence===t._sequence+1||(t=null),i.forEachAtomWithinRadius(this._residueGetCAlpha(e),5,s));function s(i){var a=i.residue;if(a._index!==e._index&&0!=(a.getType().flags&Be.Flags.PROTEIN)&&o.addPair(e._index,a._index)){var s=a._index>0?r[a._index-1]:null;!s||0!=(s.getType().flags&Be.Flags.PROTEIN)&&a._sequence===s._sequence+1||(s=null),n._calcHBondEnergy(t,e,a),a._index!==e._index+1&&n._calcHBondEnergy(s,a,e)}}}},{key:"_residueGetCAlpha",value:function(e){for(var t=0;t<e._atoms.length;++t){var n=e._atoms[t].name;if("CA"===n||"C1"===n)return e._atoms[t].position}return null}},{key:"_residueGetCO",value:function(e){var t=null,n=null;return e.forEachAtom((function(e){"C"===e.name?t=e.position:"O"===e.name&&(n=e.position)})),[t,n]}},{key:"_residueGetNH",value:function(e,t){var n,r=c(this._residueGetCO(e),2),i=r[0],o=r[1];if(t.forEachAtom((function(e){"N"===e.name&&(n=e.position)})),i&&o&&n){var a=i.clone();return a.sub(o),a.multiplyScalar(1/a.length()),a.add(n),[n,a]}return[null,null]}},{key:"_calcHBondEnergy",value:function(e,t,n){var r=0;if(null===e)return r;if("PRO"!==t.getType().getName()){var i=c(this._residueGetNH(e,t),2),o=i[0],a=i[1],s=c(this._residueGetCO(n),2),l=s[0],u=s[1];if(null===o||null===a||null===l||null===u)return r;var h=a.distanceTo(u),f=a.distanceTo(l),d=o.distanceTo(l),p=o.distanceTo(u);r=h<.5||f<.5||d<.5||p<.5?-9.9:-27.888/h- -27.888/f+-27.888/d- -27.888/p,(r=Math.round(1e3*r)/1e3)<-9.9&&(r=-9.9)}void 0===this._hbonds[t._index]&&(this._hbonds[t._index]={donor:[],acceptor:[]});var m=this._hbonds[t._index];m.acceptor.length<2&&m.acceptor.push({residue:n._index,energy:r}),m.acceptor.length>1&&(r<m.acceptor[0].energy?(m.acceptor[1].residue=m.acceptor[0].residue,m.acceptor[1].energy=m.acceptor[0].energy,m.acceptor[0].residue=n._index,m.acceptor[0].energy=r):r<m.acceptor[1].energy&&(m.acceptor[1].residue=n._index,m.acceptor[1].energy=r)),void 0===this._hbonds[n._index]&&(this._hbonds[n._index]={donor:[],acceptor:[]});var v=this._hbonds[n._index];return v.donor.length<2&&v.donor.push({residue:t._index,energy:r}),v.donor.length>1&&(r<v.donor[0].energy?(v.donor[1].residue=v.donor[0].residue,v.donor[1].energy=v.donor[0].energy,v.donor[0].residue=t._index,v.donor[0].energy=r):r<v.donor[1].energy&&(v.donor[1].residue=t._index,v.donor[1].energy=r)),r}}]),e}();function nn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return rn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var on,an,sn=Object.freeze({NO_BRIDGE:0,PARALLEL:1,ANTI_PARALLEL:2}),ln=Object.freeze({START:1,MIDDLE:2,END:3,START_AND_END:4}),cn=Object.freeze({STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",TURN:"T",BEND:"S",LOOP:" "}),un=function(){function e(t){g(this,e),this._complex=t,this._build()}return _(e,[{key:"_build",value:function(){this._hbonds=new tn(this._complex),this._ss=[],this._sheet=[],this._betaPartners=[],this._bend=[];for(var e=0;e<this._complex.getResidues().length;++e)this._betaPartners[e]=[];this._helixFlags=[],this._helixFlags[3]=[],this._helixFlags[4]=[],this._helixFlags[5]=[],this._chainLengths=[];for(var t=0;t<this._complex._chains.length;++t){for(var n=this._complex._chains[t].getResidues(),r=0;r<n.length&&0!=(n[r].getType().flags&Be.Flags.PROTEIN);++r);this._chainLengths[t]=r}this._buildBetaSheets();for(var i=0;i<this._complex._chains.length;++i)this._buildAlphaHelices(this._complex._chains[i].getResidues(),this._chainLengths[i],!1)}},{key:"_buildAlphaHelices",value:function(e,t,n){for(var r=3;r<=5&&!(e.length<r);++r)for(var i=0;i+r<t;++i)if(this._hbonds.isBond(e[i+r]._index,e[i]._index)){this._helixFlags[r][e[i+r]._index]=ln.END;for(var o=i+1;o<i+r;++o)void 0===this._helixFlags[r][e[o]._index]&&(this._helixFlags[r][e[o]._index]=ln.MIDDLE);this._helixFlags[r][e[i]._index]===ln.END?this._helixFlags[r][e[i]._index]=ln.START_AND_END:this._helixFlags[r][e[i]._index]=ln.START}for(var a=2;a<t-2;++a){var s=this._kappa(e[a-2],e[a],e[a+2]);this._bend[e[a]._index]=360!==s&&s>70}for(var l=1;l+4<t;++l)if(this._isHelixStart(e[l]._index,4)&&this._isHelixStart(e[l-1]._index,4))for(var c=l;c<=l+3;++c)this._ss[e[c]._index]=cn.HELIX_ALPHA;for(var u=1;u+3<t;++u)if(this._isHelixStart(e[u]._index,3)&&this._isHelixStart(e[u-1]._index,3)){for(var h=!0,f=u;h&&f<=u+2;++f)h=void 0===this._ss[e[f]._index]||this._ss[e[f]._index]===cn.HELIX_310;if(h)for(var d=u;d<=u+2;++d)this._ss[e[d]._index]=cn.HELIX_310}for(var p=1;p+5<t;++p)if(this._isHelixStart(e[p]._index,5)&&this._isHelixStart(e[p-1]._index,5)){for(var m=!0,v=p;m&&v<=p+4;++v)m=void 0===this._ss[e[v]._index]||this._ss[e[v]._index]===cn.HELIX_PI||n&&this._ss[e[v]._index]===cn.HELIX_ALPHA;if(m)for(var g=p;g<=p+4;++g)this._ss[e[g]._index]=cn.HELIX_PI}for(var y=1;y+1<t;++y)if(void 0===this._ss[e[y]._index]){for(var _=!1,x=3;x<=5&&!_;++x)for(var b=1;b<x&&!_;++b)_=y>=b&&this._isHelixStart(e[y-b]._index,x);_?this._ss[e[y]._index]=cn.TURN:this._bend[e[y]._index]&&(this._ss[e[y]._index]=cn.BEND)}}},{key:"_residueGetCAlpha",value:function(e){for(var t=0;t<e._atoms.length;++t){var n=e._atoms[t].name;if("CA"===n||"C1"===n)return e._atoms[t].position}return null}},{key:"_cosinusAngle",value:function(e,t,n,r){var i=e.clone().sub(t),o=n.clone().sub(r),a=0,s=i.dot(i)*o.dot(o);return s>0&&(a=i.dot(o)/Math.sqrt(s)),a}},{key:"_kappa",value:function(e,t,n){var r=this._residueGetCAlpha(t),i=this._residueGetCAlpha(e),o=this._residueGetCAlpha(n);if(null===r||null===i||null===o)return 180;var a=this._cosinusAngle(r,i,o,r),s=Math.sqrt(1-a*a);return 180*Math.atan2(s,a)/Math.PI}},{key:"_isHelixStart",value:function(e,t){return this._helixFlags[t][e]===ln.START||this._helixFlags[t][e]===ln.START_AND_END}},{key:"_buildBetaSheets",value:function(){for(var e=[],t=0;t<this._complex._chains.length;++t){var n=this._chainLengths[t];if(!(n<=4))for(var r=this._complex._chains[t].getResidues(),i=t;i<this._complex._chains.length;++i){var o=this._chainLengths[i];if(!(o<=4))for(var a=this._complex._chains[i].getResidues(),s=1;s+1<n;++s){var l=r[s],c=1;for(i===t&&(c=s+3);c+1<o;++c){var u=a[c],h=this._testBridge(r,s,a,c);if(h!==sn.NO_BRIDGE){var f,d=!1,p=nn(e);try{for(p.s();!(f=p.n()).done;){var m=f.value;if(h===m.type&&l._index===m.i[m.i.length-1]+1){if(h===sn.PARALLEL&&m.j[m.j.length-1]+1===u._index){m.i.push(l._index),m.j.push(u._index),d=!0;break}if(h===sn.ANTI_PARALLEL&&m.j[0]-1===u._index){m.i.push(l._index),m.j.unshift(u._index),d=!0;break}}}}catch(e){p.e(e)}finally{p.f()}d||e.push({type:h,i:[l._index],chainI:l.getChain()._index,j:[u._index],chainJ:u.getChain()._index})}}}}}e.sort((function(e,t){return e.chainI<t.chainI||e.chainI===t.chainI&&e.i[0]<t.i[0]?-1:1}));for(var v=0;v<e.length;++v)for(var g=v+1;g<e.length;++g){var y=e[v].i[0],_=e[v].i[e[v].i.length-1],x=e[v].j[0],b=e[v].j[e[v].j.length-1],w=e[g].i[0],S=e[g].i[e[g].i.length-1],M=e[g].j[0],E=e[g].j[e[g].j.length-1];e[v].type!==e[g].type||this._hasChainBreak(Math.min(y,w),Math.max(_,S))||this._hasChainBreak(Math.min(x,M),Math.max(b,E))||w-_>=6||_>=w&&y<=S||(e[v].type===sn.PARALLEL?M-b<6&&w-_<3||M-b<3:x-E<6&&w-_<3||x-E<3)&&(e[v].i=e[v].i.concat(e[g].i),e[v].type===sn.PARALLEL?e[v].j=e[v].j.concat(e[g].j):e[v].j=e[g].j.concat(e[v].j),e.splice(g--,1))}for(var T=new Set,A=0;A<e.length;++A)T.add(e[A]);for(var C=1,R=0;T.size>0;){var P=T.values().next().value;T.delete(P);var L=new Set;L.add(P);var k=void 0;do{k=new Set;var I,N=nn(L.values());try{for(N.s();!(I=N.n()).done;){var O,D=I.value,B=nn(T.values());try{for(B.s();!(O=B.n()).done;){var z=O.value;this._areBridgesLinked(D,z)&&k.add(z)}}catch(e){B.e(e)}finally{B.f()}}}catch(e){N.e(e)}finally{N.f()}var F,V=nn(k.values());try{for(V.s();!(F=V.n()).done;)P=F.value,L.add(P),T.delete(P)}catch(e){V.e(e)}finally{V.f()}}while(k.size>0);var U,G=nn(L.values());try{for(G.s();!(U=G.n()).done;)(P=U.value).ladder=R,P.sheet=C,P.link=L,++R}catch(e){G.e(e)}finally{G.f()}++C}for(var H=0;H<e.length;++H){for(var j=e[H],W=0,q=0,X=0;X<j.i.length;++X)if(this._betaPartners[j.i[X]][0]){W=1;break}for(var Y=0;Y<j.j.length;++Y)if(this._betaPartners[j.j[Y]][0]){q=1;break}var Z=cn.BRIDGE;if(j.i.length>1&&(Z=cn.STRAND),j.type===sn.PARALLEL){for(var $=0,J=0;J<j.i.length;++J)this._betaPartners[j.i[J]][W]={residue:j.j[$++],ladder:j.ladder,parallel:!0};$=0;for(var K=0;K<j.j.length;++K)this._betaPartners[j.j[K]][q]={residue:j.i[$++],ladder:j.ladder,parallel:!0}}else{for(var Q=j.j.length-1,ee=0;ee<j.i.length;++ee)this._betaPartners[j.i[ee]][W]={residue:j.j[Q--],ladder:j.ladder,parallel:!1};Q=j.i.length-1;for(var te=0;te<j.j.length;++te)this._betaPartners[j.j[te]][q]={residue:j.i[Q--],ladder:j.ladder,parallel:!1}}for(var ne=j.i[0];ne<=j.i[j.i.length-1];++ne)this._ss[ne]!==cn.STRAND&&(this._ss[ne]=Z,this._sheet[ne]=j.sheet);for(var re=j.j[0];re<=j.j[j.j.length-1];++re)this._ss[re]!==cn.STRAND&&(this._ss[re]=Z,this._sheet[re]=j.sheet)}}},{key:"_testBridge",value:function(e,t,n,r){var i=sn.NO_BRIDGE,o=e[t-1]._index,a=e[t]._index,s=e[t+1]._index,l=n[r-1]._index,c=n[r]._index,u=n[r+1]._index,h=this._hbonds.isBond.bind(this._hbonds);return h(s,c)&&h(c,o)||h(u,a)&&h(a,l)?i=sn.PARALLEL:(h(s,l)&&h(u,o)||h(c,a)&&h(a,c))&&(i=sn.ANTI_PARALLEL),i}},{key:"_areBridgesLinked",value:function(e,t){var n,r=new Set(e.i),i=new Set(e.j),o=nn(t.i);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(r.has(a)||i.has(a))return!0}}catch(e){o.e(e)}finally{o.f()}var s,l=nn(t.j);try{for(l.s();!(s=l.n()).done;){var c=s.value;if(r.has(c)||i.has(c))return!0}}catch(e){l.e(e)}finally{l.f()}return!1}},{key:"_hasChainBreak",value:function(e,t){for(var n=e+1;n<=t;++n)if(this._complex._residues[n]._sequence!==this._complex._residues[n-1]._sequence+1)return!0;return!1}}]),e}();un.StructureType=cn;var hn=un.StructureType,fn=We.Type,dn=(Ee(on={},hn.HELIX_ALPHA,1),Ee(on,hn.HELIX_PI,3),Ee(on,hn.HELIX_310,5),on),pn=(Ee(an={},hn.BRIDGE,fn.BRIDGE),Ee(an,hn.TURN,fn.TURN),Ee(an,hn.BEND,fn.BEND),Ee(an,hn.LOOP,fn.COIL),an),mn=function(){function e(){g(this,e),this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._residueTypes=Object.create(Be.StandardTypes),this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[],this._molecules=[],this._maskNeedsUpdate=!1,this.metadata={},this.symmetry=[],this.units=[new Pt(this)],this._currentUnit=0}return _(e,[{key:"addAtom",value:function(e){var t=this._atoms.length;return this._atoms.push(e),t}},{key:"addSheet",value:function(e){var t=this._sheets.length;return this._sheets.push(e),t}},{key:"addHelix",value:function(e){var t=this._helices.length;return this._helices.push(e),t}},{key:"getAtoms",value:function(){return this._atoms}},{key:"getBonds",value:function(){return this._bonds}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"addResidue",value:function(e){var t=this._residues.length;return this._residues.push(e),t}},{key:"updateToFrame",value:function(e){this.forEachChain((function(t){t.updateToFrame(e)}))}},{key:"addResidueType",value:function(e){return this._residueTypes[e]=new Be(e,"Unknown","")}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"getResidues",value:function(){return this._residues}},{key:"getSGroupCount",value:function(){return this._sgroups.length}},{key:"getSGroups",value:function(){return this._sgroups}},{key:"getAtomByFullname",value:function(e){var t=e.split(".");if(3!==t.length)return null;var n=t[0],r=parseInt(t[1],10);if(Number.isNaN(r))return null;var i=t[2].toUpperCase(),o=null;return this.forEachChain((function(e){o||0===e._name.localeCompare(n)&&e.forEachResidue((function(e){o||e._sequence===r&&e.forEachAtom((function(e){o||0===i.localeCompare(e.name)&&(o=e)}))}))})),o}},{key:"addChain",value:function(e){var t=new je(this,e);return this._chains.push(t),t}},{key:"getChain",value:function(e){for(var t=0,n=this._chains.length;t<n;++t){var r=this._chains[t];if(r.getName()===e)return r}return null}},{key:"getChainCount",value:function(){return this._chains.length}},{key:"getMolecules",value:function(){return this._molecules}},{key:"getMoleculeCount",value:function(){return this._molecules.length}},{key:"forEachAtom",value:function(e){for(var t=this._atoms,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachBond",value:function(e){for(var t=this._bonds,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachResidue",value:function(e){for(var t=this._residues,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachChain",value:function(e){for(var t=this._chains,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachMolecule",value:function(e){for(var t=this._molecules,n=t.length,r=0;r<n;++r)e(t[r])}},{key:"forEachSGroup",value:function(e){for(var t=this._sgroups,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachComponent",value:function(e){for(var t=this._components,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"forEachVisibleComponent",value:function(e){for(var t=this._components,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"addBond",value:function(e,t,n,r,i){var o=new Pe(e,t,n,r,i);return this._bonds.push(o),o}},{key:"getBondCount",value:function(){return this._bonds.length}},{key:"getResidueType",value:function(e){return this._residueTypes[e]||null}},{key:"getUnifiedSerial",value:function(e,t,n){return t+65536*n+16777216*e}},{key:"splitUnifiedSerial",value:function(e){var t=Math.floor(e/16777216),n=e-16777216*t,r=Math.floor(n/65536);return{chain:t,serial:n-65536*r,iCode:r}}},{key:"_fillCmpEdit",value:function(){var e=this,t=this._components;function n(){var n=new It(e);return n._index=t.length,t[n._index]=n,n}this.forEachChain((function(e){var t=e._residues,r=t.length;if(!(r<1))for(var i=n(),o=t[0]._index,a=0;a<r;++a){var s=t[a];s._component=i;var l=a===r-1?null:t[a+1];l&&s.isConnected(l)&&s._index===l._index-1||(i.setSubDivs([{start:o,end:s._index}]),l&&(o=l._index,i=n()))}}))}},{key:"_fillCmpNoedit",value:function(){var e=new It(this);e._index=0;var t=this._residues,n=t.length;if(0!==n){for(var r=[],i=0,o=0;o<n;++o){var a=t[o];a._component=e;var s=o===n-1?null:t[o+1];s&&a.isConnected(s)||(r[r.length]={start:i,end:o},s&&(i=o+1))}e.setSubDivs(r),this._components[e._index]=e}}},{key:"_fillComponents",value:function(e){e?this._fillCmpEdit():this._fillCmpNoedit()}},{key:"getCurrentUnit",value:function(){return this._currentUnit}},{key:"getDefaultBoundaries",value:function(){return this.units[0].getBoundaries()}},{key:"getBoundaries",value:function(){return this.units[this._currentUnit].getBoundaries()}},{key:"getTransforms",value:function(){return this.units[this._currentUnit].getTransforms()}},{key:"getSelector",value:function(){return this.units[this._currentUnit].getSelector()}},{key:"resetCurrentUnit",value:function(){this._currentUnit=0,this.setCurrentUnit(1)}},{key:"setCurrentUnit",value:function(e){return null!=e&&e!==this._currentUnit&&e>=0&&e<this.units.length&&(this._currentUnit=e,!0)}},{key:"_computeBounds",value:function(){for(var e=this.units,t=0,n=e.length;t<n;++t)e[t].computeBoundaries()}},{key:"onAtomPositionChanged",value:function(){this.forEachChain((function(e){e._finalize()})),this.forEachComponent((function(e){e.update()})),this._computeBounds(),this._finalizeBonds(),this.forEachSGroup((function(e){e._rebuildSGroupOnAtomChange()}))}},{key:"update",value:function(){this._maskNeedsUpdate&&(this.updateStructuresMask(),this._maskNeedsUpdate=!1)}},{key:"_finalizeBonds",value:function(){for(var e=this.getBonds(),t=e.length,n=0;n<t;++n)e[n]._index=n}},{key:"finalize",value:function(e){e=e||{};var t,n,r=this._bonds;for(t=r.length-1;t>=0;t--){var i=r[t];null===i._left||null===i._right?r.splice(t,1):(i._left.bonds.push(i),i._right.bonds.push(i))}var o=this._residues;for(t=0,n=o.length;t<n;++t)o[t]._finalize();this.forEachChain((function(e){e._finalize()}));var a=this.units;for(t=0,n=a.length;t<n;++t)a[t].finalize();this.setCurrentUnit(1);var s={};for(t=0,n=o.length;t<n;++t){var l=o[t];s[this.getUnifiedSerial(l.getChain().getName().charCodeAt(0),l.getSequence(),l.getICode().charCodeAt(0))]=l}var c=this.structures;for(t=0,n=c.length;t<n;++t)c[t]._finalize(e.serialAtomMap,s,this);var u=this._helices;for(t=0,n=u.length;t<n;++t)u[t]._finalize(e.serialAtomMap,s,this);var h=this._sheets;for(t=0,n=h.length;t<n;++t)h[t]._finalize(e.serialAtomMap,s,this);this._computeBounds();var f=this._atoms;for(t=0,n=f.length;t<n;++t)f[t].index=t;if(e.needAutoBonding){var d=new Ft(this);d.build(),d.destroy()}var p=this._chains;for(t=0,n=p.length;t<n;++t)p[t]._index=t;for(t=0,n=o.length;t<n;++t)o[t]._index=t;for(t=0,n=f.length;t<n;++t){var m=f[t];if(m.flags&Te.Flags.HYDROGEN&&1===m.bonds.length){var v=m.bonds[0];(v._left!==m&&v._left||v._right).flags&Te.Flags.CARBON&&(m.flags|=Te.Flags.NONPOLARH)}}this._finalizeBonds(),this._fillComponents(e.enableEditing);var g=new Jt(this);g.markCycles(),e.detectAromaticLoops&&g.detectCycles(),this._finalizeMolecules()}},{key:"_finalizeMolecules",value:function(){for(var e=0;e<this._molecules.length;e++)for(var t=this._molecules[e],n=t.residues.length,r=0;r<n;r++)t.residues[r]._molecule=t}},{key:"updateStructuresMask",value:function(){var e=function(e){return e.collectMask()};this.forEachResidue(e),this.forEachChain(e),this.forEachMolecule(e)}},{key:"countAtomsByMask",value:function(e){var t=0;return this.forEachAtom((function(n){0!=(n.mask&e)&&t++})),t}},{key:"getNumAtomsBySelector",value:function(e){var t=0;return this.forEachAtom((function(n){e.includesAtom(n)&&t++})),t}},{key:"resetAtomMask",value:function(e){this.forEachAtom((function(t){t.mask=e}))}},{key:"markAtoms",value:function(e,t){var n=t,r=~n,i=0,o=Rt.keyword("And")(e,this.getSelector());return this.forEachAtom((function(e){o.includesAtom(e)?(e.mask|=n,i++):e.mask&=r})),this._maskNeedsUpdate=!0,i}},{key:"markAtomsAdditionally",value:function(e,t){var n=t,r=0;return this.forEachAtom((function(i){e.includesAtom(i)&&(i.mask&t)!==t&&(i.mask|=n,r++)})),r}},{key:"clearAtomBits",value:function(e){var t=~e;this.forEachAtom((function(e){e.mask&=t}));var n=function(e){e._mask&=t};this.forEachAtom(n),this.forEachResidue(n),this.forEachChain(n),this.forEachMolecule(n)}},{key:"getAtomNames",value:function(){if(this.hasOwnProperty("_atomNames"))return this._atomNames;var e={};return this.forEachAtom((function(t){e[t.name]=1})),this._atomNames=Object.keys(e),this._atomNames}},{key:"getElements",value:function(){if(this.hasOwnProperty("_elements"))return this._elements;var e={};return this.forEachAtom((function(t){e[t.element.name]=1})),this._elements=Object.keys(e),this._elements}},{key:"getResidueNames",value:function(){if(this.hasOwnProperty("_residueNames"))return this._residueNames;var e={};return this.forEachResidue((function(t){e[t._type._name]=1})),this._residueNames=Object.keys(e),this._residueNames}},{key:"getChainNames",value:function(){if(this.hasOwnProperty("_chainNames"))return this._chainNames;var e={};return this.forEachChain((function(t){e[t._name]=1})),this._chainNames=Object.keys(e),this._chainNames}},{key:"getAltLocNames",value:function(){if(this.hasOwnProperty("_altlocNames"))return this._altlocNames;var e={};return this.forEachAtom((function(t){e[String.fromCharCode(t.location)]=1})),this._altlocNames=Object.keys(e),this._altlocNames}},{key:"getVoxelWorld",value:function(){if(!this.hasOwnProperty("_voxelWorld"))try{this._voxelWorld=new en(this.getDefaultBoundaries().boundingBox,new a.Vector3(5,5,5)),this._voxelWorld.addAtoms(this)}catch(e){F.warn("Unable to create voxel world"),this._voxelWorld=null}return this._voxelWorld}},{key:"addElement",value:function(e,t,n,r){for(var i=e.length,o=0;o<i;++o){var a=e[o];r(a,n),t.push(a)}}},{key:"joinComplexes",value:function(e){this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[];var t=this,n=0,r=0,i=0,o=0,a=0;function s(e,t){e.serial+=t,e.index+=t}function l(e,t){e._index+=t}function c(e,t){e._index+=t}function u(e,n){e._complex=t,e._index+=n}function h(e,n){e._complex=t,e._index+=n}function f(){}for(var d=0;d<e.length;++d){var p=e[d];for(var m in this.addElement(p._atoms,this._atoms,n,s),this.addElement(p._bonds,this._bonds,r,l),this.addElement(p._residues,this._residues,i,c),this.addElement(p._chains,this._chains,o,u),this.addElement(p._sheets,this._sheets,0,f),this.addElement(p._helices,this._helices,0,f),this.addElement(p._sgroups,this._sgroups,0,f),this.addElement(p._components,this._components,a,h),this.addElement(p.structures,this.structures,0,f),p._residueTypes)p._residueTypes.hasOwnProperty(m)&&(this._residueTypes[m]=p._residueTypes[m]);n+=p._atoms.length,r+=p._bonds.length,i+=p._residues.length,o+=p._chains.length,a+=p._components.length}this._computeBounds()}},{key:"dssp",value:function(){for(var e,t,n,r,i=new un(this),o=this.structures=[],a=this._helices=[],s=this._sheets=[],l=0,c=null,u=0,h=this._residues.length;u<h;++u){var f=i._ss[u],d=this._residues[u],p=i._sheet[u];if(f!==e||p!==t){var m=dn[f],v=pn[f];if(f===hn.STRAND){var g=(r=void 0,(r=s[n=p])||(r=s[n]=new nt(String(n),0)),r);c=new tt(g,d,d,0,null,null),g.addStrand(c)}else void 0!==m?(l++,c=new Je(m,d,d,l,String(l),"",1),a.push(c)):c=void 0!==v?new We(v,d,d):null;c&&o.push(c),d._secondary=c,e=f,t=p}else d._secondary=c,c&&(c.term=d),c instanceof Je&&c.length++}this._sheets=s.filter((function(e){return!0}))}}]),e}();function vn(e){var t=2;for(e=e-1>>1;e;)t<<=1,e>>=1;return t}mn.prototype.id="Complex",mn.prototype.name="";var gn=function(){function e(t,n,r,i,o,a){if(g(this,e),this._box=r.clone(),this._dimVec=Math.max(Math.floor(i||1),1),this._volumeInfo=a,n instanceof Array){var s=c(n,3);this._dimX=s[0],this._dimY=s[1],this._dimZ=s[2]}else this._dimX=n.x,this._dimY=n.y,this._dimZ=n.z;switch(this._dimX=Math.max(Math.floor(this._dimX),1),this._dimY=Math.max(Math.floor(this._dimY),1),this._dimZ=Math.max(Math.floor(this._dimZ),1),this._rowElements=this._dimVec*this._dimX,this._planeElements=this._rowElements*this._dimY,this._totalElements=this._planeElements*this._dimZ,this._data=o||Q.allocateTyped(t,this._totalElements),this._dimVec){case 1:break;case 2:this.getValue=function(e,t,n){var r=e*this._dimVec+t*this._rowElements+n*this._planeElements;return[this._data[r],this._data[r+1]]},this.setValue=function(e,t,n,r,i){var o=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[o]=r,this._data[o+1]=i},this.addValue=function(e,t,n,r,i){var o=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[o]+=r,this._data[o+1]+=i};break;case 3:this.getValue=function(e,t,n){var r=e*this._dimVec+t*this._rowElements+n*this._planeElements;return[this._data[r],this._data[r+1],this._data[r+2]]},this.setValue=function(e,t,n,r,i,o){var a=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[a]=r,this._data[a+1]=i,this._data[a+2]=o},this.addValue=function(e,t,n,r,i,o){var a=e*this._dimVec+t*this._rowElements+n*this._planeElements;this._data[a]+=r,this._data[a+1]+=i,this._data[a+2]+=o};break;default:throw new Error("Volume: invalid vector dimension")}}return _(e,[{key:"getValue",value:function(e,t,n){return this._data[e+t*this._rowElements+n*this._planeElements]}},{key:"setValue",value:function(e,t,n,r){this._data[e+t*this._rowElements+n*this._planeElements]=r}},{key:"addValue",value:function(e,t,n,r){this._data[e+t*this._rowElements+n*this._planeElements]+=r}},{key:"getDimensions",value:function(){return[this._dimX,this._dimY,this._dimZ]}},{key:"getBox",value:function(){return this._box}},{key:"getVolumeInfo",value:function(){return this._volumeInfo}},{key:"getCellSize",value:function(){var e=new a.Vector3;this._box.getSize(e);var t=new a.Vector3;return t.x=this._dimX>1?e.x/(this._dimX-1):0,t.y=this._dimY>1?e.y/(this._dimY-1):0,t.z=this._dimZ>1?e.z/(this._dimZ-1):0,t}},{key:"computeGradient",value:function(){if(1!==this._dimVec)return null;var t=new e(Float32Array,[this._dimX,this._dimY,this._dimZ],this._box,3),n=this.getCellSize(),r=new a.Vector3(-.5/n.x,-.5/n.y,-.5/n.z);function i(e,t,n){return Math.min(n,Math.max(t,e))}var o=this._dimX,s=this._dimY,l=this._dimZ,c=this._data;function u(e,t,n){return c[n*o*s+t*o+e]}for(var h=0;h<l;++h)for(var f=i(h-1,0,l-1),d=i(h+1,0,l-1),p=0;p<s;++p)for(var m=i(p-1,0,s-1),v=i(p+1,0,s-1),g=0;g<o;++g){var y=i(g-1,0,o-1),_=i(g+1,0,o-1);t.setValue(g,p,h,(u(_,p,h)-u(y,p,h))*r.x,(u(g,v,h)-u(g,m,h))*r.y,(u(g,p,d)-u(g,p,f))*r.z)}return t}},{key:"normalize",value:function(){for(var e=this._data,t=e[0],n=e[0],r=1;r<e.length;++r)t=Math.min(t,e[r]),n=Math.max(n,e[r]);var i=1/(n-t);if(0!==i)for(var o=0;o<e.length;++o)e[o]=i*(e[o]-t)}},{key:"getTiledTextureStride",value:function(){return[this._dimX+2,this._dimY+2]}},{key:"buildTiledTexture",value:function(){var e=Math.ceil(Math.sqrt(this._dimZ*this._dimY/this._dimX)),t=e*(this._dimX+2)-1;t=vn(t),e=Math.floor(t/(this._dimX+2));var n=Math.ceil(this._dimZ/e),r=n*(this._dimY+2)-1;r=vn(r);for(var i,o,s=new Uint8Array(t*r),l=0;l<n;++l)for(var c=0;c<this._dimY;++c){i=l*e*this._planeElements+c*this._rowElements,o=t*(l*(this._dimY+2)+c);for(var u=0;u<e;++u){for(var h=0;h<this._dimX;++h)s[o++]=255*this._data[i++];s[o++]=255*this._data[i-1],u<e-1&&(i+=this._planeElements-this._rowElements,s[o++]=255*this._data[i])}}for(var f=0;f<n;++f){o=(i=t*(f*(this._dimY+2)+this._dimY-1))+t;for(var d=0;d<t;++d)s[o++]=s[i++];if(f<n-1){o=(i=t*(f+1)*(this._dimY+2))-t;for(var p=0;p<t;++p)s[o++]=s[i++]}}var m=new a.DataTexture(s,t,r,a.LuminanceFormat,a.UnsignedByteType,a.UVMapping,a.ClampToEdgeWrapping,a.ClampToEdgeWrapping,a.LinearFilter,a.LinearFilter);return m.needsUpdate=!0,m}},{key:"getData",value:function(){return this._data}},{key:"getDirectIdx",value:function(e,t,n){return e*this._dimVec+t*this._rowElements+n*this._planeElements}},{key:"getStrideX",value:function(){return this._dimVec}},{key:"getStrideY",value:function(){return this._rowElements}},{key:"getStrideZ",value:function(){return this._planeElements}}]),e}();gn.prototype.id="Volume";var yn={Atom:Te,Element:Ae,Bond:Pe,Residue:De,ResidueType:Be,Chain:je,Helix:Je,Strand:tt,Sheet:nt,SGroup:rt,Assembly:kt,Complex:mn,Volume:gn,VoxelWorld:en,selectors:Rt,Molecule:function(){function e(t,n,r){g(this,e),this.complex=t,this.name=n||"",this.residues=[],this.mask=1,this.index=r||-1}return _(e,[{key:"forEachResidue",value:function(e){for(var t=this.residues,n=0,r=t.length;n<r;++n)e(t[n])}},{key:"collectMask",value:function(){for(var e=4294967295,t=this.residues,n=0,r=t.length;n<r;++n)e&=t[n]._mask;this.mask=e}}]),e}()};function _n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var xn=function(e){T(n,e);var t=_n(n);function n(e){var r;g(this,n);var i=C(r=t.call(this));return r._element=e,r._element.style.position="absolute",r.addEventListener("removed",(function(){null!==i._element.parentNode&&i._element.parentNode.removeChild(i._element)})),r}return _(n,[{key:"getElement",value:function(){return this._element}},{key:"setTransparency",value:function(e){var t=this.getElement();if(null!==t)if(1!==e){t.style.display="inline";var n=1-e,r=n.toString(),i=100*n;t.style.opacity=r,t.style.filter="alpha(opacity=".concat(i,")")}else t.style.display="none"}},{key:"clone",value:function(){var e=new n(this._element);return e.copy(this),e}}]),n}(a.Object3D);function bn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var wn=function(e){T(n,e);var t=bn(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"raycast",value:function(e,t){if(this.visible)for(var n=this.children,r=0,i=n.length;r<i;++r)n[r].raycast(e,t)}},{key:"enableSubset",value:function(e,t){for(var n=this.children,r=0,i=n.length;r<i;++r)n[r].enableSubset&&n[r].enableSubset(e,t)}},{key:"disableSubset",value:function(e,t){for(var n=this.children,r=0,i=n.length;r<i;++r)n[r].disableSubset&&n[r].disableSubset(e,t)}},{key:"isEmpty",value:function(){return 0===this.children.length}},{key:"updateToFrame",value:function(e){for(var t=this.children,n=0,r=t.length;n<r;++n)t[n].updateToFrame&&t[n].updateToFrame(e)}},{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=r.length;i<o;++i)r[i].getSubset&&Array.prototype.push.apply(n,r[i].getSubset(e,t));return n}}]),n}(a.Group),Sn="uniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\n\r\nattribute vec2 uv;\r\nattribute vec3 position;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n";function Mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var En,Tn,An={DEFAULT:0,VOLUME:1,TRANSPARENT:2,PREPASS_TRANSPARENT:3,VOLUME_BFPLANE:4,COLOR_FROM_POSITION:5,SHADOWMAP:6},Cn=[An.DEFAULT,An.TRANSPARENT];a.Object3D.prototype.resetTransform=function(){this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1)},a.Object3D.prototype.updateMatrixWorldRecursive=function(){null!=this.parent&&this.parent.updateMatrixWorldRecursive(),this.updateMatrixWorld()},a.Object3D.prototype.addSavingWorldTransform=(En=new a.Matrix4,function(e){e instanceof a.Object3D&&(En.copy(this.matrixWorld).invert(),En.multiply(e.matrixWorld),e.matrix.copy(En),e.matrix.decompose(e.position,e.quaternion,e.scale),this.add(e))}),a.WebGLRenderer.prototype.renderDummyQuad=function(){var e=new a.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1}),t=new a.Scene,n=new a.Mesh(new a.PlaneBufferGeometry(.01,.01),e);t.add(n);var r=new a.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4);return r.position.z=100,function(){this.render(t,r)}}(),a.WebGLRenderer.prototype.renderScreenQuad=function(){var e=new a.Scene,t=new a.Mesh(new a.PlaneBufferGeometry(1,1));e.add(t);var n=new a.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4);return n.position.z=100,function(r){t.material=r,this.render(e,n)}}(),a.Matrix4.prototype.isIdentity=(Tn=new a.Matrix4,function(){return Tn.equals(this)}),a.Matrix4.prototype.applyToPointsArray=function(e,t,n){if(!e||!t||t<3)return e;n=n||0;for(var r=this.elements,i=0;i<e.length;i+=t){var o=e[i],a=e[i+1],s=e[i+2],l=1/(r[3]*o+r[7]*a+r[11]*s+r[15]);e[i]=(r[0]*o+r[4]*a+r[8]*s+r[12]*n)*l,e[i+1]=(r[1]*o+r[5]*a+r[9]*s+r[13]*n)*l,e[i+2]=(r[2]*o+r[6]*a+r[10]*s+r[14]*n)*l}return e};var Rn,Pn,Ln=function(e){T(n,e);var t=Mn(n);function n(e){return g(this,n),void 0===e.uniforms&&(e.uniforms={}),e.uniforms.srcTex={type:"t",value:null},e.vertexShader=Sn,e.transparent=!1,e.depthTest=!1,e.depthWrite=!1,t.call(this,e)}return n}(a.RawShaderMaterial);function kn(e){e.traverse((function(e){(e instanceof a.Mesh||e instanceof a.LineSegments||e instanceof a.Line)&&e.geometry.dispose()})),function(e){for(var t=e.children,n=0,r=t.length;n<r;++n){var i=t[n];i.parent=null,i.dispatchEvent({type:"removed"})}e.children=[]}(e)}a.WebGLRenderer.prototype.renderScreenQuadFromTex=(Rn=new Ln({uniforms:{opacity:{type:"f",value:1}},fragmentShader:"precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color = texture2D(srcTex, vUv);\r\n  gl_FragColor = vec4(color.xyz, color.a * opacity);\r\n}\r\n",transparent:!0}),function(e,t){Rn.uniforms.srcTex.value=e,Rn.transparent=t<1,Rn.uniforms.opacity.value=t,this.renderScreenQuad(Rn)}),a.WebGLRenderer.prototype.renderScreenQuadFromTexWithDistortion=function(){var e=new Ln({uniforms:{coef:{type:"f",value:1}},fragmentShader:"precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform float coef;\r\n\r\nvoid main() {\r\n  vec2 uv = vUv * 2.0 - 1.0;\r\n  float r2 = dot(uv, uv);\r\n  vec2 tc = uv * (1.0 + coef * r2);\r\n  if (!all(lessThan(abs(tc), vec2(1.0))))\r\n    discard;\r\n  tc = 0.5 * (tc + 1.0);\r\n  gl_FragColor = texture2D(srcTex, tc);\r\n}\r\n"});return function(t,n){e.uniforms.srcTex.value=t,e.uniforms.coef.value=n,this.renderScreenQuad(e)}}(),a.PerspectiveCamera.prototype.setMinimalFov=function(e){this.aspect>=1?this.fov=e:this.fov=a.MathUtils.radToDeg(2*Math.atan(Math.tan(.5*a.MathUtils.degToRad(e))/this.aspect))},a.StereoCamera.prototype.updateHalfSized=function(e,t){var n=e.aspect,r=e.fov;e.aspect=n/2,e.setMinimalFov(t),e.updateProjectionMatrix(),this.update(e),e.aspect=n,e.fov=r,e.updateProjectionMatrix()},a.PerspectiveCamera.prototype.setDistanceToFit=function(e,t){this.position.z=e/Math.sin(.5*a.MathUtils.degToRad(t))},a.Raycaster.prototype.intersectVisibleObject=function(e,t,n,r){var i=this.intersectObject(e,!1);if(0===i.length)return null;var o,s=Math.min(t.near,n),l=i[0],c=new a.Vector3;for(o=0;o<i.length&&(l=i[o],c.copy(l.point),c.applyMatrix4(t.matrixWorldInverse),!(c.z<=-s));++o);if(o===i.length)return null;var u=Math.min(t.far,r);return c.copy(l.point),c.applyMatrix4(t.matrixWorldInverse),c.z<=-u?null:l},a.Matrix4.prototype.extractScale=(Pn=new a.Vector3,function(e){void 0===e&&(F.debug("extractScale(): new is too expensive operation to do it on-the-fly"),e=Pn.clone());var t=this.elements;return e.x=Pn.set(t[0],t[1],t[2]).length(),e.y=Pn.set(t[4],t[5],t[6]).length(),e.z=Pn.set(t[8],t[9],t[10]).length(),this.determinant()<0&&(e.x=-e.x),e}),a.BufferAttribute.prototype.copyAtList=function(e,t){console.assert(this.itemSize===e.itemSize,"false: BufferAttribute.copyAtList buffers have different item size.");for(var n=this.itemSize,r=0,i=t.length;r<i;++r)for(var o=0;o<n;++o)this.array[r*n+o]=e.array[t[r]*n+o];return this};var In=a.InstancedBufferGeometry.prototype.copy;a.InstancedBufferGeometry.prototype.copy=function(e){In.call(this,e),void 0===this.instanceCount&&(this.instanceCount=1/0)};var Nn={calcCylinderMatrix:function(e,t,n){var r=e.clone().lerp(t,.5),i=new a.Matrix4;i.makeScale(n,e.distanceTo(t),n);var o=new a.Matrix4;o.makeRotationX(Math.PI/2);var s=new a.Matrix4,l=new a.Vector3(0,1,0);return s.lookAt(r,t,l),s.multiply(o),s.multiply(i),s.setPosition(r),s},calcChunkMatrix:function(e,t,n,r){var i=new a.Matrix4;i.makeScale(r.x,r.y,0);var o=new a.Matrix4;return o.lookAt(e,t,n),o.multiply(i),o.setPosition(e),o},groupHasGeometryToRender:function(e){var t=!1;return e.traverse((function(e){(e.hasOwnProperty("geometry")||e instanceof xn)&&(t=!0)})),t},buildDistorionMesh:function(e,t,n){function r(e){for(var t=0,r=e,i=1;Math.abs(r-t)>1e-5;)t=r,r=e/((i=1+n*r)*i);return 1/i}for(var i=new a.PlaneBufferGeometry(2,2,e,t),o=i.getAttribute("position"),s=0;s<o.count;++s){var l=o.array[3*s],c=o.array[3*s+1],u=r(l*l+c*c);o.setXY(s,u*l,u*c)}return i},RCGroup:wn,fillArray:function(e,t,n,r){n=void 0!==n?n:0,r=void 0!==r?r:e.length;for(var i=n;i<r;++i)e[i]=t},clearTree:kn,destroyObject:function(e){kn(e),e.parent?e.parent.remove(e):e.dispatchEvent({type:"removed"})},belongToSelectLayers:function(e){for(var t=0;t<Cn.length;t++)if(1==(e.layers.mask>>Cn[t]&1))return!0;return!1},processObjRenderOrder:function(e,t){var n=+("BA"!==t);e.traverse((function(e){e.isGroup&&(e.renderOrder=n)}))},applySelectionMaterial:function(e){e.traverse((function(e){"material"in e&&(e.material=e.material.clone(!0),e.material.setValues({depthFunc:a.LessEqualDepth,overrideColor:!0,fog:!1,lights:!1,shadowmap:!1}),e.material.setUberOptions({fixedColor:new a.Color(16776960),zOffset:-1e-6}))}))},getMiddlePoint:function(e,t,n){var r=n||new a.Vector3;return r.set(0,0,0),r.addScaledVector(e,.5),r.addScaledVector(t,.5),r},LAYERS:An};function On(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Dn={boundingBox:new a.Box3(new a.Vector3(-1,-1,-1),new a.Vector3(1,1,1)),boundingSphere:new a.Sphere(new a.Vector3(0,0,0),1)},Bn=function(e){T(n,e);var t=On(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r)).name=e,i._dataSource=r,i}return _(n,[{key:"release",value:function(){this.parent&&this.parent.remove(this)}},{key:"getDataSource",value:function(){return this._dataSource}},{key:"getBoundaries",value:function(){return Dn}}]),n}(Nn.RCGroup);function zn(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fn(e){return null==e||Array.isArray(e)?e:[e]}var Vn=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["id"];g(this,e),this._list=[],this._dict={},this._indices=zn(r),this._indices.forEach((function(e){t._dict[e]={}})),n.forEach((function(e){return t.register(e)}))}return _(e,[{key:"register",value:function(t){var n=this;e.registerInList(this._list,t),this._indices.forEach((function(r){e.registerInDict(n._dict[r],Fn(t[r]),t)}))}},{key:"unregister",value:function(t){var n=this;e.unregisterFromList(this._list,t),this._indices.forEach((function(r){e.unregisterFromDict(n._dict[r],Fn(t[r]),t)}))}},{key:"all",get:function(){return zn(this._list)}},{key:"first",get:function(){return this._list[0]}},{key:"keys",value:function(e){return Object.keys(this._dict[e||this._indices[0]])}},{key:"get",value:function(e,t){var n=this._dict[t||this._indices[0]];if(n){var r=n[e&&e.toLowerCase()];return r&&r.length>0?r[0]:void 0}}}],[{key:"registerInList",value:function(e,t){e.includes(t)||e.push(t)}},{key:"unregisterFromList",value:function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},{key:"registerInDict",value:function(e,t,n){t.forEach((function(t){t=t.toLowerCase();var r=e[t]=e[t]||[];r.includes(n)||r.push(n)}))}},{key:"unregisterFromDict",value:function(e,t,n){t.forEach((function(t){t=t.toLowerCase();var r=e[t];if(r){var i=r.indexOf(n);-1!==i&&r.splice(i,1),0===r.length&&delete e[t]}}))}}]),e}();function Un(e){Object.defineProperties(e,{logger:{get:function(){return this.context&&this.context.logger?this.context.logger:F}},settings:{get:function(){return this.context&&this.context.settings?this.context.settings:ie}}})}function Gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Hn=function(){function e(t,n){g(this,e),this._position=t,this._radius=n}return _(e,[{key:"raycast",value:function(t){var n=e._sphere;n.set(this._position,this._radius);var r=new a.Vector3;return t.ray.intersectSphere(n,r)?{distance:t.ray.origin.distanceTo(r),point:r}:null}}]),e}();Ee(Hn,"_sphere",new a.Sphere);var jn=function(e){return function(e){T(n,e);var t=Gn(n);function n(e){var r;g(this,n);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return(r=t.call.apply(t,[this].concat(o)))._objects=new Array(e),r.boundingSphere=null,r.boundingBox=null,r}return _(n,[{key:"setSphere",value:function(e,t,n){this._objects[e]=new Hn(t,n)}},{key:"raycast",value:function(e,t){for(var n=0,r=this._objects.length;n<r;++n){var i=this._objects[n].raycast(e);i&&(i.chunkIdx=n,t.push(i))}}},{key:"computeBoundingBox",value:function(){var e=this._objects,t=this.boundingBox;null===t&&(this.boundingBox=t=new a.Box3),t.makeEmpty();for(var n=0,r=e.length;n<r;++n)t.expandByPoint(e[n]._position)}},{key:"computeBoundingSphere",value:function(){this.computeBoundingBox();var e=this._objects,t=this.boundingBox,n=0,r=new a.Vector3;t.getCenter(r);for(var i=0,o=e.length;i<o;++i){var s=e[i]._position,l=r.distanceToSquared(s);n<l&&(n=l)}null===this.boundingSphere&&(this.boundingSphere=new a.Sphere),this.boundingSphere.set(r,Math.sqrt(n))}}]),n}(e)};function Wn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var qn=new a.Color,Xn=Q.copySubArrays,Yn=function(e){T(n,e);var t=Wn(n);function n(e,r,i){var o;return g(this,n),(o=t.call(this,e))._sphGeometry=i?new a.PlaneBufferGeometry(2,2,1,1):new a.SphereBufferGeometry(1,2*r,r,0,2*Math.PI,0,Math.PI),o._init(e,o._sphGeometry),o}return _(n,[{key:"setItem",value:function(e,t,n){var r,i,o,a,s,l;r=this._offsets,i=4*e,o=t.x,a=t.y,s=t.z,l=n,r[i]=o,r[i+1]=a,r[i+2]=s,r[i+3]=l,this.setSphere(e,t,n)}},{key:"setColor",value:function(e,t){var n,r,i,o,a;qn.set(t),n=this._colors,r=3*e,i=qn.r,o=qn.g,a=qn.b,n[r]=i,n[r+1]=o,n[r+2]=a}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("offset").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,t){for(var n=this._alpha,r=0,i=e.length;r<i;++r)n[e[r]]=t;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(e){var t=e.length,n=new a.InstancedBufferGeometry;return this._init.call(n,t,this._sphGeometry),Xn(this._offsets,n._offsets,e,4),Xn(this._colors,n._colors,e,3),n.boundingSphere=this.boundingSphere,n.boundingBox=this.boundingBox,[n]}},{key:"_init",value:function(e,t){this.copy(t),this._offsets=Q.allocateTyped(Float32Array,4*e),this._colors=Q.allocateTyped(Float32Array,3*e);var n=this._alpha=Q.allocateTyped(Float32Array,e);o.default.fill(n,1),this.setAttribute("offset",new a.InstancedBufferAttribute(this._offsets,4,!1,1)),this.setAttribute("color",new a.InstancedBufferAttribute(this._colors,3,!1,1)),this.setAttribute("alphaColor",new a.InstancedBufferAttribute(n,1,!1,1))}}]),n}(jn(a.InstancedBufferGeometry));function Zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var $n=new a.Color,Jn=function(e){T(n,e);var t=Zn(n);function n(e,r){var i;if(g(this,n),(i=t.call(this)).constructor===n)throw new Error("Can not instantiate abstract class!");return i._chunkGeo=e,i._init(e,r),i}return _(n,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("normal").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"setColor",value:function(e,t){$n.set(t);for(var n=this._colors,r=this._chunkSize,i=e*r,o=i+r;i<o;++i){var a=3*i;n[a]=$n.r,n[a+1]=$n.g,n[a+2]=$n.b}}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,t){for(var n=this._alpha,r=this._chunkSize,i=0,a=e.length;i<a;++i){var s=e[i]*r;o.default.fill(n,t,s,s+r)}this.getAttribute("alphaColor").needsUpdate=!0}},{key:"raycast",value:function(e,t){var n=[],r=new a.Mesh;r.geometry=this,r.raycast(e,n);for(var i=this._chunkGeo.index.count/3,o=0,s=n.length;o<s;++o)n[o].hasOwnProperty("faceIndex")&&(n[o].chunkIdx=Math.floor(n[o].faceIndex/i),t.push(n[o]))}},{key:"getSubset",value:function(e){var t=e.length,n=new a.BufferGeometry;this._init.call(n,this._chunkGeo,t);for(var r=this._positions,i=this._normals,o=this._colors,s=n._positions,l=n._normals,c=n._colors,u=3*this._chunkSize,h=0,f=e.length;h<f;++h){var d=h*u,p=e[h]*u,m=p+u;s.set(r.subarray(p,m),d),l.set(i.subarray(p,m),d),c.set(o.subarray(p,m),d)}return n.boundingSphere=this.boundingSphere,n.boundingBox=this.boundingBox,[n]}},{key:"_init",value:function(e,t){var n=this._chunkSize=e.attributes.position.count,r=e.index.array,i=r.length,s=this._chunkSize*t,l=s>65535,c=i*t,u=this._index=Q.allocateTyped(l?Uint32Array:Uint16Array,c);this._positions=Q.allocateTyped(Float32Array,3*s),this._normals=Q.allocateTyped(Float32Array,3*s),this._colors=Q.allocateTyped(Float32Array,3*s);var h=this._alpha=Q.allocateTyped(Float32Array,s);o.default.fill(h,1);for(var f=0;f<t;++f){var d=f*i,p=f*n;u.set(r,d);for(var m=0;m<i;++m)u[d+m]+=p}this.setIndex(new a.BufferAttribute(this._index,1)),this.setAttribute("position",new a.BufferAttribute(this._positions,3)),this.setAttribute("normal",new a.BufferAttribute(this._normals,3)),this.setAttribute("color",new a.BufferAttribute(this._colors,3)),this.setAttribute("alphaColor",new a.BufferAttribute(h,1))}}]),n}(a.BufferGeometry);function Kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Qn=function(e){T(n,e);var t=Kn(n);function n(e,r){var i;g(this,n);var o=new a.SphereBufferGeometry(1,2*r,r,0,2*Math.PI,0,Math.PI),s=(i=t.call(this,e,o,e))._normals,l=o.attributes.normal.array,c=i._chunkSize;i._chunkPos=i._chunkGeo.attributes.position.array,i._tmpPositions=Q.allocateTyped(Float32Array,3*c);for(var u=0;u<e;++u)s.set(l,3*c*u);return i}return _(n,[{key:"setItem",value:function(e,t,n){for(var r=this._tmpPositions,i=this._chunkSize,o=this._chunkPos,a=0;a<i;++a){var s=3*a;r[s]=t.x+o[s]*n,r[s+1]=t.y+o[s+1]*n,r[s+2]=t.z+o[s+2]*n}this._positions.set(r,i*e*3),this.setSphere(e,t,n)}}]),n}(jn(Jn));function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var tr=new a.Vector3,nr=new a.Vector3,rr=new a.Matrix3,ir=function(e){T(n,e);var t=er(n);function n(e,r){var i;g(this,n);var o=new a.CylinderBufferGeometry(1,1,1,Math.max(3,r),2,!0),s=(i=t.call(this,o,2*e))._chunkSize;return i._chunkPos=i._chunkGeo.attributes.position.array,i._chunkNorms=i._chunkGeo.attributes.normal.array,i._tmpVector=Q.allocateTyped(Float32Array,3*s),i}return _(n,[{key:"setItem",value:function(e,t,n,r){var i=this._chunkSize,o=2*i*e*3,a=o+3*i,s=this._tmpVector,l=this._chunkPos,c=this._chunkNorms;tr.lerpVectors(t,n,.5);var u,h=Nn.calcCylinderMatrix(t,tr,r);rr.getNormalMatrix(h);for(var f=0;f<i;++f)u=3*f,nr.fromArray(l,u),nr.applyMatrix4(h),nr.toArray(s,u);this._positions.set(s,o),tr.sub(t);for(var d=0;d<i;++d)s[u=3*d]+=tr.x,s[u+1]+=tr.y,s[u+2]+=tr.z;this._positions.set(s,a);for(var p=0;p<i;++p)u=3*p,nr.fromArray(c,u),nr.applyMatrix3(rr),nr.toArray(s,u);this._normals.set(s,o),this._normals.set(s,a)}},{key:"setColor",value:function(e,t,r){var i=2*e;Qe(P(n.prototype),"setColor",this).call(this,i,t);var o=i+1;Qe(P(n.prototype),"setColor",this).call(this,o,r)}}]),n}(Jn);function or(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ar=function(e){T(n,e);var t=or(n);function n(e,r,i,o,s,l){var c;g(this,n),c=t.call(this);var u=2*Math.PI;c.type="CylinderBufferGeometry",c.parameters={radiusTop:e,radiusBottom:r,height:i,radialSegments:o,heightSegments:s,openEnded:l};var h=!1===l&&e>0,f=!1===l&&r>0,d=(s+1)*o+h*(o+1)+f*(o+1),p=(2*s+h+f)*o,m=i/2,v=new a.BufferAttribute(Q.allocateTyped(Float32Array,3*d),3),y=new a.BufferAttribute(Q.allocateTyped(Float32Array,3*d),3),_=new a.Uint16BufferAttribute(Q.allocateTyped(Uint16Array,3*p),1),x=new a.BufferAttribute(Q.allocateTyped(Float32Array,2*d),2);console.assert(d<65536,"false: Cylinder Geometry has too many vertices (65536 max).");for(var b=0,w=0,S=-(r-e)/i,M=0;M<=s;M++){if(M!==s)for(var E=0;E<o;E++){var T=b+E,A=b+o+E,C=b+o+(E+1)%o,R=b+(E+1)%o;_.setXYZ(3*w,T,R,A),w++,_.setXYZ(3*w,A,R,C),w++}for(var P=M/s,L=P*(r-e)+e,k=0;k<o;k++){var I=k/o,N=L*Math.sin(I*u+0),O=P*i-m,D=L*Math.cos(I*u+0),B=new a.Vector3(N,Math.sqrt(N*N+D*D)*S,D).normalize();v.setXYZ(b,N,O,D),y.setXYZ(b,B.x,B.y,B.z),x.setXY(b,I,P),++b}}if(h){for(var z=b,F=b+o,V=0;V<o;++V){var U=b-o;v.setXYZ(b,v.getX(U),v.getY(U),v.getZ(U)),y.setXYZ(b,0,1,0),x.setXY(b,1,1);var G=z+(V+1)%o;_.setXYZ(3*w,b,G,F),w++,b++}v.setXYZ(b,0,m,0),y.setXYZ(b,0,1,0),x.setXY(b,1,1),++b}if(f){for(var H=b,j=b+o,W=0;W<o;++W){var q=W;v.setXYZ(b,v.getX(q),v.getY(q),v.getZ(q)),y.setXYZ(b,0,-1,0),x.setXY(b,0,0);var X=H+(W+1)%o;_.setXYZ(3*w,X,b,j),w++,b++}v.setXYZ(b,0,-m,0),y.setXYZ(b,0,-1,0),x.setXY(b,0,0)}return c.setIndex(_),c.setAttribute("position",v),c.setAttribute("normal",y),c.setAttribute("uv",x),c}return _(n,[{key:"clone",value:function(){var e=this.parameters;return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded)}}]),n}(a.BufferGeometry);function sr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var lr=new a.Color,cr=new a.Matrix4,ur=Q.copySubArrays;function hr(e,t,n,r,i){e[t]=n,e[t+1]=r,e[t+2]=i}function fr(e,t,n,r,i,o){e[t]=n,e[t+1]=r,e[t+2]=i,e[t+3]=o}function dr(e,t){return e-t}var pr=function(e){T(n,e);var t=sr(n);function n(e,r,i,o){var s;return g(this,n),(s=t.call(this))._useZSprites=i,s._cylGeometry=i?new a.PlaneBufferGeometry(2,2,1,1):new ar(1,1,1,Math.max(3,r),2,o),s._init(e,s._cylGeometry,s._useZSprites),s._collisionGeo=new ir(e,3),s}return _(n,[{key:"setItem",value:function(e,t,n,r){var i=Nn.calcCylinderMatrix(t,n,r),o=i.elements,a=4*e;this._collisionGeo.setItem(e,t,n,r),fr(this._matVector1,a,o[0],o[4],o[8],o[12]),fr(this._matVector2,a,o[1],o[5],o[9],o[13]),fr(this._matVector3,a,o[2],o[6],o[10],o[14]),this._useZSprites&&(cr.copy(i).invert(),o=cr.elements,fr(this._invmatVector1,a,o[0],o[4],o[8],o[12]),fr(this._invmatVector2,a,o[1],o[5],o[9],o[13]),fr(this._invmatVector3,a,o[2],o[6],o[10],o[14]))}},{key:"setColor",value:function(e,t,n){var r=3*e;lr.set(t),hr(this._color1,r,lr.r,lr.g,lr.b),lr.set(n),hr(this._color2,r,lr.r,lr.g,lr.b)}},{key:"computeBoundingSphere",value:function(){this._collisionGeo.computeBoundingSphere(),this.boundingSphere=this._collisionGeo.boundingSphere}},{key:"computeBoundingBox",value:function(){this._collisionGeo.computeBoundingBox(),this.boundingBox=this._collisionGeo.boundingBox}},{key:"raycast",value:function(e,t){this._collisionGeo.raycast(e,t)}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("matVector1").needsUpdate=!0,this.getAttribute("matVector2").needsUpdate=!0,this.getAttribute("matVector3").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("color2").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this._useZSprites&&(this.getAttribute("invmatVector1").needsUpdate=!0,this.getAttribute("invmatVector2").needsUpdate=!0,this.getAttribute("invmatVector3").needsUpdate=!0),this._collisionGeo.finishUpdate()}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,t){for(var n=this._alpha,r=0,i=e.length;r<i;++r)n[Math.floor(e[r]/2)]=t;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(e){var t=function(e){e.sort(dr);for(var t=[],n=[],r=0,i=e.length;r<i;++r){var o=e[r],a={first:!1,second:!1};(0|o)%2==0?(a.first=!0,a.second=r+1<i&&e[r+1]===e[r]+1,a.second&&++r):a.second=!0,t.push(Math.floor(o/2)),n.push(a)}return{indices:t,cylinderInfo:n}}(e),n=t.indices,r=n.length,i=new a.InstancedBufferGeometry;return this._init.call(i,r,this._cylGeometry,this._useZSprites),ur(this._matVector1,i._matVector1,n,4),ur(this._matVector2,i._matVector2,n,4),ur(this._matVector3,i._matVector3,n,4),this._useZSprites&&(ur(this._invmatVector1,i._invmatVector1,n,4),ur(this._invmatVector2,i._invmatVector2,n,4),ur(this._invmatVector3,i._invmatVector3,n,4)),ur(this._color1,i._color1,n,3),ur(this._color2,i._color2,n,3),function(e,t,n){for(var r=0,i=e.length;r<i;++r){var o=e[r];o.first||(t[3*r]=-.5),o.second||(n[3*r]=-.5)}}(t.cylinderInfo,i._color1,i._color2),i.boundingSphere=this.boundingSphere,i.boundingBox=this.boundingBox,[i]}},{key:"getGeoParams",value:function(){return this._cylGeometry.parameters}},{key:"_init",value:function(e,t,n){this.copy(t),this._matVector1=Q.allocateTyped(Float32Array,4*e),this._matVector2=Q.allocateTyped(Float32Array,4*e),this._matVector3=Q.allocateTyped(Float32Array,4*e),this._color1=Q.allocateTyped(Float32Array,3*e),this._color2=Q.allocateTyped(Float32Array,3*e);var r=this._alpha=Q.allocateTyped(Float32Array,e);o.default.fill(r,1),this.setAttribute("matVector1",new a.InstancedBufferAttribute(this._matVector1,4,!1,1)),this.setAttribute("matVector2",new a.InstancedBufferAttribute(this._matVector2,4,!1,1)),this.setAttribute("matVector3",new a.InstancedBufferAttribute(this._matVector3,4,!1,1)),this.setAttribute("color",new a.InstancedBufferAttribute(this._color1,3,!1,1)),this.setAttribute("color2",new a.InstancedBufferAttribute(this._color2,3,!1,1)),this.setAttribute("alphaColor",new a.InstancedBufferAttribute(this._alpha,1,!1,1)),n&&(this._invmatVector1=Q.allocateTyped(Float32Array,4*e),this._invmatVector2=Q.allocateTyped(Float32Array,4*e),this._invmatVector3=Q.allocateTyped(Float32Array,4*e),this.setAttribute("invmatVector1",new a.InstancedBufferAttribute(this._invmatVector1,4,!1,1)),this.setAttribute("invmatVector2",new a.InstancedBufferAttribute(this._invmatVector2,4,!1,1)),this.setAttribute("invmatVector3",new a.InstancedBufferAttribute(this._invmatVector3,4,!1,1)))}}]),n}(a.InstancedBufferGeometry);function mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var vr=new a.Vector3,gr=new a.Vector3,yr=new a.Vector3,_r=new a.Vector3(1,0,0),xr=new a.Vector3,br=new a.Vector3,wr=function(e){T(n,e);var t=mr(n);function n(e,r,i){var o;g(this,n);var s=function(e,t){for(var n=new a.BufferGeometry,r=e.length,i=r*t,o=i<=65536?Uint16Array:Uint32Array,s=(t-1)*r*2,l=new a.BufferAttribute(Q.allocateTyped(o,3*s),1),c=0,u=0,h=0;h<t;h++){if(h!==t-1)for(var f=0;f<r;f++){var d=c+f,p=c+r+f,m=c+r+(f+1)%r,v=c+(f+1)%r;l.setXYZ(3*u,d,v,p),u++,l.setXYZ(3*u,p,v,m),u++}c+=r}n.setIndex(l);var g=Q.allocateTyped(Float32Array,3*i);return n.setAttribute("position",new a.BufferAttribute(g,3)),n._positions=e,n}(e,r);(o=t.call(this,s,i))._ringsCount=r;for(var l=o._tmpShape=[],c=0;c<e.length;++c)l[c]=new a.Vector3;return o}return _(n,[{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this._chunkGeo._positions.length,o=this._ringsCount,a=i*this._ringsCount*e*3;this._setPoints(t,i,o,a),n?this._setSlopeNormals(i,o,a):this._setBaseNormals(i,o,a),r&&this._addCut(i,o,a)}},{key:"_setPoints",value:function(e,t,n,r){for(var i=this._tmpShape,o=this._positions,a=this._chunkGeo._positions,s=0,l=r;s<n;++s)for(var c=e[s],u=0;u<t;++u,l+=3)i[u].copy(a[u]).applyMatrix4(c).toArray(o,l)}},{key:"_setBaseNormals",value:function(e,t,n){for(var r=3*e,i=0,o=n;i<t;++i,o+=r)this._countNormalsInRing(e,o,!1)}},{key:"_setSlopeNormals",value:function(e,t,n){for(var r=this._normals,i=3*e,o=n,a=0;a<e;++a,o+=3)_r.toArray(r,o);if(o-2*i>0)for(var s=0;s<e;++s,o+=3)yr.fromArray(r,o-2*i).toArray(r,o);else this._countNormalsInRing(e,o,!0,+i),o+=i;for(var l=2;l<t;++l,o+=i)this._countNormalsInRing(e,o,!0,-i)}},{key:"_countNormalsInRing",value:function(e,t,n,r){var i=this._tmpShape,o=this._normals;i[0].fromArray(this._positions,t),i[e-1].fromArray(this._positions,t+3*(e-1));for(var a=0;a<e;++a,t+=3)a<e-1&&i[a+1].fromArray(this._positions,t+3),n?(br.fromArray(this._positions,t+r),vr.subVectors(i[(a+e-1)%e],i[(a+1)%e]).normalize(),gr.subVectors(i[a],br).normalize(),yr.crossVectors(gr,vr).normalize().toArray(o,t)):(vr.subVectors(i[a],i[(a+e-1)%e]).normalize(),gr.subVectors(i[a],i[(a+1)%e]).normalize(),yr.addVectors(vr,gr).normalize().toArray(o,t))}},{key:"_addCut",value:function(e,t,n){if(!(e<3||t<2)){var r=this._positions,i=this._normals,o=this._tmpShape,a=3*e;o[0].fromArray(r,n),o[1].fromArray(r,n+3),o[2].fromArray(r,n+6),vr.subVectors(o[1],o[0]).normalize(),gr.subVectors(o[1],o[2]).normalize(),xr.crossVectors(vr,gr).normalize();for(var s=n,l=0;l<2*e;++l,s+=3)xr.toArray(i,s);if(t>2)for(var c=0;c<e;++c,s+=3)yr.fromArray(r,s-a).toArray(r,s)}}}]),n}(Jn);function Sr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Mr=new a.Color,Er=new a.Vector3;function Tr(e,t,n,r,i){e[t]=n,e[t+1]=r,e[t+2]=i}function Ar(e,t,n,r,i,o){e[t]=n,e[t+1]=r,e[t+2]=i,e[t+3]=o}function Cr(e,t,n,r){var i=4*t,o=i+4*n;return e.subarray(i*r,o*r)}var Rr=function(e){T(n,e);var t=Sr(n);function n(e){var r;return g(this,n),(r=t.call(this))._initVertices(e),r}return _(n,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this.getAttribute("direction").needsUpdate=!0}},{key:"setColor",value:function(e,t){Mr.set(t);var n=4*e*3;Tr(this._colors,n,Mr.r,Mr.g,Mr.b),n+=3,Tr(this._colors,n,Mr.r,Mr.g,Mr.b),n+=3,Tr(this._colors,n,Mr.r,Mr.g,Mr.b),n+=3,Tr(this._colors,n,Mr.r,Mr.g,Mr.b)}},{key:"setSegment",value:function(e,t,n){Er.subVectors(t,n),Er.normalize();var r=this._positions,i=this._directions,o=4*e*4,a=4*e*3;Ar(r,o,t.x,t.y,t.z,.5),Tr(i,a,Er.x,Er.y,Er.z),a+=3,Ar(r,o+=4,t.x,t.y,t.z,-.5),Tr(i,a,Er.x,Er.y,Er.z),a+=3,Ar(r,o+=4,n.x,n.y,n.z,.5),Tr(i,a,Er.x,Er.y,Er.z),a+=3,Ar(r,o+=4,n.x,n.y,n.z,-.5),Tr(i,a,Er.x,Er.y,Er.z)}},{key:"setOpacity",value:function(e,t,n){var r=4*e,i=4*t;o.default.fill(this.alpha,n,i,r),this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubsetSegments",value:function(e,t){return[Cr(this._positions,e,t,4),Cr(this._directions,e,t,3)]}},{key:"getSubsetColors",value:function(e,t){return Cr(this._colors,e,t,3)}},{key:"getSubsetOpacities",value:function(e,t){return Cr(this._alpha,e,t,1)}},{key:"getNumVertexPerSegment",value:function(){return 4}},{key:"getPositionSize",value:function(){return 4}},{key:"setSegments",value:function(e,t){var n=4*e*4;if(t instanceof Array&&2===t.length){this._positions.set(t[0],n);var r=4*e*3;this._directions.set(t[1],r)}else this._positions.set(t,n)}},{key:"setColors",value:function(e,t){var n=4*e*3;this._colors.set(t,n)}},{key:"_initVertices",value:function(e){this._buffersSize=4*e;var t=this._buffersSize,n=t>65535;this._index=Q.allocateTyped(n?Uint32Array:Uint16Array,6*e),this._positions=Q.allocateTyped(Float32Array,4*t),this._colors=Q.allocateTyped(Float32Array,3*t),this._directions=Q.allocateTyped(Float32Array,3*t);var r=this._alpha=Q.allocateTyped(Float32Array,t);o.default.fill(r,1);for(var i=this._index,s=0,l=0,c=0;c<e;c++,s+=6,l+=4)i[s]=l,i[s+1]=l+1,i[s+2]=l+3,i[s+3]=l,i[s+4]=l+2,i[s+5]=l+3;this.setIndex(new a.BufferAttribute(this._index,1)),this.setAttribute("position",new a.BufferAttribute(this._positions,4)),this.setAttribute("color",new a.BufferAttribute(this._colors,3)),this.setAttribute("alphaColor",new a.BufferAttribute(r,1)),this.setAttribute("direction",new a.BufferAttribute(this._directions,3))}}]),n}(a.BufferGeometry);function Pr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Lr=function(e){T(n,e);var t=Pr(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var e=this.boundingBox,t=0,n=new a.Vector3;e&&e.getCenter(n);for(var r=this._positions,i=this.boundingSphere||new a.Sphere,o=this._positions.length,s=new a.Vector3,l=this.getPositionSize(),c=0;c<o;c+=l){s.set(r[c],r[c+1],r[c+2]);var u=n.distanceToSquared(s);t<u&&(t=u)}i.set(n,Math.sqrt(t)),this.boundingSphere=i}},{key:"computeBoundingBox",value:function(){for(var e=this._positions,t=new a.Box3,n=this._positions.length,r=new a.Vector3,i=this.getPositionSize(),o=0;o<n;o+=i)r.set(e[o],e[o+1],e[o+2]),t.expandByPoint(r);this.boundingBox=t}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}}]),n}(Rr);function kr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Ir=new a.Vector3,Nr=new a.Matrix3,Or=function(e){T(n,e);var t=kr(n);function n(e,r){var i;g(this,n);var o=new a.CylinderBufferGeometry(1,1,1,Math.max(3,r),2,!0),s=(i=t.call(this,o,e))._chunkSize;return i._chunkPos=i._chunkGeo.attributes.position.array,i._chunkNorms=i._chunkGeo.attributes.normal.array,i._tmpVector=Q.allocateTyped(Float32Array,3*s),i}return _(n,[{key:"setItem",value:function(e,t,n,r){var i,o=this._chunkSize,a=o*e*3,s=this._tmpVector,l=this._chunkPos,c=this._chunkNorms,u=Nn.calcCylinderMatrix(t,n,r);Nr.getNormalMatrix(u);for(var h=0;h<o;++h)i=3*h,Ir.fromArray(l,i),Ir.applyMatrix4(u),Ir.toArray(s,i);this._positions.set(s,a);for(var f=0;f<o;++f)i=3*f,Ir.fromArray(c,i),Ir.applyMatrix3(Nr),Ir.toArray(s,i);this._normals.set(s,a)}}]),n}(Jn);function Dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Br=function(e){T(n,e);var t=Dr(n);function n(e,r,i){var o;return g(this,n),(o=t.call(this,e*r))._init(r),o._collisionGeo=i?new Or(e*r,3):null,o}return _(n,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var e=this._collisionGeo;if(e)return e.computeBoundingSphere(),void(this.boundingSphere=e.boundingSphere);Qe(P(n.prototype),"computeBoundingSphere",this).call(this)}},{key:"computeBoundingBox",value:function(){var e=this._collisionGeo;if(e)return e.computeBoundingBox(),void(this.boundingBox=e.boundingBox);Qe(P(n.prototype),"computeBoundingBox",this).call(this)}},{key:"raycast",value:function(e,t){if(this._collisionGeo){var n=this._chunkSize;this._collisionGeo.raycast(e,t);for(var r=0,i=t.length;r<i;++r){var o=t[r].chunkIdx;void 0!==o&&(o=o/n|0,t[r].chunkIdx=o)}}}},{key:"setColor",value:function(e,t){for(var r=this._chunkSize,i=e*r,o=i+r;i<o;++i)Qe(P(n.prototype),"setColor",this).call(this,i,t)}},{key:"setSegment",value:function(e,t,r,i){var o=this._chunkSize,a=e*o+t;Qe(P(n.prototype),"setSegment",this).call(this,a,r,i),this._collisionGeo&&this._collisionGeo.setItem(e*o+t,r,i,.1)}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(e,t){for(var r=this._chunkSize,i=0,o=e.length;i<o;++i){var a=e[i]*r;Qe(P(n.prototype),"setOpacity",this).call(this,a,a+r-1,t)}}},{key:"getSubset",value:function(e){for(var t=e.length,r=this._chunkSize,i=new n(t,r,!1),o=0,a=e.length;o<a;++o){var s=o*r,l=e[o]*r;i.setSegments(s,this.getSubsetSegments(l,r)),i.setColors(s,this.getSubsetColors(l,r))}return i.boundingSphere=this.boundingSphere,i.boundingBox=this.boundingBox,[i]}},{key:"_init",value:function(e){this._chunkSize=e}}]),n}(Lr);function zr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Fr=new a.Vector3,Vr=function(e){T(n,e);var t=zr(n);function n(e){var r;return g(this,n),(r=t.call(this,2*e))._init(e),r._collisionGeo=new ir(e,3),r}return _(n,[{key:"setItem",value:function(e,t,r){this._collisionGeo.setItem(e,t,r,.3);var i=2*e;Fr.lerpVectors(t,r,.5),Qe(P(n.prototype),"setSegment",this).call(this,i,t,Fr),Qe(P(n.prototype),"setSegment",this).call(this,i+1,Fr,r)}},{key:"setColor",value:function(e,t,r){var i=2*e;Qe(P(n.prototype),"setColor",this).call(this,i,t),Qe(P(n.prototype),"setColor",this).call(this,i+1,r)}},{key:"raycast",value:function(e,t){this._collisionGeo&&this._collisionGeo.raycast(e,t)}},{key:"getSubset",value:function(e){for(var t=e.length,r=new n(t,!1),i=0,o=t;i<o;++i){var a=e[i];r.setSegments(i,this.getSubsetSegments(a,1)),r.setColors(i,this.getSubsetColors(a,1))}return r.boundingSphere=this.boundingSphere,r.boundingBox=this.boundingBox,[r]}},{key:"_init",value:function(e){this._segCounts=2*e}}]),n}(Lr);function Ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Gr=[new a.Vector3(1,0,0),new a.Vector3(-1,0,0),new a.Vector3(0,1,0),new a.Vector3(0,-1,0),new a.Vector3(0,0,1),new a.Vector3(0,0,-1)],Hr=Gr.length,jr=new a.Vector3,Wr=new a.Vector3,qr=function(e){T(n,e);var t=Ur(n);function n(e){return g(this,n),t.call(this,e,e,Hr/2|0,!1)}return _(n,[{key:"setItem",value:function(e,t,n){this.setSphere(e,t,n);for(var r=0;r<Hr/2;++r){var i=2*r;jr.x=t.x+Gr[i].x*n,jr.y=t.y+Gr[i].y*n,jr.z=t.z+Gr[i].z*n;var o=i+1;Wr.x=t.x+Gr[o].x*n,Wr.y=t.y+Gr[o].y*n,Wr.z=t.z+Gr[o].z*n,this.setSegment(e,r,jr,Wr)}}}]),n}(jn(Br));function Xr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Yr=new a.Color,Zr=function(e){T(n,e);var t=Xr(n);function n(e,r){var i;return g(this,n),(i=t.call(this))._opts=r,i.zClip=i._opts.zClip,i._posRad=Q.allocateTyped(Float32Array,4*e),i._colors=Q.allocateTyped(Float32Array,3*e),i}return _(n,[{key:"setItem",value:function(e,t,n){var r=this._posRad,i=4*e;r[i++]=t.x,r[i++]=t.y,r[i++]=t.z,r[i]=n}},{key:"setColor",value:function(e,t){Yr.set(t);var n=this._colors,r=3*e;n[r++]=Yr.r,n[r++]=Yr.g,n[r]=Yr.b}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"finishUpdate",value:function(){this._build()}},{key:"setOpacity",value:function(){}},{key:"raycast",value:function(){}},{key:"getSubset",value:function(){return[]}}]),n}(a.BufferGeometry),$r=function(){function e(){g(this,e),this.pointsValuesLinear=null,this.hasIntersection=null,this.bitsInside=null}return _(e,[{key:"create",value:function(e){var t=e*e*e;if(t>117440512)throw new Error("Too large cube dimension: lead to memory huge uasge");return this.pointsValuesLinear=Q.allocateTyped(Float32Array,32*t),this.hasIntersection=Q.allocateTyped(Int32Array,t),this.bitsInside=Q.allocateTyped(Int32Array,t),0}},{key:"destroy",value:function(){this.bitsInside=null,this.hasIntersection=null,this.pointsValuesLinear=null}}]),e}();$r.prototype.striIndicesMarchCube=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];var Jr=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Kr=function e(){g(this,e),this._arrSize=8,this.p=new Array(this._arrSize),this.g=new Array(this._arrSize),this.val=new Array(this._arrSize);for(var t=0;t<this._arrSize;++t)this.p[t]=new a.Vector3,this.g[t]=new a.Vector3;this.cubeIndex=0},Qr=function e(){g(this,e),this.a={p:new a.Vector3,n:new a.Vector3},this.b={p:new a.Vector3,n:new a.Vector3},this.c={p:new a.Vector3,n:new a.Vector3}};function ei(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=new a.Vector3;return t}var ti=function(){function e(){g(this,e),this._numTriangles=0,this._numVertices=0,this._position=[],this._normals=[],this._colors=null,this._indices=[],this._volumetricData=null,this._xAxis=new a.Vector3,this._yAxis=new a.Vector3,this._zAxis=new a.Vector3,this._xDir=new a.Vector3,this._yDir=new a.Vector3,this._zDir=new a.Vector3}return _(e,[{key:"_prepareAxesAndDirs",value:function(){var e=this._volumetricData.getCellSize(),t=this._xAxis,n=this._yAxis,r=this._zAxis,i=this._xDir,o=this._yDir,s=this._zDir;t.set(e.x,0,0),n.set(0,e.y,0),r.set(0,0,e.z),i.set(1,0,0),o.set(0,1,0),s.set(0,0,1);var l=new a.Vector3;if(l.crossVectors(i,o),l.dot(s)<0&&(i.negate(),o.negate(),s.negate()),i.x<0||i.y<0||i.z<0||o.x<0||o.y<0||o.z<0||s.x<0||s.y<0||s.z<0)return!1;var c=function(e){return Math.abs(e)>Number.EPSILON};return!(c(t.y)||c(t.z)||c(n.x)||c(n.z)||c(r.x)||c(r.y))}},{key:"_vertexInterp",value:function(e,t,n,r,i,o){var a=t.p[n],s=t.p[r],l=t.g[n],c=t.g[r],u=t.val[n],h=e-u,f=t.val[r]-u,d=0;Math.abs(f)>0&&(d=h/f),d=d>1?1:d,i.lerpVectors(a,s,d),o.lerpVectors(l,c,d)}},{key:"_polygonize",value:function(t,n,r){for(var i=t.cubeIndex,o=0,a=e._arrSize,s=e._firstIndices,l=e._secondIndices,c=e._vertexList,u=e._normalList;o<a;++o)Jr[i]&1<<o&&this._vertexInterp(n,t,s[o],l[o],c[o],u[o]);var h=0,f=16*i,d=e._triTable;for(o=0;-1!==d[f+o];o+=3)r[h].a.p.copy(c[d[f+o]]),r[h].a.n.copy(u[d[f+o]]),r[h].b.p.copy(c[d[f+o+1]]),r[h].b.n.copy(u[d[f+o+1]]),r[h].c.p.copy(c[d[f+o+2]]),r[h].c.n.copy(u[d[f+o+2]]),++h;return h}},{key:"_doGridPosNorms",value:function(e,t,n){for(var r,i=this._volumetricData,o=this._volumetricData.getData(),s=i.getDimensions(),l=s[0],c=s[1],u=s[2],h=t*i.getStrideX(),f=t*i.getStrideY(),d=t*i.getStrideZ(),p=new Kr,m=p.val,v=p.val.length,g=[new a.Vector3(0,0,0),new a.Vector3(t,0,0),new a.Vector3(t,t,0),new a.Vector3(0,t,0),new a.Vector3(0,0,t),new a.Vector3(t,0,t),new a.Vector3(t,t,t),new a.Vector3(0,t,t)],y=new Array(5),_=0;_<5;++_)y[_]=new Qr;var x,b=this,w=this._position,S=this._normals;n?(x=new a.Vector3(b._xAxis.x,b._yAxis.y,b._zAxis.z),r=function(e){var t=e.p.clone();t.multiply(x),w.push(t.add(b._origin)),S.push(e.n.clone())}):r=function(){var e=new a.Matrix3;e.set(b._xAxis.x,b._yAxis.x,b._zAxis.x,b._xAxis.y,b._yAxis.y,b._zAxis.y,b._xAxis.z,b._yAxis.z,b._zAxis.z);var t=new a.Matrix3;return t.set(b._xDir.x,b._yDir.x,b._zDir.x,b._xDir.y,b._yDir.y,b._zDir.y,b._xDir.z,b._yDir.z,b._zDir.z),function(n){w.push(n.p.clone().applyMatrix3(e).add(b._origin)),S.push(n.n.clone().applyMatrix3(t))}}();for(var M,E,T,A,C=this._indices,R=0,P=0;P<u-t;P+=t)for(var L=0;L<c-t;L+=t)for(var k=i.getDirectIdx(0,L,P),I=0;I<l-t;I+=t,k+=h){m[0]=o[k],m[1]=o[k+h],m[3]=o[k+f],m[2]=o[k+h+f],m[4]=o[k+d],m[5]=o[k+h+d],m[7]=o[k+f+d],m[6]=o[k+h+f+d];for(var N=0,O=0;O<v;++O)m[O]<e&&(N|=1<<O);if(0!==Jr[N]){for(p.cubeIndex=N,O=0;O<v;++O)p.p[O].set(I+g[O].x,L+g[O].y,P+g[O].z),M=this._gradient,E=p.p[O],T=p.g[O],A=void 0,A=M.getValue(E.x,E.y,E.z),T.set(A[0],A[1],A[2]);var D=this._polygonize(p,e,y);for(R+=D,O=0;O<D;++O)C.push(3*this._numTriangles),C.push(3*this._numTriangles+1),C.push(3*this._numTriangles+2),++this._numTriangles,r(y[O].a),r(y[O].b),r(y[O].c)}}return R}},{key:"compute",value:function(e,t,n,r){this._volumetricData=e,this._origin=t,this._gradient=e.computeGradient(),this._doGridPosNorms(n,r,this._prepareAxesAndDirs())}},{key:"_remapIndices",value:function(e,t){for(var n=this._indices,r=Q.allocateTyped(Uint32Array,t),i=0;i<t;++i)n[i]=e[n[i]],r[i]=n[i];this._indices=r}},{key:"_remapVertices",value:function(e,t,n){for(var r=Q.allocateTyped(Float32Array,3*n),i=Q.allocateTyped(Float32Array,3*n),o=0;o<n;++o){var a=e[o];r[3*o]=a.x,r[3*o+1]=a.y,r[3*o+2]=a.z;var s=t[o].normalize();i[3*o]=s.x,i[3*o+1]=s.y,i[3*o+2]=s.z}this._position=r,this._normals=i}},{key:"vertexFusion",value:function(e,t){var n=this._indices.length,r=this._position,i=this._normals,o=0|r.length;if(0!==n&&0!==o){var a=Q.allocateTyped(Uint32Array,o);a[0]=0;for(var s=1,l=1;l<o;++l){for(var c=s-e<0?0:s-e,u=c+t>s?s:c+t,h=-1,f=c;f<u;++f)if(Math.abs(r[l]-r[f])<Number.EPSILON){h=f;break}-1!==h?a[l]=h:(r[s].copy(r[l]),i[s].copy(i[l]),a[l]=s,++s)}this._remapIndices(a,n),this._remapVertices(r,i,s)}}},{key:"setColorVolTex",value:function(e,t,n,r){var i,o,a,s,l,c,u=this._position.length/3,h=this._position,f=this._origin,d=this._volumetricData.getDimensions(),p=d[0]-1,m=d[1]-1,v=d[2]-1,g=e.getData(),y=e.getStrideX(),_=e.getStrideY(),x=e.getStrideZ();null!==r&&(a=n.getData(),s=n.getStrideX(),l=n.getStrideY(),c=n.getStrideZ());var b=1/this._xAxis.x,w=1/this._yAxis.y,S=1/this._zAxis.z,M=[],E=[],T=Q.allocateTyped(Float32Array,3*u);function A(e,t,n,r){r[0]=(1-e)*g[t]+e*g[n],r[1]=(1-e)*g[t+1]+e*g[n+1],r[2]=(1-e)*g[t+2]+e*g[n+2]}function C(e,n,r,i){var o=t[e];if(null!=o){M[o.index]=o;var s=n*r*i*a[e];void 0===E[o.index]?E[o.index]=s:E[o.index]+=s}}var R=Q.allocateTyped(Int32Array,u),P=0;for(i=0;i<u;i++){var L=3*i,k=(h[L]-f.x)*b,I=(h[L+1]-f.y)*w,N=(h[L+2]-f.z)*S,O=0|Math.min(Math.max(k,0),p),D=0|Math.min(Math.max(I,0),m),B=0|Math.min(Math.max(N,0),v),z=k-O,F=I-D,V=N-B;if(null!=r){M=[],E=[],C(o=n.getDirectIdx(O,D,B),1-z,1-F,1-V),C(o+s,z,1-F,1-V),C(o+l,1-z,F,1-V),C(o+s+l,z,F,1-V),C(o+c,1-z,1-F,V),C(o+s+c,z,1-F,V),C(o+l+c,1-z,F,V),C(o+s+l+c,z,F,V);var U=0,G=-1;for(var H in E)E[H]>U&&(G=H,U=E[H]);if(G<0||!r.includesAtom(M[G])){R[i]=-1;continue}}R[i]=P++;var j=O<p?y:0,W=D<m?_:0,q=B<v?x:0,X=[0,0,0],Y=[0,0,0],Z=[0,0,0],$=[0,0,0];A(z,o=e.getDirectIdx(O,D,B),o+j,X),A(z,o+W,o+j+W,Y),A(z,o+q,o+j+q,Z),A(z,o+W+q,o+j+W+q,$);var J=[0,0,0];J[0]=(1-F)*X[0]+F*Y[0],J[1]=(1-F)*X[1]+F*Y[1],J[2]=(1-F)*X[2]+F*Y[2];var K=[0,0,0];K[0]=(1-F)*Z[0]+F*$[0],K[1]=(1-F)*Z[1]+F*$[1],K[2]=(1-F)*Z[2]+F*$[2],T[L]=(1-V)*J[0]+V*K[0],T[L+1]=(1-V)*J[1]+V*K[1],T[L+2]=(1-V)*J[2]+V*K[2]}if(this._colors=T,null!=r){for(i=0;i<u;++i){var ee=R[i];ee<0||(this._position[3*ee]=this._position[3*i],this._position[3*ee+1]=this._position[3*i+1],this._position[3*ee+2]=this._position[3*i+2],this._normals[3*ee]=this._normals[3*i],this._normals[3*ee+1]=this._normals[3*i+1],this._normals[3*ee+2]=this._normals[3*i+2],this._colors[3*ee]=this._colors[3*i],this._colors[3*ee+1]=this._colors[3*i+1],this._colors[3*ee+2]=this._colors[3*i+2])}var te=this._indices.length/3,ne=0;for(i=0;i<te;++i){var re=R[this._indices[3*i]],ie=R[this._indices[3*i+1]],oe=R[this._indices[3*i+2]];re>=0&&ie>=0&&oe>=0&&(this._indices[3*ne]=re,this._indices[3*ne+1]=ie,this._indices[3*ne+2]=oe,++ne)}this._position=new Float32Array(this._position.buffer.slice(0,3*P*4)),this._normals=new Float32Array(this._normals.buffer.slice(0,3*P*4)),this._colors=new Float32Array(this._colors.buffer.slice(0,3*P*4)),this._indices=new Uint32Array(this._indices.buffer.slice(0,3*ne*4))}}},{key:"toMesh",value:function(){var e=new a.BufferGeometry;return e.setIndex(new a.BufferAttribute(this._indices,1)),e.setAttribute("position",new a.BufferAttribute(this._position,3)),e.setAttribute("normal",new a.BufferAttribute(this._normals,3)),e.setAttribute("color",new a.BufferAttribute(this._colors,3)),e.computeBoundingSphere(),e}}]),e}();function ni(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(ti,"_triTable",$r.prototype.striIndicesMarchCube),Ee(ti,"_arrSize",12),Ee(ti,"_firstIndices",[0,1,2,3,4,5,6,7,0,1,2,3]),Ee(ti,"_secondIndices",[1,2,3,0,5,6,7,4,4,5,6,7]),Ee(ti,"_vertexList",ei(ti._arrSize)),Ee(ti,"_normalList",ei(ti._arrSize));var ri=function(e){T(n,e);var t=ni(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_build",value:function(){var e=this._opts;this.numVoxels=[128,128,128],this.xAxis=new a.Vector3(1,0,0),this.yAxis=new a.Vector3(0,1,0),this.zAxis=new a.Vector3(0,0,1),this.origin=new a.Vector3(0,0,0),this._visibilitySelector=e.visibilitySelector,this._calcSurface(e)}},{key:"_findMinMax",value:function(e){for(var t=e.length/4,n=[e[0],e[1],e[2],e[3]],r=[e[0],e[1],e[2],e[3]],i=1;i<t;++i)for(var o=4*i,a=0;a<4;++a){var s=e[o+a];n[a]=Math.max(s,n[a]),r[a]=Math.min(s,r[a])}return{maxPosRad:n,minPosRad:r}}},{key:"_findNumVoxels",value:function(e,t){var n=this.numVoxels,r=this._findMinMax(e),i=r.minPosRad,o=r.maxPosRad;i[3]>4&&(t.gridSpacing*=i[3]);var a=t.radScale*o[3]*1.7,s=a;s=.65*Math.sqrt(4/3*Math.PI*s*s*s),a=Math.max(a,s);for(var l=0;l<3;++l)i[l]-=a,o[l]+=a;for(l=0;l<3;++l)n[l]=Math.ceil((o[l]-i[l])/t.gridSpacing);this.xAxis.x=(n[0]-1)*t.gridSpacing,this.yAxis.y=(n[1]-1)*t.gridSpacing,this.zAxis.z=(n[2]-1)*t.gridSpacing;var u=c(i,3);return this.origin.x=u[0],this.origin.y=u[1],this.origin.z=u[2],{bbox:r,dim:n}}},{key:"_makeSurface",value:function(e,t){var n=new ti;n.compute(e.volMap,this.origin,t.isoValue,1),n.vertexFusion(9,9),n._numTriangles>0?(n.setColorVolTex(e.volTexMap,e.atomMap,e.atomWeightMap,this._visibilitySelector),this.setIndex(new a.BufferAttribute(n._indices,1)),this.setAttribute("position",new a.BufferAttribute(n._position,3)),this.setAttribute("normal",new a.BufferAttribute(n._normals,3)),this.setAttribute("color",new a.BufferAttribute(n._colors,3))):this.setAttribute("position",new a.BufferAttribute(Q.allocateTyped(Float32Array,0),3))}},{key:"_calcSurface",value:function(e){var t={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};if(0!==t.posRad.length){var n=this._findNumVoxels(t.posRad,e),r=new a.Box3(this.origin,new a.Vector3(this.xAxis.x,this.yAxis.y,this.zAxis.z).add(this.origin)),i=this._computeSurface(t,r,n,e);this._makeSurface(i,e)}}}]),n}(Zr);function ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var oi=yn.Volume,ai=function(e){T(n,e);var t=ii(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_computeSurface",value:function(e,t,n,r){this._shiftByOrigin(e.posRad);var i={volMap:new oi(Float32Array,this.numVoxels,t),volTexMap:new oi(Float32Array,this.numVoxels,t,3)};return null!=this._visibilitySelector&&(i.atomMap=[],i.atomWeightMap=new oi(Float32Array,this.numVoxels,t)),this.gaussdensity(i,e,null,r),i}},{key:"gaussdensity",value:function(e,t,n,r){var i,o=t.posRad.length/4,a=t.posRad,s=t.colors,l=this.numVoxels,c=r.radScale,u=r.gaussLim,h=r.gridSpacing,f=1/r.isoValue,d=1/h,p=l[0]-1,m=l[1]-1,v=l[2]-1,g=e.volMap,y=e.volTexMap,_=g.getData(),x=g.getStrideX(),b=y.getData(),w=y.getStrideX();null!=this._visibilitySelector&&(i=e.atomWeightMap.getData());for(var S=e.atomMap,M=0;M<o;++M){var E=4*M,T=a[E+3]*c,A=null===n?1:n[M],C=1/(2*T*T),R=u*T,P=R*R;R*=d;var L=a[E]*d,k=Math.max(L-R|0,0),I=Math.min(L+R|0,p);L=a[E+1]*d;var N=Math.max(L-R|0,0),O=Math.min(L+R|0,m);L=a[E+2]*d;for(var D=Math.max(L-R|0,0),B=Math.min(L+R|0,v),z=D*h-a[E+2],F=D;F<=B;++F,z+=h)for(var V=N*h-a[E+1],U=N;U<=O;++U,V+=h){var G=V*V+z*z;if(!(G>=P))for(var H=g.getDirectIdx(k,U,F),j=y.getDirectIdx(k,U,F),W=k*h-a[E],q=k;q<=I;++q,W+=h,H+=x,j+=w){var X=-(W*W+G)*C,Y=Math.exp(X)*A;null!=this._visibilitySelector&&Y>i[H]&&(i[H]=Y,S[H]=t.atoms[M]),_[H]+=Y,Y*=f;var Z=3*M;b[j]+=Y*s[Z],b[j+1]+=Y*s[Z+1],b[j+2]+=Y*s[Z+2]}}}}},{key:"_shiftByOrigin",value:function(e){for(var t=this.origin.x,n=this.origin.y,r=this.origin.z,i=e.length/4,o=0;o<i;++o){var a=4*o;e[a]-=t,e[a+1]-=n,e[a+2]-=r}}}]),n}(ri);function si(e,t,n,r){var i=e.length/4,o=t[0],a=t[1],s=t[2],l=n[0],c=n[1],u=n[2];function h(e,t){return Math.floor((e-t)/r)}var f,d,p,m,v,g=h(l,o)+1,y=h(c,a)+1,_=h(u,s)+1,x=g*y*_,b=y*_,w=[];for(f=0;f<i;f++){var S=4*f;p=e[S],m=e[S+1],v=e[S+2],void 0===w[d=(h(p,o)*y+h(m,a))*_+h(v,s)]?w[d]=[f]:w[d].push(f)}var M,E=Q.allocateTyped(Uint32Array,x),T=Q.allocateTyped(Uint16Array,x),A=Q.allocateTyped(Uint32Array,i),C=0,R=0;for(f=0;f<x;f++){var P=E[f]=C,L=w[f];if(void 0!==L)for(M=0;M<L.length;M++)A[C]=L[M],C++;var k=C-P;T[f]=k,k>R&&(R=k)}this.neighbourListLength=27*R+1,this.withinRadii=function(t,n,r,i,l){var c=0,u=h(t,o),p=h(n,a),m=h(r,s),v=Math.max(0,u-1),x=Math.max(0,p-1),w=Math.max(0,m-1),S=Math.min(g-1,u+1),C=Math.min(y-1,p+1),R=Math.min(_-1,m+1);for(f=v;f<=S;++f){var P=f*b;for(M=x;M<=C;++M)for(var L=M*_,k=w;k<=R;++k)for(var I=E[d=P+L+k],N=I+T[d],O=I;O<N;O++){var D=4*A[O],B=e[D]-t,z=e[D+1]-n,F=e[D+2]-r,V=e[D+3]+i;B*B+z*z+F*F<=V*V&&(l[c++]=A[O])}}l[c]=-1}}function li(e,t,n,r){var i,o,s,l,c,u,h,f,d,p,m,v,g,y,_,x,b,w=e.posRad,S=e.colors,M=e.atoms,E=w.length/4,T=t.bbox,A=T.minPosRad,C=T.maxPosRad,R=-1,P=null,L=null,k=null,I=new a.Vector3(0,0,0),N=new a.Vector3(0,0,0),O=new a.Vector3(0,0,0);function D(e,t,n){for(var r=0;r<e.length;r++)e[r]=t+n*r}function B(){l=n.scaleFactor,u=t.dim,b=Math.min(5,2+Math.floor(s*l));var e=u[0]*u[1]*u[2];h=function(e,t,n){for(var r=Q.allocateTyped(e,t),i=0;i<t;++i)r[i]=n;return r}(Float32Array,e,-1001),f=Q.allocateTyped(Float32Array,3*e),d=Q.allocateTyped(Float32Array,e),k&&(P=Q.allocateTyped(Float32Array,e),L=[]),p=Q.allocateTyped(Float32Array,u[0]),m=Q.allocateTyped(Float32Array,u[1]),v=Q.allocateTyped(Float32Array,u[2]),D(p,A[0],1/l),D(m,A[1],1/l),D(v,A[2],1/l)}function z(){s=n.probeRadius,l=n.scaleFactor,c=n.probePositions,k=n.visibilitySelector,i=Q.allocateTyped(Float32Array,E),o=0;for(var e=0;e<E;++e){var t=w[4*e+3]+=s;t>o&&(o=t),i[e]=t*t}B(),function(){var e=0,t=2*Math.PI/c;y=Q.allocateTyped(Float32Array,c),g=Q.allocateTyped(Float32Array,c);for(var n=0;n<c;n++)y[n]=Math.cos(e),g[n]=Math.sin(e),e+=t}(),_=new si(w,A,C,2.01*o),x=new Int32Array(_.neighbourListLength),R=-1}function F(e,t,n,r){var o=4*e,a=i[e],s=w[o]-t,l=w[o+1]-n,c=w[o+2]-r;return s*s+l*l+c*c<a}function V(e,t,n,r,i){var o;if(-1!==R){if((o=R)!==r&&o!==i&&F(o,e,t,n))return o;R=-1}var a=0;for(o=x[a];o>=0;){if(o!==r&&o!==i&&F(o,e,t,n))return R=o,o;o=x[++a]}return R=-1,-1}function U(e,t){var n=4*e,r=4*t,i=w[n],o=w[n+1],a=w[n+2],s=w[n+3],f=I.x=w[r]-i,d=I.y=w[r+1]-o,_=I.z=w[r+2]-a,x=w[r+3],S=f*f+d*d+_*_,M=Math.sqrt(S),E=s*((s*s+M*M-x*x)/(2*s*M));I.normalize(),function(e,t){e.x=e.y=e.z=1,0!==t.x?e.x=(t.y+t.z)/-t.x:0!==t.y?e.y=(t.x+t.z)/-t.y:0!==t.z&&(e.z=(t.x+t.y)/-t.z)}(N,I),N.normalize(),O.crossVectors(I,N),O.normalize();var T=Math.sqrt(s*s-E*E);N.multiplyScalar(T),O.multiplyScalar(T),I.multiplyScalar(E),I.x+=i,I.y+=o,I.z+=a,R=-1;for(var C=b,P=0;P<c;P++){var L=y[P],k=g[P],D=I.x+L*N.x+k*O.x,B=I.y+L*N.y+k*O.y,z=I.z+L*N.z+k*O.z;if(-1===V(D,B,z,e,t))for(var F=Math.floor(l*(D-A[0])),U=Math.floor(l*(B-A[1])),G=Math.floor(l*(z-A[2])),H=Math.max(0,F-C),j=Math.max(0,U-C),W=Math.max(0,G-C),q=Math.min(u[0],F+C+2),X=Math.min(u[1],U+C+2),Y=Math.min(u[2],G+C+2),Z=W;Z<Y;Z++){_=z-v[Z];for(var $=u[1]*u[0]*Z,J=j;J<X;J++)for(var K=_*_+(d=B-m[J])*d,Q=$+u[0]*J,ee=H;ee<q;ee++){S=K+(f=D-p[ee])*f;var te=ee+Q,ne=h[te];ne>0&&S<ne*ne&&(h[te]=Math.sqrt(S))}}}}function G(){console.time("ContactSurface.getVolume"),console.time("ContactSurface.init"),z(),console.timeEnd("ContactSurface.init"),console.time("ContactSurface.projectPoints"),function(){for(var e=0;e<E;e++){var t=4*e,n=w[t],r=w[t+1],o=w[t+2],a=w[t+3],s=i[e];_.withinRadii(n,r,o,a,x);for(var c=Math.ceil(a*l),g=Math.floor(l*(n-A[0])),y=Math.floor(l*(r-A[1])),b=Math.floor(l*(o-A[2])),T=Math.max(0,g-c),C=Math.max(0,y-c),R=Math.max(0,b-c),I=Math.min(u[0],g+c+2),N=Math.min(u[1],y+c+2),O=Math.min(u[2],b+c+2),D=3*e,B=S[D],z=S[D+1],F=S[D+2],U=R;U<O;U++)for(var G=v[U]-o,H=u[1]*u[0]*U,j=C;j<N;j++)for(var W=m[j]-r,q=G*G+W*W,X=H+u[0]*j,Y=T;Y<I;Y++){var Z=Y+X,$=p[Y]-n,J=q+$*$;if(J<s){var K=Math.exp(.28125*-J),Q=3*Z;f[Q]+=B*K,f[Q+1]+=z*K,f[Q+2]+=F*K,d[Z]+=K,null!==k&&K>P[Z]&&(P[Z]=K,L[Z]=M[e]),h[Z]<0&&(h[Z]=-h[Z]);var ee=Math.sqrt(J),te=a/ee,ne=$*te,re=W*te,ie=G*te;if(-1===V(ne+=n,re+=r,ie+=o,e,-1)){var oe=a-ee;oe<h[Z]&&(h[Z]=oe)}}}}}(),console.timeEnd("ContactSurface.projectPoints"),console.time("ContactSurface.projectTorii"),function(){for(var e=0;e<E;e++){var t=4*e;_.withinRadii(w[t],w[t+1],w[t+2],w[t+3],x);for(var n=0,r=x[n];r>=0;)e<r&&U(e,r),r=x[++n]}}(),console.timeEnd("ContactSurface.projectTorii"),function(){for(var e=0,t=h.length;e<t;e++){h[e]<0&&(h[e]=0);var n=d[e];if(n>0){n=1/n;var r=3*e;f[r]*=n,f[r+1]*=n,f[r+2]*=n}}}(),console.timeEnd("ContactSurface.getVolume")}this.build=function(){G(),this.volTexMap=f,this.weightsMap=P,this.atomMap=L,this.volMap=h}}function ci(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ui=yn.Volume,hi=function(e){T(n,e);var t=ci(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_computeSurface",value:function(e,t,n,r){var i=new li(e,n,r);return i.build(),{volMap:new ui(Float32Array,this.numVoxels,t,1,i.volMap),volTexMap:new ui(Float32Array,this.numVoxels,t,3,i.volTexMap),atomMap:i.atomMap,atomWeightMap:new ui(Float32Array,this.numVoxels,t,1,i.weightsMap)}}}]),n}(ri),fi=function e(t,n){g(this,e),this.coord=new a.Vector3,this.coord.copy(t),this.radius=n,this.colorX=.99999,this.colorY=0,this.colorZ=0,this.atomType=0,this.srcAtom=null},di=function(){function e(t,n,r,i,o){g(this,e),this._numAtoms=t,this._atoms=n,this._vBoxMin=new a.Vector3,this._vBoxMax=new a.Vector3,this._vBoxMin.copy(r),this._vBoxMax.copy(i),this._probeRadius=o,this._atomsList=null,this._voxelList=null}return _(e,[{key:"createVoxels",value:function(){var e,t,n=0|this._numAtoms,r=this._atoms,i=this._vBoxMax.x-this._vBoxMin.x,o=this._vBoxMax.y-this._vBoxMin.y,a=this._vBoxMax.z-this._vBoxMin.z,s=i<o?i:o;s=a<s?a:s;var l,c=0,u=0;for(l=0;l<n;l++)c=(t=2*(r[l].radius+this._probeRadius))>c?t:c,u+=t;var h=Math.floor(s/c);h<2&&(h=2),u/=n,this._numCells=h,this._aveRad=u,this._maxRad=c;var f=h,d=h*h,p=h*h*h,m=this._xScale=1/(this._vBoxMax.x-this._vBoxMin.x),v=this._yScale=1/(this._vBoxMax.y-this._vBoxMin.y),g=this._zScale=1/(this._vBoxMax.z-this._vBoxMin.z),y=0,_=m*h,x=v*h,b=g*h;for(l=0;l<n;l++){var w=4.5*(r[l].radius+this._probeRadius)*2,S=Math.floor(_*w+.8),M=Math.floor(x*w+.8),E=Math.floor(b*w+.8);y+=++S*++M*++E}this._voxelList=Q.allocateTyped(Int32Array,p);var T=[];if(T.length=y,null===this._voxelList||null===T)return-1;for(l=0;l<p;l++)this._voxelList[l]=-1;for(e=0,l=0;l<n;l++){t=4.5*(r[l].radius+this._probeRadius);var A=Math.floor((r[l].coord.x-this._vBoxMin.x-t)*h*m),C=Math.floor((r[l].coord.y-this._vBoxMin.y-t)*h*v),R=Math.floor((r[l].coord.z-this._vBoxMin.z-t)*h*g),P=Math.floor((r[l].coord.x-this._vBoxMin.x+t)*h*m),L=Math.floor((r[l].coord.y-this._vBoxMin.y+t)*h*v),k=Math.floor((r[l].coord.z-this._vBoxMin.z+t)*h*g);A=A>=0?A:0,C=C>=0?C:0,P=P<h?P:h-1,L=L<h?L:h-1,k=k<h?k:h-1;for(var I=R=R>=0?R:0;I<=k;I++)for(var N=C;N<=L;N++)for(var O=A;O<=P;O++){var D=O+N*f+I*d;if(this._voxelList[D]<0)T[2*e+0]=l,T[2*e+1]=-1,this._voxelList[D]=e,e++;else{var B=this._voxelList[D];this._voxelList[D]=e,T[2*e+0]=l,T[2*e+1]=B,e++}}}return this._atomsList=Int32Array.from(T),0}},{key:"destroyVoxels",value:function(){this._atomsList=null,this._voxelList=null,this._atoms=null,this._vertices=null,this._vBoxMin=null,this._vBoxMax=null}},{key:"forEachRelatedAtom",value:function(e,t){for(var n=Math.floor((e.x-this._vBoxMin.x)*this._numCells*this._xScale),r=Math.floor((e.y-this._vBoxMin.y)*this._numCells*this._yScale),i=Math.floor((e.z-this._vBoxMin.z)*this._numCells*this._zScale),o=n+r*this._numCells+i*this._numCells*this._numCells,a=this._atoms,s=this._voxelList[o];s>=0;s=this._atomsList[2*s+1])t(a[this._atomsList[2*s]])}},{key:"getClosestAtom",value:function(e){var t=null,n=Number.MAX_VALUE;return this.forEachRelatedAtom(e,(function(r){var i=e.distanceToSquared(r.coord);i<n&&(n=i,t=r)})),t}},{key:"buildNormals",value:function(e,t,n){for(var r,i=this,o=0,a=0,s=0,l=0,c=0,u=0,h=0,f=0,d=0,p=2.5*this._aveRad,m=p*p,v=.1*-this._aveRad,g=function(e){var t=a-e.coord.x,n=s-e.coord.y,p=l-e.coord.z;if(!((r=t*t+n*n+p*p)>m)){var g=e.radius+i._probeRadius;(f=r-g*g)<0&&(f=-f),d=Math.exp(v*f),c+=t*d,u+=n*d,h+=p*d,o++}},y=0;y<e;y++)a=t[y].x,s=t[y].y,l=t[y].z,o=0,c=u=h=0,this.forEachRelatedAtom(t[y],g),r=c*c+u*u+h*h,o>0&&(f=1/Math.sqrt(r),c*=f,u*=f,h*=f),n[y].x=c,n[y].y=u,n[y].z=h;return 0}},{key:"buildColors",value:function(e,t,n,r){for(var i=this,o=0,a=0,s=0,l=0,c=0,u=r*r,h=[],f=[],d=0,p=function(e){var t=o-e.coord.x,n=a-e.coord.y,r=s-e.coord.z,p=t*t+n*n+r*r;if(!(p>u)){var m=e.radius+i._probeRadius;(l=p-m*m)<0&&(l=-l),c=1/(.8+l),h.push([e.colorX,e.colorY,e.colorZ]),f.push(c),d+=c}},m=0;m<e;m++){o=t[m].x,a=t[m].y,s=t[m].z,h=[],f=[],d=0,this.forEachRelatedAtom(t[m],p);for(var v=0;v<h.length;++v){var g=f[v]/d;n[m].x+=h[v][0]*g,n[m].y+=h[v][1]*g,n[m].z+=h[v][2]*g}}return 0}}]),e}(),pi=function(){function e(t,n,r){var i;for(g(this,e),this._maxNumVertices=t,this._maxNumTriangles=n,this._vertices=new Array(t),this._normals=new Array(t),this._colors=null,r&&(this._colors=new Array(t)),this._indices=new Array(3*n),this._numVertices=0,this._numTriangles=0,i=0;i<t;i++)this._vertices[i]=new a.Vector3,this._normals[i]=new a.Vector3;for(i=0;i<3*n;i++)this._indices[i]=-1;if(r)for(i=0;i<t;i++)this._colors[i]=new a.Vector3}return _(e,[{key:"destroy",value:function(){this._vertices=null,this._normals=null,this._indices=null}}]),e}();function mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var vi=yn.Element;function gi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var yi={InstancedSpheresGeometry:Yn,SimpleSpheresGeometry:Qn,Simple2CCylindersGeometry:ir,Instanced2CCylindersGeometry:pr,ExtrudedObjectsGeometry:wr,ChunkedLinesGeometry:Br,TwoColorLinesGeometry:Vr,CrossGeometry:qr,QuickSurfGeometry:ai,ContactSurfaceGeometry:hi,SSIsosurfaceGeometry:function(e){T(n,e);var t=mi(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_build",value:function(){this._innerBuild();var e=this.getGeo();this.destroy(),this._fromGeo(e)}},{key:"_fromGeo",value:function(e){var t=null,n=Q.allocateTyped(Float32Array,3*e._numVertices),r=Q.allocateTyped(Float32Array,3*e._numVertices);null!==e._colors&&(t=Q.allocateTyped(Float32Array,3*e._numVertices));for(var i=Q.allocateTyped(Uint32Array,3*e._numTriangles),o=0,s=0;o<e._numVertices;o++)n[s+0]=e._vertices[o].x,n[s+1]=e._vertices[o].y,n[s+2]=e._vertices[o].z,r[s+0]=e._normals[o].x,r[s+1]=e._normals[o].y,r[s+2]=e._normals[o].z,s+=3;if(null!==t)for(var l=0,c=0;l<e._numVertices;l++,c+=3)t[c+0]=e._colors[l].x,t[c+1]=e._colors[l].y,t[c+2]=e._colors[l].z;for(var u=3*e._numTriangles,h=0;h<u;h++)i[h]=e._indices[h];this.setIndex(new a.BufferAttribute(i,1)),this.setAttribute("position",new a.BufferAttribute(n,3)),this.setAttribute("normal",new a.BufferAttribute(r,3)),this.setAttribute("color",new a.BufferAttribute(t,3)),this.computeBoundingBox(),this.computeBoundingSphere(),e.destroy()}},{key:"convertToAtomsColored",value:function(e,t){for(var n=e.atoms,r=e.colors,i=0,o=n.length;i<o;i++){var a=n[i].position,s=n[i].element.radius;t[i]=new fi(a,s);var l=n[i].element.number;t[i].atomType=this.getType(l);var c=3*i;t[i].colorX=r[c++],t[i].colorY=r[c++],t[i].colorZ=r[c],t[i].srcAtom=n[i]}}},{key:"getGeo",value:function(){return this.geoOut}},{key:"destroy",value:function(){this.atoms=null,this.hashLines=null,this.hashEntries=null}},{key:"getBoundingBox",value:function(e,t,n){t.x=t.y=t.z=1e7,n.x=n.y=n.z=-1e7;for(var r=this.probeRadius*this.atomRadiusScale,i=0,o=0,a=e.length;o<a;o++){var s=e[o].coord,l=e[o].radius+r;i=l>i?l:i,s.x-l<t.x&&(t.x=s.x-l),s.y-l<t.y&&(t.y=s.y-l),s.z-l<t.z&&(t.z=s.z-l),s.x+l>n.x&&(n.x=s.x+l),s.y+l>n.y&&(n.y=s.y+l),s.z+l>n.z&&(n.z=s.z+l)}t.x-=i,t.y-=i,t.z-=i,n.x+=i,n.y+=i,n.z+=i}},{key:"getCornerCoord",value:function(e,t,n,r,i,o,a){var s=1/(o-1),l=n*s,c=r*s,u=i*s;a.x=e.x*(1-l)+t.x*l,a.y=e.y*(1-c)+t.y*c,a.z=e.z*(1-u)+t.z*u}},{key:"buildEdgePoint",value:function(e,t,n,r,i,o){if(n[e]^n[t]){var a=(0-r.pointsValuesLinear[i+24+e])/(r.pointsValuesLinear[i+24+t]-r.pointsValuesLinear[i+24+e]),s=r.pointsValuesLinear[i+3*e+0],l=r.pointsValuesLinear[i+3*e+1],c=r.pointsValuesLinear[i+3*e+2],u=r.pointsValuesLinear[i+3*t+0],h=r.pointsValuesLinear[i+3*t+1],f=r.pointsValuesLinear[i+3*t+2];o.x=s*(1-a)+u*a,o.y=l*(1-a)+h*a,o.z=c*(1-a)+f*a}}},{key:"isTriangleVisible",value:function(e,t,n){var r=this.voxelWorld.getClosestAtom(e),i=this.voxelWorld.getClosestAtom(t),o=this.voxelWorld.getClosestAtom(n);return null!==r&&null!==i&&null!==o&&null!==r.srcAtom&&null!==i.srcAtom&&null!==o.srcAtom&&this.visibilitySelector.includesAtom(r.srcAtom)&&this.visibilitySelector.includesAtom(i.srcAtom)&&this.visibilitySelector.includesAtom(o.srcAtom)}},{key:"addTriangle",value:function(e,t,n){if(this.visibilitySelector&&!this.isTriangleVisible(e,t,n))return!0;var r=this.geoOut;if(r._numTriangles>=this.maxNumTriangles)return!1;var i=this.addVertexToGeo(r,e),o=this.addVertexToGeo(r,t),a=this.addVertexToGeo(r,n);if((i|o|a)<0)return!1;var s=3*r._numTriangles;return r._indices[s+0]=i,r._indices[s+1]=o,r._indices[s+2]=a,r._numTriangles++,!0}},{key:"buildGeoFromCorners",value:function(e,t,n,r,i,o){for(var s=e-1,l=e,c=e*e,u=new Array(12),h=0;h<12;h++)u[h]=new a.Vector3;for(var f=[],d=0;d<8;d++)f[d]=1;for(var p=new a.Vector3,m=0,v=0,g=0;g<s;g++,v+=c)for(var y=0,_=0;_<s;_++,y+=l)for(var x=0;x<s;x++)if(o.hasIntersection[m]){var b=o.bitsInside[m];this.getCornerCoord(t,n,x,g,_,e,p);for(var w=32*m,S=0,M=0;S<8;S++)o.pointsValuesLinear[w+M++]=p.x,o.pointsValuesLinear[w+M++]=p.y,o.pointsValuesLinear[w+M++]=p.z;o.pointsValuesLinear[w+3]+=i.x,o.pointsValuesLinear[w+6]+=i.x,o.pointsValuesLinear[w+15]+=i.x,o.pointsValuesLinear[w+18]+=i.x,o.pointsValuesLinear[w+6+2]+=i.z,o.pointsValuesLinear[w+9+2]+=i.z,o.pointsValuesLinear[w+18+2]+=i.z,o.pointsValuesLinear[w+21+2]+=i.z,o.pointsValuesLinear[w+12+1]+=i.y,o.pointsValuesLinear[w+15+1]+=i.y,o.pointsValuesLinear[w+18+1]+=i.y,o.pointsValuesLinear[w+21+1]+=i.y;for(var E=w+24,T=0;T<8;++T)f[T]=o.pointsValuesLinear[E+T]<0?1:0;this.buildEdgePoint(0,1,f,o,w,u[0]),this.buildEdgePoint(1,2,f,o,w,u[1]),this.buildEdgePoint(2,3,f,o,w,u[2]),this.buildEdgePoint(3,0,f,o,w,u[3]),this.buildEdgePoint(4,5,f,o,w,u[4]),this.buildEdgePoint(5,6,f,o,w,u[5]),this.buildEdgePoint(6,7,f,o,w,u[6]),this.buildEdgePoint(7,4,f,o,w,u[7]),this.buildEdgePoint(0,4,f,o,w,u[8]),this.buildEdgePoint(1,5,f,o,w,u[9]),this.buildEdgePoint(2,6,f,o,w,u[10]),this.buildEdgePoint(3,7,f,o,w,u[11]);for(var A=16*b,C=0,R=0;C<6;C++,R+=3){var P=o.striIndicesMarchCube[A+R];if(P<0)break;var L=o.striIndicesMarchCube[A+R+1],k=o.striIndicesMarchCube[A+R+2];if(!this.addTriangle(u[P],u[L],u[k]))return-2}m++}else m++;return 0}},{key:"getNumIntersectedCells",value:function(e,t,n,r){for(var i=e*e,o=0,a=0,s=0,l=0;l<t;l++,s+=i)for(var c=0,u=0;u<t;u++,c+=e)for(var h=0;h<t;h++){var f=32*a+24,d=h+c+s;r.pointsValuesLinear[f]=n[d],r.pointsValuesLinear[f+1]=n[d+1],r.pointsValuesLinear[f+2]=n[d+e+1],r.pointsValuesLinear[f+3]=n[d+e],r.pointsValuesLinear[f+4]=n[i+d],r.pointsValuesLinear[f+5]=n[i+d+1],r.pointsValuesLinear[f+6]=n[i+d+e+1],r.pointsValuesLinear[f+7]=n[i+d+e];for(var p=0,m=0;m<8;++m)r.pointsValuesLinear[f+m]<0&&(p|=1<<m);0===p||255===p?r.hasIntersection[a]=!1:(r.hasIntersection[a]=!0,o++),r.bitsInside[a]=p,a++}return o}},{key:"getType",value:function(e){var t=[0,0,1,1,2,6,3,6,4,6,5,6,6,0,7,3,8,2,9,6,10,6,11,6,12,6,13,6,14,6,15,4,16,5,17,6,18,6,19,6,20,6,21,6,22,6,23,6,24,6,25,6,26,6,27,6,28,6,29,6,30,6,31,6,32,6,33,6,34,6,35,6,36,6,37,6,38,6,39,6,40,6,41,6,42,6,43,6,44,6,45,6,46,6,47,6,48,6,49,6,50,6,51,6,52,6,53,6,54,6,55,6,56,6,57,6,58,6,59,6,60,6,61,6,62,6,63,6,64,6,65,6,66,6,67,6,68,6,69,6,70,6,71,6,72,6,73,6,74,6,75,6,76,6,77,6,78,6,79,6,80,6,81,6,82,6,83,6,84,6,85,6,86,6,87,6,88,6,89,6,90,6,91,6,92,6,93,6,94,6,95,6,96,6,97,6,98,6,99,6,100,6,101,6,102,6,103,6,104,6,105,6,106,6,107,6,108,6,109,6];if(e<1||e>t.length/2||2*Object.keys(vi.ByAtomicNumber).length!==t.length)throw new Error("atomT.length  should be equal Element.ByAtomicNumber.length * 2");return t[2*e]}},{key:"calculateGridCorners",value:function(e,t,n,r,i,o){for(var s=t*t,l=s*t,c=new a.Vector3,u=new a.Vector3,h=0;h<l;h++)e[h]=1e12;for(var f=(t-1)/(r.x-n.x),d=(t-1)/(r.y-n.y),p=(t-1)/(r.z-n.z),m=0,v=i.length;m<v;m++){var g=i[m],y=g.radius+o,_=(g.coord.x-y-n.x)*f,x=(g.coord.y-y-n.y)*d,b=(g.coord.z-y-n.z)*p,w=Math.floor(_),S=Math.floor(x),M=Math.floor(b),E=Math.floor((g.coord.x+y-n.x)*f),T=Math.floor((g.coord.y+y-n.y)*d),A=Math.floor((g.coord.z+y-n.z)*p);E=++E<=t-1?E:t-1,T=++T<=t-1?T:t-1,A=++A<=t-1?A:t-1;for(var C=S;C<=T;C++)for(var R=C*s,P=M;P<=A;P++)for(var L=P*t,k=w;k<=E;k++){var I=R+L+k;this.getCornerCoord(n,r,k,C,P,t,c),u.x=c.x-g.coord.x,u.y=c.y-g.coord.y,u.z=c.z-g.coord.z;var N=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z)-y;N<e[I]&&(e[I]=N)}}}},{key:"createVertexHash",value:function(e,t){if(this.hashLines=Q.allocateTyped(Int32Array,65536),null===this.hashLines)return-1;for(var n=0,r=0;n<32768;n++)this.hashLines[r++]=0,this.hashLines[r++]=-1;if(this.maxNumVertices=e,this.maxNumTriangles=t,this.numHashEtriesAllocated=e,this.hashEntries=Q.allocateTyped(Int32Array,2*this.numHashEtriesAllocated),null===this.hashEntries)return-1;for(var i=0,o=0;i<this.numHashEtriesAllocated;i++)this.hashEntries[o++]=-1,this.hashEntries[o++]=-1;return this.numHashEntryIndex=0,0}},{key:"getNewHashEntry",value:function(){if(this.numHashEntryIndex<this.numHashEtriesAllocated){var e=this.numHashEntryIndex;return this.numHashEntryIndex++,e}return-1}},{key:"addVertexToGeo",value:function(e,t){var n,r=this.marCubeResoultion<<2,i=new a.Vector3,o=Math.floor(r*(t.x-this.vBoxMin.x)/(this.vBoxMax.x+.01-this.vBoxMin.x)),s=Math.floor(r*(t.y-this.vBoxMin.y)/(this.vBoxMax.y+.01-this.vBoxMin.y)),l=815851*o+37633*Math.floor(r*(t.z-this.vBoxMin.z)/(this.vBoxMax.z+.01-this.vBoxMin.z))+2453543*s,c=(l&=32767)+l;if(null!==this.vBoxMin&&null!==this.vBoxMax)for(n=this.hashLines[c+1];n>=0;n=this.hashEntries[2*n+1]){var u=this.hashEntries[2*n+0];if(i.copy(e._vertices[u]),i.x-=t.x,i.y-=t.y,i.z-=t.z,i.x*i.x+i.y*i.y+i.z*i.z<1e-6)return u}if(e._numVertices>=this.maxNumVertices)return-1;var h=e._numVertices;if(e._vertices[h].copy(t),null!==this.vBoxMin&&null!==this.vBoxMax){if((n=this.getNewHashEntry())<0)return-1;var f=this.hashLines[c+1];this.hashLines[c+1]=n,this.hashEntries[2*n+0]=h,this.hashEntries[2*n+1]=f,this.hashLines[c+0]++}return e._numVertices++,h}},{key:"modifyExcludedFromGeo",value:function(e,t,n,r,i,o){for(var a,s,l,c=e*e,u=(e-1)/(r.x-n.x),h=(e-1)/(r.y-n.y),f=(e-1)/(r.z-n.z),d=2*t*(2*t),p=1/(e-1),m=0;m<i._numVertices;m++){var v=i._vertices[m],g=1.1*t,y=Math.floor((v.x-g-n.x)*u),_=Math.floor((v.y-g-n.y)*h),x=Math.floor((v.z-g-n.z)*f),b=Math.floor((v.x+g-n.x)*u),w=Math.floor((v.y+g-n.y)*h),S=Math.floor((v.z+g-n.z)*f);y=y>=0?y:0,x=x>=0?x:0,b=b<=e-1?b:e-1,w=w<=e-1?w:e-1,S=S<=e-1?S:e-1;for(var M=_=_>=0?_:0;M<=w;M++)for(var E=M*c,T=x;T<=S;T++)for(var A=T*e,C=y;C<=b;C++){a=E+A+C;var R=C*p,P=n.x*(1-R)+r.x*R;R=M*p;var L=n.y*(1-R)+r.y*R;R=T*p;var k=n.z*(1-R)+r.z*R,I=P-v.x,N=L-v.y,O=k-v.z,D=I*I+N*N+O*O;D<d&&(s=Math.sqrt(D),(l=-(s-t))>0?(o[a]<0&&(o[a]=l),l>o[a]&&(o[a]=l)):l>o[a]&&(o[a]=l))}}return 0}},{key:"_innerBuild",value:function(){var e,t={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};this.complex=this._opts.parent,this.atoms=t.atoms,this.meshResolution=this._opts.gridSpacing,this.atomRadiusScale=this._opts.radScale,this.colorMode=this._opts.colorMode,this.probeRadius=this._opts.probeRadius,this.useVertexColors=!0,this.excludeProbe=this._opts.excludeProbe,this.visibilitySelector=this._opts.visibilitySelector,this.geoOut=null,this.hashLines=null,this.hashEntries=null,this.numHashEtriesAllocated=0,this.numHashEntryIndex=0,this.maxNumVertices=0,this.maxNumTriangles=0;var n=new Array(this.atoms.length);this.convertToAtomsColored(t,n);var r=this.vBoxMin=new a.Vector3,i=this.vBoxMax=new a.Vector3;this.getBoundingBox(n,r,i);var o=this.marCubeResoultion=4*this.meshResolution,s=o,l=s*s*s,c=Q.allocateTyped(Float32Array,l),u=this.probeRadius*this.atomRadiusScale;this.calculateGridCorners(c,s,r,i,n,u);var h=o-1,f=new $r;if((e=f.create(h))<0)return e;var d=new a.Vector3;d.x=(i.x-r.x)/h,d.y=(i.y-r.y)/h,d.z=(i.z-r.z)/h;var p=this.getNumIntersectedCells(s,h,c,f),m=Math.floor(1.2*p),v=Math.floor(1.2*p*2);if(this.geoOut=new pi(m,v,this.useVertexColors),(e=this.createVertexHash(m,v))<0)return e;var g=u;if(this.excludeProbe&&(g=.01),this.voxelWorld=new di(n.length,n,r,i,g),this.voxelWorld.createVoxels(),e=this.buildGeoFromCorners(o,r,i,c,d,f),this.excludeProbe){if(this.modifyExcludedFromGeo(s,u,r,i,this.geoOut,c),this.geoOut._vertices=null,this.geoOut._colors=null,this.geoOut._indices=null,this.geoOut._normals=null,this.geoOut._numVertices=0,this.geoOut._numTriangles=0,this.geoOut=null,p=this.getNumIntersectedCells(s,h,c,f),m=Math.floor(1.2*p),v=Math.floor(1.2*p*2),this.geoOut=new pi(m,v,this.useVertexColors),(e=this.createVertexHash(m,v))<0)return e;e=this.buildGeoFromCorners(s,r,i,c,d,f)}this.voxelWorld.buildNormals(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._normals);var y=6.5;return this.excludeProbe&&(y-=1.5),this.useVertexColors&&this.voxelWorld.buildColors(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._colors,y),this.voxelWorld.destroyVoxels(),this.voxelWorld=null,f.destroy(),e}}]),n}(Zr),LabelsGeometry:function(e){T(n,e);var t=gi(n);function n(e,r){var i;g(this,n),(i=t.call(this))._opts=r,i.items=[],i.needsUpdate=!1;var o=-50,s=-50;switch(r.horizontalAlign){case"left":o=0;break;case"right":o=-100}switch(r.verticalAlign){case"top":s=-100;break;case"bottom":s=0}var l=new a.Vector3(r.dx||0,r.dy||0,r.dz||0);return i.userData={translation:"translate(".concat(o,"%, ").concat(s,"%)"),offset:l},i}return _(n,[{key:"setItem",value:function(e,t,n){var r=this._opts,i=this.items[e]||function(e,t){var n=document.createElement("div");if(n.className=t,"string"==typeof e){var r=document.createElement("span");r.style.fontSize="150%";for(var i=e.split("\n"),o=0,s=i.length;o<s;++o){var l=document.createElement("span"),c=document.createTextNode(i[o]);l.appendChild(c),r.appendChild(l),o<s-1&&r.appendChild(document.createElement("br"))}n.appendChild(r)}else n.appendChild(e);return n.worldPos=new a.Vector3,n}(n,"label");i.worldPos.copy(t),i.style.textAlign=r.horizontalAlign,i.style.verticalAlign=r.verticalAlign,this.items[e]=i}},{key:"setColor",value:function(e,t,n){this.items[e].opts={color:t,background:n}}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.needsUpdate=!0,this.dispatchEvent({type:"update"})}},{key:"finalize",value:function(){this.finishUpdate()}},{key:"raycast",value:function(){}},{key:"setOpacity",value:function(){}},{key:"getSubset",value:function(){return[]}}]),n}(O)},_i={precision:"mediump",init:function(e){this.precision=e.capabilities.getMaxPrecision("highp")}},xi=new Uint8Array([24,52,0,254,145,0,122,0,0,7,170,0,34,214,0,173,8,0,86,249,0,160,4,0,226,46,0,224,211,0,3,157,0,174,247,0,12,182,0,220,216,0,1,109,0,253,154,0]),bi=a.RepeatWrapping,wi=a.RepeatWrapping,Si=a.NearestFilter,Mi=a.NearestFilter,Ei=a.UVMapping,Ti=new a.DataTexture(xi,4,4,a.RGBFormat,a.UnsignedByteType,Ei,bi,wi,Mi,Si,1);Ti.needsUpdate=!0;var Ai={noiseWidth:4,noiseHeight:4,noiseTexture:Ti};function Ci(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ri(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ci(Object(n),!0).forEach((function(t){Ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ci(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Li=[new a.Vector2(-.541978,.840393),new a.Vector2(.125533,-.992089),new a.Vector2(.374329,.927296),new a.Vector2(-.105475,.994422)],ki=a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.lights,{diffuse:{value:new a.Color(15658734)},opacity:{value:1},specular:{type:"c",value:new a.Color(1118481)},shininess:{type:"f",value:30},fixedColor:{type:"c",value:new a.Color(16777215)},zOffset:{type:"f",value:0},zClipValue:{type:"f",value:0},clipPlaneValue:{type:"f",value:0},nearPlaneValue:{type:"f",value:-.5},invModelViewMatrix:{type:"4fv",value:new a.Matrix4},world2colorMatrix:{type:"4fv",value:new a.Matrix4},dashedLineSize:{type:"f",value:.1},dashedLinePeriod:{type:"f",value:.2},projMatrixInv:{type:"4fv",value:new a.Matrix4},viewport:{type:"v2",value:new a.Vector2},lineWidth:{type:"f",value:2},fogAlpha:{type:"f",value:1},samplesKernel:{type:"v2v",value:null},noiseTex:{type:"t",value:null},noiseTexelSize:{type:"v2",value:null},srcTexelSize:{type:"v2",value:null}}]),Ii=["shininess","opacity","zOffset","diffuse","specular","fixedColor","zClipCoef","zClipValue","clipPlaneValue","world2colorMatrix","dashedLineSize","dashedLinePeriod","projMatrixInv","viewport","lineWidth","fogAlpha","samplesKernel","noiseTex","noiseTexelSize","srcTexelSize"],Ni={diffuse:new a.Color(16777215),specular:new a.Color(1118481),shininess:30,opacity:1,fixedColor:new a.Color(16777215),zOffset:0,zClipCoef:2,zClipValue:0,clipPlaneValue:0,world2colorMatrix:new a.Matrix4,dashedLineSize:.1,dashedLinePeriod:.3,projMatrixInv:new a.Matrix4,viewport:new a.Vector2(800,600),lineWidth:2,fogAlpha:1,samplesKernel:Li,noiseTex:Ai.noiseTexture,noiseTexelSize:new a.Vector2(1/Ai.noiseWidth,1/Ai.noiseHeight),srcTexelSize:new a.Vector2(1/800,1/600),copy:function(e){this.diffuse.copy(e.diffuse),this.specular.copy(e.specular),this.shininess=e.shininess,this.opacity=e.opacity,this.fixedColor.copy(e.fixedColor),this.zOffset=e.zOffset,this.zClipCoef=e.zClipCoef,this.zClipValue=e.zClipValue,this.clipPlaneValue=e.clipPlaneValue,this.world2colorMatrix.copy(e.world2colorMatrix),this.dashedLineSize=e.dashedLineSize,this.dashedLinePeriod=e.dashedLinePeriod,this.projMatrixInv=e.projMatrixInv,this.viewport=e.viewport,this.lineWidth=e.lineWidth,this.toonShading=e.toonShading,this.fogAlpha=e.fogAlpha,this.samplesKernel=e.samplesKernel,this.noiseTex=e.noiseTex,this.noiseTexelSize=e.noiseTexelSize,this.srcTexelSize=e.srcTexelSize}},Oi=function(e){T(n,e);var t=Pi(n);function n(e){var r;return g(this,n),(r=t.call(this,e)).fog=!0,r.instancedPos=!1,r.instancedMatrix=!1,r.attrColor=!1,r.attrColor2=!1,r.attrAlphaColor=!1,r.overrideColor=!1,r.sphereSprite=!1,r.cylinderSprite=!1,r.zClip=!1,r.clipPlane=!1,r.fakeOpacity=!1,r.prepassTransparancy=!1,r.colorFromPos=!1,r.shadowmap=!1,r.shadowmapType="random",r.colorFromDepth=!1,r.orthoCam=!1,r.dashedLine=!1,r.transparent=!0,r.thickLine=!1,r.fogTransparent=!1,r.normalsToGBuffer=!1,r.toonShading=!1,r.uberOptions=Ni,r.setValues(Ri({uniforms:a.UniformsUtils.clone(ki),vertexShader:r.precisionString()+"float INSTANCED_SPRITE_OVERSCALE = 1.3;\r\n\r\nattribute vec3 normal;\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  varying vec3 viewNormal;\r\n#endif\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  varying vec3 vNormal;\r\n#endif\r\n\r\n#ifdef THICK_LINE\r\n  attribute vec4 position; // W contains vert pos or neg offset\r\n#else\r\n  attribute vec3 position;\r\n#endif\r\n\r\nvarying vec3 vWorldPosition;\r\nvarying vec3 vViewPosition;\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  attribute float alphaColor;\r\n  varying float alphaCol;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  attribute vec3 color;\r\n  varying vec3 vColor;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  attribute vec3 color2;\r\n  varying vec3 vColor2;\r\n  attribute vec2 uv;\r\n  #ifndef CYLINDER_SPRITE\r\n    varying vec2 vUv;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_POS\r\n  attribute vec4 offset;\r\n  #ifdef SPHERE_SPRITE\r\n    varying vec4 instOffset;\r\n  varying vec4 spritePosEye;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  attribute vec4 matVector1;\r\n  attribute vec4 matVector2;\r\n  attribute vec4 matVector3;\r\n  attribute vec4 invmatVector1;\r\n  attribute vec4 invmatVector2;\r\n  attribute vec4 invmatVector3;\r\n\r\n  #ifdef CYLINDER_SPRITE\r\n    varying vec4 matVec1;\r\n    varying vec4 matVec2;\r\n    varying vec4 matVec3;\r\n    varying vec4 invmatVec1;\r\n    varying vec4 invmatVec2;\r\n    varying vec4 invmatVec3;\r\n    varying vec4 spritePosEye;\r\n  #endif\r\n#endif\r\n\r\nuniform mat4 modelViewMatrix; // optional\r\nuniform mat4 projectionMatrix; // optional\r\nuniform mat3 normalMatrix; // optional\r\nuniform mat4 modelMatrix; // optional\r\n\r\n#ifdef DASHED_LINE\r\n  attribute float lineDistance;\r\n  varying float vLineDistance;\r\n#endif\r\n\r\n#ifdef THICK_LINE\r\n  attribute vec3 direction;\r\n  uniform mat4 projMatrixInv;\r\n  uniform vec2 viewport;\r\n  uniform float lineWidth;\r\n\r\n  vec4 transform(vec4 coord){\r\n    return projectionMatrix * modelViewMatrix * coord;\r\n  }\r\n\r\n  vec2 project(vec4 device){\r\n    vec3 device_normal = device.xyz/device.w;\r\n    vec2 clip_pos = (device_normal*0.5+0.5).xy;\r\n    return clip_pos * viewport;\r\n  }\r\n\r\n  vec4 unproject(vec2 screen, float z, float w){\r\n    vec2 clip_pos = screen/viewport;\r\n    vec2 device_normal = clip_pos*2.0-1.0;\r\n    return vec4(device_normal*w, z, w);\r\n  }\r\n#endif\r\n\r\n\r\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\r\nvoid main() {\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  alphaCol = alphaColor;\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  vec3 objectNormal = vec3(\r\n    dot(normal, matVector1.xyz),\r\n    dot(normal, matVector2.xyz),\r\n    dot(normal, matVector3.xyz));\r\n#else\r\n  vec3 objectNormal = vec3( normal );\r\n#endif\r\n\r\nvec3 transformedNormal = normalMatrix * objectNormal;\r\n\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  vNormal = normalize(transformedNormal);\r\n#endif\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  viewNormal = normalize(mat3(modelViewMatrix)*objectNormal);\r\n#endif\r\n\r\n  vec4 localPos = vec4(position.xyz, 1.0);\r\n  vec4 worldPos = modelMatrix * localPos;\r\n  vec4 mvPosition = modelViewMatrix * localPos;\r\n\r\n// make thick line offset\r\n#ifdef THICK_LINE\r\n   // get screen pos\r\n   vec4 dPos = transform(vec4(position.xyz, 1.0));\r\n   vec2 sPos = project(dPos);\r\n   // move pos forward\r\n   vec3 position2 = position.xyz + direction.xyz * 0.5;\r\n   // get screen offset pos\r\n   vec4 dPos2 = transform(vec4(position2.xyz, 1.0));\r\n   vec2 sPos2 = project(dPos2);\r\n   // screen line direction\r\n   vec2 sDir = normalize(sPos2 - sPos);\r\n   // vertex offset (orthogonal to line direction)\r\n   vec2 offset1 = vec2(-sDir.y, sDir.x);\r\n   // move screen vertex\r\n   vec2 newPos = sPos + offset1 * position.w * lineWidth;\r\n   // get moved pos in view space\r\n   vec4 dNewPos =  unproject(newPos, dPos.z, dPos.w);\r\n   mvPosition.xyz = (projMatrixInv * dNewPos).xyz;\r\n#endif // THICK_LINE\r\n\r\n#ifdef INSTANCED_POS\r\n  #ifdef SPHERE_SPRITE\r\n    instOffset = offset;\r\n\r\n    vec4 posEye = modelViewMatrix * vec4( offset.xyz, 1.0 );\r\n    float scale = length(modelViewMatrix[0]);\r\n    mvPosition = posEye + vec4( position.xyz * offset.w * scale * INSTANCED_SPRITE_OVERSCALE, 0.0 );\r\n    posEye.w = offset.w * scale;\r\n\r\n    spritePosEye = posEye;\r\n #else\r\n    localPos = vec4( offset.xyz + position.xyz * offset.w, 1.0 );\r\n    worldPos = modelMatrix * localPos;\r\n    mvPosition = modelViewMatrix * localPos;\r\n  #endif\r\n#endif\r\n\r\n#ifdef INSTANCED_MATRIX\r\n  #ifdef CYLINDER_SPRITE\r\n    matVec1 = matVector1;\r\n    matVec2 = matVector2;\r\n    matVec3 = matVector3;\r\n    invmatVec1 = invmatVector1;\r\n    invmatVec2 = invmatVector2;\r\n    invmatVec3 = invmatVector3;\r\n\r\n    // calculate eye coords of cylinder endpoints\r\n    vec4 v = vec4(0, -0.5, 0, 1);\r\n    vec4 p1 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r\n    v.y = 0.5;\r\n    vec4 p2 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r\n\r\n    // sprite is placed at the center of cylinder\r\n    vec4 posEye;\r\n    posEye.xyz = mix(p1.xyz, p2.xyz, 0.5);\r\n    posEye.w = 1.0;\r\n    spritePosEye = posEye;\r\n\r\n    // cylinder radius in eye space\r\n    float rad = length(modelViewMatrix[0]) * length(vec3(matVector1.x, matVector2.x, matVector3.x));\r\n    vec2 spriteSize;\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // In ortho projection we skip z coordinate\r\n      // basic sprite size at screen plane (covers only cylinder axis)\r\n      vec2 spriteSizeScreen = abs(p2.xy - p1.xy);\r\n\r\n      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * (spriteSizeScreen + 2.0 * rad);\r\n    #else\r\n      // basic sprite size at screen plane (covers only cylinder axis)\r\n      vec2 spriteSizeScreen = abs(p2.xy / p2.z - p1.xy / p1.z);\r\n\r\n      // full sprite size in eye coords\r\n      float minZ = min(abs(p1.z), abs(p2.z));\r\n      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * abs(posEye.z) * (spriteSizeScreen + 2.0 * rad / minZ);\r\n    #endif\r\n\r\n    mvPosition = posEye + vec4( position.xy * 0.5 * spriteSize, 0, 0 );\r\n  #else\r\n    localPos = vec4(dot(localPos, matVector1), dot(localPos, matVector2), dot(localPos, matVector3), 1.0);\r\n    worldPos = modelMatrix * localPos;\r\n    mvPosition = modelViewMatrix * localPos;\r\n  #endif\r\n#endif\r\n\r\n  gl_Position = projectionMatrix * mvPosition;\r\n\r\n  vWorldPosition = worldPos.xyz;\r\n  vViewPosition = - mvPosition.xyz;\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t  vec4 worldPosition;\r\n\t  // see THREE.WebGLProgram.unrollLoops\r\n\t  #pragma unroll_loop_start\r\n\t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n      vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * vec4(vWorldPosition, 1.0);\r\n      vDirectionalShadowNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(objectNormal, 0.0))).xyz;\r\n\t  }\r\n\t  #pragma unroll_loop_end\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  vColor = color.xyz;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  vColor2 = color2;\r\n  #ifndef CYLINDER_SPRITE\r\n    vUv = uv;\r\n  #endif\r\n#endif\r\n\r\n#ifdef DASHED_LINE\r\n  vLineDistance = lineDistance;\r\n#endif\r\n}\r\n",fragmentShader:r.precisionString()+"#if defined (NORMALS_TO_G_BUFFER)\r\n  #define fragColor gl_FragData[0]\r\n#else\r\n  #define fragColor gl_FragColor\r\n#endif\r\n\r\n#ifdef ATTR_ALPHA_COLOR\r\n  varying float alphaCol;\r\n#endif\r\n\r\n#ifdef COLOR_FROM_POS\r\n  uniform mat4 world2colorMatrix;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\r\n    uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ]; //only for sprites\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r\n    vec4 vDirLightWorldCoord[ NUM_DIR_LIGHTS ];\r\n    vec3 vDirLightWorldNormal[ NUM_DIR_LIGHTS ];\r\n\r\n    #ifdef SHADOWMAP_PCF_RAND\r\n      // We use 4 instead uniform variable or define because this value is used in for(... i < value; ...) with\r\n      // unroll_loop and unroll_loop has pattern:\r\n      // /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g\r\n      uniform vec2 samplesKernel[4]; // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n      uniform sampler2D noiseTex;\r\n      uniform vec2 noiseTexelSize;\r\n      uniform vec2 srcTexelSize;\r\n      uniform mat4 projectionMatrix;\r\n    #endif\r\n\t#endif\r\n#endif\r\n\r\n#ifdef ATTR_COLOR\r\n  varying vec3 vColor;\r\n#endif\r\n\r\n#ifdef ATTR_COLOR2\r\n  varying vec3 vColor2;\r\n  #ifndef CYLINDER_SPRITE\r\n    varying vec2 vUv;\r\n  #endif\r\n#endif\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform vec3 fixedColor;\r\nuniform float opacity;\r\nuniform float zClipValue;\r\nuniform float clipPlaneValue;\r\n\r\n#ifdef NORMALS_TO_G_BUFFER\r\n  varying vec3 viewNormal;\r\n#endif\r\n\r\n#define PI 3.14159265359\r\n#define RECIPROCAL_PI 0.31830988618\r\n#define saturate(a) clamp( a, 0.0, 1.0 )\r\n\r\n#ifdef USE_FOG\r\n  uniform vec3 fogColor;\r\n  uniform float fogAlpha;\r\n  uniform float fogNear;\r\n  uniform float fogFar;\r\n#endif\r\n\r\nvarying vec3 vWorldPosition; // world position of the pixel (invalid when INSTANCED_SPRITE is defined)\r\nvarying vec3 vViewPosition;\r\n\r\n#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n  varying vec3 vNormal;\r\n#endif\r\n\r\n/////////////////////////////////////////// ZSprites ////////////////////////////////////////////////\r\n#if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r\n  uniform float nearPlaneValue;\r\n#endif\r\n\r\n#ifdef SPHERE_SPRITE\r\n  varying vec4 spritePosEye;\r\n#endif\r\n\r\n#if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n  uniform float zOffset;\r\n\r\n  #if !defined(USE_LIGHTS) || !defined(SHADOWMAP) || !defined(SHADOWMAP_PCF_RAND) || !(NUM_DIR_LIGHTS > 0)\r\n    uniform mat4 projectionMatrix;\r\n  #endif\r\n\r\n  float calcDepthForSprites(vec4 pixelPosEye, float zOffset, mat4 projMatrix) {\r\n    vec4 pixelPosScreen = projMatrix * pixelPosEye;\r\n    return 0.5 * (pixelPosScreen.z / pixelPosScreen.w + 1.0) + zOffset;\r\n  }\r\n#endif\r\n\r\n#ifdef SPHERE_SPRITE\r\n  varying vec4 instOffset;\r\n  uniform mat4 modelMatrix;\r\n  uniform mat4 modelViewMatrix;\r\n  uniform mat4 invModelViewMatrix;\r\n  uniform mat3 normalMatrix;\r\n\r\n\r\n  bool intersect_ray_sphere(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r\n\r\n    // intersect XZ-projected ray with circle\r\n    float a = dot(ray, ray);\r\n    float b = dot(ray, origin);\r\n    float c = dot(origin, origin) - 1.0;\r\n    float det = b * b - a * c;\r\n    if (det < 0.0) return false;\r\n    float t1 = (-b - sqrt(det)) / a;\r\n    float t2 = (-b + sqrt(det)) / a;\r\n\r\n    // calculate both intersection points\r\n    vec3 p1 = origin + ray * t1;\r\n    vec3 p2 = origin + ray * t2;\r\n\r\n    // choose nearest point inside frustum\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // orthografic camera is used for dirLight sources. So in it for all spheres the point with smaller 't' is visible\r\n      // t1 is always smaller than t2 (from calculations)\r\n      point = p1;\r\n      frontFaced = 1.0;\r\n      return true;\r\n    #else\r\n      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r\n      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r\n      if (t1 >= 0.0) {\r\n        point = p1;\r\n        frontFaced = 1.0;\r\n        return true;\r\n      }\r\n      if (t2 >= 0.0) {\r\n        point = p2;\r\n        frontFaced = -1.0;\r\n        return true;\r\n      }\r\n    #endif\r\n\r\n    return false;\r\n  }\r\n\r\n  bool get_sphere_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r\n    vec3 origin, ray;\r\n\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // transform vector from sprite center to curPixel into sphere local coords\r\n      origin = pixelPosEye.xyz - spritePosEye.xyz;\r\n      origin = (invModelViewMatrix * vec4(origin, 0.0)).xyz / instOffset.w;\r\n\r\n      // transform camera orientation vector into sphere local coords\r\n      ray = (invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\r\n    #else\r\n      // find point of intersection near plane by the ray from camera to curPixel\r\n      vec4 v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r\n\r\n      // transform intersection point into sphere local coords\r\n      v = invModelViewMatrix * v;\r\n      origin = (v.xyz - instOffset.xyz) / instOffset.w;\r\n\r\n      // transform vector from camera pos to curPixel into sphere local coords\r\n      ray = (invModelViewMatrix * vec4(pixelPosEye, 0.0)).xyz;\r\n    #endif\r\n    ray = normalize(ray);\r\n\r\n    return intersect_ray_sphere(origin, ray, point, frontFaced);\r\n  }\r\n#endif\r\n\r\n#ifdef CYLINDER_SPRITE\r\n  varying vec4 matVec1;\r\n  varying vec4 matVec2;\r\n  varying vec4 matVec3;\r\n  varying vec4 invmatVec1;\r\n  varying vec4 invmatVec2;\r\n  varying vec4 invmatVec3;\r\n\r\n  uniform mat4 modelMatrix;\r\n  uniform mat4 modelViewMatrix;\r\n  uniform mat4 invModelViewMatrix;\r\n  uniform mat3 normalMatrix;\r\n\r\n  varying vec4 spritePosEye;\r\n\r\n  bool intersect_ray_cylinder(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r\n\r\n    // intersect XZ-projected ray with circle\r\n    float a = dot(ray.xz, ray.xz);\r\n    float b = dot(ray.xz, origin.xz);\r\n    float c = dot(origin.xz, origin.xz) - 1.0;\r\n    float det = b * b - a * c;\r\n    if (det < 0.0) return false;\r\n    float t1 = (-b - sqrt(det)) / a;\r\n    float t2 = (-b + sqrt(det)) / a;\r\n\r\n    // calculate both intersection points\r\n    vec3 p1 = origin + ray * t1;\r\n    vec3 p2 = origin + ray * t2;\r\n\r\n    float halfHeight = 0.5;\r\n\r\n    // choose nearest point\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // orthografic camera is used for dirLight sources. So in it for all cylinders the point with smaller 't' is visible\r\n      // if it is not outside of cylinnder (t1 is always smaller than t2).\r\n      if (p1.y >= -halfHeight && p1.y <= halfHeight) {\r\n        point = p1;\r\n        frontFaced = 1.0;\r\n        return true;\r\n      }\r\n      if (p2.y >= -halfHeight && p2.y <= halfHeight) {\r\n        point = p2;\r\n        frontFaced = -1.0;\r\n        return true;\r\n      }\r\n    #else\r\n      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r\n      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r\n      if (t1 >= 0.0 && p1.y >= -halfHeight && p1.y <= halfHeight) {\r\n        point = p1;\r\n        frontFaced = 1.0;\r\n        return true;\r\n      }\r\n      if (t2 >= 0.0 && p2.y >= -halfHeight && p2.y <= halfHeight) {\r\n        point = p2;\r\n        frontFaced = -1.0;\r\n        return true;\r\n      }\r\n    #endif\r\n\r\n    return false;\r\n  }\r\n\r\n  bool get_cylinder_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r\n    vec3 origin, ray;\r\n    vec4 v;\r\n\r\n    #ifdef ORTHOGRAPHIC_CAMERA\r\n      // transform vector from sprite center to curPixel into cylinder local coords\r\n      v = invModelViewMatrix * vec4(pixelPosEye.xyz - spritePosEye.xyz, 0.0);\r\n      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n\r\n      // transform camera orientation vector into cylinder local coords\r\n      v = invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0);\r\n      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n    #else\r\n      // find point of intersection near plane by the ray from camera to curPixel\r\n      v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r\n\r\n      // transform intersection point into cylinder local coords\r\n      v = invModelViewMatrix * v;\r\n      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n\r\n      // transform vector from camera pos to curPixel into cylinder local coords\r\n      v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\r\n      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r\n    #endif\r\n    ray = normalize(ray);\r\n\r\n    return intersect_ray_cylinder(origin, ray, point, frontFaced);\r\n  }\r\n#endif\r\n\r\n///////////////////////////////////// Pack and unpack ///////////////////////////////////////////////\r\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r\n\r\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r\n\r\n\r\nconst float ShiftRight8 = 1. / 256.;\r\n\r\nvec4 packDepthToRGBA( const in float v ) {\r\n  vec4 r = vec4( fract( v * PackFactors ), v );\r\n  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\r\n  return r * PackUpscale;\r\n}\r\n\r\nfloat unpackRGBAToDepth( const in vec4 v ) {\r\n  return dot( v, UnpackFactors );\r\n}\r\n\r\n////////////////////////////////////////// All Lighting /////////////////////////////////////////////////\r\n#ifdef TOON_SHADING\r\n  #define LOW_TOON_BORDER 0.0\r\n  #define MEDIUM_TOON_BORDER 0.7\r\n  #define HIGH_TOON_BORDER 1.0\r\n\r\n  #define MEDIUM_TOON_RANGE 0.5\r\n  #define HIGH_TOON_RANGE 0.95\r\n#endif\r\n#if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r\n  struct ReflectedLight {\r\n    vec3 directDiffuse;\r\n    vec3 directSpecular;\r\n    vec3 indirectDiffuse;\r\n  };\r\n\r\n  struct BlinnPhongMaterial {\r\n    vec3  diffuseColor;\r\n    vec3  specularColor;\r\n    float specularShininess;\r\n  };\r\n\r\n  struct GeometricContext {\r\n    vec3 normal;\r\n    vec3 viewDir;\r\n  };\r\n\r\n  struct DirectionalLight {\r\n    vec3 direction;\r\n    vec3 color;\r\n  };\r\n  uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r\n\r\n  struct DirectionalLightShadow {\r\n     vec2 shadowMapSize;\r\n     float shadowBias;\r\n     float shadowRadius;\r\n   };\r\n  uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHTS ];\r\n\r\n  uniform vec3 ambientLightColor;\r\n\r\n  /////////////////////////////////////////// Shadowmap ////////////////////////////////////////////////\r\n\r\n  #if defined(SHADOWMAP)\r\n  \tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r\n  \t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r\n  \t}\r\n\r\n    float getShadow( sampler2D shadowMap, DirectionalLightShadow dirLight, vec4 shadowCoord, vec3 vViewPosition, vec3 vNormal ) {\r\n   \t  float shadow = 0.0;\r\n\r\n      // When shadows for sprites will appear use here for them normals as it done for G-buffer\r\n      shadowCoord.xyz += dirLight.shadowBias * vNormal;\r\n      shadowCoord.xyz /= shadowCoord.w;\r\n\r\n      bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n      bool inFrustum = all( inFrustumVec );\r\n      bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n      bool frustumTest = all( frustumTestVec );\r\n\r\n      if ( frustumTest ) {\r\n        #ifdef SHADOWMAP_BASIC\r\n      \t  shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n      \t#endif\r\n\r\n      \t#ifdef SHADOWMAP_PCF_SHARP\r\n      \t  vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r\n\r\n            float dx0 = - texelSize.x * dirLight.shadowRadius;\r\n            float dy0 = - texelSize.y * dirLight.shadowRadius;\r\n            float dx1 = + texelSize.x * dirLight.shadowRadius;\r\n            float dy1 = + texelSize.y * dirLight.shadowRadius;\r\n\r\n            shadow = (\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n            \ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n            ) * ( 1.0 / 9.0 );\r\n        #endif\r\n\r\n        #ifdef SHADOWMAP_PCF_RAND\r\n          vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r\n\r\n          vec4 vUv = ((projectionMatrix * vec4(vViewPosition, 1.0)) + 1.0) / 2.0;\r\n          vec2 vUvNoise = vUv.xy / srcTexelSize * noiseTexelSize;\r\n\r\n          vec2 noiseVec = normalize(texture2D(noiseTex, vUvNoise).rg);\r\n          mat2 mNoise = mat2(noiseVec.x, noiseVec.y, -noiseVec.y, noiseVec.x);\r\n\r\n          vec2 offset;\r\n          #pragma unroll_loop_start\r\n          for ( int i = 0; i < 4; i ++ ) { // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n            offset = mNoise * ( normalize( samplesKernel[ i ]) * texelSize * dirLight.shadowRadius );\r\n            shadow +=  texture2DCompare( shadowMap, shadowCoord.xy + offset, shadowCoord.z );\r\n          }\r\n          #pragma unroll_loop_end\r\n          shadow /= float( 4 ); // 4 is length of _samplesKernel which is defined in UberMaterial.js\r\n        #endif\r\n      }\r\n      return shadow;//(shadow != 1.0) ? 0.5 : 1.0;//vec4(shadow, shadow, shadow, 1.0);\r\n   }\r\n  #endif\r\n\r\n  /////////////////////////////////////////// Lighting /////////////////////////////////////////////////\r\n\r\n  vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r\n    return RECIPROCAL_PI * diffuseColor;\r\n  } // validated\r\n\r\n  vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\r\n    // Original approximation by Christophe Schlick '94\r\n    //;float fresnel = pow( 1.0 - dotLH, 5.0 );\r\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\r\n    float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\r\n    return ( 1.0 - specularColor ) * fresnel + specularColor;\r\n  } // validated\r\n\r\n  float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\r\n    // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r\n    return 0.25;\r\n  }\r\n\r\n  float D_BlinnPhong( const in float shininess, const in float dotNH ) {\r\n    return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r\n  }\r\n\r\n  vec3 BRDF_Specular_BlinnPhong( const in DirectionalLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r\n    vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r\n    float dotNH = saturate(dot( geometry.normal, halfDir ));\r\n    float dotLH = saturate(dot( incidentLight.direction, halfDir ));\r\n\r\n    vec3 F = F_Schlick( specularColor, dotLH );\r\n    float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\r\n    float D = D_BlinnPhong( shininess, dotNH );\r\n\r\n    return F * ( G * D );\r\n  } // validated\r\n\r\n  void RE_Direct_BlinnPhong( const in DirectionalLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight, float penumbra ) {\r\n\r\n    float dotNL = saturate( dot( geometry.normal, directLight.direction ));\r\n    #ifdef TOON_SHADING\r\n      if(dotNL < MEDIUM_TOON_RANGE){\r\n        dotNL = LOW_TOON_BORDER;\r\n      }\r\n      else if(dotNL < HIGH_TOON_RANGE){\r\n        dotNL = MEDIUM_TOON_BORDER;\r\n      }\r\n      else{\r\n        dotNL = HIGH_TOON_BORDER;\r\n      }\r\n    #endif\r\n\r\n    vec3 irradiance = dotNL * directLight.color * PI;\r\n    reflectedLight.directDiffuse += penumbra * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n    reflectedLight.directSpecular += penumbra * irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess );\r\n  }\r\n\r\n  void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n  }\r\n\r\n  vec3 calcLighting(const in GeometricContext geometry, const in BlinnPhongMaterial material, vec3 vViewPosition) {\r\n    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\r\n    vec3 irradiance = ambientLightColor * PI;\r\n\r\n    float shadowMask = 1.0;\r\n    // see THREE.WebGLProgram.unrollLoops\r\n  \t#pragma unroll_loop_start\r\n  \t  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n  \t    #ifdef SHADOWMAP\r\n  \t      shadowMask = getShadow( directionalShadowMap[ i ], directionalLightShadows[ i ], vDirLightWorldCoord[ i ], vViewPosition, vDirLightWorldNormal[ i ] );\r\n        #endif\r\n\r\n  \t\t  if ( shadowMask > 0.0 ) RE_Direct_BlinnPhong( directionalLights[ i ], geometry, material, reflectedLight, shadowMask );\r\n  \t\t}\r\n  \t\t#pragma unroll_loop_end\r\n\r\n    RE_IndirectDiffuse_BlinnPhong(irradiance, material, reflectedLight);\r\n\r\n    return saturate(reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular);\r\n  }\r\n#endif\r\n\r\n/////////////////////////////////////////// Dashed Line ///////////////////////////////////////////////\r\n#ifdef DASHED_LINE\r\n  uniform float dashedLineSize;\r\n  uniform float dashedLinePeriod;\r\n  varying float vLineDistance;\r\n#endif\r\n\r\n/////////////////////////////////////////// Main ///////////////////////////////////////////////\r\nvoid main() {\r\n\r\n#ifdef CLIP_PLANE\r\n  if (vViewPosition.z < clipPlaneValue) discard;\r\n#endif\r\n\r\n#ifdef ZCLIP\r\n  if (vViewPosition.z < zClipValue) discard;\r\n#endif\r\n\r\n#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n  #if NUM_DIR_LIGHTS > 0\r\n    // see THREE.WebGLProgram.unrollLoops\r\n    #pragma unroll_loop_start\r\n    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n      vDirLightWorldCoord[ i ] = vDirectionalShadowCoord[ i ];\r\n      vDirLightWorldNormal[ i ] = vDirectionalShadowNormal[ i ];\r\n    }\r\n    #pragma unroll_loop_end\r\n  #endif\r\n#endif\r\n\r\n  vec4 pixelPosWorld = vec4(vWorldPosition, 1.0);\r\n  vec4 pixelPosEye;\r\n\r\n#ifdef SPHERE_SPRITE\r\n\r\n  vec3 viewNormalSprites;\r\n  float frontFaced = 1.0;\r\n  vec3 normal;\r\n\r\n/* quick-and-dirty method\r\n  normal.xy = ' + INSTANCED_SPRITE_OVERSCALE + ' * (2.0 * vUv - 1.0);\r\n  float r2 = dot(normal.xy, normal.xy);\r\n  if (r2 > 1.0) discard;\r\n  float normalZ = sqrt(1.0 - r2);\r\n  normal.z = normalZ;\r\n  normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\r\n  pixelPosEye = vec4(spritePosEye.xyz, 1.0);\r\n  pixelPosEye.z += spritePosEye.w * normalZ;\r\n*/\r\n\r\n  // ray-trace sphere surface\r\n  {\r\n    vec3 p;\r\n    if (!get_sphere_point(-vViewPosition, p, frontFaced)) discard;\r\n    vec4 v = vec4(instOffset.xyz + p * instOffset.w, 1.0);\r\n    pixelPosWorld = modelMatrix * v;\r\n    pixelPosEye = modelViewMatrix * v;\r\n    normal = normalize(normalMatrix * p);\r\n    #ifdef NORMALS_TO_G_BUFFER\r\n      viewNormalSprites = normalize(mat3(modelViewMatrix)*p);\r\n    #endif\r\n\r\n    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n      #if NUM_DIR_LIGHTS > 0\r\n        // see THREE.WebGLProgram.unrollLoops\r\n        #pragma unroll_loop_start\r\n          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r\n            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(p, 0.0))).xyz;\r\n          }\r\n        #pragma unroll_loop_end\r\n      #endif\r\n    #endif\r\n  }\r\n#endif\r\n\r\n#ifdef CYLINDER_SPRITE\r\n  vec3 normal;\r\n  vec3 viewNormalSprites;\r\n  float frontFaced = 1.0;\r\n  float cylinderY = 0.0;\r\n\r\n  // ray-trace cylinder surface\r\n  {\r\n    vec3 p;\r\n    if (!get_cylinder_point(-vViewPosition, p, frontFaced)) discard;\r\n\r\n    cylinderY = 0.5 * (p.y + 1.0);\r\n\r\n    vec4 v = vec4(p, 1.0);\r\n    v = vec4(dot(v, matVec1), dot(v, matVec2), dot(v, matVec3), 1.0);\r\n    pixelPosWorld = modelMatrix * v;\r\n    pixelPosEye = modelViewMatrix * v;\r\n\r\n    vec3 localNormal = normalize(vec3(p.x, 0.0, p.z));\r\n    normal = vec3(\r\n      dot(localNormal, matVec1.xyz),\r\n      dot(localNormal, matVec2.xyz),\r\n      dot(localNormal, matVec3.xyz));\r\n    #ifdef NORMALS_TO_G_BUFFER\r\n      viewNormalSprites = normalize(mat3(modelViewMatrix)*normal);\r\n    #endif\r\n\r\n    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r\n      #if NUM_DIR_LIGHTS > 0\r\n        // see THREE.WebGLProgram.unrollLoops\r\n        #pragma unroll_loop_start\r\n          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r\n            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(normal, 0.0))).xyz;\r\n          }\r\n        #pragma unroll_loop_end\r\n      #endif\r\n    #endif\r\n\r\n    normal = normalize(normalMatrix * normal);\r\n  }\r\n#endif\r\n\r\n  #ifdef ATTR_COLOR\r\n    vec3 vertexColor = vColor;\r\n  #else\r\n    vec3 vertexColor = vec3(1.0, 1.0, 1.0);\r\n  #endif\r\n\r\n  #ifdef ATTR_COLOR2\r\n    #ifdef CYLINDER_SPRITE\r\n      float colorCoef = cylinderY; // cylinder parameter is calculated from ray-tracing\r\n    #else\r\n      float colorCoef = vUv.y; // cylinder parameter is interpolated as tex coord\r\n    #endif\r\n      // choose either color or color2\r\n    vertexColor = mix(vColor2, vColor, step(0.5, colorCoef));\r\n  #endif\r\n\r\n  // negative red component is a special condition\r\n  if (vertexColor.x < 0.0) discard;\r\n\r\n  #ifdef DASHED_LINE\r\n    if ( mod( vLineDistance, dashedLinePeriod ) > dashedLineSize ) discard;\r\n  #endif\r\n\r\n  // transparency prepass writes only z, so we don't need to calc the color\r\n  #ifdef PREPASS_TRANSP\r\n    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n    #endif\r\n    return;\r\n  #endif\r\n\r\n    float totalOpacity = opacity;\r\n\r\n  #ifdef ATTR_ALPHA_COLOR\r\n    totalOpacity *= alphaCol;\r\n  #endif\r\n\r\n  // discard fully transparent pixels\r\n  if (totalOpacity == 0.0) discard;\r\n\r\n  #ifdef FAKE_OPACITY\r\n    // discard pixels in checker pattern\r\n    vec2 dm_coord = floor(gl_FragCoord.xy);\r\n    dm_coord = fract(dm_coord * 0.5);\r\n    if (totalOpacity < 1.0 && (dm_coord.x < 0.5 ^^ dm_coord.y < 0.5)) discard;\r\n    vec4 diffuseColor = vec4(diffuse, 1.0);\r\n  #else\r\n    vec4 diffuseColor = vec4(diffuse, totalOpacity);\r\n  #endif\r\n\r\n  float flipNormal;\r\n  #if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r\n    flipNormal = 1.0;\r\n    #ifdef DOUBLE_SIDED\r\n      flipNormal = float( gl_FrontFacing );\r\n    #endif\r\n    vec3 normal = normalize( vNormal ) * flipNormal;\r\n  #endif\r\n\r\n    diffuseColor.rgb *= vertexColor;\r\n\r\n  #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n    gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n  #endif\r\n\r\n  #ifdef NORMALS_TO_G_BUFFER\r\n    #if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r\n      vec3 viewNormaInColor = viewNormalSprites;\r\n    #else\r\n      vec3 viewNormaInColor = viewNormal;\r\n      float frontFaced = float( gl_FrontFacing );\r\n    #endif\r\n    // [-1, 1] -> [0, 1]\r\n    viewNormaInColor = 0.5 * viewNormaInColor + 0.5;\r\n    gl_FragData[1] = vec4(viewNormaInColor, frontFaced);\r\n  #endif\r\n\r\n  #if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r\n    vec3 viewDir;\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      viewDir = -pixelPosEye.xyz;\r\n    #else\r\n      viewDir = vViewPosition;\r\n    #endif\r\n    GeometricContext geometry = GeometricContext(normal, normalize( viewDir ));\r\n    BlinnPhongMaterial material = BlinnPhongMaterial(diffuseColor.rgb, specular, shininess);\r\n    vec3 outgoingLight = calcLighting(geometry, material, viewDir);\r\n  #else\r\n    vec3 outgoingLight = diffuseColor.rgb;\r\n  #endif\r\n\r\n  #ifdef COLOR_FROM_DEPTH\r\n    float depth = 0.0;\r\n    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r\n      depth = gl_FragDepthEXT;\r\n    #else\r\n      depth = gl_FragCoord.z;\r\n    #endif\r\n    fragColor = packDepthToRGBA(depth);\r\n    return;\r\n  #endif\r\n\r\n  #ifdef COLOR_FROM_POS\r\n    fragColor = world2colorMatrix * pixelPosWorld;\r\n  #else\r\n    #ifdef OVERRIDE_COLOR\r\n      fragColor = vec4(fixedColor, diffuseColor.a);\r\n    #else\r\n      fragColor = vec4(outgoingLight, diffuseColor.a);//vec4(vNormal, 1.0);\r\n    #endif\r\n\r\n    #ifdef USE_FOG\r\n      float viewDistance;\r\n      #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r\n        viewDistance = abs(pixelPosEye.z);\r\n      #else\r\n        viewDistance = vViewPosition.z;\r\n      #endif\r\n      float fogFactor = smoothstep( fogNear, fogFar, viewDistance) * fogAlpha;\r\n      #ifdef FOG_TRANSPARENT\r\n        fragColor.a = fragColor.a * (1.0 - fogFactor);\r\n      #else\r\n        fragColor.rgb = mix( fragColor.rgb, fogColor, fogFactor );\r\n      #endif\r\n    #endif\r\n\r\n  #endif\r\n}\r\n",lights:!0,fog:!0,side:a.DoubleSide},e)),r}return _(n,[{key:"precisionString",value:function(){var e=_i.precision;return"precision ".concat(e," float;\n")+"precision ".concat(e," int;\n\n")}},{key:"copy",value:function(e){return Qe(P(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=a.UniformsUtils.clone(e.uniforms),this.defines=Ri({},e.defines),this.extensions=e.extensions,this.fog=e.fog,this.instancedPos=e.instancedPos,this.instancedMatrix=e.instancedMatrix,this.attrColor=e.attrColor,this.attrColor2=e.attrColor2,this.attrAlphaColor=e.attrAlphaColor,this.overrideColor=e.overrideColor,this.sphereSprite=e.sphereSprite,this.cylinderSprite=e.cylinderSprite,this.zClip=e.zClip,this.clipPlane=e.clipPlane,this.fakeOpacity=e.fakeOpacity,this.colorFromPos=e.colorFromPos,this.shadowmap=e.shadowmap,this.shadowmapType=e.shadowmapType,this.colorFromDepth=e.colorFromDepth,this.orthoCam=e.orthoCam,this.prepassTransparancy=e.prepassTransparancy,this.dashedLine=e.dashedLine,this.thickLine=e.thickLine,this.fogTransparent=e.fogTransparent,this.normalsToGBuffer=e.normalsToGBuffer,this.toonShading=e.toonShading,this.uberOptions.copy(e.uberOptions),this}},{key:"createInstance",value:function(){var e=new n;return e.copy(this),e.uberOptions=Object.create(this.uberOptions),e}},{key:"setValues",value:function(e){if(void 0!==e){Qe(P(n.prototype),"setValues",this).call(this,e);var t={},r={};this.fog&&(t.USE_FOG=1),this.instancedPos&&(t.INSTANCED_POS=1),this.instancedMatrix&&(t.INSTANCED_MATRIX=1),this.attrColor&&(t.ATTR_COLOR=1),this.attrColor2&&(t.ATTR_COLOR2=1),this.attrAlphaColor&&(t.ATTR_ALPHA_COLOR=1),this.overrideColor&&(t.OVERRIDE_COLOR=1),this.sphereSprite&&(t.SPHERE_SPRITE=1,r.fragDepth=1),this.cylinderSprite&&(t.CYLINDER_SPRITE=1,r.fragDepth=1),this.zClip&&(t.ZCLIP=1),this.clipPlane&&(t.CLIP_PLANE=1),this.fakeOpacity&&(t.FAKE_OPACITY=1),this.lights&&(t.USE_LIGHTS=1),this.colorFromPos&&(t.COLOR_FROM_POS=1),this.shadowmap&&(t.SHADOWMAP=1,"pcf"===this.shadowmapType?t.SHADOWMAP_PCF_SHARP=1:"random"===this.shadowmapType?t.SHADOWMAP_PCF_RAND=1:t.SHADOWMAP_BASIC=1),this.colorFromDepth&&(t.COLOR_FROM_DEPTH=1),this.orthoCam&&(t.ORTHOGRAPHIC_CAMERA=1),this.prepassTransparancy&&(t.PREPASS_TRANSP=1),this.dashedLine&&(t.DASHED_LINE=1),this.thickLine&&(t.THICK_LINE=1),this.fogTransparent&&(t.FOG_TRANSPARENT=1),this.normalsToGBuffer&&(r.drawBuffers=1,t.NORMALS_TO_G_BUFFER=1),this.toonShading&&(t.TOON_SHADING=1),this.defines=t,this.extensions=r}}},{key:"setUberOptions",value:function(e){if(void 0!==e)for(var t in e)e.hasOwnProperty(t)&&(this.uberOptions[t]instanceof a.Color?this.uberOptions[t]=e[t].clone():this.uberOptions[t]=e[t])}},{key:"clone",value:function(e){return e?this.createInstance():a.Material.prototype.clone.call(this)}},{key:"updateUniforms",value:function(){var e=this;Ii.forEach((function(t){e.uniforms.hasOwnProperty(t)&&(e.uberOptions[t]instanceof a.Color||e.uberOptions[t]instanceof a.Matrix4?e.uniforms[t].value=e.uberOptions[t].clone():e.uniforms[t].value=e.uberOptions[t])}))}}]),n}(a.RawShaderMaterial);function Di(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function Bi(e){return function(e){T(n,e);var t=Di(n);function n(){var e;g(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).onBeforeRender=n.prototype.onBeforeRender,e}return _(n,[{key:"onBeforeRender",value:function(e,t,n,r,i,o){this._onBeforeRender(e,t,n,r,i,o),this._update()}},{key:"_onBeforeRender",value:function(){}},{key:"_update",value:function(){var e=this.material;e&&e instanceof Oi&&e.updateUniforms()}}]),n}(e)}function zi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Fi=Bi(a.Mesh),Vi=function(e){T(n,e);var t=zi(n);function n(){var e;g(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).castShadow=!0,e.receiveShadow=!0,e}return _(n,[{key:"_onBeforeRender",value:function(e,t,n,r,i,o){Fi.prototype._onBeforeRender.call(this,e,t,n);var a=this.material;a&&a.uniforms.invModelViewMatrix&&(this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld),a.uniforms.invModelViewMatrix.value.copy(this.modelViewMatrix).invert(),a.uniforms.nearPlaneValue.value=n.near,a.uniformsNeedUpdate=!0)}}]),n}(Fi);function Ui(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Gi=Bi(a.Mesh),Hi=function(e){T(n,e);var t=Ui(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r)).castShadow=!0,i.receiveShadow=!0,i}return _(n,[{key:"_onBeforeRender",value:function(e,t,r){Gi.prototype._onBeforeRender.call(this,e,t,r);var i=this.geometry,o=this.material;if(i.zClip&&o.uberOptions){var a=n._modelView,s=n._mvLength,l=n._center;a.multiplyMatrices(this.matrixWorld,r.matrixWorldInverse);var c=s.setFromMatrixColumn(a,0).length();l.copy(i.boundingSphere.center),this.localToWorld(l),o.uberOptions.zClipValue=r.position.z-l.z-c*(.5*i.boundingSphere.radius)}}}]),n}(Gi);function ji(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Hi,"_mvLength",new a.Vector3),Ee(Hi,"_center",new a.Vector3),Ee(Hi,"_modelView",new a.Matrix4);var Wi=function(e){T(n,e);var t=ji(n);function n(e,r){var i;g(this,n),(i=t.call(this)).geometry=e;var o=C(i);return o.initialized=!1,i.geometry.addEventListener("update",(function(){o.update()})),i}return _(n,[{key:"init",value:function(){for(var e=this.children,t=e.length-1;t>=0;--t)this.remove(e[t]);for(var n=this.geometry,r=n.items,i=n.userData,a=0,s=r.length;a<s;++a){var l=r[a];if(l){var c=Q.shallowCloneNode(l),u=new xn(c);u.userData=o.default.clone(i),u.getElement().style.visibility="visible",u.source=l,this.add(u)}}this.initialized=!0}},{key:"update",value:function(){if(this.geometry.needsUpdate){var e=this.children;this.initialized||this.init();for(var t=0,n=e.length;t<n;++t){var r=e[t],i=r.source;r.position.copy(i.worldPos),r.userData.color=i.opts.color,r.userData.background=i.opts.background}}}}]),n}(a.Group);function qi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Xi=function(e){T(n,e);var t=qi(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r)).castShadow=!0,i.receiveShadow=!0,i}return n}(Bi(a.Mesh));function Yi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Zi=Bi(a.Mesh),$i=new a.Vector2,Ji=function(e){T(n,e);var t=Yi(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_onBeforeRender",value:function(e,t,n,r,i,o){var a=this.material;a.uberOptions&&(a.uberOptions.projMatrixInv.copy(n.projectionMatrix).invert(),e.getSize($i),a.uberOptions.viewport.set($i.width,$i.height))}}]),n}(Zi);function Ki(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Qi=function(e){T(n,e);var t=Ki(n);function n(){var e;g(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).castShadow=!0,e.receiveShadow=!0,e}return n}(Bi(a.Mesh)),eo={ZClipped:Hi,ZSprite:Vi,Text:Wi,Line:Bi(a.Line),LineSegments:Bi(a.LineSegments),Mesh:Xi,ThickLineMesh:Ji,Instanced:Qi};function to(e,t){return function(n){n.setValues(e),n.setUberOptions(t)}}function no(e,t){return{Geometry:function(n,r){return new yi.Instanced2CCylindersGeometry(n,r,e,t)},Object:e?eo.ZSprite:eo.Instanced,initMaterial:to({instancedMatrix:!0,attrColor:!0,attrColor2:!0,attrAlphaColor:!0,cylinderSprite:e})}}function ro(e,t){var n=e.prototype instanceof Rr,r=t.lineWidth||0;return{Geometry:e,Object:n?eo.ThickLineMesh:eo.LineSegments,initMaterial:to({lights:!1,attrColor:!0,attrAlphaColor:!0,thickLine:n},{lineWidth:r})}}function io(e,t,n,r){var i={wireframe:!!r.wireframe,fakeOpacity:n.now.isoSurfaceFakeOpacity,zClip:r.zClip};return{Geometry:e,Object:eo.ZClipped,initMaterial:to({attrColor:!0,attrAlphaColor:!1,wireframe:i.wireframe,fakeOpacity:i.fakeOpacity,zClip:i.zClip})}}var oo=function(){function e(){g(this,e)}return _(e,null,[{key:"createSpheres",value:function(e,t){var n=t.now.zSprites;return{Geometry:function(e,t){return new yi.InstancedSpheresGeometry(e,t,n)},Object:n?eo.ZSprite:eo.Instanced,initMaterial:to({instancedPos:!0,attrColor:!0,attrAlphaColor:!0,sphereSprite:n})}}},{key:"create2CClosedCylinders",value:function(e,t){return no(!1,!1)}},{key:"create2CCylinders",value:function(e,t){return no(t.now.zSprites,!0)}},{key:"create2CLines",value:function(e,t,n){return ro(yi.TwoColorLinesGeometry,n)}},{key:"createCrosses",value:function(e,t,n){return ro(yi.CrossGeometry,n)}},{key:"createExtrudedChains",value:function(e,t){return{Geometry:yi.ExtrudedObjectsGeometry,Object:eo.Mesh,initMaterial:to({attrColor:!0,attrAlphaColor:!0})}}},{key:"createChunkedLines",value:function(e,t,n){return ro(yi.ChunkedLinesGeometry,n)}},{key:"createQuickSurface",value:function(e,t,n){return io(yi.QuickSurfGeometry,0,t,n)}},{key:"createContactSurface",value:function(e,t,n){return io(yi.ContactSurfaceGeometry,0,t,n)}},{key:"createSASSES",value:function(e,t,n){return io(yi.SSIsosurfaceGeometry,0,t,n)}},{key:"createLabels",value:function(e,t){return{Geometry:yi.LabelsGeometry,Object:eo.Text,initMaterial:function(){}}}}]),e}();function ao(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var so=function(e){T(n,e);var t=ao(n);function n(e,r,i,o){var s;g(this,n),(s=t.call(this))._geometry=e,s._geoParams=r;var l=i.createInstance();r.initMaterial(l),s._material=l,s._transforms=o.length>0?o:[new a.Matrix4];for(var c=s._createMeshes(e),u=0,h=c.length;u<h;++u)s.add(c[u]);return s}return _(n,[{key:"raycast",value:function(e,t){var r=n._ray,i=n._inverseMatrix,o=this.children;r.copy(e.ray);for(var a=0,s=o.length;a<s;++a){var l=o[a];if(Nn.belongToSelectLayers(l)){l.updateMatrixWorld();var c=l.matrixWorld;i.copy(c).invert(),e.ray.copy(r).applyMatrix4(i);var u=[];this._geometry.raycast(e,u);for(var h=0,f=u.length;h<f;++h){var d=u[h];d.point&&(d.point.applyMatrix4(c),d.distance=r.origin.distanceTo(d.point)),d.object=l,t[t.length]=d}}}e.ray.copy(r)}},{key:"getSubset",value:function(e){for(var t=this._geometry.getSubset(e),n=[],r=0,i=0,o=t.length;i<o;++i)for(var a=this._createMeshes(t[i]),s=0,l=a.length;s<l;++s)n[r++]=a[s];return n}},{key:"_createMeshes",value:function(e){for(var t=this._transforms,n=this._geoParams.Object,r=this._material,i=[],o=0,a=t.length;o<a;++o){var s=new n(e,r);s.applyMatrix4(t[o]),i[o]=s}return i}}]),n}(a.Object3D);function lo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(so,"_inverseMatrix",new a.Matrix4),Ee(so,"_ray",new a.Ray);var co=function(e){T(n,e);var t=lo(n);function n(e,r,i,o,a,s,l){var c,u,h,f;if(g(this,n),(c=t.call(this)).constructor===n)throw new Error("Can not instantiate abstract class!");return c._selection=r,c._mode=o,c._colorer=i,c._chunksIdc=r.chunks,c._polyComplexity=s,c._geo=new(u=e.Geometry,h=c._makeGeoArgs(),f=[u].concat(h),u.bind.apply(u,zn(f))),c._mesh=new so(c._geo,e,l,a),c.add(c._mesh),c._build(),c}return _(n,[{key:"_makeGeoArgs",value:function(){throw new Error("ChemGroup subclass must override _makeGeoArgs() method")}},{key:"getSubset",value:function(e,t){t=void 0!==t&&t;var n=this._calcChunksList(e,t);return 0===n.length?[]:this._mesh.getSubset(n)}},{key:"_changeSubsetOpacity",value:function(e,t,n){var r=this._calcChunksList(e,n);0!==r.length&&this._geo.setOpacity(r,t)}},{key:"enableSubset",value:function(e,t){t=void 0===t||t,this._changeSubsetOpacity(e,1,t)}},{key:"disableSubset",value:function(e,t){t=void 0===t||t,this._changeSubsetOpacity(e,0,t)}}]),n}(wn);function uo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ho=function(e){T(n,e);var t=uo(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"raycast",value:function(e,t){var n=this._selection.atoms,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=i[r[o].chunkIdx];s<n.length&&(r[o].atom=n[s],t.push(r[o]))}}},{key:"_calcChunksList",value:function(e){for(var t=[],n=this._selection.atoms,r=this._chunksIdc,i=0,o=r.length;i<o;++i)0!=(n[r[i]].mask&e)&&t.push(i);return t}}]),n}(co);function fo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var po=function(e){T(n,e);var t=fo(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_build",value:function(){for(var e=this._selection.chunks,t=this._selection,n=t.atoms,r=t.parent,i=this._mode,o=this._colorer,a=this._geo,s=0,l=e.length;s<l;++s){var c=n[e[s]];a.setItem(s,c.position,i.calcAtomRadius(c)),a.setColor(s,o.getAtomColor(c,r))}a.finalize()}},{key:"updateToFrame",value:function(e){for(var t=this._selection.chunks,n=this._selection.atoms,r=this._mode,i=this._colorer,o=e.needsColorUpdate(i),a=this._geo,s=0,l=t.length;s<l;++s){var c=n[t[s]];a.setItem(s,e.getAtomPos(t[s]),r.calcAtomRadius(c)),o&&a.setColor(s,e.getAtomColor(i,c))}a.finalize()}}]),n}(ho);function mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var vo=function(e){T(n,e);var t=mo(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){for(var e=[],t=this._selection,n=t.atoms,r=t.chunks,i=r.length,o=0;o<i;++o)e[o]=n[r[o]];var a=this._mode.getSurfaceOpts();return a.atoms=e,[i,a]}}]),n}(po);function go(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var yo=function(e){T(n,e);var t=go(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){for(var e=[],t=this._selection,n=t.atoms,r=t.chunks,i=r.length,o=0;o<i;++o)e[o]=n[r[o]];var a=this._mode.getSurfaceOpts();return a.atoms=e,a.selection=this._selection,a.colorMode=this._colorer,[i,a]}}]),n}(po);function _o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function xo(e){return null!==e.name.getNode()?e.name.getNode():e.getVisualName()}var bo={none:function(e){return e},adjust:function(e){var t=e>>16&255,n=e>>8&255,r=255&e;return.2126*t+.7152*n+.0722*r>127?(t=3*t/10,n=3*n/10,r=3*r/10):(t=255-3*(255-t)/10,n=255-3*(255-n)/10,r=255-3*(255-r)/10),t<<16|n<<8|r},inverse:function(e){return 255-(e>>16&255)<<16|255-(e>>8&255)<<8|255-(255&e)}};function wo(e,t){var n;if(bo.hasOwnProperty(t))n=Q.hexColor(bo[t](e));else{var r=parseInt(t,16);n=!Number.isNaN(r)&&t.toLowerCase().startsWith("0x")?Q.hexColor(r):"#000000"}return n}var So={serial:function(e){return e.serial},name:function(e){return e.getVisualName()},elem:function(e){return e.element.name},residue:function(e){return e.residue.getType().getName()},sequence:function(e){return e.residue.getSequence()},chain:function(e){return e.residue.getChain().getName()},hetatm:function(e){return e.isHet()},water:function(e){return"HOH"===e.residue.getType().getName()||"WAT"===e.residue.getType().getName()}},Mo=function(e,t){return t.replace(/\{\{(\s*\w+\s*)\}\}/g,(function(t){var n=t.replace(/\s+/g,"");return n=n.substring(2,n.length-2).toLowerCase(),So.hasOwnProperty(n)?So[n](e):"null"}))},Eo=function(e){T(n,e);var t=_o(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){var e=this._mode.getLabelOpts();return[this._selection.chunks.length,e]}},{key:"_build",value:function(){for(var e=this._mode.getLabelOpts(),t=this._selection.chunks,n=this._selection,r=n.atoms,i=n.parent,o=this._colorer,a=this._geo,s=0,l=t.length;s<l;++s){var c=r[t[s]],u=e.template?Mo(c,e.template):xo(c);if(u){var h=o.getAtomColor(c,i),f=parseInt(wo(h,e.fg).substring(1),16),d=e.showBg?parseInt(wo(h,e.bg).substring(1),16):"transparent";a.setItem(s,c.position,u),a.setColor(s,f,d)}}a.finalize()}},{key:"updateToFrame",value:function(e){for(var t=this._mode.getLabelOpts(),n=this._selection.chunks,r=this._selection.atoms,i=this._colorer,o=this._geo,a=e.needsColorUpdate(i),s=0,l=n.length;s<l;++s){var c=r[n[s]],u=t.template?Mo(c,t.template):xo(c);if(u){var h=e.getAtomColor(i,c),f=parseInt(wo(h,t.fg).substring(1),16),d=t.showBg?parseInt(wo(h,t.bg).substring(1),16):"transparent";o.setItem(s,e.getAtomPos(n[s]),u),a&&o.setColor(s,f,d)}}o.finalize()}}]),n}(ho);function To(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function Ao(e,t,n,r){var i=Math.sin(e);return t.clone().multiplyScalar(Math.sin((1-r)*e)/i).addScaledVector(n,Math.sin(r*e)/i)}var Co=function(e){T(n,e);var t=To(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_buildInner",value:function(e,t){for(var n=this._selection.chunks,r=new a.Vector3,i=new a.Vector3,o=this._segmentsHeight,s=1/o,l=this._colorer,c=this._selection,u=c.cycles,h=c.parent,f=0,d=n[f],p=0,m=u.length;p<m;++p){var v=u[p],g=v.atoms,y=[],_=[],x=v.center,b=v.radius-e,w=g.length,S=0,M=g[w-1].position,E=g[S].position;r.subVectors(M,x),i.subVectors(E,x);for(var T=i.clone().cross(r).normalize();S<w;++S){var A=r.angleTo(i);_[S]=Ao(A,r,i,.5).normalize(),E=g[(S+1)%w].position,r.copy(i),i.subVectors(E,x)}for(S=0;S<w;++S)if(g[S].index===d){for(var C=_[S],R=_[(S+1)%w],P=l.getAtomColor(g[S],h),L=C.angleTo(R),k=0;k<=o;++k)y[k]=Ao(L,C,R,k*s).multiplyScalar(b).add(x);t(f++,P,y,x,T),d=n[f]}}}}]),n}(ho);function Ro(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function Po(e,t){for(var n=[],r=0;r<t;++r){var i=-2*r/t*Math.PI;n.push(new a.Vector3(Math.cos(i)*e,Math.sin(i)*e,0))}return n}var Lo=Nn.calcChunkMatrix,ko=function(e){T(n,e);var t=Ro(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_build",value:function(){var e=this._segmentsHeight,t=this._mode.getAromRadius(),n=new a.Vector2(t,t),r=this._mode.calcStickRadius()+2*t,i=new a.Vector3,o=[],s=this._geo;this._buildInner(r,(function(t,r,a,l,c){for(var u=0;u<=e;++u){var h=a[u],f=h.clone().sub(l).cross(c);i.addVectors(h,f),o[u]=Lo(h,i,c,n)}s.setItem(t,o),s.setColor(t,r)})),s.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._polyComplexity,[Po(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length]}}]),n}(Co);function Io(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var No=function(e){T(n,e);var t=Io(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_build",value:function(){var e=this,t=this._geo,n=this._mode.getAromaticOffset();this._buildInner(n,(function(n,r,i){for(var o=i[0],a=1;a<=e._segmentsHeight;++a){var s=i[a];t.setSegment(n,a-1,o,s),o=s}t.setColor(n,r)})),t.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._mode.getAromaticArcChunks(),[this._selection.chunks.length,this._segmentsHeight,!0]}}]),n}(Co);function Oo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Do=function(e){T(n,e);var t=Oo(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"raycast",value:function(e,t){var n=this._selection.residues,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=i[r[o].chunkIdx];s<n.length&&(r[o].residue=n[s],t.push(r[o]))}}},{key:"_calcChunksList",value:function(e){for(var t=[],n=this._selection.residues,r=this._chunksIdc,i=0,o=r.length;i<o;++i)0!=(n[r[i]]._mask&e)&&t.push(i);return t}}]),n}(co);function Bo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var zo=function(e){T(n,e);var t=Bo(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"raycast",value:function(e,t){var n=this._selection.residues,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=i[Math.floor(r[o].chunkIdx/2)];s<n.length&&(r[o].residue=n[s],t.push(r[o]))}}},{key:"_build",value:function(){for(var e=this._selection,t=e.residues,n=e.parent,r=this._colorer,i=this._geo,o=this._mode.calcStickRadius(),a=0,s=this._selection.chunks,l=0,c=s.length;l<c;++l){var u=t[s[l]],h=r.getResidueColor(u,n);this._processItem(a++,u._cylinders[0],u._cylinders[1],o,h)}i.finalize()}},{key:"_calcChunksList",value:function(e){for(var t=[],n=0,r=this._selection.residues,i=this._chunksIdc,o=0,a=i.length;o<a;++o)0!=(r[i[o]]._mask&e)&&(t[n++]=2*o,t[n++]=2*o+1);return t}},{key:"updateToFrame",value:function(e){for(var t=e.getResidues(),n=this._selection.parent,r=this._colorer,i=this._geo,o=this._mode.calcStickRadius(),a=0,s=this._selection.chunks,l=0,c=s.length;l<c;++l){var u=t[s[l]],h=r.getResidueColor(u,n);this._processItem(a++,u._cylinders[0],u._cylinders[1],o,h)}i.finishUpdate()}}]),n}(Do);function Fo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Vo=function(e){T(n,e);var t=Fo(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_processItem",value:function(e,t,n,r,i){var o=this._geo;o.setItem(e,t,n,r),o.setColor(e,i,i)}}]),n}(zo);function Uo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Go=function(e){T(n,e);var t=Uo(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){return[2*this._selection.chunks.length,this._polyComplexity]}},{key:"_processItem",value:function(e,t,n,r,i){var o=this._geo,a=2*e;o.setItem(a,t,r),o.setColor(a,i),a++,o.setItem(a,n,r),o.setColor(a,i)}}]),n}(zo),Ho={};!function(e){(function(){var t,n,r,i,o,a,s,l,c,u,h,f,d,p,m,v,g,y,_,x,b,w,S,M,E,T,A=Object.prototype.hasOwnProperty,C=function(e,t){for(var n in t)A.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};for(v in f={method:(r={METHOD_NEAREST:"nearest",METHOD_LINEAR:"linear",METHOD_CUBIC:"cubic",METHOD_LANCZOS:"lanczos",METHOD_SINC:"sinc",CLIP_CLAMP:"clamp",CLIP_ZERO:"zero",CLIP_PERIODIC:"periodic",CLIP_MIRROR:"mirror",CUBIC_TENSION_DEFAULT:0,CUBIC_TENSION_CATMULL_ROM:0}).METHOD_CUBIC,cubicTension:r.CUBIC_TENSION_DEFAULT,clip:r.CLIP_CLAMP,scaleTo:0,sincFilterSize:2,sincWindow:void 0},c=function(e,t){return Math.max(0,Math.min(e,t-1))},h=function(e,t){return(e%=t)<0&&(e+=t),e},u=function(e,t){var n;return(e=h(e,n=2*(t-1)))>t-1&&(e=n-e),e},t=function(){function e(e,t){if(this.array=e.slice(0),this.length=this.array.length,!(this.clipHelper={clamp:this.clipHelperClamp,zero:this.clipHelperZero,periodic:this.clipHelperPeriodic,mirror:this.clipHelperMirror}[t.clip]))throw"Invalid clip: "+t.clip}return e.prototype.getClippedInput=function(e){return 0<=e&&e<this.length?this.array[e]:this.clipHelper(e)},e.prototype.clipHelperClamp=function(e){return this.array[c(e,this.length)]},e.prototype.clipHelperZero=function(e){return 0},e.prototype.clipHelperPeriodic=function(e){return this.array[h(e,this.length)]},e.prototype.clipHelperMirror=function(e){return this.array[u(e,this.length)]},e.prototype.interpolate=function(e){throw"Subclasses of AbstractInterpolator must override the interpolate() method."},e}(),o=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return C(t,e),t.prototype.interpolate=function(e){return this.getClippedInput(Math.round(e))},t}(t),i=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return C(t,e),t.prototype.interpolate=function(e){var t;return(1-(e-=t=Math.floor(e)))*this.getClippedInput(t)+e*this.getClippedInput(t+1)},t}(t),n=function(e){function t(e,n){this.tangentFactor=1-Math.max(-1,Math.min(1,n.cubicTension)),t.__super__.constructor.apply(this,arguments)}return C(t,e),t.prototype.getTangent=function(e){return this.tangentFactor*(this.getClippedInput(e+1)-this.getClippedInput(e-1))/2},t.prototype.interpolate=function(e){var t,n,r,i,o;return t=Math.floor(e),n=[this.getTangent(t),this.getTangent(t+1)],(2*(o=(e-=t)*(i=e*e))-3*i+1)*(r=[this.getClippedInput(t),this.getClippedInput(t+1)])[0]+(o-2*i+e)*n[0]+(-2*o+3*i)*r[1]+(o-i)*n[1]},t}(t),w=Math.sin,a=Math.PI,S=function(e){return 0===e?1:w(a*e)/(a*e)},g=function(e){return function(t){return S(t/e)}},_=function(e){return function(t){return S(t)*e(t)}},s=function(e){function t(e,n){if(t.__super__.constructor.apply(this,arguments),this.a=n.sincFilterSize,!n.sincWindow)throw"No sincWindow provided";this.kernel=_(n.sincWindow)}return C(t,e),t.prototype.interpolate=function(e){var t,n,r,i,o;for(r=0,n=i=(t=Math.floor(e))-this.a+1,o=t+this.a;i<=o?n<=o:n>=o;i<=o?n++:n--)r+=this.kernel(e-n)*this.getClippedInput(n);return r},t}(t),d=function(e,t){var n,r,i,o;for(o=[],r=0,i=e.length;r<i;r++)n=e[r],o.push(n[t]);return o},y=function(e,t,n){var r,i;return"0,1"===n.join?e:(r=t/(n[1]-n[0]),i=n[0],function(t){return e(r*(t-i))})},p=function(e){return Object.prototype.toString.call(e).slice("[object ".length,-1)},E=function(e){if(isNaN(e))throw"NaN in Smooth() input";if("Number"!==p(e))throw"Non-number in Smooth() input";if(!isFinite(e))throw"Infinity in Smooth() input"},T=function(e,t){var n,r,i;if("Array"!==p(e))throw"Non-vector in Smooth() input";if(e.length!==t)throw"Inconsistent dimension in Smooth() input";for(r=0,i=e.length;r<i;r++)n=e[r],E(n)},m=function(e){return"Number"===p(e)&&isFinite(e)&&!isNaN(e)},x=function(e){var t;switch(t="scaleTo param must be number or array of two numbers",p(e)){case"Number":if(!m(e))throw t;e=[0,e];break;case"Array":if(2!==e.length)throw t;if(!m(e[0])||!m(e[1]))throw t;break;default:throw t}return e},b=function(e){var t,n,r;for(n in t={},e)A.call(e,n)&&(r=e[n],t[n]=r);return t},l=function(e,t){var r,a,c,u,h,m,v,_,w,S,M;for(v in null==t&&(t={}),w={},t=b(t),w.config=b(t),null==t.scaleTo&&(t.scaleTo=t.period),null==t.sincFilterSize&&(t.sincFilterSize=t.lanczosFilterSize),f)A.call(f,v)&&(M=f[v],null==t[v]&&(t[v]=M));if(!(h={nearest:o,linear:i,cubic:n,lanczos:s,sinc:s}[t.method]))throw"Invalid method: "+t.method;if("lanczos"===t.method&&(t.sincWindow=g(t.sincFilterSize)),e.length<2)throw"Array must have at least two elements";for(v in w.count=e.length,S=function(){var n,r,i,o;switch(p(e[0])){case"Number":if(w.dimension="scalar",l.deepValidation)for(n=0,i=e.length;n<i;n++)_=e[n],E(_);return u=new h(e,t),function(e){return u.interpolate(e)};case"Array":if(w.dimension=a=e[0].length,!a)throw"Vectors must be non-empty";if(l.deepValidation)for(r=0,o=e.length;r<o;r++)M=e[r],T(M,a);return m=function(){var n;for(n=[],c=0;0<=a?c<a:c>a;0<=a?c++:c--)n.push(new h(d(e,c),t));return n}(),function(e){var t,n,r,i;for(i=[],n=0,r=m.length;n<r;n++)t=m[n],i.push(t.interpolate(e));return i};default:throw"Invalid element type: "+p(e[0])}}(),r="periodic"===t.clip?e.length:e.length-1,t.scaleTo||(t.scaleTo=r),w.domain=x(t.scaleTo),S=y(S,r,w.domain),w.domain.sort(),w)A.call(w,v)&&(M=w[v],S[v]=M);return S},r)A.call(r,v)&&(M=r[v],l[v]=M);l.deepValidation=!0,(null!==e?e:window).Smooth=l}).call(it)}(Ho);var jo=yn.ResidueType,Wo=Nn.calcChunkMatrix;function qo(e,t){var n=Ho.Smooth(e,{method:Ho.Smooth.METHOD_CUBIC,clip:Ho.Smooth.CLIP_CLAMP,cubicTension:t,scaleTo:1});return function(t,r){var i=r;null===i&&(i=function(t){return(t*(e.length-1-2)+1)/(e.length-1)});var o=i(t),s=n(o);return new a.Vector3(s[0],s[1],s[2])}}function Xo(e,t,n,r){if(!r._isValid)return e[n]=e[n-1],void(t[n]=t[n-1]);var i=r._controlPoint;e[n]=[i.x,i.y,i.z];var o=i.clone().add(r._wingVector);t[n]=[o.x,o.y,o.z]}function Yo(e,t,n,r){var i=r.start,o=r.end;function a(t){return t>i&&e[t-1]._isValid?t-1:t}function s(t){return t<o&&e[t+1]._isValid?t+1:t}var l=[],c=[],u=0;function h(t,n){var r=e[t]._controlPoint.clone().lerp(e[n]._controlPoint,-.25),i=r.clone().add(e[t]._wingVector);c[u]=[r.x,r.y,r.z],l[u++]=[i.x,i.y,i.z],c[u]=[r.x,r.y,r.z],l[u++]=[i.x,i.y,i.z]}var f=a(t),d=s(n);if(f===d)return function(e,t,n,r){var i,o,a=0!=(r._type.flags&jo.Flags.NUCLEIC),s=a?"C5'":"N",l=a?"C3'":"C";if(r.forEachAtom((function(e){var t=e.getVisualName();i||t!==s?o||t!==l||(o=e.position):i=e.position})),i&&o||(i=r._firstAtom.position,o=r._lastAtom.position),i&&o){var c=o.clone().sub(i),u=r._wingVector,h=r._controlPoint,f=h.clone().add(u),d=h.clone().sub(c),p=d.clone().add(u);e[n]=[d.x,d.y,d.z],t[n]=[p.x,p.y,p.z],e[++n]=[d.x,d.y,d.z],t[n]=[p.x,p.y,p.z],e[++n]=[h.x,h.y,h.z],t[n]=[f.x,f.y,f.z],++n;var m=h.clone().add(c),v=m.clone().add(u);e[n]=[m.x,m.y,m.z],t[n]=[v.x,v.y,v.z],e[++n]=[m.x,m.y,m.z],t[n]=[v.x,v.y,v.z]}}(c,l,u,e[t]),{centerPoints:c,topPoints:l};t===f?h(t,s(t)):(Xo(c,l,u++,e[a(f)]),Xo(c,l,u++,e[f]));for(var p=t;p<=n;++p)Xo(c,l,u++,e[p]);return d===s(d)?h(n,a(n)):(Xo(c,l,u++,e[d]),Xo(c,l,u,e[s(d)])),{centerPoints:c,topPoints:l}}var Zo=function(){function e(t,n,r,i,o,a){g(this,e);var s=Yo(t,n,r,a);this._topInterp=qo(s.topPoints,o),this._centerInterp=qo(s.centerPoints,o),this._shift=.5/(r-n+2),this._valueStep=(1-2*this._shift)/(2*(r-n+1)*(i-1)),this._segmentsCount=i}return _(e,[{key:"prepareMatrices",value:function(e,t,n){for(var r=this._segmentsCount,i=new Array(r),o=new a.Vector2(0,0),s=this._topInterp,l=this._centerInterp,c=this._shift+this._valueStep*(r-1)*e,u=0;u<r;++u){var h=Math.min(1,u/(r-1));o.lerpVectors(t,n,h);var f=s(c,null),d=l(c,null),p=l(c+=this._valueStep,null);i[u]=Wo(d.clone(),p.clone(),f.clone().sub(d),o)}return i}}]),e}();function $o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function Jo(e,t){for(var n=[],r=0;r<t;++r){var i=Math.PI/2-2*Math.PI*r/t;n.push(new a.Vector3(Math.cos(i)*e,Math.sin(i)*e,0))}return n}function Ko(e,t,n,r,i,o){for(var a=0,s=e.length;a<s;++a)for(var l=e[a].arr,c=e[a].boundaries,u=0,h=l.length;u<h;++u)for(var f=[l[u].start,l[u].end],d=new Zo(t,f[0],f[1],n,r,c),p=null,m=2*l[u].start,v=2*l[u].end+1,g=i.getResidueRadius(t[0],0),y=m;y<=v;++y){var _=t[y/2|0],x=i.getResidueRadius(_,y%2),b=i.getResidueRadius(_,1+y%2),w=d.prepareMatrices(y-2*f[0],x,b);w.unshift(null===p?w[0]:p),o(_,w,x.x!==b.x||x.y!==b.y,x.x!==g.x||x.y!==g.y),p=w[n],g=b}}var Qo=function(e){T(n,e);var t=$o(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){var e=this._mode.getHeightSegmentsRatio();return this._segmentsHeight=this._polyComplexity*e|0,[Jo(1,this._polyComplexity),this._segmentsHeight+1,2*this._selection.chunks.length]}},{key:"_build",value:function(){var e=this._selection,t=e.residues,n=e.parent,r=this._mode,i=this._colorer,o=r.getTension(),a=this._geo,s=0,l=[];Ko(this._selection.subdivs,t,this._segmentsHeight,o,r,(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=i.getResidueColor(e,n);l[s]=e._index,a.setItem(s,t,r,o),a.setColor(s++,c)})),this._chunksIdc=l,a.finalize()}},{key:"updateToFrame",value:function(e){var t=this._selection.parent,n=this._mode,r=this._colorer,i=n.getTension(),o=this._geo,a=e.getResidues(),s=0,l=e.needsColorUpdate(r);Ko(this._selection.subdivs,a,this._segmentsHeight,i,n,(function(e,n){o.setItem(s,n),l&&o.setColor(s,r.getResidueColor(e,t)),s++})),o.finalize()}}]),n}(Do);function ea(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ta=function(e){T(n,e);var t=ea(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){for(var e=this._selection.subdivs,t=0,n=0,r=e.length;n<r;++n)for(var i=e[n].arr,o=0,a=i.length;o<a;++o)t+=i[o].end-i[o].start;return[t,this._polyComplexity]}},{key:"_build",value:function(){for(var e=this._selection,t=e.residues,n=e.parent,r=this._mode,i=this._colorer,o=this._geo,a=0,s=[],l=this._selection.subdivs,c=r.calcStickRadius(),u=0,h=l.length;u<h;++u)for(var f=l[u].arr,d=0,p=f.length;d<p;++d)for(var m=f[d].start,v=f[d].end,g=t[m],y=m+1;y<=v;++y){var _=t[y];s[a]={first:g._index,second:_._index},o.setItem(a,g._controlPoint,_._controlPoint,c),o.setColor(a,i.getResidueColor(g,n),i.getResidueColor(_,n)),a++,g=_}this._chunksIdc=s,o.finalize()}},{key:"updateToFrame",value:function(e){for(var t=e.getResidues(),n=this._selection.parent,r=this._mode,i=this._colorer,o=this._geo,a=0,s=this._selection.subdivs,l=r.calcStickRadius(),c=e.needsColorUpdate(i),u=0,h=s.length;u<h;++u)for(var f=s[u].arr,d=0,p=f.length;d<p;++d)for(var m=f[d].start,v=f[d].end,g=t[m],y=m+1;y<=v;++y){var _=t[y];o.setItem(a,g._controlPoint,_._controlPoint,l),c&&o.setColor(a,i.getResidueColor(g,n),i.getResidueColor(_,n)),a++,g=_}o.finalize()}},{key:"raycast",value:function(e,t){var n=[],r=this._selection.residues;this._mesh.raycast(e,n);for(var i=this._chunksIdc,o=0,a=n.length;o<a;++o)if(n[o].hasOwnProperty("chunkIdx")){var s=n[o].chunkIdx,l=i[Math.floor(s/2)],c=s%2==0?l.first:l.second;c<r.length&&(n[o].residue=r[c],t.push(n[o]))}}},{key:"_calcChunksList",value:function(e){for(var t=[],n=this._chunksIdc,r=this._selection.residues,i=0,o=n.length;i<o;++i){var a=n[i];r[a.first]._mask&e&&t.push(2*i),r[a.second]._mask&e&&t.push(2*i+1)}return t}}]),n}(co);function na(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ra=function(e){T(n,e);var t=na(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_makeGeoArgs",value:function(){for(var e=this._mode.drawMultiorderBonds(),t=this._mode.showAromaticLoops(),n=this._selection.chunks,r=this._selection.bonds,i=0,o=0,a=n.length;o<a;++o)i+=this.getBondOrder(r[n[o]],e,t);return[i,this._polyComplexity]}},{key:"getBondOrder",value:function(e,t,n){var r=1;return!t||n&&e._type===Pe.BondType.AROMATIC||(r=function(e){return e<2?1:e}(e._order)),r}},{key:"raycast",value:function(e,t){var n=this._selection.bonds,r=[];this._mesh.raycast(e,r);for(var i=this._chunksIdc,o=0,a=r.length;o<a;++o)if(r[o].hasOwnProperty("chunkIdx")){var s=r[o].chunkIdx,l=i[Math.floor(s/2)];if(l<n.length){var c=n[l];r[o].atom=s%2==0?c._left:c._right,t.push(r[o])}}}},{key:"_calcChunksList",value:function(e,t){for(var n=[],r=this._selection.bonds,i=this._chunksIdc,o=0,a=i.length;o<a;++o){var s=r[i[o]];s._left.mask&e&&(!t||s._right.mask&e)&&n.push(2*o),s._right.mask&e&&(!t||s._left.mask&e)&&n.push(2*o+1)}return n}}]),n}(co);function ia(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function oa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var aa={AtomsSphereGroup:po,AtomsSurfaceGroup:vo,AtomsSASSESGroupStub:yo,AtomsTextGroup:Eo,AromaticTorusGroup:ko,AromaticLinesGroup:No,NucleicCylindersGroup:Vo,NucleicSpheresGroup:Go,ResiduesSubseqGroup:Qo,ResiduesTraceGroup:ta,BondsCylinderGroup:function(e){T(n,e);var t=ia(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_build",value:function(){for(var e,t=this._selection.chunks,n=this._selection,r=n.bonds,i=n.parent,o=this._mode,s=this._colorer,l=this._geo,c=o.drawMultiorderBonds(),u=o.showAromaticLoops(),h=o.calcStickRadius(),f=o.calcSpaceFraction(),d=new a.Vector3,p=new a.Vector3,m=0,v=[],g=0,y=t.length;g<y;++g){var _=r[t[g]],x=_._left,b=_._right,w=x.position,S=b.position;e=_.calcNormalDir();for(var M=this.getBondOrder(_,c,u),E=2*Math.min(o.calcAtomRadius(x),o.calcAtomRadius(b))/M,T=c?Math.min(h,.5*E*(1-f)):h,A=0;A<M;++A){var C=E*(M%2==0?(.5+(A/2|0))*(1-A%2*2):((A+1)/2|0)*(A%2*2-1));v[m]=_._index,d.copy(w),d.addScaledVector(e,C),p.copy(S),p.addScaledVector(e,C),l.setItem(m,d,p,T),l.setColor(m++,s.getAtomColor(x,i),s.getAtomColor(b,i))}}l.finalize(),this._chunksIdc=v}},{key:"updateToFrame",value:function(e){for(var t,n=this._selection.chunks,r=this._selection.bonds,i=this._mode,o=this._colorer,s=this._geo,l=i.drawMultiorderBonds(),c=i.showAromaticLoops(),u=i.calcStickRadius(),h=i.calcSpaceFraction(),f=new a.Vector3,d=new a.Vector3,p=0,m=e.needsColorUpdate(o),v=0,g=n.length;v<g;++v){var y=r[n[v]],_=y._left,x=y._right,b=e.getAtomPos(_.index).clone(),w=e.getAtomPos(x.index);t=y.calcNormalDir();for(var S=this.getBondOrder(y,l,c),M=2*Math.min(i.calcAtomRadius(_),i.calcAtomRadius(x))/S,E=l?Math.min(u,.5*M*(1-h)):u,T=0;T<S;++T){var A=M*(S%2==0?(.5+(T/2|0))*(1-T%2*2):((T+1)/2|0)*(T%2*2-1));f.copy(b),f.addScaledVector(t,A),d.copy(w),d.addScaledVector(t,A),s.setItem(p,f,d,E),m&&s.setColor(p,e.getAtomColor(o,_),e.getAtomColor(o,x)),p++}}s.finalize()}}]),n}(ra),BondsLinesGroup:function(e){T(n,e);var t=oa(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_build",value:function(){for(var e=this._selection.chunks,t=this._selection,n=t.bonds,r=t.parent,i=this._mode,o=this._colorer,s=this._geo,l=i.drawMultiorderBonds(),c=i.showAromaticLoops(),u=new a.Vector3,h=new a.Vector3,f=new a.Vector3,d=0,p=[],m=0,v=e.length;m<v;++m){var g=n[e[m]],y=g._left,_=g._right,x=y.position,b=_.position,w=1===y.bonds.length,S=1===_.bonds.length;u.subVectors(b,x);for(var M=u.length(),E=g.calcNormalDir(),T=this.getBondOrder(g,l,c),A=0;A<T;++A){h.copy(x),f.copy(b);var C=T%2==0?(.5+(A/2|0))*(1-A%2*2):((A+1)/2|0)*(A%2*2-1);p[d]=g._index,2!==T||w||S||(C-=.5,C*=-1),!w&&!S&&T>1&&0!==C&&(h.lerpVectors(x,b,.15/M),f.lerpVectors(x,b,1-.15/M)),C*=.15,h.addScaledVector(E,C),f.addScaledVector(E,C),s.setItem(d,h,f),s.setColor(d++,o.getAtomColor(y,r),o.getAtomColor(_,r))}}s.finalize(),this._chunksIdc=p}},{key:"updateToFrame",value:function(e){for(var t=this._selection.chunks,n=this._selection.bonds,r=this._mode,i=this._colorer,o=this._geo,s=r.drawMultiorderBonds(),l=r.showAromaticLoops(),c=new a.Vector3,u=new a.Vector3,h=new a.Vector3,f=0,d=e.needsColorUpdate(i),p=0,m=t.length;p<m;++p){var v=n[t[p]],g=v._left,y=v._right,_=e.getAtomPos(g.index).clone(),x=e.getAtomPos(y.index),b=1===g.bonds.length,w=1===y.bonds.length;c.subVectors(x,_);for(var S=c.length(),M=v.calcNormalDir(),E=this.getBondOrder(v,s,l),T=0;T<E;++T){u.copy(_),h.copy(x);var A=E%2==0?(.5+(T/2|0))*(1-T%2*2):((T+1)/2|0)*(T%2*2-1);2!==E||b||w||(A-=.5,A*=-1),!b&&!w&&E>1&&0!==A&&(u.lerpVectors(_,x,.15/S),h.lerpVectors(_,x,1-.15/S)),A*=.15,u.addScaledVector(M,A),h.addScaledVector(M,A),o.setItem(f,u,h),d&&o.setColor(f,e.getAtomColor(i,g),e.getAtomColor(i,y)),f++}}o.finalize()}}]),n}(ra)};function sa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var la=function(e){T(n,e);var t=sa(n);function n(e,r,i,o,a,s,l,c){var u;g(this,n);var h=C(u=t.call(this));u._complex=i,u._mode=a;var f=i.getAtoms(),d=i.getTransforms();return i.forEachComponent((function(t){var n=[],u=0;if(t.forEachAtom((function(e){h._checkAtom(e,l)&&(n[u++]=e.index)})),0!==u){var p=new e(r,{atoms:f,chunks:n,parent:i},o,a,d,s,c);p._component=t,h.add(p)}})),u}return _(n,[{key:"_checkAtom",value:function(e,t){return e.mask&t}},{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,c=s.length;l<c;++l){var u=s[l];u._component=r[o]._component,n[i++]=u}return n}}]),n}(wn);function ca(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ua=function(e){T(n,e);var t=ca(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_checkAtom",value:function(e,t){if(!(e.mask&t))return!1;for(var n=e.bonds,r=0,i=n.length;r<i;++r)if(n[r]._left.mask&t&&n[r]._right.mask&t)return!1;return!0}}]),n}(la);function ha(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var fa=function(e){T(n,e);var t=ha(n);function n(e,r,i,o,a,s,l,c){var u;g(this,n);var h=C(u=t.call(this));u._complex=i;var f=i.getResidues(),d=i.getTransforms();return i.forEachComponent((function(t){var n=0,u=[];if(t.forEachResidue((function(e){h._checkResidue(e,l)&&(u[n++]=e._index)})),0!==n){var p=new e(r,{residues:f,chunks:u,parent:i},o,a,d,s,c);p._component=t,h.add(p)}})),u}return _(n,[{key:"checkResidue",value:function(e,t){return e._mask&t}},{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,c=s.length;l<c;++l){var u=s[l];u._component=r[o]._component,n[i++]=u}return n}}]),n}(wn);function da(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function pa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function ma(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function va(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ga={Atoms:la,OrphanAtoms:ua,Residues:fa,Nucleic:function(e){T(n,e);var t=da(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_checkResidue",value:function(e,t){return t&e._mask&&null!==e._cylinders}}]),n}(fa),Subseqs:function(e){T(n,e);var t=pa(n);function n(e,r,i,o,a,s,l,c){var u;g(this,n);var h=C(u=t.call(this));u._complex=i;var f=i.getResidues(),d=i.getTransforms();return i.forEachComponent((function(t){for(var n=t.getMaskedSubdivSequences(l),u=0,p=[],m=0,v=n.length;m<v;++m)for(var g=n[m].arr,y=0,_=g.length;y<_;++y)for(var x=g[y].start,b=g[y].end;x<=b;++x)p[u++]=f[x]._index;if(0!==u){var w=new e(r,{residues:f,chunks:p,subdivs:n,parent:i},o,a,d,s,c);w._component=t,h.add(w)}})),u}return _(n,[{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,c=s.length;l<c;++l){var u=s[l];u._component=r[o]._component,n[i++]=u}return n}}]),n}(wn),Bonds:function(e){T(n,e);var t=ma(n);function n(e,r,i,o,a,s,l,c){var u;g(this,n);var h=C(u=t.call(this));u._complex=i;var f=i.getBonds(),d=i.getTransforms();return i.forEachComponent((function(t){var n=[],u=0;if(t.forEachBond((function(e){var t=e._left,r=e._right;t.mask&l&&r.mask&l&&(n[u++]=e._index)})),0!==u){var p=new e(r,{bonds:f,chunks:n,parent:i},o,a,d,s,c);p._component=t,h.add(p)}})),u}return _(n,[{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,c=s.length;l<c;++l){var u=s[l];u._component=r[o]._component,n[i++]=u}return n}}]),n}(wn),Aromatic:function(e){T(n,e);var t=va(n);function n(e,r,i,o,a,s,l,c){var u;g(this,n);var h=C(u=t.call(this));u._complex=i;var f=i.getAtoms(),d=i.getTransforms();return a.showAromaticLoops()?(i.forEachComponent((function(t){var n=[],u=0,p=[],m=0;t.forEachCycle((function(e){for(var t=e.atoms,r=0,i=0,o=t.length;i<o;++i)0!=(t[i].mask&l)&&(++r,n[u++]=t[i].index);r>0&&(p[m++]=e)}));var v=new e(r,{cycles:p,atoms:f,chunks:n,parent:i},o,a,d,s,c);v._component=t,h.add(v)})),u):R(u)}return _(n,[{key:"getSubset",value:function(e,t){for(var n=[],r=this.children,i=0,o=0,a=r.length;o<a;++o)if(r[o].getSubset)for(var s=r[o].getSubset(e,t),l=0,c=s.length;l<c;++l){var u=s[l];u._component=r[o]._component,n[i++]=u}return n}}]),n}(wn)};function ya(e,t,n){return function(r,i,o,a,s,l){return new t(n,e,r,i,o,a,s,l)}}var _a=function(){function e(){g(this,e)}return _(e,null,[{key:"AtomsSpheres",value:function(e,t){return ya(oo.createSpheres(e,t),ga.Atoms,aa.AtomsSphereGroup)}},{key:"OrphanedAtomsCrosses",value:function(e,t,n){return ya(oo.createCrosses(e,t,n),ga.OrphanAtoms,aa.AtomsSphereGroup)}},{key:"BondsCylinders",value:function(e,t){return ya(oo.create2CCylinders(e,t),ga.Bonds,aa.BondsCylinderGroup)}},{key:"BondsLines",value:function(e,t,n){return ya(oo.create2CLines(e,t,n),ga.Bonds,aa.BondsLinesGroup)}},{key:"CartoonChains",value:function(e,t){return ya(oo.createExtrudedChains(e,t),ga.Subseqs,aa.ResiduesSubseqGroup)}},{key:"TraceChains",value:function(e,t){return ya(oo.create2CClosedCylinders(e,t),ga.Subseqs,aa.ResiduesTraceGroup)}},{key:"NucleicSpheres",value:function(e,t){return ya(oo.createSpheres(e,t),ga.Nucleic,aa.NucleicSpheresGroup)}},{key:"NucleicCylinders",value:function(e,t){return ya(oo.create2CCylinders(e,t),ga.Nucleic,aa.NucleicCylindersGroup)}},{key:"ALoopsTorus",value:function(e,t){return ya(oo.createExtrudedChains(e,t),ga.Aromatic,aa.AromaticTorusGroup)}},{key:"ALoopsLines",value:function(e,t,n){return ya(oo.createChunkedLines(e,t,n),ga.Aromatic,aa.AromaticLinesGroup)}},{key:"QuickSurfGeo",value:function(e,t,n){return ya(oo.createQuickSurface(e,t,n),ga.Atoms,aa.AtomsSurfaceGroup)}},{key:"ContactSurfaceGeo",value:function(e,t,n){return ya(oo.createContactSurface(e,t,n),ga.Atoms,aa.AtomsSurfaceGroup)}},{key:"SASSESSurfaceGeo",value:function(e,t,n){return ya(oo.createSASSES(e,t,n),ga.Atoms,aa.AtomsSASSESGroupStub)}},{key:"TextLabelsGeo",value:function(e,t){return ya(oo.createLabels(e,t),ga.Atoms,aa.AtomsTextGroup)}}]),e}(),xa=function(){function e(t){if(g(this,e),this.constructor===e)throw new Error("Can not instantiate abstract class!");this.opts=o.default.merge(Q.deriveDeep(this.settings.now.modes[this.id],!0),t)}return _(e,[{key:"identify",value:function(){var e=Q.objectsDiff(this.opts,this.settings.now.modes[this.id]);return o.default.isEmpty(e)?this.id:[this.id,e]}},{key:"buildGeometry",value:function(e,t,n,r){for(var i=this.opts.polyComplexity?this.opts.polyComplexity[this.settings.now.resolution]:0,a=this.depGroups,s=a.length,l=new Nn.RCGroup,u=0;u<s;++u){var h=a[u],f={};o.default.isArray(h)&&(f=h[1].call(this),h=c(h,1)[0]);var d=new(_a[h](null,this.settings,f))(e,t,this,i,n,r);d.children.length>0&&l.add(d)}return l}}]),e}();function ba(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function wa(){return{lineWidth:this.opts.lineWidth}}Un(xa.prototype),xa.prototype.id="__",xa.prototype.depGroups=[];var Sa=function(e){T(n,e);var t=ba(n);function n(e){var r;g(this,n),(r=t.call(this,e)).depGroups=r.depGroups.slice(0);for(var i=r.depGroups,o=0,a=i.length;o<a;++o)i[o]=[i[o],wa];return r}return _(n,[{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}},{key:"calcAtomRadius",value:function(){return this.opts.atom}},{key:"getAromaticOffset",value:function(){return this.opts.offsarom}},{key:"getAromaticArcChunks",value:function(){return this.opts.chunkarom}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}}]),n}(xa);function Ma(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Sa,"id","LN"),Sa.prototype.id="LN",Sa.prototype.name="Lines",Sa.prototype.shortName="Lines",Sa.prototype.depGroups=["ALoopsLines","BondsLines","OrphanedAtomsCrosses"];var Ea=function(e){T(n,e);var t=Ma(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"calcAtomRadius",value:function(e){return this.opts.bond}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),n}(xa);function Ta(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Ea,"id","LC"),Ea.prototype.id="LC",Ea.prototype.name="Licorice",Ea.prototype.shortName="Licorice",Ea.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];var Aa=function(e){T(n,e);var t=Ta(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"calcAtomRadius",value:function(e){return e.element.radius*this.opts.atom}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),n}(xa);function Ca(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Aa,"id","BS"),Aa.prototype.id="BS",Aa.prototype.name="Balls and Sticks",Aa.prototype.shortName="Balls",Aa.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];var Ra=function(e){T(n,e);var t=Ca(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"calcAtomRadius",value:function(e){return e.element.radius}}]),n}(xa);function Pa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Ra,"id","VW"),Ra.prototype.id="VW",Ra.prototype.name="Van der Waals",Ra.prototype.shortName="VDW",Ra.prototype.depGroups=["AtomsSpheres"];var La=function(e){T(n,e);var t=Pa(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"calcStickRadius",value:function(){return this.opts.radius}}]),n}(xa);function ka(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(La,"id","TR"),La.prototype.id="TR",La.prototype.name="Trace",La.prototype.shortName="Trace",La.prototype.depGroups=["TraceChains"];var Ia=function(e){T(n,e);var t=ka(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getResidueRadius",value:function(e){return this.TUBE_RADIUS}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(e,t,n,r){var i=this.opts.radius;return this.TUBE_RADIUS=new a.Vector2(i,i),xa.prototype.buildGeometry.call(this,e,t,n,r)}}]),n}(xa);function Na(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Ia,"id","TU"),Ia.prototype.id="TU",Ia.prototype.name="Tube",Ia.prototype.shortName="Tube",Ia.prototype.depGroups=["CartoonChains"];var Oa=function(e){T(n,e);var t=Na(n);function n(e){var r;return g(this,n),(r=t.call(this,e)).secCache={},r}return _(n,[{key:"getResidueStartRadius",value:function(e){var t=e.getSecondary();if(!t||!t.generic)return this.TUBE_RADIUS;var n=this.secCache[t.generic];return n?t.term===e?n.start:n.center:this.TUBE_RADIUS}},{key:"getResidueEndRadius",value:function(e){var t=e.getSecondary();if(null===t||!t.generic)return this.TUBE_RADIUS;var n=this.secCache[t.generic];return n?t.term===e?this.ARROW_END:n.center:this.TUBE_RADIUS}},{key:"getResidueRadius",value:function(e,t){var n=this.getResidueStartRadius(e);if(0===t)return n;var r=this.getResidueEndRadius(e);return 2===t?r:n.clone().lerp(r,t/2)}},{key:"calcStickRadius",value:function(e){return this.opts.radius}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(e,t,n,r){var i=this.opts.radius,o=this.opts.depth;this.TUBE_RADIUS=new a.Vector2(i,i),this.ARROW_END=new a.Vector2(o,i);var s={},l=this.opts.ss;for(var c in l)s[c]={center:new a.Vector2(o,l[c].width),start:new a.Vector2(o,l[c].arrow)};return this.secCache=s,xa.prototype.buildGeometry.call(this,e,t,n,r)}}]),n}(xa);function Da(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Oa,"id","CA"),Oa.prototype.id="CA",Oa.prototype.name="Cartoon",Oa.prototype.shortName="Cartoon",Oa.prototype.depGroups=["CartoonChains","NucleicSpheres","NucleicCylinders"];var Ba=yn.selectors;function za(){return{wireframe:this.opts.wireframe,zClip:this.opts.zClip}}var Fa=function(e){T(n,e);var t=Da(n);function n(e){var r;g(this,n),(r=t.call(this,e)).depGroups=r.depGroups.slice(0);for(var i=r.surfaceNames,o=r.depGroups,a=0,s=i.length;a<s;++a)o[o.length]=[i[a],za];return r}return _(n,[{key:"calcAtomRadius",value:function(e){return e.element.radius}},{key:"getVisibilitySelector",value:function(){var e=null;if(""!==this.opts.subset){var t=Ba.parse(this.opts.subset);t.error||(e=t.selector)}return e}}]),n}(xa);function Va(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Fa.prototype.isSurface=!0,Fa.prototype.surfaceNames=[];var Ua=function(e){T(n,e);var t=Va(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getSurfaceOpts",value:function(){return{useBeads:!1,isoValue:this.opts.isoValue,gaussLim:this.opts.gaussLim[this.settings.now.resolution],radScale:this.opts.scale,gridSpacing:this.opts.gridSpacing[this.settings.now.resolution],zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),n}(Fa);function Ga(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Ua,"id","QS"),Ua.prototype.id="QS",Ua.prototype.name="Quick Surface",Ua.prototype.shortName="Quick Surf",Ua.prototype.surfaceNames=["QuickSurfGeo"];var Ha=function(e){T(n,e);var t=Ga(n);function n(e,r){var i;return g(this,n),(i=t.call(this,r))._excludeProbe=e,i}return _(n,[{key:"calcAtomRadius",value:function(e){return e.element.radius}},{key:"getSurfaceOpts",value:function(){return{gridSpacing:this.opts.polyComplexity[this.settings.now.resolution],radScale:this._radScale,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector(),probeRadius:this.opts.probeRadius,excludeProbe:this._excludeProbe}}}]),n}(Fa);function ja(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ha.prototype.id="SU",Ha.prototype.name="Surface",Ha.prototype.shortName="Surface",Ha.prototype.surfaceNames=["SASSESSurfaceGeo"],Ha.prototype._radScale=1,Ha.prototype._excludeProbe=!1;var Wa=function(e){T(n,e);var t=ja(n);function n(e){return g(this,n),t.call(this,!1,e)}return n}(Ha);function qa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Wa,"id","SA"),Wa.prototype.id="SA",Wa.prototype.name="Solvent Accessible Surface",Wa.prototype.shortName="SAS";var Xa=function(e){T(n,e);var t=qa(n);function n(e){return g(this,n),t.call(this,!0,e)}return n}(Ha);function Ya(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Xa,"id","SE"),Xa.prototype.id="SE",Xa.prototype.name="Solvent Excluded Surface",Xa.prototype.shortName="SES";var Za=function(e){T(n,e);var t=Ya(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getSurfaceOpts",value:function(){return{probeRadius:this.opts.probeRadius,radScale:this.opts.polyComplexity[this.settings.now.resolution],scaleFactor:this.opts.polyComplexity[this.settings.now.resolution],gridSpacing:1/this.opts.polyComplexity[this.settings.now.resolution],isoValue:this.opts.isoValue,probePositions:this.opts.probePositions,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),n}(Fa);function $a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Za,"id","CS"),Za.prototype.id="CS",Za.prototype.name="Contact Surface",Za.prototype.shortName="Contact Surf",Za.prototype.isSurface=!0,Za.prototype.surfaceNames=["ContactSurfaceGeo"];var Ja=function(e){T(n,e);var t=$a(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getTemplateOptions",value:function(){return this.opts.template}},{key:"getLabelOpts",value:function(){return o.default.merge(this.opts,{colors:!0,adjustColor:!0,transparent:!0})}}]),n}(xa);Ee(Ja,"id","TX"),Ja.prototype.id="TX",Ja.prototype.name="Text mode",Ja.prototype.shortName="Text",Ja.prototype.depGroups=["TextLabelsGeo"];var Ka=new Vn([Sa,Ea,Aa,Ra,La,Ia,Oa,Ua,Wa,Xa,Za,Ja]);function Qa(e,t,n){return e<=n?e<0?0:e:n}var es=function(){function e(t,n){g(this,e),this.name=t||"Custom",this.id=n||"CP"}return _(e,[{key:"getElementColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.elementColors[e];return void 0!==n||t?n:this.defaultElementColor}},{key:"getResidueColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.residueColors[e];return void 0!==n||t?n:this.defaultResidueColor}},{key:"getChainColor",value:function(e){var t=e.charCodeAt(0);return t=(31&(t<0?0:t>=256?t-256:t))%this.chainColors.length,this.chainColors[t]}},{key:"getSecondaryColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.secondaryColors[e];return void 0!==n||t?n:this.defaultSecondaryColor}},{key:"getSequentialColor",value:function(e){var t=this.colors,n=t.length;return e<0?t[e%n+n]:t[e%n]}},{key:"getGradientColor",value:function(e,t){var n=this.gradients[t];if(!n)return this.defaultNamedColor;var r,i,o,a,s=n.length,l=e*(s-1),c=Math.floor(l),u=Qa(c+1,0,s-1);return c=Qa(c,0,s-1),r=n[c],i=n[u],(a=1-(o=l-c))*(r>>16&255)+o*(i>>16&255)<<16|a*(r>>8&255)+o*(i>>8&255)<<8|a*(255&r)+o*(255&i)}},{key:"getNamedColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.namedColors[e];return void 0!==n||t?n:this.defaultNamedColor}}]),e}();o.default.assign(es.prototype,{colors:[16777215,16711680,65280,255,8421504],minRangeColor:0,midRangeColor:8355711,maxRangeColor:16777215,defaultElementColor:16777215,elementColors:{},defaultResidueColor:16777215,residueColors:{},chainColors:[16777215],defaultSecondaryColor:16777215,secondaryColors:{},defaultGradientColor:0,defaultNamedColor:16777215,namedColorsArray:[["indianred",13458524],["lightcoral",15761536],["salmon",16416882],["darksalmon",15308410],["lightsalmon",16752762],["crimson",14423100],["red",16711680],["firebrick",11674146],["darkred",9109504],["pink",16761035],["lightpink",16758465],["hotpink",16738740],["deeppink",16716947],["mediumvioletred",13047173],["palevioletred",14381203],["coral",16744272],["tomato",16737095],["orangered",16729344],["darkorange",16747520],["orange",16753920],["gold",16766720],["yellow",16776960],["lightyellow",16777184],["lemonchiffon",16775885],["lightgoldenrodyellow",16448210],["papayawhip",16773077],["moccasin",16770229],["peachpuff",16767673],["palegoldenrod",15657130],["khaki",15787660],["darkkhaki",12433259],["lavender",15132410],["thistle",14204888],["plum",14524637],["violet",15631086],["orchid",14315734],["fuchsia",16711935],["magenta",16711935],["mediumorchid",12211667],["mediumpurple",9662683],["rebeccapurple",6697881],["blueviolet",9055202],["darkviolet",9699539],["darkorchid",10040012],["darkmagenta",9109643],["purple",8388736],["indigo",4915330],["slateblue",6970061],["mediumslateblue",8087790],["darkslateblue",4734347],["greenyellow",11403055],["chartreuse",8388352],["lawngreen",8190976],["lime",65280],["limegreen",3329330],["palegreen",10025880],["lightgreen",9498256],["mediumspringgreen",64154],["springgreen",65407],["mediumseagreen",3978097],["seagreen",3050327],["forestgreen",2263842],["green",32768],["darkgreen",25600],["yellowgreen",10145074],["olivedrab",7048739],["olive",8421376],["darkolivegreen",5597999],["mediumaquamarine",6737322],["darkseagreen",9419919],["lightseagreen",2142890],["darkcyan",35723],["teal",32896],["aqua",65535],["cyan",65535],["lightcyan",14745599],["paleturquoise",11529966],["aquamarine",8388564],["turquoise",4251856],["mediumturquoise",4772300],["darkturquoise",52945],["cadetblue",6266528],["steelblue",4620980],["lightsteelblue",11584734],["powderblue",11591910],["lightblue",11393254],["skyblue",8900331],["lightskyblue",8900346],["deepskyblue",49151],["dodgerblue",2003199],["cornflowerblue",6591981],["royalblue",4286945],["blue",255],["mediumblue",205],["darkblue",139],["navy",128],["midnightblue",1644912],["cornsilk",16775388],["blanchedalmond",16772045],["bisque",16770244],["navajowhite",16768685],["wheat",16113331],["burlywood",14596231],["tan",13808780],["rosybrown",12357519],["sandybrown",16032864],["goldenrod",14329120],["darkgoldenrod",12092939],["peru",13468991],["chocolate",13789470],["saddlebrown",9127187],["sienna",10506797],["brown",10824234],["maroon",8388608],["white",16777215],["snow",16775930],["honeydew",15794160],["mintcream",16121850],["azure",15794175],["aliceblue",15792383],["ghostwhite",16316671],["whitesmoke",16119285],["seashell",16774638],["beige",16119260],["oldlace",16643558],["floralwhite",16775920],["ivory",16777200],["antiquewhite",16444375],["linen",16445670],["lavenderblush",16773365],["mistyrose",16770273],["gainsboro",14474460],["lightgray",13882323],["silver",12632256],["darkgray",11119017],["gray",8421504],["dimgray",6908265],["lightslategray",7833753],["slategray",7372944],["darkslategray",3100495],["black",0]],namedColors:{},gradients:{rainbow:[255,65535,65280,16776960,16711680],temp:[255,32767,16777215,16744192,16711680],hot:[16777215,16744192,16711680],cold:[16777215,32767,255],"blue-red":[255,16777215,16711680],reds:[16777215,16711680],blues:[16777215,255]}});for(var ts=es.prototype,ns=ts.namedColorsArray,rs=ts.namedColors,is=0,os=ns.length;is<os;++is){var as=c(ns[is],2),ss=as[0],ls=as[1];rs[ss]=ls}var cs,us=new es("CPK","CP");us.elementColors={H:16777215,C:2105376,N:2121983,O:15605776,F:65280,P:8397055,S:16776960,CL:47872,FE:13684944,CO:13684944,NI:13684944,CU:13684944,BR:34816,I:21760};var hs=new es("Jmol","JM");hs.colors=[255,22015,44031,65535,65451,65365,65280,5635840,11271936,16776960,16755456,16733440,16711680,16711765,16711851,16711935,11206911,5570815],hs.elementColors={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:4366e3,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998},hs.defaultResidueColor=12492910,hs.residueColors={ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,A:10526975,C:16747595,G:16740464,I:8454143,T:10551200,U:16744576,DA:10526975,DC:16747595,DG:16740464,DI:8454143,DT:10551200,DU:16744576,"+A":10526975,"+C":16747595,"+G":16740464,"+I":8454143,"+T":10551200,"+U":16744576},hs.chainColors=[4294967295,4290826495,4289789872,4294951112,4294967168,4294951167,4289786096,4294955120,4293951616,4294303411,4278239231,4291648604,4284927402,4288335154,4293821166,4278243025,4278255487,4282168177,4278190219,4290623339,4278215680,4286578688,4286611456,4286578816,4278222976,4290283019,4289864226];var fs,ds=We.Type;hs.secondaryColors=(Ee(cs={},ds.HELIX_ALPHA,16711808),Ee(cs,ds.HELIX_PI,6291584),Ee(cs,ds.HELIX_310,10485888),Ee(cs,ds.STRAND,16762880),Ee(cs,ds.TURN,6324479),Ee(cs,"dna",11403518),Ee(cs,"rna",16580962),cs);var ps=new es("VMD","VM");ps.colors=[255,16711680,6316128,16744448,16776960,8421427,10066329,65280,16777215,16751001,4243648,10879142,8447590,15099571,8408320,8421568],ps.defaultElementColor=8408320,ps.elementColors={H:16777215,C:4243391,N:255,O:16711680,P:8421427,S:16776960},ps.defaultResidueColor=4243648,ps.residueColors={ALA:255,ARG:16777215,ASN:8421427,ASP:16711680,CYS:16776960,GLN:16744448,GLU:16751001,GLY:16777215,HIS:4243648,ILE:65280,LEU:16751001,LYS:4243648,MET:16776960,PHE:10879142,PRO:8408064,SER:16776960,THR:15099571,TRP:10066329,TYR:65280,VAL:8421427,A:255,C:16744448,G:16776960,T:10879142,U:65280,DA:255,DC:16744448,DG:16776960,DT:10879142,DU:65280,"+A":255,"+C":16744448,"+G":16776960,"+T":10879142,"+U":65280,WAT:4243648,H2O:4243648,HOH:4243648},ps.chainColors=[16777215].concat(ps.colors);var ms=We.Type;ps.secondaryColors=(Ee(fs={},ms.HELIX_ALPHA,10879142),Ee(fs,ms.HELIX_310,255),Ee(fs,ms.HELIX_PI,16711680),Ee(fs,ms.STRAND,16776960),Ee(fs,ms.BRIDGE,8421427),Ee(fs,ms.TURN,4243648),fs);var vs=new Vn([us,hs,ps]),gs=function(){function e(t){if(g(this,e),this.constructor===e)throw new Error("Can not instantiate abstract class!");this.opts=o.default.merge(Q.deriveDeep(ie.now.colorers[this.id],!0),t),this.palette=vs.first}return _(e,[{key:"identify",value:function(){var e=Q.objectsDiff(this.opts,ie.now.colorers[this.id]);return o.default.isEmpty(e)?this.id:[this.id,e]}}]),e}();function ys(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}gs.prototype.id="__";var _s=function(e){T(n,e);var t=ys(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){var n=e.element.name;return"C"===n&&this.opts.carbon>=0?this.opts.carbon:this.palette.getElementColor(n)}},{key:"getResidueColor",value:function(e,t){return this.palette.defaultResidueColor}}]),n}(gs);function xs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(_s,"id","EL"),_s.prototype.id="EL",_s.prototype.name="Element",_s.prototype.shortName="Element";var bs=function(e){T(n,e);var t=xs(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e.residue,t)}},{key:"getResidueColor",value:function(e,t){return this.palette.getResidueColor(e._type._name)}}]),n}(gs);function ws(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(bs,"id","RT"),bs.prototype.id="RT",bs.prototype.name="Residue Type",bs.prototype.shortName="Residue";var Ss=function(e){T(n,e);var t=ws(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e.residue,t)}},{key:"getResidueColor",value:function(e,t){var n=e._chain;if(n.minSequence===Number.POSITIVE_INFINITY&&n.maxSequence===Number.NEGATIVE_INFINITY)return this.palette.defaultNamedColor;var r=n.minSequence,i=n.maxSequence>r?n.maxSequence:r+1;return this.palette.getGradientColor((e._sequence-r)/(i-r),this.opts.gradient)}}]),n}(gs);function Ms(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Ss,"id","SQ"),Ss.prototype.id="SQ",Ss.prototype.name="Sequence",Ss.prototype.shortName="Sequence";var Es=function(e){T(n,e);var t=Ms(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e.residue,t)}},{key:"getResidueColor",value:function(e,t){return this.palette.getChainColor(e.getChain()._name)}}]),n}(gs);function Ts(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Es,"id","CH"),Es.prototype.id="CH",Es.prototype.name="Chain",Es.prototype.shortName="Chain";var As=function(e){T(n,e);var t=Ts(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e.residue,t)}},{key:"getResidueColor",value:function(e,t){if(e._type.flags&Be.Flags.DNA)return this.palette.getSecondaryColor("dna");if(e._type.flags&Be.Flags.RNA)return this.palette.getSecondaryColor("rna");var n=e.getSecondary();if(n){var r=this.palette.getSecondaryColor(n.type,!0);return void 0===r&&(r=this.palette.getSecondaryColor(n.generic)),r}return this.palette.defaultSecondaryColor}}]),n}(gs);function Cs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(As,"id","SS"),As.prototype.id="SS",As.prototype.name="Secondary Structure",As.prototype.shortName="Structure";var Rs=function(e){T(n,e);var t=Cs(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.opts.color}},{key:"getResidueColor",value:function(e,t){return this.opts.color}}]),n}(gs);function Ps(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Rs,"id","UN"),Rs.prototype.id="UN",Rs.prototype.name="Uniform",Rs.prototype.shortName="Uniform";var Ls=function(e){T(n,e);var t=Ps(n);function n(e){var r;g(this,n),r=t.call(this,e);var i=Rt.parse(r.opts.subset);return r._subsetCached=i.error?Rt.none():i.selector,r}return _(n,[{key:"getAtomColor",value:function(e,t){return this._subsetCached.includesAtom(e)?this.opts.color:this.opts.baseColor}},{key:"getResidueColor",value:function(e,t){for(var n=this._subsetCached,r=e._atoms,i=0,o=r.length;i<o;++i)if(!n.includesAtom(r[i]))return this.opts.baseColor;return this.opts.color}}]),n}(gs);function ks(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Ls,"id","CO"),Ls.prototype.id="CO",Ls.prototype.name="Conditional",Ls.prototype.shortName="Conditional";var Is=function(e){T(n,e);var t=ks(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.palette.getChainColor(String.fromCharCode(e.location))}},{key:"getResidueColor",value:function(e,t){return this.palette.defaultResidueColor}}]),n}(gs);function Ns(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Is,"id","CF"),Is.prototype.id="CF",Is.prototype.name="Conformation",Is.prototype.shortName="Conformation";var Os=function(e){T(n,e);var t=Ns(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){var n=this.opts,r=1;return e.temperature&&n?(r=n.min===n.max?e.temperature>n.max?1:0:(e.temperature-n.min)/(n.max-n.min),this.palette.getGradientColor(r,n.gradient)):this.palette.defaultGradientColor}},{key:"getResidueColor",value:function(e,t){var n=this.opts;if(!n)return this.palette.defaultGradientColor;if(e.temperature){var r=0;return r=n.min===n.max?e.temperature>n.max?1:0:(e.temperature-n.min)/(n.max-n.min),this.palette.getGradientColor(r,n.gradient)}return this.palette.defaultGradientColor}}]),n}(gs);function Ds(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Os,"id","TM"),Os.prototype.id="TM",Os.prototype.name="Temperature",Os.prototype.shortName="Temperature";var Bs=function(e){T(n,e);var t=Ds(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_getColorByOccupancy",value:function(e,t){if(void 0!==e){var n=1-e;return this.palette.getGradientColor(n,t.gradient)}return this.palette.defaultGradientColor}},{key:"getAtomColor",value:function(e,t){var n=this.opts;return this._getColorByOccupancy(e.occupancy,n)}},{key:"getResidueColor",value:function(e,t){var n=this.opts;return this._getColorByOccupancy(e.occupancy,n)}}]),n}(gs);function zs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Bs,"id","OC"),Bs.prototype.id="OC",Bs.prototype.name="Occupancy",Bs.prototype.shortName="Occupancy";var Fs=function(e){T(n,e);var t=zs(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e.residue,t)}},{key:"getResidueColor",value:function(e,t){var n=this.palette.defaultResidueColor;return void 0!==e._type.hydrophobicity&&(n=this.palette.getGradientColor((e._type.hydrophobicity- -4.5)/9,this.opts.gradient)),n}}]),n}(gs);function Vs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Fs,"id","HY"),Fs.prototype.id="HY",Fs.prototype.name="Hydrophobicity",Fs.prototype.shortName="Hydrophobicity";var Us=function(e){T(n,e);var t=Vs(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){return this.getResidueColor(e.residue,t)}},{key:"getResidueColor",value:function(e,t){var n=e._molecule,r=t.getMoleculeCount();return r>1?this.palette.getGradientColor((n.index-1)/(r-1),this.opts.gradient):this.palette.getGradientColor(0,this.opts.gradient)}}]),n}(gs);function Gs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Us,"id","MO"),Us.prototype.id="MO",Us.prototype.name="Molecule",Us.prototype.shortName="Molecule";var Hs=function(e){T(n,e);var t=Gs(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"getAtomColor",value:function(e,t){var n,r,i=this.opts.color,o=(n=i,(r=this.opts.factor)*(n>>16&255)<<16|r*(n>>8&255)<<8|r*(255&n));return e.flags&Te.Flags.CARBON?i:o}},{key:"getResidueColor",value:function(e,t){return this.opts.color}}]),n}(gs);Ee(Hs,"id","CB"),Hs.prototype.id="CB",Hs.prototype.name="Carbon",Hs.prototype.shortName="Carbon";var js=new Vn([_s,bs,Ss,Es,As,Rs,Ls,Is,Os,Bs,Fs,Us,Hs]);function Ws(e){return new a.Color(e,e,e)}var qs,Xs=new Vn([{id:"DF",name:"Diffuse",shortName:"Diffuse",uberOptions:{diffuse:Ws(1),specular:Ws(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"SF",name:"Soft Plastic",shortName:"Soft",uberOptions:{diffuse:Ws(1),specular:Ws(.1),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"PL",name:"Glossy Plastic",shortName:"Glossy",uberOptions:{diffuse:Ws(.56),specular:Ws(.28),shininess:100,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"ME",name:"Metal",shortName:"Metal",uberOptions:{diffuse:Ws(.56),specular:Ws(.55),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"TR",name:"Transparent",shortName:"Transparent",uberOptions:{diffuse:Ws(1),specular:Ws(0),shininess:1,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"GL",name:"Glass",shortName:"Glass",uberOptions:{diffuse:Ws(.5),specular:Ws(.65),shininess:100,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"BA",name:"Backdrop",shortName:"Backdrop",uberOptions:{diffuse:Ws(1),specular:Ws(0),shininess:1,opacity:1},values:{lights:!1,fog:!1,depthWrite:!1,transparent:!1,toonShading:!1}},{id:"TN",name:"Toon",shortName:"Toon",uberOptions:{diffuse:Ws(1),specular:Ws(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!0}},{id:"FL",name:"Flat",shortName:"Flat",uberOptions:{diffuse:Ws(1),specular:Ws(0),shininess:0,opacity:1},values:{lights:!1,fog:!0,depthWrite:!0,transparent:!1}}]);function Ys(e,t,n){var r=e.material.createInstance();r.setValues(t);var i=new e.constructor(e.geometry,r);return i.material.needsUpdate=!0,i.applyMatrix4(e.matrix),i.layers.set(n),i}function Zs(e,t,n){for(var r=function(e,t){var n=[];return e.traverse((function(e){for(var r=0;r<t.length;r++)if(e instanceof t[r]){n[n.length]=e;break}})),n}(e,t),i=0,o=r.length;i<o;++i){var a=r[i];a.parent&&n(a)}}function $s(e,t){!function e(n){n instanceof a.Mesh&&t(n);for(var r=0,i=n.children.length;r<i;r++)e(n.children[r])}(e)}var Js={applyTransformsToMeshes:function(e,t){var n=t.length;n<1||Zs(e,[a.Mesh,a.LineSegments,a.Line],(function(e){e.applyMatrix4(t[0]);for(var r=1;r<n;++r){var i=new e.constructor(e.geometry,e.material);e.parent.add(i),i.applyMatrix4(t[r])}}))},processTransparentMaterial:(qs={prepassTransparancy:!0,fakeOpacity:!1,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1},function(e,t){t instanceof Oi&&Zs(e,[a.Mesh,a.LineSegments],(function(e){e.material.setValues({prepassTransparancy:!1,fakeOpacity:!1}),e.material.needsUpdate=!0,e.layers.set(Nn.LAYERS.TRANSPARENT);var t=Ys(e,qs,Nn.LAYERS.PREPASS_TRANSPARENT);e.parent.add(t)}))}),processColFromPosMaterial:function(){var e={colorFromPos:!0,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1,overrideColor:!1,fogTransparent:!1,attrColor:!1,attrColor2:!1,attrAlphaColor:!1,fakeOpacity:!1};return function(t,n){n instanceof Oi&&Zs(t,[a.Mesh,a.LineSegments],(function(t){var n=Ys(t,e,Nn.LAYERS.COLOR_FROM_POSITION);t.parent.add(n)}))}}(),createShadowmapMaterial:function(){var e={colorFromDepth:!0,orthoCam:!0,lights:!1,shadowmap:!1,fog:!1};return function(t,n){n instanceof Oi&&Zs(t,[a.Mesh,a.LineSegments],(function(t){if(!t.receiveShadow&&t.material.shadowmap&&t.material.setValues({shadowmap:!1}),t.material.lights&&t.castShadow&&Nn.belongToSelectLayers(t)){var n=Ys(t,e,Nn.LAYERS.SHADOWMAP);n.isShadowmapMesh=!0,t.parent.add(n)}}))}}(),removeShadowmapMaterial:function(e,t){t instanceof Oi&&Zs(e,[a.Mesh,a.LineSegments],(function(e){e.isShadowmapMesh&&e.parent.remove(e)}))},forEachMeshInGroup:$s,countTriangles:function(e){var t=0;return $s(e,(function(e){t+=function(e){var t=e.geometry;if(t instanceof a.InstancedBufferGeometry){var n=t.attributes;for(var r in n)if(n.hasOwnProperty(r)&&n[r]instanceof a.InstancedBufferAttribute){var i=n[r];return(t.index?t.index.array.length/3:0)*i.array.length/i.itemSize}return 0}return t instanceof a.BufferGeometry?t.index?t.index.array.length/3:0:t.faces?t.faces.length:0}(e)})),t}},Ks=yn.selectors,Qs=function(){function e(t,n,r,i){g(this,e);var o={clipPlane:ie.now.draft.clipPlane,fogTransparent:ie.now.bg.transparent,shadowmap:ie.now.shadow.on,shadowmapType:ie.now.shadow.type};this.index=t,this.mode=n,this.colorer=r,this.selector=i,this.selectorString="",this.count=0,this.material=new Oi,this.material.setValues(o),this.material.setUberOptions({fogAlpha:ie.now.fogAlpha}),this.materialPreset=Xs.first,this.needsRebuild=!0,this.visible=!0,this.setMode(n)}return _(e,[{key:"markAtoms",value:function(e){return this.count=e.markAtoms(this.selector,1<<this.index),this.needsRebuild=!0,this.count}},{key:"unmarkAtoms",value:function(e){e.clearAtomBits(1<<this.index),this.count=0}},{key:"setMode",value:function(e){this.mode=e}},{key:"setMaterialPreset",value:function(e){this.materialPreset=e,this.material.setUberOptions(e.uberOptions),this.material.setValues(e.values)}},{key:"reset",value:function(){this.geo=null,this.selectionGeo=null}},{key:"buildGeometry",value:function(e){return this.reset(),this.needsRebuild=!1,ie.now.ao&&this.material.setValues({normalsToGBuffer:ie.now.ao}),this.geo=this.mode.buildGeometry(e,this.colorer,1<<this.index,this.material),this.material.uberOptions.opacity<.99&&"prepass"===ie.now.transparency&&Js.processTransparentMaterial(this.geo,this.material),this.geo.visible=this.visible,Nn.processObjRenderOrder(this.geo,this.materialPreset.id),Js.processColFromPosMaterial(this.geo,this.material),ie.now.shadow.on&&Js.createShadowmapMaterial(this.geo,this.material),this.geo}},{key:"buildSelectionGeometry",value:function(e){var t=null;if(this.geo&&"getSubset"in this.geo){var n=this.geo.getSubset(e);if(n&&n.length>0){(t=new a.Group).matrixAutoUpdate=!1,t.matrix=this.geo.matrix;for(var r=0;r<n.length;r++){var i=n[r];t.add(i)}}}return t&&(t.visible=this.visible),this.selectionGeo=t,this.selectionGeo}},{key:"compare",value:function(e){var t={},n=String(this.selector);e&&n.valueOf()===String(e.selector).valueOf()||(t.selector=n);var r=this.mode.identify();e&&!Array.isArray(r)&&r===e.mode||(t.mode=r);var i=this.colorer.identify();return e&&!Array.isArray(i)&&i===e.colorer||(t.colorer=i),e&&this.materialPreset.id===e.material||(t.material=this.materialPreset.id),t}},{key:"change",value:function(e,t,n,r){var i={};if(e.selector){var a=Ks.parse(e.selector).selector,s=String(a);this.selectorString!==s&&(i.selector=s,this.selectorString=s,this.selector=a,this.markAtoms(t))}if(e.mode){var l=e.mode;o.default.isEqual(this.mode.identify(),l)||(i.mode=l,this.setMode(n))}if(e.colorer){var c=e.colorer;o.default.isEqual(this.colorer.identify(),c)||(i.colorer=c,this.colorer=r)}if(e.material){var u=e.material;o.default.isEqual(this.materialPreset.id,u)||(i.material=u,this.setMaterialPreset(Xs.get(e.material)))}return i}},{key:"show",value:function(e){this.visible=e,this.geo&&(this.geo.visible=e),this.selectionGeo&&(this.selectionGeo.visible=e)}}]),e}();function el(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function tl(){}var nl={ComponentEditor:function(e){T(n,e);var t=el(n);function n(e){var r;return g(this,n),(r=t.call(this))._complexVisual=e,r._inProgress=!1,r}return _(n,[{key:"begin",value:function(){var e=this._complexVisual.getComplex();this._componentTransforms=[];for(var t=0;t<e._components.length;++t){var n=e._components[t];this._componentTransforms[n._index]=new a.Object3D}return this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){for(var e=this._complexVisual.getComplex(),t=0;t<e._components.length;++t)this._bakeComponentTransform(e._components[t]);e.onAtomPositionChanged(),this._resetComponentTransform(),this._complexVisual.finalizeEdit()}}},{key:"discard",value:function(){this._inProgress&&(this._resetComponentTransform(),this._complexVisual.finalizeEdit())}},{key:"getAltObj",value:function(){var e={objects:[],pivot:new a.Vector3(0,0,0)},t=this._complexVisual,n=t.getSelectedComponent();if(null===n)return e;var r,i,o,s,l=this._complexVisual.getSelectionGeo(),c=1<<t.getSelectionBit();for(function e(t,n,r){var i=t.children;if(i)for(var o=0,a=i.length;o<a;++o){var s=i[o];s._component===n&&r(s),s instanceof Nn.RCGroup&&e(s,n,r)}}(t,n,(function(t){e.objects.push(t)})),r=0;r<l.children.length;++r)for(o=l.children[r],i=0;i<o.children.length;++i)(s=o.children[i]).hasOwnProperty("_component")&&s._component===n&&e.objects.push(s);e.objects.push(this._componentTransforms[n._index]);var u=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new a.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n.forEachResidue((function(e){var t=e._atoms;for(i=0;i<t.length;++i)t[i].mask&c&&(u.min(t[i].position),h.max(t[i].position))})),e.pivot.lerpVectors(u,h,.5),e}},{key:"_bakeComponentTransform",value:function(e){var t=this._componentTransforms[e._index];!t||0===t.position.x&&0===t.position.y&&0===t.position.z&&0===t.quaternion.x&&0===t.quaternion.y&&0===t.quaternion.z&&1===t.quaternion.w||(t.updateMatrix(),e.forEachResidue((function(e){for(var n=e._atoms,r=0;r<n.length;++r)n[r].position.applyMatrix4(t.matrix)})))}},{key:"_resetComponentTransform",value:function(){var e,t,n,r,i=this._complexVisual,o=this._complexVisual.getSelectionGeo();for(e=0;e<this._componentTransforms.length;++e)(r=this._componentTransforms[e]).position.set(0,0,0),r.quaternion.set(0,0,0,1);for(e=0;e<i.children.length;++e)for(n=i.children[e],t=0;t<n.children.length;++t)(r=n.children[t]).hasOwnProperty("_component")&&(r.position.set(0,0,0),r.quaternion.set(0,0,0,1));for(e=0;e<o.children.length;++e)for(n=o.children[e],t=0;t<n.children.length;++t)(r=n.children[t]).hasOwnProperty("_component")&&(r.position.set(0,0,0),r.quaternion.set(0,0,0,1))}}]),n}(tl),FragmentEditor:function(e){T(n,e);var t=el(n);function n(e){var r;return g(this,n),(r=t.call(this))._complexVisual=e,r._inProgress=!1,r}return _(n,[{key:"begin",value:function(){var e=this._complexVisual,t=this._complexVisual.getSelectionGeo(),n=this._getSelectionBorderAtoms();if(n.length<1||n.length>2)return F.error("Can only edit fragments with one or two bound atoms."),!1;this._fragmentBoundAtoms=n;var r=1<<e.getSelectionBit();e.disableSubset(r,!0);for(var i=0;i<t.children.length;++i)t.children[i].visible=!1;var o=n[0].position.clone();2===n.length&&o.lerp(n[1].position,.5),this._fragmentGeo=new a.Group,e.add(this._fragmentGeo),this._fragmentGeo.position.copy(o),this._fragmentSelectionGeo=new a.Group,t.add(this._fragmentSelectionGeo),this._fragmentSelectionGeo.position.copy(o);var s=o.clone();s.negate();for(var l=0;l<e.children.length;++l){var c=e.children[l];if("getSubset"in c){var u=new a.Group;this._fragmentGeo.add(u);var h=new a.Group;this._fragmentSelectionGeo.add(h);for(var f=c.getSubset(r,!0),d=0;d<f.length;d++){var p=f[d];u.add(p),p.position.copy(s)}for(var m=c.getSubset(r,!0),v=0;v<m.length;v++){var g=m[v];h.add(g),g.position.copy(s)}}}return Nn.applySelectionMaterial(this._fragmentSelectionGeo),this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){var e=this._complexVisual,t=e.getSelectionBit(),n=this._fragmentGeo.position,r=this._fragmentGeo.matrix.clone();r.multiply((new a.Matrix4).makeTranslation(-n.x,-n.y,-n.z)),this._bakeAtomTransform(r,1<<t),e.enableSubset(1<<t,!0),e.getComplex().onAtomPositionChanged(),e.finalizeEdit()}}},{key:"discard",value:function(){if(this._inProgress){var e=this._complexVisual,t=this._complexVisual.getSelectionGeo();this._fragmentGeo.parent.remove(this._fragmentGeo),e.enableSubset(1<<e.getSelectionBit(),!0);for(var n=0;n<t.children.length;++n){var r=t.children[n];r.visible?t.remove(r):r.visible=!0}e.finalizeEdit()}}},{key:"isFreeRotationAllowed",value:function(){return this._fragmentBoundAtoms.length<2}},{key:"getAltObj",value:function(){var e={objects:[],pivot:new a.Vector3(0,0,0)};e.objects.push(this._fragmentGeo,this._fragmentSelectionGeo);var t=this._fragmentBoundAtoms;if(1===t.length){if(1===t[0].bonds.length){var n=t[0].bonds[0];e.axis=(new a.Vector3).subVectors(n._right.position,n._left.position),e.axis.normalize(),e.axis.transformDirection(this._complexVisual.matrixWorld)}}else 2===t.length&&(e.axis=(new a.Vector3).subVectors(t[1].position,t[0].position),e.axis.normalize(),e.axis.transformDirection(this._complexVisual.matrixWorld));return e}},{key:"_getSelectionBorderAtoms",value:function(){var e=this._complexVisual.getComplex(),t=1<<this._complexVisual.getSelectionBit(),n={};e.forEachBond((function(e){e._left.mask&t?0==(e._right.mask&t)&&(n[e._left.index]=1):e._right.mask&t&&(n[e._right.index]=1)}));for(var r=[],i=Object.keys(n),o=0,a=i.length;o<a;++o){var s=i[o];r.push(e._atoms[s])}return r}},{key:"_bakeAtomTransform",value:function(e,t){this._complexVisual.getComplex().forEachAtom((function(n){n.mask&t&&n.position.applyMatrix4(e)}))}}]),n}(tl)};function rl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var il=yn.selectors;function ol(e,t){Array.isArray(t)||(t=[t]);var n=c(t,2),r=n[0],i=n[1];return new(e.get(r)||e.first)(i)}var al=function(e){T(n,e);var t=rl(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._complex=r,i._reprList=[],i._repr=null,i._reprListChanged=!0,i._selectionBit=0,i._reprUsedBits=0,i._selectionCount=0,i._selectionGeometry=new a.Group,i}return _(n,[{key:"getBoundaries",value:function(){return this._complex.getBoundaries()}},{key:"release",value:function(){this._selectionGeometry.parent&&this._selectionGeometry.remove(this._selectionGeometry),Bn.prototype.release.call(this)}},{key:"getComplex",value:function(){return this._complex}},{key:"getSelectionCount",value:function(){return this._selectionCount}},{key:"getSelectionGeo",value:function(){return this._selectionGeometry}},{key:"getSelectionBit",value:function(){return this._selectionBit}},{key:"getEditor",value:function(){return this._editor}},{key:"resetReps",value:function(e){this._complex&&this._complex.clearAtomBits(-1),this._reprListChanged=!0,this._reprUsedBits=0,this._reprList.length=e.length;for(var t=0,n=e.length;t<n;++t){var r=e[t],i=void 0,o=void 0;"string"==typeof r.selector?(o=r.selector,i=il.parse(o).selector):void 0===r.selector?(o=ie.now.presets.default[0].selector,i=il.parse(o).selector):o=(i=r.selector).toString();var a=ol(Ka,r.mode),s=ol(js,r.colorer),l=Xs.get(r.material)||Xs.first;this._reprList[t]=new Qs(t,a,s,i),this._reprList[t].setMaterialPreset(l),this._reprList[t].selectorString=o,this._complex&&this._complex.markAtoms(i,1<<t),this._reprUsedBits|=1<<t}this._repr=e.length>0?this._reprList[0]:null,this._selectionBit=e.length,this._reprUsedBits|=1<<this._selectionBit,this._selectionCount=0,this._complex&&this._complex.update()}},{key:"repCount",value:function(){return this._reprList.length}},{key:"repCurrent",value:function(e){return e>=0&&e<this._reprList.length?this._repr=this._reprList[e]:e=this._reprList.indexOf(this._repr),e}},{key:"rep",value:function(e,t){if(!t&&(void 0===e||e instanceof Object)&&(t=e,e=this.repCurrent()),e<0||e>this._reprList.length)return F.error("Rep ".concat(e," does not exist!")),null;if(e===this._reprList.length){var n=this.repAdd(t);return F.warn("Rep ".concat(e," does not exist! New representation was created.")),{desc:n.desc,index:e,status:"created"}}var r=this._reprList[e],i={selector:r.selectorString,mode:r.mode.identify(),colorer:r.colorer.identify(),material:r.materialPreset.id};if(t){var a=r.change(t,this._complex,ol(Ka,t.mode),ol(js,t.colorer));if(!o.default.isEmpty(a)){for(var s in r.needsRebuild=!0,a)a.hasOwnProperty(s)&&(i[s]=a[s],F.debug("rep[".concat(e,"].").concat(s," changed to ").concat(a[s])));return a.mode&&r.mode.isSurface&&("ultra"===ie.now.resolution||"high"===ie.now.resolution)&&(F.report('Surface resolution was changed to "medium" to avoid hang-ups.'),ie.set("resolution","medium")),{desc:i,index:e,status:"changed"}}}return{desc:i,index:e,status:""}}},{key:"repGet",value:function(e){return(void 0===e||e instanceof Object)&&(e=this.repCurrent()),e<0||e>=this._reprList.length?null:this._reprList[e]}},{key:"_getFreeReprIdx",value:function(){for(var e=this._reprUsedBits,t=0;t<=n.NUM_REPRESENTATION_BITS;++t,e>>=1)if(0==(1&e))return t;return-1}},{key:"repAdd",value:function(e){if(this._reprList.length>=n.NUM_REPRESENTATION_BITS)return null;var t=this._getFreeReprIdx();if(t<0)return null;var r=this.buildSelectorFromMask(1<<this._selectionBit),i=ie.now.presets.default[0],a=o.default.merge({selector:i.selector,mode:i.mode,colorer:i.colorer,material:i.material},e),s="string"==typeof a.selector?il.parse(a.selector).selector:a.selector,l=new Qs(this._selectionBit,ol(Ka,a.mode),ol(js,a.colorer),s);return l.selectorString=s.toString(),l.setMaterialPreset(Xs.get(a.material)),l.markAtoms(this._complex),this._reprList.push(l),this._selectionBit=t,this._reprUsedBits|=1<<this._selectionBit,this._complex.markAtoms(r,1<<this._selectionBit),{desc:a,index:this._reprList.length-1}}},{key:"repRemove",value:function(e){void 0===e&&(e=this.repCurrent());var t=this._reprList.length;if(!(e<0||e>=t||t<=1)){var n=this._reprList[e];n.unmarkAtoms(this._complex),this._reprUsedBits&=~(1<<n.index),this._reprList.splice(e,1),n===this._repr&&(e=e<--t?e:t-1,this._repr=this._reprList[e]),this._reprListChanged=!0}}},{key:"repHide",value:function(e,t){void 0===t&&(t=!0),e<0||e>=this._reprList.length||this._reprList[e].show(!t)}},{key:"select",value:function(e,t){t?this._selectionCount+=this._complex.markAtomsAdditionally(e,1<<this._selectionBit):this._selectionCount=this._complex.markAtoms(e,1<<this._selectionBit),this._complex.updateStructuresMask(),this.rebuildSelectionGeometry()}},{key:"resetSelectionMask",value:function(){0!==this._selectionCount&&(this._selectionCount=0,this._complex&&this._complex.clearAtomBits(1<<this._selectionBit))}},{key:"updateSelectionMask",value:function(e){var t=this,n=e.atom,r=e.residue,i=e.chain,o=e.molecule,a=1<<this._selectionBit,s=~a;if(n)r=n.residue,i=r._chain,o=r._molecule,n.mask&a?(n.mask&=s,r._mask&=s,i._mask&=s,o&&(o.mask&=s),this._selectionCount--):(n.mask|=a,this._selectionCount++,r.collectMask(),i.collectMask(),o&&o.collectMask());else if(r)i=r._chain,o=r._molecule,r._mask&a?(r._mask&=s,i._mask&=s,r.forEachAtom((function(e){e.mask&a&&(e.mask&=s,t._selectionCount--)}))):(r._mask|=a,r.forEachAtom((function(e){e.mask&a||(e.mask|=a,t._selectionCount++)})),i.collectMask(),o&&o.collectMask());else if(i||o){var l=i||o;l._mask&a?(l._mask&=s,l.forEachResidue((function(e){e._mask&a&&(e._mask&=s,e.forEachAtom((function(e){e.mask&a&&(e.mask&=s,t._selectionCount--)})),e._mask&=s)}))):(l._mask|=a,l.forEachResidue((function(e){if(!(e._mask&a)){e._mask|=a,e.forEachAtom((function(e){e.mask&a||(e.mask|=a,t._selectionCount++)}));var n=i?e.getMolecule():e.getChain();n&&n.collectMask()}})))}else this.resetSelectionMask()}},{key:"expandSelection",value:function(){var e=this,t=1<<this._selectionBit;this._complex.forEachBond((function(e){e._left.mask&t?0==(e._right.mask&t)&&(e._right.mask|=1<<31):e._right.mask&t&&(e._left.mask|=1<<31)})),this._complex.forEachAtom((function(n){n.mask&1<<31&&(n.mask=n.mask&~(1<<31)|t,++e._selectionCount)})),this._complex.updateStructuresMask()}},{key:"shrinkSelection",value:function(){var e=this,t=1<<this._selectionBit;this._complex.forEachBond((function(e){e._left.mask&t?0==(e._right.mask&t)&&(e._left.mask|=1<<31):e._right.mask&t&&(e._right.mask|=1<<31)})),this._complex.forEachAtom((function(e){e.mask&t&&1===e.bonds.length&&(e.mask|=1<<31)}));var n=~(t|1<<31);this._complex.forEachAtom((function(t){t.mask&1<<31&&(t.mask&=n,--e._selectionCount)})),this._complex.updateStructuresMask()}},{key:"getSelectedComponent",value:function(){var e=1<<this._selectionBit,t=null,n=!1;return this._complex.forEachAtom((function(r){r.mask&e&&(null===t?t=r.residue._component:t!==r.residue._component&&(n=!0))})),n?null:t}},{key:"getSelectionCenter",value:function(e,t,n){e.set(0,0,0);var r=0;return this._complex.forEachAtom((function(i){t(i,n)&&(e.add(i.position),r++)})),0!==r&&(e.divideScalar(r),e.applyMatrix4(this.matrix),!0)}},{key:"needsRebuild",value:function(){if(this._reprListChanged)return!0;for(var e=this._reprList,t=0,n=e.length;t<n;++t)if(e[t].needsRebuild)return!0;return!1}},{key:"rebuild",value:function(){var e=this;return Nn.clearTree(this),new Promise((function(t){var n=e._complex;if(n){var r=!1;setTimeout((function(){console.time("build");for(var i=e._reprList,o=vs.get(ie.now.palette)||vs.first,a=!1,s=0,l=i.length;s<l;++s){var c=i[s];if(c.colorer.palette=o,c.needsRebuild){c.reset();try{c.buildGeometry(n)}catch(e){if(!(e instanceof Q.OutOfMemoryError))throw e;c.needsRebuild=!1,c.reset(),F.error("Not enough memory to build geometry for representation ".concat(c.index+1)),r=!0}}a=r||a||Nn.groupHasGeometryToRender(c.geo),c.geo&&e.add(c.geo)}e._reprListChanged=!1,console.timeEnd("build"),t()}),10)}else t()}))}},{key:"setNeedsRebuild",value:function(){for(var e=this._reprList,t=0,n=e.length;t<n;++t)e[t].needsRebuild=!0}},{key:"rebuildSelectionGeometry",value:function(){var e=1<<this._selectionBit;Nn.clearTree(this._selectionGeometry);for(var t=0,n=this._reprList.length;t<n;++t){var r=this._reprList[t].buildSelectionGeometry(e);if(r){this._selectionGeometry.add(r);for(var i=0;i<r.children.length;i++){var o=r.children[i];if(this._editor&&this._editor._componentTransforms){var a=this._editor._componentTransforms[o._component._index];a&&(o.position.copy(a.position),o.quaternion.copy(a.quaternion))}}Nn.applySelectionMaterial(r)}}}},{key:"_buildSelectorFromSortedLists",value:function(e,t,n){var r=this._complex;function i(e){for(var t=[],n=0,r=NaN,i=NaN,o=0,a=e.length;o<a;++o){var s=e[o];s===i+1?i=s:(Number.isNaN(r)||(t[n++]=new il.Range(r,i)),r=i=s)}return Number.isNaN(r)||(t[n]=new il.Range(r,i)),t}var o=null;if(n.length===r._chains.length)o=il.all();else{var a;if(n.length>0&&(a=il.chain(n),o=o?il.or(o,a):a),Object.keys(t).length>0)for(var s in t)t.hasOwnProperty(s)&&(a=il.and(il.chain(s),il.residx(i(t[s]))),o=o?il.or(o,a):a);e.length>0&&(a=il.serial(i(e)),o=o?il.or(o,a):a),o||(o=il.none())}return o}},{key:"buildSelectorFromMask",value:function(e){var t=this._complex,n=[],r={},i=[];return t.forEachChain((function(t){t._mask&e&&n.push(t._name)})),t.forEachResidue((function(t){if(t._mask&e&&!(t._chain._mask&e)){var n=t._chain._name;n in r?r[n].push(t._index):r[n]=[t._index]}})),t.forEachAtom((function(t){t.mask&e&&!(t.residue._mask&e)&&i.push(t.serial)})),this._buildSelectorFromSortedLists(i,r,n)}},{key:"forSelectedResidues",value:function(e){var t=1<<this._selectionBit;this._complex.forEachResidue((function(n){n._mask&t&&e(n)}))}},{key:"beginComponentEdit",value:function(){if(this._editor)return null;var e=new nl.ComponentEditor(this);return e.begin()?(this._editor=e,e):null}},{key:"beginFragmentEdit",value:function(){if(this._editor)return null;var e=new nl.FragmentEditor(this);return e.begin()?(this._editor=e,e):null}},{key:"finalizeEdit",value:function(){this._editor=null}},{key:"setMaterialValues",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=0,i=this._reprList.length;r<i;++r){var o=this._reprList[r];o.material.setValues(e),t&&o.geo.traverse((function(t){t instanceof a.Mesh&&(t.material.setValues(e),void 0!==n&&n(t),t.material.needsUpdate=!0)}))}}},{key:"setUberOptions",value:function(e){for(var t=0,n=this._reprList.length;t<n;++t)this._reprList[t].material.setUberOptions(e)}},{key:"within",value:function(e,t){var n=this._complex.getVoxelWorld();if(null===n)return!1;var r=1<<this._selectionBit;return this._complex.markAtoms(e,r),n&&n.forEachAtomWithinDistFromMasked(this._complex,r,Number(t),(function(e){e.mask|=r})),this._selectionCount=this._complex.countAtomsByMask(r),this._complex.updateStructuresMask(),this.buildSelectorFromMask(r)}}]),n}(Bn);function sl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}al.NUM_REPRESENTATION_BITS=30;var ll=a.UniformsUtils.merge([{volumeDim:{type:"v3",value:new a.Vector3(512,512,512)},tileTex:{type:"t",value:null},tileTexSize:{type:"v2",value:new a.Vector2(512,512)},tileStride:{type:"v2",value:new a.Vector2(512,512)},boxAngles:{type:"v3",value:new a.Vector3(1,1,1)},delta:{type:"v3",value:new a.Vector3(0,0,0)},_isoLevel0:{type:"v2",value:new a.Vector3(.5,.75,1)},_flipV:{type:"f",value:0},_BFLeft:{type:"t",value:null},_BFRight:{type:"t",value:null},_FFLeft:{type:"t",value:null},_FFRight:{type:"t",value:null},_WFFLeft:{type:"t",value:null},_WFFRight:{type:"t",value:null}}]);function cl(e,t){var n=a.UniformsUtils.clone(t);for(var r in e)n.hasOwnProperty(r)&&(n[r].value=e[r]);return n}function ul(e,t){return{uniforms:cl(e,{}),vertexShader:"varying vec3 pos;\r\n\r\nvoid main() {\r\n  // we're assuming local position is in [-0.5, 0.5]\r\n  // we need to offset it to be represented in RGB\r\n  pos = position.xyz + 0.5;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",fragmentShader:"varying vec3 pos;\r\n\r\nvoid main() {\r\n  gl_FragColor = vec4(pos, 0.5);\r\n}",transparent:!1,depthTest:!1,depthWrite:!1,side:t}}var hl=function(e){T(n,e);var t=sl(n);function n(e){g(this,n);var r=ul(e,a.BackSide);return t.call(this,r)}return n}(a.ShaderMaterial),fl=function e(t,n,r,i){g(this,e),this.uniforms=cl(t,n),this.vertexShader=r,this.fragmentShader=i,this.transparent=!1,this.depthTest=!1,this.depthWrite=!1,this.side=a.FrontSide},dl={BackFacePosMaterial:hl,BackFacePosMaterialFarPlane:function(e){T(n,e);var t=sl(n);function n(e){g(this,n);var r=a.UniformsUtils.merge([{aspectRatio:{type:"f",value:0},farZ:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},matWorld2Volume:{type:"4fv",value:new a.Matrix4}}]),i=new fl(e,r,"varying vec4 volPos;\r\nuniform float aspectRatio;\r\nuniform float farZ;\r\nuniform float tanHalfFOV;\r\nuniform mat4  matWorld2Volume;\r\n\r\nvoid main() {\r\n  // rescale plane to fill in the whole far plane area seen from camera\r\n  vec3 pos = position.xyz;\r\n  pos.x = pos.x * tanHalfFOV * farZ * aspectRatio;\r\n  pos.y = pos.y * tanHalfFOV * farZ;\r\n  // common transformation\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\r\n  // calc pos in volume CS\r\n  volPos = matWorld2Volume * modelMatrix * vec4(pos, 1.0);\r\n  // we're assuming local position is in [-0.5, 0.5]\r\n  // we need to offset it to be represented in RGB\r\n  volPos = volPos + 0.5;\r\n  volPos.w = 0.5;\r\n}\r\n","varying vec4 volPos;\r\n\r\nvoid main() {\r\n  gl_FragColor = volPos;\r\n}");return t.call(this,i)}return n}(a.ShaderMaterial),FrontFacePosMaterial:function(e){T(n,e);var t=sl(n);function n(e){g(this,n);var r=ul(e,a.FrontSide);return t.call(this,r)}return n}(a.ShaderMaterial),VolumeMaterial:function(e){T(n,e);var t=sl(n);function n(e){var r;g(this,n);var i=new fl(e,ll,"varying vec4 screenSpacePos;\r\n\r\nvoid main() {\r\n  screenSpacePos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n  gl_Position = screenSpacePos;\r\n}","uniform mat4 projectionMatrix;\r\n\r\n// 3D volume texture\r\nuniform vec3 volumeDim;    // volume dimensions, pixels\r\nuniform sampler2D tileTex; // tiled texture containing all Z-slices of a 3D data\r\nuniform vec2 tileTexSize;  // size of tiled texture, pixels\r\nuniform vec2 tileStride;   // UV stride between slices in tile tex, pixels\r\n\r\nuniform vec3 boxAngles;//value of angles({x: alpha, y:beta, z:gamma}) types 1 - if angle is obtuse, 0 - if acute\r\nuniform vec3 delta; //Projection box delta's from non-orthogonal origin axes; {x: XY, y : XZ, z: YZ}\r\n\r\nuniform vec3 _isoLevel0;\r\nuniform float _flipV;\r\nuniform sampler2D _BFLeft;\r\nuniform sampler2D _BFRight;\r\nuniform sampler2D _FFLeft;\r\nuniform sampler2D _FFRight;\r\nuniform sampler2D _WFFLeft;\r\nuniform sampler2D _WFFRight;\r\n\r\nvarying vec4 screenSpacePos;\r\n\r\n#define NO_COLOR vec4(0., 0., 0., 0.)\r\n\r\nvec4 sample3DTexture(vec3 texCoord) {\r\n  // a pair of Z slices is determined by nearest slice border\r\n  float zSliceBorder = floor(texCoord.z * volumeDim.z + 0.5);\r\n  float zSliceNumber1 = max(zSliceBorder - 1.0, 0.0);\r\n  float zSliceNumber2 = min(zSliceBorder, volumeDim.z - 1.0);\r\n\r\n  float rowTiles = floor(tileTexSize.x / tileStride.x);\r\n\r\n  // calculate coords in tile texture for both slices\r\n  vec2 tileOffset = vec2(mod(zSliceNumber1, rowTiles), floor(zSliceNumber1 / rowTiles));\r\n  vec2 texCoordSlice1 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r\n  tileOffset = vec2(mod(zSliceNumber2, rowTiles), floor(zSliceNumber2 / rowTiles));\r\n  vec2 texCoordSlice2 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r\n\r\n  // bilinear filtering\r\n  vec4 colorSlice1 = texture2D(tileTex, texCoordSlice1);\r\n  vec4 colorSlice2 = texture2D(tileTex, texCoordSlice2);\r\n  float weightSlice2 = texCoord.z * volumeDim.z - (zSliceNumber1 + 0.5);\r\n  return mix(colorSlice1, colorSlice2, weightSlice2);\r\n}\r\n\r\nvec4 sample3DTextureInclined(vec3 boxCoord) { // delta:{ x: XY, y : XZ, z: YZ }\r\n  vec3 textCoord = boxCoord;\r\n  vec2 currDelta = mix(boxCoord.zz, vec2(1., 1.) - boxCoord.zz, boxAngles.yx) * delta.yz;\r\n\r\n  textCoord.y = (boxCoord.y  - currDelta.y) / (1. - delta.z);\r\n  if (textCoord.y < 0.0 || textCoord.y > 1.0)\r\n    return NO_COLOR;\r\n\r\n  currDelta.x += mix(textCoord.y, 1.0 - textCoord.y, boxAngles.z) * delta.x;\r\n\r\n  textCoord.x = (boxCoord.x - currDelta.x) / (1. - delta.x - delta.y);\r\n  if (textCoord.x < 0.0 || textCoord.x > 1.0)\r\n    return NO_COLOR;\r\n\r\n  return sample3DTexture(textCoord);\r\n}\r\n\r\nfloat CalcColor(vec3 iter, vec3 dir) {\r\n  float d = 1. / 128.;\r\n  vec3 dx = vec3(d, 0.0, 0.0);\r\n  vec3 dy = vec3(0.0, d, 0.0);\r\n  vec3 dz = vec3(0.0, 0.0, d);\r\n\r\n  // #Opt: coordInc.x:(iter + dx).x > 1. ? 0.: sample3DTextureInclined(iter + dx).x,\r\n  vec3 coordInc = mix(\r\n    vec3(\r\n      sample3DTextureInclined(iter + dx).x,\r\n      sample3DTextureInclined(iter + dy).x,\r\n      sample3DTextureInclined(iter + dz).x\r\n    ),\r\n    vec3(0. ,0. , 0.),\r\n    vec3(floor((iter + dx).x), floor((iter + dy).y), floor((iter + dz).z))\r\n  );\r\n\r\n  // #Opt: coordDec.x:(iter - dx).x < 0. ? 0.: sample3DTextureInclined(iter - dx).x,\r\n  vec3 coordDec = mix(\r\n    vec3(0. ,0. , 0.),\r\n    vec3(\r\n      sample3DTextureInclined(iter - dx).x,\r\n      sample3DTextureInclined(iter - dy).x,\r\n      sample3DTextureInclined(iter - dz).x\r\n    ),\r\n    vec3(ceil((iter - dx).x), ceil((iter - dy).y), ceil((iter - dz).z))\r\n  );\r\n\r\n  vec3 N = normalize(coordInc - coordDec);\r\n  float dif = max(0.0, dot(N, dir));\r\n  return dif;\r\n}\r\n\r\nvec3 AccuracyIso(vec3 left, vec3 right, float volLeft, float threshold) {\r\n  for (int i = 0; i < 5; i++) {\r\n    vec3 iterator = 0.5 * (left + right);\r\n    float vol = sample3DTextureInclined(iterator).r;\r\n    if ((volLeft - threshold) * (vol - threshold) < 0.)\r\n      right = iterator;\r\n    else\r\n      left = iterator;\r\n  }\r\n  return 0.5 * (left + right);\r\n}\r\n\r\nvec3 CorrectIso(vec3 left, vec3 right, float tr) {\r\n  for (int j = 0; j < 5; j++) {\r\n    vec3 iterator = 0.5 * (left + right);\r\n    float vol = sample3DTextureInclined(iterator).r;\r\n    if (vol < tr)\r\n      right = iterator;\r\n    else\r\n      left = iterator;\r\n  }\r\n  return 0.5 * (left + right);\r\n}\r\n\r\nvec4 GetIso1(vec3 start, vec3 back, float molDist, vec3 dir, float tr, int count) {\r\n  float vol, stepSize = (float(count) + 2.) / float(STEPS_COUNT);\r\n  vec3 step = stepSize * dir, iterator = start, left, right;\r\n  vec4 acc = NO_COLOR;\r\n\r\n  for (int i = 0; i < STEPS_COUNT; i++) {\r\n    iterator = iterator + step;\r\n    vol = sample3DTextureInclined(iterator).r;\r\n    if (length(iterator - back) <= stepSize || (vol > tr))\r\n      break;\r\n  }\r\n\r\n  if (vol > tr)\r\n    acc = vec4(CorrectIso(iterator, iterator - step, tr).xyz, 1.);\r\n\r\n  return acc;\r\n}\r\n\r\nfloat easeOut(float x0, float x1, float x) {\r\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r\n  return 1.0 - (1.0 - t) * (1.0 - t);\r\n}\r\n\r\nfloat easeIn(float x0, float x1, float x) {\r\n  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r\n  return t * t;\r\n}\r\n\r\nvec3 GetColSimple(float vol) {\r\n  float t = easeOut(_isoLevel0.x, _isoLevel0.y, vol);\r\n  float s = easeIn(_isoLevel0.y, _isoLevel0.z, vol);\r\n  return vec3(0.5, 0.6, 0.7) * (1.0 - t) + 2.0 * vec3(s, 0, 0);\r\n}\r\n\r\nvec4 VolRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  vec4 acc = NO_COLOR, iso;\r\n  vec3 iterator = start, sumColor = vec3(0., 0., 0.);\r\n  float stepSize, alpha, sumAlpha = 0.0, vol, curStepSize, molD;\r\n  vec3 step, col, colOld, right;\r\n  float tr0 = _isoLevel0.x;\r\n  float dif, r, kd, finish;\r\n  int count = 0, stopMol = 0;\r\n\r\n  for (int k = 0; k < 3; k++) {\r\n    stepSize = (float(k) + 2.) / float(STEPS_COUNT);\r\n    kd = 140. * tr0 * stepSize;\r\n    r = 1. - kd;\r\n    step = stepSize * dir;\r\n    iso = GetIso1(iterator, back, molDist, dir, tr0, k);\r\n    if (iso.a < 0.1 || length(iso.xyz - start) > molDist)\r\n      break;\r\n    iterator = iso.xyz;\r\n    dif = 1.;// CalcColor(iterator, dir);\r\n    colOld = GetColSimple(tr0);\r\n    curStepSize = stepSize;\r\n    for (int i = 0; i < STEPS_COUNT; i++) {\r\n      iterator = iterator + step;\r\n      molD = length(iterator - start);\r\n      vol = sample3DTextureInclined(iterator).r;\r\n      finish = distance(iterator, back) - stepSize;\r\n      if (finish < 0.0 || vol < tr0 || (sumAlpha > 0.97) || molD > molDist)\r\n        break;\r\n      alpha = (1. - r);\r\n      col = GetColSimple(vol);\r\n      vol = sample3DTextureInclined(iterator - 0.5 * step).r;\r\n      vec3 colMid = GetColSimple(vol);\r\n      sumColor += (1. - sumAlpha) * (colOld + 4.* colMid + col) * alpha / 6.;\r\n      sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r\n      colOld = col;\r\n    } // for i\r\n\r\n    if (finish < 0.0 || sumAlpha > 0.97)\r\n      break;\r\n\r\n    if (molD > molDist) {\r\n      curStepSize = stepSize - (molD - molDist);\r\n      right = iterator - (molD - molDist) * dir;\r\n      vol = sample3DTextureInclined(right).r;\r\n    } else {\r\n      vec3 left = iterator - step;\r\n      right = CorrectIso(left, iterator, tr0);\r\n      curStepSize = distance(left, right);\r\n      vol = tr0;\r\n    }\r\n\r\n    alpha = (1. - r) * curStepSize / stepSize;\r\n    dif = 1.;// CalcColor(right, dir);\r\n    col = GetColSimple(vol);\r\n    vol = sample3DTextureInclined(iterator - 0.5 * curStepSize / stepSize * step).r;\r\n    vec3 colMid = GetColSimple(vol);\r\n    sumColor += (1. - sumAlpha) * (colOld + 4. * colMid + col) * alpha / 6.;\r\n    sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r\n\r\n    if (molD > molDist)\r\n      break;\r\n  } // for k\r\n  acc.rgb = 1. * sumColor / sumAlpha;\r\n  acc.a = sumAlpha;\r\n  return acc;\r\n}\r\n\r\nvec4 VolRender1(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  float stepSize = 1.0 / float(STEPS_COUNT);\r\n  float len = length(back - start);\r\n  vec3 step = stepSize * dir;\r\n  vec3 iterator = start;\r\n  float acc = 0.0;\r\n\r\n  for (int i = 0; i < STEPS_COUNT; i++) {\r\n    if (float(i) * stepSize > len)\r\n      break;\r\n    iterator = iterator + step;\r\n    if (sample3DTextureInclined(iterator).r > _isoLevel0.x)\r\n      acc += 10. * sample3DTextureInclined(iterator).r / float(STEPS_COUNT);\r\n  }\r\n\r\n  return vec4(1.,1.,1., acc);\r\n}\r\n\r\nvec4 IsoRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  vec4 tst = GetIso1(start, back, 2., dir, _isoLevel0.x, 0);\r\n  vec4 col = NO_COLOR;\r\n\r\n  if (length(tst.xyz - start) < molDist && tst.a > 0.1) {\r\n    float dif =  CalcColor(tst.xyz, dir);\r\n    dif = 0.9 * dif * dif;\r\n    col = vec4(dif, dif, dif, 1);\r\n  }\r\n  return col;\r\n}\r\n\r\nvec4 VolRender2(vec3 start, vec3 back, float molDist, vec3 dir) {\r\n  return sample3DTexture(start);\r\n}\r\n\r\nvoid main() {\r\n  vec3 tc = screenSpacePos.xyz / screenSpacePos.w * 0.5 + 0.5;\r\n\r\n  if (_flipV > 0.0) {\r\n    tc.y = 1.0 - tc.y;\r\n  }\r\n\r\n  vec3 start;\r\n  vec3 back;\r\n  vec3 molBack;\r\n  if (projectionMatrix[0][2] < 0.0) {\r\n    start = texture2D(_FFLeft, tc.xy).xyz;\r\n    back = texture2D(_BFLeft, tc.xy).xyz;\r\n    molBack = texture2D(_WFFLeft, tc.xy).xyz;\r\n  } else {\r\n    start = texture2D(_FFRight, tc.xy).xyz;\r\n    back = texture2D(_BFRight, tc.xy).xyz;\r\n    molBack = texture2D(_WFFRight, tc.xy).xyz;\r\n  }\r\n\r\n  vec3 dir = normalize(back - start);\r\n\r\n  float molDist = 2.0;\r\n  if (length(molBack) > 0.001) {\r\n    molDist = distance(start, molBack);\r\n  }\r\n\r\n  #ifdef ISO_MODE\r\n    gl_FragColor = IsoRender(start, back, molDist, dir);\r\n  #else\r\n    gl_FragColor = VolRender(start, back, molDist, dir);\r\n  #endif\r\n}\r\n");return i.transparent=!0,i.depthTest=!0,(r=t.call(this,i)).updateDefines(),r}return _(n,[{key:"updateDefines",value:function(){this.defines={ISO_MODE:ie.now.modes.VD.isoMode,STEPS_COUNT:100*ie.now.modes.VD.polyComplexity[ie.now.resolution]},this.needsUpdate=!0}}]),n}(a.ShaderMaterial)};function pl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ml=function(e){T(n,e);var t=pl(n);function n(){var e;g(this,n);var r=new a.BufferGeometry;Ee(C(e=t.call(this,r)),"volumeInfo",{}),e.clipPlane=new a.Plane;var i=new a.Vector3(.5,.5,.5);return e.size=i,e.cullFlag=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1],e.faces=[{indices:[],norm:new a.Vector3(0,0,-1)},{indices:[],norm:new a.Vector3(0,0,1)},{indices:[],norm:new a.Vector3(0,-1,0)},{indices:[],norm:new a.Vector3(0,1,0)},{indices:[],norm:new a.Vector3(-1,0,0)},{indices:[],norm:new a.Vector3(1,0,0)},{indices:[],norm:new a.Vector3(0,0,0)}],e.vertices=[new a.Vector3(-i.x,-i.y,-i.z),new a.Vector3(-i.x,i.y,-i.z),new a.Vector3(i.x,-i.y,-i.z),new a.Vector3(i.x,i.y,-i.z),new a.Vector3(-i.x,-i.y,i.z),new a.Vector3(-i.x,i.y,i.z),new a.Vector3(i.x,-i.y,i.z),new a.Vector3(i.x,i.y,i.z),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0)],r.setAttribute("position",new a.BufferAttribute(new Float32Array(3*e.vertices.length),3)),e.name="VolumeMesh",e}return _(n,[{key:"_updateVertices",value:function(){var e,t=n._corners,r=n._edges,i=n._edgeIntersections,o=this.clipPlane.normal,s=this.clipPlane.constant,l=this.vertices,c=this.size,u=[0,0,0,0,0,0,0,0],h=[1,1,1,1,1,1,1,1,1,1,1,1],f=new a.Vector3,d=null;function p(){if(0===o.x)return 0;var e=-(o.dot(f)+s)/o.x;return-c.x<=e&&e<=c.x?(d.set(e,f.y,f.z),e===c.x?2:e===-c.x?-2:1):0}function m(){if(0===o.y)return 0;var e=-(o.dot(f)+s)/o.y;return-c.y<=e&&e<=c.y?(d.set(f.x,e,f.z),e===c.y?2:e===-c.y?-2:1):0}function v(){if(0===o.z)return 0;var e=-(o.dot(f)+s)/o.z;return-c.z<=e&&e<=c.z?(d.set(f.x,f.y,e),e===c.z?2:e===-c.z?-2:1):0}for(var g=0;g<12;++g){var y=r[g];d=i[g],f.set(y[2],y[3],y[4]),f.multiply(c);var _=0;0===y[2]&&(_=p()),0===y[3]&&(_=m()),0===y[4]&&(_=v()),-2===_?u[y[0]]=1:2===_?u[y[1]]=1:0===_&&(h[g]=0)}var x={indices:[],norm:o.clone().negate()},b=8;for(e=0;e<8;++e)1===u[e]&&(l[b].set(t[e][0],t[e][1],t[e][2]).multiply(c),x.indices.push(b++),h[t[e][3]]=0,h[t[e][4]]=0,h[t[e][5]]=0);for(e=0;e<12;++e)1===h[e]&&(l[b].copy(i[e]),x.indices.push(b++));this.faces[6]=x;var w=new a.Vector3,S=new a.Vector3;for(this.clipPlane.coplanarPoint(S),e=0;e<l.length;++e)this.cullFlag[e]=!1,e<8?(w.subVectors(l[e],S),this.cullFlag[e]=o.dot(w)>=0):e<8+x.indices.length&&(this.cullFlag[e]=!0);var M=this.geometry.getAttribute("position"),E=0;for(e=0;e<l.length;++e)M.array[E++]=l[e].x,M.array[E++]=l[e].y,M.array[E++]=l[e].z;M.needsUpdate=!0}},{key:"_collectVertices",value:function(e,t){var n,r=this.vertices;for(e.indices=[],n=0;n<r.length;++n)this.cullFlag[n]&&t(r[n])&&e.indices.push(n)}},{key:"_sortIndices",value:function(e,t){var n,r,i=this.vertices,o=[],s=new a.Vector3;for(n=1;n<e.indices.length;++n)s.subVectors(i[e.indices[n]],i[e.indices[0]]),s.normalize(),s.cross(t),s.negate(),o[n]=e.norm.dot(s);for(n=1;n<e.indices.length-1;++n)for(r=n+1;r<e.indices.length;++r)if(o[r]<o[n]){var l=o[n];o[n]=o[r],o[r]=l,l=e.indices[n],e.indices[n]=e.indices[r],e.indices[r]=l}}},{key:"_updateIndices",value:function(){var e,t,n,r=this.vertices,i=this.size;this._collectVertices(this.faces[0],(function(e){return e.z===-i.z})),this._collectVertices(this.faces[1],(function(e){return e.z===i.z})),this._collectVertices(this.faces[2],(function(e){return e.y===-i.y})),this._collectVertices(this.faces[3],(function(e){return e.y===i.y})),this._collectVertices(this.faces[4],(function(e){return e.x===-i.x})),this._collectVertices(this.faces[5],(function(e){return e.x===i.x}));var o=new a.Vector3,s=new a.Vector3,l=new a.Vector3;for(t=0;t<this.faces.length;++t)if(0!==(n=this.faces[t]).indices.length){for(o.set(0,0,0),e=0;e<n.indices.length;++e)o.add(r[n.indices[e]]);o.multiplyScalar(1/n.indices.length),s.subVectors(r[n.indices[0]],o),s.normalize();var u=[];for(e=0;e<n.indices.length;++e)l.subVectors(r[n.indices[e]],o),u[e]=l.dot(s);for(e=1;e<n.indices.length;++e)if(u[e]<u[0]){var h=u[0];u[0]=u[e],u[e]=h,h=c(n.indices,1)[0],n.indices[0]=n.indices[e],n.indices[e]=h}this._sortIndices(n,s)}var f=0;for(t=0;t<this.faces.length;++t)(n=this.faces[t]).indices.length>=3&&(f+=3*(n.indices.length-2));var d=0,p=new Uint16Array(f);for(t=0;t<this.faces.length;++t)for(n=this.faces[t],e=0;e<n.indices.length-2;++e)p[d]=n.indices[0],p[d+1]=n.indices[e+1],p[d+2]=n.indices[e+2],d+=3;this.geometry.setIndex(new a.BufferAttribute(p,1))}},{key:"setDataSource",value:function(e){var t=new dl.VolumeMaterial,n=e.getDimensions(),r=e.getTiledTextureStride(),i=e.buildTiledTexture(),o=e.getBox();t.uniforms.volumeDim.value.set(n[0],n[1],n[2]),t.uniforms.tileTex.value=i,t.uniforms.tileTexSize.value.set(i.image.width,i.image.height),t.uniforms.tileStride.value.set(r[0],r[1]),Object.assign(this.volumeInfo,e.getVolumeInfo());var a=this.volumeInfo;t.uniforms.delta.value.copy(a.delta),t.uniforms.boxAngles.value.set(a.obtuseAngle[0],a.obtuseAngle[1],a.obtuseAngle[2]),this.material=t,o.getSize(this.scale),o.getCenter(this.position)}},{key:"_updateIsoLevel",value:function(){var e=ie.now.modes.VD,t=e.kSigma,n=e.kSigmaMed,r=e.kSigmaMax,i=this.volumeInfo,o=i.dmean-i.dmin,a=i.dmax-i.dmin,s=function(e){return(o+e*i.sd)/a};this.material.uniforms._isoLevel0.value.set(s(t),s(n),s(r))}},{key:"rebuild",value:function(e){var t=n._nearClipPlaneOffset,r=n._pos,i=n._norm,o=n._norm4D,a=n._matrixWorldToLocal,s=n._clipPlane;this._updateIsoLevel(),e.getWorldDirection(i),e.getWorldPosition(r),r.addScaledVector(i,e.near+t),a.copy(this.matrixWorld).invert(),r.applyMatrix4(a),o.set(i.x,i.y,i.z,0),o.applyMatrix4(a),i.copy(o),i.normalize(),s.setFromNormalAndCoplanarPoint(i,r),this.clipPlane.equals(s)||(this.clipPlane=s.clone(),this._updateVertices(),this._updateIndices())}}]),n}(a.Mesh);Ee(ml,"_corners",[[-1,-1,-1,0,4,8],[1,-1,-1,0,5,9],[1,1,-1,1,5,10],[-1,1,-1,1,4,11],[-1,-1,1,2,6,8],[1,-1,1,2,7,9],[1,1,1,3,7,10],[-1,1,1,3,6,11]]),Ee(ml,"_edges",[[0,1,0,-1,-1],[2,3,0,1,-1],[4,5,0,-1,1],[6,7,0,1,1],[0,3,-1,0,-1],[1,2,1,0,-1],[4,7,-1,0,1],[5,6,1,0,1],[0,4,-1,-1,0],[1,5,1,-1,0],[2,6,-1,1,0],[3,7,1,1,0]]),Ee(ml,"_edgeIntersections",function(){for(var e=[],t=0;t<12;++t)e.push(new a.Vector3);return e}()),Ee(ml,"_nearClipPlaneOffset",.2),Ee(ml,"_pos",new a.Vector3),Ee(ml,"_norm",new a.Vector3),Ee(ml,"_norm4D",new a.Vector4),Ee(ml,"_matrixWorldToLocal",new a.Matrix4),Ee(ml,"_clipPlane",new a.Plane);var vl=function(){function e(t,n){g(this,e);var r=n.delta,i=n.obtuseAngle,o=new a.Vector3;t.getSize(o),o.multiplyScalar(.5);for(var s=this._getBaseVertices(r,i),l=new a.BufferGeometry,c=[],u=0;u<4;u++)c.push(s[u].clone().multiply(o)),c.push(s[(u+1)%4].clone().multiply(o));for(var h=new a.Vector3(2*o.x*(1-r.x-r.y),0,0),f=0;f<8;f++)c.push(c[f].clone().add(h));for(var d=0;d<4;d++)c.push(c[2*d].clone()),c.push(c[2*d+8].clone());var p=new a.Vector3;t.getCenter(p),c.forEach((function(e){return e.add(p)}));var m=function(e){for(var t=e.length,n=new Float32Array(3*t),r=0;r<t;++r){var i=3*r,o=e[r];n[i]=o.x,n[i+1]=o.y,n[i+2]=o.z}return n}(c);l.setAttribute("position",new a.BufferAttribute(m,3)),this._lines=new a.LineSegments(l,new a.LineBasicMaterial({color:16777215})),this._lines.layers.set(Nn.LAYERS.VOLUME)}return _(e,[{key:"_getBaseVertices",value:function(t,n){var r=e._projectionTable,i=function(e,i){var o=t[r[e][0]];return(-.5*(i-1)+i*n[r[e][1]])*o};return[new a.Vector3(2*(i("XZ",1)+i("XY",1))-1,2*i("YZ",1)-1,-1),new a.Vector3(2*(i("XZ",-1)+i("XY",1))-1,2*i("YZ",-1)-1,1),new a.Vector3(2*(i("XZ",-1)+i("XY",-1))-1,1-2*i("YZ",1),1),new a.Vector3(2*(i("XZ",1)+i("XY",-1))-1,1-2*i("YZ",-1),-1)]}},{key:"getMesh",value:function(){return this._lines}}]),e}();Ee(vl,"_projectionTable",{XY:["x",2],XZ:["y",1],YZ:["z",0]});var gl=function(){function e(t,n,r){g(this,e);var i=this._initPlaneGeo(n,r),o=new dl.BackFacePosMaterialFarPlane;this._plane=new eo.Mesh(i,o),this._plane.frustumCulled=!1,this._plane.doubleSided=!0;var s=new a.Matrix4;this._plane._onBeforeRender=function(e,n,r,i,o,l){var c=this.material;if(t&&c){var u=new a.Vector4(0,0,-(r.far-.1),1);u.applyMatrix4(r.matrixWorld),this.matrix.identity(),this.matrix.makeTranslation(u.x,u.y,u.z),this.matrixWorld.copy(this.matrix),this.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,this.matrixWorld),this.normalMatrix.getNormalMatrix(this.modelViewMatrix);var h=t.matrixWorld;s.copy(h).invert(),c.uniforms.aspectRatio.value=r.aspect,c.uniforms.farZ.value=r.far,c.uniforms.tanHalfFOV.value=Math.tan(.5*a.MathUtils.DEG2RAD*r.fov),c.uniforms.matWorld2Volume.value=s}},this._plane.layers.set(Nn.LAYERS.VOLUME_BFPLANE)}return _(e,[{key:"_initPlaneGeo",value:function(e,t){var n=new a.BufferGeometry;e=e||1,t=t||1;var r=new Float32Array([-.5*e,.5*t,0,.5*e,.5*t,0,-.5*e,-.5*t,0,.5*e,-.5*t,0]);return n.setAttribute("position",new a.BufferAttribute(r,3)),n.setIndex([0,2,1,2,3,1]),n}},{key:"getMesh",value:function(){return this._plane}}]),e}();function yl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var _l=function(e){T(n,e);var t=yl(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._mesh=new ml,i._mesh.setDataSource(r),i.add(i._mesh),i._frame=new vl(i.getBoundaries().boundingBox,i._mesh.volumeInfo),i.add(i._frame.getMesh()),i.showFrame(ie.now.modes.VD.frame),i._farPlane=new gl(i._mesh,2,2),i.add(i._farPlane.getMesh()),i}return _(n,[{key:"getBoundaries",value:function(){var e=this._dataSource.getBox(),t=new a.Sphere;return e.getBoundingSphere(t),{boundingBox:e,boundingSphere:t}}},{key:"getMesh",value:function(){return this._mesh}},{key:"showFrame",value:function(e){this._frame.getMesh().material.visible=e}}]),n}(Bn);function xl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var bl=function(e){T(n,e);var t=xl(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return g(this,n),t.call(this,e,["types"])}return _(n,[{key:"find",value:function(e){var t=[];if(e.type)t=this._dict.types[e.type.toLowerCase()]||[];else if(e.source)return this._list.filter((function(t){return t.canProbablyLoad&&t.canProbablyLoad(e.source)}));return zn(t)}}]),n}(Vn);function wl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Sl=function(e){T(n,e);var t=wl(n);function n(e,r){var i;return g(this,n),(i=t.call(this))._source=e,i._options=r||{},i._abort=!1,i._agent=null,i}return _(n,[{key:"load",value:function(){return Promise.reject(new Error("Loading from this source is not implemented"))}},{key:"abort",value:function(){this._abort=!0,this._agent&&this._agent.abort()}}],[{key:"extractName",value:function(e){}}]),n}(O);function Ml(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Un(Sl.prototype);var El=function(e){T(n,e);var t=Ml(n);function n(e,r){var i;return g(this,n),r=(i=t.call(this,e,r))._options,i._binary=!0===r.binary,i}return _(n,[{key:"load",value:function(){var e=this;return new Promise((function(t,n){if(e._abort)throw new Error("Loading aborted");var r=e._source,i=e._agent=new FileReader;i.addEventListener("load",(function(){t(i.result)})),i.addEventListener("error",(function(){n(i.error)})),i.addEventListener("abort",(function(){n(new Error("Loading aborted"))})),i.addEventListener("progress",(function(t){e.dispatchEvent(t)})),e._binary?i.readAsArrayBuffer(r):i.readAsText(r)}))}}],[{key:"canProbablyLoad",value:function(e){return File&&e instanceof File||Blob&&e instanceof Blob}},{key:"extractName",value:function(e){return e&&e.name}}]),n}(Sl);function Tl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}El.types=["file","blob"];var Al=/^(https?|ftp):\/\//i,Cl=function(e){T(n,e);var t=Tl(n);function n(e,r){var i;return g(this,n),r=(i=t.call(this,e,r))._options,i._binary=!0===r.binary,i}return _(n,[{key:"load",value:function(){var e=this;return new Promise((function(t,n){if(e._abort)throw new Error("Loading aborted");var r=e._source,i=e._agent=new XMLHttpRequest;i.addEventListener("load",(function(){200===i.status?t(i.response):n(new Error("HTTP ".concat(i.status," while fetching ").concat(r)))})),i.addEventListener("error",(function(){n(new Error("HTTP request failed"))})),i.addEventListener("abort",(function(){n(new Error("Loading aborted"))})),i.addEventListener("progress",(function(t){e.dispatchEvent(t)})),i.open("GET",r),e._binary?i.responseType="arraybuffer":i.responseType="text",i.send()}))}}],[{key:"canProbablyLoad",value:function(e){return o.default.isString(e)&&Al.test(e)}},{key:"extractName",value:function(e){if(e){var t=(e.indexOf("?")+1||e.lastIndexOf("#")+1||e.length+1)-1;return e.slice(e.lastIndexOf("/",t)+1,t)}}}]),n}(Sl);function Rl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Cl.types=["url"];var Pl=function(e){T(n,e);var t=Rl(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"load",value:function(){var e=this;return new Promise((function(t){if(e._abort)throw new Error("Loading aborted");t(e._source)}))}}],[{key:"canProbablyLoad",value:function(e){return!1}}]),n}(Sl);Pl.types=["immediate"];var Ll=new bl([El,Cl,Pl]);function kl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Il=function(e){T(n,e);var t=kl(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return g(this,n),t.call(this,e,["formats","extensions"])}return _(n,[{key:"find",value:function(e){var t=[];return e.format?t=this._dict.formats[e.format.toLowerCase()]||[]:e.ext&&(t=this._dict.extensions[e.ext.toLowerCase()]||[]),0===t.length&&!e.format&&e.data?this._list.filter((function(t){return t.canProbablyParse&&t.canProbablyParse(e.data)})):zn(t)}}]),n}(Vn),Nl=function(){function e(t,n){g(this,e),this._data=t,this._options=n||{},this._abort=!1}return _(e,[{key:"parseSync",value:function(){throw new Error("Parsing this type of data is not implemented")}},{key:"parse",value:function(){var e=this;return new Promise((function(t,n){setTimeout((function(){try{return e._abort?n(new Error("Parsing aborted")):t(e.parseSync())}catch(e){return n(e)}}))}))}},{key:"getModel",value:function(){return this.model._parseHeader(this._data),this.model}},{key:"abort",value:function(){this._abort=!0}}]),e}();Un(Nl.prototype);var Ol=function(){function e(){g(this,e),this.matrices=[],this._matrix=null,this._matrixIndex=-1}return _(e,[{key:"parse",value:function(e){var t=this._matrix;if("  SMTRY"===e.readString(12,18)){var n=e.readCharCode(19)-49,r=e.readString(20,80).trim().split(/\s+/),i=parseInt(r[0],10);null!==this._matrix&&i===this._matrixIndex||(this._matrixIndex=i,this._matrix=t=new a.Matrix4,this.matrices[this.matrices.length]=t);var o=t.elements;o[n]=parseFloat(r[1]),o[n+4]=parseFloat(r[2]),o[n+8]=parseFloat(r[3]),o[n+12]=parseFloat(r[4])}}}]),e}();Ol.prototype.id=290;var Dl=yn.Assembly,Bl=function(){function e(t){g(this,e),this._complex=t,this.assemblies=[],this._assembly=null,this._matrix=null,this._matrixIndex=-1}return _(e,[{key:"parse",value:function(e){var t=this._assembly,n=this._matrix;if(t&&"  BIOMT"===e.readString(12,18)){var r=e.readCharCode(19)-49,i=e.readString(20,80).trim().split(/\s+/),o=parseInt(i[0],10);null!==this._matrix&&o===this._matrixIndex||(this._matrixIndex=o,this._matrix=n=new a.Matrix4,t.addMatrix(n));var s=n.elements;s[r]=parseFloat(i[1]),s[r+4]=parseFloat(i[2]),s[r+8]=parseFloat(i[3]),s[r+12]=parseFloat(i[4])}else if(t&&"CHAINS:"===e.readString(35,41))for(var l=e.readString(42,80).split(","),c=0,u=l.length;c<u;++c){var h=l[c].trim();h.length>0&&t.addChain(h)}else"BIOMOLECULE:"===e.readString(12,23)&&(this._matrix=null,this._matrixIndex=-1,this._assembly=t=new Dl(this._complex),this.assemblies.push(t))}}]),e}();Bl.prototype.id=350;var zl=function(){function e(t){g(this,e),this._data=t,this._start=0,this._nextCR=-1,this._nextLF=-1,this._next=-1,this._end=t.length,this.next()}return _(e,[{key:"readLine",value:function(){return this._data.slice(this._start,this._next)}},{key:"readChar",value:function(e){return(e=this._start+e-1)<this._next?this._data[e]:" "}},{key:"readCharCode",value:function(e){return(e=this._start+e-1)<this._next?this._data.charCodeAt(e):32}},{key:"readString",value:function(e,t){var n=this._start+e-1,r=this._start+t;return this._data.slice(n,r<this._next?r:this._next)}},{key:"readInt",value:function(e,t){return parseInt(this.readString(e,t),10)}},{key:"readFloat",value:function(e,t){return parseFloat(this.readString(e,t))}},{key:"end",value:function(){return this._start>=this._end}},{key:"next",value:function(){var e=this._next+1;this._start=e<this._end?e:this._end,this._start>this._nextCR&&(this._nextCR=(this._data.indexOf("\r",this._start)+1||this._end+1)-1),this._start>this._nextLF&&(this._nextLF=(this._data.indexOf("\n",this._start)+1||this._end+1)-1),this._next=this._nextCR+1<this._nextLF?this._nextCR:this._nextLF}}]),e}();function Fl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Vl=yn.Complex,Ul=yn.Element,Gl=yn.Helix,Hl=yn.Sheet,jl=yn.Strand,Wl=yn.Bond,ql=yn.Molecule,Xl=/^(HEADER\s|COMPND\s|REMARK\s|ATOM {2}|HETATM|MODEL )/i,Yl={290:Ol,350:Bl},Zl=function(e){T(n,e);var t=Fl(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._complex=null,i._chain=null,i._residue=null,i._sheet=null,i._serialAtomMap=null,i._modelId=1,i._compaundFound=!1,i._biomoleculeFound=!1,i._allowedChainsIDs=null,i._lastMolId=-1,i._remarks={},i._remark=null,i._molecules=[],i._molecule=null,i._compndCurrToken="",i._options.fileType="pdb",i}return _(n,[{key:"_finalize",value:function(){this._fixBondsArray(),this._fixChains();var e=this._remarks[290];this._complex.symmetry=o.default.isUndefined(e)?[]:e.matrices;var t=this._remarks[350];this._complex.units=this._complex.units.concat(o.default.isUndefined(t)?[]:t.assemblies),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_finalizeMolecules",value:function(){var e,t={},n=this._complex._chains;for(e=0;e<n.length;++e){var r=n[e];t[r._name]=r}for(e=0;e<this._molecules.length;e++){for(var i=this._molecules[e],o=[],a=0;a<i._chains.length;a++){var s=t[i._chains[a]];o=o.concat(s._residues.slice())}var l=new ql(this._complex,i._name,e+1);l.residues=o,this._complex._molecules[e]=l}}},{key:"_fixChains",value:function(){for(var e={},t=this._complex,n=0;n<t._chains.length;n++){var r=t._chains[n];e[r._name.charCodeAt(0)]=r}}},{key:"_fixBondsArray",value:function(){for(var e=this._serialAtomMap={},t=this._complex,n=t._atoms,r=0,i=n.length;r<i;++r){var o=n[r];e[o.serial]=o}for(var a=t._bonds,s=this.logger,l=0,c=a.length;l<c;++l){var u=a[l];u._right<u._left&&s.debug("_fixBondsArray: Logic error."),u._left=e[u._left]||null,u._right=e[u._right]||null}}},{key:"_parseATOM",value:function(e){if(1===this._modelId){var t=72===e.readCharCode(1),n=t?e.readInt(7,11):e.readInt(6,11),r=e.readString(13,16),i=e.readChar(17),o=e.readString(18,20).trim(),s=e.readChar(22),l=e.readInt(23,26),c=e.readChar(27),u=e.readFloat(31,38),h=e.readFloat(39,46),f=e.readFloat(47,54),d=e.readFloat(55,60),p=e.readFloat(61,66),m=e.readString(77,78).trim()||function(e){var t=4===e.trim().length;return e.slice(0,t?1:2).trim()}(r),v=e.readInt(79,80)||0;if(!this.settings.now.nowater||"HOH"!==o&&"WAT"!==o){r=r.trim();var g=Ul.getByName(m),y=Ul.Role[r],_=this._chain;_&&_.getName()===s||(this._chain=_=this._complex.getChain(s)||this._complex.addChain(s),this._residue=null);var x=this._residue;x&&x.getSequence()===l&&x.getICode()===c||(this._residue=x=_.addResidue(o,l,c));var b=new a.Vector3(u,h,f);x.addAtom(r,g,b,y,t,n,i,d,p,v)}}}},{key:"_parseENDMDL",value:function(){this._modelId+=1}},{key:"_parseCONECT",value:function(e){var t=e.readInt(7,11),n=e.readInt(12,16),r=e.readInt(17,21),i=e.readInt(22,26),o=e.readInt(27,31),a=this._complex;n&&n>t&&a.addBond(t,n,0,Wl.BondType.UNKNOWN,!0),r&&r>t&&a.addBond(t,r,0,Wl.BondType.UNKNOWN,!0),i&&i>t&&a.addBond(t,i,0,Wl.BondType.UNKNOWN,!0),o&&o>t&&a.addBond(t,o,0,Wl.BondType.UNKNOWN,!0)}},{key:"_parseCOMPND",value:function(e){var t=e.readString(11,80),n=t.indexOf(":");if(this._compndCurrToken=n>0?t.substring(0,n).trim():this._compndCurrToken,"MOL_ID"===this._compndCurrToken)this._molecule={_index:"",_chains:[]},this._molecule._index=parseInt(t.substring(n+1,t.indexOf(";")),10),this._molecules.push(this._molecule);else if("MOLECULE"===this._compndCurrToken&&null!=this._molecule)this._molecule._name=t.substring(n+1,t.indexOf(";")).trim();else if("CHAIN"===this._compndCurrToken&&null!=this._molecule){var r=t.substring(n+1,80).trim(),i=r[r.length-1];";"!==i&&","!==i||(r=r.slice(0,-1));var o=(r=r.replace(/\s+/g,"")).split(",");this._molecule._chains=this._molecule._chains.concat(o)}}},{key:"_parseREMARK",value:function(e){var t=e.readInt(8,10),n=this._remarks[t];if(o.default.isUndefined(n)){var r=Yl[t];o.default.isFunction(r)&&(this._remarks[t]=n=new r(this._complex))}o.default.isUndefined(n)||n.parse(e)}},{key:"_parseHELIX",value:function(e){var t=this;this._parseSTRUCTURE(e,[20,22,32,34],(function(e){t._complex.addHelix(e),t._complex.structures.push(e)}))}},{key:"_parseSHEET",value:function(e){var t=this;this._parseSTRUCTURE(e,[22,23,33,34],(function(e){t._complex.addSheet(e)}))}},{key:"_parseSTRUCTURE",value:function(e,t,n){var r=e.readInt(8,10),i=e.readString(12,14).trim(),o=e.readString(41,70).trim(),a=e.readInt(72,76),s=e.readInt(39,40),l=e.readInt(15,16),c=e.readInt(42,45),u=e.readInt(57,60),h=e.readString(t[0],t[2]+1).charCodeAt(0),f=e.readString(t[2],t[2]+1).charCodeAt(0),d=e.readInt(t[1],t[1]+3),p=e.readString(t[1]+4,t[1]+4),m=0;p.length>0&&(m=p.charCodeAt(0));var v,g=e.readInt(t[3],t[3]+3),y=0;(p=e.readString(t[3]+4,t[3]+4)).length>0&&(y=p.charCodeAt(0));var _=this._sheet;if(83===e.readCharCode(1)){null!==_&&_.getName()!==i&&(_=null,this._sheet=null),null===_?(this._sheet=v=new Hl(i,l),n(v)):v=_;var x=new jl(v,this._complex.getUnifiedSerial(h,d,m),this._complex.getUnifiedSerial(f,g,y),s,c,u);v.addStrand(x),this._complex.structures.push(x)}else n(v=new Gl(s,this._complex.getUnifiedSerial(h,d,m),this._complex.getUnifiedSerial(f,g,y),r,i,o,a))}},{key:"_parseHEADER",value:function(e){var t=this._complex.metadata;t.classification=e.readString(11,50).trim(),t.date=e.readString(51,59).trim();var n=e.readString(63,66).trim();t.id=n,n&&(this._complex.name=n),t.format="pdb"}},{key:"_parseTITLE",value:function(e){var t=this._complex.metadata;t.title=t.title||[];var n=e.readInt(9,10)||1;t.title[n-1]=e.readString(11,80).trim()}},{key:"parseSync",value:function(){for(var e=new zl(this._data),t=this._complex=new Vl;!e.end();){var r=e.readString(1,6),i=n.tagParsers[r];o.default.isFunction(i)&&i.call(this,e),e.next()}if(this._finalize(),this._serialAtomMap=null,this._sheet=null,this._residue=null,this._chain=null,this._complex=null,0===t.getAtomCount())throw new Error("The data does not contain valid atoms");return t}}],[{key:"canProbablyParse",value:function(e){return o.default.isString(e)&&Xl.test(e)}}]),n}(Nl);function $l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Zl,"tagParsers",{HEADER:Zl.prototype._parseHEADER,"TITLE ":Zl.prototype._parseTITLE,"ATOM  ":Zl.prototype._parseATOM,HETATM:Zl.prototype._parseATOM,ENDMDL:Zl.prototype._parseENDMDL,CONECT:Zl.prototype._parseCONECT,COMPND:Zl.prototype._parseCOMPND,REMARK:Zl.prototype._parseREMARK,"HELIX ":Zl.prototype._parseHELIX,"SHEET ":Zl.prototype._parseSHEET,"ATOM 1":Zl.prototype._parseATOM,"ATOM 2":Zl.prototype._parseATOM,"ATOM 3":Zl.prototype._parseATOM,"ATOM 4":Zl.prototype._parseATOM,"ATOM 5":Zl.prototype._parseATOM,"ATOM 6":Zl.prototype._parseATOM,"ATOM 7":Zl.prototype._parseATOM,"ATOM 8":Zl.prototype._parseATOM,"ATOM 9":Zl.prototype._parseATOM}),Zl.formats=["pdb"],Zl.extensions=[".pdb",".ent"];var Jl=yn.Complex,Kl=yn.Element,Ql=yn.SGroup,ec=yn.Bond,tc={A:0,S:1,D:2,T:3},nc=/\s*<\?xml\b[^?>]*\?>\s*<(?:cml|molecule)\b/i,rc=function(e){T(n,e);var t=$l(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._complex=null,i._residue=null,i._serialAtomMap=null,i._modelId=1,i._lastMolId=-1,i._readOnlyOneMolecule=!1,i._options.fileType="cml",i}return _(n,[{key:"_rebuidBondIndexes",value:function(e,t){for(var n=e.length,r=0;r<n;r++)for(var i=e[r].id,o=t.length,a=0;a<o;a++){var s=t[a].atomRefs2.split(" ");s[0]===i&&(t[a].start=r),s[1]===i&&(t[a].end=r)}}},{key:"_createSGroup",value:function(e,t){var n=new Ql(e.id,e.fieldData,new a.Vector3(parseFloat(e.x),parseFloat(e.y),0),e.atomRefs,e);"Relative"===e.placement&&(n._center=new a.Vector3(0,0,0)),"MDLBG_FRAGMENT_CHARGE"===e.fieldName&&(n._charge=parseInt(e.fieldData,10)||0),"MDLBG_FRAGMENT_COEFFICIENT"===e.fieldName&&(n._repeat=parseInt(e.fieldData,10)||1),t.push(n)}},{key:"_extractSGroup",value:function(e,t){if(Array.isArray(t)||(t=[]),e)if(Array.isArray(e))for(var n=e.length,r=0;r<n;r++)e[r].molecule&&(t=t.concat(this._extractSGroup(e[r].molecule))),this._createSGroup(e[r],t);else e.molecule&&e.molecule&&(t=t.concat(this._extractSGroup(e.molecule))),this._createSGroup(e,t);return t}},{key:"_extractSGroups",value:function(e,t){var n,r,i=this._extractSGroup(e),o=t.length;for(n=0;n<o;n++){var s=t[n].id;for(r=0;r<i.length;r++)i[r]._atoms.split(" ")[0]===s&&(t[n].sgroupRef||(t[n].sgroupRef=[]),t[n].sgroupRef.push(i[r]))}var l,c={},u=null,h=1e8,f=new a.Vector3(h,h,h),d=new a.Vector3(-h,-h,-h);function p(e){(u=c[e])&&i[r]._atoms.push(u.a)}function m(e){(u=c[e])&&(f.set(Math.min(f.x,u.x),Math.min(f.y,u.y),Math.min(f.z,u.z)),d.set(Math.max(d.x,u.x),Math.max(d.y,u.y),Math.max(d.z,u.z)),p(e))}for(n=0;n<t.length;n++)c[t[n].id]={},c[t[n].id].x=t[n].x2,t[n].x3&&(c[t[n].id].x=t[n].x3),c[t[n].id].x=parseFloat(c[t[n].id].x),c[t[n].id].y=t[n].y2,t[n].y3&&(c[t[n].id].y=t[n].y3),c[t[n].id].y=parseFloat(c[t[n].id].y),c[t[n].id].z="0.0",t[n].z3&&(c[t[n].id].z=t[n].z3),c[t[n].id].z=parseFloat(c[t[n].id].z),c[t[n].id].a=t[n];for(r=0;r<i.length;r++)null!==i[r]._center?(f.set(h,h,h),d.set(-h,-h,-h),l=i[r]._atoms.split(" "),i[r]._atoms=[],l.forEach(m),i[r]._center.addVectors(f,d),i[r]._center.multiplyScalar(.5)):(l=i[r]._atoms.split(" "),i[r]._atoms=[],l.forEach(p));c=null}},{key:"_traverseData",value:function(e){var t={};return e.childNodes.length&&function e(t,n){if("#text"!==t.nodeName||""!==t.nodeValue.trim()){var r={};r.xmlNode=t;var i,o,a,s=n[t.nodeName];if(s?(i=s,"[object Array]"!==Object.prototype.toString.apply(i)?n[t.nodeName]=[s,r]:n[t.nodeName].push(r)):n[t.nodeName]=r,t.attributes)for(o=t.attributes.length,a=0;a<o;a++){var l=t.attributes[a];r[l.nodeName]=l.nodeValue}for(o=t.childNodes.length,a=0;a<o;a++)e(t.childNodes[a],r)}}(e.childNodes[0],t),t}},{key:"_findSuitableMolecule",value:function(e,t){for(var n in e)if("xmlNode"!==n)if("molecule"===n){if(e.molecule&&(e.molecule.atomArray&&e.molecule.atomArray.atom&&t.push(e),Array.isArray(e.molecule)))for(var r=0;r<e.molecule.length;r++)e.molecule[r].atomArray&&e.molecule[r].atomArray.atom&&t.push({molecule:e.molecule[r]})}else e[n]&&null!==e[n]&&"object"===A(e[n])&&this._findSuitableMolecule(e[n],t)}},{key:"_selectComponents",value:function(e){var t,n=(new DOMParser).parseFromString(e,"application/xml"),r=this._traverseData(n),i=this;t=r.cml?r.cml:r;var o=[],a=[];return this._findSuitableMolecule(t,a),this._readOnlyOneMolecule&&a.length>1&&a.splice(1,a.length-1),a.forEach((function(e){var t=function(e){var t,r=[];if(e.molecule&&e.molecule.atomArray&&e.molecule.atomArray.atom)Array.isArray(e.molecule.atomArray.atom)?r=e.molecule.atomArray.atom:r.push(e.molecule.atomArray.atom);else if(!e.molecule){var o={atomLabels:null,labelsCount:1};return o}e.molecule.molecule&&i._extractSGroups(e.molecule.molecule,r);for(var a=r.length,s=0;s<a;s++)(t=r[s]).edges=[];var l,c=[];e.molecule.bondArray&&e.molecule.bondArray.bond&&(Array.isArray(e.molecule.bondArray.bond)?c=e.molecule.bondArray.bond:c.push(e.molecule.bondArray.bond)),a=c.length,i._rebuidBondIndexes(r,c);for(var u=0;u<a;u++)if(l=c[u],(t=r[l.start])&&(t.edges.push(l.end),(t=r[l.end])&&(t.edges.push(l.start),1))){var h=l.xmlNode.getAttribute("order"),f=parseInt(h,10);if(c[u].order=0,c[u].type=ec.BondType.UNKNOWN,f>1)c[u].order=f;else{var d=tc[h];void 0!==d&&(c[u].order=d,"A"===h&&(c[u].type=ec.BondType.AROMATIC))}}a=r.length;for(var p=0;p<a;p++)(t=r[p]).edges.sort();var m=i._breadWidthSearch(r,0),v={};return v.atoms=r,v.bonds=c,v.labels=m.atomLabels,v.count=Math.min(1,m.labelsCount),v.curr=-1,v.originalCML=n,v}(e);t.atoms.length>0&&o.push(t)})),o}},{key:"_packLabel",value:function(e,t){return(t<<16)+e}},{key:"_unpackLabel",value:function(e){return{molId:e>>>16,compId:65535&e}}},{key:"_breadWidthSearch",value:function(e,t){var n,r=new Array(e.length);for(n=0;n<r.length;n++)r[n]=this._packLabel(0,t);for(var i=[],o=0,a=e.length;a>0;){o++;var s=-1;for(n=0;n<r.length;n++)if(0===this._unpackLabel(r[n]).compId){s=n;break}if(s<0)break;for(i.push(e[s]),r[s]=this._packLabel(o,t),a--;i.length>0;){var l=i.shift();if(l)for(var c=0;c<l.edges.length;c++)r[l.edges[c]]!==o&&(i.push(e[l.edges[c]]),r[l.edges[c]]=o,a--)}}var u={};return u.atomLabels=r,u.labelsCount=o,u}},{key:"_parseBond",value:function(e,t,n,r){if(e>=0){var i=[Math.min(e,t),Math.max(e,t)];this._complex.addBond(i[0],i[1],n,r,!0)}}},{key:"_fixBondsArray",value:function(){for(var e=this._serialAtomMap={},t=this._complex,n=t._atoms,r=0,i=n.length;r<i;++r){var o=n[r];e[o.serial]=o}for(var a=t._bonds,s=this.logger,l=0,c=a.length;l<c;++l){var u=a[l];u._right<u._left&&s.debug("_fixBondsArray: Logic error."),u._left=e[u._left]||null,u._right=e[u._right]||null}}},{key:"_parseSet",value:function(e){var t,n,r,i=this._complex=new Jl,o=e,s=o.curr,l=o.atoms,c=o.labels,u=null,h=l.length,f={},d=[];for(t=0;t<h;t++)d.push(t);for(d.sort((function(e,t){return c[e]-c[t]})),t=0;t<h;t++){var p=c[d[t]];if(this._unpackLabel(p).molId===this._unpackLabel(s).molId){var m=(u=l[d[t]]).elementType;if(u.sgroupRef)for(var v=u.sgroupRef.length,g=0;g<v;++g)i._sgroups.push(u.sgroupRef[g]);if(u.x3||u.x2){var y=this._unpackLabel(p).compId,_=y,x=y.toString();1===x.length&&(x="0".concat(x));var b="N".concat(x),w=f[" "];w&&" "===w.getName()||(f[" "]=w=this._complex.getChain(" ")||this._complex.addChain(" "),this._residue=null);var S=this._residue;S&&S.getSequence()===_&&" "===S.getICode()||(this._residue=S=w.addResidue(b,_," "));var M=null;u.x3?M=new a.Vector3(parseFloat(u.x3),parseFloat(u.y3),parseFloat(u.z3)):u.x2&&(M=new a.Vector3(parseFloat(u.x2),parseFloat(u.y2),0));var E=Kl.ByName[u.elementType.toUpperCase()];E||((E=JSON.parse(JSON.stringify(Kl.ByName[Object.keys(Kl.ByName)[Object.keys(Kl.ByName).length-1]]))).number+=1,E.name=u.elementType.toUpperCase(),E.fullName="Unknown",Kl.ByName[u.elementType.toUpperCase()]=E);var T=parseInt(u.id.replace(/[^0-9]/,""),10),A=S.addAtom(m,E,M,Kl.Role.SG,!0,T," ",1,0,0);u.hydrogenCount&&(A.hydrogenCount=parseInt(u.hydrogenCount,10)),u.mrvValence&&(A.valence=parseInt(u.mrvValence,10)),(r=A).xmlNodeRef=u,u.x2&&(u.x3=u.x2,delete u.x2),u.y2&&(u.y3=u.y2,delete u.y2),u.z3||(u.z3="0.0"),u.complexAtom=r}}}for(f=null,t=0;t<o.bonds.length;t++){var C=o.bonds[t];if(this._unpackLabel(c[C.start]).molId===this._unpackLabel(s).molId&&this._unpackLabel(c[C.end]).molId===this._unpackLabel(s).molId){if(!(u=l[C.start])||!l[C.end])continue;this._parseBond(parseInt(u.id.replace(/[^0-9]/,""),10),parseInt(l[C.end].id.replace(/[^0-9]/,""),10),C.order,C.type)}}for(t=0;t<this._complex.getSGroupCount();t++){var R=this._complex.getSGroups()[t];for(n=0;n<R._atoms.length;n++)R._atoms[n]=R._atoms[n].complexAtom}for(t=0;t<h;t++)this._unpackLabel(c[t]).molId===this._unpackLabel(s).molId&&((u=l[t]).complexAtom=null,delete u.complexAtom);return this._complex.originalCML=o.originalCML,this._fixBondsArray(),i.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._serialAtomMap=null,this._complex=null,i}},{key:"parseSync",value:function(){var e=[],t=this;this._selectComponents(this._data).forEach((function(n){n.curr=2,0===n.count&&(n.count=1);for(var r=0;r<n.count;r++)n.curr=r+1,e.push(t._parseSet(n,!1))}));var n=0;if(e.forEach((function(e){n+=e.getAtomCount()})),n<=0)throw new Error("The data does not contain valid atoms");if(e.length>1){var r=new Jl;return r.joinComplexes(e),r.originalCML=e[0].originalCML,r}return 1===e.length?e[0]:new Jl}}],[{key:"canProbablyParse",value:function(e){return o.default.isString(e)&&nc.test(e)}}]),n}(Nl);rc.formats=["cml"],rc.extensions=[".cml"];var ic={exports:{}};!function(e,t){!function(e){function t(e,t,n){for(var r=(e.byteLength,0),i=n.length;i>r;r++){var o=n.charCodeAt(r);if(128>o)e.setUint8(t++,o>>>0&127|0);else if(2048>o)e.setUint8(t++,o>>>6&31|192),e.setUint8(t++,o>>>0&63|128);else if(65536>o)e.setUint8(t++,o>>>12&15|224),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128);else{if(!(1114112>o))throw new Error("bad codepoint "+o);e.setUint8(t++,o>>>18&7|240),e.setUint8(t++,o>>>12&63|128),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128)}}}function n(e){for(var t=0,n=0,r=e.length;r>n;n++){var i=e.charCodeAt(n);if(128>i)t+=1;else if(2048>i)t+=2;else if(65536>i)t+=3;else{if(!(1114112>i))throw new Error("bad codepoint "+i);t+=4}}return t}function r(e,i,o){var a=typeof e;if("string"===a){if(32>(s=n(e)))return i.setUint8(o,160|s),t(i,o+1,e),1+s;if(256>s)return i.setUint8(o,217),i.setUint8(o+1,s),t(i,o+2,e),2+s;if(65536>s)return i.setUint8(o,218),i.setUint16(o+1,s),t(i,o+3,e),3+s;if(4294967296>s)return i.setUint8(o,219),i.setUint32(o+1,s),t(i,o+5,e),5+s}if(e instanceof Uint8Array){var s=e.byteLength,l=new Uint8Array(i.buffer);if(256>s)return i.setUint8(o,196),i.setUint8(o+1,s),l.set(e,o+2),2+s;if(65536>s)return i.setUint8(o,197),i.setUint16(o+1,s),l.set(e,o+3),3+s;if(4294967296>s)return i.setUint8(o,198),i.setUint32(o+1,s),l.set(e,o+5),5+s}if("number"===a){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return i.setUint8(o,203),i.setFloat64(o+1,e),9;if(e>=0){if(128>e)return i.setUint8(o,e),1;if(256>e)return i.setUint8(o,204),i.setUint8(o+1,e),2;if(65536>e)return i.setUint8(o,205),i.setUint16(o+1,e),3;if(4294967296>e)return i.setUint8(o,206),i.setUint32(o+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return i.setInt8(o,e),1;if(e>=-128)return i.setUint8(o,208),i.setInt8(o+1,e),2;if(e>=-32768)return i.setUint8(o,209),i.setInt16(o+1,e),3;if(e>=-2147483648)return i.setUint8(o,210),i.setInt32(o+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null===e)return i.setUint8(o,192),1;if("boolean"===a)return i.setUint8(o,e?195:194),1;if("object"===a){var c=0,u=Array.isArray(e);if(u)s=e.length;else{var h=Object.keys(e);s=h.length}if(16>s?(i.setUint8(o,s|(u?144:128)),c=1):65536>s?(i.setUint8(o,u?220:222),i.setUint16(o+1,s),c=3):4294967296>s&&(i.setUint8(o,u?221:223),i.setUint32(o+1,s),c=5),u)for(var f=0;s>f;f++)c+=r(e[f],i,o+c);else for(f=0;s>f;f++){var d=h[f];c+=r(d,i,o+c),c+=r(e[d],i,o+c)}return c}throw new Error("Unknown type "+a)}function i(e){var t=typeof e;if("string"===t){if(32>(r=n(e)))return 1+r;if(256>r)return 2+r;if(65536>r)return 3+r;if(4294967296>r)return 5+r}if(e instanceof Uint8Array){if(256>(r=e.byteLength))return 2+r;if(65536>r)return 3+r;if(4294967296>r)return 5+r}if("number"===t){if(Math.floor(e)!==e)return 9;if(e>=0){if(128>e)return 1;if(256>e)return 2;if(65536>e)return 3;if(4294967296>e)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null===e)return 1;if("object"===t){var r,o=0;if(Array.isArray(e)){r=e.length;for(var a=0;r>a;a++)o+=i(e[a])}else{var s=Object.keys(e);for(r=s.length,a=0;r>a;a++){var l=s[a];o+=i(l)+i(e[l])}}if(16>r)return 1+o;if(65536>r)return 3+o;if(4294967296>r)return 5+o;throw new Error("Array or object too long 0x"+r.toString(16))}throw new Error("Unknown type "+t)}function o(e){var t=new ArrayBuffer(i(e));return r(e,new DataView(t),0),new Uint8Array(t)}function a(e,t,n){return t?new e(t.buffer,t.byteOffset,t.byteLength/(n||1)):void 0}function s(e){return a(DataView,e)}function l(e){return a(Uint8Array,e)}function c(e){return a(Int8Array,e)}function u(e){return a(Int32Array,e,4)}function h(e,t){var n=e.length/2;t||(t=new Int16Array(n));for(var r=0,i=0;n>r;++r,i+=2)t[r]=e[i]<<8^e[i+1]<<0;return t}function f(e,t){var n=e.length/4;t||(t=new Int32Array(n));for(var r=0,i=0;n>r;++r,i+=4)t[r]=e[i]<<24^e[i+1]<<16^e[i+2]<<8^e[i+3]<<0;return t}function d(e,t){var n=e.length;t||(t=new Uint8Array(4*n));for(var r=s(t),i=0;n>i;++i)r.setInt32(4*i,e[i]);return l(t)}function p(e,t,n){var r=e.length,i=1/t;n||(n=new Float32Array(r));for(var o=0;r>o;++o)n[o]=e[o]*i;return n}function m(e,t,n){var r=e.length;n||(n=new Int32Array(r));for(var i=0;r>i;++i)n[i]=Math.round(e[i]*t);return n}function v(e,t){var n,r;if(!t){var i=0;for(n=0,r=e.length;r>n;n+=2)i+=e[n+1];t=new e.constructor(i)}var o=0;for(n=0,r=e.length;r>n;n+=2)for(var a=e[n],s=e[n+1],l=0;s>l;++l)t[o]=a,++o;return t}function g(e){if(0===e.length)return new Int32Array;var t,n,r=2;for(t=1,n=e.length;n>t;++t)e[t-1]!==e[t]&&(r+=2);var i=new Int32Array(r),o=0,a=1;for(t=1,n=e.length;n>t;++t)e[t-1]!==e[t]?(i[o]=e[t-1],i[o+1]=a,a=1,o+=2):++a;return i[o]=e[e.length-1],i[o+1]=a,i}function y(e,t){var n=e.length;t||(t=new e.constructor(n)),n&&(t[0]=e[0]);for(var r=1;n>r;++r)t[r]=e[r]+t[r-1];return t}function _(e,t){var n=e.length;t||(t=new e.constructor(n)),t[0]=e[0];for(var r=1;n>r;++r)t[r]=e[r]-e[r-1];return t}function x(e,t){var n,r,i=e instanceof Int8Array?127:32767,o=-i-1,a=e.length;if(!t){var s=0;for(n=0;a>n;++n)e[n]<i&&e[n]>o&&++s;t=new Int32Array(s)}for(n=0,r=0;a>n;){for(var l=0;e[n]===i||e[n]===o;)l+=e[n],++n;l+=e[n],++n,t[r]=l,++r}return t}function b(e,t,n){return p(x(e,u(n)),t,n)}function w(e,t,n){var r=x(e,u(n));return function(e,t,n){return p(y(e,u(n)),t,n)}(r,t,function(e){return a(Float32Array,e,4)}(r))}function S(e,t,n){return function(e,t){var n,r=t?127:32767,i=-r-1,o=e.length,a=0;for(n=0;o>n;++n)0===(c=e[n])?++a:a+=c===r||c===i?2:c>0?Math.ceil(c/r):Math.ceil(c/i);var s=t?new Int8Array(a):new Int16Array(a),l=0;for(n=0;o>n;++n){var c;if((c=e[n])>=0)for(;c>=r;)s[l]=r,++l,c-=r;else for(;i>=c;)s[l]=i,++l,c-=i;s[l]=c,++l}return s}(function(e,t,n){return _(m(e,t),n)}(e,t),n)}function M(e,t,n,r){var i=new ArrayBuffer(12+r.byteLength),o=new Uint8Array(i),a=new DataView(i);return a.setInt32(0,e),a.setInt32(4,t),n&&o.set(n,8),o.set(r,12),o}function E(e){return M(2,e.length,void 0,l(e))}function T(e){return M(4,e.length,void 0,d(e))}function A(e,t){return M(5,e.length/t,d([t]),l(e))}function C(e){return M(6,e.length,void 0,d(g(e)))}function R(e){return M(8,e.length,void 0,d(function(e){return g(_(e))}(e)))}function P(e,t){return M(9,e.length,d([t]),d(function(e,t){return g(m(e,t))}(e,t)))}function L(e,t){var n=e.length,r=d([t]),i=function(e,t){var n=e.length;t||(t=new Uint8Array(2*n));for(var r=s(t),i=0;n>i;++i)r.setInt16(2*i,e[i]);return l(t)}(S(e,t));return M(10,n,r,i)}function k(e){var t={};return F.forEach((function(n){void 0!==e[n]&&(t[n]=e[n])})),e.bondAtomList&&(t.bondAtomList=T(e.bondAtomList)),e.bondOrderList&&(t.bondOrderList=E(e.bondOrderList)),t.xCoordList=L(e.xCoordList,1e3),t.yCoordList=L(e.yCoordList,1e3),t.zCoordList=L(e.zCoordList,1e3),e.bFactorList&&(t.bFactorList=L(e.bFactorList,100)),e.atomIdList&&(t.atomIdList=R(e.atomIdList)),e.altLocList&&(t.altLocList=C(e.altLocList)),e.occupancyList&&(t.occupancyList=P(e.occupancyList,100)),t.groupIdList=R(e.groupIdList),t.groupTypeList=T(e.groupTypeList),e.secStructList&&(t.secStructList=E(e.secStructList)),e.insCodeList&&(t.insCodeList=C(e.insCodeList)),e.sequenceIndexList&&(t.sequenceIndexList=R(e.sequenceIndexList)),t.chainIdList=A(e.chainIdList,4),e.chainNameList&&(t.chainNameList=A(e.chainNameList,4)),t}function I(e){function t(e){for(var t={},n=0;e>n;n++)t[o()]=o();return t}function n(t){var n=e.subarray(a,a+t);return a+=t,n}function r(t){var n=e.subarray(a,a+t);a+=t;var r=65535;if(t>r){for(var i=[],o=0;o<n.length;o+=r)i.push(String.fromCharCode.apply(null,n.subarray(o,o+r)));return i.join("")}return String.fromCharCode.apply(null,n)}function i(e){for(var t=new Array(e),n=0;e>n;n++)t[n]=o();return t}function o(){var o,l,c=e[a];if(0==(128&c))return a++,c;if(128==(240&c))return a++,t(l=15&c);if(144==(240&c))return a++,i(l=15&c);if(160==(224&c))return a++,r(l=31&c);if(224==(224&c))return o=s.getInt8(a),a++,o;switch(c){case 192:return a++,null;case 194:return a++,!1;case 195:return a++,!0;case 196:return l=s.getUint8(a+1),a+=2,n(l);case 197:return l=s.getUint16(a+1),a+=3,n(l);case 198:return l=s.getUint32(a+1),a+=5,n(l);case 202:return o=s.getFloat32(a+1),a+=5,o;case 203:return o=s.getFloat64(a+1),a+=9,o;case 204:return o=e[a+1],a+=2,o;case 205:return o=s.getUint16(a+1),a+=3,o;case 206:return o=s.getUint32(a+1),a+=5,o;case 208:return o=s.getInt8(a+1),a+=2,o;case 209:return o=s.getInt16(a+1),a+=3,o;case 210:return o=s.getInt32(a+1),a+=5,o;case 217:return l=s.getUint8(a+1),a+=2,r(l);case 218:return l=s.getUint16(a+1),a+=3,r(l);case 219:return l=s.getUint32(a+1),a+=5,r(l);case 220:return l=s.getUint16(a+1),a+=3,i(l);case 221:return l=s.getUint32(a+1),a+=5,i(l);case 222:return l=s.getUint16(a+1),a+=3,t(l);case 223:return l=s.getUint32(a+1),a+=5,t(l)}throw new Error("Unknown type 0x"+c.toString(16))}var a=0,s=new DataView(e.buffer);return o()}function N(e,t,n,r){switch(e){case 1:return function(e,t){var n=e.length;t||(t=new Float32Array(n/4));for(var r=s(t),i=s(e),o=0,a=0,l=n/4;l>o;++o,a+=4)r.setFloat32(a,i.getFloat32(a),!0);return t}(t);case 2:return c(t);case 3:return h(t);case 4:return f(t);case 5:return l(t);case 6:return v(f(t),new Uint8Array(n));case 7:return v(f(t));case 8:return function(e,t){return y(v(e),t)}(f(t));case 9:return function(e,t,n){return p(v(e,u(n)),t,n)}(f(t),f(r)[0]);case 10:return w(h(t),f(r)[0]);case 11:return p(h(t),f(r)[0]);case 12:return b(h(t),f(r)[0]);case 13:return b(c(t),f(r)[0]);case 14:return x(h(t));case 15:return x(c(t))}}function O(e,t){var n=(t=t||{}).ignoreFields,r={};return V.forEach((function(t){var i=!!n&&-1!==n.indexOf(t),o=e[t];i||void 0===o||(o instanceof Uint8Array?r[t]=N.apply(null,function(e){var t=s(e),n=t.getInt32(0),r=t.getInt32(4),i=e.subarray(8,12);return[n,e=e.subarray(12),r,i]}(o)):r[t]=o)})),r}function D(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function B(e,t){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),O(e instanceof Uint8Array?I(e):e,t)}function z(e,t,n,r){var i=new XMLHttpRequest;i.addEventListener("load",(function(){try{var e=B(i.response);n(e)}catch(e){r(e)}}),!0),i.addEventListener("error",r,!0),i.responseType="arraybuffer",i.open("GET",t+e.toUpperCase()),i.send()}var F=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],V=F.concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]),U="//mmtf.rcsb.org/v1.0/",G=U+"full/",H=U+"reduced/";e.encode=function(e){return o(k(e))},e.decode=B,e.traverse=function(e,t,n){var r,i,o,a,s,l,c=(n=n||{}).firstModelOnly,u=t.onModel,h=t.onChain,f=t.onGroup,d=t.onAtom,p=t.onBond,m=0,v=0,g=0,y=0,_=0,x=-1,b=e.chainNameList,w=e.secStructList,S=e.insCodeList,M=e.sequenceIndexList,E=e.atomIdList,T=e.bFactorList,A=e.altLocList,C=e.occupancyList,R=e.bondAtomList,P=e.bondOrderList;for(r=0,i=e.chainsPerModel.length;i>r&&!(c&&m>0);++r){var L=e.chainsPerModel[m];for(u&&u({chainCount:L,modelIndex:m}),o=0;L>o;++o){var k=e.groupsPerChain[v];if(h){var I=D(e.chainIdList.subarray(4*v,4*v+4)),N=null;b&&(N=D(b.subarray(4*v,4*v+4))),h({groupCount:k,chainIndex:v,modelIndex:m,chainId:I,chainName:N})}for(a=0;k>a;++a){var O=e.groupList[e.groupTypeList[g]],B=O.atomNameList.length;if(f){var z=null;w&&(z=w[g]);var F=null;e.insCodeList&&(F=String.fromCharCode(S[g]));var V=null;M&&(V=M[g]),f({atomCount:B,groupIndex:g,chainIndex:v,modelIndex:m,groupId:e.groupIdList[g],groupType:e.groupTypeList[g],groupName:O.groupName,singleLetterCode:O.singleLetterCode,chemCompType:O.chemCompType,secStruct:z,insCode:F,sequenceIndex:V})}for(s=0;B>s;++s){if(d){var U=null;E&&(U=E[y]);var G=null;T&&(G=T[y]);var H=null;A&&(H=String.fromCharCode(A[y]));var j=null;C&&(j=C[y]),d({atomIndex:y,groupIndex:g,chainIndex:v,modelIndex:m,atomId:U,element:O.elementList[s],atomName:O.atomNameList[s],formalCharge:O.formalChargeList[s],xCoord:e.xCoordList[y],yCoord:e.yCoordList[y],zCoord:e.zCoordList[y],bFactor:G,altLoc:H,occupancy:j})}y+=1}if(p){var W=O.bondAtomList;for(s=0,l=O.bondOrderList.length;l>s;++s)p({atomIndex1:y-B+W[2*s],atomIndex2:y-B+W[2*s+1],bondOrder:O.bondOrderList[s]})}g+=1}v+=1}if(_=x+1,x=y-1,p&&R)for(s=0,l=R.length;l>s;s+=2){var q=R[s],X=R[s+1];(q>=_&&x>=q||X>=_&&x>=X)&&p({atomIndex1:q,atomIndex2:X,bondOrder:P?P[s/2]:null})}m+=1}},e.fetch=function(e,t,n){z(e,G,t,n)},e.fetchReduced=function(e,t,n){z(e,H,t,n)},e.version="v1.1.0dev",e.fetchUrl=G,e.fetchReducedUrl=H,e.encodeMsgpack=o,e.encodeMmtf=k,e.decodeMsgpack=I,e.decodeMmtf=O}(t)}(0,ic.exports);var oc=ic.exports;function ac(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var sc=yn.Complex,lc=yn.Chain,cc=yn.Atom,uc=yn.Element,hc=yn.Helix,fc=yn.Sheet,dc=yn.Strand,pc=yn.Bond,mc=yn.Assembly,vc=yn.Molecule,gc=function(){function e(t){g(this,e),this._original=Array.from(t),this._original.sort(),this._sum=0;for(var n=0;n<this._original.length;++n)this._sum+=this._original[n]}return _(e,[{key:"compare",value:function(e){var t=e.length;if(t!==this._original.length)return!1;var n,r=0;for(n=0;n<t;++n)r+=e[n];if(r!==this._sum)return!1;var i=Array.from(e);for(i.sort(),n=0;n<t;++n)if(i[n]!==this._original[n])return!1;return!0}}]),e}();gc.prototype.constructor=gc;var yc=We.Type,_c=[yc.HELIX_PI,yc.BEND,yc.HELIX_ALPHA,yc.STRAND,yc.HELIX_310,yc.BRIDGE,yc.TURN,yc.COIL],xc=function(e){T(n,e);var t=ac(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._options.fileType="mmtf",i}return _(n,[{key:"_onModel",value:function(e){}},{key:"_onChain",value:function(e){if(0===e.modelIndex){var t=new lc(this._complex,e.chainName);this._complex._chains[e.chainIndex]=t,t._index=e.chainIndex}}},{key:"_onGroup",value:function(e){if(0===e.modelIndex&&(!this.settings.now.nowater||"HOH"!==e.groupName&&"WAT"!==e.groupName)){var t=this._complex._chains[e.chainIndex],n=e.insCode.charCodeAt(0)?e.insCode:"",r=t.addResidue(e.groupName,e.groupId,n);r._index=e.groupIndex,this._updateSecStructure(this._complex,r,e)}}},{key:"_onAtom",value:function(e){if(0===e.modelIndex){var t=e.altLoc.charCodeAt(0)?e.altLoc:"",n=new cc(e.groupIndex,e.atomName,uc.getByName(e.element.toUpperCase()),new a.Vector3(e.xCoord,e.yCoord,e.zCoord),uc.Role[e.atomName],!1,e.atomId,t,e.occupancy,e.bFactor,e.formalCharge);this._complex._atoms[e.atomIndex]=n,n.index=e.atomIndex,this._serialAtomMap[e.atomId]=n}}},{key:"_onBond",value:function(e){var t=Math.max(e.atomIndex1,e.atomIndex2);if(!(t>=this._complex._atoms.length)){var n=Math.min(e.atomIndex1,e.atomIndex2);this._complex.addBond(this._complex._atoms[n],this._complex._atoms[t],e.bondOrder,pc.BondType.UNKNOWN,!0)}}},{key:"_updateSecStructure",value:function(e,t,n){if(!o.default.isUndefined(n)&&n.secStruct===this._ssType)return t._secondary=this._ssStruct,void(this._ssStruct&&(this._ssStruct.term=t));if(!o.default.isUndefined(n)){var r=_c[n.secStruct];this._ssType=n.secStruct,this._ssStart=t;var i=null;switch(this._ssType){case-1:case 7:break;case 0:case 2:case 4:i=new hc([3,-1,1,-1,5][this._ssType],t,t,0,"","",0),e._helices.push(i);break;case 3:var a=new fc("",0);e._sheets.push(a),i=new dc(a,t,t,0,null,null);break;default:void 0!==r&&(i=new We(r,t,t))}this._ssStruct=i,t._secondary=i,i&&e.structures.push(i)}}},{key:"_updateMolecules",value:function(e){var t=e.entityList;if(t)for(var n=e.chainsPerModel[0],r=0;r<t.length;r++){for(var i=t[r],o=i.chainIndexList,a=[],s=0;s<o.length;s++){var l=o[s];if(!(l>=n)){var c=this._complex._chains[l];a=a.concat(c._residues.slice())}}var u=new vc(this._complex,i.description,r+1);u.residues=a,this._complex._molecules[r]=u}}},{key:"_traverse",value:function(e){var t=this,n=this._complex.metadata;n.id=e.structureId,n.title=[],n.title[0]=e.title,n.date=e.releaseDate,n.format="mmtf";var r={onModel:function(e){t._onModel(e)},onChain:function(e){t._onChain(e)},onGroup:function(e){t._onGroup(e)},onAtom:function(e){t._onAtom(e)},onBond:function(e){t._onBond(e)}};this._ssType=-1,this._ssStruct=null,this._ssStart=null,oc.traverse(e,r),this._updateSecStructure(this._complex),this._updateMolecules(e)}},{key:"_linkAtomsToResidues",value:function(){for(var e=0;e<this._complex._atoms.length;++e){var t=this._complex._atoms[e],n=this._complex._residues[t.residue];t.residue=n,n._atoms.push(t)}}},{key:"_findSynonymousChains",value:function(){for(var e={},t=0;t<this._complex._chains.length;++t){var n=this._complex._chains[t],r=n.getName();e.hasOwnProperty(r)||(e[r]=[]),e[r].push(n._index)}return e}},{key:"_parseAssemblyInfo",value:function(e){var t,n,r,i=[],o=this.logger;for(t=0;t<e.bioAssemblyList.length;++t){var s=e.bioAssemblyList[t];if(0!==s.transformList.length){var l=s.transformList[0].chainIndexList,c=new gc(l),u={};for(n=0;n<l.length;++n)u[this._complex._chains[l[n]].getName()]=1;var h=[],f=void 0;for(f in u)u.hasOwnProperty(f)&&Array.prototype.push.apply(h,this._chainsByName[f]);c.compare(h)||o.debug("MMTF: Assembly is missing some of the synonymous chains. Skipping...");var d=new mc(this._complex);for(f in u)u.hasOwnProperty(f)&&d.addChain(f);for(d.addMatrix((new a.Matrix4).fromArray(s.transformList[0].matrix).transpose()),n=1;n<s.transformList.length;++n){var p=s.transformList[n];if(c.compare(p.chainIndexList)){var m=(new a.Matrix4).fromArray(p.matrix).transpose();for(r=0;r<d.matrices.length&&!d.matrices[r].equals(m);++r);r===d.matrices.length&&d.addMatrix(m)}else o.debug("MMTF: Chain lists differ for different transforms in one assembly. Skipping...")}d.finalize(),i.push(d)}}return i}},{key:"_markHeteroAtoms",value:function(e){for(var t=e.chainsPerModel[0],n=0;n<e.entityList.length;++n){var r=e.entityList[n];if("polymer"!==r.type)for(var i=0;i<r.chainIndexList.length;++i){var o=r.chainIndexList[i];if(!(o>=t))for(var a=this._complex._chains[o],s=0;s<a._residues.length;++s)for(var l=a._residues[s],c=0;c<l._atoms.length;++c)l._atoms[c].het=!0}}}},{key:"_joinSynonymousChains",value:function(){var e,t,n=[],r={};for(e=0;e<this._complex._chains.length;++e){var i=this._complex._chains[e],o=i.getName();if(r.hasOwnProperty(o)){var a=r[o];for(t=0;t<i._residues.length;++t){var s=i._residues[t];a._residues.push(s),s._chain=a}}else r[o]=i,i._index=n.length,n.push(i)}this._complex._chains=n}},{key:"parseSync",value:function(){var e=oc.decode(this._data);return this._complex=new sc,this._serialAtomMap={},this._traverse(e),this._linkAtomsToResidues(),this._markHeteroAtoms(e),this._chainsByName=this._findSynonymousChains(),Array.prototype.push.apply(this._complex.units,this._parseAssemblyInfo(e)),this._joinSynonymousChains(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex}}],[{key:"canProbablyParse",value:function(e){return o.default.isArrayBuffer(e)&&223==(1|new Uint8Array(e,0,1)[0])}}]),n}(Nl);function bc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}xc.formats=["mmtf"],xc.extensions=[".mmtf"],xc.binary=!0;var wc=function(e){T(n,e);var t=bc(n);function n(e,r,i){var o;return g(this,n),o=t.call(this,"data:".concat(r,":").concat(i,": ").concat(e)),Error.captureStackTrace&&Error.captureStackTrace(C(o),n),o.name="ParsingError",o.parseLine=r,o.parseColumn=i,o}return n}(I(Error));function Sc(e){return 32===e||10===e||13===e||9===e}function Mc(e,t,n){for(var r=t.length,i=-1;n<r&&(i=t.charCodeAt(n))!==e&&10!==i;)++n;return i===e?n:-1}function Ec(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Tc=yn.Complex,Ac=yn.Element,Cc=yn.Helix,Rc=yn.Sheet,Pc=yn.Strand,Lc=yn.Assembly,kc=yn.Molecule,Ic=["auth_seq_id","Cartn_x","Cartn_y","Cartn_z","label_atom_id"],Nc={helx:"helix",turn:"turn",strn:"strand"};function Oc(e){return null==e||o.default.isArray(e)?e:[e]}function Dc(e){var t=4===e.trim().length;return e.slice(0,t?1:2).trim()}var Bc=function(e){T(n,e);var t=Ec(n);function n(e){var r;return g(this,n),(r=t.call(this)).name="AtomDataError",r.message=e,r}return n}(I(Error));function zc(e,t){for(var n=(e=o.default.isString(e)?e:"".concat(e)).replace(/\)\s*\(/g,"!").replace(/[()']/g,"").split("!"),r=[],i=0,s=n.length;i<s;++i){for(var l=n[i].split(","),c=[],u=0,h=0,f=l.length;h<f;++h){var d=l[h];if(d.includes("-"))for(var p=d.split("-"),m=parseInt(p[0],10),v=parseInt(p[1],10);m<=v;++m)c[u++]=t[m];else c[u++]=t[d]}r.push(c)}var g=[],y=0;return function e(t,n){for(var i=0,o=r[t].length;i<o;++i){var s=n?n.clone():new a.Matrix4;s.multiplyMatrices(r[t][i],s),0===t?g[y++]=s:e(t-1,s)}}(r.length-1),g}var Fc=function(e){T(n,e);var t=Ec(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r)).asymDict={},i.molecules=[],i._options.fileType="cif",i}return _(n,[{key:"parseSync",value:function(){this.logger.info("Parsing CIF file..");var e=function(e){var t,n,r,i,a=0,s=0,l=e.length,c=NaN,u=!0,h=1,f=1,d=0,p={},m={},v=[],g=0,y="",_=[],x=0;function b(){var t;if((46===c||63===c)&&(a+1>=l||Sc(e.charCodeAt(a+1))))return++f,void++a;if(u&&59===c){s=a;var n=0;do{if(-1===(s=Mc(10,e,s+1)))throw new wc("Unterminated text block found",h,f);++n}while(s+1<l&&e.charCodeAt(s+1)!==c||s+1>=l);return t=e.substring(a+1,s).replace(/\r/g,""),a=s+2,h+=n,f=1,u=!1,t}if(39===c||34===c){s=a;do{if(-1===(s=Mc(c,e,s+1)))throw new wc("Unterminated quoted string found",h,f)}while(s+1<l&&!Sc(e.charCodeAt(s+1)));return t=e.substring(a+1,s),f+=s-a+1,a=s+1,t}for(s=a;s<l&&!Sc(e.charCodeAt(s));)++s;t=e.substring(a,s),f+=s-a,a=s;var r=Number(t);return Number.isNaN(r)?t:r}for(;a<=l;){if(13===(c=e.charCodeAt(a)));else if(10===c)u=!0,++h,f=1;else{if(32!==c&&9!==c){if(35===c){if(-1===(a=Mc(10,e,a+1)))break;continue}if(0===d){if(68!==c&&100!==c||"ata_"!==e.substr(a+1,4).toLowerCase()){if(Number.isNaN(c))break;throw new wc("Unexpected character in state ".concat(d),h,f)}for(t=s=a+5;s<l&&!Sc(e.charCodeAt(s));)++s;if(f+=s-a,t<(a=s)){p[e.substring(t,a)]=m={},d=1;continue}throw new wc("Data block name missing",h,f)}if(1===d){if(68!==c&&100!==c||"ata_"!==e.substr(a+1,4).toLowerCase()){if(95===c){for(t=s=a+1;s<l&&!Sc(e.charCodeAt(s));)++s;if(f+=s-a,t<(a=s)){y=e.substring(t,a),d=2;continue}throw new wc("Tag name missing",h,f)}if(76!==c&&108!==c||"oop_"!==e.substr(a+1,4).toLowerCase()){if(Number.isNaN(c))break;throw new wc("Unexpected character in state ".concat(d),h,f)}if(f+=5,(a+=5)<l&&!Sc(e.charCodeAt(a)))throw new wc("Unexpected character in state ".concat(d),h,f);v=[],g=0,_=[],x=0,d=3;continue}d=0;continue}if(2===d){if(Number.isNaN(c))break;n=b(),o.default.set(m,y,n),d=1;continue}if(3===d){if(95===c){for(t=s=a+1;s<l&&!Sc(e.charCodeAt(s));)++s;if(f+=s-a,t<(a=s)){i=e.substring(t,a),v[g++]=i;continue}throw new wc("Tag name missing",h,f)}if(g>0){for(var w=0;w<g;++w)n=[],_[w]=n,o.default.set(m,v[w],n);d=4;continue}throw new wc("Data tags are missing inside a loop",h,f)}if(4===d){68!==c&&100!==c||"ata_"!==e.substr(a+1,4).toLowerCase()?95===c?d=1:76!==c&&108!==c||"oop_"!==e.substr(a+1,4).toLowerCase()?Number.isNaN(c)?d=0:(r=b(),_[x%g].push(r),++x):d=1:d=0;continue}throw new wc("Unexpected internal state ".concat(d),h,f)}u=!1,++f}++a}if(2===d)throw new wc("Unexpected end of file in state ".concat(d),h,f);return p}(this._data);return this._toComplex(e)}},{key:"_toComplex",value:function(e){var t=new Tc,n=e[Object.keys(e)[0]];return this._extractAtoms(t,n),this._extractSecondary(t,n),this._extractAssemblies(t,n),this._extractMolecules(t,n),this._extractMetadata(t,n),t.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing}),t}},{key:"_extractMetadata",value:function(e,t){var n=e.metadata;n.id=t.entry.id,n.classification=t.struct_keywords.pdbx_keywords;var r=t.database_PDB_rev;n.date=r&&r.date_original?r.date_original:"",n.format="cif",n.title=[],n.title[0]=t.struct.title}},{key:"_extractMolecules",value:function(e,t){var n,r=Oc(t.entity.pdbx_description),i=r.length;for(n=0;n<i;n++)this.molecules[n]?this.molecules[n].name=r[n]:this.molecules[n]={name:r[n],residues:[]};var o=e.getMolecules();for(n=0;n<i;n++){var a=this.molecules[n];o[n]=new kc(e,a.name,n+1),o[n].residues=a.residues}}},{key:"_extractAtoms",value:function(e,t){var n=t.atom_site;if(!n)throw new Bc("CIF parsing error: atom_site is not specified!");for(var r=0,i=Ic.length;r<i;++r)if(!n[Ic[r]])throw new Bc("CIF parsing error: requires field ".concat(Ic[r]," not found!"));for(var o=this.asymDict,s=Oc(n.auth_seq_id),l=Oc(n.Cartn_x),c=Oc(n.Cartn_y),u=Oc(n.Cartn_z),h=Oc(n.label_atom_id),f=h.length,d=Oc(n.group_PDB)||[],p=Oc(n.auth_asym_id)||[],m=Oc(n.label_asym_id)||[],v=Oc(n.id)||[],g=Oc(n.pdbx_PDB_ins_code)||[],y=Oc(n.label_comp_id)||[],_=Oc(n.type_symbol)||[],x=Oc(n.B_iso_or_equiv)||[],b=Oc(n.occupancy)||[],w=Oc(n.pdbx_formal_charge)||[],S=Oc(n.label_alt_id)||[],M=Oc(n.pdbx_PDB_model_num)||[],E=Oc(n.label_entity_id)||[],T=null,A=null,C=0;C<f;++C)if(1===(M[C]||1)){var R=String(p[C]||" ");T&&T.getName()===R||(T=e.getChain(R)||e.addChain(R)),o[String(m[C]||" ")]=R;var P=s[C],L=String(g[C]||" "),k=String(y[C]||"");if(!A||A.getSequence()!==P||A.getICode()!==L){A=T.addResidue(k,P,L);var I=E[C]-1,N=this.molecules[I];N||(this.molecules[I]={name:"",residues:[]},N=this.molecules[I]),N.residues.push(A)}var O=h[C],D=_[C]||Dc(O),B=Ac.getByName(D),z=Ac.Role[O.trim()],F=new a.Vector3(l[C],c[C],u[C]),V="HETATM"===d[C]||!1,U=v[C]||C,G=x[C]||0,H=b[C]||0,j=String(S[C]||""),W=w[C]||0;A.addAtom(O,B,F,z,V,U,j,H,G,W)}}},{key:"_extractSecondary",value:function(e,t){t.struct_conf&&this._extractConfs(e,t.struct_conf),t.struct_sheet_range&&this._extractSheets(e,t.struct_sheet_range)}},{key:"_extractSheets",value:function(e,t){var n=this.asymDict;if(t.sheet_id&&t.id&&t.beg_label_seq_id&&t.end_label_seq_id&&t.beg_label_asym_id)for(var r=e._sheets,i=Oc(t.sheet_id),o=Oc(t.id),a=Oc(t.beg_auth_seq_id),s=Oc(t.end_auth_seq_id),l=Oc(t.beg_label_asym_id),c=Oc(t.pdbx_beg_PDB_ins_code)||[],u=Oc(t.pdbx_end_PDB_ins_code)||[],h=0,f=o.length;h<f;++h){var d=e.getChain(n[l[h]]),p=M(i[h]),m=a[h],v=s[h],g=c[h]||" ",y=u[h]||" ",_=d.findResidue(m,g),x=d.findResidue(v,y);if(_&&x){for(var b=new Pc(p,_[0],x[0],0,null,null),w=d.getResidues(),S=_[1];S<=x[1];++S)w[S]._secondary=b;p.addStrand(b),e.structures.push(b)}}function M(e){for(var t=r.length,n=0;n<t;++n)if(r[n]._name===e)return r[n];return r[t]=new Rc(e,0),r[t]}}},{key:"_extractConfs",value:function(e,t){var n=this.asymDict;if(t.conf_type_id&&t.beg_label_seq_id&&t.end_label_seq_id&&t.beg_label_asym_id)for(var r,i,o=Oc(t.conf_type_id),a=Oc(t.beg_auth_seq_id),s=Oc(t.pdbx_beg_PDB_ins_code)||[],l=Oc(t.end_auth_seq_id),c=Oc(t.pdbx_end_PDB_ins_code)||[],u=Oc(t.details)||[],h=Oc(t.pdbx_PDB_helix_length)||[],f=Oc(t.pdbx_PDB_helix_class)||[],d=Oc(t.id)||[],p=Oc(t.beg_label_asym_id),m=0,v=o.length;m<v;++m){var g=(r=o[m],i=void 0,(i=/[A-Za-z]+/.exec(r))?Nc[i[0].toLowerCase()]:null);if(g){var y=d[m]||o[m],_=e.getChain(n[p[m]]),x=a[m],b=l[m],w=s[m]||" ",S=c[m]||" ",M=_.findResidue(x,w),E=_.findResidue(b,S);if(M&&E){var T=u[m]||"",A=h[m]||0,C=f[m]||" ",R=void 0;if("helix"===g){var P=e._helices.length;R=new Cc(C,M[0],E[0],P,y,T,A),e.addHelix(R),e.structures.push(R)}else"turn"===g?(R=new We(We.Type.TURN,M[0],E[0]),e.structures.push(R)):R=null;if(R)for(var L=_.getResidues(),k=M[1];k<=E[1];++k)L[k]._secondary=R}}}}},{key:"_extractAssemblies",value:function(e,t){var n=this.asymDict,r=t.pdbx_struct_assembly_gen;if(r){var i=Oc(r.assembly_id),o=Oc(r.oper_expression),s=Oc(r.asym_id_list);if(i&&o&&s){var l=function(e){if(!e)return null;var t=Oc(e.id),n=e.matrix,r=e.vector;if(!t||!n||!r)return null;for(var i=[],o=0,s=t.length;o<s;++o){for(var l=new a.Matrix4,c=l.elements,u=0;u<3;++u){var h=n[u+1];c[u]=Oc(h[1])[o],c[u+4]=Oc(h[2])[o],c[u+8]=Oc(h[3])[o],c[u+12]=Oc(r[u+1])[o]}i[t[o]]=l}return i}(t.pdbx_struct_oper_list);if(l)for(var c=0,u=i.length;c<u;++c){for(var h=new Lc(e),f=zc(o[c],l),d=s[c].split(","),p=0,m=d.length;p<m;++p){var v=d[p].trim();v.length>0&&h.addChain(n[v])}h.matrices=f,e.units.push(h)}}}}}],[{key:"canProbablyParse",value:function(e){return o.default.isString(e)&&/^\s*data_/i.test(e)}}]),n}(Nl);Fc.formats=["cif","mmcif"],Fc.extensions=[".cif",".mmcif"];var Vc=0,Uc=1,Gc=2,Hc=3,jc=function(){function e(){g(this,e),Ee(this,"_xyz2crs",[]),Ee(this,"_origin",new a.Vector3(0,0,0)),this._header={},this._boxSize=new a.Vector3,this._boxStart=new a.Vector3,this._header.delta={},this._header.extent=[],this._header.nstart=[],this._header.grid=[],this._header.crs2xyz=[],this._header.cellDims=new a.Vector3,this._header.angles=[],this._header.origin=new a.Vector3(0,0,0),this._header.dmin=0,this._header.dmean=0,this._header.dmax=0}return _(e,[{key:"_typedCheck",value:function(){if(o.default.isTypedArray(this._buff))this._buff=this._buff.buffer;else if(!o.default.isArrayBuffer(this._buff))throw new TypeError("Expected ArrayBuffer or TypedArray")}},{key:"_fillHeader",value:function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(e[n][0]){case Vc:this._header[n]=t[e[n][1]][e[n][2]];break;case Gc:this._parseArray(this._header[n],t[e[n][1]],e[n][2]);break;case Uc:this._parseVector(this._header[n],t[e[n][1]],e[n][2]);break;case Hc:this._header[n]=new Uint8Array(t[e[n][1]],4*[e[n][2]],4*[e[n][3]])}}},{key:"_parseVector",value:function(e,t,n){var r=[t[n],t[n+1],t[n+2]];e.x=r[0],e.y=r[1],e.z=r[2]}},{key:"_parseArray",value:function(e,t,n){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}},{key:"_parseHeader",value:function(e){}},{key:"_setAxisIndices",value:function(){}},{key:"_setOrigins",value:function(){}},{key:"_getAxis",value:function(){var e=this._header,t=e.cellDims.x/e.grid[0],n=e.cellDims.y/e.grid[1],r=e.cellDims.z/e.grid[2],i=c(e.angles,3),o=i[0],s=i[1],l=i[2],u=Math.cos(s),h=(Math.cos(o)-Math.cos(s)*Math.cos(l))/Math.sin(l),f=Math.sqrt(1-u*u-h*h);return[new a.Vector3(t,0,0),new a.Vector3(Math.cos(l)*n,Math.sin(l)*n,0),new a.Vector3(u*r,h*r,f*r)]}},{key:"_getXYZdim",value:function(){return[this._header.extent[this._xyz2crs[0]],this._header.extent[this._xyz2crs[1]],this._header.extent[this._xyz2crs[2]]]}},{key:"_getVolumeInfo",value:function(){var e=o.default.pick(this._header,["dmean","dmin","dmax","sd","delta"]);return e.obtuseAngle=this._header.angles.map((function(e){return Number(e>=Math.PI/2)})),e}},{key:"_setBoxParams",value:function(e,t,n){var r=this,i=0,o=0,s=c(this._header.angles,3),l=s[0],u=s[1];s[2]>=Math.PI/2&&(i+=Math.abs(t.x)),u>=Math.PI/2&&(i+=Math.abs(n.x)),l>=Math.PI/2&&(o+=Math.abs(n.y)),this._boxStart=new a.Vector3(this._origin.x-i,this._origin.y-o,this._origin.z),this._boxSize=new a.Vector3(Math.abs(e.x)+Math.abs(t.x)+Math.abs(n.x),Math.abs(t.y)+Math.abs(n.y),Math.abs(n.z));var h=function(e,t){return Math.abs(e[t])/r._boxSize[t]};this._header.delta.x=h(t,"x"),this._header.delta.y=h(n,"x"),this._header.delta.z=h(n,"y")}},{key:"_getXYZbox",value:function(){return new a.Box3(this._boxStart.clone(),this._boxStart.clone().add(this._boxSize))}},{key:"_toXYZData",value:function(){}},{key:"parse",value:function(e){return this._parseHeader(e),this._setOrigins(),new gn(Float32Array,this._getXYZdim(),this._getXYZbox(),1,this._toXYZData(),this._getVolumeInfo())}}]),e}();function Wc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var qc={extent:[Gc,"u32",0],type:[Vc,"u32",3],nstart:[Gc,"i32",4],grid:[Gc,"u32",7],cellDims:[Uc,"f32",10],angles:[Gc,"f32",13],crs2xyz:[Gc,"i32",16],dmin:[Vc,"f32",19],dmax:[Vc,"f32",20],dmean:[Vc,"f32",21],ispg:[Vc,"u32",22],nsymbt:[Vc,"u32",23],lksflg:[Vc,"u32",24],customData:[Hc,"buffer",25,9],origin:[Uc,"f32",34],map:[Hc,"buffer",52,1],machine:[Vc,"u32",53],sd:[Vc,"f32",54],nlabel:[Vc,"f32",55],label:[Hc,"buffer",56,200]},Xc=function(e){T(n,e);var t=Wc(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_parseHeader",value:function(e){this._buff=e,this._typedCheck();var t={};t.u32=new Uint32Array(this._buff,0,56),t.i32=new Int32Array(this._buff,0,56),t.f32=new Float32Array(this._buff,0,56),t.buffer=this._buff;var n=this._header;this._fillHeader(qc,t),n.angles.forEach((function(e,t,n){n[t]*=Math.PI/180}))}},{key:"_setAxisIndices",value:function(){var e=this._header;0===e.cellDims.x&&0===e.cellDims.y&&0===e.cellDims.z&&e.cellDims.set(1,1,1);var t=this._header.crs2xyz;0===t[0]&&0===t[1]&&0===t[2]&&(t[0]=1,t[1]=2,t[2]=3);var n=this._xyz2crs;n[t[0]-1]=0,n[t[1]-1]=1,n[t[2]-1]=2}},{key:"_setOrigins",value:function(){var e=c(this._getAxis(),3),t=e[0],n=e[1],r=e[2];this._setAxisIndices();var i=this._header,o=this._xyz2crs;if(0===i.origin.x&&0===i.origin.y&&0===i.origin.z?(this._origin.addScaledVector(t,i.nstart[o[0]]),this._origin.addScaledVector(n,i.nstart[o[1]]),this._origin.addScaledVector(r,i.nstart[o[2]])):this._origin=i.origin,t.multiplyScalar(i.extent[o[0]]-1),n.multiplyScalar(i.extent[o[1]]-1),r.multiplyScalar(i.extent[o[2]]-1),2!==i.type)throw new Error("CCP4: Unsupported format ".concat(i.type));this._data=new Float32Array(this._buff,1024+i.nsymbt,i.extent[0]*i.extent[1]*i.extent[2]),this._setBoxParams(t,n,r)}},{key:"_toXYZData",value:function(){var e=this._header,t=this._data,n=this._xyz2crs,r=new Float32Array(t.length),i=this._getXYZdim(),o=i[0],a=i[1],s=0,l=[];for(l[2]=0;l[2]<e.extent[2];l[2]++)for(l[1]=0;l[1]<e.extent[1];l[1]++)for(l[0]=0;l[0]<e.extent[0];l[0]++,s++)r[l[n[0]]+o*(l[n[1]]+a*l[n[2]])]=t[s];return r}}]),n}(jc),Yc=function(e){T(n,e);var t=Wc(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._options.fileType="ccp4",i.model=new Xc,i}return _(n,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canProbablyParse",value:function(e){return!1}}]),n}(Nl);function Zc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Yc.formats=["ccp4"],Yc.extensions=[".ccp4",".map",".mrc"],Yc.binary=!0;var $c=yn.Complex,Jc=yn.Element,Kc=yn.Molecule,Qc=function(e){T(n,e);var t=Zc(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._complex=null,i._atomsInf=null,i._options.fileType="xyz",i._fileName=r.name,i}return _(n,[{key:"_parseToAtomsInf",value:function(e){var t=e.indexOf("\n"),n=parseInt(e.substring(0,t),10),r=e.indexOf("\n",t+1),i=e.slice(t+1,r).trim();0===i.length&&(i=this._fileName);var o=r+e.substring(r).search(/\S/);this._atomsInf=e.substring(o).split(/[\s,]*\n[\s,]*/),Number.isNaN(n)||this._atomsInf.length-1===n?(this._complex.metadata.format="xyz",this._complex.name=i):this._complex.error={message:"wrong number of atoms"}}},{key:"_parseAtomsInf",value:function(){for(var e=this._complex.addChain("A").addResidue("UNK",1," "),t=0;t<this._atomsInf.length-1;t++){var n=this._atomsInf[t].split(/[\s,]+/);if(4!==n.length){this._complex.error={message:"missed parameters"};break}var r=t+1,i=n[0],o=new a.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),s=Jc.getByName(i);e.addAtom(i,s,o,void 0,!0,r," ",1,1,0)}var l=new Kc(this._complex,this._complex.name,1);l.residues=e,this._complex._molecules[0]=l}},{key:"parseSync",value:function(){var e=this._complex=new $c;if(this._parseToAtomsInf(this._data),this._parseAtomsInf(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex=null,this._atomsInf=null,e.error)throw new Error(e.error.message);return e}}],[{key:"canProbablyParse",value:function(e){return o.default.isString(e)&&/^\s*\d+ *\n[^\n]*\n\s*\w{1,3}\s+-?\d/.test(e)}}]),n}(Nl);function eu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Ee(Qc,"formats",["xyz"]),Ee(Qc,"extensions",[".xyz"]);var tu=yn.Complex,nu=yn.Element,ru=function(e){T(n,e);var t=eu(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._options.fileType="pubchem+json",i}return _(n,[{key:"parseSync",value:function(){return this.logger.info("Parsing PubChem JSON file..."),this._toComplex(JSON.parse(this._data))}},{key:"_toComplex",value:function(e){var t=new tu,n=e.PC_Compounds&&e.PC_Compounds[0];return n&&(this._extractAtoms(t,n),t.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing})),t}},{key:"_extractAtoms",value:function(e,t){var n=t.atoms&&t.atoms.aid,r=n&&t.atoms.element;if(!r||n.length!==r.length)throw new Error("Unable to parse atom elements");r=o.default.fromPairs(o.default.zip(n,r));var i={},s=t.coords&&t.coords[0],l=s&&s.conformers&&s.conformers[0],c=l&&l.x,u=l&&l.y,h=l&&l.z||[];if(!(n=s&&s.aid)||!c||!u)throw new Error("Coordinates are not found in the file");for(var f=e.addChain(" ").addResidue("UNK",1," "),d=0,p=n.length;d<p;++d){var m=n[d],v=nu.ByAtomicNumber[r[m]],g=new a.Vector3(c[d],u[d],h[d]||0);i[m]=f.addAtom(v.name,v,g,void 0,!0,m," ",1,0,0)}var y=t.bonds&&t.bonds.aid1,_=t.bonds&&t.bonds.aid2,x=t.bonds&&t.bonds.order||[];if(y&&_&&y.length===_.length)for(var b=0,w=y.length;b<w;++b)e.addBond(i[y[b]],i[_[b]],x[b]||1,0,!0)}}],[{key:"canProbablyParse",value:function(e){return o.default.isString(e)&&"{"===e[0]}}]),n}(Nl);ru.formats=["pubchem","pubchem+json","pc"],ru.extensions=[".json"];var iu=function(){function e(t){g(this,e),this._strings=t.split(/\r?\n|\r/),this._currentStart=0,this._currentStringIndx=0}return _(e,[{key:"setStart",value:function(e){e>=this._strings.length?(this._currentStart=this._strings.length-1,this._currentStringIndx=this._strings.length-1):(this._currentStart=e,this._currentStringIndx=e)}},{key:"getNextString",value:function(){return this._strings[++this._currentStringIndx]}},{key:"getCurrentString",value:function(){return this._strings[this._currentStringIndx]}},{key:"getStringFromStart",value:function(e){return this._currentStringIndx=this._currentStart+e,this._strings[this._currentStart+e]}},{key:"findNextDataItem",value:function(){for(var e=this.getNextString(),t=!1;!o.default.isUndefined(e)&&"$$$$"!==e.trim();){if(e.match(/>\s+<(.*)>/)){t=!0;break}e=this.getNextString()}return t}},{key:"findNextCompoundStart",value:function(){for(var e=this.getCurrentString();!o.default.isUndefined(e)&&"$$$$"!==e.trim();)e=this.getNextString();return this.setStart(++this._currentStringIndx),this.probablyHaveDataToParse()}},{key:"probablyHaveDataToParse",value:function(){return this._currentStringIndx<this._strings.length-2}}]),e}();function ou(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var au=yn.Complex,su=yn.Element,lu=yn.Bond,cu=yn.Molecule,uu=[0,3,2,1,0,-1,-2,-3],hu=[0,1,2,3,1,1,1,2],fu=[lu.BondType.UNKNOWN,lu.BondType.COVALENT,lu.BondType.COVALENT,lu.BondType.COVALENT,lu.BondType.AROMATIC,lu.BondType.UNKNOWN,lu.BondType.AROMATIC,lu.BondType.AROMATIC],du=/.*(M\s\sEND).*|.*(^$$$$).*|.*>\s+<(.+)>.*/,pu=/.*($$$$).*|.*>\s+<(.+)>.*/,mu="sdf",vu="mol",gu=["name","id","title"],yu={name:["PUBCHEM_IUPAC_TRADITIONAL_NAME",/PUBCHEM_(.+)_NAME/,/(.+)name/,/(.+)NAME/],id:["PUBCHEM_COMPOUND_CID","id","ID",/.*CID/,/.*ID/,/.*id/],title:["msg","MSG","message","title","description","desc"]},_u=function(e){T(n,e);var t=ou(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._format="sdf",i._complex=null,i._chain=null,i._residue=null,i._molecules=null,i._metadata={},i._metadata.molecules=[],i._currentMolProps={},i._compoundIndx=-1,i._assemblies=[],i._atomsParsed=0,i._atomsIndexes=[],i}return _(n,[{key:"canProbablyParse",value:function(e){return o.default.isString(e)&&du.test(e)}},{key:"_parseHeader",value:function(e){var t={};t.name=e.getStringFromStart(0);var n=parseInt(e.getStringFromStart(1).substr(10,6).trim(),10);t.date=n.toString()||"",t.title=e.getStringFromStart(2),this._metadata.molecules.push(t)}},{key:"_parseAtoms",value:function(e,t){var n,r=this._atomsParsed,i=function(e){if(!e)return"A";for(var t=[];e;)t.push(65+e%26),e=Math.trunc(e/26);return t.length>1&&(t.reverse(),t[0]-=1),String.fromCharCode.apply(String,t)}(this._compoundIndx);this._chain=this._complex.getChain(i)||this._complex.addChain(i),this._residue=this._chain.addResidue("UNK",1," ");for(var o=0;o<t;o++){n=e.getNextString(),r++;var s=parseFloat(n.substr(0,10)),l=parseFloat(n.substr(10,10)),c=parseFloat(n.substr(20,10)),u=uu[parseInt(n.substr(36,3),10)],h=new a.Vector3(s,l,c),f=n.substr(31,3).trim().toUpperCase(),d=su.getByName(f);this._atomsIndexes[f]||(this._atomsIndexes[f]=0),this._atomsIndexes[f]+=1,f+=this._atomsIndexes[f],this._residue.addAtom(f,d,h,void 0,!0,r," ",1,0,u)}}},{key:"_parseBonds",value:function(e,t){for(var n,r=0;r<t;r++){n=e.getNextString();var i=parseInt(n.substr(0,3),10)+this._atomsParsed,o=parseInt(n.substr(3,3),10)+this._atomsParsed,a=parseInt(n.substr(6,3),10);if(i>o){var s=[o,i];i=s[0],o=s[1]}this._complex.addBond(i,o,hu[a]||1,fu[a]||lu.BondType.UNKNOWN,!0)}}},{key:"_parseMOL",value:function(e){this._compoundIndx++,this._parseHeader(e);var t=e.getStringFromStart(3),n=parseInt(t.substr(0,3),10),r=parseInt(t.substr(3,3),10);this._parseAtoms(e,n),this._parseBonds(e,r),this._atomsParsed+=n,this._metadata.molecules[this._compoundIndx]._residues=[],this._metadata.molecules[this._compoundIndx]._residues.push(this._residue)}},{key:"_parseDataItem",value:function(e){for(var t=e.getCurrentString(),n=[],r=e.getNextString();""!==r.trim();)n.push(r),r=e.getNextString();1===n.length&&(n=c(n,1)[0]),this._currentMolProps[t.replace(/[<>]/g,"").trim()]=n}},{key:"_parseCompound",value:function(e){if(this._parseMOL(e),this._format===mu){for(this._currentMolProps={};e.findNextDataItem();)this._parseDataItem(e);if(0!==Object.keys(this._currentMolProps).length){var t=this._metadata.molecules[this._compoundIndx];t.props=this._currentMolProps,this._tryToUpdateMoleculeData(t)}}}},{key:"_fixBondsArray",value:function(){for(var e=this._serialAtomMap,t=this._complex._bonds,n=0;n<t.length;n++){var r=t[n];r._right<r._left&&console.log("_fixBondsArray: Logic error."),r._left=e[r._left]||null,r._right=e[r._right]||null}}},{key:"_buildAssemblies",value:function(){var e=this._complex._chains;if(1===e.length)return this._assemblies;for(var t=0;t<e.length;t++){var n=new kt(this._complex),r=new a.Matrix4;n.addMatrix(r),n.addChain(e[t]._name),this._assemblies.push(n)}return this._assemblies}},{key:"_buildMolecules",value:function(){this._complex._molecules=[];for(var e=this._metadata.molecules,t=0;t<e.length;t++){var n=new cu(this._complex,e[t].name,t+1);n.residues=e[t]._residues,this._complex._molecules[t]=n}return this._complex._molecules}},{key:"_searchTag",value:function(e,t){for(var n=0;n<t.length;n++)if(e instanceof RegExp&&e.test(t[n].tag)||e===t[n].tag)return t[n].data}},{key:"_tryToFind",value:function(e,t){for(var n=0;n<e.length;n++){var r=this._searchTag(e[n],t);if(r)return r}}},{key:"_tryToUpdateMoleculeData",value:function(e){for(var t=!1,n=0;n<gu.length;n++){var r=yu[gu[n]],i=this._tryToFind(r,e.props);i&&(e[gu[n]]=i,t=!0)}return e.name=e.name||e.id,e.name.match(/^\d+$/)&&(e.name="CID: ".concat(e.name)),t}},{key:"_finalizeMetadata",value:function(){var e=this._metadata.molecules,t=this._complex.metadata,n=this._complex;if(1===e.length)n.name=e[0].name,t.title=e[0].title,t.date=e[0].date,t.properties=e[0].props;else if(e.length>1){t.molecules=[];for(var r=0;r<e.length;r++)t.molecules.push({name:e[r].name,date:e[r].date,title:e[r].title,properties:e[r].props})}}},{key:"_finalize",value:function(){for(var e=this._serialAtomMap={},t=this._complex._atoms,n=0;n<t.length;n++){var r=t[n];e[r.serial]=r}this._complex._finalizeBonds(),this._fixBondsArray(),this._finalizeMetadata(),this._buildAssemblies(),this._complex.units=this._complex.units.concat(this._assemblies),this._buildMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:!1,enableEditing:!1,serialAtomMap:this._serialAtomMap})}},{key:"defineFormat",value:function(e){return pu.test(e)?mu:vu}},{key:"parseSync",value:function(){var e=this._complex=new au,t=new iu(this._data);this._format=this.defineFormat(this._data),e.metadata.format=this._format;do{this._parseCompound(t)}while(t.findNextCompoundStart());return this._finalize(),e}}]),n}(Nl);function xu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}_u.formats=["mol","sdf"],_u.extensions=[".mol",".sdf"];var bu={nstart:[Gc,"i16",0],extent:[Gc,"i16",3],grid:[Gc,"i16",6],cellDims:[Uc,"i16",9],angles:[Gc,"i16",12],div:[Vc,"i16",15],adder:[Vc,"i16",16],scaleFactor:[Vc,"i16",17]},wu=function(e){T(n,e);var t=xu(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"_parseHeader",value:function(e){this._buff=e,this._typedCheck();var t={};if(t.i16=new Int16Array(this._buff),100!==t.i16[18])for(var n=0,r=t.i16.length;n<r;++n){var i=t.i16[n];t.i16[n]=(255&i)<<8|i>>8&255}if(100!==t.i16[18])throw new Error("DSN6: Incorrect format ");var o=this._header;this._fillHeader(bu,t),o.cellDims.multiplyScalar(1/o.scaleFactor),o.angles.forEach((function(e,t,n){n[t]*=Math.PI/180/o.scaleFactor})),o.div/=100}},{key:"_setAxisIndices",value:function(){this._xyz2crs[0]=0,this._xyz2crs[1]=1,this._xyz2crs[2]=2}},{key:"_setOrigins",value:function(){var e=this._header,t=c(this._getAxis(),3),n=t[0],r=t[1],i=t[2];this._setAxisIndices(),this._origin.addScaledVector(n,e.nstart[0]),this._origin.addScaledVector(r,e.nstart[1]),this._origin.addScaledVector(i,e.nstart[2]),n.multiplyScalar(e.extent[0]),r.multiplyScalar(e.extent[1]),i.multiplyScalar(e.extent[2]),this._setBoxParams(n,r,i)}},{key:"_pointCalculate",value:function(e,t,n,r,i,o,a){var s=this._header;return i<s.extent[0]&&r<s.extent[1]&&n<s.extent[2]?(e[i+s.extent[0]*(r+s.extent[1]*n)]=(t[o.counter]-s.adder)/s.div,++o.counter,!0):(o.counter+=8-a,!1)}},{key:"_blockCalculate",value:function(e,t,n,r,i,o){for(var a=0;a<8;++a)for(var s=8*n+a,l=0;l<8;++l)for(var c=8*r+l,u=!0,h=0;u&&h<8;){var f=8*i+h;u=this._pointCalculate(e,t,s,c,f,o,h),h++}}},{key:"_toXYZData",value:function(){for(var e=this._header,t=new Uint8Array(this._buff),n=new Float32Array(e.extent[0]*e.extent[1]*e.extent[2]),r=new a.Vector3(e.extent[0]/8,e.extent[1]/8,e.extent[2]/8),i={counter:512},o=0;o<r.z;++o)for(var s=0;s<r.y;++s)for(var l=0;l<r.x;++l)this._blockCalculate(n,t,o,s,l,i);return this._calculateInfoParams(n),n}},{key:"_calculateInfoParams",value:function(e){this._header.dmean/=e.length;for(var t=0,n=e[0],r=e[0],i=0;i<e.length;i++)t+=Math.pow(this._header.dmean-e[i],2),e[i]<n&&(n=e[i]),e[i]>r&&(r=e[i]);this._header.sd=Math.sqrt(t/e.length),this._header.dmax=r,this._header.dmin=n}}]),n}(jc),Su=function(e){T(n,e);var t=xu(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._options.fileType="dsn6",i.model=new wu,i}return _(n,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canParse",value:function(e,t){return!!e&&e instanceof ArrayBuffer&&Nl.checkDataTypeOptions(t,"dsn6")}},{key:"canProbablyParse",value:function(e){return!1}}]),n}(Nl);function Mu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Su.formats=["dsn6"],Su.extensions=[".dsn6",".omap"],Su.binary=!0;var Eu=function(e){T(n,e);var t=Mu(n);function n(e){var r;return g(this,n),(r=t.call(this,e))._next=-1,r.next(),r}return _(n,[{key:"getNext",value:function(){return this._next}}]),n}(zl);function Tu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Au=yn.Complex,Cu=yn.Element,Ru=yn.Molecule,Pu=function(e){T(n,e);var t=Tu(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._time=null,i._numAtoms=null,i._residueNumber=null,i._residueName="",i._atomName="",i._atomNumber=null,i._atomPosition=[],i._atomVelocity=[],i._complex=null,i._molecules=[],i._molecule=null,i._options.filetype="gro",i}return _(n,[{key:"canProbablyParse",value:function(e){return o.default.isString(this._data)&&/^\s*[^\n]*\n\s*\d+ *\n\s*\d+[^\n\d]{3}\s*\w+\s*\d+\s*-?\d/.test(e)}},{key:"_parseTitle",value:function(e){var t=this._complex.metadata;t.id=e.readLine().trim(),t.name=t.id.slice(t.id.lastIndexOf("\\")+1,t.id.lastIndexOf(".")),t.format="gro"}},{key:"_parseNumberOfAtoms",value:function(e){if(this._numAtoms=e.readInt(0,e.getNext()),Number.isNaN(this._numAtoms))throw new Error("Line 2 is not representing atom number. Consider checking input file")}},{key:"_parseAtom",value:function(e){this._residueNumber=e.readInt(1,5),this._residueName=e.readString(6,10).trim(),this._atomName=e.readString(11,15).trim(),this._atomNumber=e.readInt(16,20);var t=10*e.readFloat(21,28),n=10*e.readFloat(29,36),r=10*e.readFloat(37,45);if(Number.isNaN(t)||Number.isNaN(n)||Number.isNaN(r))this._complex.error={message:'Atom position is invalid in "'.concat(e.readLine(),'"')};else{var i=Cu.getByName(this._atomName[0]);if("Unknown"!==i.fullName){var o=Cu.Role[this._atomName],s=this._chain;s||(this._chain=s=this._complex.addChain("A"));var l=this._residue;l&&l.getSequence()===this._residueNumber||(this._residue=l=s.addResidue(this._residueName,this._residueNumber," ")),this._atomPosition=new a.Vector3(t,n,r),l.addAtom(this._atomName,i,this._atomPosition,o,!0,this._atomNumber," ",1,1,0)}else this._complex.error={message:"".concat(this._atomName[0]," hasn't been recognised as an atom name.")}}}},{key:"_finalize",value:function(){var e=new Ru(this._complex,this._complex.metadata.name,1);e.residues=this._chain._residues,e._chains=this._chain,this._complex._molecules[0]=e,this._molecules.push(e),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"parseSync",value:function(){var e=this._complex=new Au,t=new Eu(this._data),n=0;for(this._parseTitle(t),t.next(),this._parseNumberOfAtoms(t),t.next(),n=0;n<this._numAtoms&&!t.end();++n)this._parseAtom(t),t.next();if(n<this._numAtoms&&(this._complex.error={message:"File ended unexpectedly."}),e.error)throw new Error(e.error.message);return this._finalize(),this._atomPosition=null,this._complex=null,this._molecules=null,this._molecule=null,e}}]),n}(Nl);function Lu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Pu.formats=["gro"],Pu.extensions=[".gro"];var ku=yn.Complex,Iu=yn.Element,Nu=yn.Bond,Ou=yn.Molecule,Du={un:0,1:1,2:2,3:3,ar:1,am:1,nc:0,du:1},Bu={un:Nu.BondType.UNKNOWN,1:Nu.BondType.COVALENT,2:Nu.BondType.COVALENT,3:Nu.BondType.COVALENT,ar:Nu.BondType.AROMATIC,am:Nu.BondType.COVALENT,nc:Nu.BondType.UNKNOWN,du:Nu.BondType.COVALENT},zu=/\d+$/,Fu=/\s+/;function Vu(e){return e.trim().split(Fu)}var Uu=function(e){T(n,e);var t=Lu(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._complex=null,i._chain=null,i._residue=null,i._compoundIndx=-1,i._molecules=[],i._molecule=null,i._currPosIdx=0,i._currStartIdx=0,i._serialAtomMap={},i._options.fileType="mol2",i}return _(n,[{key:"_parseRawStrings",value:function(e){return e.split(/\r?\n|\r/)}},{key:"_toStringFromStart",value:function(e,t){var n=this._currStartIdx+e;this._currPosIdx=n<t.length?n:this._currStartIdx}},{key:"_toHeaderString",value:function(e,t){for(this._toStringFromStart(0,t);this._currPosIdx<t.length;){if(t[this._currPosIdx].match("@<TRIPOS>".concat(e)))return;this._currPosIdx++}this._toStringFromStart(0,t)}},{key:"_toStringFromHeader",value:function(e,t,n){this._toHeaderString(e,n);var r=this._currPosIdx+t;n[this._currPosIdx].match("@<TRIPOS>".concat(e))&&r<n.length&&(this._currPosIdx=r)}},{key:"_setStart",value:function(e,t){e>=t.length?this._currStartIdx=this._currPosIdx=t.length-1:this._currStartIdx=this._currPosIdx=e}},{key:"_probablyHaveDataToParse",value:function(e){return this._currPosIdx<e.length-2}},{key:"_findNextCompoundStart",value:function(e){for(;this._currPosIdx<e.length&&"@<TRIPOS>MOLECULE>"!==e[this._currPosIdx].trim();)this._currPosIdx++;return this._setStart(++this._currPosIdx,e),this._probablyHaveDataToParse(e)}},{key:"_parseMolecule",value:function(e){this._toHeaderString("MOLECULE",e);var t=this._complex.metadata;t.name=e[++this._currPosIdx],t.format="mol2",this._molecule={_index:"",_chains:[]},this._molecule._index=this._compoundIndx+1,this._molecules.push(this._molecule)}},{key:"_parseAtoms",value:function(e,t){this._toHeaderString("ATOM",t);for(var n=0;n<e;n++){var r=Vu(t[++this._currPosIdx]);if(r.length<6)throw new Error("MOL2 parsing error: Not enough information to create atom!");var i=parseInt(r[0],10),o=r[1],s=parseFloat(r[2]),l=parseFloat(r[3]),c=parseFloat(r[4]),u=r[5].split(".")[0].toUpperCase(),h=0;r.length>=9&&(h=parseFloat(r[8])||0);var f=this._chain;if(f||(this._chain=f=this._complex.getChain("A")||this._complex.addChain("A"),this._residue=null),this._setResidue(r)){var d=Iu.getByName(u),p=Iu.Role[o],m=new a.Vector3(s,l,c);this._residue.addAtom(o,d,m,p,!1,i," ",1,0,h)}}}},{key:"_setResidue",value:function(e){var t=1,n="UNK";if(e.length>=7&&(t=parseInt(e[6],10)),e.length>=8&&"<0>"!==e[7]&&(n=e[7].replace(zu,"")),this.settings.now.nowater&&("HOH"===n||"WAT"===n))return!1;var r=this._residue,i=this._chain;return r&&r.getSequence()===t||(this._residue=i.addResidue(n,t,"A")),!0}},{key:"_parseBonds",value:function(e,t){this._toHeaderString("BOND",t);for(var n=0;n<e;n++){var r=Vu(t[++this._currPosIdx]);if(r.length<3)throw new Error("MOL2 parsing error: Missing information about bonds!");var i=parseInt(r[1],10),o=parseInt(r[2],10),a=r[3];if(i>o){var s=[o,i];i=s[0],o=s[1]}this._complex.addBond(i,o,Du[a]||0,Bu[a]||Nu.BondType.UNKNOWN,!0)}}},{key:"_fixSerialAtoms",value:function(){for(var e=this._complex._atoms,t=0;t<e.length;t++){var n=e[t];this._serialAtomMap[n.serial]=n}}},{key:"_fixBondsArray",value:function(){var e=this._serialAtomMap,t=this._complex;if(0===Object.keys(e).length)throw new Error("MOL2 parsing error: Missing atom information!");for(var n=t._bonds,r=0;r<n.length;r++){var i=n[r];i._left=e[i._left]||null,i._right=e[i._right]||null}}},{key:"_finalizeMolecules",value:function(){var e=this._complex._chains[0];this._complex._molecules=[];for(var t=0;t<this._molecules.length;t++){var n=this._molecules[t],r=e._residues,i=new Ou(this._complex,n._name,t+1);i.residues=r,this._complex._molecules[t]=i}}},{key:"_finalize",value:function(){this._complex._finalizeBonds(),this._fixSerialAtoms(),this._fixBondsArray(),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_parseCompound",value:function(e){this._compoundIndx++,this._parseMolecule(e),this._toStringFromHeader("MOLECULE",2,e);var t=e[this._currPosIdx].trim().split(Fu),n=t[0],r=t[1];this._parseAtoms(n,e),this._parseBonds(r,e)}},{key:"parseSync",value:function(){var e=this._complex=new ku,t=this._parseRawStrings(this._data);do{this._parseCompound(t)}while(this._findNextCompoundStart(t));return this._finalize(),e}}]),n}(Nl);Uu.formats=["mol2"],Uu.extensions=[".mol2",".ml2",".sy2"];var Gu=new Il([Zl,Fc,xc,Qc,rc,ru,_u,Yc,Su,Pu,Uu]);function Hu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ju=function(e){T(n,e);var t=Hu(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return g(this,n),t.call(this,e,["formats"])}return _(n,[{key:"find",value:function(e){var t=[];return e.format&&(t=this._dict.formats[e.format.toLowerCase()]||[]),zn(t)}}]),n}(Vn),Wu=function(){function e(t,n){g(this,e),this._source=t,this._options=n||{},this._abort=!1}return _(e,[{key:"exportSync",value:function(){throw new Error("Exporting to this source is not implemented")}},{key:"export",value:function(){var e=this;return new Promise((function(t,n){setTimeout((function(){try{return e._abort?n(new Error("Export aborted")):t(e.exportSync())}catch(e){return n(e)}}))}))}},{key:"abort",value:function(){this._abort=!0}}]),e}();Un(Wu.prototype);var qu=function(){function e(){g(this,e),this._resultArray=[],this._currentStr=-1,this._tag=null,this._fixedNumeration=!1,this._numeration=!1,this._tagStrNum=0}return _(e,[{key:"getResult",value:function(){return this.writeString("\n",81,81),this._resultArray.join("")}},{key:"_currentStrLength",value:function(){var e=this._resultArray[this._currentStr];return e?e.length:0}},{key:"newTag",value:function(e,t){this._tag=e||null,o.default.isUndefined(t)?(this._numeration=!1,this._fixedNumeration=!1,this._tagStrNum=0):o.default.isNumber(t)?(this._tagStrNum=t,this._numeration=!0,this._fixedNumeration=!0):o.default.isBoolean(t)&&(this._tagStrNum=0,this._numeration=t,this._fixedNumeration=!1)}},{key:"newString",value:function(e){this.writeString("\n",81,81),this._currentStr++,this._resultArray.push(""),e?this.writeString(e,1,6):this._tag&&this.writeString(this._tag,1,6),this._numeration&&(this._fixedNumeration||this._tagStrNum++,1!==this._tagStrNum&&this.writeString(this._tagStrNum.toString(),10,8))}},{key:"writeEntireString",value:function(e,t,n){t||(t=81);for(var r=0;r<e.length;r++)this._currentStrLength()===t&&r!==e.length-1&&(this.newString(),n&&this.writeString(n.tag,n.begin,n.end)),"\n"===e[r]?this.newString():this.writeString(e[r])}},{key:"writeString",value:function(e,t,n){var r,i=this._resultArray[this._currentStr],a=i?i.length:0;if(!o.default.isUndefined(e)){o.default.isNumber(t)||(t=a+1),o.default.isNumber(n)||(n=a+e.length);var s=t<n?n:t,l=t<n?t:n;if((r=o.default.isString(e)?e:e.toString()).length>Math.abs(t-n)+1&&(r=r.substr(0,Math.abs(t-n+1))),l>a+1)this._resultArray[this._currentStr]+=" ".repeat(l-a-1);else if(l<=a){var c=this._resultArray[this._currentStr];this._resultArray[this._currentStr]=c.slice(0,l-1)}n<t&&(r=" ".repeat(t-n+1-r.length)+r),11===l&&this._numeration&&1!==this._tagStrNum&&(r=" ".concat(r)),this._resultArray[this._currentStr]+=r,s>(i=this._resultArray[this._currentStr]).length&&(this._resultArray[this._currentStr]+=" ".repeat(s-i.length))}}},{key:"writeBondsArray",value:function(e,t){for(var n=this._getSubArrays(e,4),r=0;r<n.length;r++){this.newString(),this.writeString(t.serial,11,7);for(var i=0;i<n[r].length;i++){var o=n[r][i]._left.serial===t.serial?n[r][i]._right.serial:n[r][i]._left.serial;this.writeString(o,16+5*i,12+5*i)}}}},{key:"_getSubArrays",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}},{key:"writeMatrix",value:function(e,t,n){for(var r=0;r<3;r++){this.newString(),this.writeString(n,14,18),this.writeString((r+1).toString(),19,19),this.writeString(t.toString(),23,20);for(var i=0;i<3;i++){var o=parseFloat(e.elements[4*r+i]).toFixed(6);this.writeString(o.toString(),33+10*i,24+10*i)}var a=parseFloat(e.elements[4*r+3]).toFixed(5);this.writeString(a.toString(),68,55)}}},{key:"writeMatrices",value:function(e,t){if(e)for(var r=new n.Matrix4,i=0;i<e.length;i++)r.copy(e[i]).transpose(),this.writeMatrix(r,i+1,t)}}]),e}();function Xu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var Yu=function(e){T(n,e);var t=Xu(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._tags=["HEADER","TITLE","COMPND","REMARK","HELIX","SHEET","ATOM and HETATM","CONECT"],i._result=null,i._tagExtractors={HEADER:i._extractHEADER,TITLE:i._extractTITLE,"ATOM and HETATM":i._extractATOM,CONECT:i._extractCONECT,COMPND:i._extractCOMPND,REMARK:i._extractREMARK,HELIX:i._extractHELIX,SHEET:i._extractSHEET},i._stringForRemark350="COORDINATES FOR A COMPLETE MULTIMER REPRESENTING THE KNOWN\nBIOLOGICALLY SIGNIFICANT OLIGOMERIZATION STATE OF THE\nMOLECULE CAN BE GENERATED BY APPLYING BIOMT TRANSFORMATIONS\nGIVEN BELOW.  BOTH NON-CRYSTALLOGRAPHIC AND\nCRYSTALLOGRAPHIC OPERATIONS ARE GIVEN.",i._stringForRemark290="CRYSTALLOGRAPHIC SYMMETRY TRANSFORMATIONS\nTHE FOLLOWING TRANSFORMATIONS OPERATE ON THE ATOM/HETATM\nRECORDS IN THIS ENTRY TO PRODUCE CRYSTALLOGRAPHICALLY\nRELATED MOLECULES.",i}return _(n,[{key:"exportSync",value:function(){var e=new qu;if(!this._source)return this._result;for(var t=0;t<this._tags.length;t++){var n=this._tags[t],r=this._tagExtractors[n];o.default.isFunction(r)&&r.call(this,e)}return this._result=e.getResult(),this._result}},{key:"_extractHEADER",value:function(e){if(this._source.metadata){var t=this._source.metadata;e.newTag("HEADER"),e.newString(),t.classification&&e.writeString(t.classification,11,50),t.date&&e.writeString(t.date,51,59),t.id&&e.writeString(t.id,63,66)}}},{key:"_extractTITLE",value:function(e){if(this._source.metadata){var t=this._source.metadata;if(t.title){e.newTag("TITLE",!0);for(var n=0;n<t.title.length;n++)e.newString(),e.writeString(t.title[n],11,80)}}}},{key:"_extractCONECT",value:function(e){if(this._source._atoms){var t=this._source._atoms;e.newTag("CONECT");for(var n=0;n<t.length;n++){var r=t[n].bonds.filter((function(e){return e._fixed}));0!==r.length&&e.writeBondsArray(r.reverse(),t[n])}}}},{key:"_extractSHEET",value:function(e){if(this._source._sheets){e.newTag("SHEET");for(var t=this._source._sheets,n=0;n<t.length;n++)if(t[n]._strands)for(var r=t[n]._strands,i=0;i<r.length;i++)e.newString(),e.writeString(i+1,10,8),e.writeString(t[n]._name,14,12),e.writeString(r.length,16,15),e.writeString(r[i].init._type._name,18,20),e.writeString(r[i].init._chain._name,22,22),e.writeString(r[i].init._sequence,26,23),e.writeString(r[i].init._icode,27,27),e.writeString(r[i].term._type._name,29,31),e.writeString(r[i].init._chain._name,33,33),e.writeString(r[i].term._sequence,37,34),e.writeString(r[i].term._icode,38,38),e.writeString(r[i].sense,40,39)}}},{key:"_extractHELIX",value:function(e){if(this._source._helices){e.newTag("HELIX");for(var t=this._source._helices,n=0;n<t.length;n++){var r=t[n],i=o.default.invert($e);e.newString(),e.writeString(r.serial,10,8),e.writeString(r.name,14,12),e.writeString(r.init._type._name,16,18),e.writeString(r.init._chain._name,20,20),e.writeString(r.init._sequence,25,22),e.writeString(r.init._icode,26,26),e.writeString(r.term._type._name,28,30),e.writeString(r.term._chain._name,32,32),e.writeString(r.term._sequence,37,34),e.writeString(r.term._icode,38,38),e.writeString(i[r.type],40,39),e.writeString(r.comment,41,70),e.writeString(r.length,76,72)}}}},{key:"_extractATOM",value:function(e){if(this._source._atoms)for(var t=this._source._atoms,n=0;n<t.length;n++){var r=t[n].het?"HETATM":"ATOM";e.newString(r);var i=t[n].element.name.length>1||t[n].name.length>3?13:14;e.writeString(t[n].serial,11,7),e.writeString(t[n].name,i,16),e.writeString(String.fromCharCode(t[n].location),17,17),e.writeString(t[n].residue._type._name,20,18),e.writeString(t[n].residue._chain._name,22,22),e.writeString(t[n].residue._sequence,26,23),e.writeString(t[n].residue._icode,27,27),e.writeString(t[n].position.x.toFixed(3),38,31),e.writeString(t[n].position.y.toFixed(3),46,39),e.writeString(t[n].position.z.toFixed(3),54,47),e.writeString(t[n].occupancy.toFixed(2),60,55),e.writeString(t[n].temperature.toFixed(2),66,61),e.writeString(t[n].element.name,78,77),t[n].charge&&e.writeString(t[n].charge,79,80)}}},{key:"_extractCOMPND",value:function(e){if(this._source._molecules){var t=this._source._molecules;e.newTag("COMPND",!0);for(var n=0;n<t.length;n++){var r=this._getMoleculeChains(t[n]);e.newString(),e.writeString("MOL_ID: ".concat(t[n].index,";"),11,80),e.newString(),e.writeString("MOLECULE: ".concat(t[n].name,";"),11,80),e.newString(),e.writeString("CHAIN: ",11,18);var i="".concat(r.join(", "),";");e.writeEntireString(i,81)}}}},{key:"_extractREMARK",value:function(e){this._Remark290(e),this._Remark350(e)}},{key:"_Remark290",value:function(e){if(this._source.symmetry&&0!==this._source.symmetry.length){var t=this._source.symmetry;e.newTag("REMARK",290),e.newString(),e.newString(),e.writeEntireString(this._stringForRemark290),e.writeMatrices(t,"SMTRY"),e.newString(),e.newString(),e.writeString("REMARK: NULL",11,80)}}},{key:"_Remark350",value:function(e){if(this._source.units){var t=this._source.units,n=0;e.newTag("REMARK",350),e.newString(),e.newString(),e.writeEntireString(this._stringForRemark350);for(var r=t.filter((function(e){return e instanceof kt})),i=0;i<r.length;i++){e.newString(),e.newString(),n++,e.writeString("BIOMOLECULE: ".concat(n),11,80);var o=r[i].chains.join(", ");e.newString(),e.writeString("APPLY THE FOLLOWING TO CHAINS: "),e.writeEntireString(o,69,{tag:"AND CHAINS: ",begin:31,end:42});var a=r[i].matrices;e.writeMatrices(a,"BIOMT")}}}},{key:"_getMoleculeChains",value:function(e){var t=e.residues.map((function(e){return e._chain._name}));return t.filter((function(e,n){return t.indexOf(e)===n}))}}]),n}(Wu);function Zu(e,t,n,r){n[r]=e[t],n[r+1]=e[t+1],n[r+2]=e[t+2]}function $u(e,t,n,r,i){n[r]=e[t],n[r+1]=e[t+1],n[r+2]=e[t+2],n[r+3]=i}Yu.formats=["pdb"],Yu.SourceClass=mn;var Ju=new a.Vector4;function Ku(e,t,n,r,i){Ju.set(e[t],e[t+1],e[t+2],i.w),Ju.applyMatrix4(i.matrix),n[r]=Ju.x,n[r+1]=Ju.y,n[r+2]=Ju.z}function Qu(e,t,n,r,i){if(!((t.array.length-t.start)/t.stride<n||(e.array.length-e.start)/e.stride<n))if(e.stride===t.stride)t.array.set(e.array,t.start);else for(var o=t.start,a=e.start,s=0;s<n;++s,o+=t.stride,a+=e.stride)r(e.array,a,t.array,o,i)}var eh=function(){function e(){g(this,e),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.lastPos=0,this.lastNorm=0,this.lastCol=0,this.lastIdx=0}return _(e,[{key:"init",value:function(e,t){this.positions=new Float32Array(3*e),this.normals=new Float32Array(3*e),this.colors=new Float32Array(4*e),this.indices=new Int32Array(t)}},{key:"setPositions",value:function(e,t,n,r){Qu({array:e,start:t,stride:r},{array:this.positions,start:this.lastPos,stride:3},n,Zu),this.lastPos+=3*n}},{key:"setTransformedPositions",value:function(e,t,n,r,i){for(var o=this.lastPos,a=t,s={matrix:i,w:1},l=0;l<n;++l,a+=r,o+=3)Ku(e,a,this.positions,o,s);this.lastPos+=3*n}},{key:"setNormals",value:function(e,t,n,r){Qu({array:e,start:t,stride:r},{array:this.normals,start:this.lastNorm,stride:3},n,Zu),this.lastNorm+=3*n}},{key:"setTransformedNormals",value:function(e,t,n,r,i){for(var o=this.lastNorm,a=t,s={matrix:i,w:0},l=0;l<n;++l,a+=r,o+=3)Ku(e,a,this.normals,o,s);this.lastNorm+=3*n}},{key:"setColors",value:function(e,t,n,r){Qu({array:e,start:t,stride:r},{array:this.colors,start:this.lastCol,stride:4},n,$u,1),this.lastCol+=4*n}},{key:"setIndices",value:function(e,t,n){this.indices.set(e,this.lastIdx),this.lastIdx+=n}},{key:"setShiftedIndices",value:function(e,t,n){var r=e.map((function(e){return e+n}));this.setIndices(r,0,t)}},{key:"getVerticesNumber",value:function(){return this.lastPos/3}},{key:"addInstance",value:function(e,t){var n=this.getVerticesNumber();this.setShiftedIndices(t.indices,t.indices.length,n);var r=t.itemSize;this.setTransformedPositions(t.positions,0,t.vertsCount,r.position,e),this.setTransformedNormals(t.normals,0,t.vertsCount,r.normal,e),this.setColors(t.colors,0,t.vertsCount,r.color)}}]),e}(),th=function(){function e(){g(this,e),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.vertsCount=0,this.itemSize=null}return _(e,[{key:"init",value:function(e,t){var n=e.attributes;this.itemSize={position:n.position.itemSize,normal:n.normal.itemSize,color:n.color.itemSize}}}]),e}();function nh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var rh=function(e){T(n,e);var t=nh(n);function n(){return g(this,n),t.apply(this,arguments)}return _(n,[{key:"init",value:function(e,t){Qe(P(n.prototype),"init",this).call(this,e,t);var r=e.attributes,i=r.position,o=r.normal,a=e.index;this.vertsCount=i.count,this.positions=i.array,this.normals=o.array,this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this.indices=a.array}},{key:"setColors",value:function(e){for(var t=0,n=0,r=this.colors.length,i=this.itemSize.color;n<r;n+=i)this.colors[t++]=e.r,this.colors[t++]=e.g,this.colors[t++]=e.b}}]),n}(th);function ih(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var oh=function(e){T(n,e);var t=ih(n);function n(){var e;return g(this,n),(e=t.call(this))._cutRawStart=0,e._cutRawEnd=0,e._facesPerSlice=0,e}return _(n,[{key:"init",value:function(e,t){Qe(P(n.prototype),"init",this).call(this,e,t);var r=e.attributes.position,i=e.index;this.vertsCount=r.count+t.addPerCylinder,this._facesPerSlice=t.addPerCylinder,this.positions=new Float32Array(this.vertsCount*r.itemSize),this.normals=new Float32Array(this.vertsCount*this.itemSize.normal),this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this._extendVertices(e,t),this.indices=new Uint32Array(i.count),this._extendIndices(e,t)}},{key:"_extendVertices",value:function(e,t){var n=e.attributes.position,r=e.attributes.normal,i=e.getGeoParams();this._cutRawStart=1*i.radialSegments,this._cutRawEnd=this._cutRawStart+t.addPerCylinder;var o=n.array.slice(0,this._cutRawEnd*n.itemSize);this.positions.set(o,0),o=r.array.slice(0,this._cutRawEnd*r.itemSize),this.normals.set(o,0);var a=n.array.slice(this._cutRawStart*n.itemSize,n.array.length);this.positions.set(a,this._cutRawEnd*n.itemSize),a=r.array.slice(this._cutRawStart*r.itemSize,r.array.length),this.normals.set(a,this._cutRawEnd*r.itemSize)}},{key:"_extendIndices",value:function(e,t){var n=e.index,r=6*t.addPerCylinder,i=t.addPerCylinder,o=n.array.slice(r,n.count);o=o.map((function(e){return e+i})),this.indices.set(n.array,0),this.indices.set(o,r)}},{key:"_setColorRange",value:function(e,t,n,r){for(var i=r.length,o=e;o<t;o+=i)n.set(r,o)}},{key:"setColors",value:function(e,t){var n=this.itemSize.color,r=this._cutRawEnd*n,i=2*r;if(this._setColorRange(0,r,this.colors,e.toArray()),this._setColorRange(r,i,this.colors,t.toArray()),i<this.colors.length){var o=(this._facesPerSlice+1)*n,a=i+o;this._setColorRange(i,a,this.colors,t.toArray());var s=a+o;this._setColorRange(a,s,this.colors,e.toArray())}}}]),n}(th),ah=function(){function e(){g(this,e),this._materials=[],this._models=[]}return _(e,[{key:"process",value:function(e){this._extractModelsAndMaterials(e);var t=this._flattenModels();return{name:e.name,models:t,materials:this._materials}}},{key:"_extractModelsAndMaterials",value:function(e){var t=this,n=new a.Layers;n.set(Nn.LAYERS.DEFAULT),n.enable(Nn.LAYERS.TRANSPARENT),e.traverse((function(e){e instanceof a.Mesh&&e.layers.test(n)&&t.checkExportAbility(e)&&("InstancedBufferGeometry"===e.geometry.type?t._collectInstancedGeoInfo(e):t._collectGeoInfo(e))}))}},{key:"_reworkIndices",value:function(e){for(var t=2;t<e.length;t+=3)e[t]*=-1,e[t]--}},{key:"_flattenModels",value:function(){var e=0;function t(t){return t+e}for(var n=[],r=0,i=this._models.length;r<i;r++){var o=this._models[r],a=[],s=[],l=[],c=[];e=0;for(var u=0;u<o.length;u++){var h=o[u];a.push(h.indices.map(t)),e+=h.getVerticesNumber(),s.push(h.positions),l.push(h.normals),c.push(h.colors)}a=Q.mergeTypedArraysUnsafe(a),this._reworkIndices(a),s=Q.mergeTypedArraysUnsafe(s),l=Q.mergeTypedArraysUnsafe(l),c=Q.mergeTypedArraysUnsafe(c),n.push({indices:a,positions:s,normals:l,colors:c,verticesCount:e})}return n}},{key:"checkExportAbility",value:function(e){return!(0===e.geometry.attributes.position.count||(e instanceof Vi?(F.warn("Currently we cannot export 'sprites' modes, like BS, WV, LC. Please turn of settings 'zSprites' and try again"),1):e instanceof Ji&&(F.warn("Currently we cannot export Lines mode"),1)))}},{key:"_collectGeoInfo",value:function(e){var t=e.geometry,n=t.attributes,r=n.position,i=n.color,o=n.normal,a=t.index,s=e.matrix,l=new eh,c=r.count;l.init(c,a.count),s.isIdentity()?(l.setPositions(r.array,0,c,r.itemSize),l.setNormals(o.array,0,c,o.itemSize)):(l.setTransformedPositions(r.array,0,c,r.itemSize,s),l.setTransformedNormals(o.array,0,c,o.itemSize,s)),l.setColors(i.array,0,c,i.itemSize),l.setIndices(a.array,0,a.count);var u=this._collectMaterialInfo(e);this._addToPool(l,u)}},{key:"_collectSpheresInfo",value:function(e){var t=e.geometry,n=t.attributes,r=n.position,i=n.color,o=t.index,s=e.matrix,l=new eh,c=e.geometry.instanceCount,u=r.count,h=o.count;l.init(c*u,c*h);var f=new rh;f.init(e.geometry);for(var d=new a.Matrix4,p=new a.Matrix4,m=new a.Color,v=0;v<c;++v){var g=v*i.itemSize;m.fromArray(i.array,g),f.setColors(m),this._getSphereInstanceMatrix(e.geometry,v,d),p.multiplyMatrices(s,d),l.addInstance(p,f)}var y=this._collectMaterialInfo(e);this._addToPool(l,y)}},{key:"_collectCylindersInfo",value:function(e){var t=e.geometry,n=t.attributes,r=n.position,i=n.color,o=n.color2,s=t.index,l=e.matrix,c=new eh,u=e.geometry.instanceCount,h=new rh;h.init(e.geometry);var f=this._gatherCylindersColoringInfo(e.geometry),d=null;f.needToSplit>0&&(d=new oh).init(e.geometry,f);var p=f.addPerCylinder*f.needToSplit,m=r.count,v=s.count;c.init(u*m+p,u*v);for(var g=new a.Matrix4,y=new a.Matrix4,_=new a.Color,x=new a.Color,b={},w=0;w<u;++w){var S=w*i.itemSize;f.is2Colored[w]?(_.fromArray(o.array,S),x.fromArray(i.array,S),d&&(d.setColors(_,x),b=d)):(_.fromArray(i.array,S),h.setColors(_),b=h),this._getCylinderInstanceMatrix(e.geometry,w,g),y.multiplyMatrices(l,g),c.addInstance(y,b)}var M=this._collectMaterialInfo(e);this._addToPool(c,M)}},{key:"_addToPool",value:function(e,t){var n=this._checkExistingMaterial(t);n<0?(this._models.push([e]),this._materials.push(t)):this._models[n].push(e)}},{key:"_checkExistingMaterial",value:function(e){return o.default.findIndex(this._materials,(function(t){return o.default.isEqual(t,e)}))}},{key:"_gatherCylindersColoringInfo",value:function(e){for(var t=e.instanceCount,n=e.attributes.color.array,r=e.attributes.color2.array,i=e.attributes.color.itemSize,o=new Array(t),a=0,s=0,l=0;l<t;l++,s+=i){var c=Math.abs(n[s]-r[s])>1e-7||Math.abs(n[s+1]-r[s+1])>1e-7||Math.abs(n[s+2]-r[s+2])>1e-7;o[l]=c,a+=c}return{is2Colored:o,needToSplit:a,addPerCylinder:e.getGeoParams().radialSegments}}},{key:"_collectInstancedGeoInfo",value:function(e){e.geometry instanceof Yn?this._collectSpheresInfo(e):e.geometry instanceof pr&&this._collectCylindersInfo(e)}},{key:"_collectMaterialInfo",value:function(e){var t=e.material.uberOptions;return{diffuse:t.diffuse.toArray(),opacity:t.opacity,shininess:t.shininess,specular:t.specular.toArray()}}},{key:"_getCylinderInstanceMatrix",value:function(e,t,n){var r=e.attributes.matVector1.array,i=e.attributes.matVector2.array,o=e.attributes.matVector3.array,a=4*t;n.set(r[a],r[a+1],r[a+2],r[a+3],i[a],i[a+1],i[a+2],i[a+3],o[a],o[a+1],o[a+2],o[a+3],0,0,0,1)}},{key:"_getSphereInstanceMatrix",value:function(e,t,n){var r=e.attributes.offset,i=t*r.itemSize,o=r.array[i],a=r.array[i+1],s=r.array[i+2],l=r.array[i+3];n.set(l,0,0,o,0,l,0,a,0,0,l,s,0,0,0,1)}}]),e}(),sh=function(){function e(){g(this,e),this._resultArray=[],this._info=null}return _(e,[{key:"getResult",value:function(e){return this._info=e,this._resultArray.push(this._writeHeader()),this._resultArray.push(this._writeDefinitions()),this._resultArray.push(this._writeObjects(e.models,e.materials)),this._resultArray.push(this._writeRelations()),this._resultArray.push(this._writeConnections()),this._info=null,this._resultArray.join("")}},{key:"_writeHeader",value:function(){var e=new Date,t="Miew FBX Exporter v".concat(this._info.version);return"; FBX 6.1.0 project file\n; Created by ".concat(t," Copyright (c) 2015-2020 EPAM Systems, Inc.\n; For support please contact miew@epam.com\n; ----------------------------------------------------\n\nFBXHeaderExtension:  {\n  FBXHeaderVersion: ").concat(1003,"\n  FBXVersion: ").concat(6100,"\n  CreationTimeStamp:  {\n    Version: ").concat(1e3,"\n    Year: ").concat(e.getFullYear(),"\n    Month: ").concat(e.getMonth()+1," \n    Day: ").concat(e.getDate(),"\n    Hour: ").concat(e.getHours(),"\n    Minute: ").concat(e.getMinutes(),"\n    Second: ").concat(e.getSeconds(),"\n    Millisecond: ").concat(e.getMilliseconds(),'\n  }\n  Creator: "').concat(t,'"\n  OtherFlags:  {\n    FlagPLE: 0\n  }\n}\nCreationTime: "').concat(e,'"\nCreator: "').concat(t,'"  \n')}},{key:"_writeDefinitions",value:function(){return"\n; Object definitions\n;------------------------------------------------------------------\n\n".concat('\nDefinitions:  {\n  Version: 100\n  Count: 3\n  ObjectType: "Model" {\n    Count: 1\n  }\n  ObjectType: "Geometry" {\n    Count: 1\n  }\n  ObjectType: "Material" {\n    Count: 1\n  }\n  ObjectType: "Pose" {\n    Count: 1\n  }\n  ObjectType: "GlobalSettings" {\n    Count: 1\n  }\n} ',"\n")}},{key:"_models",value:function(){for(var e="",t=this._info.models,n=0;n<t.length;++n){var r=t[n],i=r.verticesCount;e+='\n  Model: "Model::'.concat(this._info.name,"_").concat(n,'", "Mesh" {\n    Version: ').concat(232," \n    ").concat('Properties60: {\n      Property: "QuaternionInterpolate", "bool", "",0\n      Property: "Visibility", "Visibility", "A",1\n      Property: "Lcl Translation", "Lcl Translation", "A",0.000000000000000,0.000000000000000,-1789.238037109375000\n      Property: "Lcl Rotation", "Lcl Rotation", "A",0.000009334667643,-0.000000000000000,0.000000000000000\n      Property: "Lcl Scaling", "Lcl Scaling", "A",1.000000000000000,1.000000000000000,1.000000000000000\n      Property: "RotationOffset", "Vector3D", "",0,0,0\n      Property: "RotationPivot", "Vector3D", "",0,0,0\n      Property: "ScalingOffset", "Vector3D", "",0,0,0\n      Property: "ScalingPivot", "Vector3D", "",0,0,0\n      Property: "TranslationActive", "bool", "",0\n      Property: "TranslationMin", "Vector3D", "",0,0,0\n      Property: "TranslationMax", "Vector3D", "",0,0,0\n      Property: "TranslationMinX", "bool", "",0\n      Property: "TranslationMinY", "bool", "",0\n      Property: "TranslationMinZ", "bool", "",0\n      Property: "TranslationMaxX", "bool", "",0\n      Property: "TranslationMaxY", "bool", "",0\n      Property: "TranslationMaxZ", "bool", "",0\n      Property: "RotationOrder", "enum", "",0\n      Property: "RotationSpaceForLimitOnly", "bool", "",0\n      Property: "AxisLen", "double", "",10\n      Property: "PreRotation", "Vector3D", "",0,0,0\n      Property: "PostRotation", "Vector3D", "",0,0,0\n      Property: "RotationActive", "bool", "",0\n      Property: "RotationMin", "Vector3D", "",0,0,0\n      Property: "RotationMax", "Vector3D", "",0,0,0\n      Property: "RotationMinX", "bool", "",0\n      Property: "RotationMinY", "bool", "",0\n      Property: "RotationMinZ", "bool", "",0\n      Property: "RotationMaxX", "bool", "",0\n      Property: "RotationMaxY", "bool", "",0\n      Property: "RotationMaxZ", "bool", "",0\n      Property: "RotationStiffnessX", "double", "",0\n      Property: "RotationStiffnessY", "double", "",0\n      Property: "RotationStiffnessZ", "double", "",0\n      Property: "MinDampRangeX", "double", "",0\n      Property: "MinDampRangeY", "double", "",0\n      Property: "MinDampRangeZ", "double", "",0\n      Property: "MaxDampRangeX", "double", "",0\n      Property: "MaxDampRangeY", "double", "",0\n      Property: "MaxDampRangeZ", "double", "",0\n      Property: "MinDampStrengthX", "double", "",0\n      Property: "MinDampStrengthY", "double", "",0\n      Property: "MinDampStrengthZ", "double", "",0\n      Property: "MaxDampStrengthX", "double", "",0\n      Property: "MaxDampStrengthY", "double", "",0\n      Property: "MaxDampStrengthZ", "double", "",0\n      Property: "PreferedAngleX", "double", "",0\n      Property: "PreferedAngleY", "double", "",0\n      Property: "PreferedAngleZ", "double", "",0\n      Property: "InheritType", "enum", "",0\n      Property: "ScalingActive", "bool", "",0\n      Property: "ScalingMin", "Vector3D", "",1,1,1\n      Property: "ScalingMax", "Vector3D", "",1,1,1\n      Property: "ScalingMinX", "bool", "",0\n      Property: "ScalingMinY", "bool", "",0\n      Property: "ScalingMinZ", "bool", "",0\n      Property: "ScalingMaxX", "bool", "",0\n      Property: "ScalingMaxY", "bool", "",0\n      Property: "ScalingMaxZ", "bool", "",0\n      Property: "GeometricTranslation", "Vector3D", "",0,0,0\n      Property: "GeometricRotation", "Vector3D", "",0,0,0\n      Property: "GeometricScaling", "Vector3D", "",1,1,1\n      Property: "LookAtProperty", "object", ""\n      Property: "UpVectorProperty", "object", ""\n      Property: "Show", "bool", "",1\n      Property: "NegativePercentShapeSupport", "bool", "",1\n      Property: "DefaultAttributeIndex", "int", "",0\n      Property: "Color", "Color", "A+",0,0,0\n      Property: "Size", "double", "",100\n      Property: "Look", "enum", "",1\n    }',"\n    ").concat(this._verticesIndices(r.positions,r.indices),"\n    ").concat(this._normalLayer(r.normals)," \n    ").concat(this._colorLayer(r.colors,i)," \n    ").concat('\n    LayerElementMaterial: 0 {\n      Version: 101\n      Name: ""\n      MappingInformationType: "AllSame"\n      ReferenceInformationType: "Direct"\n      Materials: 0\n    }',"  \n    ").concat('\n    Layer: 0 {\n      Version: 100\n      LayerElement:  {\n        Type: "LayerElementNormal"\n        TypedIndex: 0\n      }\n      LayerElement:  {\n        Type: "LayerElementColor"\n        TypedIndex: 0\n      }\n      LayerElement:  {\n        Type: "LayerElementMaterial"\n        TypedIndex: 0\n      }\n    }',"\n  }")}return e}},{key:"_materials",value:function(){for(var e="",t=this._info.materials,n=0;n<t.length;++n){var r=t[n];e+='\n  Material: "Material::'.concat(this._info.name,"_").concat(n,'_default", "" {\n    Version: ').concat(102,'\n    ShadingModel: "lambert"\n    MultiLayer: 0\n    ').concat(this._materialProperties(r),"\n  }")}return e}},{key:"_writeObjects",value:function(){return"\n; Object properties\n;------------------------------------------------------------------\n\nObjects:  {\n  ".concat(this._models(),"\n  ").concat(this._materials(),"\n  ").concat('GlobalSettings: {\n    Version: 1000\n    Properties60:  {\n      Property: "UpAxis", "int", "",1\n      Property: "UpAxisSign", "int", "",1\n      Property: "FrontAxis", "int", "",2\n      Property: "FrontAxisSign", "int", "",1\n      Property: "CoordAxis", "int", "",0\n      Property: "CoordAxisSign", "int", "",1\n      Property: "UnitScaleFactor", "double", "",1\n    }\n  }',"\n}\n")}},{key:"_writeRelations",value:function(){for(var e="",t=0;t<this._info.models.length;++t)e+='\n  Model: "Model::'.concat(this._info.name,"_").concat(t,'", "Mesh" {\n  }');for(var n="",r=0;r<this._info.materials.length;++r)n+='\n  Material: "Material::'.concat(this._info.name,"_").concat(r,'_default", "" {\n  }');return"\n; Object relations\n;------------------------------------------------------------------\n\nRelations:  {\n  ".concat(e,'\n  Model: "Model::Producer Perspective", "Camera" {\n  }\n  Model: "Model::Producer Top", "Camera" {\n  }\n  Model: "Model::Producer Bottom", "Camera" {\n  }\n  Model: "Model::Producer Front", "Camera" {\n  }\n  Model: "Model::Producer Back", "Camera" {\n  }\n  Model: "Model::Producer Right", "Camera" {\n  }\n  Model: "Model::Producer Left", "Camera" {\n  }\n  Model: "Model::Camera Switcher", "CameraSwitcher" {\n  }\n  ').concat(n,"\n}")}},{key:"_writeConnections",value:function(){for(var e="",t=this._info.name,n=0;n<this._info.models.length;++n)e+='\n  Connect: "OO", "Model::'.concat(t,"_").concat(n,'", "Model::Scene"');for(var r="",i=0;i<this._info.materials.length;++i)r+='\n  Connect: "OO", "Material::'.concat(t,"_").concat(i,'_default", "Model::').concat(t,"_").concat(i,'"');return"\n; Object connections\n;------------------------------------------------------------------\n\nConnections:  {\n  ".concat(e,"\n  ").concat(r,"\n}")}},{key:"_floatArrayToString",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].toFixed(6);return t.join(",")}},{key:"_colorLayer",value:function(e,t){var n=this._floatArrayToString(e),r=zn(Array(t).keys());return"\n    LayerElementColor: ".concat(0," {\n      Version: ").concat(101,'\n      Name: "').concat("",'"\n      MappingInformationType: "ByVertice"\n      ReferenceInformationType: "Direct"\n      Colors: ').concat(n,"\n      ColorIndex: ").concat(r,"\n    }")}},{key:"_normalLayer",value:function(e){var t=this._floatArrayToString(e);return"\n    LayerElementNormal: ".concat(0," {\n      Version: ").concat(101,'\n      Name: "').concat("",'"\n      MappingInformationType: "ByVertice"\n      ReferenceInformationType: "Direct" \n      Normals: ').concat(t,"\n    }")}},{key:"_verticesIndices",value:function(e,t){var n=this._floatArrayToString(e);return"MultiLayer: ".concat(0,"\n    MultiTake: ").concat(1,"\n    Shading: ").concat("Y",'\n    Culling: "').concat("CullingOff",'"\n    Vertices: ').concat(n,"\n    PolygonVertexIndex: ").concat(t,"\n    GeometryVersion: ").concat(124)}},{key:"_materialProperties",value:function(e){return'Properties60:  {\n      Property: "ShadingModel", "KString", "", "Lambert"\n      Property: "MultiLayer", "bool", "",0\n      Property: "EmissiveColor", "ColorRGB", "",0,0,0\n      Property: "EmissiveFactor", "double", "",0.0000\n      Property: "AmbientColor", "ColorRGB", "",1,1,1\n      Property: "AmbientFactor", "double", "",0.0000\n      Property: "DiffuseColor", "ColorRGB", "",'.concat(e.diffuse,'\n      Property: "DiffuseFactor", "double", "",1.0000\n      Property: "Bump", "Vector3D", "",0,0,0\n      Property: "TransparentColor", "ColorRGB", "",1,1,1\n      Property: "TransparencyFactor", "double", "",0.0000\n      Property: "SpecularColor", "ColorRGB", "",').concat(e.specular,'\n      Property: "SpecularFactor", "double", "",1.0000\n      Property: "ShininessExponent", "double", "",').concat(e.shininess,'\n      Property: "ReflectionColor", "ColorRGB", "",0,0,0\n      Property: "ReflectionFactor", "double", "",1\n      Property: "Ambient", "ColorRGB", "",1,1,1\n      Property: "Diffuse", "ColorRGB", "",').concat(e.diffuse,'\n      Property: "Specular", "ColorRGB", "",').concat(e.specular,'\n      Property: "Shininess", "double", "",').concat(e.shininess,'\n      Property: "Opacity", "double", "",').concat(e.opacity,'\n      Property: "Reflectivity", "double", "",0\n    }')}}]),e}();function lh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ch=function(e){T(n,e);var t=lh(n);function n(e,r){var i;return g(this,n),(i=t.call(this,e,r))._data=e,i._version=r.miewVersion||"0.0-UNSPECIFIED",i._extractor=new ah,i}return _(n,[{key:"exportSync",value:function(){var e=new sh;if(!this._source)return this._result;var t=this._extractor.process(this._data);return t.version=this._version,this._result=e.getResult(t),this._result}}]),n}(Wu);ch.formats=["fbx"],ch.SourceClass=al;var uh,hh,fh,dh,ph,mh,vh,gh,yh,_h,xh,bh,wh,Sh,Mh={loaders:Ll,parsers:Gu,exporters:new ju([Yu,ch])},Eh=new a.Color,Th=function(){function e(){g(this,e),this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this._vector=new a.Vector3,this._viewMatrix=new a.Matrix4,this._projectionMatrix=new a.Matrix4,this._domElement=document.createElement("div"),this._domElement.style.overflow="hidden",this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.zIndex="0",this._domElement.style.pointerEvents="none"}return _(e,[{key:"getElement",value:function(){return this._domElement}},{key:"reset",value:function(){for(var e=this.getElement();e.firstChild;)e.removeChild(e.firstChild)}},{key:"setSize",value:function(e,t){this._width=e,this._height=t,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this._domElement.style.width="".concat(e,"px"),this._domElement.style.height="".concat(t,"px")}},{key:"_renderObject",value:function(e,t,n){function r(e,t,n){return Eh.setHex(e),Eh.lerp(t,n),"#".concat(Eh.getHexString())}function i(e){return Eh.setHex(e),"#".concat(Eh.getHexString())}if(e instanceof xn){if(this._vector.setFromMatrixPosition(e.matrixWorld),void 0!==e.userData&&void 0!==e.userData.offset){var o=new a.Vector3(e.userData.offset.x,e.userData.offset.y,0);this._vector.add(o.multiplyScalar(e.matrixWorld.getMaxScaleOnAxis()))}this._vector.applyMatrix4(this._viewMatrix);var s=this._vector.z>-t.near?"hidden":"visible",l=1e4*(t.far- -this._vector.z)/(t.far-t.near),c=e.getElement();if(void 0===n.fog)c.style.color=i(e.userData.color),"transparent"!==e.userData.background&&(c.style.background=i(e.userData.background));else{var u=a.MathUtils.smoothstep(-this._vector.z,n.fog.near,n.fog.far);c.style.color=r(e.userData.color,n.fog.color,u),"transparent"!==e.userData.background&&(c.style.background=r(e.userData.background,n.fog.color,u))}this._vector.applyMatrix4(this._projectionMatrix);var h="".concat(e.userData!=={}?e.userData.translation:"translate(-50%, -50%) ","translate(").concat(this._vector.x*this._widthHalf+this._widthHalf,"px,").concat(-this._vector.y*this._heightHalf+this._heightHalf,"px)");c.style.visibility=s,c.style.WebkitTransform=h,c.style.MozTransform=h,c.style.oTransform=h,c.style.transform=h,c.style.zIndex=Number(l).toFixed(0),c.parentNode!==this._domElement&&this._domElement.appendChild(c)}for(var f=0,d=e.children.length;f<d;f++)this._renderObject(e.children[f],t,n)}},{key:"render",value:function(e,t){e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.copy(t.matrixWorld).invert(),this._viewMatrix.copy(t.matrixWorldInverse),this._projectionMatrix.copy(t.projectionMatrix),this._renderObject(e,t,e)}}]),e}(),Ah=-1,Ch=0,Rh=1,Ph=2,Lh=3,kh=new a.Quaternion,Ih=new a.Matrix4;function Nh(e,t,n,r){this.objects=e;var i=c(e,1);this.object=i[0],this.camera=t,this.pivot=n,this.axis=new a.Vector3(0,0,1),this.options=r,this.lastRotation={axis:new a.Vector3,angle:0}}function Oh(e,t,n,r,i){O.call(this);var o=this;this.object=e,this.objectPivot=t,this.camera=n,this.domElement=void 0!==r?r:document,this.getAltObj=i,this.enabled=!0,this.hotkeysEnabled=!0,this.screen={left:0,top:0,width:0,height:0},this.options={rotateFactor:Math.PI,axisRotateFactor:4*Math.PI,intertia:!0,dynamicDampingFactor:.1,intertiaThreshold:.001},this._state=Ah,this._mousePrevPos=new a.Vector2,this._mouseCurPos=new a.Vector2,this._mainObj=new Nh([this.object],this.camera,new a.Vector3(0,0,0),this.options),this._altObj=new Nh([this.object],this.camera,new a.Vector3(0,0,0),this.options),this._affectedObj=this._mainObj,this._isAltObjFreeRotationAllowed=!0,this._isTranslationAllowed=!0,this._isKeysTranslatingObj=!1,this._pressedKeys=[],this._clock=new b,this._clock.start(),this._lastUpdateTime=this._clock.getElapsedTime(),this._listeners=[{obj:o.domElement,type:"mousedown",handler:function(e){o.mousedown(e)}},{obj:o.domElement,type:"mouseup",handler:function(e){o.mouseup(e)}},{obj:o.domElement,type:"mousemove",handler:function(e){o.mousemove(e)}},{obj:o.domElement,type:"mousewheel",handler:function(e){o.mousewheel(e)}},{obj:o.domElement,type:"DOMMouseScroll",handler:function(e){o.mousewheel(e)}},{obj:o.domElement,type:"mouseout",handler:function(e){o.mouseup(e)}},{obj:o.domElement,type:"touchstart",handler:function(e){o.touchstartend(e)}},{obj:o.domElement,type:"touchend",handler:function(e){o.touchstartend(e)}},{obj:o.domElement,type:"touchmove",handler:function(e){o.touchmove(e)}},{obj:o.getKeyBindObject(),type:"keydown",handler:function(e){o.keydownup(e)}},{obj:o.getKeyBindObject(),type:"keyup",handler:function(e){o.keydownup(e)}},{obj:window,type:"resize",handler:function(){o.handleResize()}},{obj:window,type:"blur",handler:function(){o.resetKeys()}},{obj:o.domElement,type:"contextmenu",handler:function(e){o.contextmenu(e)}}];for(var s=0;s<this._listeners.length;s++){var l=this._listeners[s];l.obj.addEventListener(l.type,l.handler)}this.handleResize(),this.resetKeys(),this.update()}function Dh(e,t,n){O.call(this);var r=this;this.gfxObj=e,this.camera=t,this.domElement=void 0!==n?n:document,this.screen={left:0,top:0,width:0,height:0},this._lastMousePos=new a.Vector2(0,0),this._mouseTotalDist=0,this._lastClickBeginTime=-1e3,this._lastClickPos=new a.Vector2(0,0),this._clickBeginTime=0,this._clock=new b,this._clock.start(),this._listeners=[{obj:r.domElement,type:"mousedown",handler:function(e){r.mousedown(e)}},{obj:r.domElement,type:"mouseup",handler:function(e){r.mouseup(e)}},{obj:r.domElement,type:"mousemove",handler:function(e){r.mousemove(e)}},{obj:r.domElement,type:"touchstart",handler:function(e){r.touchstart(e)}},{obj:r.domElement,type:"touchend",handler:function(e){r.touchend(e)}},{obj:window,type:"resize",handler:function(){r.handleResize()}}];for(var i=0;i<this._listeners.length;i++){var o=this._listeners[i];o.obj.addEventListener(o.type,o.handler)}this.handleResize()}Nh.prototype._rotate=function(){var e=new a.Vector3,t=new a.Quaternion,n=new a.Vector3,r=new a.Matrix4;return function(i){var o=0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z;if(r.copy(this.object.matrix),o?r.multiply(Ih.makeRotationFromQuaternion(i)):(r.multiply(Ih.makeTranslation(this.pivot.x,this.pivot.y,this.pivot.z)),r.multiply(Ih.makeRotationFromQuaternion(i)),r.multiply(Ih.makeTranslation(-this.pivot.x,-this.pivot.y,-this.pivot.z))),r.decompose(e,t,n),!o)for(var a=0;a<this.objects.length;++a)this.objects[a].position.copy(e);for(var s=0;s<this.objects.length;++s)this.objects[s].quaternion.copy(t),this.objects[s].updateMatrix()}}(),Nh.prototype.setObjects=function(e){this.objects=e;var t=c(e,1);this.object=t[0]},Nh.prototype.rotate=(uh={axis:new a.Vector3,angle:0},function(e,t,n,r){this.mouse2rotation(uh,t,n,r),e.setFromAxisAngle(uh.axis,uh.angle),uh.angle&&this._rotate(e),this.lastRotation=uh}),Nh.prototype.translate=(hh=new a.Vector3,fh=new a.Vector3,function(e){hh.set(e.x/this.camera.projectionMatrix.elements[0],e.y/this.camera.projectionMatrix.elements[5],0);var t=hh.length();hh.normalize(),hh.transformDirection(Ih.copy(this.object.matrixWorld).invert()),fh.copy(this.pivot),this.object.localToWorld(fh),t*=Math.abs(fh.z-this.camera.position.z),t/=this.object.matrixWorld.getMaxScaleOnAxis();for(var n=0;n<this.objects.length;++n)this.objects[n].translateOnAxis(hh,t)}),Nh.prototype.update=(dh=new a.Vector3,function(e,t){if(0!==ie.now.autoRotation)return ie.now.autoRotationAxisFixed||0===this.lastRotation.axis.length()?dh.set(0,1,0).transformDirection(Ih.copy(this.object.matrixWorld).invert()):dh.copy(this.lastRotation.axis),this._rotate(kh.setFromAxisAngle(dh,ie.now.autoRotation*e)),!0;if(this.options.intertia&&this.lastRotation.angle){var n=this.lastRotation.angle*Math.pow(1-this.options.dynamicDampingFactor,40*t);if(!(Math.abs(n)<=this.options.intertiaThreshold))return this._rotate(kh.setFromAxisAngle(this.lastRotation.axis,n)),!0;this.lastRotation.angle=0}return!1}),Nh.prototype.stop=function(){this.lastRotation.angle=0},Nh.prototype.mouse2rotation=(ph=new a.Vector3,mh=new a.Vector3,vh=new a.Vector3,gh=new a.Vector3,yh=new a.Vector3,_h=new a.Vector3,xh=new a.Vector2,function(e,t,n,r){if(r)e.axis.copy(this.axis),e.angle=this.options.axisRotateFactor*(n.y-t.y);else{xh.subVectors(n,t);var i=xh.length();if(0===i)return;ph.copy(this.pivot),this.object.localToWorld(ph),mh.subVectors(this.camera.position,ph),vh.copy(mh).normalize(),gh.copy(this.camera.up).normalize(),yh.crossVectors(gh,vh).normalize(),gh.setLength(xh.y),yh.setLength(xh.x),_h.copy(gh.add(yh)),e.axis.crossVectors(_h,mh),e.angle=-i*this.options.rotateFactor}e.axis.transformDirection(Ih.copy(this.object.matrixWorld).invert()),e.angle<0&&(e.axis.negate(),e.angle=-e.angle)}),Oh.prototype=Object.create(O.prototype),Oh.prototype.constructor=Oh,Oh.prototype.resetKeys=function(){this._pressedKeys[37]=!1,this._pressedKeys[38]=!1,this._pressedKeys[39]=!1,this._pressedKeys[40]=!1},Oh.prototype.contextmenu=function(e){e.stopPropagation(),e.preventDefault()},Oh.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},Oh.prototype.enable=function(e){this.enabled=e},Oh.prototype.enableHotkeys=function(e){this.hotkeysEnabled=e},Oh.prototype.allowTranslation=function(e){this._isTranslationAllowed=e},Oh.prototype.allowAltObjFreeRotation=function(e){this._isAltObjFreeRotationAllowed=e},Oh.prototype.keysTranslateObj=function(e){this._isKeysTranslatingObj=e},Oh.prototype.isEditingAltObj=function(){return(this._state===Ch||this._state===Rh)&&this._affectedObj===this._altObj},Oh.prototype.convertMouseToOnCircle=function(e,t,n){var r=Math.min(this.screen.width,this.screen.height);0!==r?e.set((t-.5*this.screen.width-this.screen.left)/r,(.5*this.screen.height+this.screen.top-n)/r):e.set(0,0)},Oh.prototype.convertMouseToViewport=function(e,t,n){0!==this.screen.width&&0!==this.screen.height?e.set(2*(t-.5*this.screen.width-this.screen.left)/this.screen.width,2*(.5*this.screen.height+this.screen.top-n)/this.screen.height):e.set(0,0)},Oh.prototype.stop=function(){this._mainObj.stop(),this._altObj.stop()},Oh.prototype.rotateByMouse=(bh=new a.Quaternion,function(e){this._affectedObj.rotate(bh,this._mousePrevPos,this._mouseCurPos,e),this.dispatchEvent({type:"change",action:"rotate",quaternion:bh})}),Oh.prototype.rotate=function(e){this.object.quaternion.multiply(e),this.dispatchEvent({type:"change",action:"rotate",quaternion:e})},Oh.prototype.getOrientation=function(){return this.object.quaternion},Oh.prototype.setOrientation=function(e){this.object.quaternion.copy(e)},Oh.prototype.translate=(wh=new a.Vector2,function(){wh.subVectors(this._mouseCurPos,this._mousePrevPos),this._affectedObj.translate(wh),this.dispatchEvent({type:"change",action:"translate"})}),Oh.prototype.getScale=function(){return this.object.scale.x},Oh.prototype.setScale=function(e){this.object.scale.set(e,e,e)},Oh.prototype.scale=function(e){e<=0||(this.setScale(this.object.scale.x*e),this.dispatchEvent({type:"change",action:"zoom",factor:e}))},Oh.prototype.update=(Sh=new a.Vector2,function(){var e=this._clock.getElapsedTime(),t=e-this._lastUpdateTime;if(this._state===Ah){var n=e-this._lastMouseMoveTime;(this._mainObj.update(t,n)||this._altObj.update(t,n))&&this.dispatchEvent({type:"change",action:"auto"})}if(this._isKeysTranslatingObj){var r=Number(this._pressedKeys[39])-Number(this._pressedKeys[37]),i=Number(this._pressedKeys[38])-Number(this._pressedKeys[40]);if(0!==r||0!==i){var o=t,a=this.getAltObj();a.objects.length>0&&(this._altObj.setObjects(a.objects),this._altObj.pivot=a.pivot,"axis"in a?this._altObj.axis=a.axis.clone():this._altObj.axis.set(0,0,1),Sh.set(o*r,o*i),this._altObj.translate(Sh),this.dispatchEvent({type:"change",action:"translate"}))}}this._lastUpdateTime=e}),Oh.prototype.reset=function(){this._state=Ah,this.object.quaternion.copy(kh.set(0,0,0,1))},Oh.prototype.mousedown=function(e){if(!1!==this.enabled&&this._state===Ah){if(e.preventDefault(),e.stopPropagation(),this._state===Ah)if(0===e.button){this._affectedObj.stop();var t=!1;if(e.altKey){var n=this.getAltObj();(t=n.objects.length>0)&&(this._altObj.setObjects(n.objects),this._altObj.pivot=n.pivot,"axis"in n?this._altObj.axis=n.axis.clone():this._altObj.axis.set(0,0,1))}this._affectedObj=t?this._altObj:this._mainObj,this._state=t&&e.ctrlKey&&this._isTranslationAllowed?Rh:Ch}else 2===e.button&&(this._state=Lh);this._state===Ch&&(this.convertMouseToOnCircle(this._mouseCurPos,e.pageX,e.pageY),this._mousePrevPos.copy(this._mouseCurPos)),this._state!==Rh&&this._state!==Lh||(this.convertMouseToViewport(this._mouseCurPos,e.pageX,e.pageY),this._mousePrevPos.copy(this._mouseCurPos))}},Oh.prototype.mousemove=function(e){if(!1!==this.enabled&&this._state!==Ah)switch(e.preventDefault(),e.stopPropagation(),this._state){case Ch:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,e.pageX,e.pageY),this.rotateByMouse(e.altKey&&!this._isAltObjFreeRotationAllowed||e.shiftKey),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case Rh:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,e.pageX,e.pageY),this.translate();break;case Lh:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,e.pageX,e.pageY),this.translatePivotByMouse()}},Oh.prototype.mousewheel=function(e){if(!1!==this.enabled&&ie.now.zooming&&this._state===Ah&&!e.shiftKey){e.preventDefault();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3);var n=1+.05*t;n=Math.max(n,.01),this.scale(n)}},Oh.prototype.mouseup=function(e){!1!==this.enabled&&this._state!==Ah&&(e.preventDefault(),e.stopPropagation(),this._state=Ah,this._clock.getElapsedTime()-this._lastMouseMoveTime>.1&&this._affectedObj.stop())},Oh.prototype.touchstartend=function(e){if(!1!==this.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:this._state=Ch,this.convertMouseToOnCircle(this._mouseCurPos,e.touches[0].pageX,e.touches[0].pageY),this._mousePrevPos.copy(this._mouseCurPos);break;case 2:this._mainObj.stop(),this._altObj.stop(),this._state=Ph;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchDistanceCur=this._touchDistanceStart=Math.sqrt(t*t+n*n),this._scaleStart=this.object.scale.x;break;default:this._state=Ah}},Oh.prototype.touchmove=function(e){if(!1!==this.enabled&&this._state!==Ah)switch(e.preventDefault(),e.stopPropagation(),this._state){case Ch:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,e.touches[0].pageX,e.touches[0].pageY),this.rotateByMouse(!1),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case Ph:if(ie.now.zooming){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;this._touchDistanceCur=Math.sqrt(t*t+n*n);var r=this._scaleStart*this._touchDistanceCur/this._touchDistanceStart/this.object.scale.x;this.scale(r)}}},Oh.prototype.keydownup=function(e){if(!1!==this.enabled&&!1!==this.hotkeysEnabled)switch(e.keyCode){case 37:case 38:case 39:case 40:this._pressedKeys[e.keyCode]="keydown"===e.type,e.preventDefault(),e.stopPropagation()}},Oh.prototype.getKeyBindObject=function(){return window.top},Oh.prototype.dispose=function(){for(var e=0;e<this._listeners.length;e++){var t=this._listeners[e];t.obj.removeEventListener(t.type,t.handler)}},Oh.prototype.translatePivotByMouse=function(){var e=new a.Vector2;return function(){e.subVectors(this._mouseCurPos,this._mousePrevPos),this.translatePivotInWorld(ie.now.translationSpeed*e.x,ie.now.translationSpeed*e.y,0)}}(),Oh.prototype.translatePivotInWorld=function(e,t,n){var r=this.objectPivot.position;r.applyMatrix4(this.object.matrixWorld),r.setX(r.x+e),r.setY(r.y+t),r.setZ(r.z+n),r.applyMatrix4(Ih.copy(this.object.matrixWorld).invert()),this.dispatchEvent({type:"change",action:"translatePivot"})},Oh.prototype.translatePivot=function(e,t,n){var r=this.objectPivot.position;r.setX(r.x+e),r.setY(r.y+t),r.setZ(r.z+n),this.dispatchEvent({type:"change",action:"translatePivot"})},Oh.prototype.setPivot=function(e){this.objectPivot.position.copy(e),this.dispatchEvent({type:"change",action:"translatePivot"})},Dh.prototype=Object.create(O.prototype),Dh.prototype.constructor=Dh,Dh.prototype.reset=function(){this.picked={},this.dispatchEvent({type:"newpick",obj:{}})},Dh.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},Dh.prototype.pickObject=function(e){if(!this.gfxObj)return this.picked={},void this.dispatchEvent({type:"newpick",obj:{}});var t=this.gfxObj,n=new a.Raycaster;n.ray.origin.setFromMatrixPosition(this.camera.matrixWorld),n.ray.direction.set(e.x,e.y,.5).unproject(this.camera).sub(n.ray.origin).normalize();var r=ie.now.draft.clipPlane&&this.clipPlaneValue?this.clipPlaneValue:1/0,i=ie.now.fog&&this.fogFarValue?this.fogFarValue:1/0,o=n.intersectVisibleObject(t,this.camera,r,i);if(!o)return this.picked={},void this.dispatchEvent({type:"newpick",obj:{}});var s={};if(o.residue||o.atom){var l=o.residue||o.atom.residue;"chain"===ie.now.pick?s={chain:l.getChain()}:"molecule"===ie.now.pick?s={molecule:l.getMolecule()}:o.residue||"residue"===ie.now.pick?s={residue:l}:o.atom&&(s={atom:o.atom})}this.picked=s,this.dispatchEvent({type:"newpick",obj:s})},Dh.prototype.getMouseInViewport=function(e,t){return new a.Vector2((e-this.screen.left)/this.screen.width*2-1,-(t-this.screen.top)/this.screen.height*2+1)},Dh.prototype.mousedown=function(e){e.preventDefault(),e.stopPropagation(),0===e.button&&(this._lastMousePos=this.getMouseInViewport(e.pageX,e.pageY),this._mouseTotalDist=0,this._clickBeginTime=this._clock.getElapsedTime())},Dh.prototype.mousemove=function(e){e.preventDefault(),e.stopPropagation();var t=this.getMouseInViewport(e.pageX,e.pageY);this._mouseTotalDist+=t.sub(this._lastMousePos).length()},Dh.prototype.mouseup=function(e){var t=this;if(e.preventDefault(),e.stopPropagation(),0===e.button&&this._mouseTotalDist<.01){var n=this._clock.getElapsedTime(),r=this.getMouseInViewport(e.pageX,e.pageY);if(n-this._lastClickBeginTime<.7&&(new a.Vector2).subVectors(r,this._lastClickPos).length()<.01)return this.dispatchEvent({type:"dblclick",obj:this.picked}),this._lastClickPos=r,void(this._lastClickBeginTime=-1e3);setTimeout((function(){t.pickObject(r)}),0),this._lastClickPos=r,this._lastClickBeginTime=this._clickBeginTime}},Dh.prototype.touchstart=function(e){e.preventDefault(),e.stopPropagation(),1===e.touches.length&&(this._lastTouchdownPos=this.getMouseInViewport(e.touches[0].pageX,e.touches[0].pageY))},Dh.prototype.touchend=function(e){var t=this;e.preventDefault(),e.stopPropagation(),0===e.touches.length&&1===e.changedTouches.length&&this.getMouseInViewport(e.changedTouches[0].pageX,e.changedTouches[0].pageY).sub(this._lastTouchdownPos).length()<.01&&setTimeout((function(){t.pickObject(t._lastTouchdownPos)}),0)},Dh.prototype.dispose=function(){for(var e=0;e<this._listeners.length;e++){var t=this._listeners[e];t.obj.removeEventListener(t.type,t.handler)}};var Bh=function(){function e(t,n){g(this,e),this._target=t,this._targetCamera=n,this._camera=new a.PerspectiveCamera(n.fov,n.aspect,1,100),this._object=new a.AxesHelper(1),this._scene=new a.Scene,this._scene.add(this._object),this._full=new a.Vector2,this._update()}return _(e,[{key:"_update",value:function(){var e=this._targetCamera.fov,t=this._camera;t.aspect=this._targetCamera.aspect,t.setMinimalFov(e),t.setDistanceToFit(1,e),t.updateProjectionMatrix(),this._object.quaternion.copy(this._target.quaternion)}},{key:"render",value:function(e){this._update(),e.getSize(this._full);var t=.25*this._full.width,n=.25*this._full.height,r=e.autoClear;e.autoClear=!1,e.setViewport(0,0,t,n),e.clear(!1,!0,!1),e.render(this._scene,this._camera),e.setViewport(0,0,this._full.width,this._full.height),e.autoClear=r}}]),e}(),zh=["helix","strand"],Fh=["fs","ps","ns","us"];function Vh(e,t){for(var n=t._residues,r=n.length,i=new Uint8Array(r),o=t._atoms,a=0,s=e.length;a<s;++a)i[o[a].residue._index]=e[a];for(var l=[],c=0;c<r;){if(0!==i[c]){for(var u=c,h=i[c];c<r-1&&i[c+1]===h&&n[c].isConnected(n[c+1]);)++c;l.push({start:u,end:c,type:zh[h-1]})}++c}return l}function Uh(e){return e>=1<<19?e-(1<<20):e}var Gh=function(){function e(t,n,r){g(this,e),this._complex=t,this._secondary=null,this.isLoading=!1,this._framesRange={start:0,end:-1},this.frameIsReady=!1,this._buffer=null,this._frameRequest=null,this._callbacks=r,"function"==typeof n?(this._framesRequestLength=1,this._downloadDataFn=n):this.parseBinaryData(n,!0),this.reset(),this.setFrame(0)}return _(e,[{key:"_prepareBuffer",value:function(e,t){if(null==e&&(e=0),null==t&&(t=e+this._framesRequestLength),void 0!==this._framesCount&&(t=Math.min(this._framesCount-1,t)),this._downloadDataFn){var n=this;this._buffer||(this._buffer={}),this._buffer.state="downloading",this.isLoading=!0,n._callbacks&&"function"==typeof n._callbacks.onLoadStatusChanged&&n._callbacks.onLoadStatusChanged(),this._downloadDataFn({start:e,end:t+1},(function(r){if(n.isLoading=!1,n._callbacks&&"function"==typeof n._callbacks.onLoadStatusChanged&&n._callbacks.onLoadStatusChanged(),n._buffer={data:r,state:"ready",start:e,end:t},null!==n._frameRequest){var i=n._frameRequest;n._frameRequest=null,n.setFrame(i)}}),(function(){n.isLoading=!1,n._callbacks&&"function"==typeof n._callbacks.onError&&n._callbacks.onError("Streaming failed")}))}}},{key:"_parseBuffer",value:function(){if(this._buffer&&"ready"===this._buffer.state){this._framesRange={start:this._buffer.start,end:this._buffer.end},this.parseBinaryData(this._buffer.data,!1);var e=(this._buffer.end+1)%this._framesCount;if(e>=this._framesCount&&(e=0),this._buffer={state:"none"},this._prepareBuffer(e,e+this._framesRequestLength),null!==this._frameRequest){var t=this._frameRequest;this._frameRequest=null,this.setFrame(t)}}}},{key:"parseBinaryData",value:function(e){var t=new DataView(e),n=0,r=t.getUint32(n,!0);n+=4;var i=t.getUint32(n,!0);this._framesCount=i,this._framesRange.end=this._framesRange.end>0?Math.min(this._framesRange.end,i-1):i-1,n+=4,this._atomsCount=r,this._framesRequestLength=Math.ceil(1048576/(8*r));var o=this._framesRange.end-this._framesRange.start+1;if(r!==this._complex._atoms.length||e.byteLength!==12+o*r*8)throw new Error;for(var a=this._complex,s=t.getUint32(n,!0),l=0;s>1e3&&l<Fh.length-1;)s/=1e3,++l;this._timeStep="".concat(s.toString()," ").concat(Fh[l]),n+=4;for(var c=[],u=new Float32Array(o*r*3),h=0,f=new Int8Array(r),d=0;d<o;++d){for(var p=0;p<r;++p){var m=t.getUint32(n,!0);n+=4;var v=t.getUint32(n,!0);n+=4;var g=(4026531840&v)>>>28,y=Uh((268435200&v)>>>8>>0),_=Uh(((255&v)<<12|(4293918720&m)>>>20)>>0),x=Uh((1048575&m)>>0);f[p]=0,g>0&&g<4?f[p]=1:4===g&&(f[p]=2),u[h++]=y/100,u[h++]=_/100,u[h++]=x/100}c.push(Vh(f,a))}this._secondaryData=c,this._data=u}},{key:"nextFrame",value:function(){this.setFrame((this._currFrame+1)%this._framesCount)}},{key:"needsColorUpdate",value:function(e){return e instanceof As}},{key:"getAtomColor",value:function(e,t){return e.getResidueColor(this._residues[t.residue._index],this._complex)}},{key:"getResidueColor",value:function(e,t){return e.getResidueColor(this._residues[t._index],this._complex)}},{key:"_updateSecondary",value:function(){var e,t=this._residues,n=t.length;for(e=0;e<n;++e)t[e]._secondary=null;var r=this._secondaryData[this._currFrame-this._framesRange.start];for(e=0,n=r.length;e<n;++e)for(var i=r[e],o=i.start,a=i.end,s={_start:t[o],_end:t[a],type:i.type,generic:i.generic},l=o;l<=a;++l)t[l]._secondary=s}},{key:"reset",value:function(){var e=this._complex._residues,t=e.length;this._residues=new Array(t);for(var n=this._residues,r=function(){return this._secondary},i=0;i<t;++i)n[i]={_type:e[i]._type,_isValid:e[i]._isValid,_controlPoint:null,_wingVector:null,_secondary:null,getSecondary:r}}},{key:"setFrame",value:function(e){if(this.frameIsReady=!1,e>=this._framesRange.start&&e<=this._framesRange.end)this._currFrame=e,this._cachedResidues=!1,this._updateSecondary(),this.frameIsReady=!0;else if(this._frameRequest=e,this._buffer)switch(this._buffer.state){case"none":this._prepareBuffer(e);break;case"ready":this._parseBuffer()}else this._prepareBuffer(e)}},{key:"disableEvents",value:function(){this._callbacks=null}},{key:"getAtomPos",value:function(t){var n=e._vec,r=this._data,i=3*(this._atomsCount*(this._currFrame-this._framesRange.start)+t);return n.set(r[i],r[i+1],r[i+2]),n}},{key:"getResidues",value:function(){return this._cachedResidues||this._complex.updateToFrame(this),this._residues}}]),e}();Ee(Gh,"_vec",new a.Vector3);var Hh=function(){function e(t,n){if(g(this,e),this.constructor===e)throw new Error("Can not instantiate abstract class!");this.params=t,this.opts=o.default.merge(Q.deriveDeep(ie.now.objects[this.type],!0),n),this.needsRebuild=!1,this._mesh=null,this.id=null}return _(e,[{key:"identify",value:function(){var e={type:this.type,params:this.params},t=Q.objectsDiff(this.opts,ie.now.modes[this.id]);return o.default.isEmpty(t)||(e.opts=t),e}},{key:"toString",value:function(){return"o=".concat(this.type,",").concat(this.params.join(","))+Q.compareOptionsWithDefaults(this.opts,ie.defaults.objects[this.type])}},{key:"getGeometry",value:function(){return this._mesh}},{key:"destroy",value:function(){this._mesh&&Nn.destroyObject(this._mesh)}}]),e}();function jh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Hh.prototype.type="__";var Wh=function(e){T(n,e);var t=jh(n);function n(e,r){var i;if(g(this,n),i=t.call(this,e,r),e.length<2)throw new Error("Wrong number of argumets on line object creation!");var o=c(e,2);return i._id1=o[0],i._id2=o[1],i}return _(n,[{key:"_getAtomFromName",value:function(e,t){var n=e.getAtomByFullname(t);if(!n)throw new Error(t+" - Wrong atom format it must be '#CHAIN_NAME.#RESIDUE_NUMBER.#ATOM_NAME' (e.g. 'A.38.CO1')");return n}},{key:"build",value:function(e){var t=new a.BufferGeometry;this._atom1=this._getAtomFromName(e,this._id1),this._atom2=this._getAtomFromName(e,this._id2);var n=this._atom1.position,r=this._atom2.position,i=new Float32Array([n.x,n.y,n.z,r.x,r.y,r.z]);t.setAttribute("position",new a.BufferAttribute(i,3)),t.computeBoundingBox();var o=new Oi;o.setValues({lights:!1,overrideColor:!0,dashedLine:!0,fogTransparent:ie.now.bg.transparent}),this._line=new eo.Line(t,o),this._line.computeLineDistances(),this._line.material.setUberOptions({fixedColor:new a.Color(this.opts.color),dashedLineSize:this.opts.dashSize,dashedLinePeriod:this.opts.dashSize+this.opts.gapSize}),this._line.material.updateUniforms(),this._line.raycast=function(e,t){},this._mesh=this._line;var s=e.getTransforms();s.length>0&&(this._mesh=new a.Group,this._mesh.add(this._line),Js.applyTransformsToMeshes(this._mesh,s))}},{key:"updateToFrame",value:function(e){if(this._atom1&&this._atom2&&this._line){var t=this._line.geometry;t.vertices[0].copy(e.getAtomPos(this._atom1.index)),t.vertices[1].copy(e.getAtomPos(this._atom2.index)),this._line.computeLineDistances(),t.computeBoundingSphere(),t.verticesNeedUpdate=!0}}}]),n}(Hh);function qh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Wh.prototype.constructor=Wh,Wh.prototype.type="line";var Xh=function(e){T(n,e);var t=qh(n);function n(e){var r;g(this,n),r=t.call(this,e);var i={uniforms:{srcTex:{type:"t",value:null},srcDepthTex:{type:"t",value:null},srcTexSize:{type:"v2",value:new a.Vector2(512,512)},color:{type:"v3",value:null},threshold:{type:"f",value:null},opacity:{type:"f",value:1},thickness:{type:"v2",value:new a.Vector2(1,1)}},vertexShader:Sn,fragmentShader:"precision highp float;\r\n\r\nuniform sampler2D srcTex;\r\nuniform vec2 srcTexSize;\r\nuniform vec2 thickness;\r\nvarying vec2 vUv;\r\n\r\n#ifdef DEPTH_OUTLINE\r\n  uniform sampler2D srcDepthTex; //depthTexture\r\n  uniform vec3 color;\r\n  uniform float threshold;\r\n#endif\r\n\r\nvoid main() {\r\n\r\n  vec2 pixelSize = thickness / srcTexSize;\r\n\r\n  #ifdef DEPTH_OUTLINE\r\n    float c00 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,-pixelSize.y)).x;\r\n    float c01 = texture2D(srcDepthTex, vUv + vec2(0,-pixelSize.y)).x;\r\n    float c02 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,-pixelSize.y)).x;\r\n    float c10 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,0)).x;\r\n    float c12 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,0)).x;\r\n    float c20 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,pixelSize.y)).x;\r\n    float c21 = texture2D(srcDepthTex, vUv + vec2(0,pixelSize.y)).x;\r\n    float c22 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,pixelSize.y)).x;\r\n\r\n    float horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r\n    float vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r\n\r\n    float grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r\n\r\n    gl_FragColor = ( grad > threshold ) ? vec4(color.rgb, 1.0) : gl_FragColor = texture2D(srcTex, vUv);\r\n\r\n  #else\r\n    vec4 c00 = texture2D(srcTex, vUv + vec2(-pixelSize.x,-pixelSize.y));\r\n    vec4 c01 = texture2D(srcTex, vUv + vec2(0,-pixelSize.y));\r\n    vec4 c02 = texture2D(srcTex, vUv + vec2(pixelSize.x,-pixelSize.y));\r\n    vec4 c10 = texture2D(srcTex, vUv + vec2(-pixelSize.x,0));\r\n    vec4 c12 = texture2D(srcTex, vUv + vec2(pixelSize.x,0));\r\n    vec4 c20 = texture2D(srcTex, vUv + vec2(-pixelSize.x,pixelSize.y));\r\n    vec4 c21 = texture2D(srcTex, vUv + vec2(0,pixelSize.y));\r\n    vec4 c22 = texture2D(srcTex, vUv + vec2(pixelSize.x,pixelSize.y));\r\n\r\n    vec4 horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r\n    vec4 vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r\n\r\n    vec4 grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r\n    gl_FragColor = grad;\r\n  #endif\r\n}\r\n",transparent:!0,depthTest:!1,depthWrite:!1};return r.setValues(i),r}return _(n,[{key:"copy",value:function(e){Qe(P(n.prototype),"copy",this).call(this,e),this.depth=e.depth}},{key:"setValues",value:function(e){if(void 0!==e){Qe(P(n.prototype),"setValues",this).call(this,e);var t={};this.depth&&(t.DEPTH_OUTLINE=1),this.defines=t}}}]),n}(a.RawShaderMaterial);function Yh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Xh.prototype.depth=!1;var Zh=function(e){T(n,e);var t=Yh(n);function n(e){var r;return g(this,n),(r=t.call(this,e)).setValues({uniforms:{srcTex:{type:"t",value:null},srcTexelSize:{type:"v2",value:new a.Vector2(1/512,1/512)},bgColor:{type:"c",value:new a.Color(16777215)}},vertexShader:Sn,fragmentShader:"precision highp float;\r\n\r\n// edge end finding algorithm parameters\r\n#define FXAA_QUALITY_PS 8\r\n#define FXAA_QUALITY_P0 1.0\r\n#define FXAA_QUALITY_P1 1.5\r\n#define FXAA_QUALITY_P2 2.0\r\n#define FXAA_QUALITY_P3 2.0\r\n#define FXAA_QUALITY_P4 2.0\r\n#define FXAA_QUALITY_P5 2.0\r\n#define FXAA_QUALITY_P6 4.0\r\n#define FXAA_QUALITY_P7 12.0\r\n// constants\r\nfloat fxaaQualityEdgeThreshold = 0.125;\r\nfloat fxaaQualityEdgeThresholdMin = 0.0625;\r\nfloat fxaaQualitySubpix = 0.7; //0.65;\r\n// global params\r\nuniform sampler2D srcTex;\r\nuniform vec2 srcTexelSize;\r\nuniform vec3 bgColor;\r\n// from vs\r\nvarying vec2 vUv;\r\n//=====================================================================//\r\n// calc luminance from rgb\r\n//'float FxaaLuma(vec3 rgb) {return rgb.y * (0.587/0.299) + rgb.x; } // Lotte's idea about game luminance\r\nfloat FxaaLuma(vec3 rgb) {return dot(rgb, vec3(0.299, 0.587, 0.114)); } // real luminance calculation\r\n                                                                           // for non-real scene rendering\r\n// texture sampling by pixel position(coords) and offset(in pixels)\r\n vec3 FxaaTex(sampler2D tex, vec2 pos, vec2 off,  vec2 res ) {\r\n  #ifdef BG_TRANSPARENT\r\n    vec4 color = texture2D( tex, pos + off * res );\r\n    return mix(color.rgb, bgColor, 1.0 - color.a);\r\n  #else\r\n    return texture2D( tex, pos + off * res ).xyz;\r\n  #endif\r\n}\r\nvec3 FxaaTexTop(sampler2D tex, vec2 pos) {\r\n  #ifdef BG_TRANSPARENT\r\n    vec4 color = texture2D( tex, pos );\r\n    return mix(color.rgb, bgColor, 1.0 - color.a);\r\n  #else\r\n    return texture2D( tex, pos).xyz;\r\n  #endif\r\n}\r\nvec4 FxaaTexTopAlpha(sampler2D tex, vec2 pos) {\r\n  return texture2D( tex, pos);\r\n}\r\n\r\n//=====================================================================//\r\nvoid main() {\r\n  // renaming\r\n  vec2 posM = vUv;\r\n  // get luminance for neighbours\r\n  float lumaS = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, 1.0 ), srcTexelSize));\r\n  float lumaE = FxaaLuma(FxaaTex(srcTex, posM, vec2( 1.0, 0.0 ), srcTexelSize));\r\n  float lumaN = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, -1.0 ), srcTexelSize));\r\n  float lumaW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, 0.0 ), srcTexelSize));\r\n  float lumaM = FxaaLuma(FxaaTexTop(srcTex, posM));\r\n  // find max and min luminance\r\n  float rangeMax = max(max(lumaN, lumaW), max(lumaE, max(lumaS, lumaM)));\r\n  float rangeMin = min(min(lumaN, lumaW), min(lumaE, min(lumaS, lumaM)));\r\n  // calc maximum non-edge range\r\n  float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\r\n  float range = rangeMax - rangeMin;\r\n  float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\r\n  // exit when luma contrast is small (is not edge)\r\n  if(range < rangeMaxClamped){\r\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r\n    return;\r\n  }\r\n  float subpixRcpRange = 1.0/range;\r\n  // note: the sampling coordinates can be calculated in vertex shader but the approach doesn't affect performance\r\n  // visibly, thus we decided to leave calculation here for better readability.\r\n  // calc other neighbours luminance\r\n  float lumaNE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0, -1.0 ), srcTexelSize));\r\n  float lumaSW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0,  1.0 ), srcTexelSize));\r\n  float lumaSE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0,  1.0 ), srcTexelSize));\r\n  float lumaNW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, -1.0 ), srcTexelSize));\r\n/*--------------span calculation and subpix amount calulation-----------------*/\r\n  float lumaNS = lumaN + lumaS;\r\n  float lumaWE = lumaW + lumaE;\r\n  float subpixNSWE = lumaNS + lumaWE;\r\n  float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\r\n  float edgeVert1 = (-2.0 * lumaM) + lumaWE;\r\n/*--------------------------------------------------------------------------*/\r\n  float lumaNESE = lumaNE + lumaSE;\r\n  float lumaNWNE = lumaNW + lumaNE;\r\n  float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\r\n  float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\r\n/*--------------------------------------------------------------------------*/\r\n  float lumaNWSW = lumaNW + lumaSW;\r\n  float lumaSWSE = lumaSW + lumaSE;\r\n  float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\r\n  float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\r\n  float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\r\n  float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\r\n  float edgeHorz = abs(edgeHorz3) + edgeHorz4;\r\n  float edgeVert = abs(edgeVert3) + edgeVert4;\r\n/*--------------------subpix amount calulation------------------------------*/\r\n  float subpixNWSWNESE = lumaNWSW + lumaNESE;\r\n  float lengthSign = srcTexelSize.x;\r\n  bool horzSpan = edgeHorz >= edgeVert;\r\n   // debug  code edge span visualization\r\n/*'  if (horzSpan)\r\n      gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\r\n  else\r\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r\n  return;*/\r\n  float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\r\n/*--------------------------------------------------------------------------*/\r\n  if(!horzSpan) lumaN = lumaW;\r\n  if(!horzSpan) lumaS = lumaE;\r\n  if(horzSpan) lengthSign = srcTexelSize.y;\r\n  float subpixB = (subpixA * (1.0/12.0)) - lumaM;\r\n/*--------------------------------------------------------------------------*/\r\n  float gradientN = lumaN - lumaM;\r\n  float gradientS = lumaS - lumaM;\r\n  float lumaNN = lumaN + lumaM;\r\n  float lumaSS = lumaS + lumaM;\r\n  bool pairN = abs(gradientN) >= abs(gradientS);\r\n  float gradient = max(abs(gradientN), abs(gradientS));\r\n  if(pairN) lengthSign = -lengthSign;\r\n  float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\r\n/*--------------------------------------------------------------------------*/\r\n  vec2 posB;\r\n  posB = posM;\r\n  vec2 offNP;\r\n  offNP.x = (!horzSpan) ? 0.0 : srcTexelSize.x;\r\n  offNP.y = ( horzSpan) ? 0.0 : srcTexelSize.y;\r\n  if(!horzSpan) posB.x += lengthSign * 0.5;\r\n  if( horzSpan) posB.y += lengthSign * 0.5;\r\n/*--------------------------------------------------------------------------*/\r\n  vec2 posN;\r\n  posN = posB - offNP * FXAA_QUALITY_P0;\r\n  vec2 posP;\r\n  posP = posB + offNP * FXAA_QUALITY_P0;\r\n  float subpixD = ((-2.0)*subpixC) + 3.0;\r\n  float lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN));\r\n  float subpixE = subpixC * subpixC;\r\n  float lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP));\r\n/*--------------------------------------------------------------------------*/\r\n  if(!pairN) lumaNN = lumaSS;\r\n  float gradientScaled = gradient * 1.0/4.0;\r\n  float lumaMM = lumaM - lumaNN * 0.5;\r\n  float subpixF = subpixD * subpixE;\r\n  bool lumaMLTZero = lumaMM < 0.0;\r\n/*---------------------looped edge-end search-------------------------------*/\r\n  lumaEndN -= lumaNN * 0.5;\r\n  lumaEndP -= lumaNN * 0.5;\r\n  bool doneN = abs(lumaEndN) >= gradientScaled;\r\n  bool doneP = abs(lumaEndP) >= gradientScaled;\r\n  if(!doneN) posN -= offNP * FXAA_QUALITY_P1;\r\n  bool doneNP = (!doneN) || (!doneP);\r\n  if(!doneP) posP += offNP * FXAA_QUALITY_P1;\r\n/*--------------------------------------------------------------------------*/\r\n  if(doneNP) {\r\n    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n    doneN = abs(lumaEndN) >= gradientScaled;\r\n    doneP = abs(lumaEndP) >= gradientScaled;\r\n    if(!doneN) posN -= offNP * FXAA_QUALITY_P2;\r\n    doneNP = (!doneN) || (!doneP);\r\n    if(!doneP) posP += offNP * FXAA_QUALITY_P2;\r\n/*--------------------------------------------------------------------------*/\r\n    #if (FXAA_QUALITY_PS > 3)\r\n      if(doneNP) {\r\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n        doneN = abs(lumaEndN) >= gradientScaled;\r\n        doneP = abs(lumaEndP) >= gradientScaled;\r\n        if(!doneN) posN -= offNP * FXAA_QUALITY_P3;\r\n        doneNP = (!doneN) || (!doneP);\r\n        if(!doneP) posP += offNP * FXAA_QUALITY_P3;\r\n/*--------------------------------------------------------------------------*/\r\n        #if (FXAA_QUALITY_PS > 4)\r\n          if(doneNP) {\r\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n            doneN = abs(lumaEndN) >= gradientScaled;\r\n            doneP = abs(lumaEndP) >= gradientScaled;\r\n            if(!doneN) posN -= offNP * FXAA_QUALITY_P4;\r\n            doneNP = (!doneN) || (!doneP);\r\n            if(!doneP) posP += offNP * FXAA_QUALITY_P4;\r\n/*--------------------------------------------------------------------------*/\r\n            #if (FXAA_QUALITY_PS > 5)\r\n               if(doneNP) {\r\n                 if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                 if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                 if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                 if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                 doneN = abs(lumaEndN) >= gradientScaled;\r\n                 doneP = abs(lumaEndP) >= gradientScaled;\r\n                 if(!doneN) posN -= offNP * FXAA_QUALITY_P5;\r\n                 doneNP = (!doneN) || (!doneP);\r\n                 if(!doneP) posP += offNP * FXAA_QUALITY_P5;\r\n/*--------------------------------------------------------------------------*/\r\n                 #if (FXAA_QUALITY_PS > 6)\r\n                   if(doneNP) {\r\n                     if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                     if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                     if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                     if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                     doneN = abs(lumaEndN) >= gradientScaled;\r\n                     doneP = abs(lumaEndP) >= gradientScaled;\r\n                     if(!doneN) posN -= offNP * FXAA_QUALITY_P6;\r\n                     doneNP = (!doneN) || (!doneP);\r\n                     if(!doneP) posP += offNP * FXAA_QUALITY_P6;\r\n/*--------------------------------------------------------------------------*/\r\n                     #if (FXAA_QUALITY_PS > 7)\r\n                       if(doneNP) {\r\n                         if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r\n                         if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r\n                         if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r\n                         if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r\n                         doneN = abs(lumaEndN) >= gradientScaled;\r\n                         doneP = abs(lumaEndP) >= gradientScaled;\r\n                         if(!doneN) posN -= offNP * FXAA_QUALITY_P7;\r\n                         doneNP = (!doneN) || (!doneP);\r\n                         if(!doneP) posP += offNP * FXAA_QUALITY_P7;\r\n/*--------------------------------------------------------------------------*/\r\n                       }\r\n                     #endif\r\n                   }\r\n                 #endif\r\n               }\r\n             #endif\r\n           }\r\n         #endif\r\n      }\r\n    #endif\r\n  }\r\n/*----------------calculate subpix offset due to edge ends-------------------*/\r\n  float dstN = posM.x - posN.x;\r\n  float dstP = posP.x - posM.x;\r\n  if(!horzSpan) dstN = posM.y - posN.y;\r\n  if(!horzSpan) dstP = posP.y - posM.y;\r\n/*--------------------------------------------------------------------------*/\r\n  bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\r\n  float spanLength = (dstP + dstN);\r\n  bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\r\n  float spanLengthRcp = 1.0 / spanLength;\r\n/*--------------------------------------------------------------------------*/\r\n  bool directionN = dstN < dstP;\r\n  float dst = min(dstN, dstP);\r\n  bool goodSpan = directionN ? goodSpanN : goodSpanP;\r\n  float subpixG = subpixF * subpixF;\r\n  float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\r\n  float subpixH = subpixG * fxaaQualitySubpix;\r\n/*-----------------calc texture offest using subpix-------------------------*/\r\n  float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\r\n  float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\r\n\r\n  float offset = pixelOffsetSubpix * lengthSign;\r\n  #ifdef BG_TRANSPARENT\r\n    // get original texel\r\n    vec4 rgbaA = FxaaTexTopAlpha(srcTex, posM);\r\n    // calc step to blended texel\r\n    vec2 step = sign((!horzSpan) ? vec2 (offset, 0.0) : vec2 (0.0, offset));\r\n    // get neighboring texel\r\n    vec4 rgbaB = FxaaTexTopAlpha(srcTex, posM + step * srcTexelSize);\r\n    //  calc blend factor from offset\r\n    float f = (!horzSpan) ? offset / srcTexelSize.x : offset / srcTexelSize.y;\r\n    f = abs(f);\r\n    // calc alpha (special formula to emulate blending with bg)\r\n    gl_FragColor.a = 1.0 - mix(1.0 - rgbaA.a, 1.0 - rgbaB.a, f);\r\n    // calc color (special formula to emulate blending with bg)\r\n    gl_FragColor.rgb = mix(rgbaA.rgb * rgbaA.a, rgbaB.rgb * rgbaB.a, f) / gl_FragColor.a;\r\n  #else\r\n    if(!horzSpan) {\r\n       posM.x += offset;\r\n    } else {\r\n       posM.y += offset;\r\n    }\r\n    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r\n  #endif\r\n  return;\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),r.setValues(e),r}return _(n,[{key:"copy",value:function(e){Qe(P(n.prototype),"copy",this).call(this,e),this.depth=e.depth}},{key:"setValues",value:function(e){if(void 0!==e){Qe(P(n.prototype),"setValues",this).call(this,e);var t={};this.bgTransparent&&(t.BG_TRANSPARENT=1),this.defines=t}}}]),n}(a.RawShaderMaterial);function $h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}Zh.prototype.bgTransparent=!1;var Jh=[new a.Vector3(.295184,.077723,.068429),new a.Vector3(-.271976,-.365221,.838363),new a.Vector3(.547713,.467576,.488515),new a.Vector3(.662808,-.031733,.584758),new a.Vector3(-.025717,.218955,.657094),new a.Vector3(-.310153,-.365223,.370701),new a.Vector3(-.101407,-.006313,.747665),new a.Vector3(-.769138,.360399,.086847),new a.Vector3(-.271988,-.27514,.905353),new a.Vector3(.09674,-.566901,.700151),new a.Vector3(.562872,-.735136,.094647),new a.Vector3(.379877,.359278,.190061),new a.Vector3(.519064,-.023055,.405068),new a.Vector3(-.301036,.114696,.088885),new a.Vector3(-.282922,.598305,.487214),new a.Vector3(-.181859,.25167,.679702),new a.Vector3(-.191463,-.635818,.512919),new a.Vector3(-.293655,.427423,.078921),new a.Vector3(-.267983,.680534,.13288),new a.Vector3(.139611,.319637,.477439),new a.Vector3(-.352086,.31104,.653913),new a.Vector3(.321032,.805279,.487345),new a.Vector3(.073516,.820734,.414183),new a.Vector3(-.155324,.589983,.41146),new a.Vector3(.335976,.170782,.527627),new a.Vector3(.46346,-.355658,.167689),new a.Vector3(.222654,.59655,.769406),new a.Vector3(.922138,-.04207,.147555),new a.Vector3(-.72705,-.329192,.369826),new a.Vector3(-.090731,.53382,.463767),new a.Vector3(-.323457,-.876559,.238524),new a.Vector3(-.663277,-.372384,.342856)],Kh=function(e){T(n,e);var t=$h(n);function n(){var e;return g(this,n),(e=t.call(this)).setValues({uniforms:{noiseTexture:{type:"t",value:Ai.noiseTexture},noiseTexelSize:{type:"v2",value:new a.Vector2(1/Ai.noiseWidth,1/Ai.noiseHeight)},diffuseTexture:{type:"t",value:null},normalTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new a.Vector2(1/512,1/512)},camNearFar:{type:"v2",value:new a.Vector2(1,10)},projMatrix:{type:"mat4",value:new a.Matrix4},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},samplesKernel:{type:"v3v",value:Jh},kernelRadius:{type:"f",value:1},depthThreshold:{type:"f",value:1},factor:{type:"f",value:1}},vertexShader:Sn,fragmentShader:"precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 32\r\nuniform vec3 samplesKernel[MAX_SAMPLES_COUNT];\r\nuniform sampler2D noiseTexture;\r\nuniform vec2      noiseTexelSize;\r\nuniform sampler2D diffuseTexture;\r\nuniform sampler2D depthTexture;\r\nuniform sampler2D normalTexture;\r\nuniform vec2      srcTexelSize;\r\nuniform vec2      camNearFar;\r\nuniform mat4      projMatrix;\r\n\r\nuniform float aspectRatio;\r\nuniform float tanHalfFOV;\r\n\r\nuniform float kernelRadius;\r\nuniform float depthThreshold;\r\nuniform float factor;\r\n\r\nvarying vec2 vUv;\r\n\r\nfloat CalcViewZ(vec2 screenPos)\r\n{\r\n  float depth = texture2D(depthTexture, screenPos).x;\r\n  // [0, 1]->[-1, 1]\r\n  float clipedZ = 2.0 * depth - 1.0;\r\n  // see THREE.js camera.makeFrustum for projection details\r\n  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r\n}\r\n\r\nvec3 ViewPosFromDepth(vec2 screenPos)\r\n{\r\n  vec3 viewPos;\r\n  viewPos.z = CalcViewZ(screenPos);\r\n  //[0, 1]->[-1, 1]\r\n  vec2 projPos = 2.0 * screenPos - 1.0;\r\n  // reconstruct viewposition in right-handed sc with z to viewer\r\n  viewPos.xy = vec2(\r\n                    projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r\n                    projPos.y * tanHalfFOV * abs(viewPos.z)\r\n                   );\r\n  return viewPos;\r\n}\r\n\r\nvoid main() {\r\n  vec3 viewPos = ViewPosFromDepth(vUv);\r\n  // remap coordinates to prevent noise exture rescale\r\n  vec2 vUvNoise = vUv / srcTexelSize * noiseTexelSize;\r\n  vec4 normalData = texture2D(normalTexture, vUv);\r\n  // return for background fragments (their normals are zero vectors)\r\n  if (length(normalData.rgb) < EPSILON) {\r\n    // 0.0 in alpha component means that it is background fragment\r\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n    return;\r\n  }\r\n  //[0, 1] -> [-1, 1]\r\n  vec3 normal = (normalData.rgb * 2.0 - 1.0);\r\n  // normalData.a store 1.0 if normal was build for frontfaced surface\r\n  // and 0.0 in other case\r\n  if (normalData.a < EPSILON) {\r\n    normal *= -1.0;\r\n  }\r\n  // get random vector for sampling sphere rotation\r\n  vec3 randN = texture2D(noiseTexture, vUvNoise).rgb * 2.0 - 1.0;\r\n  randN = normalize(randN);\r\n  // build TBN (randomly rotated around normal)\r\n  vec3 tangent   = normalize(randN - normal * dot(randN, normal));\r\n  vec3 bitangent = cross(tangent, normal);\r\n  mat3 TBN = mat3(tangent, bitangent, normal);\r\n  // calc AO value\r\n  float AO = 0.0;\r\n  for (int i = 0 ; i < MAX_SAMPLES_COUNT ; i++) {\r\n    // rotate sampling kernel around normal\r\n    vec3 reflectedSample = TBN * samplesKernel[i];\r\n    // get sample\r\n    vec3 samplePos = viewPos + reflectedSample * kernelRadius;\r\n\r\n    // project sample to screen to get sample's screen pos\r\n    vec4 SampleScrPos = vec4(samplePos, 1.0);\r\n    // eye -> clip\r\n    SampleScrPos = projMatrix * SampleScrPos;\r\n    // normalize\r\n    SampleScrPos.xy /= SampleScrPos.w;\r\n    //[-1, 1] -> [0, 1]\r\n    SampleScrPos.xy = (SampleScrPos.xy + vec2(1.0)) * 0.5;\r\n\r\n    // get view z for sample projected to the objct surface\r\n    float sampleDepth = CalcViewZ(SampleScrPos.xy);\r\n    // calc occlusion made by object surface at the sample\r\n    AO += step(samplePos.z, sampleDepth);\r\n  }\r\n  // calc result AO-map color\r\n  AO = 1.0 - max(0.0, AO / float(MAX_SAMPLES_COUNT) * factor);\r\n  // write value to AO-map\r\n  gl_FragColor = vec4(AO, AO, AO, 1.0);\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),e}return n}(a.RawShaderMaterial);function Qh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var ef=[-2,-1,0,1,2],tf=function(e){T(n,e);var t=Qh(n);function n(){var e;return g(this,n),(e=t.call(this)).setValues({uniforms:{depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new a.Vector2(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:ef}},vertexShader:Sn,fragmentShader:"precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 5\r\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\r\nuniform sampler2D aoMap;\r\nuniform sampler2D depthTexture;\r\nuniform vec2      srcTexelSize;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  float x = vUv.x;\r\n  float y = vUv.y;\r\n  vec4 res = vec4(0.0);\r\n  res.a = texture2D(aoMap, vec2(x, y )).a;\r\n  // return for background fragments (0.0 in alpha component means that it is background fragment)\r\n  if (res.a < EPSILON) {\r\n    gl_FragColor = res;\r\n    return;\r\n  }\r\n\r\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r\n  float weightSum = 0.0;\r\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r\n    if (texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).a < EPSILON) {\r\n      continue;\r\n    }\r\n    vec2 samplePos = vec2(x + samplesOffsets[i] * srcTexelSize.x, y);\r\n    float depth = texture2D(depthTexture, samplePos).x;\r\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r\n    res.rgb += texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).rgb * weight;\r\n    weightSum += weight;\r\n  }\r\n  res.rgb = res.rgb / weightSum;\r\n  gl_FragColor = res;\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),e}return n}(a.RawShaderMaterial);function nf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}var rf=[-2,-1,0,1,2],of=function(e){T(n,e);var t=nf(n);function n(e){var r;return g(this,n),(r=t.call(this,e)).setValues({uniforms:{diffuseTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new a.Vector2(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:rf},projMatrix:{type:"mat4",value:new a.Matrix4},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},fogNearFar:{type:"v2",value:new a.Vector2(100,100)},fogColor:{type:"v4",value:new a.Vector4(0,.5,0,1)}},vertexShader:Sn,fragmentShader:"precision highp float;\r\n#define EPSILON 0.0000001\r\n\r\n#define MAX_SAMPLES_COUNT 5\r\nuniform float samplesOffsets[MAX_SAMPLES_COUNT];\r\nuniform sampler2D diffuseTexture;\r\nuniform sampler2D aoMap;\r\nuniform sampler2D depthTexture;\r\nuniform vec2      srcTexelSize;\r\n\r\nuniform mat4  projMatrix;\r\nuniform float aspectRatio;\r\nuniform float tanHalfFOV;\r\n\r\n#ifdef USE_FOG\r\n  uniform vec2 fogNearFar;\r\n  uniform vec4 fogColor;\r\n#endif\r\nvarying vec2 vUv;\r\n\r\nfloat CalcViewZ(vec2 screenPos)\r\n{\r\n  float depth = texture2D(depthTexture, screenPos).x;\r\n  // [0, 1]->[-1, 1]\r\n  float clipedZ = 2.0 * depth - 1.0;\r\n  // see THREE.js camera.makeFrustum for projection details\r\n  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r\n}\r\n\r\nvec3 ViewPosFromDepth(vec2 screenPos)\r\n{\r\n  vec3 viewPos;\r\n  viewPos.z = CalcViewZ(screenPos);\r\n  //[0, 1]->[-1, 1]\r\n  vec2 projPos = 2.0 * screenPos - 1.0;\r\n  // reconstruct viewposition in right-handed sc with z to viewer\r\n  viewPos.xy = vec2(\r\n  projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r\n  projPos.y * tanHalfFOV * abs(viewPos.z)\r\n  );\r\n  return viewPos;\r\n}\r\n\r\nvoid main() {\r\n  vec3 viewPos = ViewPosFromDepth(vUv);\r\n  float x = vUv.x;\r\n  float y = vUv.y;\r\n  vec4 color = texture2D(diffuseTexture, vec2(x, y));\r\n  vec4 res = vec4(0.0);\r\n  res.a = texture2D(aoMap, vec2(x, y )).a;\r\n  // return for background fragments (0.0 in alpha component means that it is background fragment)\r\n  if (res.a < EPSILON) {\r\n    gl_FragColor = color;\r\n    return;\r\n  }\r\n\r\n  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r\n  float weightSum = 0.0;\r\n  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r\n    if (texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).a < EPSILON) {\r\n      continue;\r\n    }\r\n    vec2 samplePos = vec2(x, y + samplesOffsets[i] * srcTexelSize.y);\r\n    float depth = texture2D(depthTexture, samplePos).x;\r\n    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r\n    res.rgb += texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).rgb * weight;\r\n    weightSum += weight;\r\n  }\r\n  res.rgb /= weightSum;\r\n\r\n  #if defined(USE_FOG) && !defined(FOG_TRANSPARENT)\r\n    // Add fog to the result value\r\n    // Proper way to get an image with fog and ao requires formula:\r\n    //          gl_FragColor = fragColor*AO*(1-fogFactor) + fogColor*fogFactor\r\n    // But we have already fogged molecule to add AO too. Let's split the straight formula into our real steps!\r\n    // We have:  AO, fogFactor, fogColor,\r\n    //          color = fragColor*(1-fogFactor) + fogColor*fogFactor (it comes from diffuseTexture,\r\n    //                                                                where molecule has been already drawn with fog)\r\n    // Transform:\r\n    //          fragColor*AO*(1-fogFactor) + fogColor*fogFactor =\r\n    //        = [fragColor*(1-fogFactor) = color - fogColor*fogFactor] =\r\n    //        = (color - fogColor*fogFactor)*AO + fogColor*fogFactor =\r\n    //        = color*AO + fogColor*fogFactor*(1 - AO)\r\n    // Result:  gl_FragColor = color*AO + fogColor*fogFactor*(1 - AO)\r\n    float fogFactor = smoothstep(fogNearFar.x, fogNearFar.y, - viewPos.z) * fogColor.a;\r\n    gl_FragColor.rgb = color.rgb * res.rgb + fogColor.rgb * fogFactor *(vec3(1.0, 1.0, 1.0) - res.rgb);\r\n  #else\r\n    gl_FragColor.rgb = color.rgb * res.rgb;\r\n  #endif\r\n  gl_FragColor.a = color.a;\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1}),r.setValues(e),r}return _(n,[{key:"setValues",value:function(e){if(void 0!==e){Qe(P(n.prototype),"setValues",this).call(this,e);var t={};this.useFog&&(t.USE_FOG=1),this.fogTransparent&&(t.FOG_TRANSPARENT=1),this.defines=t}}}]),n}(a.RawShaderMaterial);function af(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}of.prototype.useFog=!0,of.prototype.fogTransparent=!1;var sf=function(e){T(n,e);var t=af(n);function n(){var e;g(this,n),e=t.call(this);var r={uniforms:{srcL:{type:"t",value:null},srcR:{type:"t",value:null}},vertexShader:Sn,fragmentShader:"precision highp float;\r\n\r\nuniform sampler2D srcL;\r\nuniform sampler2D srcR;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n  vec4 l = texture2D(srcL, vUv);\r\n  vec4 r = texture2D(srcR, vUv);\r\n  gl_FragColor = vec4(l.r, r.g, r.b, 1.0);\r\n}\r\n",transparent:!1,depthTest:!1,depthWrite:!1};return e.setValues(r),e}return n}(a.RawShaderMaterial),lf=function(){function e(){g(this,e),this.position=new a.Vector3(0,0,0),this.scale=1,this.orientation=new a.Quaternion(0,0,0,1)}return _(e,[{key:"set",value:function(e,t,n){this.position=e,this.scale=t,this.orientation=n}}]),e}(),cf=function(){function e(){g(this,e)}return _(e,[{key:"setup",value:function(e,t){this._startTime=void 0,this._endTime=void 0,this._isPaused=!1,this._srcView=e,this._dstView=t,this._isMoving=!1}},{key:"isMoving",value:function(){return this._isMoving}},{key:"wasStarted",value:function(){return void 0!==this._startTime&&void 0!==this._endTime}},{key:"start",value:function(){this._startTime=Date.now();var e=ie.now.interpolateViews?1500:0;this._endTime=this._startTime+e,this._isMoving=!0}},{key:"getCurrentView",value:function(){if(void 0===this._srcView||void 0===this._dstView||!this._isMoving||!this.wasStarted())return{success:!1};var e=this.createView(),t=Date.now();if(t>this._endTime)return e=this._dstView,this.reset(),{success:!0,view:e};var n=(t-this._startTime)/(this._endTime-this._startTime);return e.position.copy(this._srcView.position),e.position.lerp(this._dstView.position,n),e.scale=(1-n)*this._srcView.scale+n*this._dstView.scale,e.orientation.copy(this._srcView.orientation),e.orientation.slerp(this._dstView.orientation,n),{success:!0,view:e}}},{key:"reset",value:function(){this._startTime=this._endTime=0,this._isMoving=!1}},{key:"pause",value:function(){this._isPaused||(this.setup(this.getCurrentView().view,this._dstView),this._isPaused=!0)}},{key:"resume",value:function(){this._isPaused=!1}},{key:"createView",value:function(){return new lf}}]),e}();function uf(e,t){this.context=e,this._opts=o.default.merge({path:"/"},t)}function hf(e){function t(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="transparent",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator){var n=document.createElement("button");return n.style.display="none",t(n),navigator.xr.isSessionSupported("immersive-vr").then((function(t){return t?function(t){t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="ENTER VR";var n=null;function r(){n.removeEventListener("end",r),t.textContent="ENTER VR",n=null}function i(i){i.addEventListener("end",r),e._gfx.renderer.xr.setReferenceSpaceType("local"),e._gfx.renderer.xr.setSession(i),t.textContent="EXIT VR",n=i}t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){null===n?(navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(i),e.moveSceneBehindHeadset()):n.end()}}(n):function(e){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",e.textContent="VR NOT FOUND",e.onmouseenter=null,e.onmouseleave=null,e.onclick=null}(n)})),n}var r=document.createElement("a");return r.href="https://webvr.info",r.innerHTML="WEBXR NOT SUPPORTED",r.style.left="calc(50% - 90px)",r.style.width="180px",r.style.textDecoration="none",t(r),r}Un(uf.prototype),uf.prototype.removeCookie=function(e){var t=this._toCount(e),n=this._getSimpleCookie(t);if(n){this._removeSimpleCookie(t),n=parseInt(n,10);for(var r=0;r<n;++r)this._removeSimpleCookie(e+r)}else this._removeSimpleCookie(e)},uf.prototype.setCookie=function(e,t){this.removeCookie(e);var n=function(e,t){for(var n=e.length,r=[],i=0,o=0;o<n;i++,o+=t)r[i]=e.slice(o,o+t);return r}(t=encodeURIComponent(t),4e3-e.length-1),r=n.length;if(1!==r){var i=this._toCount(e);this._setSimpleCookie(i,r.toString());for(var o=0;o<r;++o)this._setSimpleCookie(e+o,n[o])}else this._setSimpleCookie(e,t)},uf.prototype.getCookie=function(e){var t=this._toCount(e),n=this._getSimpleCookie(t);if(!n)return this._getSimpleCookie(e);n=parseInt(n,10);for(var r=[],i=0;i<n;++i)r[i]=this._getSimpleCookie(e+i);return r.join("")},uf.prototype._toCount=function(e){return e+"Cnt"},uf.prototype._removeSimpleCookie=function(e){document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;")},uf.prototype._getExpirationDate=function(){var e=new Date;return e.setFullYear(e.getFullYear()+10),e},uf.prototype._setSimpleCookie=function(e,t){document.cookie="".concat(e,"=").concat(t,";expires=").concat(this._getExpirationDate().toUTCString(),";path=").concat(this._opts.path)},uf.prototype._getSimpleCookie=function(e){var t=document.cookie.match(new RegExp("(?:^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[1]):""},uf.prototype._exists=function(e){return document.cookie.match(new RegExp("(?:^|; )".concat(e,"=([^;]*)")))};var ff,df,pf,mf,vf,gf,yf,_f,xf,bf,wf,Sf,Mf,Ef,Tf,Af,Cf,Rf,Pf,Lf=function(){function e(t){g(this,e),this._mainCamera=new a.PerspectiveCamera,this._button=null,this._onToggle=t,this._molContainer=new Nn.RCGroup,this._user=new Nn.RCGroup,this._scalingPivot=new a.Object3D,this._user.add(this._scalingPivot),this._controller1=null,this._controller2=null,this._pressedGripsCounter=0,this._distance=0,this._gfx=null}return _(e,[{key:"startScalingByControllers",value:function(){this._distance=this._controller1.position.distanceTo(this._controller2.position),Nn.getMiddlePoint(this._controller1.position,this._controller2.position,this._scalingPivot.position),this._scalingPivot.scale.set(1,1,1),this._scalingPivot.updateMatrix(),this._scalingPivot.updateMatrixWorld(),this._scalingPivot.addSavingWorldTransform(this._molContainer)}},{key:"stopScalingByControllers",value:function(){this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsDown",value:function(e){this._pressedGripsCounter++,2===this._pressedGripsCounter?this.startScalingByControllers():1===this._pressedGripsCounter&&e.target.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsUp",value:function(e){this._pressedGripsCounter--,1===this._pressedGripsCounter?(this.stopScalingByControllers(),(e.target===this._controller1?this._controller2:this._controller1).addSavingWorldTransform(this._molContainer)):0===this._pressedGripsCounter&&this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"enable",value:function(e){if(e){this._gfx=e;var t=e.renderer,n=e.camera;if(!t)throw new Error("No renderer is available to toggle WebVR");if(!n)throw new Error("No camera is available to toggle WebVR");t.xr.enabled=!0,this._button?this._button.style.display="block":(this._button=hf(this),document.body.appendChild(this._button)),this._mainFog=ie.now.fog,ie.set("fog",!1),this._plugVRNodesIntoScene(e,t),this._setControllersListeners(),this._onToggle&&this._onToggle(!0)}else F.warn("WebVR couldn't be enabled, because gfx is not defined")}},{key:"_plugVRNodesIntoScene",value:function(e,t){this._mainCamera.copy(e.camera),e.scene.add(this._user),e.scene.add(this._molContainer),this._molContainer.add(e.root),this._controller1=t.xr.getController(0),this._controller2=t.xr.getController(1);var n=this._createControllerMesh();this._controller1.add(n),this._controller2.add(n.clone()),this._user.add(this._controller1),this._user.add(this._controller2)}},{key:"_setControllersListeners",value:function(){var e=this;this._controller1.addEventListener("selectstart",(function(t){e.handleGripsDown(t)})),this._controller1.addEventListener("selectend",(function(t){e.handleGripsUp(t)})),this._controller2.addEventListener("selectstart",(function(t){e.handleGripsDown(t)})),this._controller2.addEventListener("selectend",(function(t){e.handleGripsUp(t)})),this._controller1.addEventListener("squeezestart",(function(t){e.handleGripsDown(t)})),this._controller1.addEventListener("squeezeend",(function(t){e.handleGripsUp(t)})),this._controller2.addEventListener("squeezestart",(function(t){e.handleGripsDown(t)})),this._controller2.addEventListener("squeezeend",(function(t){e.handleGripsUp(t)}))}},{key:"disable",value:function(){if(this._gfx){var e=this._gfx,t=e.renderer,n=e.camera;if(!t)throw new Error("No renderer is available to toggle WebVR");t.setAnimationLoop(null);var r=t.xr.getSession();r&&r.end(),t.xr.enabled=!1,this._button&&(this._button.style.display="none"),ie.set("fog",this._mainFog),this._unplugVRNodesFromScene(n),this._onToggle&&this._onToggle(!1)}}},{key:"_unplugVRNodesFromScene",value:function(e){this._mainCamera&&e&&e.copy(this._mainCamera);var t=this._molContainer.children[0];t&&this._gfx.scene.add(t),this._molContainer.parent.remove(this._molContainer),this._user&&this._gfx.scene.remove(this._user),this._molContainer=null,this._user=null,this._scalingPivot=null,this._user=null,this._controller1=null,this._controller2=null}},{key:"_createControllerMesh",value:function(){var e=new a.CylinderGeometry(.04,.04,.3),t=new Oi;t.setValues({lights:!1,overrideColor:!0}),t.setUberOptions({fixedColor:new a.Color(4474111)}),t.updateUniforms();var n=new a.Mesh(e,t);return n.rotateX(-Math.PI/2),n}},{key:"updateMoleculeScale",value:function(){if(this._controller1&&this._controller2&&2===this._pressedGripsCounter){Nn.getMiddlePoint(this._controller1.position,this._controller2.position,this._scalingPivot.position);var e=this._controller1.position.distanceTo(this._controller2.position),t=e/this._distance;this._scalingPivot.scale.multiplyScalar(t),this._distance=e}}},{key:"moveSceneBehindHeadset",value:function(){var e=this._gfx,t=e.camera,n=this._molContainer;n.matrix.identity(),n.position.set(0,0,-4),n.updateMatrix(),n.matrixWorld.multiplyMatrices(t.matrixWorld,n.matrix),e.scene.addSavingWorldTransform(n),this._onToggle&&this._onToggle(!0)}},{key:"getCanvas",value:function(){var e=this._gfx;return e&&e.renderer?e.renderer.domElement:null}}]),e}(),kf=yn.selectors,If=yn.Atom,Nf=yn.Residue,Of=yn.Chain,Df=yn.Molecule,Bf=0,zf=1,Ff=2,Vf="Could not find suitable loader for this source",Uf=Q.createElement;function Gf(e){var t=e.lastIndexOf(".");return t>=0&&(e=e.substr(0,t)),e}function Hf(e,t,n){void 0!==n?e.debug("".concat(t,"... ").concat(Math.floor(100*n),"%")):e.debug("".concat(t,"..."))}function jf(){return ie.now.fogColorEnable?ie.now.fogColor:ie.now.bg.color}function Wf(e){O.call(this),this._opts=o.default.merge({settingsCookie:"settings",cookiePath:"/"},e),this._gfx=null,this._interpolator=new cf,this._container=e&&e.container||document.getElementById("miew-container")||o.default.head(document.getElementsByClassName("miew-container"))||document.body,this._containerRoot=this._container,this._running=!1,this._halting=!1,this._building=!1,this._needRender=!0,this._hotKeysEnabled=!0,this.settings=ie;var t=F;t.console=!1,t.level="info",this.logger=t,this._cookies=new uf(this),this.restoreSettings(),e&&e.settings&&this.settings.set(e.settings),this._spinner=null,this._loading=[],this._animInterval=null,this._visuals={},this._curVisualName=null,this._objects=[],this._sourceWindow=null,this.reset(),this._repr&&t.debug("Selected ".concat(this._repr.mode.name," mode with ").concat(this._repr.colorer.name," colorer."));var n=this;Wf.registeredPlugins.forEach((function(e){e.call(n)})),this._initOnSettingsChanged()}function qf(e,t){for(var n=e;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(t)}function Xf(e){return e.getExtension("EXT_frag_depth")}function Yf(e){return e.getExtension("WEBGL_depth_texture")&&e.getExtension("WEBGL_draw_buffers")}Wf.prototype=Object.create(O.prototype),Wf.prototype.constructor=Wf,Wf.prototype.getMaxRepresentationCount=function(){return al.NUM_REPRESENTATION_BITS},Wf.prototype._updateShadowCamera=function(){var e=new a.Matrix4,t=new a.Vector3,n={center:new a.Vector3,halfSize:new a.Vector3};return function(){this._gfx.scene.updateMatrixWorld();for(var r=0;r<this._gfx.scene.children.length;r++)if("DirectionalLight"===this._gfx.scene.children[r].type){var i=this._gfx.scene.children[r];e.copy(i.shadow.camera.matrixWorldInverse),this.getOBB(e,n),t.subVectors(i.target.position,i.position),i.position.subVectors(n.center,t),i.target.position.copy(n.center),i.shadow.bias=.09,i.shadow.camera.bottom=-n.halfSize.y,i.shadow.camera.top=n.halfSize.y,i.shadow.camera.right=n.halfSize.x,i.shadow.camera.left=-n.halfSize.x,i.shadow.camera.near=t.length()-n.halfSize.z,i.shadow.camera.far=t.length()+n.halfSize.z,i.shadow.camera.updateProjectionMatrix()}}}(),Wf.prototype.init=function(){var e=this._container,t=Q.createElement("div",{class:"miew-canvas"});qf(e,t),this._container=t;var n=document.createDocumentFragment();if(n.appendChild(this._msgMode=Uf("div",{class:"mode-message overlay"},Uf("p",{},"COMPONENT EDIT MODE"))),n.appendChild(this._msgAtomInfo=Uf("div",{class:"atom-info overlay"},Uf("p",{},""))),e.appendChild(n),null!==this._gfx)return!0;var r=this;this._showMessage("Viewer is being initialized...");try{this._initGfx(),this._initListeners(),this._spinner=new f({lines:13,length:28,width:14,radius:42,color:"#fff",zIndex:700}),window.top.addEventListener("keydown",(function(e){r._onKeyDown(e)})),window.top.addEventListener("keyup",(function(e){r._onKeyUp(e)})),this._objectControls=new Oh(this._gfx.root,this._gfx.pivot,this._gfx.camera,this._gfx.renderer.domElement,(function(){return r._getAltObj()})),this._objectControls.addEventListener("change",(function(e){switch(ie.now.shadow.on&&r._updateShadowCamera(),e.action){case"rotate":r.dispatchEvent({type:"rotate",quaternion:e.quaternion});break;case"zoom":r.dispatchEvent({type:"zoom",factor:e.factor});break;default:r.dispatchEvent({type:e.action})}r.dispatchEvent({type:"transform"}),r._needRender=!0}));var i=this._gfx;this._picker=new Dh(i.root,i.camera,i.renderer.domElement),this._picker.addEventListener("newpick",(function(e){r._onPick(e)})),this._picker.addEventListener("dblclick",(function(e){r.center(e)}))}catch(e){if("TypeError"===e.name&&"Cannot read property 'getExtension' of null"===e.message)this._showMessage("Could not create WebGL context.");else{if(!(e.message.search(/webgl/i)>1))throw this._showMessage("Viewer initialization failed."),e;this._showMessage(e.message)}return!1}var o=this._opts&&this._opts.load;if(o){var a=this._opts&&this._opts.type;this.load(o,{fileType:a,keepRepsInfo:!0})}return!0},Wf.prototype.term=function(){this._showMessage("Viewer has been terminated."),this._loading.forEach((function(e){e.cancel()})),this._loading.length=0,this.halt(),this._gfx=null},Wf.prototype._showMessage=function(e){var t=document.createElement("div");t.setAttribute("class","miew-message"),t.appendChild(document.createElement("p")).appendChild(document.createTextNode(e)),qf(this._container,t)},Wf.prototype._showCanvas=function(){qf(this._container,this._gfx.renderer.domElement)},Wf.prototype._requestAnimationFrame=function(e){var t=this._gfx.renderer.xr;t&&t.enabled?this._gfx.renderer.setAnimationLoop(e):requestAnimationFrame(e)},Wf.prototype._initGfx=function(){var e={width:this._container.clientWidth,height:this._container.clientHeight},t={preserveDrawingBuffer:!0,alpha:!0,premultipliedAlpha:!1};ie.now.antialias&&(t.antialias=!0),e.renderer2d=new Th,e.renderer=new a.WebGL1Renderer(t),e.renderer.shadowMap.enabled=ie.now.shadow.on,e.renderer.shadowMap.autoUpdate=!1,e.renderer.shadowMap.type=a.PCFShadowMap,_i.init(e.renderer),Xf(e.renderer.getContext())||ie.set("zSprites",!1),Yf(e.renderer.getContext())||ie.set("ao",!1),e.renderer.autoClear=!1,e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(e.width,e.height),e.renderer.setClearColor(ie.now.bg.color,Number(!ie.now.bg.transparent)),e.renderer.clearColor(),e.renderer2d.setSize(e.width,e.height),e.camera=new a.PerspectiveCamera(ie.now.camFov,e.width/e.height,ie.now.camNear,ie.now.camFar),e.camera.setMinimalFov(ie.now.camFov),e.camera.position.z=ie.now.camDistance,e.camera.updateProjectionMatrix(),e.camera.layers.set(Nn.LAYERS.DEFAULT),e.camera.layers.enable(Nn.LAYERS.VOLUME),e.camera.layers.enable(Nn.LAYERS.VOLUME_BFPLANE),e.stereoCam=new a.StereoCamera,e.scene=new a.Scene;var n=jf();e.scene.fog=new a.Fog(n,ie.now.camNear,ie.now.camFar),e.root=new Nn.RCGroup,e.scene.add(e.root),e.pivot=new Nn.RCGroup,e.root.add(e.pivot),e.selectionScene=new a.Scene,e.selectionRoot=new a.Group,e.selectionRoot.matrixAutoUpdate=!1,e.selectionScene.add(e.selectionRoot),e.selectionPivot=new a.Group,e.selectionPivot.matrixAutoUpdate=!1,e.selectionRoot.add(e.selectionPivot);var r=new a.DirectionalLight(16777215,.45);r.position.set(0,.414,1),r.layers.enable(Nn.LAYERS.TRANSPARENT),r.castShadow=!0,r.shadow.bias=.09,r.shadow.radius=ie.now.shadow.radius,r.shadow.camera.layers.set(Nn.LAYERS.SHADOWMAP);var i=e.renderer.getPixelRatio(),o=Math.max(e.width,e.height)*i;r.shadow.mapSize.width=o,r.shadow.mapSize.height=o,r.target.position.set(0,0,0),e.scene.add(r),e.scene.add(r.target);var s=new a.AmbientLight(6710886);s.layers.enable(Nn.LAYERS.TRANSPARENT),e.scene.add(s),e.axes=new Bh(e.root,e.camera);var l=e.width*i,c=e.height*i;e.offscreenBuf=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,depthBuffer:!0}),e.renderer.getContext().getExtension("WEBGL_depth_texture")&&(e.offscreenBuf.depthTexture=new a.DepthTexture,e.offscreenBuf.depthTexture.type=a.UnsignedShortType),e.offscreenBuf2=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,depthBuffer:!1}),e.offscreenBuf3=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,depthBuffer:!1}),e.offscreenBuf4=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,depthBuffer:!1}),e.volBFTex=e.offscreenBuf3,e.volFFTex=e.offscreenBuf4,e.volWFFTex=e.offscreenBuf,e.renderer.getContext().getExtension("OES_texture_float")?(e.offscreenBuf5=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,type:a.FloatType,depthBuffer:!1}),e.offscreenBuf6=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,type:a.FloatType,depthBuffer:!1}),e.offscreenBuf7=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,type:a.FloatType,depthBuffer:!0}),e.volBFTex=e.offscreenBuf5,e.volFFTex=e.offscreenBuf6,e.volWFFTex=e.offscreenBuf7):this.logger.warn("Device doesn't support OES_texture_float extension"),e.stereoBufL=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,depthBuffer:!1}),e.stereoBufR=new a.WebGLRenderTarget(l,c,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat,depthBuffer:!1}),this._gfx=e,this._showCanvas(),this._embedWebXR("WEBVR"===ie.now.stereo),this._container.appendChild(e.renderer2d.getElement());var u=new M;u.domElement.style.position="absolute",u.domElement.style.right="0",u.domElement.style.bottom="0",this._container.appendChild(u.domElement),this._fps=u,this._fps.show(ie.now.fps)},Wf.prototype._initListeners=function(){var e=this;window.addEventListener("resize",(function(){e._onResize()}))},Wf.prototype._makeUniqueVisualName=function(e){if(!e)return Math.random().toString();for(var t=e,n=1;this._visuals.hasOwnProperty(t);)t="".concat(e," (").concat(n.toString(),")"),n++;return t},Wf.prototype._addVisual=function(e){if(!e)return null;var t=this._makeUniqueVisualName(e.name);return e.name=t,this._visuals[t]=e,this._gfx.pivot.add(e),e.getSelectionGeo&&this._gfx.selectionPivot.add(e.getSelectionGeo()),t},Wf.prototype._removeVisual=function(e){var t="",n=null;e instanceof Bn?(t=e.name,n=e):"string"==typeof e&&(t=e,n=this._visuals[t]),n&&this._visuals.hasOwnProperty(t)&&this._visuals[t]===n&&(t===this._curVisualName&&(this._curVisualName=void 0),delete this._visuals[t],n.release(),this._needRender=!0)},Wf.prototype._forEachVisual=function(e){for(var t in this._visuals)this._visuals.hasOwnProperty(t)&&e(this._visuals[t])},Wf.prototype._releaseAllVisuals=function(){if(this._gfx&&this._gfx.pivot){for(var e in this._visuals)this._visuals.hasOwnProperty(e)&&this._visuals[e].release();this._visuals={}}},Wf.prototype._forEachComplexVisual=function(e){if(this._gfx&&this._gfx.pivot)for(var t in this._visuals)this._visuals.hasOwnProperty(t)&&this._visuals[t]instanceof al&&e(this._visuals[t])},Wf.prototype._getComplexVisual=function(e){e=e||this._curVisualName;var t=null,n=null;return this._forEachComplexVisual((function(r){t=r,r.name===e&&(n=r)})),n||t},Wf.prototype._getVolumeVisual=function(){var e=null;return this._forEachVisual((function(t){t instanceof _l&&(e=t)})),e},Wf.prototype._getVisualForComplex=function(e){if(!e)return null;var t=null;return this._forEachComplexVisual((function(n){n.getComplex()===e&&(t=n)})),t},Wf.prototype.getVisuals=function(){return Object.keys(this._visuals)},Wf.prototype.getComplexVisualsCount=function(){var e=0;return this._forEachComplexVisual((function(){return e++})),e},Wf.prototype.getCurrentVisual=function(){return this._curVisualName},Wf.prototype.setCurrentVisual=function(e){this._visuals[e]&&(this._curVisualName=e)},Wf.prototype.run=function(){var e=this;if(!this._running){if(this._running=!0,this._halting)return void(this._halting=!1);this._objectControls.enable(!0),this._interpolator.resume(),this._requestAnimationFrame((function(){return e._onTick()}))}},Wf.prototype.halt=function(){this._running&&(this._discardComponentEdit(),this._discardFragmentEdit(),this._objectControls.enable(!1),this._interpolator.pause(),this._halting=!0)},Wf.prototype.enableHotKeys=function(e){this._hotKeysEnabled=e,this._objectControls.enableHotkeys(e)},Wf.prototype._onResize=function(){this._needRender=!0;var e=this._gfx;e.width=this._container.clientWidth,e.height=this._container.clientHeight,e.camera.aspect=e.width/e.height,e.camera.setMinimalFov(ie.now.camFov),e.camera.updateProjectionMatrix(),e.renderer.setSize(e.width,e.height),e.renderer2d.setSize(e.width,e.height),this.dispatchEvent({type:"resize"})},Wf.prototype._resizeOffscreenBuffers=function(e,t,n){var r=this._gfx,i="NONE"===(n=n||"NONE")||"ANAGLYPH"===n,o=i?1:.5;r.offscreenBuf.setSize(o*e,t),r.offscreenBuf2.setSize(o*e,t),r.offscreenBuf3.setSize(o*e,t),r.offscreenBuf4.setSize(o*e,t),r.offscreenBuf5&&r.offscreenBuf5.setSize(o*e,t),r.offscreenBuf6&&r.offscreenBuf6.setSize(o*e,t),r.offscreenBuf7&&r.offscreenBuf7.setSize(o*e,t),i&&(r.stereoBufL.setSize(e,t),r.stereoBufR.setSize(e,t))},Wf.prototype._onTick=function(){var e=this;if(this._halting)return this._running=!1,void(this._halting=!1);this._fps.update(),this._requestAnimationFrame((function(){return e._onTick()})),this._onUpdate(),this._needRender&&(this._onRender(),this._needRender=!ie.now.suspendRender||"WEBVR"===ie.now.stereo)},Wf.prototype._getBSphereRadius=function(){var e=0;return this._forEachVisual((function(t){e=Math.max(e,t.getBoundaries().boundingSphere.radius)})),e*this._objectControls.getScale()},Wf.prototype.getOBB=(ff=new a.Sphere,df=new a.Box3,pf=new a.Box3,mf=new a.Matrix4,vf=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3],function(e,t){pf.makeEmpty(),this._forEachVisual((function(t){ff.copy(t.getBoundaries().boundingSphere),ff.applyMatrix4(t.matrixWorld).applyMatrix4(e),ff.getBoundingBox(df),pf.union(df)})),pf.getCenter(t.center),mf.copy(e).invert(),t.center.applyMatrix4(mf);var n=pf.min,r=pf.max;vf[0].set(n.x,n.y,n.z),vf[1].set(r.x,n.y,n.z),vf[2].set(n.x,r.y,n.z),vf[3].set(n.x,n.y,r.z);for(var i=0,o=vf.length;i<o;i++)vf[i].applyMatrix4(mf);t.halfSize.set(Math.abs(vf[0].x-vf[1].x),Math.abs(vf[0].y-vf[2].y),Math.abs(vf[0].z-vf[3].z)).multiplyScalar(.5)}),Wf.prototype._updateFog=function(){var e=this._gfx;if(ie.now.fog){if(void 0===e.scene.fog||null===e.scene.fog){var t=jf();e.scene.fog=new a.Fog(t),this._setUberMaterialValues({fog:ie.now.fog})}!function(e,t,n){e.near=t-n*ie.now.fogNearFactor,e.far=t+n*ie.now.fogFarFactor}(e.scene.fog,e.camera.position.z,this._getBSphereRadius())}else e.scene.fog&&(e.scene.fog=void 0,this._setUberMaterialValues({fog:ie.now.fog}))},Wf.prototype._onUpdate=function(){void 0!==this.isScriptingCommandAvailable&&this.isScriptingCommandAvailable()&&!this._building&&this.callNextCmd(),this._objectControls.update(),this._forEachComplexVisual((function(e){e.getComplex().update()})),ie.now.autobuild&&!this._loading.length&&!this._building&&this._needRebuild()&&this.rebuild(),this._loading.length||this._building||this._needRebuild()||this._updateView(),this._updateFog(),this._gfx.renderer.xr.enabled&&this.webVR.updateMoleculeScale()},Wf.prototype._onRender=function(){var e=this._gfx;e.scene.updateMatrixWorld(),e.camera.updateMatrixWorld(),this._clipPlaneUpdateValue(this._getBSphereRadius()),this._fogFarUpdateValue(),e.renderer.setRenderTarget(null),e.renderer.clear(),this._renderFrame(ie.now.stereo)},Wf.prototype._renderFrame=(gf=new sf,yf=new a.Vector2,function(e){var t=this._gfx,n=t.renderer;n.getSize(yf),"NONE"!==e&&(t.camera.focus=t.camera.position.z,t.stereoCam.aspect=1,"ANAGLYPH"===e?t.stereoCam.update(t.camera):t.stereoCam.updateHalfSized(t.camera,ie.now.camFov));var r=t.renderer.getPixelRatio();switch(this._resizeOffscreenBuffers(yf.width*r,yf.height*r,e),this._renderShadowMap(),e){case"WEBVR":case"NONE":this._renderScene(t.camera,!1);break;case"SIMPLE":case"DISTORTED":n.setScissorTest(!0),n.setScissor(0,0,yf.width/2,yf.height),n.setViewport(0,0,yf.width/2,yf.height),this._renderScene(this._gfx.stereoCam.cameraL,"DISTORTED"===e),n.setScissor(yf.width/2,0,yf.width/2,yf.height),n.setViewport(yf.width/2,0,yf.width/2,yf.height),this._renderScene(this._gfx.stereoCam.cameraR,"DISTORTED"===e),n.setScissorTest(!1);break;case"ANAGLYPH":this._renderScene(this._gfx.stereoCam.cameraL,!1,t.stereoBufL),this._renderScene(this._gfx.stereoCam.cameraR,!1,t.stereoBufR),n.setRenderTarget(null),gf.uniforms.srcL.value=t.stereoBufL.texture,gf.uniforms.srcR.value=t.stereoBufR.texture,t.renderer.renderScreenQuad(gf)}t.renderer2d.render(t.scene,t.camera),ie.now.axes&&t.axes&&!t.renderer.xr.enabled&&t.axes.render(n)}),Wf.prototype._onBgColorChanged=function(){var e=this._gfx,t=jf();e&&(e.scene.fog&&e.scene.fog.color.set(t),e.renderer.setClearColor(ie.now.bg.color,Number(!ie.now.bg.transparent))),this._needRender=!0},Wf.prototype._onFogColorChanged=function(){var e=this._gfx,t=jf();e&&e.scene.fog&&e.scene.fog.color.set(t),this._needRender=!0},Wf.prototype._setUberMaterialValues=function(e){this._gfx.root.traverse((function(t){(t instanceof a.Mesh||t instanceof a.LineSegments||t instanceof a.Line)&&t.material instanceof Oi&&(t.material.setValues(e),t.material.needsUpdate=!0)}))},Wf.prototype._enableMRT=function(e,t,n){var r=this._gfx,i=r.renderer.getContext(),o=i.getExtension("WEBGL_draw_buffers"),a=r.renderer.properties;if(e){r.renderer.setRenderTarget(n);var s=a.get(n.texture).__webglTexture;i.bindTexture(i.TEXTURE_2D,s),r.renderer.setRenderTarget(t);var l=a.get(t).__webglFramebuffer,c=a.get(t.texture).__webglTexture;i.bindFramebuffer(i.FRAMEBUFFER,l),l.width=t.width,l.height=t.height,i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,c,0),i.framebufferTexture2D(i.FRAMEBUFFER,o.COLOR_ATTACHMENT1_WEBGL,i.TEXTURE_2D,s,0),o.drawBuffersWEBGL([i.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1_WEBGL])}else o.drawBuffersWEBGL([i.COLOR_ATTACHMENT0,null])},Wf.prototype._renderScene=function(e,t,n){t=t||!1,n=n||null;var r=this._gfx;if(r.renderer.setClearColor(ie.now.bg.color,Number(!ie.now.bg.transparent)),r.renderer.setRenderTarget(n),r.renderer.clear(),r.renderer.xr.enabled)r.renderer.render(r.scene,e);else{r.renderer.setClearColor(0,0),r.renderer.setRenderTarget(r.offscreenBuf4),r.renderer.clearColor(),r.renderer.setClearColor(ie.now.bg.color,Number(!ie.now.bg.transparent)),r.renderer.setRenderTarget(r.offscreenBuf),r.renderer.clear();var i=null!==this._getComplexVisual(),o=this._getVolumeVisual(),a=i&&ie.now.ao;a&&this._enableMRT(!0,r.offscreenBuf,r.offscreenBuf4),"prepass"===ie.now.transparency?this._renderWithPrepassTransparency(e,r.offscreenBuf):"standard"===ie.now.transparency&&(r.renderer.setRenderTarget(r.offscreenBuf),r.renderer.render(r.scene,e)),a&&this._enableMRT(!1,null,null);var s=i&&ie.now.outline.on,l=i&&ie.now.fxaa,c=null!==o&&null!=o.getMesh().material,u=a||s||c||l||t?r.offscreenBuf2:n,h=r.offscreenBuf;a?(this._performAO(h,r.offscreenBuf4,r.offscreenBuf.depthTexture,u,r.offscreenBuf3,r.offscreenBuf2),l||t||c||s||(h=u,u=n,r.renderer.setRenderTarget(u),r.renderer.renderScreenQuadFromTex(h.texture,1))):(r.renderer.setRenderTarget(u),r.renderer.renderScreenQuadFromTex(h.texture,1)),s&&(h=u,u=c||l||t?r.offscreenBuf3:n,null!=h&&this._renderOutline(e,r.offscreenBuf,h,u)),this._renderSelection(e,r.offscreenBuf,u),c&&(r.renderer.setRenderTarget(r.offscreenBuf),r.renderer.renderScreenQuadFromTex(u.texture,1),u=r.offscreenBuf,this._renderVolume(o,e,u,r.volBFTex,r.volFFTex,r.volWFFTex),l||t||(r.renderer.setRenderTarget(n),r.renderer.renderScreenQuadFromTex(u.texture,1))),h=u,l&&(u=t?r.offscreenBuf4:n,this._performFXAA(h,u),h=u),t&&(u=n,this._performDistortion(h,u,!0))}},Wf.prototype._performDistortion=function(){var e=new a.Scene,t=new a.OrthographicCamera(-1,1,1,-1,-500,1e3),n=new a.RawShaderMaterial({uniforms:{srcTex:{type:"t",value:null},aberration:{type:"fv3",value:new a.Vector3(1)}},vertexShader:Sn,fragmentShader:"precision highp float;\r\n\r\nvarying vec2 vUv;\r\nuniform sampler2D srcTex;\r\nuniform vec3 aberration;\r\n\r\nvoid main() {\r\n  vec2 uv = vUv * 2.0 - 1.0;\r\n  \r\n  gl_FragColor.r = texture2D(srcTex, 0.5 * (uv * aberration[0] + 1.0)).r;\r\n  gl_FragColor.g = texture2D(srcTex, 0.5 * (uv * aberration[1] + 1.0)).g;\r\n  gl_FragColor.b = texture2D(srcTex, 0.5 * (uv * aberration[2] + 1.0)).b;\r\n  gl_FragColor.a = 1.0;\r\n}",transparent:!1,depthTest:!1,depthWrite:!1}),r=Nn.buildDistorionMesh(10,10,ie.now.debug.stereoBarrel);return e.add(new eo.Mesh(r,n)),function(r,i,o){this._gfx.renderer.setRenderTarget(i),this._gfx.renderer.clear(),o?(n.uniforms.srcTex.value=r.texture,n.uniforms.aberration.value.set(.995,1,1.01),this._gfx.renderer.render(e,t)):this._gfx.renderer.renderScreenQuadFromTexWithDistortion(r,ie.now.debug.stereoBarrel)}}(),Wf.prototype._renderOutline=(_f=new Xh({depth:!0}),function(e,t,n,r){var i=this._gfx;_f.uniforms.srcTex.value=n.texture,_f.uniforms.srcDepthTex.value=t.depthTexture,_f.uniforms.srcTexSize.value.set(t.width,t.height),_f.uniforms.color.value=new a.Color(ie.now.outline.color),_f.uniforms.threshold.value=ie.now.outline.threshold,_f.uniforms.thickness.value=new a.Vector2(ie.now.outline.thickness,ie.now.outline.thickness),i.renderer.setRenderTarget(r),i.renderer.renderScreenQuad(_f)}),Wf.prototype._renderShadowMap=(xf={minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat},function(){if(ie.now.shadow.on){var e=this._gfx,t=e.renderer.getRenderTarget(),n=e.renderer.getActiveCubeFace(),r=e.renderer.getActiveMipmapLevel(),i=e.renderer.state;i.setBlending(a.NoBlending),i.buffers.color.setClear(1,1,1,1),i.buffers.depth.setTest(!0),i.setScissorTest(!1);for(var o=0;o<e.scene.children.length;o++)if("DirectionalLight"===e.scene.children[o].type){var s=e.scene.children[o];null==s.shadow.map&&(s.shadow.map=new a.WebGLRenderTarget(s.shadow.mapSize.width,s.shadow.mapSize.height,xf),s.shadow.camera.updateProjectionMatrix()),s.shadow.updateMatrices(s),e.renderer.setRenderTarget(s.shadow.map),e.renderer.clear(),e.renderer.render(e.scene,s.shadow.camera)}e.renderer.setRenderTarget(t,n,r)}}),Wf.prototype._hasSelectionToRender=function(){for(var e=this._gfx.selectionPivot,t=0;t<e.children.length;t++)if(e.children[t].children.length>0)return!0;return!1},Wf.prototype._renderSelection=function(){var e=new Xh;return function(t,n,r){var i=this._gfx;i.renderer.setClearColor("black",0),i.renderer.setRenderTarget(n),i.renderer.clear(!0,!1,!1),this._hasSelectionToRender()?(i.selectionRoot.matrix=i.root.matrix,i.selectionPivot.matrix=i.pivot.matrix,i.renderer.render(i.selectionScene,t)):i.renderer.renderDummyQuad(),i.renderer.setRenderTarget(r),i.renderer.renderScreenQuadFromTex(n.texture,.6),e.uniforms.srcTex.value=n.texture,e.uniforms.srcTexSize.value.set(n.width,n.height),i.renderer.renderScreenQuad(e)}}(),Wf.prototype._checkVolumeRenderingSupport=function(e){if(!e)return!1;var t=this._gfx,n=t.renderer.getRenderTarget();t.renderer.setRenderTarget(e);var r=t.renderer.getContext(),i=r.checkFramebufferStatus(r.FRAMEBUFFER);return t.renderer.setRenderTarget(n),i===r.FRAMEBUFFER_COMPLETE||(this.logger.warn("Device doesn't support electron density rendering"),!1)},Wf.prototype._renderVolume=(wf=new dl.BackFacePosMaterial,Sf=new dl.FrontFacePosMaterial,Mf=(new a.Matrix4).makeTranslation(.5,.5,.5),Ef=new a.Matrix4,function(e,t,n,r,i,o){var a=this._gfx;if(void 0===bf&&(bf=this._checkVolumeRenderingSupport(r)),bf){var s=e.getMesh();s.rebuild(a.camera),a.renderer.setClearColor("black",0),a.renderer.setRenderTarget(r),a.renderer.clear(),a.renderer.setRenderTarget(i),a.renderer.clear(),a.renderer.setRenderTarget(o),a.renderer.clear(),a.renderer.setRenderTarget(r),t.layers.set(Nn.LAYERS.VOLUME_BFPLANE),a.renderer.render(a.scene,t),t.layers.set(Nn.LAYERS.VOLUME),a.scene.overrideMaterial=wf,a.renderer.render(a.scene,t),a.renderer.setRenderTarget(i),t.layers.set(Nn.LAYERS.VOLUME),a.scene.overrideMaterial=Sf,a.renderer.render(a.scene,t),a.scene.overrideMaterial=null,t.layers.set(Nn.LAYERS.DEFAULT),Ef.copy(s.matrixWorld).invert(),Oi.prototype.uberOptions.world2colorMatrix.multiplyMatrices(Mf,Ef),t.layers.set(Nn.LAYERS.COLOR_FROM_POSITION),a.renderer.setRenderTarget(o),a.renderer.render(a.scene,t);var l=s.material;l.uniforms._BFRight.value=r.texture,l.uniforms._FFRight.value=i.texture,l.uniforms._WFFRight.value=o.texture,t.layers.set(Nn.LAYERS.VOLUME),a.renderer.setRenderTarget(n),a.renderer.render(a.scene,t),t.layers.set(Nn.LAYERS.DEFAULT)}}),Wf.prototype._renderWithPrepassTransparency=function(e,t){var n=this._gfx;n.renderer.setRenderTarget(t),e.layers.set(Nn.LAYERS.DEFAULT),n.renderer.render(n.scene,e),e.layers.set(Nn.LAYERS.PREPASS_TRANSPARENT),n.renderer.getContext().colorMask(!1,!1,!1,!1),n.renderer.render(n.scene,e),n.renderer.getContext().colorMask(!0,!0,!0,!0),e.layers.set(Nn.LAYERS.TRANSPARENT),n.renderer.render(n.scene,e),e.layers.set(Nn.LAYERS.DEFAULT)},Wf.prototype._performFXAA=(Tf=new Zh,function(e,t){if(void 0!==e&&void 0!==t){var n=this._gfx;n.renderer.setClearColor(ie.now.bg.color,Number(!ie.now.bg.transparent)),n.renderer.setRenderTarget(t),n.renderer.clear(),Tf.uniforms.srcTex.value=e.texture,Tf.uniforms.srcTexelSize.value.set(1/e.width,1/e.height),Tf.uniforms.bgColor.value.set(ie.now.bg.color),Tf.bgTransparent!==ie.now.bg.transparent&&(Tf.setValues({bgTransparent:ie.now.bg.transparent}),Tf.needsUpdate=!0),n.renderer.renderScreenQuad(Tf)}}),Wf.prototype._performAO=(Af=new Kh,Cf=new tf,Rf=new of,Pf=new a.Vector3,function(e,t,n,r,i,o){if(e&&t&&n&&r&&i&&o){var s=this._gfx,l=Math.tan(.5*a.MathUtils.DEG2RAD*s.camera.fov);Af.uniforms.diffuseTexture.value=e.texture,Af.uniforms.depthTexture.value=n,Af.uniforms.normalTexture.value=t.texture,Af.uniforms.srcTexelSize.value.set(1/e.width,1/e.height),Af.uniforms.camNearFar.value.set(s.camera.near,s.camera.far),Af.uniforms.projMatrix.value=s.camera.projectionMatrix,Af.uniforms.aspectRatio.value=s.camera.aspect,Af.uniforms.tanHalfFOV.value=l,s.root.matrix.extractScale(Pf),Af.uniforms.kernelRadius.value=ie.now.debug.ssaoKernelRadius*Pf.x,Af.uniforms.depthThreshold.value=2*this._getBSphereRadius(),Af.uniforms.factor.value=ie.now.debug.ssaoFactor,s.renderer.setRenderTarget(o),s.renderer.renderScreenQuad(Af),Cf.uniforms.aoMap.value=o.texture,Cf.uniforms.srcTexelSize.value.set(1/o.width,1/o.height),Cf.uniforms.depthTexture.value=n,s.renderer.setRenderTarget(i),s.renderer.renderScreenQuad(Cf),Rf.uniforms.aoMap.value=i.texture,Rf.uniforms.diffuseTexture.value=e.texture,Rf.uniforms.srcTexelSize.value.set(1/i.width,1/i.height),Rf.uniforms.depthTexture.value=n,Rf.uniforms.projMatrix.value=s.camera.projectionMatrix,Rf.uniforms.aspectRatio.value=s.camera.aspect,Rf.uniforms.tanHalfFOV.value=l;var c=s.scene.fog;c&&(Rf.uniforms.fogNearFar.value.set(c.near,c.far),Rf.uniforms.fogColor.value.set(c.color.r,c.color.g,c.color.b,ie.now.fogAlpha)),Rf.useFog===ie.now.fog&&Rf.fogTransparent===ie.now.bg.transparent||(Rf.setValues({useFog:ie.now.fog,fogTransparent:ie.now.bg.transparent}),Rf.needsUpdate=!0),s.renderer.setRenderTarget(r),s.renderer.renderScreenQuad(Rf)}}),Wf.prototype.reset=function(){this._picker&&this._picker.reset(),this._lastPick=null,this._releaseAllVisuals(),this._setEditMode(Bf),this._resetObjects(),this._gfx&&(Nn.clearTree(this._gfx.pivot),this._gfx.renderer2d.reset()),this.setNeedRender()},Wf.prototype._resetScene=function(){this._objectControls.reset(),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.resetReps(),this.resetPivot(),this.rebuildAll()},Wf.prototype.resetView=function(){this._picker&&this._picker.reset(),this._setEditMode(Bf),this._resetScene(),this._forEachComplexVisual((function(e){e.updateSelectionMask({}),e.rebuildSelectionGeometry()}))},Wf.prototype._export=function(e){var t=o.default.head(Mh.exporters.find({format:e}));if(!t)return this.logger.error("Could not find suitable exporter for this source"),Promise.reject(new Error("Could not find suitable exporter for this source"));if(this.dispatchEvent({type:"exporting"}),this._visuals[this._curVisualName]instanceof al){var n=null;return t.SourceClass===al?n=this._visuals[this._curVisualName]:t.SourceClass===mn&&(n=this._visuals[this._curVisualName]._complex),new t(n,{miewVersion:Wf.VERSION}).export().then((function(e){return e}))}return this._visuals[this._curVisualName]instanceof _l?Promise.reject(new Error("Sorry, exporter for volume data not implemented yet")):Promise.reject(new Error("Unexpected format of data"))};var Zf,$f=/^(?:(pdb|cif|mmtf|ccp4|dsn6):\s*)?(\d[a-z\d]{3})$/i,Jf=/^(?:pc|pubchem):\s*([a-z]+)$/i,Kf=/^([a-z][a-z\d\-+.]*):/i;function Qf(e,t,n){return new Promise((function(r){if(n.shouldCancel())throw new Error("Operation cancelled");n.notify({type:"fetching"}),e=function(e,t){if(!o.default.isString(e))return e;var n=$f.exec(e);if(n){var r=c(n,3),i=r[1],a=void 0===i?"pdb":i,s=r[2];switch(a=a.toLowerCase(),s=s.toUpperCase(),a){case"pdb":e="https://files.rcsb.org/download/".concat(s,".pdb");break;case"cif":e="https://files.rcsb.org/download/".concat(s,".cif");break;case"mmtf":e="https://mmtf.rcsb.org/v1.0/full/".concat(s);break;case"ccp4":e="https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(s.toLowerCase(),".ccp4");break;case"dsn6":e="https://edmaps.rcsb.org/maps/".concat(s.toLowerCase(),"_2fofc.dsn6");break;default:throw new Error("Unexpected data format shortcut")}return t.fileType=a,t.fileName="".concat(s,".").concat(a),t.sourceType="url",e}var l=Jf.exec(e);if(l){var u=l[1].toLowerCase();return e="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/".concat(u,"/JSON?record_type=3d"),t.fileType="pubchem",t.fileName="".concat(u,".json"),t.sourceType="url",e}return"url"!==t.sourceType&&void 0!==t.sourceType||(t.sourceType="url",Kf.test(e)||(e=Q.resolveURL(e))),e}(e,t);var i=o.default.head(Mh.loaders.find({type:t.sourceType,source:e}));if(!i)throw new Error(Vf);var a=t.fileName||i.extractName(e);if(a){var s=c(Q.splitFileName(a),2),l=s[0],u=s[1];o.default.defaults(t,{name:l,fileExt:u,fileName:a})}!function(e){var t=e.binary;if(void 0!==e.fileType){var n=o.default.head(Mh.parsers.find({format:e.fileType}));if(!n)throw new Error("Could not find suitable parser for this format");t=n.binary||!1}if(void 0===t&&void 0!==e.fileExt){var r=o.default.head(Mh.parsers.find({ext:e.fileExt}));r&&(t=r.binary||!1)}void 0!==e.fileExt&&".man"===e.fileExt.toLowerCase()&&(e.binary=!0,e.animation=!0),void 0!==t&&void 0!==e.binary&&e.binary!==t&&e.context.logger.warn("Overriding incorrect binary mode"),e.binary=t||!1}(t);var h=o.default.get(t,"preset.expression");if(!o.default.isUndefined(h)&&(h=JSON.parse(h))&&h.settings)for(var f=["singleUnit"],d=0,p=f.length;d<p;++d){var m=f[d],v=o.default.get(h.settings,m);o.default.isUndefined(v)||ie.set(m,v)}var g=new i(e,t);g.context=t.context,n.addEventListener("cancel",(function(){return g.abort()})),g.addEventListener("progress",(function(e){e.lengthComputable&&e.total>0?Hf(g.logger,"Fetching",e.loaded/e.total):Hf(g.logger,"Fetching")})),console.time("fetch"),r(g.load().then((function(e){return console.timeEnd("fetch"),t.context.logger.info("Fetching finished"),n.notify({type:"fetchingDone",data:e}),e})).catch((function(e){throw console.timeEnd("fetch"),t.context.logger.debug(e.message),e.stack&&t.context.logger.debug(e.stack),t.context.logger.error("Fetching failed"),n.notify({type:"fetchingDone",error:e}),e})))}))}Wf.prototype.load=function(e,t){var n=this;t=o.default.merge({},t,{context:this}),this.settings.now.use.multiFile||(this._loading.length&&(this._loading.forEach((function(e){e.cancel()})),this._loading.length=0),t.animation||this.reset(!0)),this._interpolator.reset(),this.dispatchEvent({type:"loading",options:t,source:e});var r=new te;this._loading.push(r),r.addEventListener("notification",(function(e){n.dispatchEvent(e.slaveEvent)})),this._spinner.spin(this._container);var i=function(e){var t=n._loading.indexOf(r);return-1!==t&&n._loading.splice(t,1),n._spinner.stop(),n._refreshTitle(),r.notify({type:"loadingDone",anything:e}),e};return Qf(e,t,r).then((function(e){return function(e,t,n){if(n.shouldCancel())return Promise.reject(new Error("Operation cancelled"));n.notify({type:"parsing"});var r=o.default.head(Mh.parsers.find({format:t.fileType,ext:t.fileExt,data:e}));if(!r)return Promise.reject(new Error("Could not find suitable parser"));var i=new r(e,t);return i.context=t.context,n.addEventListener("cancel",(function(){return i.abort()})),console.time("parse"),i.parse().then((function(e){return console.timeEnd("parse"),n.notify({type:"parsingDone",data:e}),e})).catch((function(e){throw console.timeEnd("parse"),t.error=e,t.context.logger.debug(e.message),e.stack&&t.context.logger.debug(e.stack),t.context.logger.error("Parsing failed"),n.notify({type:"parsingDone",error:e}),e}))}(e,t,r)})).then((function(e){var r=n._onLoad(e,t);return i(r)})).catch((function(e){throw n.logger.error("Could not load data"),n.logger.debug(e),i(e)}))},Wf.prototype.unload=function(e){this._removeVisual(e||this.getCurrentVisual()),this.resetPivot(),ie.now.shadow.on&&this._updateShadowCamera()},Wf.prototype._startAnimation=function(e){this._stopAnimation();var t=this,n=this._getComplexVisual();if(null!==n){try{this._frameInfo=new Gh(n.getComplex(),e,{onLoadStatusChanged:function(){t.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:t._isAnimating,isLoading:!t._frameInfo||t._frameInfo.isLoading}})},onError:function(e){t._stopAnimation(),t.logger.error(e)}})}catch(e){return void this.logger.error("Animation file does not fit to current complex!")}this._continueAnimation()}else this.logger.error("Unable to start animation - no molecule is loaded.")},Wf.prototype._pauseAnimation=function(){null!==this._animInterval&&(this._isAnimating=!1,clearInterval(this._animInterval),this._animInterval=null,this._frameInfo&&this.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:this._isAnimating,isLoading:this._frameInfo.isLoading}}))},Wf.prototype._continueAnimation=function(){this._isAnimating=!0;var e=1e3/ie.now.maxfps;e=Number.isNaN(e)?0:e;var t=this,n=t._gfx.pivot,r=this._getComplexVisual();r&&(r.resetSelectionMask(),r.rebuildSelectionGeometry(),this._msgAtomInfo.style.opacity=0),this._animInterval=setInterval((function(){if(t.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:t._isAnimating,isLoading:t._frameInfo.isLoading}}),t._frameInfo.frameIsReady){n.updateToFrame(t._frameInfo),t._updateObjsToFrame(t._frameInfo),t._refreshTitle(" Frame ".concat(t._frameInfo._currFrame," of ").concat(t._frameInfo._framesCount," time interval - ").concat(t._frameInfo._timeStep));try{t._frameInfo.nextFrame()}catch(e){return t.logger.error("Error during animation"),void t._stopAnimation()}t._needRender=!0}}),e)},Wf.prototype._stopAnimation=function(){null!==this._animInterval&&(clearInterval(this._animInterval),this._frameInfo.disableEvents(),this._frameInfo=null,this._animInterval=null,this.dispatchEvent({type:"mdPlayerStateChanged",state:null}))},Wf.prototype._onLoad=function(e,t){var n=this._gfx,r=null;if(t.animation)return this._refreshTitle(),this._startAnimation(e),null;if(this._stopAnimation(),t&&t.keepRepsInfo||(this._opts.reps=null,this._opts._objects=null),"Complex"===e.id){var i=e;t.fileName?i.name=i.name||Gf(t.fileName).toUpperCase():t.amberFileName?i.name=i.name||Gf(t.amberFileName).toUpperCase():i.name="Dynamic ".concat(t.fileType," molecule"),r=this._addVisual(new al(i.name,i)),this._curVisualName=r;var a=this.info();if(this.logger.info("Parsed ".concat(t.fileName," (").concat(a.atoms," atoms, ").concat(a.bonds," bonds, ").concat(a.residues," residues, ").concat(a.chains," chains).")),o.default.isNumber(this._opts.unit)&&i.setCurrentUnit(this._opts.unit),t.preset);else if(ie.now.autoPreset)switch(t.fileType){case"cml":this.resetReps("small");break;case"pdb":case"mmtf":case"cif":!function(e){var t=!1;return e.forEachComponent((function(e){e.forEachResidue((function(e){e._isValid&&(t=!0)}))})),t}(i)?this.resetReps("small"):this.resetReps("macro");break;default:this.resetReps("default")}else this.resetReps("default")}else"Volume"===e.id&&(this.resetEd(),r=this._onLoadEd(e));return n.camera.updateProjectionMatrix(),this._updateFog(),n.root.resetTransform(),this.resetPivot(),this._objectControls.setScale(ie.now.radiusToFit/this._getBSphereRadius()),this._resetObjects(),ie.now.autoResolution&&this._tweakResolution(),ie.now.shadow.on&&this._updateShadowCamera(),this._opts.view&&(this.view(this._opts.view),delete this._opts.view),this._refreshTitle(),r},Wf.prototype.resetEd=function(){this._edLoader&&(this._edLoader.abort(),this._edLoader=null),this._removeVisual(this._getVolumeVisual()),this._needRender=!0},Wf.prototype.loadEd=function(e){var t=this;this.resetEd();var n=o.default.head(Mh.loaders.find({source:e}));if(!n)return this.logger.error(Vf),Promise.reject(new Error(Vf));var r=this._edLoader=new n(e,{binary:!0});return r.context=this,r.load().then((function(e){var n=o.default.head(Mh.parsers.find({format:"ccp4"}));if(!n)throw new Error("Could not find suitable parser for this source");var r=new n(e);return r.context=t,r.parse().then((function(e){t._onLoadEd(e)}))})).catch((function(e){t.logger.error("Could not load ED data"),t.logger.debug(e)}))},Wf.prototype._onLoadEd=function(e){e.normalize();var t=new _l("volume",e);t.getMesh().layers.set(Nn.LAYERS.VOLUME);var n=this._addVisual(t);return this._needRender=!0,n},Wf.prototype._needRebuild=function(){var e=!1;return this._forEachComplexVisual((function(t){e=e||t.needsRebuild()})),e},Wf.prototype._rebuildObjects=function(){var e,t,n=this,r=this._gfx,i=[];for(e=0;e<r.pivot.children.length;++e){var o=r.pivot.children[e];o instanceof Bn||i.push(o)}for(e=0;e<i.length;++e)i[e].parent.remove(i[e]);setTimeout((function(){var i=n._objects;for(e=0,t=i.length;e<t;++e){var o=i[e];o.needsRebuild&&o.build(),o.getGeometry()&&r.pivot.add(o.getGeometry())}}),10)},Wf.prototype.changeUnit=function(e,t){var n=this._getComplexVisual(t);if(!n)throw new Error("There is no complex to change!");function r(){var e=n?n.getComplex().getCurrentUnit():0,t=e>0?"Bio molecule ".concat(e):"Asymmetric unit";return"Current unit: ".concat(e," (").concat(t,")")}return void 0===e||(o.default.isString(e)&&(e=Math.max(parseInt(e,10),0)),n.getComplex().setCurrentUnit(e)&&(this._resetScene(),this._updateInfoPanel())),r()},Wf.prototype.rebuild=function(){var e=this;if(this._building)this.logger.warn("Miew.rebuild(): already building!");else{this._building=!0,this.dispatchEvent({type:"rebuilding"}),this._rebuildObjects(),this._gfx.renderer2d.reset();var t=[];this._forEachComplexVisual((function(e){e.needsRebuild()&&t.push(e.rebuild().then((function(){return new Promise((function(t){e.rebuildSelectionGeometry(),t()}))})))}));var n=this;this._spinner.spin(this._container),Promise.all(t).then((function(){n._spinner.stop(),n._needRender=!0,n._refreshTitle(),e.dispatchEvent({type:"buildingDone"}),n._building=!1}))}},Wf.prototype.rebuildAll=function(){this._forEachComplexVisual((function(e){e.setNeedsRebuild()}))},Wf.prototype._refreshTitle=function(e){var t;e=void 0===e?"":e;var n=this._getComplexVisual();if(n){t=n.getComplex().name;var r=n.repGet(n.repCurrent());t+=r?"  ".concat(r.mode.name," Mode"):""}else t=Object.keys(this._visuals).length>0?"Unknown":"No Data";t+=e,this.dispatchEvent({type:"titleChanged",data:t})},Wf.prototype.setNeedRender=function(){this._needRender=!0},Wf.prototype._extractRepresentation=function(){var e=this,t=[];this._forEachComplexVisual((function(n){if(0!==n.getSelectionCount()){var r=n.buildSelectorFromMask(1<<n.getSelectionBit()),i=ie.now.presets.default,o=n.repAdd({selector:r,mode:i[0].mode.id,colorer:i[0].colorer.id,material:i[0].material.id});o?(e.dispatchEvent({type:"repAdded",index:o.index,name:n.name}),n.repCurrent(o.index),t.push(n.name)):n.repCount()===al.NUM_REPRESENTATION_BITS&&e.logger.warn("Number of representations is limited to ".concat(al.NUM_REPRESENTATION_BITS))}})),t.length>0&&this.logger.report("New representation from selection for complexes: ".concat(t.join(", ")))},Wf.prototype._setReps=function(e){e=e||this._opts&&this._opts.reps||[],this._forEachComplexVisual((function(t){return t.resetReps(e)}))},Wf.prototype.applyPreset=function(e){for(var t=ie.now.presets,n=[e||ie.defaults.preset,ie.defaults.preset,Object.keys(t)[0]],r=null,i=0;!r&&i<n.length;++i)ie.set("preset",n[i]),(r=t[ie.now.preset])||this.logger.warn('Unknown preset "'.concat(ie.now.preset,'"'));this._setReps(r)},Wf.prototype.resetReps=function(e){var t=this._opts&&this._opts.reps;t?this._setReps(t):this.applyPreset(e)},Wf.prototype.repCount=function(e){var t=this._getComplexVisual(e);return t?t.repCount():0},Wf.prototype.repCurrent=function(e,t){var n=this._getComplexVisual(t),r=n?n.repCurrent(e):-1;return e&&r!==e&&this.logger.warn("Representation ".concat(e," was not found. Current rep remains unchanged.")),r},Wf.prototype.rep=function(e,t){var n=this._getComplexVisual("");if(!n)return null;var r=n.rep(e,t);return"created"===r.status?this.dispatchEvent({type:"repAdded",index:r.index,name:n.name}):"changed"===r.status&&this.dispatchEvent({type:"repChanged",index:r.index,name:n.name}),r.desc},Wf.prototype.repGet=function(e,t){var n=this._getComplexVisual(t);return n?n.repGet(e):null},Wf.prototype.repAdd=function(e,t){var n=this._getComplexVisual(t);if(!n)return-1;var r=n.repAdd(e);return r?(this.dispatchEvent({type:"repAdded",index:r.index,name:t}),r.index):-1},Wf.prototype.repRemove=function(e,t){var n=this._getComplexVisual(t);n&&(n.repRemove(e),this.dispatchEvent({type:"repRemoved",index:e,name:t}))},Wf.prototype.repHide=function(e,t,n){this._needRender=!0;var r=this._getComplexVisual(n);return r?r.repHide(e,t):null},Wf.prototype._setEditMode=function(e){this._editMode=e;var t=this._msgMode;t&&(t.style.opacity=e===Bf?0:1,e!==Bf&&(t.getElementsByTagName("p")[0].innerHTML=e===zf?"COMPONENT EDIT MODE":"FRAGMENT EDIT MODE")),this.dispatchEvent({type:"editModeChanged",data:e===Bf})},Wf.prototype._enterComponentEditMode=function(){if(this._editMode===Bf){var e=[];this._forEachComplexVisual((function(t){var n=t.beginComponentEdit();n&&e.push(n)})),e!==[]&&(this._editors=e,this.logger.info("COMPONENT EDIT MODE -- ON"),this._setEditMode(zf),this._objectControls.keysTranslateObj(!0))}},Wf.prototype._applyComponentEdit=function(){if(this._editMode===zf){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var e=0;e<this._editors.length;++e)this._editors[e].apply();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (applied)"),this._setEditMode(Bf),this.rebuildAll()}},Wf.prototype._discardComponentEdit=function(){if(this._editMode===zf){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var e=0;e<this._editors.length;++e)this._editors[e].discard();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (discarded)"),this._setEditMode(Bf),this._needRender=!0,this.rebuildAll()}},Wf.prototype._enterFragmentEditMode=function(){if(this._editMode===Bf){var e=[];if(this._forEachComplexVisual((function(t){t instanceof al&&t.getSelectionCount()>0&&e.push(t)})),1===e.length){var t=e[0].beginFragmentEdit();t&&(this._editors=[t],this.logger.info("FRAGMENT EDIT MODE -- ON (single bond)"),this._setEditMode(Ff),this._objectControls.allowTranslation(!1),this._objectControls.allowAltObjFreeRotation(t.isFreeRotationAllowed()),this._needRender=!0)}}},Wf.prototype._applyFragmentEdit=function(){if(this._editMode===Ff){this._objectControls.stop();for(var e=0;e<this._editors.length;++e)this._editors[e].apply();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (applied)"),this._setEditMode(Bf),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.rebuildAll()}},Wf.prototype._discardFragmentEdit=function(){if(this._editMode===Ff){this._objectControls.stop();for(var e=0;e<this._editors.length;++e)this._editors[e].discard();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (discarded)"),this._setEditMode(Bf),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this._needRender=!0}},Wf.prototype._onPick=function(e){if(ie.now.picking&&null===this._animInterval&&this._editMode!==Ff&&!this._objectControls.isEditingAltObj()){var t=null;if(e.obj.atom?(t=e.obj.atom.residue.getChain().getComplex(),this._lastPick=e.obj.atom):e.obj.residue?(t=e.obj.residue.getChain().getComplex(),this._lastPick=e.obj.residue):e.obj.chain?(t=e.obj.chain.getComplex(),this._lastPick=e.obj.chain):e.obj.molecule?(t=e.obj.molecule.complex,this._lastPick=e.obj.molecule):this._lastPick=null,t){var n=this._getVisualForComplex(t);n&&(r(n),this._needRender=!0)}else this._forEachComplexVisual(r),this._needRender=!0;this._updateInfoPanel(),this.dispatchEvent(e)}function r(t){t.updateSelectionMask(e.obj),t.rebuildSelectionGeometry()}},Wf.prototype._onKeyDown=function(e){if(this._running&&this._hotKeysEnabled)switch(e.keyCode){case"C".charCodeAt(0):ie.now.editing&&this._enterComponentEditMode();break;case"F".charCodeAt(0):ie.now.editing&&this._enterFragmentEditMode();break;case"A".charCodeAt(0):switch(this._editMode){case zf:this._applyComponentEdit();break;case Ff:this._applyFragmentEdit()}break;case"D".charCodeAt(0):switch(this._editMode){case zf:this._discardComponentEdit();break;case Ff:this._discardFragmentEdit()}break;case"S".charCodeAt(0):e.preventDefault(),e.stopPropagation(),ie.set("ao",!ie.now.ao),this._needRender=!0;break;case 107:e.preventDefault(),e.stopPropagation(),this._forEachComplexVisual((function(e){e.expandSelection(),e.rebuildSelectionGeometry()})),this._updateInfoPanel(),this._needRender=!0;break;case 109:e.preventDefault(),e.stopPropagation(),this._forEachComplexVisual((function(e){e.shrinkSelection(),e.rebuildSelectionGeometry()})),this._updateInfoPanel(),this._needRender=!0}},Wf.prototype._onKeyUp=function(e){this._running&&this._hotKeysEnabled&&e.keyCode==="X".charCodeAt(0)&&this._extractRepresentation()},Wf.prototype._updateInfoPanel=function(){var e,t,n=this._msgAtomInfo.getElementsByTagName("p")[0],r=0;for(this._forEachComplexVisual((function(e){r+=e.getSelectionCount()}));n.firstChild;)n.removeChild(n.firstChild);if(0!==r){var i="".concat(String(r)," atom").concat(1!==r?"s":""," selected");null!==this._lastPick&&(i+=", the last pick:");var o="",a="",s="";if(this._lastPick instanceof If){t=(e=this._lastPick).residue,a=e.name;var l=32!==e.location?String.fromCharCode(e.location):"";o="".concat(e.element.fullName," #").concat(e.serial).concat(l,":       ").concat(t._chain._name,".").concat(t._type._name).concat(t._sequence).concat(t._icode.trim(),"."),o+=a,s="Coord: (".concat(e.position.x.toFixed(2).toString(),",     ").concat(e.position.y.toFixed(2).toString(),",     ").concat(e.position.z.toFixed(2).toString(),")")}else this._lastPick instanceof Nf?(t=this._lastPick,o="".concat(t._type._fullName,":       ").concat(t._chain._name,".").concat(t._type._name).concat(t._sequence).concat(t._icode.trim())):this._lastPick instanceof Of?o="chain ".concat(this._lastPick._name):this._lastPick instanceof Df&&(o="molecule ".concat(this._lastPick._name));n.appendChild(document.createTextNode(i)),""!==o&&(n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode(o))),""!==s&&(n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode(s))),this._msgAtomInfo.style.opacity=1}else this._msgAtomInfo.style.opacity=0},Wf.prototype._getAltObj=function(){if(this._editors){for(var e=null,t=0;t<this._editors.length;++t){var n=this._editors[t].getAltObj();if(n.objects.length>0){if(e){e=null;break}e=n}}if(e)return e}return{objects:[],pivot:new a.Vector3(0,0,0)}},Wf.prototype.resetPivot=function(){var e=new a.Box3,t=new a.Vector3;return function(){e.makeEmpty(),this._forEachVisual((function(t){e.union(t.getBoundaries().boundingBox)})),e.getCenter(t),this._objectControls.setPivot(t.negate()),this.dispatchEvent({type:"transform"})}}(),Wf.prototype.setPivotResidue=function(){var e=new a.Vector3;return function(t){var n=this._getVisualForComplex(t.getChain().getComplex());if(n){if(t._controlPoint)e.copy(t._controlPoint);else{for(var r=0,i=0,o=0,a=t._atoms.length,s=0;s<a;++s){var l=t._atoms[s].position;r+=l.x/a,i+=l.y/a,o+=l.z/a}e.set(r,i,o)}e.applyMatrix4(n.matrix).negate(),this._objectControls.setPivot(e),this.dispatchEvent({type:"transform"})}}}(),Wf.prototype.setPivotAtom=function(){var e=new a.Vector3;return function(t){var n=this._getVisualForComplex(t.residue.getChain().getComplex());n&&(e.copy(t.position),e.applyMatrix4(n.matrix).negate(),this._objectControls.setPivot(e),this.dispatchEvent({type:"transform"}))}}(),Wf.prototype.getSelectionCenter=(Zf=new a.Vector3(0,0,0),function(e,t,n){e.set(0,0,0);var r=0;return this._forEachComplexVisual((function(i){i.getSelectionCenter(Zf,t,n||i.getSelectionBit())&&(e.add(Zf),r++)})),0!==r&&(e.divideScalar(r),e.negate(),!0)}),Wf.prototype.setPivotSubset=function(){var e=new a.Vector3(0,0,0);function t(e,t){return e.mask&1<<t}function n(e,t){return t.selector.includesAtom(e)}return function(r){var i=r?n:t;this.getSelectionCenter(e,i,r)?(this._objectControls.setPivot(e),this.dispatchEvent({type:"transform"})):this.logger.warn("selection is empty. Center operation not performed")}}(),Wf.prototype.screenshot=function(e,t){var n,r,i,o=this._gfx,s=o.renderer.domElement.width,l=o.renderer.domElement.height;function c(){var n;if(Q.getBrowser()===Q.browserType.SAFARI){var r=document.createElement("canvas"),i=r.getContext("2d");r.width=void 0===e?s:e,r.height=void 0===t?l:t,i.drawImage(o.renderer.domElement,0,0,r.width,r.height),n=r.toDataURL("image/png")}else n=o.renderer.domElement.toDataURL("image/png");return n}if(t=t||e,void 0===e&&void 0===t||e===s&&t===l)n=c();else{var u=o.camera.aspect,h=o.camera.fov,f=(i=o.camera.fov,Math.tan(a.MathUtils.degToRad(.5*i))*Math.min(o.width,o.height)/o.height),d=e/t;o.renderer.setPixelRatio(1),o.camera.aspect=d,o.camera.fov=(r=f/Math.min(d,1),2*a.MathUtils.radToDeg(Math.atan(r))),o.camera.updateProjectionMatrix(),o.renderer.setDrawingBufferSize(e,t,1),this._renderFrame(ie.now.stereo),n=c(),o.renderer.setPixelRatio(window.devicePixelRatio),o.camera.aspect=u,o.camera.fov=h,o.camera.updateProjectionMatrix(),o.renderer.setDrawingBufferSize(o.width,o.height,window.devicePixelRatio),this._needRender=!0}return n},Wf.prototype.screenshotSave=function(e,t,n){var r=this.screenshot(t,n);Q.shotDownload(r,e)},Wf.prototype.save=function(e){var t=this;this._export(e.fileType).then((function(n){var r=t._visuals[t._curVisualName]._complex.name;Q.download(n,r,e.fileType),t._refreshTitle(),t.dispatchEvent({type:"exportingDone"})})).catch((function(e){t.logger.error("Could not export data"),t.logger.debug(e),t._refreshTitle(),t.dispatchEvent({type:"exportingDone",error:e})}))},Wf.prototype._tweakResolution=function(){var e=[["poor",100],["low",500],["medium",1e3],["high",5e3],["ultra",Number.MAX_VALUE]],t=0;if(this._forEachComplexVisual((function(e){t+=e.getComplex().getAtomCount()})),t>0)for(var n=1e6*this._gfxScore/t,r=0;r<e.length;++r)if(n<e[r][1]){this._autoChangeResolution(e[r][0]);break}},Wf.prototype._autoChangeResolution=function(e){e!==ie.now.resolution&&this.logger.report('Your rendering resolution was changed to "'.concat(e,'" for best performance.')),ie.now.resolution=e},Wf.prototype.saveSettings=function(){this._cookies.setCookie(this._opts.settingsCookie,JSON.stringify(this.settings.getDiffs(!0)))},Wf.prototype.restoreSettings=function(){try{var e=this._cookies.getCookie(this._opts.settingsCookie),t=e?JSON.parse(e):{};this.settings.applyDiffs(t,!0)}catch(e){this.logger.error("Cookies parse error: ".concat(e.message))}},Wf.prototype.resetSettings=function(){this.settings.reset()},Wf.prototype.setOptions=function(e){"string"==typeof e&&(e=Wf.options.fromAttr(e)),e.reps&&(this._opts.reps=null),o.default.merge(this._opts,e),e.settings&&this.set(e.settings),this._opts._objects=e._objects,this._resetObjects(),e.load&&this.load(e.load,{fileType:e.type}),e.preset&&(ie.now.preset=e.preset),e.reps&&this.resetReps(e.preset),this._opts.view&&(this.view(this._opts.view),delete this._opts.view);var t=this._getComplexVisual();t&&(t.getComplex().resetCurrentUnit(),o.default.isNumber(e.unit)&&t.getComplex().setCurrentUnit(e.unit),this.resetView(),this.rebuildAll())},Wf.prototype.info=function(e){var t=this._getComplexVisual(e);if(!t)return{};var n=t.getComplex(),r=n.metadata;return{id:r.id||n.name||"UNKNOWN",title:r.title&&r.title.join(" ")||"UNKNOWN DATA",atoms:n.getAtomCount(),bonds:n.getBondCount(),residues:n.getResidueCount(),chains:n.getChainCount()}},Wf.prototype.addObject=function(e,t){var n=null;if(e.type===Wh.prototype.type&&(n=Wh),null===n)throw new Error("Unknown scene object type - ".concat(e.type));try{var r=new n(e.params,e.opts);this._addSceneObject(r)}catch(e){if(t)throw e;this.logger.debug("Error during scene object creation: ".concat(e.message))}this._needRender=!0},Wf.prototype._addSceneObject=function(e){var t=this._getComplexVisual();e.build&&t&&(e.build(t.getComplex()),this._gfx.pivot.add(e.getGeometry()));var n=this._objects;n[n.length]=e},Wf.prototype._updateObjsToFrame=function(e){for(var t=this._objects,n=0,r=t.length;n<r;++n)t[n].updateToFrame&&t[n].updateToFrame(e)},Wf.prototype._resetObjects=function(){var e=this._opts._objects;if(this._objects=[],e)for(var t=0,n=e.length;t<n;++t)this.addObject(e[t],!1)},Wf.prototype.removeObject=function(e){var t=this._objects[e];if(!t)throw new Error("Scene object with index ".concat(e," does not exist"));t.destroy(),this._objects.splice(e,1),this._needRender=!0},Wf.prototype.getURL=function(e){return Me.toURL(this.getState(o.default.defaults(e,{compact:!0,settings:!1,view:!1})))},Wf.prototype.getScript=function(e){return Me.toScript(this.getState(o.default.defaults(e,{compact:!0,settings:!0,view:!0})))},Wf.prototype._compareReps=function(e,t){var n={},r=0;e&&(r=e.repCount());var i=ie.defaults.presets[ie.now.preset],a=t;void 0===i||i.length>r?(a=!1,n.preset="empty"):ie.now.preset!==ie.defaults.preset&&(n.preset=ie.now.preset);for(var s=[],l=!0,c=0,u=r;c<u;++c)s[c]=e.repGet(c).compare(a?i[c]:null),o.default.isEmpty(s[c])||(l=!1);return l||(n.reps=s),n},Wf.prototype.getState=function(e){var t={};e=o.default.defaults(e,{compact:!0,settings:!1,view:!1});var n=this._getComplexVisual();if(null!==n){var r=n.getComplex(),i=r.metadata;if(i.id){var a=i.format?"".concat(i.format,":"):"";t.load=a+i.id}var s=r.getCurrentUnit();1!==s&&(t.unit=s)}var l=this._compareReps(n,e.compact);l.preset&&(t.preset=l.preset),l.reps&&(t.reps=l.reps);for(var c=this._objects,u=[],h=0,f=c.length;h<f;++h)u[h]=c[h].identify();if(c.length>0&&(t._objects=u),e.view&&(t.view=this.view()),e.settings){var d=this.settings.getDiffs(!1);o.default.isEmpty(d)||(t.settings=d)}return t},Wf.prototype.get=function(e,t){return ie.get(e,t)},Wf.prototype._clipPlaneUpdateValue=function(e){var t=Math.max(this._gfx.camera.position.z-e*ie.now.draft.clipPlaneFactor,ie.now.camNear),n={clipPlaneValue:t};this._forEachComplexVisual((function(e){e.setUberOptions(n)}));for(var r=0,i=this._objects.length;r<i;++r){var o=this._objects[r];o._line&&o._line.material.setUberOptions(n)}null!==this._picker&&(this._picker.clipPlaneValue=t)},Wf.prototype._fogFarUpdateValue=function(){null!==this._picker&&(this._gfx.scene.fog?this._picker.fogFarValue=this._gfx.scene.fog.far:this._picker.fogFarValue=void 0)},Wf.prototype._updateShadowmapMeshes=function(e){this._forEachComplexVisual((function(t){for(var n=t._reprList,r=0,i=n.length;r<i;++r){var o=n[r];e(o.geo,o.material)}}))},Wf.prototype._updateMaterials=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this._forEachComplexVisual((function(r){return r.setMaterialValues(e,t,n)}));for(var r=0,i=this._objects.length;r<i;++r){var o=this._objects[r];o._line&&(o._line.material.setValues(e),o._line.material.needsUpdate=!0)}},Wf.prototype._fogAlphaChanged=function(){this._forEachComplexVisual((function(e){e.setUberOptions({fogAlpha:ie.now.fogAlpha})}))},Wf.prototype._embedWebXR=function(){var e=this;if("WEBVR"!==ie.now.stereo)return this.webVR&&this.webVR.disable(),void(this.webVR=null);this.webVR||(this.webVR=new Lf((function(){e._requestAnimationFrame((function(){return e._onTick()})),e._needRender=!0,e._onResize()}))),this.webVR.enable(this._gfx)},Wf.prototype._initOnSettingsChanged=function(){var e=this,t=function(t,n){(t=o.default.isArray(t)?t:[t]).forEach((function(t){e.settings.addEventListener("change:".concat(t),n)}))};t("modes.VD.frame",(function(){var t=e._getVolumeVisual();null!==t&&(t.showFrame(ie.now.modes.VD.frame),e._needRender=!0)})),t("modes.VD.isoMode",(function(){var t=e._getVolumeVisual();null!==t&&(t.getMesh().material.updateDefines(),e._needRender=!0)})),t("bg.color",(function(){e._onBgColorChanged()})),t("ao",(function(){if(ie.now.ao&&!Yf(e._gfx.renderer.getContext()))e.logger.warn("Your device or browser does not support ao"),ie.set("ao",!1);else{var t={normalsToGBuffer:ie.now.ao};e._setUberMaterialValues(t)}})),t("zSprites",(function(){ie.now.zSprites&&!Xf(e._gfx.renderer.getContext())&&(e.logger.warn("Your device or browser does not support zSprites"),ie.set("zSprites",!1)),e.rebuildAll()})),t("fogColor",(function(){e._onFogColorChanged()})),t("fogColorEnable",(function(){e._onFogColorChanged()})),t("bg.transparent",(function(t){var n=e._gfx;n&&n.renderer.setClearColor(ie.now.bg.color,Number(!ie.now.bg.transparent)),e._updateMaterials({fogTransparent:t.value}),e.rebuildAll()})),t("draft.clipPlane",(function(t){e._updateMaterials({clipPlane:t.value}),e.rebuildAll()})),t("shadow.on",(function(t){var n={shadowmap:t.value,shadowmapType:ie.now.shadow.type},r=e._gfx;r&&(r.renderer.shadowMap.enabled=Boolean(n.shadowmap)),e._updateMaterials(n,!0),n.shadowmap?(e._updateShadowCamera(),e._updateShadowmapMeshes(Js.createShadowmapMaterial)):e._updateShadowmapMeshes(Js.removeShadowmapMaterial),e._needRender=!0})),t("shadow.type",(function(t){ie.now.shadow.on&&(e._updateMaterials({shadowmapType:t.value},!0),e._needRender=!0)})),t("shadow.radius",(function(t){for(var n=0;n<e._gfx.scene.children.length;n++)void 0!==e._gfx.scene.children[n].shadow&&(e._gfx.scene.children[n].shadow.radius=t.value,e._needRender=!0)})),t("fps",(function(){e._fps.show(ie.now.fps)})),t(["fog","fogNearFactor","fogFarFactor"],(function(){e._updateFog(),e._needRender=!0})),t("fogAlpha",(function(){var t=ie.now.fogAlpha;(t<0||t>1)&&e.logger.warn("fogAlpha must belong range [0,1]"),e._fogAlphaChanged(),e._needRender=!0})),t("autoResolution",(function(t){t.value&&!e._gfxScore&&e.logger.warn("Benchmarks are missed, autoresolution will not work! Autoresolution should be set during miew startup.")})),t("stereo",(function(){e._embedWebXR("WEBVR"===ie.now.stereo),e._needRender=!0})),t(["transparency","palette"],(function(){e.rebuildAll()})),t("resolution",(function(){e.rebuildAll();var t=e._getVolumeVisual();t&&(t.getMesh().material.updateDefines(),e._needRender=!0)})),t(["axes","fxaa","ao","outline.on","outline.color","outline.threshold","outline.thickness"],(function(){e._needRender=!0}))},Wf.prototype.set=function(e,t){ie.set(e,t)},Wf.prototype.select=function(e,t){var n=this._getComplexVisual();if(n){var r=e;o.default.isString(e)&&(r=kf.parse(e).selector),n.select(r,t),this._lastPick=null,this._updateInfoPanel(),this._needRender=!0}},Wf.prototype.view=function(e){var t,n,r,i=this,o=this._gfx.pivot,s=[];return void 0===e?(t=o.position,n=i._objectControls.getScale()/ie.now.radiusToFit,(r=new a.Euler).setFromQuaternion(i._objectControls.getOrientation(),"ZXY"),s=[t.x,t.y,t.z,n,r.x,r.y,r.z],"1"+Q.arrayToBase64(s,Float32Array)):(function(){40===e.length&&(e="0".concat(e));var t=e[0];if(s=Q.arrayFromBase64(e.substr(1),Float32Array),"1"!==t){if("0"!==t)return void i.logger.warn("Encoded view version mismatch, stored as ".concat(t," vs ").concat("1"," expected"));s[3]/=8}var n=i._interpolator,r=n.createView();r.position.copy(o.position),r.scale=i._objectControls.getScale(),r.orientation.copy(i._objectControls.getOrientation());var l=n.createView();l.position.set(s[0],s[1],s[2]),i._getComplexVisual()&&l.position.sub(i._getComplexVisual().position),l.scale=s[3],l.orientation.setFromEuler(new a.Euler(s[4],s[5],s[6],"ZXY")),n.setup(r,l)}(),e)},Wf.prototype._updateView=function(){var e=this._gfx.pivot,t=this._interpolator;if(t.wasStarted()||t.start(),t.isMoving()){var n=t.getCurrentView();if(n.success){var r=n.view;e.position.copy(r.position),this._objectControls.setScale(r.scale*ie.now.radiusToFit),this._objectControls.setOrientation(r.orientation),this.dispatchEvent({type:"transform"}),this._needRender=!0}}},Wf.prototype.translate=function(e,t,n){this._objectControls.translatePivot(e,t,n),this.dispatchEvent({type:"transform"}),this._needRender=!0},Wf.prototype.rotate=function(e,t,n){this._objectControls.rotate((new a.Quaternion).setFromEuler(new a.Euler(e,t,n,"XYZ"))),this.dispatchEvent({type:"transform"}),this._needRender=!0},Wf.prototype.scale=function(e){if(e<=0)throw new RangeError("Scale should be greater than zero");this._objectControls.scale(e),this.dispatchEvent({type:"transform"}),this._needRender=!0},Wf.prototype.center=function(e){if(void 0===e)return this.setPivotSubset(),void(this._needRender=!0);if(void 0!==e.obj&&("atom"in e.obj||"residue"in e.obj))return"atom"in e.obj?this.setPivotAtom(e.obj.atom):this.setPivotResidue(e.obj.residue),void(this._needRender=!0);if(void 0===e.obj&&""!==e){var t=kf.parse(e);if(void 0===t.error)return this.setPivotSubset(t),void(this._needRender=!0)}this.resetPivot(),this._needRender=!0},Wf.prototype.within=function(e,t){var n=this._getComplexVisual();if(!n)return kf.None();e instanceof String&&(e=kf.parse(e));var r=n.within(e,t);return r&&(n.rebuildSelectionGeometry(),this._needRender=!0),r},Wf.prototype.projected=function(e,t){var n=this._getComplexVisual(t);if(!n)return!1;var r=n.getComplex().getAtomByFullname(e);if(null===r)return!1;var i=r.position.clone();return this._gfx.pivot.updateMatrixWorldRecursive(),this._gfx.camera.updateMatrixWorldRecursive(),this._gfx.pivot.localToWorld(i),i.project(this._gfx.camera),{x:.5*(i.x+1)*this._gfx.width,y:.5*(1-i.y)*this._gfx.height}},Wf.prototype.dssp=function(e){var t=this._getComplexVisual(e);t&&(t.getComplex().dssp(),t._reprList.forEach((function(e){"CA"!==e.mode.id&&"SS"!==e.colorer.id||(e.needsRebuild=!0)})))},Wf.prototype.exportCML=function(){var e=this,t=e._getComplexVisual(),n=t?t.getComplex():null;return n&&n.originalCML?(function(t){var n=function(e){var t=new a.Vector3,n=new a.Vector3,r=new a.Vector3;e.extractBasis(t,n,r),t.normalize(),n.normalize(),r.normalize();var i=new a.Matrix4;return i.identity(),i.makeBasis(t,n,r),i}(e._gfx.root.matrixWorld),r=new a.Vector4(0,0,0,0),i=new a.Vector4(0,0,0,0),o=null,s=null;t.forEachAtom((function(e){e.xmlNodeRef&&e.xmlNodeRef.xmlNode&&(o=e.xmlNodeRef.xmlNode,s=e.position,r.set(s.x,s.y,s.z,1),r.applyMatrix4(n),o.setAttribute("x3",r.x.toString()),o.setAttribute("y3",r.y.toString()),o.setAttribute("z3",r.z.toString()),o.removeAttribute("x2"),o.removeAttribute("y2"))})),t.forEachSGroup((function(e){if(e.xmlNodeRef&&e.xmlNodeRef.xmlNode){o=e.xmlNodeRef.xmlNode,s=e.getPosition(),r.set(s.x,s.y,s.z,1);var t=e.getCentralPoint();null===t?r.applyMatrix4(n):(i.set(t.x,t.y,t.z,0),r.add(i),r.applyMatrix4(n),i.set(t.x,t.y,t.z,1),i.applyMatrix4(n),r.sub(i)),o.setAttribute("x",r.x.toString()),o.setAttribute("y",r.y.toString()),o.setAttribute("z",r.z.toString())}}))}(n),(new XMLSerializer).serializeToString(n.originalCML)):null},Wf.prototype.motm=function(){ie.set({fogColorEnable:!0,fogColor:0,outline:{on:!0,threshold:.01},bg:{color:16777215}}),this._forEachComplexVisual((function(e){for(var t=[],n=e.getComplex(),r=vs.get(ie.now.palette),i=0;i<n.getChainCount();i++){var o=n._chains[i]._name,a=r.getChainColor(o);t[i]={selector:"chain ".concat(o),mode:"VW",colorer:["CB",{color:a,factor:.9}],material:"FL"}}e.resetReps(t)}))},Wf.prototype.VERSION="0.9.0+20211214.103700.4bffefe-mod",o.default.assign(Wf,{VERSION:Wf.prototype.VERSION,registeredPlugins:[],chem:yn,io:Mh,modes:Ka,colorers:js,materials:Xs,palettes:vs,options:Me,settings:ie,utils:Q,gfx:{Representation:Qs},thirdParty:{lodash:o.default,three:a}});var ed={parser:function(){var e=function(e,t,n,r){for(n=n||{},r=e.length;r--;n[e[r]]=t);return n},t=[1,60],n=[1,62],r=[1,63],i=[1,65],o=[1,66],a=[1,67],s=[1,68],l=[1,69],c=[1,80],u=[1,72],h=[1,73],f=[1,74],d=[1,75],p=[1,99],m=[1,76],v=[1,100],g=[1,79],y=[1,51],_=[1,81],x=[1,82],b=[1,84],w=[1,83],S=[1,85],M=[1,96],E=[1,97],T=[1,98],A=[1,86],C=[1,87],R=[1,64],P=[1,70],L=[1,71],k=[1,77],I=[1,78],N=[1,53],O=[1,54],D=[1,55],B=[1,61],z=[1,88],F=[1,89],V=[1,90],U=[1,91],G=[1,92],H=[1,93],j=[1,94],W=[1,95],q=[1,101],X=[1,102],Y=[1,103],Z=[1,104],$=[1,105],J=[1,56],K=[1,57],Q=[1,58],ee=[1,59],te=[1,115],ne=[1,111],re=[1,114],ie=[1,112],oe=[1,113],ae=[1,118],se=[1,117],le=[1,134],ce=[1,149],ue=[1,150],he=[1,157],fe=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],de=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,71,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],pe=[5,6,7,9,13,15,17,18,19,20,23,25,26,27,30,33,34,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,82,83,84,85,86,87,88,89,90,91,92,93,94,95],me=[5,70,72],ve=[5,74],ge=[71,101],ye={trace:function(){},yy:{},symbols_:{error:2,Program:3,Command:4,EOF:5,RESET:6,BUILD:7,ALL:8,HELP:9,Path:10,MOTM:11,OneArgCommand:12,GET:13,STRING:14,SET:15,Value:16,SET_SAVE:17,SET_RESTORE:18,SET_RESET:19,PRESET:20,AddRepresentation:21,EditRepresentation:22,REMOVE:23,RepresentationReference:24,HIDE:25,SHOW:26,LIST:27,EXPAND_KEY:28,SELECTOR_KEY:29,SELECT:30,AS:31,WordAll:32,SELECTOR:33,WITHIN:34,NUMBER:35,OF:36,MATERIAL:37,IDENTIFIER:38,ModeCMD:39,ColorCMD:40,VIEW:41,BASE_64:42,UNIT:43,DSSP:44,SCALE:45,ROTATE:46,AxesList:47,TRANSLATE:48,CENTER:49,GetURLBranch:50,Screenshot:51,LINE:52,ArgList:53,LISTOBJ:54,REMOVEOBJ:55,URL:56,VIEW_KEY:57,SCREENSHOT:58,LOAD:59,Url:60,FILE_KEY:61,ADD:62,Description:63,REP:64,MODE:65,COLOR:66,Descriptor:67,RepresentationOwnProperty:68,RepresentationOwnPropertyOpts:69,DESC_KEY:70,"=":71,DESC_KEY_OPTS:72,AxesArg:73,DESC_KEY_AXES:74,Arg:75,PathWoDescKey:76,HEX:77,BOOL:78,Word:79,CommandSetWoDESC_KEY:80,DescKeys:81,CLEAR:82,FILE_LIST:83,FILE_REGISTER:84,FILE_DELETE:85,PRESET_ADD:86,PRESET_DELETE:87,PRESET_UPDATE:88,PRESET_RENAME:89,PRESET_OPEN:90,CREATE_SCENARIO:91,RESET_SCENARIO:92,DELETE_SCENARIO:93,ADD_SCENARIO_ITEM:94,LIST_SCENARIO:95,PDB_KEY:96,DELAY_KEY:97,PRST_KEY:98,DESCRIPTION_KEY:99,CommandSet:100,".":101,PresetPath:102,"/":103,HexOrNumber:104,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"RESET",7:"BUILD",8:"ALL",9:"HELP",11:"MOTM",13:"GET",14:"STRING",15:"SET",17:"SET_SAVE",18:"SET_RESTORE",19:"SET_RESET",20:"PRESET",23:"REMOVE",25:"HIDE",26:"SHOW",27:"LIST",28:"EXPAND_KEY",29:"SELECTOR_KEY",30:"SELECT",31:"AS",33:"SELECTOR",34:"WITHIN",35:"NUMBER",36:"OF",37:"MATERIAL",38:"IDENTIFIER",41:"VIEW",42:"BASE_64",43:"UNIT",44:"DSSP",45:"SCALE",46:"ROTATE",48:"TRANSLATE",49:"CENTER",52:"LINE",54:"LISTOBJ",55:"REMOVEOBJ",56:"URL",57:"VIEW_KEY",58:"SCREENSHOT",59:"LOAD",61:"FILE_KEY",62:"ADD",64:"REP",65:"MODE",66:"COLOR",70:"DESC_KEY",71:"=",72:"DESC_KEY_OPTS",74:"DESC_KEY_AXES",77:"HEX",78:"BOOL",82:"CLEAR",83:"FILE_LIST",84:"FILE_REGISTER",85:"FILE_DELETE",86:"PRESET_ADD",87:"PRESET_DELETE",88:"PRESET_UPDATE",89:"PRESET_RENAME",90:"PRESET_OPEN",91:"CREATE_SCENARIO",92:"RESET_SCENARIO",93:"DELETE_SCENARIO",94:"ADD_SCENARIO_ITEM",95:"LIST_SCENARIO",96:"PDB_KEY",97:"DELAY_KEY",98:"PRST_KEY",99:"DESCRIPTION_KEY",101:".",103:"/"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,2],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,1],[4,2],[4,2],[4,2],[4,4],[4,2],[4,6],[4,2],[4,1],[4,1],[4,1],[4,2],[4,2],[4,1],[4,2],[4,1],[4,2],[4,2],[4,2],[4,1],[4,2],[4,1],[4,1],[4,3],[4,3],[4,4],[4,4],[4,1],[4,2],[50,1],[50,2],[50,2],[50,3],[50,3],[51,1],[51,2],[51,3],[12,2],[12,2],[12,2],[21,1],[21,2],[21,2],[21,3],[22,2],[22,3],[39,2],[39,3],[40,2],[40,3],[24,1],[24,1],[63,1],[63,2],[63,3],[63,4],[67,1],[67,1],[67,2],[68,3],[69,3],[47,1],[47,2],[73,2],[53,1],[53,2],[75,3],[16,1],[16,1],[16,1],[16,1],[16,1],[79,1],[79,1],[32,1],[32,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[100,1],[100,1],[76,1],[76,3],[76,3],[10,1],[10,1],[10,3],[10,3],[10,3],[60,1],[102,1],[102,3],[104,1],[104,1]],performAction:function(e,t,n,r,i,o,a){var s=o.length-1;switch(i){case 1:return o[s-1];case 3:this.$=r.miew.reset(!1),r.ClearContext(),r.miew.resetReps("empty");break;case 4:this.$=r.miew.rebuild();break;case 5:this.$=r.miew.rebuildAll(),r.miew.rebuild();break;case 6:this.$=r.echo(r.utils.help().toString());break;case 7:this.$=r.echo(r.utils.help(o[s]).toString());break;case 8:this.$=r.miew.motm();break;case 10:case 11:this.$=r.utils.propagateProp(o[s]),r.echo(r.miew.get(o[s]).toString());break;case 12:case 13:this.$=r.miew.set(o[s-1],r.utils.propagateProp(o[s-1],o[s]));break;case 14:this.$=r.miew.saveSettings();break;case 15:this.$=r.miew.restoreSettings();break;case 16:this.$=r.miew.resetSettings();break;case 17:this.$=r.miew.resetReps();break;case 18:this.$=r.miew.applyPreset(o[s]);break;case 21:this.$=r.miew.repRemove(o[s]),r.representations.remove(o[s]);break;case 22:this.$=r.miew.repHide(o[s]);break;case 23:this.$=r.miew.repHide(o[s],!1);break;case 24:this.$=r.echo(r.utils.listRep(r.miew,r.representations,o[s],"-e"));break;case 25:this.$=r.echo(r.utils.list(r.miew,r.representations));break;case 26:this.$=r.echo(r.utils.list(r.miew,r.representations,o[s]));break;case 27:this.$=r.echo(r.utils.listSelector(r.miew,r.Context));break;case 28:this.$=r.miew.select(r.utils.checkArg(o[s-1].toLowerCase(),o[s],!0));break;case 29:this.$=r.Context[o[s].toLowerCase()]=r.utils.checkArg(o[s-3].toLowerCase(),o[s-2],!0),r.miew.select(r.Context[o[s].toLowerCase()]);break;case 30:this.$=r.miew.rep(r.miew.repCurrent(),{selector:r.utils.checkArg(o[s-1].toLowerCase(),o[s])});break;case 31:this.$=r.Context[o[s].toLowerCase()]=r.miew.within(r.utils.checkArg("select",o[s-2],!0),Number(o[s-4]));break;case 32:this.$=r.miew.rep(r.miew.repCurrent(),{material:r.utils.checkArg(o[s-1].toLowerCase(),o[s].toUpperCase())});break;case 35:this.$=r.echo(r.miew.view());break;case 36:case 37:this.$=r.miew.view(o[s]);break;case 38:this.$=r.echo(r.miew.changeUnit());break;case 39:this.$=r.echo(r.miew.changeUnit(o[s]));break;case 40:this.$=r.miew.dssp();break;case 41:this.$=r.miew.scale(o[s]);break;case 42:for(var l=0,c=o[s].length;l<c;l++)r.miew.rotate(o[s][l].x*Math.PI/180,o[s][l].y*Math.PI/180,o[s][l].z*Math.PI/180);break;case 43:for(l=0,c=o[s].length;l<c;l++)r.miew.translate(o[s][l].x||0,o[s][l].y||0,o[s][l].z||0);break;case 44:this.$=r.miew.center();break;case 45:this.$=r.miew.center(o[s]);break;case 48:case 49:this.$=r.miew.addObject({type:"line",params:[o[s-1],o[s]]},!0);break;case 50:case 51:this.$=r.miew.addObject({type:"line",params:[o[s-2],o[s-1]],opts:o[s].toJSO(r.utils,"objects","line")},!0);break;case 52:this.$=r.echo(r.utils.listObjs(r.miew));break;case 53:this.$=r.miew.removeObject(o[s]);break;case 54:this.$=r.echo(r.miew.getURL({view:!1,settings:!1}));break;case 55:this.$=r.echo(r.miew.getURL({view:!1,settings:!0}));break;case 56:this.$=r.echo(r.miew.getURL({view:!0,settings:!1}));break;case 57:case 58:this.$=r.echo(r.miew.getURL({view:!0,settings:!0}));break;case 59:this.$=r.miew.screenshotSave();break;case 60:this.$=r.miew.screenshotSave("",Number(o[s]));break;case 61:this.$=r.miew.screenshotSave("",Number(o[s-1]),Number(o[s]));break;case 62:case 63:case 64:this.$=r.utils.load(r.miew,o[s]),r.representations.clear();break;case 65:this.$=r.echo(r.representations.add(r.miew.repAdd()));break;case 66:this.$=r.echo(r.representations.add(o[s],r.miew.repAdd()));break;case 67:this.$=r.echo(r.representations.add(r.miew.repAdd(o[s])));break;case 68:this.$=r.echo(r.representations.add(o[s-1],r.miew.repAdd(o[s])));break;case 69:this.$=r.miew.rep(o[s]),r.miew.repCurrent(o[s]);break;case 70:this.$=r.miew.rep(o[s-1],o[s]),r.miew.repCurrent(o[s-1]);break;case 71:this.$=r.miew.rep(r.miew.repCurrent(),{mode:r.utils.checkArg(o[s-1].toLowerCase(),o[s].toUpperCase())});break;case 72:this.$=r.miew.rep(r.miew.repCurrent(),{mode:new Array(r.utils.checkArg(o[s-2].toLowerCase(),o[s-1].toUpperCase()),o[s].toJSO(r.utils,o[s-2],o[s-1].toUpperCase()))});break;case 73:this.$=r.miew.rep(r.miew.repCurrent(),{colorer:r.utils.checkArg(o[s-1].toLowerCase(),o[s].toUpperCase())});break;case 74:this.$=r.miew.rep(r.miew.repCurrent(),{colorer:new Array(r.utils.checkArg(o[s-2].toLowerCase(),o[s-1].toUpperCase()),o[s].toJSO(r.utils,o[s-2],o[s-1].toUpperCase()))});break;case 75:this.$=Number(r.representations.get(o[s]));break;case 76:case 92:this.$=Number(o[s]);break;case 77:this.$=o[s];break;case 78:this.$=r._.assign(o[s-1],o[s]);break;case 79:this.$=r._.assign(o[s-2],o[s-1],o[s]);break;case 80:this.$=r._.assign(o[s-3],o[s-2],o[s-1],o[s]);break;case 81:case 82:this.$=r.CreateObjectPair(o[s].key,o[s].val);break;case 83:this.$=r.CreateObjectPair(o[s-1].key,new Array(o[s-1].val,o[s].toJSO(r.utils,o[s-1].key,o[s-1].val)));break;case 84:case 85:this.$=Object.create({key:r.keyRemap(o[s-2]),val:r.utils.checkArg(o[s-2],o[s])});break;case 86:this.$=[o[s]];break;case 87:this.$=o[s-1].concat(o[s]);break;case 88:this.$=r.CreateObjectPair(o[s-1].toLowerCase(),Number(o[s]));break;case 89:this.$=new r.ArgList(o[s]);break;case 90:this.$=o[s-1].append(o[s]);break;case 91:this.$=new r.Arg(o[s-2],o[s]);break;case 93:this.$=parseInt(o[s]);break;case 94:this.$=JSON.parse(o[s]);break;case 95:case 96:this.$=String(o[s]);break;case 157:case 158:case 161:case 162:case 163:this.$=o[s-2]+o[s-1]+o[s];break;case 166:this.$=o[s-2]=o[s-2]+o[s-1]+o[s]}},table:[{3:1,4:2,5:[1,3],6:[1,4],7:[1,5],9:[1,6],11:[1,7],12:8,13:[1,9],15:[1,10],17:[1,11],18:[1,12],19:[1,13],20:[1,14],21:15,22:16,23:[1,17],25:[1,18],26:[1,19],27:[1,20],30:[1,21],33:[1,22],34:[1,23],37:[1,24],39:25,40:26,41:[1,27],43:[1,28],44:[1,29],45:[1,30],46:[1,31],48:[1,32],49:[1,33],50:34,51:35,52:[1,36],54:[1,37],55:[1,38],56:[1,44],58:[1,45],59:[1,39],62:[1,40],64:[1,41],65:[1,42],66:[1,43]},{1:[3]},{5:[1,46]},{1:[2,2]},{5:[2,3]},{5:[2,4],8:[1,47]},{5:[2,6],6:t,7:n,9:r,10:48,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:49,80:52,81:50,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee},{5:[2,8]},{5:[2,9]},{6:t,7:n,9:r,10:106,13:i,14:[1,107],15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:49,80:52,81:50,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee},{6:t,7:n,9:r,10:108,13:i,14:[1,109],15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:49,80:52,81:50,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee},{5:[2,14]},{5:[2,15]},{5:[2,16]},{5:[2,17],14:te,16:110,35:ne,38:re,77:ie,78:oe},{5:[2,19]},{5:[2,20]},{24:116,35:ae,38:se},{24:119,35:ae,38:se},{24:120,35:ae,38:se},{5:[2,25],24:121,28:[1,122],29:[1,123],35:ae,38:se},{14:[1,124]},{14:[1,125]},{35:[1,126]},{38:[1,127]},{5:[2,33]},{5:[2,34]},{5:[2,35],14:[1,128],42:[1,129]},{5:[2,38],35:[1,130]},{5:[2,40]},{35:[1,131]},{47:132,73:133,74:le},{47:135,73:133,74:le},{5:[2,44],14:[1,136]},{5:[2,46]},{5:[2,47]},{6:t,7:n,9:r,10:138,13:i,14:[1,137],15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:49,80:52,81:50,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee},{5:[2,52]},{35:[1,139]},{14:[1,143],38:[1,141],60:140,61:[1,142]},{5:[2,65],38:[1,144],63:145,67:146,68:147,69:148,70:ce,72:ue},{24:151,35:ae,38:se},{38:[1,152]},{38:[1,153]},{5:[2,54],29:[1,154],57:[1,155]},{5:[2,59],35:[1,156]},{1:[2,1]},{5:[2,5]},{5:[2,7],101:he},e(fe,[2,159]),e(fe,[2,160]),e(de,[2,97]),e(de,[2,98]),e(fe,[2,147]),e(fe,[2,148]),e(fe,[2,149]),e(fe,[2,150]),e(fe,[2,151]),e(fe,[2,152]),e(fe,[2,153]),e(de,[2,101]),e(de,[2,102]),e(de,[2,103]),e(de,[2,104]),e(de,[2,105]),e(de,[2,106]),e(de,[2,107]),e(de,[2,108]),e(de,[2,109]),e(de,[2,110]),e(de,[2,111]),e(de,[2,112]),e(de,[2,113]),e(de,[2,114]),e(de,[2,115]),e(de,[2,116]),e(de,[2,117]),e(de,[2,118]),e(de,[2,119]),e(de,[2,120]),e(de,[2,121]),e(de,[2,122]),e(de,[2,123]),e(de,[2,124]),e(de,[2,125]),e(de,[2,126]),e(de,[2,127]),e(de,[2,128]),e(de,[2,129]),e(de,[2,130]),e(de,[2,131]),e(de,[2,132]),e(de,[2,133]),e(de,[2,134]),e(de,[2,135]),e(de,[2,136]),e(de,[2,137]),e(de,[2,138]),e(de,[2,139]),e(de,[2,140]),e(de,[2,141]),e(de,[2,142]),e(de,[2,143]),e(de,[2,144]),e(de,[2,145]),e(de,[2,146]),{5:[2,10],101:he},{5:[2,11]},{14:te,16:158,35:ne,38:re,77:ie,78:oe,101:he},{14:te,16:159,35:ne,38:re,77:ie,78:oe},{5:[2,18]},e(pe,[2,92]),e(pe,[2,93]),e(pe,[2,94]),e(pe,[2,95]),e(pe,[2,96]),{5:[2,21]},e(me,[2,75]),e(me,[2,76]),{5:[2,22]},{5:[2,23]},{5:[2,24]},{5:[2,26]},{5:[2,27]},{5:[2,28],31:[1,160]},{5:[2,30]},{36:[1,161]},{5:[2,32]},{5:[2,36]},{5:[2,37]},{5:[2,39]},{5:[2,41]},{5:[2,42],73:162,74:le},e(ve,[2,86]),{35:[1,163]},{5:[2,43],73:162,74:le},{5:[2,45]},{14:[1,164]},{6:t,7:n,9:r,10:165,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:49,80:52,81:50,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee,101:he},{5:[2,53]},{5:[2,62]},{5:[2,63]},{5:[2,64]},{5:[2,164]},{5:[2,66],63:166,67:146,68:147,69:148,70:ce,72:ue},{5:[2,67]},{5:[2,77],67:167,68:147,69:148,70:ce,72:ue},e(me,[2,81]),e(me,[2,82],{80:52,53:168,75:169,76:170,79:171,6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$}),{71:[1,172]},{71:[1,173]},{5:[2,69],63:174,67:146,68:147,69:148,70:ce,72:ue},{5:[2,71],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,53:175,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:169,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},{5:[2,73],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,53:176,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:169,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},{5:[2,55],57:[1,177]},{5:[2,56],29:[1,178]},{5:[2,60],35:[1,179]},{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,35:[1,181],37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:180,80:52,81:182,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee},{5:[2,12]},{5:[2,13]},{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,32:183,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:184,80:52,81:185,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee},{14:[1,186]},e(ve,[2,87]),e(ve,[2,88]),{5:[2,48],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,53:187,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:169,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},{5:[2,49],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,53:188,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:169,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,101:he},{5:[2,68]},{5:[2,78],67:189,68:147,69:148,70:ce,72:ue},e(me,[2,83],{80:52,76:170,79:171,75:190,6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$}),e(pe,[2,89]),{71:[1,191],101:[1,192]},e(ge,[2,156]),{14:te,16:193,35:ne,38:re,77:ie,78:oe},{14:te,16:194,35:ne,38:re,77:ie,78:oe},{5:[2,70]},{5:[2,72],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:190,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},{5:[2,74],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:190,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},{5:[2,57]},{5:[2,58]},{5:[2,61]},e(fe,[2,161]),e(fe,[2,162]),e(fe,[2,163]),{5:[2,29]},{5:[2,99]},{5:[2,100]},{31:[1,195]},{5:[2,50],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:190,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},{5:[2,51],6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,75:190,76:170,79:171,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},{5:[2,79],67:196,68:147,69:148,70:ce,72:ue},e(pe,[2,90]),{14:te,16:197,35:ne,38:re,77:ie,78:oe},{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,33:m,34:v,35:[1,199],37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,79:198,80:52,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$},e(me,[2,84]),e(pe,[2,85]),{6:t,7:n,9:r,13:i,15:o,17:a,18:s,19:l,20:c,23:u,25:h,26:f,27:d,30:p,32:200,33:m,34:v,37:g,38:y,41:_,43:x,45:b,46:w,49:S,52:M,54:E,55:T,56:A,58:C,59:R,62:P,64:L,65:k,66:I,70:N,72:O,74:D,79:184,80:52,81:185,82:B,83:z,84:F,85:V,86:U,87:G,88:H,89:j,90:W,91:q,92:X,93:Y,94:Z,95:$,96:J,97:K,98:Q,99:ee},{5:[2,80]},e(pe,[2,91]),e(ge,[2,157]),e(ge,[2,158]),{5:[2,31]}],defaultActions:{3:[2,2],4:[2,3],7:[2,8],8:[2,9],11:[2,14],12:[2,15],13:[2,16],15:[2,19],16:[2,20],25:[2,33],26:[2,34],29:[2,40],34:[2,46],35:[2,47],37:[2,52],46:[2,1],47:[2,5],107:[2,11],110:[2,18],116:[2,21],119:[2,22],120:[2,23],121:[2,24],122:[2,26],123:[2,27],125:[2,30],127:[2,32],128:[2,36],129:[2,37],130:[2,39],131:[2,41],136:[2,45],139:[2,53],140:[2,62],141:[2,63],142:[2,64],143:[2,164],145:[2,67],158:[2,12],159:[2,13],166:[2,68],174:[2,70],177:[2,57],178:[2,58],179:[2,61],183:[2,29],184:[2,99],185:[2,100],196:[2,80],200:[2,31]},parseError:function(e,t){if(!t.recoverable){var n=new Error(e);throw n.hash=t,n}this.trace(e)},parse:function(e){var t=this,n=[0],r=[],i=[null],o=[],a=this.table,s="",l=0,c=0,u=2,h=1,f=o.slice.call(arguments,1),d=Object.create(this.lexer),p={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(p.yy[m]=this.yy[m]);d.setInput(e,p.yy),p.yy.lexer=d,p.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var v=d.yylloc;o.push(v);var g=d.options&&d.options.ranges;function y(){var e;return"number"!=typeof(e=r.pop()||d.lex()||h)&&(e instanceof Array&&(e=(r=e).pop()),e=t.symbols_[e]||e),e}"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,x,b,w,S,M,E,T,A={};;){if(x=n[n.length-1],this.defaultActions[x]?b=this.defaultActions[x]:(null==_&&(_=y()),b=a[x]&&a[x][_]),void 0===b||!b.length||!b[0]){var C="";for(S in T=[],a[x])this.terminals_[S]&&S>u&&T.push("'"+this.terminals_[S]+"'");C=d.showPosition?"Parse error on line "+(l+1)+":\n"+d.showPosition()+"\nExpecting "+T.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(l+1)+": Unexpected "+(_==h?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(C,{text:d.match,token:this.terminals_[_]||_,line:d.yylineno,loc:v,expected:T})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+_);switch(b[0]){case 1:n.push(_),i.push(d.yytext),o.push(d.yylloc),n.push(b[1]),_=null,c=d.yyleng,s=d.yytext,l=d.yylineno,v=d.yylloc;break;case 2:if(M=this.productions_[b[1]][1],A.$=i[i.length-M],A._$={first_line:o[o.length-(M||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(M||1)].first_column,last_column:o[o.length-1].last_column},g&&(A._$.range=[o[o.length-(M||1)].range[0],o[o.length-1].range[1]]),void 0!==(w=this.performAction.apply(A,[s,c,l,p.yy,b[1],i,o].concat(f))))return w;M&&(n=n.slice(0,-1*M*2),i=i.slice(0,-1*M),o=o.slice(0,-1*M)),n.push(this.productions_[b[1]][0]),i.push(A.$),o.push(A._$),E=a[n[n.length-2]][n[n.length-1]],n.push(E);break;case 3:return!0}}return!0}},_e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if((n=this._input.match(this.rules[i[o]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,i[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,i[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(e,t,n,r){switch(n){case 0:break;case 1:case 2:return"";case 3:return 42;case 4:return 35;case 5:return 77;case 6:case 7:return 78;case 8:return 8;case 9:return 6;case 10:return 82;case 11:return 7;case 12:return 9;case 13:return 59;case 14:return 13;case 15:return 15;case 16:return 17;case 17:return 18;case 18:return 19;case 19:return 20;case 20:return 11;case 21:return 62;case 22:return 64;case 23:return 23;case 24:return 25;case 25:return 26;case 26:return 27;case 27:return 30;case 28:return 34;case 29:return 33;case 30:return 65;case 31:return 66;case 32:return 37;case 33:return 41;case 34:return 43;case 35:return 52;case 36:return 54;case 37:return 55;case 38:return 46;case 39:return 48;case 40:return 45;case 41:return 49;case 42:return 56;case 43:return 58;case 44:return 44;case 45:return 83;case 46:return 84;case 47:return 85;case 48:return 86;case 49:return 87;case 50:return 88;case 51:return 89;case 52:return 90;case 53:return 91;case 54:return 92;case 55:return 93;case 56:return 94;case 57:return 95;case 58:case 59:return 70;case 60:case 61:return 72;case 62:case 63:case 64:return 74;case 65:return 31;case 66:return 36;case 67:return 96;case 68:return 97;case 69:return 98;case 70:return 99;case 71:return t.yytext=e.utils.unquoteString(t.yytext),14;case 72:return 38;case 73:return 5;case 74:return 101;case 75:return 103;case 76:return"\\";case 77:return 28;case 78:return 61;case 79:return 29;case 80:return 57;case 81:return 71}},rules:[/^(?:\s+)/i,/^(?:[#].*)/i,/^(?:\/\/.*)/i,/^(?:([_A-Z0-9\/\+]+==))/i,/^(?:-?[0-9]+(\.[0-9]+)?\b)/i,/^(?:0[xX][0-9A-F]+\b)/i,/^(?:false\b)/i,/^(?:true\b)/i,/^(?:all\b)/i,/^(?:reset\b)/i,/^(?:clear\b)/i,/^(?:build\b)/i,/^(?:help\b)/i,/^(?:load\b)/i,/^(?:get\b)/i,/^(?:set\b)/i,/^(?:set_save\b)/i,/^(?:set_restore\b)/i,/^(?:set_reset\b)/i,/^(?:preset\b)/i,/^(?:motm\b)/i,/^(?:add\b)/i,/^(?:rep\b)/i,/^(?:remove\b)/i,/^(?:hide\b)/i,/^(?:show\b)/i,/^(?:list\b)/i,/^(?:select\b)/i,/^(?:within\b)/i,/^(?:selector\b)/i,/^(?:mode\b)/i,/^(?:color\b)/i,/^(?:material\b)/i,/^(?:view\b)/i,/^(?:unit\b)/i,/^(?:line\b)/i,/^(?:listobj\b)/i,/^(?:removeobj\b)/i,/^(?:rotate\b)/i,/^(?:translate\b)/i,/^(?:scale\b)/i,/^(?:center\b)/i,/^(?:url\b)/i,/^(?:screenshot\b)/i,/^(?:dssp\b)/i,/^(?:file_list\b)/i,/^(?:file_register\b)/i,/^(?:file_delete\b)/i,/^(?:preset_add\b)/i,/^(?:preset_delete\b)/i,/^(?:preset_update\b)/i,/^(?:preset_rename\b)/i,/^(?:preset_open\b)/i,/^(?:create_scenario\b)/i,/^(?:reset_scenario\b)/i,/^(?:delete_scenario\b)/i,/^(?:add_scenario_item\b)/i,/^(?:list_scenario\b)/i,/^(?:s\b)/i,/^(?:mt\b)/i,/^(?:m\b)/i,/^(?:c\b)/i,/^(?:x\b)/i,/^(?:y\b)/i,/^(?:z\b)/i,/^(?:as\b)/i,/^(?:of\b)/i,/^(?:pdb\b)/i,/^(?:delay\b)/i,/^(?:prst\b)/i,/^(?:desc\b)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:\.)/i,/^(?:\/)/i,/^(?:\\)/i,/^(?:-e\b)/i,/^(?:-f\b)/i,/^(?:-s\b)/i,/^(?:-v\b)/i,/^(?:=)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81],inclusive:!0}}};function xe(){this.yy={}}return ye.lexer=_e,xe.prototype=ye,ye.Parser=xe,new xe}()},td={$help:["Rendering mode shortcut","    BS - balls and sticks mode","    LN - lines mode","    LC - licorice mode","    VW - van der waals mode","    TR - trace mode","    TU - tube mode","    CA - cartoon mode","    SA - isosurface mode","    QS - quick surface mode","    SE - solvent excluded mode","    TX - text mode"],BS:{$help:["   Balls and sticks","      aromrad = <number> #aromatic radius","      atom = <number>    #atom radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic","      space = <number>   #space value\n"]},CA:{$help:["   Cartoon","      arrow = <number>   #arrow size","      depth = <number>   #depth of surface","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius","      tension = <number> #","      width = <number>  #secondary width\n"]},LN:{$help:["   Lines","      atom = <number>    #atom radius","      chunkarom = <number>","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic","      offsarom = <number>\n"]},LC:{$help:["   Licorice","      aromrad = <number> #aromatic radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic","      space = <number>   #space value\n"]},VW:{$help:["   Van der Waals","      nothing\n"]},TR:{$help:["   Trace","      radius = <number>  #tube radius\n"]},TU:{$help:["   Tube","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius","      tension = <number> \n"]},SA:{$help:["   Surface","      zClip = <bool> #clip z plane\n"]},QS:{$help:["   Quick surface","      isoValue = <number>","      scale = <number>","      wireframe = <bool>","      zClip = <bool> #clip z plane\n"]},SE:{$help:["   Solvent excluded surface","      zClip = <bool> #clip z plane\n"]},TX:{$help:["   Text mode",'      template = <format string> string that can include "{{ id }}"',"          it will be replaced by value, id can be one of next:","          serial, name, type, sequence, residue, chain, hetatm, water\n",'      horizontalAlign = <string> {"left", "right", "center"}','      verticalAlign = <string> {"top", "bottom", "middle"}',"      dx = <number> #offset along x","      dy = <number> #offset along y","      dz = <number> #offset along z","      fg = <string> #text color modificator","           could be keyword, named color or hex","      fg = <string> #back color modificator","           could be keyword, named color or hex","      showBg = <bool> #if set show background","           plate under text"]}},nd={$help:["Coloring mode shortcut","    EL - color by element","    CH - color by chain","    SQ - color by sequence","    RT - color by residue type","    SS - color by secondary structure","    UN - uniform"],UN:{$help:["Parameters of coloring modes customization","   Uniform","      color = <number|color> #RGB->HEX->dec\n"],color:{$help:Object.keys(vs.get(ie.now.palette).namedColors).sort().join("\n")}}},rd={$help:["Material shortcut","    DF - diffuse","    TR - transparent","    SF - soft plastic","    PL - glossy plastic","    ME - metal","    GL - glass"]},id={$help:["Short (packed) representation description as a set of variables","    s=<EXPRESSION>","        selector property","    m=<MODE_ID>[!<PARAMETER>:<VALUE>[,...]]","        render mode property","    c=<COLORER_ID>[!<PARAMETER>:<VALUE>[,...]]","        color mode property","    mt=<MATERIAL_ID>","        material property"],s:{$help:"Selection expression string as it is in menu->representations->selection"},m:td,c:nd,mt:rd},od={$help:["Parameters of rendering modes customization: modes","Parameters of colorer customization: colorers","Autobuild: autobuild = (<number>|<bool>)"],modes:td,colorers:nd},ad={$help:["help (<cmd name>| <path to property>)","You can get detailed information about command options",'   using "help cmd.opt.opt.[...]"\n',"   you can use one line comments","   everything started from (#|//) will be skipped","   Example: >build //some comment\n","List of available commands:"],reset:{$help:["Reload current object, delete all representations","    Nothing will work until load new object"]},load:{$help:["load (<PDBID>|<URL>|-f [<*.NC FILE URL STRING>])","    Load new pdb object from selected source"],PDBID:{$help:"pdb id in remote molecule database"},URL:{$help:"url to source file"},f:{$help:["open file system dialog to fetch local file","optionally you can determine trajectory file","via URL for *.top model"]}},clear:{$help:"No args. Clear terminal"},add:{$help:["add [<REP_NAME>] [<DESCRIPTION>]","    Add new item to representation set with","    default or <DESCRIPTION> params"],REP_NAME:{$help:"Identifier string [_,a-z,A-Z,0-9] can not start from digit"},DESCRIPTION:id},rep:{$help:["rep [<REP_NAME>|<REP_INDEX>] [<DESCRIPTION>]","    set current representation by name or index","    edit current representation by <DESCRIPTION>"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"},DESCRIPTION:id},remove:{$help:["remove (<REP_NAME>|<REP_INDEX>)","Remove representation by name or index"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"}},selector:{$help:["selector <EXPRESSION>","   set selector from EXPRESSION to current representation"],EXPRESSION:{$help:"Selection expression string as it is in menu->representations->selection"}},mode:{$help:["mode <MODE_ID> [<PARAMETER>=<VALUE>...]","   set rendering mode and apply parameters to current representation"],MODE_ID:td},color:{$help:["color <COLORER_ID> [<PARAMETER>=<VALUE>...]","   set colorer and apply parameters to current representation"],COLORER_ID:nd},material:{$help:["material <MATERIAL_ID>","   set material to current representation"],MATERIAL_ID:rd},build:{$help:"build help str",add:{$help:"build.add",new:{$help:["add.new","add.new new line 1","add.new new line 2","add.new new line 3"]}},del:{$help:"build.del"}},list:{$help:["list [-e|-s|<REP_NAME>|<REP_INDEX>]","Print representations if no args print list of representations","    -e expand list and show all representations","    -s show all user-registered selectors","    <REP_NAME>|<REP_INDEX> show only current representation"]},hide:{$help:["hide (<REP_NAME>|<REP_INDEX>)","Hide representation referenced in args"]},show:{$help:["show (<REP_NAME>|<REP_INDEX>)","Show representation referenced in args"]},get:{$help:["get <PARAMETER>","Print <PARAMETER> value","    <PARAMETER> - path to option use get.PARAMETER to get more info"],PARAMETER:od},set:{$help:["set <PARAMETER> <VALUE>","Set <PARAMETER> with <VALUE>","    <PARAMETER> - path to option use set.PARAMETER to get more info"],PARAMETER:od},set_save:{$help:["set_save","Save current settings to cookie"]},set_restore:{$help:["set_restore","Load and apply settings from cookie"]},set_reset:{$help:["set_reset","Reset current settings to the defaults"]},preset:{$help:["preset [<PRESET>]","Reset current representation or set preset to <PRESET>"],PRESET:{$help:["default","wire","small","macro"]}},unit:{$help:["unit [<unit_id>]","Change current biological structure view. Zero <unit_id> value means asymmetric unit,","positive values set an assembly with corresponding number.","Being called with no parameters command prints current unit information."]},view:{$help:["view [<ENCODED_VIEW>]","Get current encoded view or set if ENCODED_VIEW placed as argument"],ENCODED_VIEW:{$help:["encoded view matrix string (binary code)"]}},rotate:{$help:["rotate (x|y|z) [<DEGREES>] [(x|y|z) [<DEGREES>]]...","Rotate scene"]},scale:{$help:["scale <SCALE>","Scale scene"]},select:{$help:["select <SELECTOR_STRING> [as <SELECTOR_NAME>]","Select atoms using selector defined in SELECTOR_STRING","    and if SELECTOR_NAME is defined register it in viewer","    you can use it later as a complex selector"]},within:{$help:["within <DISTANCE> of <SELECTOR_STRING> as <SELECTOR_NAME>","Build within named selector","    DISTANCE        <number>","    SELECTOR_STRING <string(selection language)>","    SELECTOR_NAME   <identifier>"]},url:{$help:["url [-s] [-v]","Report URL encoded scene","    if -s set that include settings in the URL","    if -v set that include view in the URL"]},screenshot:{$help:["screenshot [<WIDTH> [<HEIGHT>]]","Make a screenshot of the scene","    WIDTH  <number> in pixels","    HEIGHT <number> in pixels, equal to WIDTH by default"]},line:{$help:["line <first_atom_path> <second_atom_path> [<PARAMETER>=<VALUE>]","Draw dashed line between two specified atoms"]},removeobj:{$help:["removeobj <id>","Remove scene object by its index. Indices could be obtained by <listobj> command"]},listobj:{$help:["listobj","Display the list of all existing scene objects"]}},sd=Wf.chem.selectors,ld=Wf.modes,cd=Wf.colorers,ud=Wf.materials,hd=Wf.palettes,fd=Wf.options,dd=Wf.settings;function pd(){}var md,vd=(md=new pd,function(){return md}),gd=new(function(){function e(){g(this,e),this.representationMap={},this.representationID={}}return _(e,[{key:"get",value:function(e){return this.representationMap[e]||this.representationID[e]||"<no name>"}},{key:"add",value:function(e,t){if(-1===e)return"Can not create representation: there is no data";if(void 0!==t){if(this.representationMap.hasOwnProperty(e))return"This name has already existed, registered without name";this.representationMap[e.toString()]=t,this.representationID[t]=e.toString()}return"Representation ".concat(e," successfully added")}},{key:"remove",value:function(e){e&&this.representationID.hasOwnProperty(e)&&(delete this.representationMap[this.representationID[e]],delete this.representationID[e]);var t=Object.keys(this.representationID).sort();for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r>e&&(this.representationID[r-1]=this.representationID[r],this.representationMap[this.representationID[r]]-=1,delete this.representationID[r])}}},{key:"clear",value:function(){this.representationMap={},this.representationID={}}}]),e}());function yd(e){var t={s:"selector",m:"mode",c:"colorer",mt:"material",mode:"modes",color:"colorers",colorer:"colorers",select:"selector",material:"materials",selector:"selector"}[e];return void 0===t?e:t}var _d=new(function(){function e(){g(this,e)}return _(e,[{key:"list",value:function(e,t,n){var r="";if(e&&void 0!==t&&(void 0===n||"-e"===n))for(var i=e.repCount(),o=0;o<i;o++)r+=this.listRep(e,t,o,n);return r}},{key:"listRep",value:function(e,t,n,r){var i="",o=e.repGet(n);if(!o)return F.warn("Rep ".concat(n," does not exist!")),i;var a=n,s=t.get(a),l=o.mode,c=o.colorer,u=o.selectorString,h=o.materialPreset;return i+="#".concat(a," : ").concat(l.name).concat("<no name>"===s?"":", ".concat(s),"\n"),void 0!==r&&(i+='    selection : "'.concat(u,'"\n'),i+="    mode      : (".concat(l.id,"), ").concat(l.name,"\n"),i+="    colorer   : (".concat(c.id,"), ").concat(c.name,"\n"),i+="    material  : (".concat(h.id,"), ").concat(h.name,"\n")),i}},{key:"listSelector",value:function(e,t){var n="";for(var r in t)t.hasOwnProperty(r)&&(n+="".concat(r,' : "').concat(t[r],'"\n'));return n}},{key:"listObjs",value:function(e){var t=e._objects;if(!t||!Array.isArray(t)||0===t.length)return"There are no objects on the scene";for(var n=[],r=0,i=t.length;r<i;++r)n[r]="".concat(r,": ").concat(t[r].toString());return n.join("\n")}},{key:"joinHelpStr",value:function(e){return e instanceof Array?e.join("\n"):e}},{key:"help",value:function(e){if(o.default.isUndefined(e))return"".concat(this.joinHelpStr(ad.$help),"\n").concat(o.default.slice(o.default.sortBy(o.default.keys(ad)),1).join(", "),"\n");var t=o.default.get(ad,e);return o.default.isUndefined(t)?this.help():"".concat(this.joinHelpStr(t.$help),"\n")}},{key:"load",value:function(e,t){if(void 0!==e&&void 0!==t&&"-f"!==t){e.awaitWhileCMDisInProcess();var n=function(){return e.finishAwaitingCMDInProcess()};e.load(t).then(n,n)}}},{key:"checkArg",value:function(e,t,n){if(void 0!==e&&void 0!==t){if("selector"===yd(e)){var r=sd.parse(t);if(void 0!==r.error)throw{message:r.error};return void 0!==n&&n?r.selector:t}for(var i,o={colorers:cd,modes:ld,materials:ud},a=e;a!==i;)a=yd(i=a);if(void 0===o[a].get(t))throw{message:"".concat(t," is not existed in ").concat(a)};return t}return vd}},{key:"propagateProp",value:function(e,t){if(void 0!==e){var n=fd.adapters[A(o.default.get(dd.defaults,e))];if(void 0===n)throw{message:"".concat(e," is not existed")};if((e.endsWith(".color")||e.endsWith(".baseColor")||e.endsWith(".EL.carbon"))&&"number"!=typeof t&&(t=hd.get(dd.now.palette).getNamedColor(t)),e.endsWith(".fg")||e.endsWith(".bg"))if("number"!=typeof t){var r=hd.get(dd.now.palette).getNamedColor(t,!0);void 0!==r&&(t="0x".concat(r.toString(16)))}else t="0x".concat(t.toString(16));if(e.endsWith(".template")&&(t=t.replace(/\\n/g,"\n")),void 0!==t&&n(t)!==t&&n(t)!==t>0)throw{message:"".concat(e,' must be a "').concat(A(o.default.get(dd.defaults,e)),'"')}}return t}},{key:"unquoteString",value:function(e){return Q.unquoteString(e)}}]),e}());function xd(e){if(e instanceof this.constructor)return e;this._values=e instanceof Array?e.slice(0):e?[e]:[]}xd.prototype.append=function(e){var t=this._values;return t[t.length]=e,this},xd.prototype.remove=function(e){var t=this._values,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},xd.prototype.toJSO=function(e,t,n){for(var r={},i=this._values,a=0,s=i.length;a<s;++a)o.default.set(r,i[a].id,e.propagateProp("".concat(yd(t),".").concat(n,".").concat(i[a].id),i[a].val));return r};var bd=Object.create({});return bd.Arg=function(e,t){this.id=e,this.val=t},bd.ArgList=xd,bd.miew=null,bd.echo=null,bd.representations=gd,bd.utils=_d,bd._=o.default,bd.CreateObjectPair=function(e,t){var n={};return n[e]=t,n},bd.keyRemap=yd,bd.Context=sd.Context,bd.ClearContext=sd.ClearContext,bd.NULL=vd,bd.notimplemented=function(){return this.NULL},Wf.prototype.script=function(e,t,n){ed.parser.yy.miew=this,ed.parser.yy.echo=t,ed.parser.yy.error=n,void 0===this.cmdQueue&&(this.cmdQueue=[]),void 0===this.commandInAction&&(this.commandInAction=!1),this.cmdQueue=this.cmdQueue.concat(e.split("\n"))},Wf.prototype.awaitWhileCMDisInProcess=function(){this.commandInAction=!0},Wf.prototype.finishAwaitingCMDInProcess=function(){this.commandInAction=!1},Wf.prototype.isScriptingCommandAvailable=function(){return void 0!==this.commandInAction&&!this.commandInAction&&void 0!==this.cmdQueue&&this.cmdQueue.length>0},Wf.prototype.callNextCmd=function(){if(this.isScriptingCommandAvailable()){var e=this.cmdQueue.shift(),t={success:!1};try{ed.parser.parse(e),t.success=!0}catch(e){t.error=e.message,ed.parser.yy.error(t.error),this.finishAwaitingCMDInProcess()}return t}return""},ed.parser.yy=bd,ed.parser.yy.parseError=ed.parser.parseError,Wf},e.exports=r(n(19),n(21))}).call(this,n(10))},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){"use strict";
/** @license React v16.14.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(9),i="function"==typeof Symbol&&Symbol.for,o=i?Symbol.for("react.element"):60103,a=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,l=i?Symbol.for("react.strict_mode"):60108,c=i?Symbol.for("react.profiler"):60114,u=i?Symbol.for("react.provider"):60109,h=i?Symbol.for("react.context"):60110,f=i?Symbol.for("react.forward_ref"):60112,d=i?Symbol.for("react.suspense"):60113,p=i?Symbol.for("react.memo"):60115,m=i?Symbol.for("react.lazy"):60116,v="function"==typeof Symbol&&Symbol.iterator;function g(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function x(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||y}function b(){}function w(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||y}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(g(85));this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=x.prototype;var S=w.prototype=new b;S.constructor=w,r(S,x.prototype),S.isPureReactComponent=!0;var M={current:null},E=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,n){var r,i={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)E.call(t,r)&&!T.hasOwnProperty(r)&&(i[r]=t[r]);var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===i[r]&&(i[r]=l[r]);return{$$typeof:o,type:e,key:a,ref:s,props:i,_owner:M.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var R=/\/+/g,P=[];function L(e,t,n,r){if(P.length){var i=P.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function k(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>P.length&&P.push(e)}function I(e,t,n){return null==e?0:function e(t,n,r,i){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var l=!1;if(null===t)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case o:case a:l=!0}}if(l)return r(i,t,""===n?"."+N(t,0):n),1;if(l=0,n=""===n?".":n+":",Array.isArray(t))for(var c=0;c<t.length;c++){var u=n+N(s=t[c],c);l+=e(s,u,r,i)}else if(null===t||"object"!=typeof t?u=null:u="function"==typeof(u=v&&t[v]||t["@@iterator"])?u:null,"function"==typeof u)for(t=u.call(t),c=0;!(s=t.next()).done;)l+=e(s=s.value,u=n+N(s,c++),r,i);else if("object"===s)throw r=""+t,Error(g(31,"[object Object]"===r?"object with keys {"+Object.keys(t).join(", ")+"}":r,""));return l}(e,"",t,n)}function N(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function O(e,t){e.func.call(e.context,t,e.count++)}function D(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?B(e,r,n,(function(e){return e})):null!=e&&(C(e)&&(e=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(R,"$&/")+"/")+n)),r.push(e))}function B(e,t,n,r,i){var o="";null!=n&&(o=(""+n).replace(R,"$&/")+"/"),I(e,D,t=L(t,o,r,i)),k(t)}var z={current:null};function F(){var e=z.current;if(null===e)throw Error(g(321));return e}var V={ReactCurrentDispatcher:z,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return B(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;I(e,O,t=L(null,null,t,n)),k(t)},count:function(e){return I(e,(function(){return null}),null)},toArray:function(e){var t=[];return B(e,t,null,(function(e){return e})),t},only:function(e){if(!C(e))throw Error(g(143));return e}},t.Component=x,t.Fragment=s,t.Profiler=c,t.PureComponent=w,t.StrictMode=l,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,t.cloneElement=function(e,t,n){if(null==e)throw Error(g(267,e));var i=r({},e.props),a=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=M.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)E.call(t,u)&&!T.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){c=Array(u);for(var h=0;h<u;h++)c[h]=arguments[h+2];i.children=c}return{$$typeof:o,type:e.type,key:a,ref:s,props:i,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:h,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:u,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:f,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return F().useCallback(e,t)},t.useContext=function(e,t){return F().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return F().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return F().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return F().useLayoutEffect(e,t)},t.useMemo=function(e,t){return F().useMemo(e,t)},t.useReducer=function(e,t,n){return F().useReducer(e,t,n)},t.useRef=function(e){return F().useRef(e)},t.useState=function(e){return F().useState(e)},t.version="16.14.0"},function(e,t,n){"use strict";
/** @license React v16.14.0
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2),i=n(9),o=n(17);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(a(227));function s(e,t,n,r,i,o,a,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var l=!1,c=null,u=!1,h=null,f={onError:function(e){l=!0,c=e}};function d(e,t,n,r,i,o,a,u,h){l=!1,c=null,s.apply(f,arguments)}var p=null,m=null,v=null;function g(e,t,n){var r=e.type||"unknown-event";e.currentTarget=v(n),function(e,t,n,r,i,o,s,f,p){if(d.apply(this,arguments),l){if(!l)throw Error(a(198));var m=c;l=!1,c=null,u||(u=!0,h=m)}}(r,t,void 0,e),e.currentTarget=null}var y=null,_={};function x(){if(y)for(var e in _){var t=_[e],n=y.indexOf(e);if(!(-1<n))throw Error(a(96,e));if(!w[n]){if(!t.extractEvents)throw Error(a(97,e));for(var r in w[n]=t,n=t.eventTypes){var i=void 0,o=n[r],s=t,l=r;if(S.hasOwnProperty(l))throw Error(a(99,l));S[l]=o;var c=o.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&b(c[i],s,l);i=!0}else o.registrationName?(b(o.registrationName,s,l),i=!0):i=!1;if(!i)throw Error(a(98,r,e))}}}}function b(e,t,n){if(M[e])throw Error(a(100,e));M[e]=t,E[e]=t.eventTypes[n].dependencies}var w=[],S={},M={},E={};function T(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!_.hasOwnProperty(t)||_[t]!==r){if(_[t])throw Error(a(102,t));_[t]=r,n=!0}}n&&x()}var A=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),C=null,R=null,P=null;function L(e){if(e=m(e)){if("function"!=typeof C)throw Error(a(280));var t=e.stateNode;t&&(t=p(t),C(e.stateNode,e.type,t))}}function k(e){R?P?P.push(e):P=[e]:R=e}function I(){if(R){var e=R,t=P;if(P=R=null,L(e),t)for(e=0;e<t.length;e++)L(t[e])}}function N(e,t){return e(t)}function O(e,t,n,r,i){return e(t,n,r,i)}function D(){}var B=N,z=!1,F=!1;function V(){null===R&&null===P||(D(),I())}function U(e,t,n){if(F)return e(t,n);F=!0;try{return B(e,t,n)}finally{F=!1,V()}}var G=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,H=Object.prototype.hasOwnProperty,j={},W={};function q(e,t,n,r,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o}var X={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){X[e]=new q(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];X[t]=new q(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){X[e]=new q(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){X[e]=new q(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){X[e]=new q(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){X[e]=new q(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){X[e]=new q(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){X[e]=new q(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){X[e]=new q(e,5,!1,e.toLowerCase(),null,!1)}));var Y=/[\-:]([a-z])/g;function Z(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(Y,Z);X[t]=new q(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(Y,Z);X[t]=new q(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(Y,Z);X[t]=new q(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){X[e]=new q(e,1,!1,e.toLowerCase(),null,!1)})),X.xlinkHref=new q("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){X[e]=new q(e,1,!1,e.toLowerCase(),null,!0)}));var $=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function J(e,t,n,r){var i=X.hasOwnProperty(t)?X[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!H.call(W,e)||!H.call(j,e)&&(G.test(e)?W[e]=!0:(j[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}$.hasOwnProperty("ReactCurrentDispatcher")||($.ReactCurrentDispatcher={current:null}),$.hasOwnProperty("ReactCurrentBatchConfig")||($.ReactCurrentBatchConfig={suspense:null});var K=/^(.*)[\\\/]/,Q="function"==typeof Symbol&&Symbol.for,ee=Q?Symbol.for("react.element"):60103,te=Q?Symbol.for("react.portal"):60106,ne=Q?Symbol.for("react.fragment"):60107,re=Q?Symbol.for("react.strict_mode"):60108,ie=Q?Symbol.for("react.profiler"):60114,oe=Q?Symbol.for("react.provider"):60109,ae=Q?Symbol.for("react.context"):60110,se=Q?Symbol.for("react.concurrent_mode"):60111,le=Q?Symbol.for("react.forward_ref"):60112,ce=Q?Symbol.for("react.suspense"):60113,ue=Q?Symbol.for("react.suspense_list"):60120,he=Q?Symbol.for("react.memo"):60115,fe=Q?Symbol.for("react.lazy"):60116,de=Q?Symbol.for("react.block"):60121,pe="function"==typeof Symbol&&Symbol.iterator;function me(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=pe&&e[pe]||e["@@iterator"])?e:null}function ve(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case ie:return"Profiler";case re:return"StrictMode";case ce:return"Suspense";case ue:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case ae:return"Context.Consumer";case oe:return"Context.Provider";case le:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case he:return ve(e.type);case de:return ve(e.render);case fe:if(e=1===e._status?e._result:null)return ve(e)}return null}function ge(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,i=e._debugSource,o=ve(e.type);n=null,r&&(n=ve(r.type)),r=o,o="",i?o=" (at "+i.fileName.replace(K,"")+":"+i.lineNumber+")":n&&(o=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+o}t+=n,e=e.return}while(e);return t}function ye(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function _e(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function xe(e){e._valueTracker||(e._valueTracker=function(e){var t=_e(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function be(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=_e(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function we(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Se(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=ye(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Me(e,t){null!=(t=t.checked)&&J(e,"checked",t,!1)}function Ee(e,t){Me(e,t);var n=ye(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Ae(e,t.type,n):t.hasOwnProperty("defaultValue")&&Ae(e,t.type,ye(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Te(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Ae(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Ce(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function Re(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ye(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Pe(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:ye(n)}}function ke(e,t){var n=ye(t.value),r=ye(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function Ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Ne="http://www.w3.org/1999/xhtml",Oe="http://www.w3.org/2000/svg";function De(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Be(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?De(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ze,Fe=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction((function(){return e(t,n)}))}:e}((function(e,t){if(e.namespaceURI!==Oe||"innerHTML"in e)e.innerHTML=t;else{for((ze=ze||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ze.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function Ve(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Ue(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ge={animationend:Ue("Animation","AnimationEnd"),animationiteration:Ue("Animation","AnimationIteration"),animationstart:Ue("Animation","AnimationStart"),transitionend:Ue("Transition","TransitionEnd")},He={},je={};function We(e){if(He[e])return He[e];if(!Ge[e])return e;var t,n=Ge[e];for(t in n)if(n.hasOwnProperty(t)&&t in je)return He[e]=n[t];return e}A&&(je=document.createElement("div").style,"AnimationEvent"in window||(delete Ge.animationend.animation,delete Ge.animationiteration.animation,delete Ge.animationstart.animation),"TransitionEvent"in window||delete Ge.transitionend.transition);var qe=We("animationend"),Xe=We("animationiteration"),Ye=We("animationstart"),Ze=We("transitionend"),$e="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Je=new("function"==typeof WeakMap?WeakMap:Map);function Ke(e){var t=Je.get(e);return void 0===t&&(t=new Map,Je.set(e,t)),t}function Qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function et(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function tt(e){if(Qe(e)!==e)throw Error(a(188))}function nt(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Qe(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return tt(i),e;if(o===r)return tt(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function rt(e,t){if(null==t)throw Error(a(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function it(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var ot=null;function at(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)g(e,t[r],n[r]);else t&&g(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function st(e){if(null!==e&&(ot=rt(ot,e)),e=ot,ot=null,e){if(it(e,at),ot)throw Error(a(95));if(u)throw e=h,u=!1,h=null,e}}function lt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function ct(e){if(!A)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var ut=[];function ht(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>ut.length&&ut.push(e)}function ft(e,t,n,r){if(ut.length){var i=ut.pop();return i.topLevelType=e,i.eventSystemFlags=r,i.nativeEvent=t,i.targetInst=n,i}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function dt(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=An(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=lt(e.nativeEvent);r=e.topLevelType;var o=e.nativeEvent,a=e.eventSystemFlags;0===n&&(a|=64);for(var s=null,l=0;l<w.length;l++){var c=w[l];c&&(c=c.extractEvents(r,t,o,i,a))&&(s=rt(s,c))}st(s)}}function pt(e,t,n){if(!n.has(e)){switch(e){case"scroll":Yt(t,"scroll",!0);break;case"focus":case"blur":Yt(t,"focus",!0),Yt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":ct(e)&&Yt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===$e.indexOf(e)&&Xt(e,t)}n.set(e,null)}}var mt,vt,gt,yt=!1,_t=[],xt=null,bt=null,wt=null,St=new Map,Mt=new Map,Et=[],Tt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),At="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Ct(e,t,n,r,i){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:i,container:r}}function Rt(e,t){switch(e){case"focus":case"blur":xt=null;break;case"dragenter":case"dragleave":bt=null;break;case"mouseover":case"mouseout":wt=null;break;case"pointerover":case"pointerout":St.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mt.delete(t.pointerId)}}function Pt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e=Ct(t,n,r,i,o),null!==t&&(null!==(t=Cn(t))&&vt(t)),e):(e.eventSystemFlags|=r,e)}function Lt(e){var t=An(e.target);if(null!==t){var n=Qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=et(n)))return e.blockedOn=t,void o.unstable_runWithPriority(e.priority,(function(){gt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function kt(e){if(null!==e.blockedOn)return!1;var t=Kt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Cn(t);return null!==n&&vt(n),e.blockedOn=t,!1}return!0}function It(e,t,n){kt(e)&&n.delete(t)}function Nt(){for(yt=!1;0<_t.length;){var e=_t[0];if(null!==e.blockedOn){null!==(e=Cn(e.blockedOn))&&mt(e);break}var t=Kt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:_t.shift()}null!==xt&&kt(xt)&&(xt=null),null!==bt&&kt(bt)&&(bt=null),null!==wt&&kt(wt)&&(wt=null),St.forEach(It),Mt.forEach(It)}function Ot(e,t){e.blockedOn===t&&(e.blockedOn=null,yt||(yt=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Nt)))}function Dt(e){function t(t){return Ot(t,e)}if(0<_t.length){Ot(_t[0],e);for(var n=1;n<_t.length;n++){var r=_t[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==xt&&Ot(xt,e),null!==bt&&Ot(bt,e),null!==wt&&Ot(wt,e),St.forEach(t),Mt.forEach(t),n=0;n<Et.length;n++)(r=Et[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Et.length&&null===(n=Et[0]).blockedOn;)Lt(n),null===n.blockedOn&&Et.shift()}var Bt={},zt=new Map,Ft=new Map,Vt=["abort","abort",qe,"animationEnd",Xe,"animationIteration",Ye,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ze,"transitionEnd","waiting","waiting"];function Ut(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1],o="on"+(i[0].toUpperCase()+i.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[r],eventPriority:t},Ft.set(r,t),zt.set(r,o),Bt[i]=o}}Ut("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ut("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ut(Vt,2);for(var Gt="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Ht=0;Ht<Gt.length;Ht++)Ft.set(Gt[Ht],0);var jt=o.unstable_UserBlockingPriority,Wt=o.unstable_runWithPriority,qt=!0;function Xt(e,t){Yt(t,e,!1)}function Yt(e,t,n){var r=Ft.get(t);switch(void 0===r?2:r){case 0:r=Zt.bind(null,t,1,e);break;case 1:r=$t.bind(null,t,1,e);break;default:r=Jt.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Zt(e,t,n,r){z||D();var i=Jt,o=z;z=!0;try{O(i,e,t,n,r)}finally{(z=o)||V()}}function $t(e,t,n,r){Wt(jt,Jt.bind(null,e,t,n,r))}function Jt(e,t,n,r){if(qt)if(0<_t.length&&-1<Tt.indexOf(e))e=Ct(null,e,t,n,r),_t.push(e);else{var i=Kt(e,t,n,r);if(null===i)Rt(e,r);else if(-1<Tt.indexOf(e))e=Ct(i,e,t,n,r),_t.push(e);else if(!function(e,t,n,r,i){switch(t){case"focus":return xt=Pt(xt,e,t,n,r,i),!0;case"dragenter":return bt=Pt(bt,e,t,n,r,i),!0;case"mouseover":return wt=Pt(wt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return St.set(o,Pt(St.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Mt.set(o,Pt(Mt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r)){Rt(e,r),e=ft(e,r,null,t);try{U(dt,e)}finally{ht(e)}}}}function Kt(e,t,n,r){if(null!==(n=An(n=lt(r)))){var i=Qe(n);if(null===i)n=null;else{var o=i.tag;if(13===o){if(null!==(n=et(i)))return n;n=null}else if(3===o){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}e=ft(e,r,n,t);try{U(dt,e)}finally{ht(e)}return null}var Qt={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},en=["Webkit","ms","Moz","O"];function tn(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||Qt.hasOwnProperty(e)&&Qt[e]?(""+t).trim():t+"px"}function nn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=tn(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(Qt).forEach((function(e){en.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Qt[t]=Qt[e]}))}));var rn=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function on(e,t){if(t){if(rn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(a(62,""))}}function an(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sn=Ne;function ln(e,t){var n=Ke(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=E[t];for(var r=0;r<t.length;r++)pt(t[r],e,n)}function cn(){}function un(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function hn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function fn(e,t){var n,r=hn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=hn(r)}}function dn(){for(var e=window,t=un();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=un((e=t.contentWindow).document)}return t}function pn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mn=null,vn=null;function gn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function yn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var _n="function"==typeof setTimeout?setTimeout:void 0,xn="function"==typeof clearTimeout?clearTimeout:void 0;function bn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function wn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Sn=Math.random().toString(36).slice(2),Mn="__reactInternalInstance$"+Sn,En="__reactEventHandlers$"+Sn,Tn="__reactContainere$"+Sn;function An(e){var t=e[Mn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Tn]||n[Mn]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=wn(e);null!==e;){if(n=e[Mn])return n;e=wn(e)}return t}n=(e=n).parentNode}return null}function Cn(e){return!(e=e[Mn]||e[Tn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Rn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function Pn(e){return e[En]||null}function Ln(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function kn(e,t){var n=e.stateNode;if(!n)return null;var r=p(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}function In(e,t,n){(t=kn(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function Nn(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Ln(t);for(t=n.length;0<t--;)In(n[t],"captured",e);for(t=0;t<n.length;t++)In(n[t],"bubbled",e)}}function On(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=kn(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function Dn(e){e&&e.dispatchConfig.registrationName&&On(e._targetInst,null,e)}function Bn(e){it(e,Nn)}var zn=null,Fn=null,Vn=null;function Un(){if(Vn)return Vn;var e,t,n=Fn,r=n.length,i="value"in zn?zn.value:zn.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return Vn=i.slice(e,1<t?1-t:void 0)}function Gn(){return!0}function Hn(){return!1}function jn(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):"target"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Gn:Hn,this.isPropagationStopped=Hn,this}function Wn(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function qn(e){if(!(e instanceof this))throw Error(a(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function Xn(e){e.eventPool=[],e.getPooled=Wn,e.release=qn}i(jn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Gn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Gn)},persist:function(){this.isPersistent=Gn},isPersistent:Hn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Hn,this._dispatchInstances=this._dispatchListeners=null}}),jn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},jn.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var o=new t;return i(o,n.prototype),n.prototype=o,n.prototype.constructor=n,n.Interface=i({},r.Interface,e),n.extend=r.extend,Xn(n),n},Xn(jn);var Yn=jn.extend({data:null}),Zn=jn.extend({data:null}),$n=[9,13,27,32],Jn=A&&"CompositionEvent"in window,Kn=null;A&&"documentMode"in document&&(Kn=document.documentMode);var Qn=A&&"TextEvent"in window&&!Kn,er=A&&(!Jn||Kn&&8<Kn&&11>=Kn),tr=String.fromCharCode(32),nr={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},rr=!1;function ir(e,t){switch(e){case"keyup":return-1!==$n.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function or(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var ar=!1;var sr={eventTypes:nr,extractEvents:function(e,t,n,r){var i;if(Jn)e:{switch(e){case"compositionstart":var o=nr.compositionStart;break e;case"compositionend":o=nr.compositionEnd;break e;case"compositionupdate":o=nr.compositionUpdate;break e}o=void 0}else ar?ir(e,n)&&(o=nr.compositionEnd):"keydown"===e&&229===n.keyCode&&(o=nr.compositionStart);return o?(er&&"ko"!==n.locale&&(ar||o!==nr.compositionStart?o===nr.compositionEnd&&ar&&(i=Un()):(Fn="value"in(zn=r)?zn.value:zn.textContent,ar=!0)),o=Yn.getPooled(o,t,n,r),i?o.data=i:null!==(i=or(n))&&(o.data=i),Bn(o),i=o):i=null,(e=Qn?function(e,t){switch(e){case"compositionend":return or(t);case"keypress":return 32!==t.which?null:(rr=!0,tr);case"textInput":return(e=t.data)===tr&&rr?null:e;default:return null}}(e,n):function(e,t){if(ar)return"compositionend"===e||!Jn&&ir(e,t)?(e=Un(),Vn=Fn=zn=null,ar=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return er&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=Zn.getPooled(nr.beforeInput,t,n,r)).data=e,Bn(t)):t=null,null===i?t:null===t?i:[i,t]}},lr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!lr[e.type]:"textarea"===t}var ur={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function hr(e,t,n){return(e=jn.getPooled(ur.change,e,t,n)).type="change",k(n),Bn(e),e}var fr=null,dr=null;function pr(e){st(e)}function mr(e){if(be(Rn(e)))return e}function vr(e,t){if("change"===e)return t}var gr=!1;function yr(){fr&&(fr.detachEvent("onpropertychange",_r),dr=fr=null)}function _r(e){if("value"===e.propertyName&&mr(dr))if(e=hr(dr,e,lt(e)),z)st(e);else{z=!0;try{N(pr,e)}finally{z=!1,V()}}}function xr(e,t,n){"focus"===e?(yr(),dr=n,(fr=t).attachEvent("onpropertychange",_r)):"blur"===e&&yr()}function br(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return mr(dr)}function wr(e,t){if("click"===e)return mr(t)}function Sr(e,t){if("input"===e||"change"===e)return mr(t)}A&&(gr=ct("input")&&(!document.documentMode||9<document.documentMode));var Mr={eventTypes:ur,_isInputEventSupported:gr,extractEvents:function(e,t,n,r){var i=t?Rn(t):window,o=i.nodeName&&i.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===i.type)var a=vr;else if(cr(i))if(gr)a=Sr;else{a=br;var s=xr}else(o=i.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(a=wr);if(a&&(a=a(e,t)))return hr(a,n,r);s&&s(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&Ae(i,"number",i.value)}},Er=jn.extend({view:null,detail:null}),Tr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ar(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tr[e])&&!!t[e]}function Cr(){return Ar}var Rr=0,Pr=0,Lr=!1,kr=!1,Ir=Er.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Cr,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Rr;return Rr=e.screenX,Lr?"mousemove"===e.type?e.screenX-t:0:(Lr=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Pr;return Pr=e.screenY,kr?"mousemove"===e.type?e.screenY-t:0:(kr=!0,0)}}),Nr=Ir.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Or={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Dr={eventTypes:Or,extractEvents:function(e,t,n,r,i){var o="mouseover"===e||"pointerover"===e,a="mouseout"===e||"pointerout"===e;if(o&&0==(32&i)&&(n.relatedTarget||n.fromElement)||!a&&!o)return null;(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,a)?(a=t,null!==(t=(t=n.relatedTarget||n.toElement)?An(t):null)&&(t!==Qe(t)||5!==t.tag&&6!==t.tag)&&(t=null)):a=null;if(a===t)return null;if("mouseout"===e||"mouseover"===e)var s=Ir,l=Or.mouseLeave,c=Or.mouseEnter,u="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=Nr,l=Or.pointerLeave,c=Or.pointerEnter,u="pointer");if(e=null==a?o:Rn(a),o=null==t?o:Rn(t),(l=s.getPooled(l,a,n,r)).type=u+"leave",l.target=e,l.relatedTarget=o,(n=s.getPooled(c,t,n,r)).type=u+"enter",n.target=o,n.relatedTarget=e,u=t,(r=a)&&u)e:{for(c=u,a=0,e=s=r;e;e=Ln(e))a++;for(e=0,t=c;t;t=Ln(t))e++;for(;0<a-e;)s=Ln(s),a--;for(;0<e-a;)c=Ln(c),e--;for(;a--;){if(s===c||s===c.alternate)break e;s=Ln(s),c=Ln(c)}s=null}else s=null;for(c=s,s=[];r&&r!==c&&(null===(a=r.alternate)||a!==c);)s.push(r),r=Ln(r);for(r=[];u&&u!==c&&(null===(a=u.alternate)||a!==c);)r.push(u),u=Ln(u);for(u=0;u<s.length;u++)On(s[u],"bubbled",l);for(u=r.length;0<u--;)On(r[u],"captured",n);return 0==(64&i)?[l]:[l,n]}};var Br="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},zr=Object.prototype.hasOwnProperty;function Fr(e,t){if(Br(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!zr.call(t,n[r])||!Br(e[n[r]],t[n[r]]))return!1;return!0}var Vr=A&&"documentMode"in document&&11>=document.documentMode,Ur={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Gr=null,Hr=null,jr=null,Wr=!1;function qr(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Wr||null==Gr||Gr!==un(n)?null:("selectionStart"in(n=Gr)&&pn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},jr&&Fr(jr,n)?null:(jr=n,(e=jn.getPooled(Ur.select,Hr,e,t)).type="select",e.target=Gr,Bn(e),e))}var Xr={eventTypes:Ur,extractEvents:function(e,t,n,r,i,o){if(!(o=!(i=o||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){e:{i=Ke(i),o=E.onSelect;for(var a=0;a<o.length;a++)if(!i.has(o[a])){i=!1;break e}i=!0}o=!i}if(o)return null;switch(i=t?Rn(t):window,e){case"focus":(cr(i)||"true"===i.contentEditable)&&(Gr=i,Hr=t,jr=null);break;case"blur":jr=Hr=Gr=null;break;case"mousedown":Wr=!0;break;case"contextmenu":case"mouseup":case"dragend":return Wr=!1,qr(n,r);case"selectionchange":if(Vr)break;case"keydown":case"keyup":return qr(n,r)}return null}},Yr=jn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Zr=jn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),$r=Er.extend({relatedTarget:null});function Jr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var Kr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ei=Er.extend({key:function(e){if(e.key){var t=Kr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Jr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Qr[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Cr,charCode:function(e){return"keypress"===e.type?Jr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Jr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ti=Ir.extend({dataTransfer:null}),ni=Er.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Cr}),ri=jn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),ii=Ir.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),oi={eventTypes:Bt,extractEvents:function(e,t,n,r){var i=zt.get(e);if(!i)return null;switch(e){case"keypress":if(0===Jr(n))return null;case"keydown":case"keyup":e=ei;break;case"blur":case"focus":e=$r;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Ir;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=ti;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=ni;break;case qe:case Xe:case Ye:e=Yr;break;case Ze:e=ri;break;case"scroll":e=Er;break;case"wheel":e=ii;break;case"copy":case"cut":case"paste":e=Zr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Nr;break;default:e=jn}return Bn(t=e.getPooled(i,t,n,r)),t}};if(y)throw Error(a(101));y=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),x(),p=Pn,m=Cn,v=Rn,T({SimpleEventPlugin:oi,EnterLeaveEventPlugin:Dr,ChangeEventPlugin:Mr,SelectEventPlugin:Xr,BeforeInputEventPlugin:sr});var ai=[],si=-1;function li(e){0>si||(e.current=ai[si],ai[si]=null,si--)}function ci(e,t){si++,ai[si]=e.current,e.current=t}var ui={},hi={current:ui},fi={current:!1},di=ui;function pi(e,t){var n=e.type.contextTypes;if(!n)return ui;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function mi(e){return null!=(e=e.childContextTypes)}function vi(){li(fi),li(hi)}function gi(e,t,n){if(hi.current!==ui)throw Error(a(168));ci(hi,t),ci(fi,n)}function yi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in e))throw Error(a(108,ve(t)||"Unknown",o));return i({},n,{},r)}function _i(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ui,di=hi.current,ci(hi,e),ci(fi,fi.current),!0}function xi(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=yi(e,t,di),r.__reactInternalMemoizedMergedChildContext=e,li(fi),li(hi),ci(hi,e)):li(fi),ci(fi,n)}var bi=o.unstable_runWithPriority,wi=o.unstable_scheduleCallback,Si=o.unstable_cancelCallback,Mi=o.unstable_requestPaint,Ei=o.unstable_now,Ti=o.unstable_getCurrentPriorityLevel,Ai=o.unstable_ImmediatePriority,Ci=o.unstable_UserBlockingPriority,Ri=o.unstable_NormalPriority,Pi=o.unstable_LowPriority,Li=o.unstable_IdlePriority,ki={},Ii=o.unstable_shouldYield,Ni=void 0!==Mi?Mi:function(){},Oi=null,Di=null,Bi=!1,zi=Ei(),Fi=1e4>zi?Ei:function(){return Ei()-zi};function Vi(){switch(Ti()){case Ai:return 99;case Ci:return 98;case Ri:return 97;case Pi:return 96;case Li:return 95;default:throw Error(a(332))}}function Ui(e){switch(e){case 99:return Ai;case 98:return Ci;case 97:return Ri;case 96:return Pi;case 95:return Li;default:throw Error(a(332))}}function Gi(e,t){return e=Ui(e),bi(e,t)}function Hi(e,t,n){return e=Ui(e),wi(e,t,n)}function ji(e){return null===Oi?(Oi=[e],Di=wi(Ai,qi)):Oi.push(e),ki}function Wi(){if(null!==Di){var e=Di;Di=null,Si(e)}qi()}function qi(){if(!Bi&&null!==Oi){Bi=!0;var e=0;try{var t=Oi;Gi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Oi=null}catch(t){throw null!==Oi&&(Oi=Oi.slice(e+1)),wi(Ai,Wi),t}finally{Bi=!1}}}function Xi(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function Yi(e,t){if(e&&e.defaultProps)for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var Zi={current:null},$i=null,Ji=null,Ki=null;function Qi(){Ki=Ji=$i=null}function eo(e){var t=Zi.current;li(Zi),e.type._context._currentValue=t}function to(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function no(e,t){$i=e,Ki=Ji=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Pa=!0),e.firstContext=null)}function ro(e,t){if(Ki!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Ki=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ji){if(null===$i)throw Error(a(308));Ji=t,$i.dependencies={expirationTime:0,firstContext:t,responders:null}}else Ji=Ji.next=t;return e._currentValue}var io=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function ao(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function so(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function lo(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function co(e,t){var n=e.alternate;null!==n&&ao(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function uo(e,t,n,r){var o=e.updateQueue;io=!1;var a=o.baseQueue,s=o.shared.pending;if(null!==s){if(null!==a){var l=a.next;a.next=s.next,s.next=l}a=s,o.shared.pending=null,null!==(l=e.alternate)&&(null!==(l=l.updateQueue)&&(l.baseQueue=s))}if(null!==a){l=a.next;var c=o.baseState,u=0,h=null,f=null,d=null;if(null!==l)for(var p=l;;){if((s=p.expirationTime)<r){var m={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===d?(f=d=m,h=c):d=d.next=m,s>u&&(u=s)}else{null!==d&&(d=d.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null}),ol(s,p.suspenseConfig);e:{var v=e,g=p;switch(s=t,m=n,g.tag){case 1:if("function"==typeof(v=g.payload)){c=v.call(m,c,s);break e}c=v;break e;case 3:v.effectTag=-4097&v.effectTag|64;case 0:if(null==(s="function"==typeof(v=g.payload)?v.call(m,c,s):v))break e;c=i({},c,s);break e;case 2:io=!0}}null!==p.callback&&(e.effectTag|=32,null===(s=o.effects)?o.effects=[p]:s.push(p))}if(null===(p=p.next)||p===l){if(null===(s=o.shared.pending))break;p=a.next=s.next,s.next=l,o.baseQueue=a=s,o.shared.pending=null}}null===d?h=c:d.next=f,o.baseState=h,o.baseQueue=d,al(u),e.expirationTime=u,e.memoizedState=c}}function ho(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=i,i=n,"function"!=typeof r)throw Error(a(191,r));r.call(i)}}}var fo=$.ReactCurrentBatchConfig,po=(new r.Component).refs;function mo(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:i({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var vo={isMounted:function(e){return!!(e=e._reactInternalFiber)&&Qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=qs(),i=fo.suspense;(i=so(r=Xs(r,e,i),i)).payload=t,null!=n&&(i.callback=n),lo(e,i),Ys(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=qs(),i=fo.suspense;(i=so(r=Xs(r,e,i),i)).tag=1,i.payload=t,null!=n&&(i.callback=n),lo(e,i),Ys(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=qs(),r=fo.suspense;(r=so(n=Xs(n,e,r),r)).tag=2,null!=t&&(r.callback=t),lo(e,r),Ys(e,n)}};function go(e,t,n,r,i,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!Fr(n,r)||!Fr(i,o))}function yo(e,t,n){var r=!1,i=ui,o=t.contextType;return"object"==typeof o&&null!==o?o=ro(o):(i=mi(t)?di:hi.current,o=(r=null!=(r=t.contextTypes))?pi(e,i):ui),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=vo,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function _o(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&vo.enqueueReplaceState(t,t.state,null)}function xo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=po,oo(e);var o=t.contextType;"object"==typeof o&&null!==o?i.context=ro(o):(o=mi(t)?di:hi.current,i.context=pi(e,o)),uo(e,n,i,r),i.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(mo(e,t,o,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&vo.enqueueReplaceState(i,i.state,null),uo(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.effectTag|=4)}var bo=Array.isArray;function wo(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===po&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function So(e,t){if("textarea"!==e.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Mo(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Tl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function s(t){return e&&null===t.alternate&&(t.effectTag=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Rl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=wo(e,t,n),r.return=e,r):((r=Al(n.type,n.key,n.props,null,e.mode,r)).ref=wo(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Pl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,o){return null===t||7!==t.tag?((t=Cl(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Rl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=Al(t.type,t.key,t.props,null,e.mode,n)).ref=wo(e,null,t),n.return=e,n;case te:return(t=Pl(t,e.mode,n)).return=e,t}if(bo(t)||me(t))return(t=Cl(t,e.mode,n,null)).return=e,t;So(e,t)}return null}function d(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===i?n.type===ne?h(e,t,n.props.children,r,i):c(e,t,n,r):null;case te:return n.key===i?u(e,t,n,r):null}if(bo(n)||me(n))return null!==i?null:h(e,t,n,r,null);So(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case ee:return e=e.get(null===r.key?n:r.key)||null,r.type===ne?h(t,e,r.props.children,i,r.key):c(t,e,r,i);case te:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(bo(r)||me(r))return h(t,e=e.get(n)||null,r,i,null);So(t,r)}return null}function m(i,a,s,l){for(var c=null,u=null,h=a,m=a=0,v=null;null!==h&&m<s.length;m++){h.index>m?(v=h,h=null):v=h.sibling;var g=d(i,h,s[m],l);if(null===g){null===h&&(h=v);break}e&&h&&null===g.alternate&&t(i,h),a=o(g,a,m),null===u?c=g:u.sibling=g,u=g,h=v}if(m===s.length)return n(i,h),c;if(null===h){for(;m<s.length;m++)null!==(h=f(i,s[m],l))&&(a=o(h,a,m),null===u?c=h:u.sibling=h,u=h);return c}for(h=r(i,h);m<s.length;m++)null!==(v=p(h,i,m,s[m],l))&&(e&&null!==v.alternate&&h.delete(null===v.key?m:v.key),a=o(v,a,m),null===u?c=v:u.sibling=v,u=v);return e&&h.forEach((function(e){return t(i,e)})),c}function v(i,s,l,c){var u=me(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var h=u=null,m=s,v=s=0,g=null,y=l.next();null!==m&&!y.done;v++,y=l.next()){m.index>v?(g=m,m=null):g=m.sibling;var _=d(i,m,y.value,c);if(null===_){null===m&&(m=g);break}e&&m&&null===_.alternate&&t(i,m),s=o(_,s,v),null===h?u=_:h.sibling=_,h=_,m=g}if(y.done)return n(i,m),u;if(null===m){for(;!y.done;v++,y=l.next())null!==(y=f(i,y.value,c))&&(s=o(y,s,v),null===h?u=y:h.sibling=y,h=y);return u}for(m=r(i,m);!y.done;v++,y=l.next())null!==(y=p(m,i,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=o(y,s,v),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(i,e)})),u}return function(e,r,o,l){var c="object"==typeof o&&null!==o&&o.type===ne&&null===o.key;c&&(o=o.props.children);var u="object"==typeof o&&null!==o;if(u)switch(o.$$typeof){case ee:e:{for(u=o.key,c=r;null!==c;){if(c.key===u){switch(c.tag){case 7:if(o.type===ne){n(e,c.sibling),(r=i(c,o.props.children)).return=e,e=r;break e}break;default:if(c.elementType===o.type){n(e,c.sibling),(r=i(c,o.props)).ref=wo(e,c,o),r.return=e,e=r;break e}}n(e,c);break}t(e,c),c=c.sibling}o.type===ne?((r=Cl(o.props.children,e.mode,l,o.key)).return=e,e=r):((l=Al(o.type,o.key,o.props,null,e.mode,l)).ref=wo(e,r,o),l.return=e,e=l)}return s(e);case te:e:{for(c=o.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),(r=i(r,o.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Pl(o,e.mode,l)).return=e,e=r}return s(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,o)).return=e,e=r):(n(e,r),(r=Rl(o,e.mode,l)).return=e,e=r),s(e);if(bo(o))return m(e,r,o,l);if(me(o))return v(e,r,o,l);if(u&&So(e,o),void 0===o&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(a(152,e.displayName||e.name||"Component"))}return n(e,r)}}var Eo=Mo(!0),To=Mo(!1),Ao={},Co={current:Ao},Ro={current:Ao},Po={current:Ao};function Lo(e){if(e===Ao)throw Error(a(174));return e}function ko(e,t){switch(ci(Po,t),ci(Ro,e),ci(Co,Ao),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Be(null,"");break;default:t=Be(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}li(Co),ci(Co,t)}function Io(){li(Co),li(Ro),li(Po)}function No(e){Lo(Po.current);var t=Lo(Co.current),n=Be(t,e.type);t!==n&&(ci(Ro,e),ci(Co,n))}function Oo(e){Ro.current===e&&(li(Co),li(Ro))}var Do={current:0};function Bo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function zo(e,t){return{responder:e,props:t}}var Fo=$.ReactCurrentDispatcher,Vo=$.ReactCurrentBatchConfig,Uo=0,Go=null,Ho=null,jo=null,Wo=!1;function qo(){throw Error(a(321))}function Xo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Br(e[n],t[n]))return!1;return!0}function Yo(e,t,n,r,i,o){if(Uo=o,Go=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Fo.current=null===e||null===e.memoizedState?ga:ya,e=n(r,i),t.expirationTime===Uo){o=0;do{if(t.expirationTime=0,!(25>o))throw Error(a(301));o+=1,jo=Ho=null,t.updateQueue=null,Fo.current=_a,e=n(r,i)}while(t.expirationTime===Uo)}if(Fo.current=va,t=null!==Ho&&null!==Ho.next,Uo=0,jo=Ho=Go=null,Wo=!1,t)throw Error(a(300));return e}function Zo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===jo?Go.memoizedState=jo=e:jo=jo.next=e,jo}function $o(){if(null===Ho){var e=Go.alternate;e=null!==e?e.memoizedState:null}else e=Ho.next;var t=null===jo?Go.memoizedState:jo.next;if(null!==t)jo=t,Ho=e;else{if(null===e)throw Error(a(310));e={memoizedState:(Ho=e).memoizedState,baseState:Ho.baseState,baseQueue:Ho.baseQueue,queue:Ho.queue,next:null},null===jo?Go.memoizedState=jo=e:jo=jo.next=e}return jo}function Jo(e,t){return"function"==typeof t?t(e):t}function Ko(e){var t=$o(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=Ho,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var l=s=o=null,c=i;do{var u=c.expirationTime;if(u<Uo){var h={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(s=l=h,o=r):l=l.next=h,u>Go.expirationTime&&(Go.expirationTime=u,al(u))}else null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),ol(u,c.suspenseConfig),r=c.eagerReducer===e?c.eagerState:e(r,c.action);c=c.next}while(null!==c&&c!==i);null===l?o=r:l.next=s,Br(r,t.memoizedState)||(Pa=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function Qo(e){var t=$o(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);Br(o,t.memoizedState)||(Pa=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function ea(e){var t=Zo();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:Jo,lastRenderedState:e}).dispatch=ma.bind(null,Go,e),[t.memoizedState,e]}function ta(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Go.updateQueue)?(t={lastEffect:null},Go.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function na(){return $o().memoizedState}function ra(e,t,n,r){var i=Zo();Go.effectTag|=e,i.memoizedState=ta(1|t,n,void 0,void 0===r?null:r)}function ia(e,t,n,r){var i=$o();r=void 0===r?null:r;var o=void 0;if(null!==Ho){var a=Ho.memoizedState;if(o=a.destroy,null!==r&&Xo(r,a.deps))return void ta(t,n,o,r)}Go.effectTag|=e,i.memoizedState=ta(1|t,n,o,r)}function oa(e,t){return ra(516,4,e,t)}function aa(e,t){return ia(516,4,e,t)}function sa(e,t){return ia(4,2,e,t)}function la(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ca(e,t,n){return n=null!=n?n.concat([e]):null,ia(4,2,la.bind(null,t,e),n)}function ua(){}function ha(e,t){return Zo().memoizedState=[e,void 0===t?null:t],e}function fa(e,t){var n=$o();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Xo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function da(e,t){var n=$o();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Xo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function pa(e,t,n){var r=Vi();Gi(98>r?98:r,(function(){e(!0)})),Gi(97<r?97:r,(function(){var r=Vo.suspense;Vo.suspense=void 0===t?null:t;try{e(!1),n()}finally{Vo.suspense=r}}))}function ma(e,t,n){var r=qs(),i=fo.suspense;i={expirationTime:r=Xs(r,e,i),suspenseConfig:i,action:n,eagerReducer:null,eagerState:null,next:null};var o=t.pending;if(null===o?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===Go||null!==o&&o===Go)Wo=!0,i.expirationTime=Uo,Go.expirationTime=Uo;else{if(0===e.expirationTime&&(null===o||0===o.expirationTime)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.eagerReducer=o,i.eagerState=s,Br(s,a))return}catch(e){}Ys(e,r)}}var va={readContext:ro,useCallback:qo,useContext:qo,useEffect:qo,useImperativeHandle:qo,useLayoutEffect:qo,useMemo:qo,useReducer:qo,useRef:qo,useState:qo,useDebugValue:qo,useResponder:qo,useDeferredValue:qo,useTransition:qo},ga={readContext:ro,useCallback:ha,useContext:ro,useEffect:oa,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ra(4,2,la.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ra(4,2,e,t)},useMemo:function(e,t){var n=Zo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Zo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=ma.bind(null,Go,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Zo().memoizedState=e},useState:ea,useDebugValue:ua,useResponder:zo,useDeferredValue:function(e,t){var n=ea(e),r=n[0],i=n[1];return oa((function(){var n=Vo.suspense;Vo.suspense=void 0===t?null:t;try{i(e)}finally{Vo.suspense=n}}),[e,t]),r},useTransition:function(e){var t=ea(!1),n=t[0];return t=t[1],[ha(pa.bind(null,t,e),[t,e]),n]}},ya={readContext:ro,useCallback:fa,useContext:ro,useEffect:aa,useImperativeHandle:ca,useLayoutEffect:sa,useMemo:da,useReducer:Ko,useRef:na,useState:function(){return Ko(Jo)},useDebugValue:ua,useResponder:zo,useDeferredValue:function(e,t){var n=Ko(Jo),r=n[0],i=n[1];return aa((function(){var n=Vo.suspense;Vo.suspense=void 0===t?null:t;try{i(e)}finally{Vo.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Ko(Jo),n=t[0];return t=t[1],[fa(pa.bind(null,t,e),[t,e]),n]}},_a={readContext:ro,useCallback:fa,useContext:ro,useEffect:aa,useImperativeHandle:ca,useLayoutEffect:sa,useMemo:da,useReducer:Qo,useRef:na,useState:function(){return Qo(Jo)},useDebugValue:ua,useResponder:zo,useDeferredValue:function(e,t){var n=Qo(Jo),r=n[0],i=n[1];return aa((function(){var n=Vo.suspense;Vo.suspense=void 0===t?null:t;try{i(e)}finally{Vo.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Qo(Jo),n=t[0];return t=t[1],[fa(pa.bind(null,t,e),[t,e]),n]}},xa=null,ba=null,wa=!1;function Sa(e,t){var n=Ml(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ma(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Ea(e){if(wa){var t=ba;if(t){var n=t;if(!Ma(e,t)){if(!(t=bn(n.nextSibling))||!Ma(e,t))return e.effectTag=-1025&e.effectTag|2,wa=!1,void(xa=e);Sa(xa,n)}xa=e,ba=bn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,wa=!1,xa=e}}function Ta(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;xa=e}function Aa(e){if(e!==xa)return!1;if(!wa)return Ta(e),wa=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!yn(t,e.memoizedProps))for(t=ba;t;)Sa(e,t),t=bn(t.nextSibling);if(Ta(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ba=bn(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ba=null}}else ba=xa?bn(e.stateNode.nextSibling):null;return!0}function Ca(){ba=xa=null,wa=!1}var Ra=$.ReactCurrentOwner,Pa=!1;function La(e,t,n,r){t.child=null===e?To(t,null,n,r):Eo(t,e.child,n,r)}function ka(e,t,n,r,i){n=n.render;var o=t.ref;return no(t,i),r=Yo(e,t,n,r,o,i),null===e||Pa?(t.effectTag|=1,La(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ya(e,t,i))}function Ia(e,t,n,r,i,o){if(null===e){var a=n.type;return"function"!=typeof a||El(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Al(n.type,null,r,null,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Na(e,t,a,r,i,o))}return a=e.child,i<o&&(i=a.memoizedProps,(n=null!==(n=n.compare)?n:Fr)(i,r)&&e.ref===t.ref)?Ya(e,t,o):(t.effectTag|=1,(e=Tl(a,r)).ref=t.ref,e.return=t,t.child=e)}function Na(e,t,n,r,i,o){return null!==e&&Fr(e.memoizedProps,r)&&e.ref===t.ref&&(Pa=!1,i<o)?(t.expirationTime=e.expirationTime,Ya(e,t,o)):Da(e,t,n,r,o)}function Oa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Da(e,t,n,r,i){var o=mi(n)?di:hi.current;return o=pi(t,o),no(t,i),n=Yo(e,t,n,r,o,i),null===e||Pa?(t.effectTag|=1,La(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Ya(e,t,i))}function Ba(e,t,n,r,i){if(mi(n)){var o=!0;_i(t)}else o=!1;if(no(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),yo(t,n,r),xo(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,c=n.contextType;"object"==typeof c&&null!==c?c=ro(c):c=pi(t,c=mi(n)?di:hi.current);var u=n.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate;h||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||l!==c)&&_o(t,a,r,c),io=!1;var f=t.memoizedState;a.state=f,uo(t,r,a,i),l=t.memoizedState,s!==r||f!==l||fi.current||io?("function"==typeof u&&(mo(t,n,u,r),l=t.memoizedState),(s=io||go(t,n,s,r,f,l,c))?(h||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.effectTag|=4)):("function"==typeof a.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=s):("function"==typeof a.componentDidMount&&(t.effectTag|=4),r=!1)}else a=t.stateNode,ao(e,t),s=t.memoizedProps,a.props=t.type===t.elementType?s:Yi(t.type,s),l=a.context,"object"==typeof(c=n.contextType)&&null!==c?c=ro(c):c=pi(t,c=mi(n)?di:hi.current),(h="function"==typeof(u=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||l!==c)&&_o(t,a,r,c),io=!1,l=t.memoizedState,a.state=l,uo(t,r,a,i),f=t.memoizedState,s!==r||l!==f||fi.current||io?("function"==typeof u&&(mo(t,n,u,r),f=t.memoizedState),(u=io||go(t,n,s,r,l,f,c))?(h||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,c),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,c)),"function"==typeof a.componentDidUpdate&&(t.effectTag|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=c,r=u):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),r=!1);return za(e,t,n,r,o,i)}function za(e,t,n,r,i,o){Oa(e,t);var a=0!=(64&t.effectTag);if(!r&&!a)return i&&xi(t,n,!1),Ya(e,t,o);r=t.stateNode,Ra.current=t;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&a?(t.child=Eo(t,e.child,null,o),t.child=Eo(t,null,s,o)):La(e,t,s,o),t.memoizedState=r.state,i&&xi(t,n,!0),t.child}function Fa(e){var t=e.stateNode;t.pendingContext?gi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gi(0,t.context,!1),ko(e,t.containerInfo)}var Va,Ua,Ga,Ha={dehydrated:null,retryTime:0};function ja(e,t,n){var r,i=t.mode,o=t.pendingProps,a=Do.current,s=!1;if((r=0!=(64&t.effectTag))||(r=0!=(2&a)&&(null===e||null!==e.memoizedState)),r?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(a|=1),ci(Do,1&a),null===e){if(void 0!==o.fallback&&Ea(t),s){if(s=o.fallback,(o=Cl(null,i,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Cl(s,i,n,null)).return=t,o.sibling=n,t.memoizedState=Ha,t.child=o,n}return i=o.children,t.memoizedState=null,t.child=To(t,null,i,n)}if(null!==e.memoizedState){if(i=(e=e.child).sibling,s){if(o=o.fallback,(n=Tl(e,e.pendingProps)).return=t,0==(2&t.mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=s;null!==s;)s.return=n,s=s.sibling;return(i=Tl(i,o)).return=t,n.sibling=i,n.childExpirationTime=0,t.memoizedState=Ha,t.child=n,i}return n=Eo(t,e.child,o.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=o.fallback,(o=Cl(null,i,0,null)).return=t,o.child=e,null!==e&&(e.return=o),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(n=Cl(s,i,n,null)).return=t,o.sibling=n,n.effectTag|=2,o.childExpirationTime=0,t.memoizedState=Ha,t.child=o,n}return t.memoizedState=null,t.child=Eo(t,e,o.children,n)}function Wa(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),to(e.return,t)}function qa(e,t,n,r,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailExpiration=0,a.tailMode=i,a.lastEffect=o)}function Xa(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(La(e,t,r.children,n),0!=(2&(r=Do.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Wa(e,n);else if(19===e.tag)Wa(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ci(Do,r),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Bo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),qa(t,!1,i,n,o,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Bo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}qa(t,!0,n,null,o,t.lastEffect);break;case"together":qa(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Ya(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&al(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Tl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Tl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Za(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function $a(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return mi(t.type)&&vi(),null;case 3:return Io(),li(fi),li(hi),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!Aa(t)||(t.effectTag|=4),null;case 5:Oo(t),n=Lo(Po.current);var o=t.type;if(null!==e&&null!=t.stateNode)Ua(e,t,o,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(null===t.stateNode)throw Error(a(166));return null}if(e=Lo(Co.current),Aa(t)){r=t.stateNode,o=t.type;var s=t.memoizedProps;switch(r[Mn]=t,r[En]=s,o){case"iframe":case"object":case"embed":Xt("load",r);break;case"video":case"audio":for(e=0;e<$e.length;e++)Xt($e[e],r);break;case"source":Xt("error",r);break;case"img":case"image":case"link":Xt("error",r),Xt("load",r);break;case"form":Xt("reset",r),Xt("submit",r);break;case"details":Xt("toggle",r);break;case"input":Se(r,s),Xt("invalid",r),ln(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Xt("invalid",r),ln(n,"onChange");break;case"textarea":Le(r,s),Xt("invalid",r),ln(n,"onChange")}for(var l in on(o,s),e=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"==typeof c?r.textContent!==c&&(e=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(e=["children",""+c]):M.hasOwnProperty(l)&&null!=c&&ln(n,l)}switch(o){case"input":xe(r),Te(r,s,!0);break;case"textarea":xe(r),Ie(r);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(r.onclick=cn)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(l=9===n.nodeType?n:n.ownerDocument,e===sn&&(e=De(o)),e===sn?"script"===o?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(o,{is:r.is}):(e=l.createElement(o),"select"===o&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,o),e[Mn]=t,e[En]=r,Va(e,t),t.stateNode=e,l=an(o,r),o){case"iframe":case"object":case"embed":Xt("load",e),c=r;break;case"video":case"audio":for(c=0;c<$e.length;c++)Xt($e[c],e);c=r;break;case"source":Xt("error",e),c=r;break;case"img":case"image":case"link":Xt("error",e),Xt("load",e),c=r;break;case"form":Xt("reset",e),Xt("submit",e),c=r;break;case"details":Xt("toggle",e),c=r;break;case"input":Se(e,r),c=we(e,r),Xt("invalid",e),ln(n,"onChange");break;case"option":c=Ce(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},c=i({},r,{value:void 0}),Xt("invalid",e),ln(n,"onChange");break;case"textarea":Le(e,r),c=Pe(e,r),Xt("invalid",e),ln(n,"onChange");break;default:c=r}on(o,c);var u=c;for(s in u)if(u.hasOwnProperty(s)){var h=u[s];"style"===s?nn(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&Fe(e,h):"children"===s?"string"==typeof h?("textarea"!==o||""!==h)&&Ve(e,h):"number"==typeof h&&Ve(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(M.hasOwnProperty(s)?null!=h&&ln(n,s):null!=h&&J(e,s,h,l))}switch(o){case"input":xe(e),Te(e,r,!1);break;case"textarea":xe(e),Ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+ye(r.value));break;case"select":e.multiple=!!r.multiple,null!=(n=r.value)?Re(e,!!r.multiple,n,!1):null!=r.defaultValue&&Re(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof c.onClick&&(e.onclick=cn)}gn(o,r)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Ga(0,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));n=Lo(Po.current),Lo(Co.current),Aa(t)?(n=t.stateNode,r=t.memoizedProps,n[Mn]=t,n.nodeValue!==r&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Mn]=t,t.stateNode=n)}return null;case 13:return li(Do),r=t.memoizedState,0!=(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==r,r=!1,null===e?void 0!==t.memoizedProps.fallback&&Aa(t):(r=null!==(o=e.memoizedState),n||null===o||null!==(o=e.child.sibling)&&(null!==(s=t.firstEffect)?(t.firstEffect=o,o.nextEffect=s):(t.firstEffect=t.lastEffect=o,o.nextEffect=null),o.effectTag=8)),n&&!r&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Do.current)?As===xs&&(As=bs):(As!==xs&&As!==bs||(As=ws),0!==ks&&null!==Ms&&(Il(Ms,Ts),Nl(Ms,ks)))),(n||r)&&(t.effectTag|=4),null);case 4:return Io(),null;case 10:return eo(t),null;case 17:return mi(t.type)&&vi(),null;case 19:if(li(Do),null===(r=t.memoizedState))return null;if(o=0!=(64&t.effectTag),null===(s=r.rendering)){if(o)Za(r,!1);else if(As!==xs||null!==e&&0!=(64&e.effectTag))for(s=t.child;null!==s;){if(null!==(e=Bo(s))){for(t.effectTag|=64,Za(r,!1),null!==(o=e.updateQueue)&&(t.updateQueue=o,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;null!==r;)s=n,(o=r).effectTag&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(e=o.alternate)?(o.childExpirationTime=0,o.expirationTime=s,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null):(o.childExpirationTime=e.childExpirationTime,o.expirationTime=e.expirationTime,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,s=e.dependencies,o.dependencies=null===s?null:{expirationTime:s.expirationTime,firstContext:s.firstContext,responders:s.responders}),r=r.sibling;return ci(Do,1&Do.current|2),t.child}s=s.sibling}}else{if(!o)if(null!==(e=Bo(s))){if(t.effectTag|=64,o=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),Za(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Fi()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,o=!0,Za(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(n=r.last)?n.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=Fi()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Fi(),n.sibling=null,t=Do.current,ci(Do,o?1&t|2:1&t),n):null}throw Error(a(156,t.tag))}function Ja(e){switch(e.tag){case 1:mi(e.type)&&vi();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Io(),li(fi),li(hi),0!=(64&(t=e.effectTag)))throw Error(a(285));return e.effectTag=-4097&t|64,e;case 5:return Oo(e),null;case 13:return li(Do),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return li(Do),null;case 4:return Io(),null;case 10:return eo(e),null;default:return null}}function Ka(e,t){return{value:e,source:t,stack:ge(t)}}Va=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ua=function(e,t,n,r,o){var a=e.memoizedProps;if(a!==r){var s,l,c=t.stateNode;switch(Lo(Co.current),e=null,n){case"input":a=we(c,a),r=we(c,r),e=[];break;case"option":a=Ce(c,a),r=Ce(c,r),e=[];break;case"select":a=i({},a,{value:void 0}),r=i({},r,{value:void 0}),e=[];break;case"textarea":a=Pe(c,a),r=Pe(c,r),e=[];break;default:"function"!=typeof a.onClick&&"function"==typeof r.onClick&&(c.onclick=cn)}for(s in on(n,r),n=null,a)if(!r.hasOwnProperty(s)&&a.hasOwnProperty(s)&&null!=a[s])if("style"===s)for(l in c=a[s])c.hasOwnProperty(l)&&(n||(n={}),n[l]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(M.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in r){var u=r[s];if(c=null!=a?a[s]:void 0,r.hasOwnProperty(s)&&u!==c&&(null!=u||null!=c))if("style"===s)if(c){for(l in c)!c.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in u)u.hasOwnProperty(l)&&c[l]!==u[l]&&(n||(n={}),n[l]=u[l])}else n||(e||(e=[]),e.push(s,n)),n=u;else"dangerouslySetInnerHTML"===s?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(e=e||[]).push(s,u)):"children"===s?c===u||"string"!=typeof u&&"number"!=typeof u||(e=e||[]).push(s,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(M.hasOwnProperty(s)?(null!=u&&ln(o,s),e||c===u||(e=[])):(e=e||[]).push(s,u))}n&&(e=e||[]).push("style",n),o=e,(t.updateQueue=o)&&(t.effectTag|=4)}},Ga=function(e,t,n,r){n!==r&&(t.effectTag|=4)};var Qa="function"==typeof WeakSet?WeakSet:Set;function es(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=ge(n)),null!==n&&ve(n.type),t=t.value,null!==e&&1===e.tag&&ve(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function ts(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){yl(e,t)}else t.current=null}function ns(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Yi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(a(163))}function rs(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function is(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function os(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void is(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:Yi(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&ho(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}ho(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&gn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Dt(n)))));case 19:case 17:case 20:case 21:return}throw Error(a(163))}function as(e,t,n){switch("function"==typeof wl&&wl(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;Gi(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var i=t;try{n()}catch(e){yl(i,e)}}e=e.next}while(e!==r)}))}break;case 1:ts(t),"function"==typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){yl(e,t)}}(t,n);break;case 5:ts(t);break;case 4:us(e,t,n)}}function ss(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&ss(t)}function ls(e){return 5===e.tag||3===e.tag||4===e.tag}function cs(e){e:{for(var t=e.return;null!==t;){if(ls(t)){var n=t;break e}t=t.return}throw Error(a(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(a(161))}16&n.effectTag&&(Ve(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ls(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}r?function e(t,n,r){var i=t.tag,o=5===i||6===i;if(o)t=o?t.stateNode:t.stateNode.instance,n?8===r.nodeType?r.parentNode.insertBefore(t,n):r.insertBefore(t,n):(8===r.nodeType?(n=r.parentNode).insertBefore(t,r):(n=r).appendChild(t),null!==(r=r._reactRootContainer)&&void 0!==r||null!==n.onclick||(n.onclick=cn));else if(4!==i&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t):function e(t,n,r){var i=t.tag,o=5===i||6===i;if(o)t=o?t.stateNode:t.stateNode.instance,n?r.insertBefore(t,n):r.appendChild(t);else if(4!==i&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t)}function us(e,t,n){for(var r,i,o=t,s=!1;;){if(!s){s=o.return;e:for(;;){if(null===s)throw Error(a(160));switch(r=s.stateNode,s.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}s=s.return}s=!0}if(5===o.tag||6===o.tag){e:for(var l=e,c=o,u=n,h=c;;)if(as(l,h,u),null!==h.child&&4!==h.tag)h.child.return=h,h=h.child;else{if(h===c)break e;for(;null===h.sibling;){if(null===h.return||h.return===c)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}i?(l=r,c=o.stateNode,8===l.nodeType?l.parentNode.removeChild(c):l.removeChild(c)):r.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){r=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(as(e,o,n),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(s=!1)}o.sibling.return=o.return,o=o.sibling}}function hs(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void rs(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,i=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[En]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Me(n,r),an(e,i),t=an(e,r),i=0;i<o.length;i+=2){var s=o[i],l=o[i+1];"style"===s?nn(n,l):"dangerouslySetInnerHTML"===s?Fe(n,l):"children"===s?Ve(n,l):J(n,s,l,t)}switch(e){case"input":Ee(n,r);break;case"textarea":ke(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?Re(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?Re(n,!!r.multiple,r.defaultValue,!0):Re(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(a(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Dt(t.containerInfo)));case 12:return;case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,Ns=Fi()),null!==n)e:for(e=n;;){if(5===e.tag)o=e.stateNode,r?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,i=null!=(i=e.memoizedProps.style)&&i.hasOwnProperty("display")?i.display:null,o.style.display=tn("display",i));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void fs(t);case 19:return void fs(t);case 17:return}throw Error(a(163))}function fs(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qa),t.forEach((function(t){var r=xl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var ds="function"==typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=so(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Ds||(Ds=!0,Bs=r),es(e,t)},n}function ms(e,t,n){(n=so(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return es(e,t),r(i)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===zs?zs=new Set([this]):zs.add(this),es(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var vs,gs=Math.ceil,ys=$.ReactCurrentDispatcher,_s=$.ReactCurrentOwner,xs=0,bs=3,ws=4,Ss=0,Ms=null,Es=null,Ts=0,As=xs,Cs=null,Rs=1073741823,Ps=1073741823,Ls=null,ks=0,Is=!1,Ns=0,Os=null,Ds=!1,Bs=null,zs=null,Fs=!1,Vs=null,Us=90,Gs=null,Hs=0,js=null,Ws=0;function qs(){return 0!=(48&Ss)?1073741821-(Fi()/10|0):0!==Ws?Ws:Ws=1073741821-(Fi()/10|0)}function Xs(e,t,n){if(0==(2&(t=t.mode)))return 1073741823;var r=Vi();if(0==(4&t))return 99===r?1073741823:1073741822;if(0!=(16&Ss))return Ts;if(null!==n)e=Xi(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=Xi(e,150,100);break;case 97:case 96:e=Xi(e,5e3,250);break;case 95:e=2;break;default:throw Error(a(326))}return null!==Ms&&e===Ts&&--e,e}function Ys(e,t){if(50<Hs)throw Hs=0,js=null,Error(a(185));if(null!==(e=Zs(e,t))){var n=Vi();1073741823===t?0!=(8&Ss)&&0==(48&Ss)?Qs(e):(Js(e),0===Ss&&Wi()):Js(e),0==(4&Ss)||98!==n&&99!==n||(null===Gs?Gs=new Map([[e,t]]):(void 0===(n=Gs.get(e))||n>t)&&Gs.set(e,t))}}function Zs(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return null!==i&&(Ms===i&&(al(t),As===ws&&Il(i,Ts)),Nl(i,t)),i}function $s(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!kl(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function Js(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=ji(Qs.bind(null,e));else{var t=$s(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=qs();if(1073741823===t?r=99:1===t||2===t?r=95:r=0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var i=e.callbackPriority;if(e.callbackExpirationTime===t&&i>=r)return;n!==ki&&Si(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?ji(Qs.bind(null,e)):Hi(r,Ks.bind(null,e),{timeout:10*(1073741821-t)-Fi()}),e.callbackNode=t}}}function Ks(e,t){if(Ws=0,t)return Ol(e,t=qs()),Js(e),null;var n=$s(e);if(0!==n){if(t=e.callbackNode,0!=(48&Ss))throw Error(a(327));if(ml(),e===Ms&&n===Ts||nl(e,n),null!==Es){var r=Ss;Ss|=16;for(var i=il();;)try{ll();break}catch(t){rl(e,t)}if(Qi(),Ss=r,ys.current=i,1===As)throw t=Cs,nl(e,n),Il(e,n),Js(e),t;if(null===Es)switch(i=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=As,Ms=null,r){case xs:case 1:throw Error(a(345));case 2:Ol(e,2<n?2:n);break;case bs:if(Il(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=hl(i)),1073741823===Rs&&10<(i=Ns+500-Fi())){if(Is){var o=e.lastPingedTime;if(0===o||o>=n){e.lastPingedTime=n,nl(e,n);break}}if(0!==(o=$s(e))&&o!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=_n(fl.bind(null,e),i);break}fl(e);break;case ws:if(Il(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=hl(i)),Is&&(0===(i=e.lastPingedTime)||i>=n)){e.lastPingedTime=n,nl(e,n);break}if(0!==(i=$s(e))&&i!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==Ps?r=10*(1073741821-Ps)-Fi():1073741823===Rs?r=0:(r=10*(1073741821-Rs)-5e3,0>(r=(i=Fi())-r)&&(r=0),(n=10*(1073741821-n)-i)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*gs(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=_n(fl.bind(null,e),r);break}fl(e);break;case 5:if(1073741823!==Rs&&null!==Ls){o=Rs;var s=Ls;if(0>=(r=0|s.busyMinDurationMs)?r=0:(i=0|s.busyDelayMs,r=(o=Fi()-(10*(1073741821-o)-(0|s.timeoutMs||5e3)))<=i?0:i+r-o),10<r){Il(e,n),e.timeoutHandle=_n(fl.bind(null,e),r);break}}fl(e);break;default:throw Error(a(329))}if(Js(e),e.callbackNode===t)return Ks.bind(null,e)}}return null}function Qs(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,0!=(48&Ss))throw Error(a(327));if(ml(),e===Ms&&t===Ts||nl(e,t),null!==Es){var n=Ss;Ss|=16;for(var r=il();;)try{sl();break}catch(t){rl(e,t)}if(Qi(),Ss=n,ys.current=r,1===As)throw n=Cs,nl(e,t),Il(e,t),Js(e),n;if(null!==Es)throw Error(a(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Ms=null,fl(e),Js(e)}return null}function el(e,t){var n=Ss;Ss|=1;try{return e(t)}finally{0===(Ss=n)&&Wi()}}function tl(e,t){var n=Ss;Ss&=-2,Ss|=8;try{return e(t)}finally{0===(Ss=n)&&Wi()}}function nl(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,xn(n)),null!==Es)for(n=Es.return;null!==n;){var r=n;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&vi();break;case 3:Io(),li(fi),li(hi);break;case 5:Oo(r);break;case 4:Io();break;case 13:case 19:li(Do);break;case 10:eo(r)}n=n.return}Ms=e,Es=Tl(e.current,null),Ts=t,As=xs,Cs=null,Ps=Rs=1073741823,Ls=null,ks=0,Is=!1}function rl(e,t){for(;;){try{if(Qi(),Fo.current=va,Wo)for(var n=Go.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}if(Uo=0,jo=Ho=Go=null,Wo=!1,null===Es||null===Es.return)return As=1,Cs=t,Es=null;e:{var i=e,o=Es.return,a=Es,s=t;if(t=Ts,a.effectTag|=2048,a.firstEffect=a.lastEffect=null,null!==s&&"object"==typeof s&&"function"==typeof s.then){var l=s;if(0==(2&a.mode)){var c=a.alternate;c?(a.updateQueue=c.updateQueue,a.memoizedState=c.memoizedState,a.expirationTime=c.expirationTime):(a.updateQueue=null,a.memoizedState=null)}var u=0!=(1&Do.current),h=o;do{var f;if(f=13===h.tag){var d=h.memoizedState;if(null!==d)f=null!==d.dehydrated;else{var p=h.memoizedProps;f=void 0!==p.fallback&&(!0!==p.unstable_avoidThisFallback||!u)}}if(f){var m=h.updateQueue;if(null===m){var v=new Set;v.add(l),h.updateQueue=v}else m.add(l);if(0==(2&h.mode)){if(h.effectTag|=64,a.effectTag&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var g=so(1073741823,null);g.tag=2,lo(a,g)}a.expirationTime=1073741823;break e}s=void 0,a=t;var y=i.pingCache;if(null===y?(y=i.pingCache=new ds,s=new Set,y.set(l,s)):void 0===(s=y.get(l))&&(s=new Set,y.set(l,s)),!s.has(a)){s.add(a);var _=_l.bind(null,i,l,a);l.then(_,_)}h.effectTag|=4096,h.expirationTime=t;break e}h=h.return}while(null!==h);s=Error((ve(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+ge(a))}5!==As&&(As=2),s=Ka(s,a),h=o;do{switch(h.tag){case 3:l=s,h.effectTag|=4096,h.expirationTime=t,co(h,ps(h,l,t));break e;case 1:l=s;var x=h.type,b=h.stateNode;if(0==(64&h.effectTag)&&("function"==typeof x.getDerivedStateFromError||null!==b&&"function"==typeof b.componentDidCatch&&(null===zs||!zs.has(b)))){h.effectTag|=4096,h.expirationTime=t,co(h,ms(h,l,t));break e}}h=h.return}while(null!==h)}Es=ul(Es)}catch(e){t=e;continue}break}}function il(){var e=ys.current;return ys.current=va,null===e?va:e}function ol(e,t){e<Rs&&2<e&&(Rs=e),null!==t&&e<Ps&&2<e&&(Ps=e,Ls=t)}function al(e){e>ks&&(ks=e)}function sl(){for(;null!==Es;)Es=cl(Es)}function ll(){for(;null!==Es&&!Ii();)Es=cl(Es)}function cl(e){var t=vs(e.alternate,e,Ts);return e.memoizedProps=e.pendingProps,null===t&&(t=ul(e)),_s.current=null,t}function ul(e){Es=e;do{var t=Es.alternate;if(e=Es.return,0==(2048&Es.effectTag)){if(t=$a(t,Es,Ts),1===Ts||1!==Es.childExpirationTime){for(var n=0,r=Es.child;null!==r;){var i=r.expirationTime,o=r.childExpirationTime;i>n&&(n=i),o>n&&(n=o),r=r.sibling}Es.childExpirationTime=n}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Es.firstEffect),null!==Es.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Es.firstEffect),e.lastEffect=Es.lastEffect),1<Es.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Es:e.firstEffect=Es,e.lastEffect=Es))}else{if(null!==(t=Ja(Es)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Es.sibling))return t;Es=e}while(null!==Es);return As===xs&&(As=5),null}function hl(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function fl(e){var t=Vi();return Gi(99,dl.bind(null,e,t)),null}function dl(e,t){do{ml()}while(null!==Vs);if(0!=(48&Ss))throw Error(a(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var i=hl(n);if(e.firstPendingTime=i,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Ms&&(Es=Ms=null,Ts=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){var o=Ss;Ss|=32,_s.current=null,mn=qt;var s=dn();if(pn(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{var c=(l=(l=s.ownerDocument)&&l.defaultView||window).getSelection&&l.getSelection();if(c&&0!==c.rangeCount){l=c.anchorNode;var u=c.anchorOffset,h=c.focusNode;c=c.focusOffset;try{l.nodeType,h.nodeType}catch(e){l=null;break e}var f=0,d=-1,p=-1,m=0,v=0,g=s,y=null;t:for(;;){for(var _;g!==l||0!==u&&3!==g.nodeType||(d=f+u),g!==h||0!==c&&3!==g.nodeType||(p=f+c),3===g.nodeType&&(f+=g.nodeValue.length),null!==(_=g.firstChild);)y=g,g=_;for(;;){if(g===s)break t;if(y===l&&++m===u&&(d=f),y===h&&++v===c&&(p=f),null!==(_=g.nextSibling))break;y=(g=y).parentNode}g=_}l=-1===d||-1===p?null:{start:d,end:p}}else l=null}l=l||{start:0,end:0}}else l=null;vn={activeElementDetached:null,focusedElem:s,selectionRange:l},qt=!1,Os=i;do{try{pl()}catch(e){if(null===Os)throw Error(a(330));yl(Os,e),Os=Os.nextEffect}}while(null!==Os);Os=i;do{try{for(s=e,l=t;null!==Os;){var x=Os.effectTag;if(16&x&&Ve(Os.stateNode,""),128&x){var b=Os.alternate;if(null!==b){var w=b.ref;null!==w&&("function"==typeof w?w(null):w.current=null)}}switch(1038&x){case 2:cs(Os),Os.effectTag&=-3;break;case 6:cs(Os),Os.effectTag&=-3,hs(Os.alternate,Os);break;case 1024:Os.effectTag&=-1025;break;case 1028:Os.effectTag&=-1025,hs(Os.alternate,Os);break;case 4:hs(Os.alternate,Os);break;case 8:us(s,u=Os,l),ss(u)}Os=Os.nextEffect}}catch(e){if(null===Os)throw Error(a(330));yl(Os,e),Os=Os.nextEffect}}while(null!==Os);if(w=vn,b=dn(),x=w.focusedElem,l=w.selectionRange,b!==x&&x&&x.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(x.ownerDocument.documentElement,x)){null!==l&&pn(x)&&(b=l.start,void 0===(w=l.end)&&(w=b),"selectionStart"in x?(x.selectionStart=b,x.selectionEnd=Math.min(w,x.value.length)):(w=(b=x.ownerDocument||document)&&b.defaultView||window).getSelection&&(w=w.getSelection(),u=x.textContent.length,s=Math.min(l.start,u),l=void 0===l.end?s:Math.min(l.end,u),!w.extend&&s>l&&(u=l,l=s,s=u),u=fn(x,s),h=fn(x,l),u&&h&&(1!==w.rangeCount||w.anchorNode!==u.node||w.anchorOffset!==u.offset||w.focusNode!==h.node||w.focusOffset!==h.offset)&&((b=b.createRange()).setStart(u.node,u.offset),w.removeAllRanges(),s>l?(w.addRange(b),w.extend(h.node,h.offset)):(b.setEnd(h.node,h.offset),w.addRange(b))))),b=[];for(w=x;w=w.parentNode;)1===w.nodeType&&b.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof x.focus&&x.focus(),x=0;x<b.length;x++)(w=b[x]).element.scrollLeft=w.left,w.element.scrollTop=w.top}qt=!!mn,vn=mn=null,e.current=n,Os=i;do{try{for(x=e;null!==Os;){var S=Os.effectTag;if(36&S&&os(x,Os.alternate,Os),128&S){b=void 0;var M=Os.ref;if(null!==M){var E=Os.stateNode;switch(Os.tag){case 5:b=E;break;default:b=E}"function"==typeof M?M(b):M.current=b}}Os=Os.nextEffect}}catch(e){if(null===Os)throw Error(a(330));yl(Os,e),Os=Os.nextEffect}}while(null!==Os);Os=null,Ni(),Ss=o}else e.current=n;if(Fs)Fs=!1,Vs=e,Us=t;else for(Os=i;null!==Os;)t=Os.nextEffect,Os.nextEffect=null,Os=t;if(0===(t=e.firstPendingTime)&&(zs=null),1073741823===t?e===js?Hs++:(Hs=0,js=e):Hs=0,"function"==typeof bl&&bl(n.stateNode,r),Js(e),Ds)throw Ds=!1,e=Bs,Bs=null,e;return 0!=(8&Ss)||Wi(),null}function pl(){for(;null!==Os;){var e=Os.effectTag;0!=(256&e)&&ns(Os.alternate,Os),0==(512&e)||Fs||(Fs=!0,Hi(97,(function(){return ml(),null}))),Os=Os.nextEffect}}function ml(){if(90!==Us){var e=97<Us?97:Us;return Us=90,Gi(e,vl)}}function vl(){if(null===Vs)return!1;var e=Vs;if(Vs=null,0!=(48&Ss))throw Error(a(331));var t=Ss;for(Ss|=32,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!=(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:rs(5,n),is(5,n)}}catch(t){if(null===e)throw Error(a(330));yl(e,t)}n=e.nextEffect,e.nextEffect=null,e=n}return Ss=t,Wi(),!0}function gl(e,t,n){lo(e,t=ps(e,t=Ka(n,t),1073741823)),null!==(e=Zs(e,1073741823))&&Js(e)}function yl(e,t){if(3===e.tag)gl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){gl(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===zs||!zs.has(r))){lo(n,e=ms(n,e=Ka(t,e),1073741823)),null!==(n=Zs(n,1073741823))&&Js(n);break}}n=n.return}}function _l(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),Ms===e&&Ts===n?As===ws||As===bs&&1073741823===Rs&&Fi()-Ns<500?nl(e,Ts):Is=!0:kl(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,Js(e)))}function xl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=Xs(t=qs(),e,null)),null!==(e=Zs(e,t))&&Js(e)}vs=function(e,t,n){var r=t.expirationTime;if(null!==e){var i=t.pendingProps;if(e.memoizedProps!==i||fi.current)Pa=!0;else{if(r<n){switch(Pa=!1,t.tag){case 3:Fa(t),Ca();break;case 5:if(No(t),4&t.mode&&1!==n&&i.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:mi(t.type)&&_i(t);break;case 4:ko(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,i=t.type._context,ci(Zi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?ja(e,t,n):(ci(Do,1&Do.current),null!==(t=Ya(e,t,n))?t.sibling:null);ci(Do,1&Do.current);break;case 19:if(r=t.childExpirationTime>=n,0!=(64&e.effectTag)){if(r)return Xa(e,t,n);t.effectTag|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null),ci(Do,Do.current),!r)return null}return Ya(e,t,n)}Pa=!1}}else Pa=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,i=pi(t,hi.current),no(t,n),i=Yo(null,t,r,e,i,n),t.effectTag|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,mi(r)){var o=!0;_i(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,oo(t);var s=r.getDerivedStateFromProps;"function"==typeof s&&mo(t,r,s,e),i.updater=vo,t.stateNode=i,i._reactInternalFiber=t,xo(t,r,e,n),t=za(null,t,r,!0,o,n)}else t.tag=0,La(null,t,i,n),t=t.child;return t;case 16:e:{if(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(i),1!==i._status)throw i._result;switch(i=i._result,t.type=i,o=t.tag=function(e){if("function"==typeof e)return El(e)?1:0;if(null!=e){if((e=e.$$typeof)===le)return 11;if(e===he)return 14}return 2}(i),e=Yi(i,e),o){case 0:t=Da(null,t,i,e,n);break e;case 1:t=Ba(null,t,i,e,n);break e;case 11:t=ka(null,t,i,e,n);break e;case 14:t=Ia(null,t,i,Yi(i.type,e),r,n);break e}throw Error(a(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Da(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ba(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 3:if(Fa(t),r=t.updateQueue,null===e||null===r)throw Error(a(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,ao(e,t),uo(t,r,null,n),(r=t.memoizedState.element)===i)Ca(),t=Ya(e,t,n);else{if((i=t.stateNode.hydrate)&&(ba=bn(t.stateNode.containerInfo.firstChild),xa=t,i=wa=!0),i)for(n=To(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else La(e,t,r,n),Ca();t=t.child}return t;case 5:return No(t),null===e&&Ea(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,yn(r,i)?s=null:null!==o&&yn(r,o)&&(t.effectTag|=16),Oa(e,t),4&t.mode&&1!==n&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(La(e,t,s,n),t=t.child),t;case 6:return null===e&&Ea(t),null;case 13:return ja(e,t,n);case 4:return ko(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Eo(t,null,r,n):La(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ka(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 7:return La(e,t,t.pendingProps,n),t.child;case 8:case 12:return La(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value;var l=t.type._context;if(ci(Zi,l._currentValue),l._currentValue=o,null!==s)if(l=s.value,0===(o=Br(l,o)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(l,o):1073741823))){if(s.children===i.children&&!fi.current){t=Ya(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){s=l.child;for(var u=c.firstContext;null!==u;){if(u.context===r&&0!=(u.observedBits&o)){1===l.tag&&((u=so(n,null)).tag=2,lo(l,u)),l.expirationTime<n&&(l.expirationTime=n),null!==(u=l.alternate)&&u.expirationTime<n&&(u.expirationTime=n),to(l.return,n),c.expirationTime<n&&(c.expirationTime=n);break}u=u.next}}else s=10===l.tag&&l.type===t.type?null:l.child;if(null!==s)s.return=l;else for(s=l;null!==s;){if(s===t){s=null;break}if(null!==(l=s.sibling)){l.return=s.return,s=l;break}s=s.return}l=s}La(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(o=t.pendingProps).children,no(t,n),r=r(i=ro(i,o.unstable_observedBits)),t.effectTag|=1,La(e,t,r,n),t.child;case 14:return o=Yi(i=t.type,t.pendingProps),Ia(e,t,i,o=Yi(i.type,o),r,n);case 15:return Na(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Yi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,mi(r)?(e=!0,_i(t)):e=!1,no(t,n),yo(t,r,i),xo(t,r,i,n),za(null,t,r,!0,e,n);case 19:return Xa(e,t,n)}throw Error(a(156,t.tag))};var bl=null,wl=null;function Sl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Ml(e,t,n,r){return new Sl(e,t,n,r)}function El(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Tl(e,t){var n=e.alternate;return null===n?((n=Ml(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Al(e,t,n,r,i,o){var s=2;if(r=e,"function"==typeof e)El(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case ne:return Cl(n.children,i,o,t);case se:s=8,i|=7;break;case re:s=8,i|=1;break;case ie:return(e=Ml(12,n,t,8|i)).elementType=ie,e.type=ie,e.expirationTime=o,e;case ce:return(e=Ml(13,n,t,i)).type=ce,e.elementType=ce,e.expirationTime=o,e;case ue:return(e=Ml(19,n,t,i)).elementType=ue,e.expirationTime=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case oe:s=10;break e;case ae:s=9;break e;case le:s=11;break e;case he:s=14;break e;case fe:s=16,r=null;break e;case de:s=22;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Ml(s,n,t,i)).elementType=e,t.type=r,t.expirationTime=o,t}function Cl(e,t,n,r){return(e=Ml(7,e,r,t)).expirationTime=n,e}function Rl(e,t,n){return(e=Ml(6,e,null,t)).expirationTime=n,e}function Pl(e,t,n){return(t=Ml(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ll(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function kl(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function Il(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Nl(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Ol(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function Dl(e,t,n,r){var i=t.current,o=qs(),s=fo.suspense;o=Xs(o,i,s);e:if(n){t:{if(Qe(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(a(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(mi(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(a(171))}if(1===n.tag){var c=n.type;if(mi(c)){n=yi(n,c,l);break e}}n=l}else n=ui;return null===t.context?t.context=n:t.pendingContext=n,(t=so(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),lo(i,t),Ys(i,o),o}function Bl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function zl(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Fl(e,t){zl(e,t),(e=e.alternate)&&zl(e,t)}function Vl(e,t,n){var r=new Ll(e,t,n=null!=n&&!0===n.hydrate),i=Ml(3,null,null,2===t?7:1===t?3:0);r.current=i,i.stateNode=r,oo(i),e[Tn]=r.current,n&&0!==t&&function(e,t){var n=Ke(t);Tt.forEach((function(e){pt(e,t,n)})),At.forEach((function(e){pt(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function Ul(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Gl(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o._internalRoot;if("function"==typeof i){var s=i;i=function(){var e=Bl(a);s.call(e)}}Dl(t,a,e,i)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Vl(e,0,t?{hydrate:!0}:void 0)}(n,r),a=o._internalRoot,"function"==typeof i){var l=i;i=function(){var e=Bl(a);l.call(e)}}tl((function(){Dl(t,a,e,i)}))}return Bl(a)}function Hl(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function jl(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ul(t))throw Error(a(200));return Hl(e,t,null,n)}Vl.prototype.render=function(e){Dl(e,this._internalRoot,null,null)},Vl.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Dl(null,e,null,(function(){t[Tn]=null}))},mt=function(e){if(13===e.tag){var t=Xi(qs(),150,100);Ys(e,t),Fl(e,t)}},vt=function(e){13===e.tag&&(Ys(e,3),Fl(e,3))},gt=function(e){if(13===e.tag){var t=qs();Ys(e,t=Xs(t,e,null)),Fl(e,t)}},C=function(e,t,n){switch(t){case"input":if(Ee(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Pn(r);if(!i)throw Error(a(90));be(r),Ee(r,i)}}}break;case"textarea":ke(e,n);break;case"select":null!=(t=n.value)&&Re(e,!!n.multiple,t,!1)}},N=el,O=function(e,t,n,r,i){var o=Ss;Ss|=4;try{return Gi(98,e.bind(null,t,n,r,i))}finally{0===(Ss=o)&&Wi()}},D=function(){0==(49&Ss)&&(function(){if(null!==Gs){var e=Gs;Gs=null,e.forEach((function(e,t){Ol(t,e),Js(t)})),Wi()}}(),ml())},B=function(e,t){var n=Ss;Ss|=2;try{return e(t)}finally{0===(Ss=n)&&Wi()}};var Wl,ql,Xl={Events:[Cn,Rn,Pn,T,S,Bn,function(e){it(e,Dn)},k,I,Jt,st,ml,{current:!1}]};ql=(Wl={findFiberByHostInstance:An,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}).findFiberByHostInstance,function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);bl=function(e){try{t.onCommitFiberRoot(n,e,void 0,64==(64&e.current.effectTag))}catch(e){}},wl=function(e){try{t.onCommitFiberUnmount(n,e)}catch(e){}}}catch(e){}}(i({},Wl,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=nt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return ql?ql(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null})),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xl,t.createPortal=jl,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw Error(a(268,Object.keys(e)))}return e=null===(e=nt(t))?null:e.stateNode},t.flushSync=function(e,t){if(0!=(48&Ss))throw Error(a(187));var n=Ss;Ss|=1;try{return Gi(99,e.bind(null,t))}finally{Ss=n,Wi()}},t.hydrate=function(e,t,n){if(!Ul(t))throw Error(a(200));return Gl(null,e,t,!0,n)},t.render=function(e,t,n){if(!Ul(t))throw Error(a(200));return Gl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Ul(e))throw Error(a(40));return!!e._reactRootContainer&&(tl((function(){Gl(null,null,e,!1,(function(){e._reactRootContainer=null,e[Tn]=null}))})),!0)},t.unstable_batchedUpdates=el,t.unstable_createPortal=function(e,t){return jl(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ul(n))throw Error(a(200));if(null==e||void 0===e._reactInternalFiber)throw Error(a(38));return Gl(e,t,n,!1,r)},t.version="16.14.0"},function(e,t,n){"use strict";e.exports=n(18)},function(e,t,n){"use strict";
/** @license React v0.19.1
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r,i,o,a,s;if("undefined"==typeof window||"function"!=typeof MessageChannel){var l=null,c=null,u=function(){if(null!==l)try{var e=t.unstable_now();l(!0,e),l=null}catch(e){throw setTimeout(u,0),e}},h=Date.now();t.unstable_now=function(){return Date.now()-h},r=function(e){null!==l?setTimeout(r,0,e):(l=e,setTimeout(u,0))},i=function(e,t){c=setTimeout(e,t)},o=function(){clearTimeout(c)},a=function(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var f=window.performance,d=window.Date,p=window.setTimeout,m=window.clearTimeout;if("undefined"!=typeof console){var v=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof v&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof f&&"function"==typeof f.now)t.unstable_now=function(){return f.now()};else{var g=d.now();t.unstable_now=function(){return d.now()-g}}var y=!1,_=null,x=-1,b=5,w=0;a=function(){return t.unstable_now()>=w},s=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):b=0<e?Math.floor(1e3/e):5};var S=new MessageChannel,M=S.port2;S.port1.onmessage=function(){if(null!==_){var e=t.unstable_now();w=e+b;try{_(!0,e)?M.postMessage(null):(y=!1,_=null)}catch(e){throw M.postMessage(null),e}}else y=!1},r=function(e){_=e,y||(y=!0,M.postMessage(null))},i=function(e,n){x=p((function(){e(t.unstable_now())}),n)},o=function(){m(x),x=-1}}function E(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<C(i,t)))break e;e[r]=t,e[n]=i,n=r}}function T(e){return void 0===(e=e[0])?null:e}function A(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,a=e[o],s=o+1,l=e[s];if(void 0!==a&&0>C(a,n))void 0!==l&&0>C(l,a)?(e[r]=l,e[s]=n,r=s):(e[r]=a,e[o]=n,r=o);else{if(!(void 0!==l&&0>C(l,n)))break e;e[r]=l,e[s]=n,r=s}}}return t}return null}function C(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var R=[],P=[],L=1,k=null,I=3,N=!1,O=!1,D=!1;function B(e){for(var t=T(P);null!==t;){if(null===t.callback)A(P);else{if(!(t.startTime<=e))break;A(P),t.sortIndex=t.expirationTime,E(R,t)}t=T(P)}}function z(e){if(D=!1,B(e),!O)if(null!==T(R))O=!0,r(F);else{var t=T(P);null!==t&&i(z,t.startTime-e)}}function F(e,n){O=!1,D&&(D=!1,o()),N=!0;var r=I;try{for(B(n),k=T(R);null!==k&&(!(k.expirationTime>n)||e&&!a());){var s=k.callback;if(null!==s){k.callback=null,I=k.priorityLevel;var l=s(k.expirationTime<=n);n=t.unstable_now(),"function"==typeof l?k.callback=l:k===T(R)&&A(R),B(n)}else A(R);k=T(R)}if(null!==k)var c=!0;else{var u=T(P);null!==u&&i(z,u.startTime-n),c=!1}return c}finally{k=null,I=r,N=!1}}function V(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var U=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){O||N||(O=!0,r(F))},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return T(R)},t.unstable_next=function(e){switch(I){case 1:case 2:case 3:var t=3;break;default:t=I}var n=I;I=t;try{return e()}finally{I=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=U,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=I;I=e;try{return t()}finally{I=n}},t.unstable_scheduleCallback=function(e,n,a){var s=t.unstable_now();if("object"==typeof a&&null!==a){var l=a.delay;l="number"==typeof l&&0<l?s+l:s,a="number"==typeof a.timeout?a.timeout:V(e)}else a=V(e),l=s;return e={id:L++,callback:n,priorityLevel:e,startTime:l,expirationTime:a=l+a,sortIndex:-1},l>s?(e.sortIndex=l,E(P,e),null===T(R)&&e===T(P)&&(D?o():D=!0,i(z,l-s))):(e.sortIndex=a,E(R,e),O||N||(O=!0,r(F))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();B(e);var n=T(R);return n!==k&&null!==k&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<k.expirationTime||a()},t.unstable_wrapCallback=function(e){var t=I;return function(){var n=I;I=t;try{return e.apply(this,arguments)}finally{I=n}}}},function(e,t,n){(function(e,r){var i;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o="Expected a function",a="__lodash_placeholder__",s=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],l="[object Arguments]",c="[object Array]",u="[object Boolean]",h="[object Date]",f="[object Error]",d="[object Function]",p="[object GeneratorFunction]",m="[object Map]",v="[object Number]",g="[object Object]",y="[object RegExp]",_="[object Set]",x="[object String]",b="[object Symbol]",w="[object WeakMap]",S="[object ArrayBuffer]",M="[object DataView]",E="[object Float32Array]",T="[object Float64Array]",A="[object Int8Array]",C="[object Int16Array]",R="[object Int32Array]",P="[object Uint8Array]",L="[object Uint16Array]",k="[object Uint32Array]",I=/\b__p \+= '';/g,N=/\b(__p \+=) '' \+/g,O=/(__e\(.*?\)|\b__t\)) \+\n'';/g,D=/&(?:amp|lt|gt|quot|#39);/g,B=/[&<>"']/g,z=RegExp(D.source),F=RegExp(B.source),V=/<%-([\s\S]+?)%>/g,U=/<%([\s\S]+?)%>/g,G=/<%=([\s\S]+?)%>/g,H=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,j=/^\w*$/,W=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,q=/[\\^$.*+?()[\]{}|]/g,X=RegExp(q.source),Y=/^\s+/,Z=/\s/,$=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,J=/\{\n\/\* \[wrapped with (.+)\] \*/,K=/,? & /,Q=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ee=/[()=,{}\[\]\/\s]/,te=/\\(\\)?/g,ne=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,re=/\w*$/,ie=/^[-+]0x[0-9a-f]+$/i,oe=/^0b[01]+$/i,ae=/^\[object .+?Constructor\]$/,se=/^0o[0-7]+$/i,le=/^(?:0|[1-9]\d*)$/,ce=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ue=/($^)/,he=/['\n\r\u2028\u2029\\]/g,fe="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",de="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pe="[\\ud800-\\udfff]",me="["+de+"]",ve="["+fe+"]",ge="\\d+",ye="[\\u2700-\\u27bf]",_e="[a-z\\xdf-\\xf6\\xf8-\\xff]",xe="[^\\ud800-\\udfff"+de+ge+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",be="\\ud83c[\\udffb-\\udfff]",we="[^\\ud800-\\udfff]",Se="(?:\\ud83c[\\udde6-\\uddff]){2}",Me="[\\ud800-\\udbff][\\udc00-\\udfff]",Ee="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Te="(?:"+_e+"|"+xe+")",Ae="(?:"+Ee+"|"+xe+")",Ce="(?:"+ve+"|"+be+")"+"?",Re="[\\ufe0e\\ufe0f]?"+Ce+("(?:\\u200d(?:"+[we,Se,Me].join("|")+")[\\ufe0e\\ufe0f]?"+Ce+")*"),Pe="(?:"+[ye,Se,Me].join("|")+")"+Re,Le="(?:"+[we+ve+"?",ve,Se,Me,pe].join("|")+")",ke=RegExp("[']","g"),Ie=RegExp(ve,"g"),Ne=RegExp(be+"(?="+be+")|"+Le+Re,"g"),Oe=RegExp([Ee+"?"+_e+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[me,Ee,"$"].join("|")+")",Ae+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[me,Ee+Te,"$"].join("|")+")",Ee+"?"+Te+"+(?:['](?:d|ll|m|re|s|t|ve))?",Ee+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ge,Pe].join("|"),"g"),De=RegExp("[\\u200d\\ud800-\\udfff"+fe+"\\ufe0e\\ufe0f]"),Be=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ze=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fe=-1,Ve={};Ve[E]=Ve[T]=Ve[A]=Ve[C]=Ve[R]=Ve[P]=Ve["[object Uint8ClampedArray]"]=Ve[L]=Ve[k]=!0,Ve[l]=Ve[c]=Ve[S]=Ve[u]=Ve[M]=Ve[h]=Ve[f]=Ve[d]=Ve[m]=Ve[v]=Ve[g]=Ve[y]=Ve[_]=Ve[x]=Ve[w]=!1;var Ue={};Ue[l]=Ue[c]=Ue[S]=Ue[M]=Ue[u]=Ue[h]=Ue[E]=Ue[T]=Ue[A]=Ue[C]=Ue[R]=Ue[m]=Ue[v]=Ue[g]=Ue[y]=Ue[_]=Ue[x]=Ue[b]=Ue[P]=Ue["[object Uint8ClampedArray]"]=Ue[L]=Ue[k]=!0,Ue[f]=Ue[d]=Ue[w]=!1;var Ge={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},He=parseFloat,je=parseInt,We="object"==typeof e&&e&&e.Object===Object&&e,qe="object"==typeof self&&self&&self.Object===Object&&self,Xe=We||qe||Function("return this")(),Ye=t&&!t.nodeType&&t,Ze=Ye&&"object"==typeof r&&r&&!r.nodeType&&r,$e=Ze&&Ze.exports===Ye,Je=$e&&We.process,Ke=function(){try{var e=Ze&&Ze.require&&Ze.require("util").types;return e||Je&&Je.binding&&Je.binding("util")}catch(e){}}(),Qe=Ke&&Ke.isArrayBuffer,et=Ke&&Ke.isDate,tt=Ke&&Ke.isMap,nt=Ke&&Ke.isRegExp,rt=Ke&&Ke.isSet,it=Ke&&Ke.isTypedArray;function ot(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function at(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}function st(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function lt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function ct(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function ut(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function ht(e,t){return!!(null==e?0:e.length)&&bt(e,t,0)>-1}function ft(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function dt(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function pt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function mt(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function vt(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function gt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var yt=Et("length");function _t(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function xt(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function bt(e,t,n){return t==t?function(e,t,n){var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):xt(e,St,n)}function wt(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function St(e){return e!=e}function Mt(e,t){var n=null==e?0:e.length;return n?Ct(e,t)/n:NaN}function Et(e){return function(t){return null==t?void 0:t[e]}}function Tt(e){return function(t){return null==e?void 0:e[t]}}function At(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}function Ct(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);void 0!==o&&(n=void 0===n?o:n+o)}return n}function Rt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Pt(e){return e?e.slice(0,Yt(e)+1).replace(Y,""):e}function Lt(e){return function(t){return e(t)}}function kt(e,t){return dt(t,(function(t){return e[t]}))}function It(e,t){return e.has(t)}function Nt(e,t){for(var n=-1,r=e.length;++n<r&&bt(t,e[n],0)>-1;);return n}function Ot(e,t){for(var n=e.length;n--&&bt(t,e[n],0)>-1;);return n}function Dt(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}var Bt=Tt({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),zt=Tt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Ft(e){return"\\"+Ge[e]}function Vt(e){return De.test(e)}function Ut(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Gt(e,t){return function(n){return e(t(n))}}function Ht(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var s=e[n];s!==t&&s!==a||(e[n]=a,o[i++]=n)}return o}function jt(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function Wt(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function qt(e){return Vt(e)?function(e){var t=Ne.lastIndex=0;for(;Ne.test(e);)++t;return t}(e):yt(e)}function Xt(e){return Vt(e)?function(e){return e.match(Ne)||[]}(e):function(e){return e.split("")}(e)}function Yt(e){for(var t=e.length;t--&&Z.test(e.charAt(t)););return t}var Zt=Tt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var $t=function e(t){var n,r=(t=null==t?Xe:$t.defaults(Xe.Object(),t,$t.pick(Xe,ze))).Array,i=t.Date,Z=t.Error,fe=t.Function,de=t.Math,pe=t.Object,me=t.RegExp,ve=t.String,ge=t.TypeError,ye=r.prototype,_e=fe.prototype,xe=pe.prototype,be=t["__core-js_shared__"],we=_e.toString,Se=xe.hasOwnProperty,Me=0,Ee=(n=/[^.]+$/.exec(be&&be.keys&&be.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Te=xe.toString,Ae=we.call(pe),Ce=Xe._,Re=me("^"+we.call(Se).replace(q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pe=$e?t.Buffer:void 0,Le=t.Symbol,Ne=t.Uint8Array,De=Pe?Pe.allocUnsafe:void 0,Ge=Gt(pe.getPrototypeOf,pe),We=pe.create,qe=xe.propertyIsEnumerable,Ye=ye.splice,Ze=Le?Le.isConcatSpreadable:void 0,Je=Le?Le.iterator:void 0,Ke=Le?Le.toStringTag:void 0,yt=function(){try{var e=eo(pe,"defineProperty");return e({},"",{}),e}catch(e){}}(),Tt=t.clearTimeout!==Xe.clearTimeout&&t.clearTimeout,Jt=i&&i.now!==Xe.Date.now&&i.now,Kt=t.setTimeout!==Xe.setTimeout&&t.setTimeout,Qt=de.ceil,en=de.floor,tn=pe.getOwnPropertySymbols,nn=Pe?Pe.isBuffer:void 0,rn=t.isFinite,on=ye.join,an=Gt(pe.keys,pe),sn=de.max,ln=de.min,cn=i.now,un=t.parseInt,hn=de.random,fn=ye.reverse,dn=eo(t,"DataView"),pn=eo(t,"Map"),mn=eo(t,"Promise"),vn=eo(t,"Set"),gn=eo(t,"WeakMap"),yn=eo(pe,"create"),_n=gn&&new gn,xn={},bn=Co(dn),wn=Co(pn),Sn=Co(mn),Mn=Co(vn),En=Co(gn),Tn=Le?Le.prototype:void 0,An=Tn?Tn.valueOf:void 0,Cn=Tn?Tn.toString:void 0;function Rn(e){if(Wa(e)&&!Na(e)&&!(e instanceof In)){if(e instanceof kn)return e;if(Se.call(e,"__wrapped__"))return Ro(e)}return new kn(e)}var Pn=function(){function e(){}return function(t){if(!ja(t))return{};if(We)return We(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function Ln(){}function kn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function In(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Nn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function On(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Dn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Bn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Dn;++t<n;)this.add(e[t])}function zn(e){var t=this.__data__=new On(e);this.size=t.size}function Fn(e,t){var n=Na(e),r=!n&&Ia(e),i=!n&&!r&&za(e),o=!n&&!r&&!i&&Qa(e),a=n||r||i||o,s=a?Rt(e.length,ve):[],l=s.length;for(var c in e)!t&&!Se.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||so(c,l))||s.push(c);return s}function Vn(e){var t=e.length;return t?e[Br(0,t-1)]:void 0}function Un(e,t){return Eo(yi(e),$n(t,0,e.length))}function Gn(e){return Eo(yi(e))}function Hn(e,t,n){(void 0!==n&&!Pa(e[t],n)||void 0===n&&!(t in e))&&Yn(e,t,n)}function jn(e,t,n){var r=e[t];Se.call(e,t)&&Pa(r,n)&&(void 0!==n||t in e)||Yn(e,t,n)}function Wn(e,t){for(var n=e.length;n--;)if(Pa(e[n][0],t))return n;return-1}function qn(e,t,n,r){return tr(e,(function(e,i,o){t(r,e,n(e),o)})),r}function Xn(e,t){return e&&_i(t,bs(t),e)}function Yn(e,t,n){"__proto__"==t&&yt?yt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Zn(e,t){for(var n=-1,i=t.length,o=r(i),a=null==e;++n<i;)o[n]=a?void 0:vs(e,t[n]);return o}function $n(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}function Jn(e,t,n,r,i,o){var a,s=1&t,c=2&t,f=4&t;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!ja(e))return e;var w=Na(e);if(w){if(a=function(e){var t=e.length,n=new e.constructor(t);t&&"string"==typeof e[0]&&Se.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!s)return yi(e,a)}else{var I=ro(e),N=I==d||I==p;if(za(e))return fi(e,s);if(I==g||I==l||N&&!i){if(a=c||N?{}:oo(e),!s)return c?function(e,t){return _i(e,no(e),t)}(e,function(e,t){return e&&_i(t,ws(t),e)}(a,e)):function(e,t){return _i(e,to(e),t)}(e,Xn(a,e))}else{if(!Ue[I])return i?e:{};a=function(e,t,n){var r=e.constructor;switch(t){case S:return di(e);case u:case h:return new r(+e);case M:return function(e,t){var n=t?di(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case E:case T:case A:case C:case R:case P:case"[object Uint8ClampedArray]":case L:case k:return pi(e,n);case m:return new r;case v:case x:return new r(e);case y:return function(e){var t=new e.constructor(e.source,re.exec(e));return t.lastIndex=e.lastIndex,t}(e);case _:return new r;case b:return i=e,An?pe(An.call(i)):{}}var i}(e,I,s)}}o||(o=new zn);var O=o.get(e);if(O)return O;o.set(e,a),$a(e)?e.forEach((function(r){a.add(Jn(r,t,n,r,e,o))})):qa(e)&&e.forEach((function(r,i){a.set(i,Jn(r,t,n,i,e,o))}));var D=w?void 0:(f?c?Xi:qi:c?ws:bs)(e);return st(D||e,(function(r,i){D&&(r=e[i=r]),jn(a,i,Jn(r,t,n,i,e,o))})),a}function Kn(e,t,n){var r=n.length;if(null==e)return!r;for(e=pe(e);r--;){var i=n[r],o=t[i],a=e[i];if(void 0===a&&!(i in e)||!o(a))return!1}return!0}function Qn(e,t,n){if("function"!=typeof e)throw new ge(o);return bo((function(){e.apply(void 0,n)}),t)}function er(e,t,n,r){var i=-1,o=ht,a=!0,s=e.length,l=[],c=t.length;if(!s)return l;n&&(t=dt(t,Lt(n))),r?(o=ft,a=!1):t.length>=200&&(o=It,a=!1,t=new Bn(t));e:for(;++i<s;){var u=e[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,a&&h==h){for(var f=c;f--;)if(t[f]===h)continue e;l.push(u)}else o(t,h,r)||l.push(u)}return l}Rn.templateSettings={escape:V,evaluate:U,interpolate:G,variable:"",imports:{_:Rn}},Rn.prototype=Ln.prototype,Rn.prototype.constructor=Rn,kn.prototype=Pn(Ln.prototype),kn.prototype.constructor=kn,In.prototype=Pn(Ln.prototype),In.prototype.constructor=In,Nn.prototype.clear=function(){this.__data__=yn?yn(null):{},this.size=0},Nn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Nn.prototype.get=function(e){var t=this.__data__;if(yn){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Se.call(t,e)?t[e]:void 0},Nn.prototype.has=function(e){var t=this.__data__;return yn?void 0!==t[e]:Se.call(t,e)},Nn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=yn&&void 0===t?"__lodash_hash_undefined__":t,this},On.prototype.clear=function(){this.__data__=[],this.size=0},On.prototype.delete=function(e){var t=this.__data__,n=Wn(t,e);return!(n<0)&&(n==t.length-1?t.pop():Ye.call(t,n,1),--this.size,!0)},On.prototype.get=function(e){var t=this.__data__,n=Wn(t,e);return n<0?void 0:t[n][1]},On.prototype.has=function(e){return Wn(this.__data__,e)>-1},On.prototype.set=function(e,t){var n=this.__data__,r=Wn(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Dn.prototype.clear=function(){this.size=0,this.__data__={hash:new Nn,map:new(pn||On),string:new Nn}},Dn.prototype.delete=function(e){var t=Ki(this,e).delete(e);return this.size-=t?1:0,t},Dn.prototype.get=function(e){return Ki(this,e).get(e)},Dn.prototype.has=function(e){return Ki(this,e).has(e)},Dn.prototype.set=function(e,t){var n=Ki(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Bn.prototype.add=Bn.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Bn.prototype.has=function(e){return this.__data__.has(e)},zn.prototype.clear=function(){this.__data__=new On,this.size=0},zn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},zn.prototype.get=function(e){return this.__data__.get(e)},zn.prototype.has=function(e){return this.__data__.has(e)},zn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof On){var r=n.__data__;if(!pn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Dn(r)}return n.set(e,t),this.size=n.size,this};var tr=wi(cr),nr=wi(ur,!0);function rr(e,t){var n=!0;return tr(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function ir(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=t(o);if(null!=a&&(void 0===s?a==a&&!Ka(a):n(a,s)))var s=a,l=o}return l}function or(e,t){var n=[];return tr(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function ar(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=ao),i||(i=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?ar(s,t-1,n,r,i):pt(i,s):r||(i[i.length]=s)}return i}var sr=Si(),lr=Si(!0);function cr(e,t){return e&&sr(e,t,bs)}function ur(e,t){return e&&lr(e,t,bs)}function hr(e,t){return ut(t,(function(t){return Ua(e[t])}))}function fr(e,t){for(var n=0,r=(t=li(t,e)).length;null!=e&&n<r;)e=e[Ao(t[n++])];return n&&n==r?e:void 0}function dr(e,t,n){var r=t(e);return Na(e)?r:pt(r,n(e))}function pr(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ke&&Ke in pe(e)?function(e){var t=Se.call(e,Ke),n=e[Ke];try{e[Ke]=void 0;var r=!0}catch(e){}var i=Te.call(e);r&&(t?e[Ke]=n:delete e[Ke]);return i}(e):function(e){return Te.call(e)}(e)}function mr(e,t){return e>t}function vr(e,t){return null!=e&&Se.call(e,t)}function gr(e,t){return null!=e&&t in pe(e)}function yr(e,t,n){for(var i=n?ft:ht,o=e[0].length,a=e.length,s=a,l=r(a),c=1/0,u=[];s--;){var h=e[s];s&&t&&(h=dt(h,Lt(t))),c=ln(h.length,c),l[s]=!n&&(t||o>=120&&h.length>=120)?new Bn(s&&h):void 0}h=e[0];var f=-1,d=l[0];e:for(;++f<o&&u.length<c;){var p=h[f],m=t?t(p):p;if(p=n||0!==p?p:0,!(d?It(d,m):i(u,m,n))){for(s=a;--s;){var v=l[s];if(!(v?It(v,m):i(e[s],m,n)))continue e}d&&d.push(m),u.push(p)}}return u}function _r(e,t,n){var r=null==(e=go(e,t=li(t,e)))?e:e[Ao(Vo(t))];return null==r?void 0:ot(r,e,n)}function xr(e){return Wa(e)&&pr(e)==l}function br(e,t,n,r,i){return e===t||(null==e||null==t||!Wa(e)&&!Wa(t)?e!=e&&t!=t:function(e,t,n,r,i,o){var a=Na(e),s=Na(t),d=a?c:ro(e),p=s?c:ro(t),w=(d=d==l?g:d)==g,E=(p=p==l?g:p)==g,T=d==p;if(T&&za(e)){if(!za(t))return!1;a=!0,w=!1}if(T&&!w)return o||(o=new zn),a||Qa(e)?ji(e,t,n,r,i,o):function(e,t,n,r,i,o,a){switch(n){case M:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case S:return!(e.byteLength!=t.byteLength||!o(new Ne(e),new Ne(t)));case u:case h:case v:return Pa(+e,+t);case f:return e.name==t.name&&e.message==t.message;case y:case x:return e==t+"";case m:var s=Ut;case _:var l=1&r;if(s||(s=jt),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=2,a.set(e,t);var d=ji(s(e),s(t),r,i,o,a);return a.delete(e),d;case b:if(An)return An.call(e)==An.call(t)}return!1}(e,t,d,n,r,i,o);if(!(1&n)){var A=w&&Se.call(e,"__wrapped__"),C=E&&Se.call(t,"__wrapped__");if(A||C){var R=A?e.value():e,P=C?t.value():t;return o||(o=new zn),i(R,P,n,r,o)}}if(!T)return!1;return o||(o=new zn),function(e,t,n,r,i,o){var a=1&n,s=qi(e),l=s.length,c=qi(t).length;if(l!=c&&!a)return!1;var u=l;for(;u--;){var h=s[u];if(!(a?h in t:Se.call(t,h)))return!1}var f=o.get(e),d=o.get(t);if(f&&d)return f==t&&d==e;var p=!0;o.set(e,t),o.set(t,e);var m=a;for(;++u<l;){h=s[u];var v=e[h],g=t[h];if(r)var y=a?r(g,v,h,t,e,o):r(v,g,h,e,t,o);if(!(void 0===y?v===g||i(v,g,n,r,o):y)){p=!1;break}m||(m="constructor"==h)}if(p&&!m){var _=e.constructor,x=t.constructor;_==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x||(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,i,o)}(e,t,n,r,br,i))}function wr(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=pe(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],c=e[l],u=s[1];if(a&&s[2]){if(void 0===c&&!(l in e))return!1}else{var h=new zn;if(r)var f=r(c,u,l,e,t,h);if(!(void 0===f?br(u,c,3,r,h):f))return!1}}return!0}function Sr(e){return!(!ja(e)||(t=e,Ee&&Ee in t))&&(Ua(e)?Re:ae).test(Co(e));var t}function Mr(e){return"function"==typeof e?e:null==e?Xs:"object"==typeof e?Na(e)?Pr(e[0],e[1]):Rr(e):nl(e)}function Er(e){if(!fo(e))return an(e);var t=[];for(var n in pe(e))Se.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Tr(e){if(!ja(e))return function(e){var t=[];if(null!=e)for(var n in pe(e))t.push(n);return t}(e);var t=fo(e),n=[];for(var r in e)("constructor"!=r||!t&&Se.call(e,r))&&n.push(r);return n}function Ar(e,t){return e<t}function Cr(e,t){var n=-1,i=Da(e)?r(e.length):[];return tr(e,(function(e,r,o){i[++n]=t(e,r,o)})),i}function Rr(e){var t=Qi(e);return 1==t.length&&t[0][2]?mo(t[0][0],t[0][1]):function(n){return n===e||wr(n,e,t)}}function Pr(e,t){return co(e)&&po(t)?mo(Ao(e),t):function(n){var r=vs(n,e);return void 0===r&&r===t?gs(n,e):br(t,r,3)}}function Lr(e,t,n,r,i){e!==t&&sr(t,(function(o,a){if(i||(i=new zn),ja(o))!function(e,t,n,r,i,o,a){var s=_o(e,n),l=_o(t,n),c=a.get(l);if(c)return void Hn(e,n,c);var u=o?o(s,l,n+"",e,t,a):void 0,h=void 0===u;if(h){var f=Na(l),d=!f&&za(l),p=!f&&!d&&Qa(l);u=l,f||d||p?Na(s)?u=s:Ba(s)?u=yi(s):d?(h=!1,u=fi(l,!0)):p?(h=!1,u=pi(l,!0)):u=[]:Ya(l)||Ia(l)?(u=s,Ia(s)?u=ss(s):ja(s)&&!Ua(s)||(u=oo(l))):h=!1}h&&(a.set(l,u),i(u,l,r,o,a),a.delete(l));Hn(e,n,u)}(e,t,a,n,Lr,r,i);else{var s=r?r(_o(e,a),o,a+"",e,t,i):void 0;void 0===s&&(s=o),Hn(e,a,s)}}),ws)}function kr(e,t){var n=e.length;if(n)return so(t+=t<0?n:0,n)?e[t]:void 0}function Ir(e,t,n){t=t.length?dt(t,(function(e){return Na(e)?function(t){return fr(t,1===e.length?e[0]:e)}:e})):[Xs];var r=-1;return t=dt(t,Lt(Ji())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Cr(e,(function(e,n,i){return{criteria:dt(t,(function(t){return t(e)})),index:++r,value:e}})),(function(e,t){return function(e,t,n){var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;for(;++r<a;){var l=mi(i[r],o[r]);if(l){if(r>=s)return l;var c=n[r];return l*("desc"==c?-1:1)}}return e.index-t.index}(e,t,n)}))}function Nr(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=fr(e,a);n(s,a)&&Gr(o,li(a,e),s)}return o}function Or(e,t,n,r){var i=r?wt:bt,o=-1,a=t.length,s=e;for(e===t&&(t=yi(t)),n&&(s=dt(e,Lt(n)));++o<a;)for(var l=0,c=t[o],u=n?n(c):c;(l=i(s,u,l,r))>-1;)s!==e&&Ye.call(s,l,1),Ye.call(e,l,1);return e}function Dr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;so(i)?Ye.call(e,i,1):ei(e,i)}}return e}function Br(e,t){return e+en(hn()*(t-e+1))}function zr(e,t){var n="";if(!e||t<1||t>9007199254740991)return n;do{t%2&&(n+=e),(t=en(t/2))&&(e+=e)}while(t);return n}function Fr(e,t){return wo(vo(e,t,Xs),e+"")}function Vr(e){return Vn(Ps(e))}function Ur(e,t){var n=Ps(e);return Eo(n,$n(t,0,n.length))}function Gr(e,t,n,r){if(!ja(e))return e;for(var i=-1,o=(t=li(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var l=Ao(t[i]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(i!=a){var u=s[l];void 0===(c=r?r(u,l,s):void 0)&&(c=ja(u)?u:so(t[i+1])?[]:{})}jn(s,l,c),s=s[l]}return e}var Hr=_n?function(e,t){return _n.set(e,t),e}:Xs,jr=yt?function(e,t){return yt(e,"toString",{configurable:!0,enumerable:!1,value:js(t),writable:!0})}:Xs;function Wr(e){return Eo(Ps(e))}function qr(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var a=r(o);++i<o;)a[i]=e[i+t];return a}function Xr(e,t){var n;return tr(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function Yr(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=e[o];null!==a&&!Ka(a)&&(n?a<=t:a<t)?r=o+1:i=o}return i}return Zr(e,t,Xs,n)}function Zr(e,t,n,r){var i=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=n(t))!=t,s=null===t,l=Ka(t),c=void 0===t;i<o;){var u=en((i+o)/2),h=n(e[u]),f=void 0!==h,d=null===h,p=h==h,m=Ka(h);if(a)var v=r||p;else v=c?p&&(r||f):s?p&&f&&(r||!d):l?p&&f&&!d&&(r||!m):!d&&!m&&(r?h<=t:h<t);v?i=u+1:o=u}return ln(o,4294967294)}function $r(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n],s=t?t(a):a;if(!n||!Pa(s,l)){var l=s;o[i++]=0===a?0:a}}return o}function Jr(e){return"number"==typeof e?e:Ka(e)?NaN:+e}function Kr(e){if("string"==typeof e)return e;if(Na(e))return dt(e,Kr)+"";if(Ka(e))return Cn?Cn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Qr(e,t,n){var r=-1,i=ht,o=e.length,a=!0,s=[],l=s;if(n)a=!1,i=ft;else if(o>=200){var c=t?null:zi(e);if(c)return jt(c);a=!1,i=It,l=new Bn}else l=t?[]:s;e:for(;++r<o;){var u=e[r],h=t?t(u):u;if(u=n||0!==u?u:0,a&&h==h){for(var f=l.length;f--;)if(l[f]===h)continue e;t&&l.push(h),s.push(u)}else i(l,h,n)||(l!==s&&l.push(h),s.push(u))}return s}function ei(e,t){return null==(e=go(e,t=li(t,e)))||delete e[Ao(Vo(t))]}function ti(e,t,n,r){return Gr(e,t,n(fr(e,t)),r)}function ni(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?qr(e,r?0:o,r?o+1:i):qr(e,r?o+1:0,r?i:o)}function ri(e,t){var n=e;return n instanceof In&&(n=n.value()),mt(t,(function(e,t){return t.func.apply(t.thisArg,pt([e],t.args))}),n)}function ii(e,t,n){var i=e.length;if(i<2)return i?Qr(e[0]):[];for(var o=-1,a=r(i);++o<i;)for(var s=e[o],l=-1;++l<i;)l!=o&&(a[o]=er(a[o]||s,e[l],t,n));return Qr(ar(a,1),t,n)}function oi(e,t,n){for(var r=-1,i=e.length,o=t.length,a={};++r<i;){var s=r<o?t[r]:void 0;n(a,e[r],s)}return a}function ai(e){return Ba(e)?e:[]}function si(e){return"function"==typeof e?e:Xs}function li(e,t){return Na(e)?e:co(e,t)?[e]:To(ls(e))}var ci=Fr;function ui(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:qr(e,t,n)}var hi=Tt||function(e){return Xe.clearTimeout(e)};function fi(e,t){if(t)return e.slice();var n=e.length,r=De?De(n):new e.constructor(n);return e.copy(r),r}function di(e){var t=new e.constructor(e.byteLength);return new Ne(t).set(new Ne(e)),t}function pi(e,t){var n=t?di(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function mi(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e==e,o=Ka(e),a=void 0!==t,s=null===t,l=t==t,c=Ka(t);if(!s&&!c&&!o&&e>t||o&&a&&l&&!s&&!c||r&&a&&l||!n&&l||!i)return 1;if(!r&&!o&&!c&&e<t||c&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!l)return-1}return 0}function vi(e,t,n,i){for(var o=-1,a=e.length,s=n.length,l=-1,c=t.length,u=sn(a-s,0),h=r(c+u),f=!i;++l<c;)h[l]=t[l];for(;++o<s;)(f||o<a)&&(h[n[o]]=e[o]);for(;u--;)h[l++]=e[o++];return h}function gi(e,t,n,i){for(var o=-1,a=e.length,s=-1,l=n.length,c=-1,u=t.length,h=sn(a-l,0),f=r(h+u),d=!i;++o<h;)f[o]=e[o];for(var p=o;++c<u;)f[p+c]=t[c];for(;++s<l;)(d||o<a)&&(f[p+n[s]]=e[o++]);return f}function yi(e,t){var n=-1,i=e.length;for(t||(t=r(i));++n<i;)t[n]=e[n];return t}function _i(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),i?Yn(n,s,l):jn(n,s,l)}return n}function xi(e,t){return function(n,r){var i=Na(n)?at:qn,o=t?t():{};return i(n,e,Ji(r,2),o)}}function bi(e){return Fr((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&lo(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=pe(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))}function wi(e,t){return function(n,r){if(null==n)return n;if(!Da(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=pe(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function Si(e){return function(t,n,r){for(var i=-1,o=pe(t),a=r(t),s=a.length;s--;){var l=a[e?s:++i];if(!1===n(o[l],l,o))break}return t}}function Mi(e){return function(t){var n=Vt(t=ls(t))?Xt(t):void 0,r=n?n[0]:t.charAt(0),i=n?ui(n,1).join(""):t.slice(1);return r[e]()+i}}function Ei(e){return function(t){return mt(Us(Is(t).replace(ke,"")),e,"")}}function Ti(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Pn(e.prototype),r=e.apply(n,t);return ja(r)?r:n}}function Ai(e){return function(t,n,r){var i=pe(t);if(!Da(t)){var o=Ji(n,3);t=bs(t),n=function(e){return o(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[o?t[a]:a]:void 0}}function Ci(e){return Wi((function(t){var n=t.length,r=n,i=kn.prototype.thru;for(e&&t.reverse();r--;){var a=t[r];if("function"!=typeof a)throw new ge(o);if(i&&!s&&"wrapper"==Zi(a))var s=new kn([],!0)}for(r=s?r:n;++r<n;){var l=Zi(a=t[r]),c="wrapper"==l?Yi(a):void 0;s=c&&uo(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?s[Zi(c[0])].apply(s,c[3]):1==a.length&&uo(a)?s[l]():s.thru(a)}return function(){var e=arguments,r=e[0];if(s&&1==e.length&&Na(r))return s.plant(r).value();for(var i=0,o=n?t[i].apply(this,e):r;++i<n;)o=t[i].call(this,o);return o}}))}function Ri(e,t,n,i,o,a,s,l,c,u){var h=128&t,f=1&t,d=2&t,p=24&t,m=512&t,v=d?void 0:Ti(e);return function g(){for(var y=arguments.length,_=r(y),x=y;x--;)_[x]=arguments[x];if(p)var b=$i(g),w=Dt(_,b);if(i&&(_=vi(_,i,o,p)),a&&(_=gi(_,a,s,p)),y-=w,p&&y<u){var S=Ht(_,b);return Di(e,t,Ri,g.placeholder,n,_,S,l,c,u-y)}var M=f?n:this,E=d?M[e]:e;return y=_.length,l?_=yo(_,l):m&&y>1&&_.reverse(),h&&c<y&&(_.length=c),this&&this!==Xe&&this instanceof g&&(E=v||Ti(E)),E.apply(M,_)}}function Pi(e,t){return function(n,r){return function(e,t,n,r){return cr(e,(function(e,i,o){t(r,n(e),i,o)})),r}(n,e,t(r),{})}}function Li(e,t){return function(n,r){var i;if(void 0===n&&void 0===r)return t;if(void 0!==n&&(i=n),void 0!==r){if(void 0===i)return r;"string"==typeof n||"string"==typeof r?(n=Kr(n),r=Kr(r)):(n=Jr(n),r=Jr(r)),i=e(n,r)}return i}}function ki(e){return Wi((function(t){return t=dt(t,Lt(Ji())),Fr((function(n){var r=this;return e(t,(function(e){return ot(e,r,n)}))}))}))}function Ii(e,t){var n=(t=void 0===t?" ":Kr(t)).length;if(n<2)return n?zr(t,e):t;var r=zr(t,Qt(e/qt(t)));return Vt(t)?ui(Xt(r),0,e).join(""):r.slice(0,e)}function Ni(e){return function(t,n,i){return i&&"number"!=typeof i&&lo(t,n,i)&&(n=i=void 0),t=rs(t),void 0===n?(n=t,t=0):n=rs(n),function(e,t,n,i){for(var o=-1,a=sn(Qt((t-e)/(n||1)),0),s=r(a);a--;)s[i?a:++o]=e,e+=n;return s}(t,n,i=void 0===i?t<n?1:-1:rs(i),e)}}function Oi(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=as(t),n=as(n)),e(t,n)}}function Di(e,t,n,r,i,o,a,s,l,c){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var h=[e,t,i,u?o:void 0,u?a:void 0,u?void 0:o,u?void 0:a,s,l,c],f=n.apply(void 0,h);return uo(e)&&xo(f,h),f.placeholder=r,So(f,e,t)}function Bi(e){var t=de[e];return function(e,n){if(e=as(e),(n=null==n?0:ln(is(n),292))&&rn(e)){var r=(ls(e)+"e").split("e");return+((r=(ls(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var zi=vn&&1/jt(new vn([,-0]))[1]==1/0?function(e){return new vn(e)}:Ks;function Fi(e){return function(t){var n=ro(t);return n==m?Ut(t):n==_?Wt(t):function(e,t){return dt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Vi(e,t,n,i,s,l,c,u){var h=2&t;if(!h&&"function"!=typeof e)throw new ge(o);var f=i?i.length:0;if(f||(t&=-97,i=s=void 0),c=void 0===c?c:sn(is(c),0),u=void 0===u?u:is(u),f-=s?s.length:0,64&t){var d=i,p=s;i=s=void 0}var m=h?void 0:Yi(e),v=[e,t,n,i,s,d,p,l,c,u];if(m&&function(e,t){var n=e[1],r=t[1],i=n|r,o=i<131,s=128==r&&8==n||128==r&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!o&&!s)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var l=t[3];if(l){var c=e[3];e[3]=c?vi(c,l,t[4]):l,e[4]=c?Ht(e[3],a):t[4]}(l=t[5])&&(c=e[5],e[5]=c?gi(c,l,t[6]):l,e[6]=c?Ht(e[5],a):t[6]);(l=t[7])&&(e[7]=l);128&r&&(e[8]=null==e[8]?t[8]:ln(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=i}(v,m),e=v[0],t=v[1],n=v[2],i=v[3],s=v[4],!(u=v[9]=void 0===v[9]?h?0:e.length:sn(v[9]-f,0))&&24&t&&(t&=-25),t&&1!=t)g=8==t||16==t?function(e,t,n){var i=Ti(e);return function o(){for(var a=arguments.length,s=r(a),l=a,c=$i(o);l--;)s[l]=arguments[l];var u=a<3&&s[0]!==c&&s[a-1]!==c?[]:Ht(s,c);if((a-=u.length)<n)return Di(e,t,Ri,o.placeholder,void 0,s,u,void 0,void 0,n-a);var h=this&&this!==Xe&&this instanceof o?i:e;return ot(h,this,s)}}(e,t,u):32!=t&&33!=t||s.length?Ri.apply(void 0,v):function(e,t,n,i){var o=1&t,a=Ti(e);return function t(){for(var s=-1,l=arguments.length,c=-1,u=i.length,h=r(u+l),f=this&&this!==Xe&&this instanceof t?a:e;++c<u;)h[c]=i[c];for(;l--;)h[c++]=arguments[++s];return ot(f,o?n:this,h)}}(e,t,n,i);else var g=function(e,t,n){var r=1&t,i=Ti(e);return function t(){var o=this&&this!==Xe&&this instanceof t?i:e;return o.apply(r?n:this,arguments)}}(e,t,n);return So((m?Hr:xo)(g,v),e,t)}function Ui(e,t,n,r){return void 0===e||Pa(e,xe[n])&&!Se.call(r,n)?t:e}function Gi(e,t,n,r,i,o){return ja(e)&&ja(t)&&(o.set(t,e),Lr(e,t,void 0,Gi,o),o.delete(t)),e}function Hi(e){return Ya(e)?void 0:e}function ji(e,t,n,r,i,o){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var c=o.get(e),u=o.get(t);if(c&&u)return c==t&&u==e;var h=-1,f=!0,d=2&n?new Bn:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var p=e[h],m=t[h];if(r)var v=a?r(m,p,h,t,e,o):r(p,m,h,e,t,o);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!gt(t,(function(e,t){if(!It(d,t)&&(p===e||i(p,e,n,r,o)))return d.push(t)}))){f=!1;break}}else if(p!==m&&!i(p,m,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f}function Wi(e){return wo(vo(e,void 0,Oo),e+"")}function qi(e){return dr(e,bs,to)}function Xi(e){return dr(e,ws,no)}var Yi=_n?function(e){return _n.get(e)}:Ks;function Zi(e){for(var t=e.name+"",n=xn[t],r=Se.call(xn,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function $i(e){return(Se.call(Rn,"placeholder")?Rn:e).placeholder}function Ji(){var e=Rn.iteratee||Ys;return e=e===Ys?Mr:e,arguments.length?e(arguments[0],arguments[1]):e}function Ki(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Qi(e){for(var t=bs(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,po(i)]}return t}function eo(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Sr(n)?n:void 0}var to=tn?function(e){return null==e?[]:(e=pe(e),ut(tn(e),(function(t){return qe.call(e,t)})))}:ol,no=tn?function(e){for(var t=[];e;)pt(t,to(e)),e=Ge(e);return t}:ol,ro=pr;function io(e,t,n){for(var r=-1,i=(t=li(t,e)).length,o=!1;++r<i;){var a=Ao(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Ha(i)&&so(a,i)&&(Na(e)||Ia(e))}function oo(e){return"function"!=typeof e.constructor||fo(e)?{}:Pn(Ge(e))}function ao(e){return Na(e)||Ia(e)||!!(Ze&&e&&e[Ze])}function so(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&le.test(e))&&e>-1&&e%1==0&&e<t}function lo(e,t,n){if(!ja(n))return!1;var r=typeof t;return!!("number"==r?Da(n)&&so(t,n.length):"string"==r&&t in n)&&Pa(n[t],e)}function co(e,t){if(Na(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ka(e))||(j.test(e)||!H.test(e)||null!=t&&e in pe(t))}function uo(e){var t=Zi(e),n=Rn[t];if("function"!=typeof n||!(t in In.prototype))return!1;if(e===n)return!0;var r=Yi(n);return!!r&&e===r[0]}(dn&&ro(new dn(new ArrayBuffer(1)))!=M||pn&&ro(new pn)!=m||mn&&"[object Promise]"!=ro(mn.resolve())||vn&&ro(new vn)!=_||gn&&ro(new gn)!=w)&&(ro=function(e){var t=pr(e),n=t==g?e.constructor:void 0,r=n?Co(n):"";if(r)switch(r){case bn:return M;case wn:return m;case Sn:return"[object Promise]";case Mn:return _;case En:return w}return t});var ho=be?Ua:al;function fo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||xe)}function po(e){return e==e&&!ja(e)}function mo(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in pe(n)))}}function vo(e,t,n){return t=sn(void 0===t?e.length-1:t,0),function(){for(var i=arguments,o=-1,a=sn(i.length-t,0),s=r(a);++o<a;)s[o]=i[t+o];o=-1;for(var l=r(t+1);++o<t;)l[o]=i[o];return l[t]=n(s),ot(e,this,l)}}function go(e,t){return t.length<2?e:fr(e,qr(t,0,-1))}function yo(e,t){for(var n=e.length,r=ln(t.length,n),i=yi(e);r--;){var o=t[r];e[r]=so(o,n)?i[o]:void 0}return e}function _o(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var xo=Mo(Hr),bo=Kt||function(e,t){return Xe.setTimeout(e,t)},wo=Mo(jr);function So(e,t,n){var r=t+"";return wo(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace($,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return st(s,(function(n){var r="_."+n[0];t&n[1]&&!ht(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(J);return t?t[1].split(K):[]}(r),n)))}function Mo(e){var t=0,n=0;return function(){var r=cn(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Eo(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=Br(n,i),a=e[o];e[o]=e[n],e[n]=a}return e.length=t,e}var To=function(e){var t=Ma(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(W,(function(e,n,r,i){t.push(r?i.replace(te,"$1"):n||e)})),t}));function Ao(e){if("string"==typeof e||Ka(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Co(e){if(null!=e){try{return we.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ro(e){if(e instanceof In)return e.clone();var t=new kn(e.__wrapped__,e.__chain__);return t.__actions__=yi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Po=Fr((function(e,t){return Ba(e)?er(e,ar(t,1,Ba,!0)):[]})),Lo=Fr((function(e,t){var n=Vo(t);return Ba(n)&&(n=void 0),Ba(e)?er(e,ar(t,1,Ba,!0),Ji(n,2)):[]})),ko=Fr((function(e,t){var n=Vo(t);return Ba(n)&&(n=void 0),Ba(e)?er(e,ar(t,1,Ba,!0),void 0,n):[]}));function Io(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:is(n);return i<0&&(i=sn(r+i,0)),xt(e,Ji(t,3),i)}function No(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return void 0!==n&&(i=is(n),i=n<0?sn(r+i,0):ln(i,r-1)),xt(e,Ji(t,3),i,!0)}function Oo(e){return(null==e?0:e.length)?ar(e,1):[]}function Do(e){return e&&e.length?e[0]:void 0}var Bo=Fr((function(e){var t=dt(e,ai);return t.length&&t[0]===e[0]?yr(t):[]})),zo=Fr((function(e){var t=Vo(e),n=dt(e,ai);return t===Vo(n)?t=void 0:n.pop(),n.length&&n[0]===e[0]?yr(n,Ji(t,2)):[]})),Fo=Fr((function(e){var t=Vo(e),n=dt(e,ai);return(t="function"==typeof t?t:void 0)&&n.pop(),n.length&&n[0]===e[0]?yr(n,void 0,t):[]}));function Vo(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Uo=Fr(Go);function Go(e,t){return e&&e.length&&t&&t.length?Or(e,t):e}var Ho=Wi((function(e,t){var n=null==e?0:e.length,r=Zn(e,t);return Dr(e,dt(t,(function(e){return so(e,n)?+e:e})).sort(mi)),r}));function jo(e){return null==e?e:fn.call(e)}var Wo=Fr((function(e){return Qr(ar(e,1,Ba,!0))})),qo=Fr((function(e){var t=Vo(e);return Ba(t)&&(t=void 0),Qr(ar(e,1,Ba,!0),Ji(t,2))})),Xo=Fr((function(e){var t=Vo(e);return t="function"==typeof t?t:void 0,Qr(ar(e,1,Ba,!0),void 0,t)}));function Yo(e){if(!e||!e.length)return[];var t=0;return e=ut(e,(function(e){if(Ba(e))return t=sn(e.length,t),!0})),Rt(t,(function(t){return dt(e,Et(t))}))}function Zo(e,t){if(!e||!e.length)return[];var n=Yo(e);return null==t?n:dt(n,(function(e){return ot(t,void 0,e)}))}var $o=Fr((function(e,t){return Ba(e)?er(e,t):[]})),Jo=Fr((function(e){return ii(ut(e,Ba))})),Ko=Fr((function(e){var t=Vo(e);return Ba(t)&&(t=void 0),ii(ut(e,Ba),Ji(t,2))})),Qo=Fr((function(e){var t=Vo(e);return t="function"==typeof t?t:void 0,ii(ut(e,Ba),void 0,t)})),ea=Fr(Yo);var ta=Fr((function(e){var t=e.length,n=t>1?e[t-1]:void 0;return n="function"==typeof n?(e.pop(),n):void 0,Zo(e,n)}));function na(e){var t=Rn(e);return t.__chain__=!0,t}function ra(e,t){return t(e)}var ia=Wi((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,i=function(t){return Zn(t,e)};return!(t>1||this.__actions__.length)&&r instanceof In&&so(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:ra,args:[i],thisArg:void 0}),new kn(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(i)}));var oa=xi((function(e,t,n){Se.call(e,n)?++e[n]:Yn(e,n,1)}));var aa=Ai(Io),sa=Ai(No);function la(e,t){return(Na(e)?st:tr)(e,Ji(t,3))}function ca(e,t){return(Na(e)?lt:nr)(e,Ji(t,3))}var ua=xi((function(e,t,n){Se.call(e,n)?e[n].push(t):Yn(e,n,[t])}));var ha=Fr((function(e,t,n){var i=-1,o="function"==typeof t,a=Da(e)?r(e.length):[];return tr(e,(function(e){a[++i]=o?ot(t,e,n):_r(e,t,n)})),a})),fa=xi((function(e,t,n){Yn(e,n,t)}));function da(e,t){return(Na(e)?dt:Cr)(e,Ji(t,3))}var pa=xi((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));var ma=Fr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&lo(e,t[0],t[1])?t=[]:n>2&&lo(t[0],t[1],t[2])&&(t=[t[0]]),Ir(e,ar(t,1),[])})),va=Jt||function(){return Xe.Date.now()};function ga(e,t,n){return t=n?void 0:t,Vi(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}function ya(e,t){var n;if("function"!=typeof t)throw new ge(o);return e=is(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}var _a=Fr((function(e,t,n){var r=1;if(n.length){var i=Ht(n,$i(_a));r|=32}return Vi(e,r,t,n,i)})),xa=Fr((function(e,t,n){var r=3;if(n.length){var i=Ht(n,$i(xa));r|=32}return Vi(t,r,e,n,i)}));function ba(e,t,n){var r,i,a,s,l,c,u=0,h=!1,f=!1,d=!0;if("function"!=typeof e)throw new ge(o);function p(t){var n=r,o=i;return r=i=void 0,u=t,s=e.apply(o,n)}function m(e){return u=e,l=bo(g,t),h?p(e):s}function v(e){var n=e-c;return void 0===c||n>=t||n<0||f&&e-u>=a}function g(){var e=va();if(v(e))return y(e);l=bo(g,function(e){var n=t-(e-c);return f?ln(n,a-(e-u)):n}(e))}function y(e){return l=void 0,d&&r?p(e):(r=i=void 0,s)}function _(){var e=va(),n=v(e);if(r=arguments,i=this,c=e,n){if(void 0===l)return m(c);if(f)return hi(l),l=bo(g,t),p(c)}return void 0===l&&(l=bo(g,t)),s}return t=as(t)||0,ja(n)&&(h=!!n.leading,a=(f="maxWait"in n)?sn(as(n.maxWait)||0,t):a,d="trailing"in n?!!n.trailing:d),_.cancel=function(){void 0!==l&&hi(l),u=0,r=c=i=l=void 0},_.flush=function(){return void 0===l?s:y(va())},_}var wa=Fr((function(e,t){return Qn(e,1,t)})),Sa=Fr((function(e,t,n){return Qn(e,as(t)||0,n)}));function Ma(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new ge(o);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Ma.Cache||Dn),n}function Ea(e){if("function"!=typeof e)throw new ge(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ma.Cache=Dn;var Ta=ci((function(e,t){var n=(t=1==t.length&&Na(t[0])?dt(t[0],Lt(Ji())):dt(ar(t,1),Lt(Ji()))).length;return Fr((function(r){for(var i=-1,o=ln(r.length,n);++i<o;)r[i]=t[i].call(this,r[i]);return ot(e,this,r)}))})),Aa=Fr((function(e,t){return Vi(e,32,void 0,t,Ht(t,$i(Aa)))})),Ca=Fr((function(e,t){return Vi(e,64,void 0,t,Ht(t,$i(Ca)))})),Ra=Wi((function(e,t){return Vi(e,256,void 0,void 0,void 0,t)}));function Pa(e,t){return e===t||e!=e&&t!=t}var La=Oi(mr),ka=Oi((function(e,t){return e>=t})),Ia=xr(function(){return arguments}())?xr:function(e){return Wa(e)&&Se.call(e,"callee")&&!qe.call(e,"callee")},Na=r.isArray,Oa=Qe?Lt(Qe):function(e){return Wa(e)&&pr(e)==S};function Da(e){return null!=e&&Ha(e.length)&&!Ua(e)}function Ba(e){return Wa(e)&&Da(e)}var za=nn||al,Fa=et?Lt(et):function(e){return Wa(e)&&pr(e)==h};function Va(e){if(!Wa(e))return!1;var t=pr(e);return t==f||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Ya(e)}function Ua(e){if(!ja(e))return!1;var t=pr(e);return t==d||t==p||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ga(e){return"number"==typeof e&&e==is(e)}function Ha(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function ja(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Wa(e){return null!=e&&"object"==typeof e}var qa=tt?Lt(tt):function(e){return Wa(e)&&ro(e)==m};function Xa(e){return"number"==typeof e||Wa(e)&&pr(e)==v}function Ya(e){if(!Wa(e)||pr(e)!=g)return!1;var t=Ge(e);if(null===t)return!0;var n=Se.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&we.call(n)==Ae}var Za=nt?Lt(nt):function(e){return Wa(e)&&pr(e)==y};var $a=rt?Lt(rt):function(e){return Wa(e)&&ro(e)==_};function Ja(e){return"string"==typeof e||!Na(e)&&Wa(e)&&pr(e)==x}function Ka(e){return"symbol"==typeof e||Wa(e)&&pr(e)==b}var Qa=it?Lt(it):function(e){return Wa(e)&&Ha(e.length)&&!!Ve[pr(e)]};var es=Oi(Ar),ts=Oi((function(e,t){return e<=t}));function ns(e){if(!e)return[];if(Da(e))return Ja(e)?Xt(e):yi(e);if(Je&&e[Je])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Je]());var t=ro(e);return(t==m?Ut:t==_?jt:Ps)(e)}function rs(e){return e?(e=as(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function is(e){var t=rs(e),n=t%1;return t==t?n?t-n:t:0}function os(e){return e?$n(is(e),0,4294967295):0}function as(e){if("number"==typeof e)return e;if(Ka(e))return NaN;if(ja(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ja(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Pt(e);var n=oe.test(e);return n||se.test(e)?je(e.slice(2),n?2:8):ie.test(e)?NaN:+e}function ss(e){return _i(e,ws(e))}function ls(e){return null==e?"":Kr(e)}var cs=bi((function(e,t){if(fo(t)||Da(t))_i(t,bs(t),e);else for(var n in t)Se.call(t,n)&&jn(e,n,t[n])})),us=bi((function(e,t){_i(t,ws(t),e)})),hs=bi((function(e,t,n,r){_i(t,ws(t),e,r)})),fs=bi((function(e,t,n,r){_i(t,bs(t),e,r)})),ds=Wi(Zn);var ps=Fr((function(e,t){e=pe(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&lo(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=ws(o),s=-1,l=a.length;++s<l;){var c=a[s],u=e[c];(void 0===u||Pa(u,xe[c])&&!Se.call(e,c))&&(e[c]=o[c])}return e})),ms=Fr((function(e){return e.push(void 0,Gi),ot(Ms,void 0,e)}));function vs(e,t,n){var r=null==e?void 0:fr(e,t);return void 0===r?n:r}function gs(e,t){return null!=e&&io(e,t,gr)}var ys=Pi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Te.call(t)),e[t]=n}),js(Xs)),_s=Pi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Te.call(t)),Se.call(e,t)?e[t].push(n):e[t]=[n]}),Ji),xs=Fr(_r);function bs(e){return Da(e)?Fn(e):Er(e)}function ws(e){return Da(e)?Fn(e,!0):Tr(e)}var Ss=bi((function(e,t,n){Lr(e,t,n)})),Ms=bi((function(e,t,n,r){Lr(e,t,n,r)})),Es=Wi((function(e,t){var n={};if(null==e)return n;var r=!1;t=dt(t,(function(t){return t=li(t,e),r||(r=t.length>1),t})),_i(e,Xi(e),n),r&&(n=Jn(n,7,Hi));for(var i=t.length;i--;)ei(n,t[i]);return n}));var Ts=Wi((function(e,t){return null==e?{}:function(e,t){return Nr(e,t,(function(t,n){return gs(e,n)}))}(e,t)}));function As(e,t){if(null==e)return{};var n=dt(Xi(e),(function(e){return[e]}));return t=Ji(t),Nr(e,n,(function(e,n){return t(e,n[0])}))}var Cs=Fi(bs),Rs=Fi(ws);function Ps(e){return null==e?[]:kt(e,bs(e))}var Ls=Ei((function(e,t,n){return t=t.toLowerCase(),e+(n?ks(t):t)}));function ks(e){return Vs(ls(e).toLowerCase())}function Is(e){return(e=ls(e))&&e.replace(ce,Bt).replace(Ie,"")}var Ns=Ei((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Os=Ei((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Ds=Mi("toLowerCase");var Bs=Ei((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var zs=Ei((function(e,t,n){return e+(n?" ":"")+Vs(t)}));var Fs=Ei((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Vs=Mi("toUpperCase");function Us(e,t,n){return e=ls(e),void 0===(t=n?void 0:t)?function(e){return Be.test(e)}(e)?function(e){return e.match(Oe)||[]}(e):function(e){return e.match(Q)||[]}(e):e.match(t)||[]}var Gs=Fr((function(e,t){try{return ot(e,void 0,t)}catch(e){return Va(e)?e:new Z(e)}})),Hs=Wi((function(e,t){return st(t,(function(t){t=Ao(t),Yn(e,t,_a(e[t],e))})),e}));function js(e){return function(){return e}}var Ws=Ci(),qs=Ci(!0);function Xs(e){return e}function Ys(e){return Mr("function"==typeof e?e:Jn(e,1))}var Zs=Fr((function(e,t){return function(n){return _r(n,e,t)}})),$s=Fr((function(e,t){return function(n){return _r(e,n,t)}}));function Js(e,t,n){var r=bs(t),i=hr(t,r);null!=n||ja(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=hr(t,bs(t)));var o=!(ja(n)&&"chain"in n&&!n.chain),a=Ua(e);return st(i,(function(n){var r=t[n];e[n]=r,a&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__),i=n.__actions__=yi(this.__actions__);return i.push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,pt([this.value()],arguments))})})),e}function Ks(){}var Qs=ki(dt),el=ki(ct),tl=ki(gt);function nl(e){return co(e)?Et(Ao(e)):function(e){return function(t){return fr(t,e)}}(e)}var rl=Ni(),il=Ni(!0);function ol(){return[]}function al(){return!1}var sl=Li((function(e,t){return e+t}),0),ll=Bi("ceil"),cl=Li((function(e,t){return e/t}),1),ul=Bi("floor");var hl,fl=Li((function(e,t){return e*t}),1),dl=Bi("round"),pl=Li((function(e,t){return e-t}),0);return Rn.after=function(e,t){if("function"!=typeof t)throw new ge(o);return e=is(e),function(){if(--e<1)return t.apply(this,arguments)}},Rn.ary=ga,Rn.assign=cs,Rn.assignIn=us,Rn.assignInWith=hs,Rn.assignWith=fs,Rn.at=ds,Rn.before=ya,Rn.bind=_a,Rn.bindAll=Hs,Rn.bindKey=xa,Rn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Na(e)?e:[e]},Rn.chain=na,Rn.chunk=function(e,t,n){t=(n?lo(e,t,n):void 0===t)?1:sn(is(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var o=0,a=0,s=r(Qt(i/t));o<i;)s[a++]=qr(e,o,o+=t);return s},Rn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},Rn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return pt(Na(n)?yi(n):[n],ar(t,1))},Rn.cond=function(e){var t=null==e?0:e.length,n=Ji();return e=t?dt(e,(function(e){if("function"!=typeof e[1])throw new ge(o);return[n(e[0]),e[1]]})):[],Fr((function(n){for(var r=-1;++r<t;){var i=e[r];if(ot(i[0],this,n))return ot(i[1],this,n)}}))},Rn.conforms=function(e){return function(e){var t=bs(e);return function(n){return Kn(n,e,t)}}(Jn(e,1))},Rn.constant=js,Rn.countBy=oa,Rn.create=function(e,t){var n=Pn(e);return null==t?n:Xn(n,t)},Rn.curry=function e(t,n,r){var i=Vi(t,8,void 0,void 0,void 0,void 0,void 0,n=r?void 0:n);return i.placeholder=e.placeholder,i},Rn.curryRight=function e(t,n,r){var i=Vi(t,16,void 0,void 0,void 0,void 0,void 0,n=r?void 0:n);return i.placeholder=e.placeholder,i},Rn.debounce=ba,Rn.defaults=ps,Rn.defaultsDeep=ms,Rn.defer=wa,Rn.delay=Sa,Rn.difference=Po,Rn.differenceBy=Lo,Rn.differenceWith=ko,Rn.drop=function(e,t,n){var r=null==e?0:e.length;return r?qr(e,(t=n||void 0===t?1:is(t))<0?0:t,r):[]},Rn.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?qr(e,0,(t=r-(t=n||void 0===t?1:is(t)))<0?0:t):[]},Rn.dropRightWhile=function(e,t){return e&&e.length?ni(e,Ji(t,3),!0,!0):[]},Rn.dropWhile=function(e,t){return e&&e.length?ni(e,Ji(t,3),!0):[]},Rn.fill=function(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&lo(e,t,n)&&(n=0,r=i),function(e,t,n,r){var i=e.length;for((n=is(n))<0&&(n=-n>i?0:i+n),(r=void 0===r||r>i?i:is(r))<0&&(r+=i),r=n>r?0:os(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},Rn.filter=function(e,t){return(Na(e)?ut:or)(e,Ji(t,3))},Rn.flatMap=function(e,t){return ar(da(e,t),1)},Rn.flatMapDeep=function(e,t){return ar(da(e,t),1/0)},Rn.flatMapDepth=function(e,t,n){return n=void 0===n?1:is(n),ar(da(e,t),n)},Rn.flatten=Oo,Rn.flattenDeep=function(e){return(null==e?0:e.length)?ar(e,1/0):[]},Rn.flattenDepth=function(e,t){return(null==e?0:e.length)?ar(e,t=void 0===t?1:is(t)):[]},Rn.flip=function(e){return Vi(e,512)},Rn.flow=Ws,Rn.flowRight=qs,Rn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},Rn.functions=function(e){return null==e?[]:hr(e,bs(e))},Rn.functionsIn=function(e){return null==e?[]:hr(e,ws(e))},Rn.groupBy=ua,Rn.initial=function(e){return(null==e?0:e.length)?qr(e,0,-1):[]},Rn.intersection=Bo,Rn.intersectionBy=zo,Rn.intersectionWith=Fo,Rn.invert=ys,Rn.invertBy=_s,Rn.invokeMap=ha,Rn.iteratee=Ys,Rn.keyBy=fa,Rn.keys=bs,Rn.keysIn=ws,Rn.map=da,Rn.mapKeys=function(e,t){var n={};return t=Ji(t,3),cr(e,(function(e,r,i){Yn(n,t(e,r,i),e)})),n},Rn.mapValues=function(e,t){var n={};return t=Ji(t,3),cr(e,(function(e,r,i){Yn(n,r,t(e,r,i))})),n},Rn.matches=function(e){return Rr(Jn(e,1))},Rn.matchesProperty=function(e,t){return Pr(e,Jn(t,1))},Rn.memoize=Ma,Rn.merge=Ss,Rn.mergeWith=Ms,Rn.method=Zs,Rn.methodOf=$s,Rn.mixin=Js,Rn.negate=Ea,Rn.nthArg=function(e){return e=is(e),Fr((function(t){return kr(t,e)}))},Rn.omit=Es,Rn.omitBy=function(e,t){return As(e,Ea(Ji(t)))},Rn.once=function(e){return ya(2,e)},Rn.orderBy=function(e,t,n,r){return null==e?[]:(Na(t)||(t=null==t?[]:[t]),Na(n=r?void 0:n)||(n=null==n?[]:[n]),Ir(e,t,n))},Rn.over=Qs,Rn.overArgs=Ta,Rn.overEvery=el,Rn.overSome=tl,Rn.partial=Aa,Rn.partialRight=Ca,Rn.partition=pa,Rn.pick=Ts,Rn.pickBy=As,Rn.property=nl,Rn.propertyOf=function(e){return function(t){return null==e?void 0:fr(e,t)}},Rn.pull=Uo,Rn.pullAll=Go,Rn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Or(e,t,Ji(n,2)):e},Rn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Or(e,t,void 0,n):e},Rn.pullAt=Ho,Rn.range=rl,Rn.rangeRight=il,Rn.rearg=Ra,Rn.reject=function(e,t){return(Na(e)?ut:or)(e,Ea(Ji(t,3)))},Rn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=Ji(t,3);++r<o;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return Dr(e,i),n},Rn.rest=function(e,t){if("function"!=typeof e)throw new ge(o);return Fr(e,t=void 0===t?t:is(t))},Rn.reverse=jo,Rn.sampleSize=function(e,t,n){return t=(n?lo(e,t,n):void 0===t)?1:is(t),(Na(e)?Un:Ur)(e,t)},Rn.set=function(e,t,n){return null==e?e:Gr(e,t,n)},Rn.setWith=function(e,t,n,r){return r="function"==typeof r?r:void 0,null==e?e:Gr(e,t,n,r)},Rn.shuffle=function(e){return(Na(e)?Gn:Wr)(e)},Rn.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&lo(e,t,n)?(t=0,n=r):(t=null==t?0:is(t),n=void 0===n?r:is(n)),qr(e,t,n)):[]},Rn.sortBy=ma,Rn.sortedUniq=function(e){return e&&e.length?$r(e):[]},Rn.sortedUniqBy=function(e,t){return e&&e.length?$r(e,Ji(t,2)):[]},Rn.split=function(e,t,n){return n&&"number"!=typeof n&&lo(e,t,n)&&(t=n=void 0),(n=void 0===n?4294967295:n>>>0)?(e=ls(e))&&("string"==typeof t||null!=t&&!Za(t))&&!(t=Kr(t))&&Vt(e)?ui(Xt(e),0,n):e.split(t,n):[]},Rn.spread=function(e,t){if("function"!=typeof e)throw new ge(o);return t=null==t?0:sn(is(t),0),Fr((function(n){var r=n[t],i=ui(n,0,t);return r&&pt(i,r),ot(e,this,i)}))},Rn.tail=function(e){var t=null==e?0:e.length;return t?qr(e,1,t):[]},Rn.take=function(e,t,n){return e&&e.length?qr(e,0,(t=n||void 0===t?1:is(t))<0?0:t):[]},Rn.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?qr(e,(t=r-(t=n||void 0===t?1:is(t)))<0?0:t,r):[]},Rn.takeRightWhile=function(e,t){return e&&e.length?ni(e,Ji(t,3),!1,!0):[]},Rn.takeWhile=function(e,t){return e&&e.length?ni(e,Ji(t,3)):[]},Rn.tap=function(e,t){return t(e),e},Rn.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new ge(o);return ja(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),ba(e,t,{leading:r,maxWait:t,trailing:i})},Rn.thru=ra,Rn.toArray=ns,Rn.toPairs=Cs,Rn.toPairsIn=Rs,Rn.toPath=function(e){return Na(e)?dt(e,Ao):Ka(e)?[e]:yi(To(ls(e)))},Rn.toPlainObject=ss,Rn.transform=function(e,t,n){var r=Na(e),i=r||za(e)||Qa(e);if(t=Ji(t,4),null==n){var o=e&&e.constructor;n=i?r?new o:[]:ja(e)&&Ua(o)?Pn(Ge(e)):{}}return(i?st:cr)(e,(function(e,r,i){return t(n,e,r,i)})),n},Rn.unary=function(e){return ga(e,1)},Rn.union=Wo,Rn.unionBy=qo,Rn.unionWith=Xo,Rn.uniq=function(e){return e&&e.length?Qr(e):[]},Rn.uniqBy=function(e,t){return e&&e.length?Qr(e,Ji(t,2)):[]},Rn.uniqWith=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?Qr(e,void 0,t):[]},Rn.unset=function(e,t){return null==e||ei(e,t)},Rn.unzip=Yo,Rn.unzipWith=Zo,Rn.update=function(e,t,n){return null==e?e:ti(e,t,si(n))},Rn.updateWith=function(e,t,n,r){return r="function"==typeof r?r:void 0,null==e?e:ti(e,t,si(n),r)},Rn.values=Ps,Rn.valuesIn=function(e){return null==e?[]:kt(e,ws(e))},Rn.without=$o,Rn.words=Us,Rn.wrap=function(e,t){return Aa(si(t),e)},Rn.xor=Jo,Rn.xorBy=Ko,Rn.xorWith=Qo,Rn.zip=ea,Rn.zipObject=function(e,t){return oi(e||[],t||[],jn)},Rn.zipObjectDeep=function(e,t){return oi(e||[],t||[],Gr)},Rn.zipWith=ta,Rn.entries=Cs,Rn.entriesIn=Rs,Rn.extend=us,Rn.extendWith=hs,Js(Rn,Rn),Rn.add=sl,Rn.attempt=Gs,Rn.camelCase=Ls,Rn.capitalize=ks,Rn.ceil=ll,Rn.clamp=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=as(n))==n?n:0),void 0!==t&&(t=(t=as(t))==t?t:0),$n(as(e),t,n)},Rn.clone=function(e){return Jn(e,4)},Rn.cloneDeep=function(e){return Jn(e,5)},Rn.cloneDeepWith=function(e,t){return Jn(e,5,t="function"==typeof t?t:void 0)},Rn.cloneWith=function(e,t){return Jn(e,4,t="function"==typeof t?t:void 0)},Rn.conformsTo=function(e,t){return null==t||Kn(e,t,bs(t))},Rn.deburr=Is,Rn.defaultTo=function(e,t){return null==e||e!=e?t:e},Rn.divide=cl,Rn.endsWith=function(e,t,n){e=ls(e),t=Kr(t);var r=e.length,i=n=void 0===n?r:$n(is(n),0,r);return(n-=t.length)>=0&&e.slice(n,i)==t},Rn.eq=Pa,Rn.escape=function(e){return(e=ls(e))&&F.test(e)?e.replace(B,zt):e},Rn.escapeRegExp=function(e){return(e=ls(e))&&X.test(e)?e.replace(q,"\\$&"):e},Rn.every=function(e,t,n){var r=Na(e)?ct:rr;return n&&lo(e,t,n)&&(t=void 0),r(e,Ji(t,3))},Rn.find=aa,Rn.findIndex=Io,Rn.findKey=function(e,t){return _t(e,Ji(t,3),cr)},Rn.findLast=sa,Rn.findLastIndex=No,Rn.findLastKey=function(e,t){return _t(e,Ji(t,3),ur)},Rn.floor=ul,Rn.forEach=la,Rn.forEachRight=ca,Rn.forIn=function(e,t){return null==e?e:sr(e,Ji(t,3),ws)},Rn.forInRight=function(e,t){return null==e?e:lr(e,Ji(t,3),ws)},Rn.forOwn=function(e,t){return e&&cr(e,Ji(t,3))},Rn.forOwnRight=function(e,t){return e&&ur(e,Ji(t,3))},Rn.get=vs,Rn.gt=La,Rn.gte=ka,Rn.has=function(e,t){return null!=e&&io(e,t,vr)},Rn.hasIn=gs,Rn.head=Do,Rn.identity=Xs,Rn.includes=function(e,t,n,r){e=Da(e)?e:Ps(e),n=n&&!r?is(n):0;var i=e.length;return n<0&&(n=sn(i+n,0)),Ja(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&bt(e,t,n)>-1},Rn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:is(n);return i<0&&(i=sn(r+i,0)),bt(e,t,i)},Rn.inRange=function(e,t,n){return t=rs(t),void 0===n?(n=t,t=0):n=rs(n),function(e,t,n){return e>=ln(t,n)&&e<sn(t,n)}(e=as(e),t,n)},Rn.invoke=xs,Rn.isArguments=Ia,Rn.isArray=Na,Rn.isArrayBuffer=Oa,Rn.isArrayLike=Da,Rn.isArrayLikeObject=Ba,Rn.isBoolean=function(e){return!0===e||!1===e||Wa(e)&&pr(e)==u},Rn.isBuffer=za,Rn.isDate=Fa,Rn.isElement=function(e){return Wa(e)&&1===e.nodeType&&!Ya(e)},Rn.isEmpty=function(e){if(null==e)return!0;if(Da(e)&&(Na(e)||"string"==typeof e||"function"==typeof e.splice||za(e)||Qa(e)||Ia(e)))return!e.length;var t=ro(e);if(t==m||t==_)return!e.size;if(fo(e))return!Er(e).length;for(var n in e)if(Se.call(e,n))return!1;return!0},Rn.isEqual=function(e,t){return br(e,t)},Rn.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===r?br(e,t,void 0,n):!!r},Rn.isError=Va,Rn.isFinite=function(e){return"number"==typeof e&&rn(e)},Rn.isFunction=Ua,Rn.isInteger=Ga,Rn.isLength=Ha,Rn.isMap=qa,Rn.isMatch=function(e,t){return e===t||wr(e,t,Qi(t))},Rn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:void 0,wr(e,t,Qi(t),n)},Rn.isNaN=function(e){return Xa(e)&&e!=+e},Rn.isNative=function(e){if(ho(e))throw new Z("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Sr(e)},Rn.isNil=function(e){return null==e},Rn.isNull=function(e){return null===e},Rn.isNumber=Xa,Rn.isObject=ja,Rn.isObjectLike=Wa,Rn.isPlainObject=Ya,Rn.isRegExp=Za,Rn.isSafeInteger=function(e){return Ga(e)&&e>=-9007199254740991&&e<=9007199254740991},Rn.isSet=$a,Rn.isString=Ja,Rn.isSymbol=Ka,Rn.isTypedArray=Qa,Rn.isUndefined=function(e){return void 0===e},Rn.isWeakMap=function(e){return Wa(e)&&ro(e)==w},Rn.isWeakSet=function(e){return Wa(e)&&"[object WeakSet]"==pr(e)},Rn.join=function(e,t){return null==e?"":on.call(e,t)},Rn.kebabCase=Ns,Rn.last=Vo,Rn.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return void 0!==n&&(i=(i=is(n))<0?sn(r+i,0):ln(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):xt(e,St,i,!0)},Rn.lowerCase=Os,Rn.lowerFirst=Ds,Rn.lt=es,Rn.lte=ts,Rn.max=function(e){return e&&e.length?ir(e,Xs,mr):void 0},Rn.maxBy=function(e,t){return e&&e.length?ir(e,Ji(t,2),mr):void 0},Rn.mean=function(e){return Mt(e,Xs)},Rn.meanBy=function(e,t){return Mt(e,Ji(t,2))},Rn.min=function(e){return e&&e.length?ir(e,Xs,Ar):void 0},Rn.minBy=function(e,t){return e&&e.length?ir(e,Ji(t,2),Ar):void 0},Rn.stubArray=ol,Rn.stubFalse=al,Rn.stubObject=function(){return{}},Rn.stubString=function(){return""},Rn.stubTrue=function(){return!0},Rn.multiply=fl,Rn.nth=function(e,t){return e&&e.length?kr(e,is(t)):void 0},Rn.noConflict=function(){return Xe._===this&&(Xe._=Ce),this},Rn.noop=Ks,Rn.now=va,Rn.pad=function(e,t,n){e=ls(e);var r=(t=is(t))?qt(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return Ii(en(i),n)+e+Ii(Qt(i),n)},Rn.padEnd=function(e,t,n){e=ls(e);var r=(t=is(t))?qt(e):0;return t&&r<t?e+Ii(t-r,n):e},Rn.padStart=function(e,t,n){e=ls(e);var r=(t=is(t))?qt(e):0;return t&&r<t?Ii(t-r,n)+e:e},Rn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),un(ls(e).replace(Y,""),t||0)},Rn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&lo(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=rs(e),void 0===t?(t=e,e=0):t=rs(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=hn();return ln(e+i*(t-e+He("1e-"+((i+"").length-1))),t)}return Br(e,t)},Rn.reduce=function(e,t,n){var r=Na(e)?mt:At,i=arguments.length<3;return r(e,Ji(t,4),n,i,tr)},Rn.reduceRight=function(e,t,n){var r=Na(e)?vt:At,i=arguments.length<3;return r(e,Ji(t,4),n,i,nr)},Rn.repeat=function(e,t,n){return t=(n?lo(e,t,n):void 0===t)?1:is(t),zr(ls(e),t)},Rn.replace=function(){var e=arguments,t=ls(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Rn.result=function(e,t,n){var r=-1,i=(t=li(t,e)).length;for(i||(i=1,e=void 0);++r<i;){var o=null==e?void 0:e[Ao(t[r])];void 0===o&&(r=i,o=n),e=Ua(o)?o.call(e):o}return e},Rn.round=dl,Rn.runInContext=e,Rn.sample=function(e){return(Na(e)?Vn:Vr)(e)},Rn.size=function(e){if(null==e)return 0;if(Da(e))return Ja(e)?qt(e):e.length;var t=ro(e);return t==m||t==_?e.size:Er(e).length},Rn.snakeCase=Bs,Rn.some=function(e,t,n){var r=Na(e)?gt:Xr;return n&&lo(e,t,n)&&(t=void 0),r(e,Ji(t,3))},Rn.sortedIndex=function(e,t){return Yr(e,t)},Rn.sortedIndexBy=function(e,t,n){return Zr(e,t,Ji(n,2))},Rn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=Yr(e,t);if(r<n&&Pa(e[r],t))return r}return-1},Rn.sortedLastIndex=function(e,t){return Yr(e,t,!0)},Rn.sortedLastIndexBy=function(e,t,n){return Zr(e,t,Ji(n,2),!0)},Rn.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var n=Yr(e,t,!0)-1;if(Pa(e[n],t))return n}return-1},Rn.startCase=zs,Rn.startsWith=function(e,t,n){return e=ls(e),n=null==n?0:$n(is(n),0,e.length),t=Kr(t),e.slice(n,n+t.length)==t},Rn.subtract=pl,Rn.sum=function(e){return e&&e.length?Ct(e,Xs):0},Rn.sumBy=function(e,t){return e&&e.length?Ct(e,Ji(t,2)):0},Rn.template=function(e,t,n){var r=Rn.templateSettings;n&&lo(e,t,n)&&(t=void 0),e=ls(e),t=hs({},t,r,Ui);var i,o,a=hs({},t.imports,r.imports,Ui),s=bs(a),l=kt(a,s),c=0,u=t.interpolate||ue,h="__p += '",f=me((t.escape||ue).source+"|"+u.source+"|"+(u===G?ne:ue).source+"|"+(t.evaluate||ue).source+"|$","g"),d="//# sourceURL="+(Se.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Fe+"]")+"\n";e.replace(f,(function(t,n,r,a,s,l){return r||(r=a),h+=e.slice(c,l).replace(he,Ft),n&&(i=!0,h+="' +\n__e("+n+") +\n'"),s&&(o=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=l+t.length,t})),h+="';\n";var p=Se.call(t,"variable")&&t.variable;if(p){if(ee.test(p))throw new Z("Invalid `variable` option passed into `_.template`")}else h="with (obj) {\n"+h+"\n}\n";h=(o?h.replace(I,""):h).replace(N,"$1").replace(O,"$1;"),h="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=Gs((function(){return fe(s,d+"return "+h).apply(void 0,l)}));if(m.source=h,Va(m))throw m;return m},Rn.times=function(e,t){if((e=is(e))<1||e>9007199254740991)return[];var n=4294967295,r=ln(e,4294967295);e-=4294967295;for(var i=Rt(r,t=Ji(t));++n<e;)t(n);return i},Rn.toFinite=rs,Rn.toInteger=is,Rn.toLength=os,Rn.toLower=function(e){return ls(e).toLowerCase()},Rn.toNumber=as,Rn.toSafeInteger=function(e){return e?$n(is(e),-9007199254740991,9007199254740991):0===e?e:0},Rn.toString=ls,Rn.toUpper=function(e){return ls(e).toUpperCase()},Rn.trim=function(e,t,n){if((e=ls(e))&&(n||void 0===t))return Pt(e);if(!e||!(t=Kr(t)))return e;var r=Xt(e),i=Xt(t);return ui(r,Nt(r,i),Ot(r,i)+1).join("")},Rn.trimEnd=function(e,t,n){if((e=ls(e))&&(n||void 0===t))return e.slice(0,Yt(e)+1);if(!e||!(t=Kr(t)))return e;var r=Xt(e);return ui(r,0,Ot(r,Xt(t))+1).join("")},Rn.trimStart=function(e,t,n){if((e=ls(e))&&(n||void 0===t))return e.replace(Y,"");if(!e||!(t=Kr(t)))return e;var r=Xt(e);return ui(r,Nt(r,Xt(t))).join("")},Rn.truncate=function(e,t){var n=30,r="...";if(ja(t)){var i="separator"in t?t.separator:i;n="length"in t?is(t.length):n,r="omission"in t?Kr(t.omission):r}var o=(e=ls(e)).length;if(Vt(e)){var a=Xt(e);o=a.length}if(n>=o)return e;var s=n-qt(r);if(s<1)return r;var l=a?ui(a,0,s).join(""):e.slice(0,s);if(void 0===i)return l+r;if(a&&(s+=l.length-s),Za(i)){if(e.slice(s).search(i)){var c,u=l;for(i.global||(i=me(i.source,ls(re.exec(i))+"g")),i.lastIndex=0;c=i.exec(u);)var h=c.index;l=l.slice(0,void 0===h?s:h)}}else if(e.indexOf(Kr(i),s)!=s){var f=l.lastIndexOf(i);f>-1&&(l=l.slice(0,f))}return l+r},Rn.unescape=function(e){return(e=ls(e))&&z.test(e)?e.replace(D,Zt):e},Rn.uniqueId=function(e){var t=++Me;return ls(e)+t},Rn.upperCase=Fs,Rn.upperFirst=Vs,Rn.each=la,Rn.eachRight=ca,Rn.first=Do,Js(Rn,(hl={},cr(Rn,(function(e,t){Se.call(Rn.prototype,t)||(hl[t]=e)})),hl),{chain:!1}),Rn.VERSION="4.17.21",st(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Rn[e].placeholder=Rn})),st(["drop","take"],(function(e,t){In.prototype[e]=function(n){n=void 0===n?1:sn(is(n),0);var r=this.__filtered__&&!t?new In(this):this.clone();return r.__filtered__?r.__takeCount__=ln(n,r.__takeCount__):r.__views__.push({size:ln(n,4294967295),type:e+(r.__dir__<0?"Right":"")}),r},In.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),st(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;In.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Ji(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),st(["head","last"],(function(e,t){var n="take"+(t?"Right":"");In.prototype[e]=function(){return this[n](1).value()[0]}})),st(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");In.prototype[e]=function(){return this.__filtered__?new In(this):this[n](1)}})),In.prototype.compact=function(){return this.filter(Xs)},In.prototype.find=function(e){return this.filter(e).head()},In.prototype.findLast=function(e){return this.reverse().find(e)},In.prototype.invokeMap=Fr((function(e,t){return"function"==typeof e?new In(this):this.map((function(n){return _r(n,e,t)}))})),In.prototype.reject=function(e){return this.filter(Ea(Ji(e)))},In.prototype.slice=function(e,t){e=is(e);var n=this;return n.__filtered__&&(e>0||t<0)?new In(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),void 0!==t&&(n=(t=is(t))<0?n.dropRight(-t):n.take(t-e)),n)},In.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},In.prototype.toArray=function(){return this.take(4294967295)},cr(In.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),i=Rn[r?"take"+("last"==t?"Right":""):t],o=r||/^find/.test(t);i&&(Rn.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,s=t instanceof In,l=a[0],c=s||Na(t),u=function(e){var t=i.apply(Rn,pt([e],a));return r&&h?t[0]:t};c&&n&&"function"==typeof l&&1!=l.length&&(s=c=!1);var h=this.__chain__,f=!!this.__actions__.length,d=o&&!h,p=s&&!f;if(!o&&c){t=p?t:new In(this);var m=e.apply(t,a);return m.__actions__.push({func:ra,args:[u],thisArg:void 0}),new kn(m,h)}return d&&p?e.apply(this,a):(m=this.thru(u),d?r?m.value()[0]:m.value():m)})})),st(["pop","push","shift","sort","splice","unshift"],(function(e){var t=ye[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Rn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Na(i)?i:[],e)}return this[n]((function(n){return t.apply(Na(n)?n:[],e)}))}})),cr(In.prototype,(function(e,t){var n=Rn[t];if(n){var r=n.name+"";Se.call(xn,r)||(xn[r]=[]),xn[r].push({name:t,func:n})}})),xn[Ri(void 0,2).name]=[{name:"wrapper",func:void 0}],In.prototype.clone=function(){var e=new In(this.__wrapped__);return e.__actions__=yi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=yi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=yi(this.__views__),e},In.prototype.reverse=function(){if(this.__filtered__){var e=new In(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},In.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Na(e),r=t<0,i=n?e.length:0,o=function(e,t,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=ln(t,e+a);break;case"takeRight":e=sn(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=o.end,l=s-a,c=r?s:a-1,u=this.__iteratees__,h=u.length,f=0,d=ln(l,this.__takeCount__);if(!n||!r&&i==l&&d==l)return ri(e,this.__actions__);var p=[];e:for(;l--&&f<d;){for(var m=-1,v=e[c+=t];++m<h;){var g=u[m],y=g.iteratee,_=g.type,x=y(v);if(2==_)v=x;else if(!x){if(1==_)continue e;break e}}p[f++]=v}return p},Rn.prototype.at=ia,Rn.prototype.chain=function(){return na(this)},Rn.prototype.commit=function(){return new kn(this.value(),this.__chain__)},Rn.prototype.next=function(){void 0===this.__values__&&(this.__values__=ns(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},Rn.prototype.plant=function(e){for(var t,n=this;n instanceof Ln;){var r=Ro(n);r.__index__=0,r.__values__=void 0,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},Rn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof In){var t=e;return this.__actions__.length&&(t=new In(this)),(t=t.reverse()).__actions__.push({func:ra,args:[jo],thisArg:void 0}),new kn(t,this.__chain__)}return this.thru(jo)},Rn.prototype.toJSON=Rn.prototype.valueOf=Rn.prototype.value=function(){return ri(this.__wrapped__,this.__actions__)},Rn.prototype.first=Rn.prototype.head,Je&&(Rn.prototype[Je]=function(){return this}),Rn}();Xe._=$t,void 0===(i=function(){return $t}.call(t,n,t,r))||(r.exports=i)}).call(this)}).call(this,n(10),n(20)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"ACESFilmicToneMapping",(function(){return ne})),n.d(t,"AddEquation",(function(){return E})),n.d(t,"AddOperation",(function(){return J})),n.d(t,"AdditiveAnimationBlendMode",(function(){return qt})),n.d(t,"AdditiveBlending",(function(){return b})),n.d(t,"AlphaFormat",(function(){return De})),n.d(t,"AlwaysDepth",(function(){return G})),n.d(t,"AlwaysStencilFunc",(function(){return Mn})),n.d(t,"AmbientLight",(function(){return af})),n.d(t,"AmbientLightProbe",(function(){return Cf})),n.d(t,"AnimationClip",(function(){return Ah})),n.d(t,"AnimationLoader",(function(){return Oh})),n.d(t,"AnimationMixer",(function(){return id})),n.d(t,"AnimationObjectGroup",(function(){return nd})),n.d(t,"AnimationUtils",(function(){return ph})),n.d(t,"ArcCurve",(function(){return Zc})),n.d(t,"ArrayCamera",(function(){return xl})),n.d(t,"ArrowHelper",(function(){return Xd})),n.d(t,"Audio",(function(){return Ff})),n.d(t,"AudioAnalyser",(function(){return Wf})),n.d(t,"AudioContext",(function(){return Ef})),n.d(t,"AudioListener",(function(){return zf})),n.d(t,"AudioLoader",(function(){return Tf})),n.d(t,"AxesHelper",(function(){return Yd})),n.d(t,"AxisHelper",(function(){return wp})),n.d(t,"BackSide",(function(){return m})),n.d(t,"BasicDepthPacking",(function(){return on})),n.d(t,"BasicShadowMap",(function(){return u})),n.d(t,"BinaryTextureLoader",(function(){return Ap})),n.d(t,"Bone",(function(){return oc})),n.d(t,"BooleanKeyframeTrack",(function(){return xh})),n.d(t,"BoundingBoxHelper",(function(){return Sp})),n.d(t,"Box2",(function(){return pd})),n.d(t,"Box3",(function(){return ur})),n.d(t,"Box3Helper",(function(){return Gd})),n.d(t,"BoxBufferGeometry",(function(){return bo})),n.d(t,"BoxGeometry",(function(){return bo})),n.d(t,"BoxHelper",(function(){return Ud})),n.d(t,"BufferAttribute",(function(){return Ii})),n.d(t,"BufferGeometry",(function(){return eo})),n.d(t,"BufferGeometryLoader",(function(){return pf})),n.d(t,"ByteType",(function(){return Ee})),n.d(t,"Cache",(function(){return Rh})),n.d(t,"Camera",(function(){return To})),n.d(t,"CameraHelper",(function(){return zd})),n.d(t,"CanvasRenderer",(function(){return Rp})),n.d(t,"CanvasTexture",(function(){return Oc})),n.d(t,"CatmullRomCurve3",(function(){return tu})),n.d(t,"CineonToneMapping",(function(){return te})),n.d(t,"CircleBufferGeometry",(function(){return Bc})),n.d(t,"CircleGeometry",(function(){return Bc})),n.d(t,"ClampToEdgeWrapping",(function(){return fe})),n.d(t,"Clock",(function(){return kf})),n.d(t,"Color",(function(){return Ri})),n.d(t,"ColorKeyframeTrack",(function(){return bh})),n.d(t,"CompressedTexture",(function(){return Nc})),n.d(t,"CompressedTextureLoader",(function(){return Dh})),n.d(t,"ConeBufferGeometry",(function(){return Fc})),n.d(t,"ConeGeometry",(function(){return Fc})),n.d(t,"CubeCamera",(function(){return Co})),n.d(t,"CubeReflectionMapping",(function(){return oe})),n.d(t,"CubeRefractionMapping",(function(){return ae})),n.d(t,"CubeTexture",(function(){return Ro})),n.d(t,"CubeTextureLoader",(function(){return zh})),n.d(t,"CubeUVReflectionMapping",(function(){return ce})),n.d(t,"CubeUVRefractionMapping",(function(){return ue})),n.d(t,"CubicBezierCurve",(function(){return ou})),n.d(t,"CubicBezierCurve3",(function(){return au})),n.d(t,"CubicInterpolant",(function(){return vh})),n.d(t,"CullFaceBack",(function(){return s})),n.d(t,"CullFaceFront",(function(){return l})),n.d(t,"CullFaceFrontBack",(function(){return c})),n.d(t,"CullFaceNone",(function(){return a})),n.d(t,"Curve",(function(){return Xc})),n.d(t,"CurvePath",(function(){return Uh})),n.d(t,"CustomBlending",(function(){return M})),n.d(t,"CustomToneMapping",(function(){return re})),n.d(t,"CylinderBufferGeometry",(function(){return zc})),n.d(t,"CylinderGeometry",(function(){return zc})),n.d(t,"Cylindrical",(function(){return fd})),n.d(t,"DataTexture",(function(){return ac})),n.d(t,"DataTexture2DArray",(function(){return ka})),n.d(t,"DataTexture3D",(function(){return Ia})),n.d(t,"DataTextureLoader",(function(){return Fh})),n.d(t,"DataUtils",(function(){return Jd})),n.d(t,"DecrementStencilOp",(function(){return dn})),n.d(t,"DecrementWrapStencilOp",(function(){return mn})),n.d(t,"DefaultLoadingManager",(function(){return Lh})),n.d(t,"DepthFormat",(function(){return Ge})),n.d(t,"DepthStencilFormat",(function(){return He})),n.d(t,"DepthTexture",(function(){return Dc})),n.d(t,"DirectionalLight",(function(){return of})),n.d(t,"DirectionalLightHelper",(function(){return Od})),n.d(t,"DiscreteInterpolant",(function(){return yh})),n.d(t,"DodecahedronBufferGeometry",(function(){return Uc})),n.d(t,"DodecahedronGeometry",(function(){return Uc})),n.d(t,"DoubleSide",(function(){return v})),n.d(t,"DstAlphaFactor",(function(){return D})),n.d(t,"DstColorFactor",(function(){return z})),n.d(t,"DynamicBufferAttribute",(function(){return fp})),n.d(t,"DynamicCopyUsage",(function(){return kn})),n.d(t,"DynamicDrawUsage",(function(){return Tn})),n.d(t,"DynamicReadUsage",(function(){return Rn})),n.d(t,"EdgesGeometry",(function(){return qc})),n.d(t,"EdgesHelper",(function(){return Mp})),n.d(t,"EllipseCurve",(function(){return Yc})),n.d(t,"EqualDepth",(function(){return W})),n.d(t,"EqualStencilFunc",(function(){return _n})),n.d(t,"EquirectangularReflectionMapping",(function(){return se})),n.d(t,"EquirectangularRefractionMapping",(function(){return le})),n.d(t,"Euler",(function(){return Yr})),n.d(t,"EventDispatcher",(function(){return Dn})),n.d(t,"ExtrudeBufferGeometry",(function(){return Uu})),n.d(t,"ExtrudeGeometry",(function(){return Uu})),n.d(t,"FaceColors",(function(){return tp})),n.d(t,"FileLoader",(function(){return Nh})),n.d(t,"FlatShading",(function(){return g})),n.d(t,"Float16BufferAttribute",(function(){return Ui})),n.d(t,"Float32Attribute",(function(){return xp})),n.d(t,"Float32BufferAttribute",(function(){return Gi})),n.d(t,"Float64Attribute",(function(){return bp})),n.d(t,"Float64BufferAttribute",(function(){return Hi})),n.d(t,"FloatType",(function(){return Pe})),n.d(t,"Fog",(function(){return Rl})),n.d(t,"FogExp2",(function(){return Cl})),n.d(t,"Font",(function(){return bf})),n.d(t,"FontLoader",(function(){return Sf})),n.d(t,"FrontSide",(function(){return p})),n.d(t,"Frustum",(function(){return Bo})),n.d(t,"GLBufferAttribute",(function(){return sd})),n.d(t,"GLSL1",(function(){return Nn})),n.d(t,"GLSL3",(function(){return On})),n.d(t,"GammaEncoding",(function(){return Kt})),n.d(t,"GreaterDepth",(function(){return X})),n.d(t,"GreaterEqualDepth",(function(){return q})),n.d(t,"GreaterEqualStencilFunc",(function(){return Sn})),n.d(t,"GreaterStencilFunc",(function(){return bn})),n.d(t,"GridHelper",(function(){return Pd})),n.d(t,"Group",(function(){return bl})),n.d(t,"HalfFloatType",(function(){return Le})),n.d(t,"HemisphereLight",(function(){return Wh})),n.d(t,"HemisphereLightHelper",(function(){return Rd})),n.d(t,"HemisphereLightProbe",(function(){return Af})),n.d(t,"IcosahedronBufferGeometry",(function(){return Hu})),n.d(t,"IcosahedronGeometry",(function(){return Hu})),n.d(t,"ImageBitmapLoader",(function(){return _f})),n.d(t,"ImageLoader",(function(){return Bh})),n.d(t,"ImageUtils",(function(){return Kn})),n.d(t,"ImmediateRenderObject",(function(){return yd})),n.d(t,"IncrementStencilOp",(function(){return fn})),n.d(t,"IncrementWrapStencilOp",(function(){return pn})),n.d(t,"InstancedBufferAttribute",(function(){return df})),n.d(t,"InstancedBufferGeometry",(function(){return ff})),n.d(t,"InstancedInterleavedBuffer",(function(){return ad})),n.d(t,"InstancedMesh",(function(){return pc})),n.d(t,"Int16Attribute",(function(){return vp})),n.d(t,"Int16BufferAttribute",(function(){return Bi})),n.d(t,"Int32Attribute",(function(){return yp})),n.d(t,"Int32BufferAttribute",(function(){return Fi})),n.d(t,"Int8Attribute",(function(){return dp})),n.d(t,"Int8BufferAttribute",(function(){return Ni})),n.d(t,"IntType",(function(){return Ce})),n.d(t,"InterleavedBuffer",(function(){return Ll})),n.d(t,"InterleavedBufferAttribute",(function(){return Il})),n.d(t,"Interpolant",(function(){return mh})),n.d(t,"InterpolateDiscrete",(function(){return Ft})),n.d(t,"InterpolateLinear",(function(){return Vt})),n.d(t,"InterpolateSmooth",(function(){return Ut})),n.d(t,"InvertStencilOp",(function(){return vn})),n.d(t,"JSONLoader",(function(){return Pp})),n.d(t,"KeepStencilOp",(function(){return un})),n.d(t,"KeyframeTrack",(function(){return _h})),n.d(t,"LOD",(function(){return Kl})),n.d(t,"LatheBufferGeometry",(function(){return ju})),n.d(t,"LatheGeometry",(function(){return ju})),n.d(t,"Layers",(function(){return Zr})),n.d(t,"LensFlare",(function(){return kp})),n.d(t,"LessDepth",(function(){return H})),n.d(t,"LessEqualDepth",(function(){return j})),n.d(t,"LessEqualStencilFunc",(function(){return xn})),n.d(t,"LessStencilFunc",(function(){return yn})),n.d(t,"Light",(function(){return jh})),n.d(t,"LightProbe",(function(){return cf})),n.d(t,"Line",(function(){return bc})),n.d(t,"Line3",(function(){return gd})),n.d(t,"LineBasicMaterial",(function(){return mc})),n.d(t,"LineCurve",(function(){return su})),n.d(t,"LineCurve3",(function(){return lu})),n.d(t,"LineDashedMaterial",(function(){return fh})),n.d(t,"LineLoop",(function(){return Ec})),n.d(t,"LinePieces",(function(){return Qd})),n.d(t,"LineSegments",(function(){return Mc})),n.d(t,"LineStrip",(function(){return Kd})),n.d(t,"LinearEncoding",(function(){return $t})),n.d(t,"LinearFilter",(function(){return _e})),n.d(t,"LinearInterpolant",(function(){return gh})),n.d(t,"LinearMipMapLinearFilter",(function(){return Se})),n.d(t,"LinearMipMapNearestFilter",(function(){return be})),n.d(t,"LinearMipmapLinearFilter",(function(){return we})),n.d(t,"LinearMipmapNearestFilter",(function(){return xe})),n.d(t,"LinearToneMapping",(function(){return Q})),n.d(t,"Loader",(function(){return kh})),n.d(t,"LoaderUtils",(function(){return hf})),n.d(t,"LoadingManager",(function(){return Ph})),n.d(t,"LogLuvEncoding",(function(){return en})),n.d(t,"LoopOnce",(function(){return Dt})),n.d(t,"LoopPingPong",(function(){return zt})),n.d(t,"LoopRepeat",(function(){return Bt})),n.d(t,"LuminanceAlphaFormat",(function(){return Ve})),n.d(t,"LuminanceFormat",(function(){return Fe})),n.d(t,"MOUSE",(function(){return i})),n.d(t,"Material",(function(){return wi})),n.d(t,"MaterialLoader",(function(){return uf})),n.d(t,"Math",(function(){return Yn})),n.d(t,"MathUtils",(function(){return Yn})),n.d(t,"Matrix3",(function(){return $n})),n.d(t,"Matrix4",(function(){return zr})),n.d(t,"MaxEquation",(function(){return R})),n.d(t,"Mesh",(function(){return _o})),n.d(t,"MeshBasicMaterial",(function(){return Pi})),n.d(t,"MeshDepthMaterial",(function(){return pl})),n.d(t,"MeshDistanceMaterial",(function(){return ml})),n.d(t,"MeshFaceMaterial",(function(){return rp})),n.d(t,"MeshLambertMaterial",(function(){return uh})),n.d(t,"MeshMatcapMaterial",(function(){return hh})),n.d(t,"MeshNormalMaterial",(function(){return ch})),n.d(t,"MeshPhongMaterial",(function(){return sh})),n.d(t,"MeshPhysicalMaterial",(function(){return ah})),n.d(t,"MeshStandardMaterial",(function(){return oh})),n.d(t,"MeshToonMaterial",(function(){return lh})),n.d(t,"MinEquation",(function(){return C})),n.d(t,"MirroredRepeatWrapping",(function(){return de})),n.d(t,"MixOperation",(function(){return $})),n.d(t,"MultiMaterial",(function(){return ip})),n.d(t,"MultiplyBlending",(function(){return S})),n.d(t,"MultiplyOperation",(function(){return Z})),n.d(t,"NearestFilter",(function(){return pe})),n.d(t,"NearestMipMapLinearFilter",(function(){return ye})),n.d(t,"NearestMipMapNearestFilter",(function(){return ve})),n.d(t,"NearestMipmapLinearFilter",(function(){return ge})),n.d(t,"NearestMipmapNearestFilter",(function(){return me})),n.d(t,"NeverDepth",(function(){return U})),n.d(t,"NeverStencilFunc",(function(){return gn})),n.d(t,"NoBlending",(function(){return _})),n.d(t,"NoColors",(function(){return ep})),n.d(t,"NoToneMapping",(function(){return K})),n.d(t,"NormalAnimationBlendMode",(function(){return Wt})),n.d(t,"NormalBlending",(function(){return x})),n.d(t,"NotEqualDepth",(function(){return Y})),n.d(t,"NotEqualStencilFunc",(function(){return wn})),n.d(t,"NumberKeyframeTrack",(function(){return wh})),n.d(t,"Object3D",(function(){return ci})),n.d(t,"ObjectLoader",(function(){return mf})),n.d(t,"ObjectSpaceNormalMap",(function(){return ln})),n.d(t,"OctahedronBufferGeometry",(function(){return Wu})),n.d(t,"OctahedronGeometry",(function(){return Wu})),n.d(t,"OneFactor",(function(){return L})),n.d(t,"OneMinusDstAlphaFactor",(function(){return B})),n.d(t,"OneMinusDstColorFactor",(function(){return F})),n.d(t,"OneMinusSrcAlphaFactor",(function(){return O})),n.d(t,"OneMinusSrcColorFactor",(function(){return I})),n.d(t,"OrthographicCamera",(function(){return $o})),n.d(t,"PCFShadowMap",(function(){return h})),n.d(t,"PCFSoftShadowMap",(function(){return f})),n.d(t,"PMREMGenerator",(function(){return pa})),n.d(t,"ParametricBufferGeometry",(function(){return qu})),n.d(t,"ParametricGeometry",(function(){return qu})),n.d(t,"Particle",(function(){return ap})),n.d(t,"ParticleBasicMaterial",(function(){return cp})),n.d(t,"ParticleSystem",(function(){return sp})),n.d(t,"ParticleSystemMaterial",(function(){return up})),n.d(t,"Path",(function(){return Gh})),n.d(t,"PerspectiveCamera",(function(){return Ao})),n.d(t,"Plane",(function(){return No})),n.d(t,"PlaneBufferGeometry",(function(){return Vo})),n.d(t,"PlaneGeometry",(function(){return Vo})),n.d(t,"PlaneHelper",(function(){return Hd})),n.d(t,"PointCloud",(function(){return op})),n.d(t,"PointCloudMaterial",(function(){return lp})),n.d(t,"PointLight",(function(){return nf})),n.d(t,"PointLightHelper",(function(){return Ed})),n.d(t,"Points",(function(){return Lc})),n.d(t,"PointsMaterial",(function(){return Tc})),n.d(t,"PolarGridHelper",(function(){return Ld})),n.d(t,"PolyhedronBufferGeometry",(function(){return Vc})),n.d(t,"PolyhedronGeometry",(function(){return Vc})),n.d(t,"PositionalAudio",(function(){return jf})),n.d(t,"PropertyBinding",(function(){return td})),n.d(t,"PropertyMixer",(function(){return qf})),n.d(t,"QuadraticBezierCurve",(function(){return cu})),n.d(t,"QuadraticBezierCurve3",(function(){return uu})),n.d(t,"Quaternion",(function(){return ar})),n.d(t,"QuaternionKeyframeTrack",(function(){return Mh})),n.d(t,"QuaternionLinearInterpolant",(function(){return Sh})),n.d(t,"REVISION",(function(){return r})),n.d(t,"RGBADepthPacking",(function(){return an})),n.d(t,"RGBAFormat",(function(){return ze})),n.d(t,"RGBAIntegerFormat",(function(){return Ze})),n.d(t,"RGBA_ASTC_10x10_Format",(function(){return yt})),n.d(t,"RGBA_ASTC_10x5_Format",(function(){return mt})),n.d(t,"RGBA_ASTC_10x6_Format",(function(){return vt})),n.d(t,"RGBA_ASTC_10x8_Format",(function(){return gt})),n.d(t,"RGBA_ASTC_12x10_Format",(function(){return _t})),n.d(t,"RGBA_ASTC_12x12_Format",(function(){return xt})),n.d(t,"RGBA_ASTC_4x4_Format",(function(){return st})),n.d(t,"RGBA_ASTC_5x4_Format",(function(){return lt})),n.d(t,"RGBA_ASTC_5x5_Format",(function(){return ct})),n.d(t,"RGBA_ASTC_6x5_Format",(function(){return ut})),n.d(t,"RGBA_ASTC_6x6_Format",(function(){return ht})),n.d(t,"RGBA_ASTC_8x5_Format",(function(){return ft})),n.d(t,"RGBA_ASTC_8x6_Format",(function(){return dt})),n.d(t,"RGBA_ASTC_8x8_Format",(function(){return pt})),n.d(t,"RGBA_BPTC_Format",(function(){return bt})),n.d(t,"RGBA_ETC2_EAC_Format",(function(){return at})),n.d(t,"RGBA_PVRTC_2BPPV1_Format",(function(){return rt})),n.d(t,"RGBA_PVRTC_4BPPV1_Format",(function(){return nt})),n.d(t,"RGBA_S3TC_DXT1_Format",(function(){return Je})),n.d(t,"RGBA_S3TC_DXT3_Format",(function(){return Ke})),n.d(t,"RGBA_S3TC_DXT5_Format",(function(){return Qe})),n.d(t,"RGBDEncoding",(function(){return rn})),n.d(t,"RGBEEncoding",(function(){return Qt})),n.d(t,"RGBEFormat",(function(){return Ue})),n.d(t,"RGBFormat",(function(){return Be})),n.d(t,"RGBIntegerFormat",(function(){return Ye})),n.d(t,"RGBM16Encoding",(function(){return nn})),n.d(t,"RGBM7Encoding",(function(){return tn})),n.d(t,"RGB_ETC1_Format",(function(){return it})),n.d(t,"RGB_ETC2_Format",(function(){return ot})),n.d(t,"RGB_PVRTC_2BPPV1_Format",(function(){return tt})),n.d(t,"RGB_PVRTC_4BPPV1_Format",(function(){return et})),n.d(t,"RGB_S3TC_DXT1_Format",(function(){return $e})),n.d(t,"RGFormat",(function(){return qe})),n.d(t,"RGIntegerFormat",(function(){return Xe})),n.d(t,"RawShaderMaterial",(function(){return Jo})),n.d(t,"Ray",(function(){return Br})),n.d(t,"Raycaster",(function(){return ld})),n.d(t,"RectAreaLight",(function(){return sf})),n.d(t,"RedFormat",(function(){return je})),n.d(t,"RedIntegerFormat",(function(){return We})),n.d(t,"ReinhardToneMapping",(function(){return ee})),n.d(t,"RepeatWrapping",(function(){return he})),n.d(t,"ReplaceStencilOp",(function(){return hn})),n.d(t,"ReverseSubtractEquation",(function(){return A})),n.d(t,"RingBufferGeometry",(function(){return Xu})),n.d(t,"RingGeometry",(function(){return Xu})),n.d(t,"SRGB8_ALPHA8_ASTC_10x10_Format",(function(){return It})),n.d(t,"SRGB8_ALPHA8_ASTC_10x5_Format",(function(){return Pt})),n.d(t,"SRGB8_ALPHA8_ASTC_10x6_Format",(function(){return Lt})),n.d(t,"SRGB8_ALPHA8_ASTC_10x8_Format",(function(){return kt})),n.d(t,"SRGB8_ALPHA8_ASTC_12x10_Format",(function(){return Nt})),n.d(t,"SRGB8_ALPHA8_ASTC_12x12_Format",(function(){return Ot})),n.d(t,"SRGB8_ALPHA8_ASTC_4x4_Format",(function(){return wt})),n.d(t,"SRGB8_ALPHA8_ASTC_5x4_Format",(function(){return St})),n.d(t,"SRGB8_ALPHA8_ASTC_5x5_Format",(function(){return Mt})),n.d(t,"SRGB8_ALPHA8_ASTC_6x5_Format",(function(){return Et})),n.d(t,"SRGB8_ALPHA8_ASTC_6x6_Format",(function(){return Tt})),n.d(t,"SRGB8_ALPHA8_ASTC_8x5_Format",(function(){return At})),n.d(t,"SRGB8_ALPHA8_ASTC_8x6_Format",(function(){return Ct})),n.d(t,"SRGB8_ALPHA8_ASTC_8x8_Format",(function(){return Rt})),n.d(t,"Scene",(function(){return Pl})),n.d(t,"SceneUtils",(function(){return Lp})),n.d(t,"ShaderChunk",(function(){return Uo})),n.d(t,"ShaderLib",(function(){return Ho})),n.d(t,"ShaderMaterial",(function(){return Eo})),n.d(t,"ShadowMaterial",(function(){return ih})),n.d(t,"Shape",(function(){return Hh})),n.d(t,"ShapeBufferGeometry",(function(){return Yu})),n.d(t,"ShapeGeometry",(function(){return Yu})),n.d(t,"ShapePath",(function(){return xf})),n.d(t,"ShapeUtils",(function(){return zu})),n.d(t,"ShortType",(function(){return Te})),n.d(t,"Skeleton",(function(){return cc})),n.d(t,"SkeletonHelper",(function(){return Md})),n.d(t,"SkinnedMesh",(function(){return ic})),n.d(t,"SmoothShading",(function(){return y})),n.d(t,"Sphere",(function(){return Rr})),n.d(t,"SphereBufferGeometry",(function(){return Zu})),n.d(t,"SphereGeometry",(function(){return Zu})),n.d(t,"Spherical",(function(){return hd})),n.d(t,"SphericalHarmonics3",(function(){return lf})),n.d(t,"SplineCurve",(function(){return hu})),n.d(t,"SpotLight",(function(){return Jh})),n.d(t,"SpotLightHelper",(function(){return xd})),n.d(t,"Sprite",(function(){return Yl})),n.d(t,"SpriteMaterial",(function(){return Nl})),n.d(t,"SrcAlphaFactor",(function(){return N})),n.d(t,"SrcAlphaSaturateFactor",(function(){return V})),n.d(t,"SrcColorFactor",(function(){return k})),n.d(t,"StaticCopyUsage",(function(){return Ln})),n.d(t,"StaticDrawUsage",(function(){return En})),n.d(t,"StaticReadUsage",(function(){return Cn})),n.d(t,"StereoCamera",(function(){return Lf})),n.d(t,"StreamCopyUsage",(function(){return In})),n.d(t,"StreamDrawUsage",(function(){return An})),n.d(t,"StreamReadUsage",(function(){return Pn})),n.d(t,"StringKeyframeTrack",(function(){return Eh})),n.d(t,"SubtractEquation",(function(){return T})),n.d(t,"SubtractiveBlending",(function(){return w})),n.d(t,"TOUCH",(function(){return o})),n.d(t,"TangentSpaceNormalMap",(function(){return sn})),n.d(t,"TetrahedronBufferGeometry",(function(){return $u})),n.d(t,"TetrahedronGeometry",(function(){return $u})),n.d(t,"TextBufferGeometry",(function(){return Ju})),n.d(t,"TextGeometry",(function(){return Ju})),n.d(t,"Texture",(function(){return er})),n.d(t,"TextureLoader",(function(){return Vh})),n.d(t,"TorusBufferGeometry",(function(){return Ku})),n.d(t,"TorusGeometry",(function(){return Ku})),n.d(t,"TorusKnotBufferGeometry",(function(){return Qu})),n.d(t,"TorusKnotGeometry",(function(){return Qu})),n.d(t,"Triangle",(function(){return xi})),n.d(t,"TriangleFanDrawMode",(function(){return Zt})),n.d(t,"TriangleStripDrawMode",(function(){return Yt})),n.d(t,"TrianglesDrawMode",(function(){return Xt})),n.d(t,"TubeBufferGeometry",(function(){return eh})),n.d(t,"TubeGeometry",(function(){return eh})),n.d(t,"UVMapping",(function(){return ie})),n.d(t,"Uint16Attribute",(function(){return gp})),n.d(t,"Uint16BufferAttribute",(function(){return zi})),n.d(t,"Uint32Attribute",(function(){return _p})),n.d(t,"Uint32BufferAttribute",(function(){return Vi})),n.d(t,"Uint8Attribute",(function(){return pp})),n.d(t,"Uint8BufferAttribute",(function(){return Oi})),n.d(t,"Uint8ClampedAttribute",(function(){return mp})),n.d(t,"Uint8ClampedBufferAttribute",(function(){return Di})),n.d(t,"Uniform",(function(){return od})),n.d(t,"UniformsLib",(function(){return Go})),n.d(t,"UniformsUtils",(function(){return Mo})),n.d(t,"UnsignedByteType",(function(){return Me})),n.d(t,"UnsignedInt248Type",(function(){return Oe})),n.d(t,"UnsignedIntType",(function(){return Re})),n.d(t,"UnsignedShort4444Type",(function(){return ke})),n.d(t,"UnsignedShort5551Type",(function(){return Ie})),n.d(t,"UnsignedShort565Type",(function(){return Ne})),n.d(t,"UnsignedShortType",(function(){return Ae})),n.d(t,"VSMShadowMap",(function(){return d})),n.d(t,"Vector2",(function(){return Zn})),n.d(t,"Vector3",(function(){return sr})),n.d(t,"Vector4",(function(){return nr})),n.d(t,"VectorKeyframeTrack",(function(){return Th})),n.d(t,"Vertex",(function(){return hp})),n.d(t,"VertexColors",(function(){return np})),n.d(t,"VideoTexture",(function(){return Ic})),n.d(t,"WebGL1Renderer",(function(){return Al})),n.d(t,"WebGLCubeRenderTarget",(function(){return Po})),n.d(t,"WebGLMultipleRenderTargets",(function(){return ir})),n.d(t,"WebGLMultisampleRenderTarget",(function(){return or})),n.d(t,"WebGLRenderTarget",(function(){return rr})),n.d(t,"WebGLRenderTargetCube",(function(){return Cp})),n.d(t,"WebGLRenderer",(function(){return Tl})),n.d(t,"WebGLUtils",(function(){return _l})),n.d(t,"WireframeGeometry",(function(){return th})),n.d(t,"WireframeHelper",(function(){return Ep})),n.d(t,"WrapAroundEnding",(function(){return jt})),n.d(t,"XHRLoader",(function(){return Tp})),n.d(t,"ZeroCurvatureEnding",(function(){return Gt})),n.d(t,"ZeroFactor",(function(){return P})),n.d(t,"ZeroSlopeEnding",(function(){return Ht})),n.d(t,"ZeroStencilOp",(function(){return cn})),n.d(t,"sRGBEncoding",(function(){return Jt}));
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const r="131",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,s=1,l=2,c=3,u=0,h=1,f=2,d=3,p=0,m=1,v=2,g=1,y=2,_=0,x=1,b=2,w=3,S=4,M=5,E=100,T=101,A=102,C=103,R=104,P=200,L=201,k=202,I=203,N=204,O=205,D=206,B=207,z=208,F=209,V=210,U=0,G=1,H=2,j=3,W=4,q=5,X=6,Y=7,Z=0,$=1,J=2,K=0,Q=1,ee=2,te=3,ne=4,re=5,ie=300,oe=301,ae=302,se=303,le=304,ce=306,ue=307,he=1e3,fe=1001,de=1002,pe=1003,me=1004,ve=1004,ge=1005,ye=1005,_e=1006,xe=1007,be=1007,we=1008,Se=1008,Me=1009,Ee=1010,Te=1011,Ae=1012,Ce=1013,Re=1014,Pe=1015,Le=1016,ke=1017,Ie=1018,Ne=1019,Oe=1020,De=1021,Be=1022,ze=1023,Fe=1024,Ve=1025,Ue=ze,Ge=1026,He=1027,je=1028,We=1029,qe=1030,Xe=1031,Ye=1032,Ze=1033,$e=33776,Je=33777,Ke=33778,Qe=33779,et=35840,tt=35841,nt=35842,rt=35843,it=36196,ot=37492,at=37496,st=37808,lt=37809,ct=37810,ut=37811,ht=37812,ft=37813,dt=37814,pt=37815,mt=37816,vt=37817,gt=37818,yt=37819,_t=37820,xt=37821,bt=36492,wt=37840,St=37841,Mt=37842,Et=37843,Tt=37844,At=37845,Ct=37846,Rt=37847,Pt=37848,Lt=37849,kt=37850,It=37851,Nt=37852,Ot=37853,Dt=2200,Bt=2201,zt=2202,Ft=2300,Vt=2301,Ut=2302,Gt=2400,Ht=2401,jt=2402,Wt=2500,qt=2501,Xt=0,Yt=1,Zt=2,$t=3e3,Jt=3001,Kt=3007,Qt=3002,en=3003,tn=3004,nn=3005,rn=3006,on=3200,an=3201,sn=0,ln=1,cn=0,un=7680,hn=7681,fn=7682,dn=7683,pn=34055,mn=34056,vn=5386,gn=512,yn=513,_n=514,xn=515,bn=516,wn=517,Sn=518,Mn=519,En=35044,Tn=35048,An=35040,Cn=35045,Rn=35049,Pn=35041,Ln=35046,kn=35050,In=35042,Nn="100",On="300 es";class Dn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const Bn=[];for(let e=0;e<256;e++)Bn[e]=(e<16?"0":"")+e.toString(16);let zn=1234567;const Fn=Math.PI/180,Vn=180/Math.PI;function Un(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Bn[255&e]+Bn[e>>8&255]+Bn[e>>16&255]+Bn[e>>24&255]+"-"+Bn[255&t]+Bn[t>>8&255]+"-"+Bn[t>>16&15|64]+Bn[t>>24&255]+"-"+Bn[63&n|128]+Bn[n>>8&255]+"-"+Bn[n>>16&255]+Bn[n>>24&255]+Bn[255&r]+Bn[r>>8&255]+Bn[r>>16&255]+Bn[r>>24&255]).toUpperCase()}function Gn(e,t,n){return Math.max(t,Math.min(n,e))}function Hn(e,t){return(e%t+t)%t}function jn(e,t,n){return(1-n)*e+n*t}function Wn(e){return 0==(e&e-1)&&0!==e}function qn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Xn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Yn=Object.freeze({__proto__:null,DEG2RAD:Fn,RAD2DEG:Vn,generateUUID:Un,clamp:Gn,euclideanModulo:Hn,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:jn,damp:function(e,t,n,r){return jn(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Hn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(zn=e%2147483647),zn=16807*zn%2147483647,(zn-1)/2147483646},degToRad:function(e){return e*Fn},radToDeg:function(e){return e*Vn},isPowerOfTwo:Wn,ceilPowerOfTwo:qn,floorPowerOfTwo:Xn,setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),c=o((t+r)/2),u=a((t+r)/2),h=o((t-r)/2),f=a((t-r)/2),d=o((r-t)/2),p=a((r-t)/2);switch(i){case"XYX":e.set(s*u,l*h,l*f,s*c);break;case"YZY":e.set(l*f,s*u,l*h,s*c);break;case"ZXZ":e.set(l*h,l*f,s*u,s*c);break;case"XZX":e.set(s*u,l*p,l*d,s*c);break;case"YXY":e.set(l*d,s*u,l*p,s*c);break;case"ZYZ":e.set(l*p,l*d,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class Zn{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Zn.prototype.isVector2=!0;class $n{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,a,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],f=n[5],d=n[8],p=r[0],m=r[3],v=r[6],g=r[1],y=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=o*p+a*g+s*x,i[3]=o*m+a*y+s*b,i[6]=o*v+a*_+s*w,i[1]=l*p+c*g+u*x,i[4]=l*m+c*y+u*b,i[7]=l*v+c*_+u*w,i[2]=h*p+f*g+d*x,i[5]=h*m+f*y+d*b,i[8]=h*v+f*_+d*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-n*i*c+n*a*s+r*i*l-r*o*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=c*o-a*l,h=a*s-c*i,f=l*i-o*s,d=t*u+n*h+r*f;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const p=1/d;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(a*n-r*o)*p,e[3]=h*p,e[4]=(c*t-r*s)*p,e[5]=(r*i-a*t)*p,e[6]=f*p,e[7]=(n*s-l*t)*p,e[8]=(o*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,a){const s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*l,r[6]=t*a+n*c,r[1]=-n*i+t*s,r[4]=-n*o+t*l,r[7]=-n*a+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let Jn;$n.prototype.isMatrix3=!0;class Kn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Jn&&(Jn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Jn.width=e.width,Jn.height=e.height;const n=Jn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Jn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Qn=0;class er extends Dn{constructor(e=er.DEFAULT_IMAGE,t=er.DEFAULT_MAPPING,n=fe,r=fe,i=_e,o=we,a=ze,s=Me,l=1,c=$t){super(),Object.defineProperty(this,"id",{value:Qn++}),this.uuid=Un(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new Zn(0,0),this.repeat=new Zn(1,1),this.center=new Zn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $n,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Un()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(tr(r[e].image)):t.push(tr(r[e]))}else t=tr(r);e.images[r.uuid]={uuid:r.uuid,url:t}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ie)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case he:e.x=e.x-Math.floor(e.x);break;case fe:e.x=e.x<0?0:1;break;case de:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case he:e.y=e.y-Math.floor(e.y);break;case fe:e.y=e.y<0?0:1;break;case de:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function tr(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Kn.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}er.DEFAULT_IMAGE=void 0,er.DEFAULT_MAPPING=ie,er.prototype.isTexture=!0;class nr{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],f=o[2],d=o[6],p=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-f)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+f)<.1&&Math.abs(h+d)<.1&&Math.abs(a+u+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const e=(a+1)/2,o=(u+1)/2,m=(p+1)/2,v=(s+c)/4,g=(l+f)/4,y=(h+d)/4;return e>o&&e>m?e<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=v/n,i=g/n):o>m?o<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=v/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=g/i,r=y/i),this.set(n,r,i,t),this}let m=Math.sqrt((d-h)*(d-h)+(l-f)*(l-f)+(c-s)*(c-s));return Math.abs(m)<.001&&(m=1),this.x=(d-h)/m,this.y=(l-f)/m,this.z=(c-s)/m,this.w=Math.acos((a+u+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}nr.prototype.isVector4=!0;class rr extends Dn{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new nr(0,0,e,t),this.scissorTest=!1,this.viewport=new nr(0,0,e,t),this.texture=new er(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:_e,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}rr.prototype.isWebGLRenderTarget=!0;class ir extends rr{constructor(e,t,n){super(e,t);const r=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=r.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}ir.prototype.isWebGLMultipleRenderTargets=!0;class or extends rr{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}or.prototype.isWebGLMultisampleRenderTarget=!0;class ar{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,o,a){let s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[o+0],f=i[o+1],d=i[o+2],p=i[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=d,void(e[t+3]=p);if(u!==p||s!==h||l!==f||c!==d){let e=1-a;const t=s*h+l*f+c*d+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,a=Math.sin(a*o)/i}const i=a*n;if(s=s*e+h*i,l=l*e+f*i,c=c*e+d*i,u=u*e+p*i,e===1-a){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,o){const a=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[o],h=i[o+1],f=i[o+2],d=i[o+3];return e[t]=a*d+c*u+s*f-l*h,e[t+1]=s*d+c*h+l*u-a*f,e[t+2]=l*d+c*f+a*h-s*u,e[t+3]=c*d-a*u-s*h-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),c=a(r/2),u=a(i/2),h=s(n/2),f=s(r/2),d=s(i/2);switch(o){case"XYZ":this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d;break;case"YXZ":this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d;break;case"ZXY":this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d;break;case"ZYX":this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d;break;case"YZX":this._x=h*c*u+l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u-h*f*d;break;case"XZY":this._x=h*c*u-l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u+h*f*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],a=t[5],s=t[9],l=t[2],c=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-s)*e,this._y=(i-l)*e,this._z=(o-r)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-s)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(i-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-r)/e,this._x=(i+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Gn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+o*a+r*l-i*s,this._y=r*c+o*s+i*a-n*l,this._z=i*c+o*l+n*s-r*a,this._w=o*c-n*a-r*s-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ar.prototype.isQuaternion=!0;class sr{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cr.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(cr.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*n,c=s*n+a*t-i*r,u=s*r+i*n-o*t,h=-i*t-o*n-a*r;return this.x=l*s+h*-i+c*-a-u*-o,this.y=c*s+h*-o+u*-i-l*-a,this.z=u*s+h*-a+l*-o-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return lr.copy(this).projectOnVector(e),this.sub(lr)}reflect(e){return this.sub(lr.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Gn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}sr.prototype.isVector3=!0;const lr=new sr,cr=new ar;class ur{constructor(e=new sr(1/0,1/0,1/0),t=new sr(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],c=e[s+1],u=e[s+2];l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(i,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),c=e.getY(s),u=e.getZ(s);l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>a&&(a=u)}return this.min.set(t,n,r),this.max.set(i,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=fr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),dr.copy(t.boundingBox),dr.applyMatrix4(e.matrixWorld),this.union(dr));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,fr),fr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(xr),br.subVectors(this.max,xr),pr.subVectors(e.a,xr),mr.subVectors(e.b,xr),vr.subVectors(e.c,xr),gr.subVectors(mr,pr),yr.subVectors(vr,mr),_r.subVectors(pr,vr);let t=[0,-gr.z,gr.y,0,-yr.z,yr.y,0,-_r.z,_r.y,gr.z,0,-gr.x,yr.z,0,-yr.x,_r.z,0,-_r.x,-gr.y,gr.x,0,-yr.y,yr.x,0,-_r.y,_r.x,0];return!!Mr(t,pr,mr,vr,br)&&(t=[1,0,0,0,1,0,0,0,1],!!Mr(t,pr,mr,vr,br)&&(wr.crossVectors(gr,yr),t=[wr.x,wr.y,wr.z],Mr(t,pr,mr,vr,br)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return fr.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(fr).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(hr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ur.prototype.isBox3=!0;const hr=[new sr,new sr,new sr,new sr,new sr,new sr,new sr,new sr],fr=new sr,dr=new ur,pr=new sr,mr=new sr,vr=new sr,gr=new sr,yr=new sr,_r=new sr,xr=new sr,br=new sr,wr=new sr,Sr=new sr;function Mr(e,t,n,r,i){for(let o=0,a=e.length-3;o<=a;o+=3){Sr.fromArray(e,o);const a=i.x*Math.abs(Sr.x)+i.y*Math.abs(Sr.y)+i.z*Math.abs(Sr.z),s=t.dot(Sr),l=n.dot(Sr),c=r.dot(Sr);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>a)return!1}return!0}const Er=new ur,Tr=new sr,Ar=new sr,Cr=new sr;class Rr{constructor(e=new sr,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Er.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Cr.subVectors(e,this.center);const t=Cr.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Cr.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return Ar.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Tr.copy(e.center).add(Ar)),this.expandByPoint(Tr.copy(e.center).sub(Ar)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Pr=new sr,Lr=new sr,kr=new sr,Ir=new sr,Nr=new sr,Or=new sr,Dr=new sr;class Br{constructor(e=new sr,t=new sr(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Pr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Pr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Pr.copy(this.direction).multiplyScalar(t).add(this.origin),Pr.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Lr.copy(e).add(t).multiplyScalar(.5),kr.copy(t).sub(e).normalize(),Ir.copy(this.origin).sub(Lr);const i=.5*e.distanceTo(t),o=-this.direction.dot(kr),a=Ir.dot(this.direction),s=-Ir.dot(kr),l=Ir.lengthSq(),c=Math.abs(1-o*o);let u,h,f,d;if(c>0)if(u=o*s-a,h=o*a-s,d=i*c,u>=0)if(h>=-d)if(h<=d){const e=1/c;u*=e,h*=e,f=u*(u+o*h+2*a)+h*(o*u+h+2*s)+l}else h=i,u=Math.max(0,-(o*h+a)),f=-u*u+h*(h+2*s)+l;else h=-i,u=Math.max(0,-(o*h+a)),f=-u*u+h*(h+2*s)+l;else h<=-d?(u=Math.max(0,-(-o*i+a)),h=u>0?-i:Math.min(Math.max(-i,-s),i),f=-u*u+h*(h+2*s)+l):h<=d?(u=0,h=Math.min(Math.max(-i,-s),i),f=h*(h+2*s)+l):(u=Math.max(0,-(o*i+a)),h=u>0?i:Math.min(Math.max(-i,-s),i),f=-u*u+h*(h+2*s)+l);else h=o>0?-i:i,u=Math.max(0,-(o*h+a)),f=-u*u+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(kr).multiplyScalar(h).add(Lr),f}intersectSphere(e,t){Pr.subVectors(e.center,this.origin);const n=Pr.dot(this.direction),r=Pr.dot(Pr)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,a,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Pr)}intersectTriangle(e,t,n,r,i){Nr.subVectors(t,e),Or.subVectors(n,e),Dr.crossVectors(Nr,Or);let o,a=this.direction.dot(Dr);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Ir.subVectors(this.origin,e);const s=o*this.direction.dot(Or.crossVectors(Ir,Or));if(s<0)return null;const l=o*this.direction.dot(Nr.cross(Ir));if(l<0)return null;if(s+l>a)return null;const c=-o*Ir.dot(Dr);return c<0?null:this.at(c/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class zr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,a,s,l,c,u,h,f,d,p,m){const v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new zr).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Fr.setFromMatrixColumn(e,0).length(),i=1/Fr.setFromMatrixColumn(e,1).length(),o=1/Fr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=o*c,n=o*u,r=a*c,i=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-a*s,t[2]=i-e*l,t[6]=r+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e+i*a,t[4]=r*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=n*a-r,t[6]=i+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e-i*a,t[4]=-o*u,t[8]=r+n*a,t[1]=n+r*a,t[5]=o*c,t[9]=i-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*c,n=o*u,r=a*c,i=a*u;t[0]=s*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=s*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,r=a*s,i=a*l;t[0]=s*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=o*s,n=o*l,r=a*s,i=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=o*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=a*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Ur,e,Gr)}lookAt(e,t,n){const r=this.elements;return Wr.subVectors(e,t),0===Wr.lengthSq()&&(Wr.z=1),Wr.normalize(),Hr.crossVectors(n,Wr),0===Hr.lengthSq()&&(1===Math.abs(n.z)?Wr.x+=1e-4:Wr.z+=1e-4,Wr.normalize(),Hr.crossVectors(n,Wr)),Hr.normalize(),jr.crossVectors(Wr,Hr),r[0]=Hr.x,r[4]=jr.x,r[8]=Wr.x,r[1]=Hr.y,r[5]=jr.y,r[9]=Wr.y,r[2]=Hr.z,r[6]=jr.z,r[10]=Wr.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],f=n[13],d=n[2],p=n[6],m=n[10],v=n[14],g=n[3],y=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],A=r[9],C=r[13],R=r[2],P=r[6],L=r[10],k=r[14],I=r[3],N=r[7],O=r[11],D=r[15];return i[0]=o*b+a*E+s*R+l*I,i[4]=o*w+a*T+s*P+l*N,i[8]=o*S+a*A+s*L+l*O,i[12]=o*M+a*C+s*k+l*D,i[1]=c*b+u*E+h*R+f*I,i[5]=c*w+u*T+h*P+f*N,i[9]=c*S+u*A+h*L+f*O,i[13]=c*M+u*C+h*k+f*D,i[2]=d*b+p*E+m*R+v*I,i[6]=d*w+p*T+m*P+v*N,i[10]=d*S+p*A+m*L+v*O,i[14]=d*M+p*C+m*k+v*D,i[3]=g*b+y*E+_*R+x*I,i[7]=g*w+y*T+_*P+x*N,i[11]=g*S+y*A+_*L+x*O,i[15]=g*M+y*C+_*k+x*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],f=e[14];return e[3]*(+i*s*u-r*l*u-i*a*h+n*l*h+r*a*f-n*s*f)+e[7]*(+t*s*f-t*l*h+i*o*h-r*o*f+r*l*c-i*s*c)+e[11]*(+t*l*u-t*a*f-i*o*u+n*o*f+i*a*c-n*l*c)+e[15]*(-r*a*c-t*s*u+t*a*h+r*o*u-n*o*h+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],v=e[15],g=u*m*l-p*h*l+p*s*f-a*m*f-u*s*v+a*h*v,y=d*h*l-c*m*l-d*s*f+o*m*f+c*s*v-o*h*v,_=c*p*l-d*u*l+d*a*f-o*p*f-c*a*v+o*u*v,x=d*u*s-c*p*s-d*a*h+o*p*h+c*a*m-o*u*m,b=t*g+n*y+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=g*w,e[1]=(p*h*i-u*m*i-p*r*f+n*m*f+u*r*v-n*h*v)*w,e[2]=(a*m*i-p*s*i+p*r*l-n*m*l-a*r*v+n*s*v)*w,e[3]=(u*s*i-a*h*i-u*r*l+n*h*l+a*r*f-n*s*f)*w,e[4]=y*w,e[5]=(c*m*i-d*h*i+d*r*f-t*m*f-c*r*v+t*h*v)*w,e[6]=(d*s*i-o*m*i-d*r*l+t*m*l+o*r*v-t*s*v)*w,e[7]=(o*h*i-c*s*i+c*r*l-t*h*l-o*r*f+t*s*f)*w,e[8]=_*w,e[9]=(d*u*i-c*p*i-d*n*f+t*p*f+c*n*v-t*u*v)*w,e[10]=(o*p*i-d*a*i+d*n*l-t*p*l-o*n*v+t*a*v)*w,e[11]=(c*a*i-o*u*i-c*n*l+t*u*l+o*n*f-t*a*f)*w,e[12]=x*w,e[13]=(c*p*r-d*u*r+d*n*h-t*p*h-c*n*m+t*u*m)*w,e[14]=(d*a*r-o*p*r-d*n*s+t*p*s+o*n*m-t*a*m)*w,e[15]=(o*u*r-c*a*r+c*n*s-t*u*s-o*n*h+t*a*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,l=i*o,c=i*a;return this.set(l*o+n,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+n,c*s-r*o,0,l*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,l=i+i,c=o+o,u=a+a,h=i*l,f=i*c,d=i*u,p=o*c,m=o*u,v=a*u,g=s*l,y=s*c,_=s*u,x=n.x,b=n.y,w=n.z;return r[0]=(1-(p+v))*x,r[1]=(f+_)*x,r[2]=(d-y)*x,r[3]=0,r[4]=(f-_)*b,r[5]=(1-(h+v))*b,r[6]=(m+g)*b,r[7]=0,r[8]=(d+y)*w,r[9]=(m-g)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Fr.set(r[0],r[1],r[2]).length();const o=Fr.set(r[4],r[5],r[6]).length(),a=Fr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Vr.copy(this);const s=1/i,l=1/o,c=1/a;return Vr.elements[0]*=s,Vr.elements[1]*=s,Vr.elements[2]*=s,Vr.elements[4]*=l,Vr.elements[5]*=l,Vr.elements[6]*=l,Vr.elements[8]*=c,Vr.elements[9]*=c,Vr.elements[10]*=c,t.setFromRotationMatrix(Vr),n.x=i,n.y=o,n.z=a,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(o+i)/(o-i),f=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,i,o){const a=this.elements,s=1/(t-e),l=1/(n-r),c=1/(o-i),u=(t+e)*s,h=(n+r)*l,f=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}zr.prototype.isMatrix4=!0;const Fr=new sr,Vr=new zr,Ur=new sr(0,0,0),Gr=new sr(1,1,1),Hr=new sr,jr=new sr,Wr=new sr,qr=new zr,Xr=new ar;class Yr{constructor(e=0,t=0,n=0,r=Yr.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],o=r[4],a=r[8],s=r[1],l=r[5],c=r[9],u=r[2],h=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(Gn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Gn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Gn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-Gn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Gn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Gn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return qr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qr,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Xr.setFromEuler(this),this.setFromQuaternion(Xr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new sr(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Yr.prototype.isEuler=!0,Yr.DefaultOrder="XYZ",Yr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Zr{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let $r=0;const Jr=new sr,Kr=new ar,Qr=new zr,ei=new sr,ti=new sr,ni=new sr,ri=new ar,ii=new sr(1,0,0),oi=new sr(0,1,0),ai=new sr(0,0,1),si={type:"added"},li={type:"removed"};class ci extends Dn{constructor(){super(),Object.defineProperty(this,"id",{value:$r++}),this.uuid=Un(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ci.DefaultUp.clone();const e=new sr,t=new Yr,n=new ar,r=new sr(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new zr},normalMatrix:{value:new $n}}),this.matrix=new zr,this.matrixWorld=new zr,this.matrixAutoUpdate=ci.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Zr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Kr.setFromAxisAngle(e,t),this.quaternion.multiply(Kr),this}rotateOnWorldAxis(e,t){return Kr.setFromAxisAngle(e,t),this.quaternion.premultiply(Kr),this}rotateX(e){return this.rotateOnAxis(ii,e)}rotateY(e){return this.rotateOnAxis(oi,e)}rotateZ(e){return this.rotateOnAxis(ai,e)}translateOnAxis(e,t){return Jr.copy(e).applyQuaternion(this.quaternion),this.position.add(Jr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ii,e)}translateY(e){return this.translateOnAxis(oi,e)}translateZ(e){return this.translateOnAxis(ai,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Qr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ei.copy(e):ei.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),ti.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qr.lookAt(ti,ei,this.up):Qr.lookAt(ei,ti,this.up),this.quaternion.setFromRotationMatrix(Qr),r&&(Qr.extractRotation(r.matrixWorld),Kr.setFromRotationMatrix(Qr),this.quaternion.premultiply(Kr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(si)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(li)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(li)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Qr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Qr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Qr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ti,e,ni),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ti,ri,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}ci.DefaultUp=new sr(0,1,0),ci.DefaultMatrixAutoUpdate=!0,ci.prototype.isObject3D=!0;const ui=new sr,hi=new sr,fi=new sr,di=new sr,pi=new sr,mi=new sr,vi=new sr,gi=new sr,yi=new sr,_i=new sr;class xi{constructor(e=new sr,t=new sr,n=new sr){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),ui.subVectors(e,t),r.cross(ui);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){ui.subVectors(r,t),hi.subVectors(n,t),fi.subVectors(e,t);const o=ui.dot(ui),a=ui.dot(hi),s=ui.dot(fi),l=hi.dot(hi),c=hi.dot(fi),u=o*l-a*a;if(0===u)return i.set(-2,-1,-1);const h=1/u,f=(l*s-a*c)*h,d=(o*c-a*s)*h;return i.set(1-f-d,d,f)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,di),di.x>=0&&di.y>=0&&di.x+di.y<=1}static getUV(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,di),s.set(0,0),s.addScaledVector(i,di.x),s.addScaledVector(o,di.y),s.addScaledVector(a,di.z),s}static isFrontFacing(e,t,n,r){return ui.subVectors(n,t),hi.subVectors(e,t),ui.cross(hi).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ui.subVectors(this.c,this.b),hi.subVectors(this.a,this.b),.5*ui.cross(hi).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return xi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return xi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return xi.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return xi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return xi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let o,a;pi.subVectors(r,n),mi.subVectors(i,n),gi.subVectors(e,n);const s=pi.dot(gi),l=mi.dot(gi);if(s<=0&&l<=0)return t.copy(n);yi.subVectors(e,r);const c=pi.dot(yi),u=mi.dot(yi);if(c>=0&&u<=c)return t.copy(r);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return o=s/(s-c),t.copy(n).addScaledVector(pi,o);_i.subVectors(e,i);const f=pi.dot(_i),d=mi.dot(_i);if(d>=0&&f<=d)return t.copy(i);const p=f*l-s*d;if(p<=0&&l>=0&&d<=0)return a=l/(l-d),t.copy(n).addScaledVector(mi,a);const m=c*d-f*u;if(m<=0&&u-c>=0&&f-d>=0)return vi.subVectors(i,r),a=(u-c)/(u-c+(f-d)),t.copy(r).addScaledVector(vi,a);const v=1/(m+p+h);return o=p*v,a=h*v,t.copy(n).addScaledVector(pi,o).addScaledVector(mi,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let bi=0;class wi extends Dn{constructor(){super(),Object.defineProperty(this,"id",{value:bi++}),this.uuid=Un(),this.name="",this.type="Material",this.fog=!0,this.blending=x,this.side=p,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=N,this.blendDst=O,this.blendEquation=E,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=j,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=un,this.stencilZFail=un,this.stencilZPass=un,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===g;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(n.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==x&&(n.blending=this.blending),this.side!==p&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}wi.prototype.isMaterial=!0;const Si={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mi={h:0,s:0,l:0},Ei={h:0,s:0,l:0};function Ti(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Ai(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ci(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Ri{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Hn(e,1),t=Gn(t,0,1),n=Gn(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Ti(i,r,e+1/3),this.g=Ti(i,r,e),this.b=Ti(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Si[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Ai(e.r),this.g=Ai(e.g),this.b=Ai(e.b),this}copyLinearToSRGB(e){return this.r=Ci(e.r),this.g=Ci(e.g),this.b=Ci(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let a,s;const l=(o+i)/2;if(o===i)a=0,s=0;else{const e=i-o;switch(s=l<=.5?e/(i+o):e/(2-i-o),i){case t:a=(n-r)/e+(n<r?6:0);break;case n:a=(r-t)/e+2;break;case r:a=(t-n)/e+4}a/=6}return e.h=a,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Mi),Mi.h+=e,Mi.s+=t,Mi.l+=n,this.setHSL(Mi.h,Mi.s,Mi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Mi),e.getHSL(Ei);const n=jn(Mi.h,Ei.h,t),r=jn(Mi.s,Ei.s,t),i=jn(Mi.l,Ei.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ri.NAMES=Si,Ri.prototype.isColor=!0,Ri.prototype.r=1,Ri.prototype.g=1,Ri.prototype.b=1;class Pi extends wi{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ri(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Pi.prototype.isMeshBasicMaterial=!0;const Li=new sr,ki=new Zn;class Ii{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=En,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Ri),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Zn),t[n++]=i.x,t[n++]=i.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new sr),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new nr),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ki.fromBufferAttribute(this,t),ki.applyMatrix3(e),this.setXY(t,ki.x,ki.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Li.fromBufferAttribute(this,t),Li.applyMatrix3(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Li.x=this.getX(t),Li.y=this.getY(t),Li.z=this.getZ(t),Li.applyMatrix4(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Li.x=this.getX(t),Li.y=this.getY(t),Li.z=this.getZ(t),Li.applyNormalMatrix(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Li.x=this.getX(t),Li.y=this.getY(t),Li.z=this.getZ(t),Li.transformDirection(e),this.setXYZ(t,Li.x,Li.y,Li.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==En&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Ii.prototype.isBufferAttribute=!0;class Ni extends Ii{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Oi extends Ii{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Di extends Ii{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Bi extends Ii{constructor(e,t,n){super(new Int16Array(e),t,n)}}class zi extends Ii{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Fi extends Ii{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Vi extends Ii{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Ui extends Ii{constructor(e,t,n){super(new Uint16Array(e),t,n)}}Ui.prototype.isFloat16BufferAttribute=!0;class Gi extends Ii{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Hi extends Ii{constructor(e,t,n){super(new Float64Array(e),t,n)}}function ji(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}const Wi={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function qi(e,t){return new Wi[e](t)}let Xi=0;const Yi=new zr,Zi=new ci,$i=new sr,Ji=new ur,Ki=new ur,Qi=new sr;class eo extends Dn{constructor(){super(),Object.defineProperty(this,"id",{value:Xi++}),this.uuid=Un(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ji(e)>65535?Vi:zi)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new $n).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Yi.makeRotationFromQuaternion(e),this.applyMatrix4(Yi),this}rotateX(e){return Yi.makeRotationX(e),this.applyMatrix4(Yi),this}rotateY(e){return Yi.makeRotationY(e),this.applyMatrix4(Yi),this}rotateZ(e){return Yi.makeRotationZ(e),this.applyMatrix4(Yi),this}translate(e,t,n){return Yi.makeTranslation(e,t,n),this.applyMatrix4(Yi),this}scale(e,t,n){return Yi.makeScale(e,t,n),this.applyMatrix4(Yi),this}lookAt(e){return Zi.lookAt(e),Zi.updateMatrix(),this.applyMatrix4(Zi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($i).negate(),this.translate($i.x,$i.y,$i.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Gi(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ur);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new sr(-1/0,-1/0,-1/0),new sr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Ji.setFromBufferAttribute(n),this.morphTargetsRelative?(Qi.addVectors(this.boundingBox.min,Ji.min),this.boundingBox.expandByPoint(Qi),Qi.addVectors(this.boundingBox.max,Ji.max),this.boundingBox.expandByPoint(Qi)):(this.boundingBox.expandByPoint(Ji.min),this.boundingBox.expandByPoint(Ji.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Rr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new sr,1/0);if(e){const n=this.boundingSphere.center;if(Ji.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Ki.setFromBufferAttribute(n),this.morphTargetsRelative?(Qi.addVectors(Ji.min,Ki.min),Ji.expandByPoint(Qi),Qi.addVectors(Ji.max,Ki.max),Ji.expandByPoint(Qi)):(Ji.expandByPoint(Ki.min),Ji.expandByPoint(Ki.max))}Ji.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)Qi.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Qi));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],a=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)Qi.fromBufferAttribute(o,t),a&&($i.fromBufferAttribute(e,t),Qi.add($i)),r=Math.max(r,n.distanceToSquared(Qi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,a=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Ii(new Float32Array(4*a),4));const s=t.tangent.array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new sr,c[e]=new sr;const u=new sr,h=new sr,f=new sr,d=new Zn,p=new Zn,m=new Zn,v=new sr,g=new sr;function y(e,t,n){u.fromArray(r,3*e),h.fromArray(r,3*t),f.fromArray(r,3*n),d.fromArray(o,2*e),p.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),f.sub(u),p.sub(d),m.sub(d);const i=1/(p.x*m.y-m.x*p.y);isFinite(i)&&(v.copy(h).multiplyScalar(m.y).addScaledVector(f,-p.y).multiplyScalar(i),g.copy(f).multiplyScalar(p.x).addScaledVector(h,-m.x).multiplyScalar(i),l[e].add(v),l[t].add(v),l[n].add(v),c[e].add(g),c[t].add(g),c[n].add(g))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)y(n[e+0],n[e+1],n[e+2])}const x=new sr,b=new sr,w=new sr,S=new sr;function M(e){w.fromArray(i,3*e),S.copy(w);const t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),b.crossVectors(S,t);const n=b.dot(c[e])<0?-1:1;s[4*e]=x.x,s[4*e+1]=x.y,s[4*e+2]=x.z,s[4*e+3]=n}for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)M(n[e+0]),M(n[e+1]),M(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Ii(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new sr,i=new sr,o=new sr,a=new sr,s=new sr,l=new sr,c=new sr,u=new sr;if(e)for(let h=0,f=e.count;h<f;h+=3){const f=e.getX(h+0),d=e.getX(h+1),p=e.getX(h+2);r.fromBufferAttribute(t,f),i.fromBufferAttribute(t,d),o.fromBufferAttribute(t,p),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),a.fromBufferAttribute(n,f),s.fromBufferAttribute(n,d),l.fromBufferAttribute(n,p),a.add(c),s.add(c),l.add(c),n.setXYZ(f,a.x,a.y,a.z),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,l=Math.min(a.length,i.length-s);for(let e=0,t=s;e<l;e++,t++)i[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Qi.fromBufferAttribute(e,t),Qi.normalize(),e.setXYZ(t,Qi.x,Qi.y,Qi.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let a=0,s=0;for(let i=0,l=t.length;i<l;i++){a=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)o[s++]=n[a++]}return new Ii(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new eo,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],a=i[r];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new eo).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}eo.prototype.isBufferGeometry=!0;const to=new zr,no=new Br,ro=new Rr,io=new sr,oo=new sr,ao=new sr,so=new sr,lo=new sr,co=new sr,uo=new sr,ho=new sr,fo=new sr,po=new Zn,mo=new Zn,vo=new Zn,go=new sr,yo=new sr;class _o extends ci{constructor(e=new eo,t=new Pi){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),ro.copy(n.boundingSphere),ro.applyMatrix4(i),!1===e.ray.intersectsSphere(ro))return;if(to.copy(i).invert(),no.copy(e.ray).applyMatrix4(to),null!==n.boundingBox&&!1===no.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,a=n.attributes.position,s=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,f=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,d=h.length;n<d;n++){const d=h[n],p=r[d.materialIndex];for(let n=Math.max(d.start,f.start),r=Math.min(d.start+d.count,f.start+f.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),f=i.getX(n+2);o=xo(this,p,e,no,a,s,l,c,u,r,h,f),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=d.materialIndex,t.push(o))}}else{for(let n=Math.max(0,f.start),h=Math.min(i.count,f.start+f.count);n<h;n+=3){const h=i.getX(n),f=i.getX(n+1),d=i.getX(n+2);o=xo(this,r,e,no,a,s,l,c,u,h,f,d),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}else if(void 0!==a)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],d=r[i.materialIndex];for(let n=Math.max(i.start,f.start),r=Math.min(i.start+i.count,f.start+f.count);n<r;n+=3){o=xo(this,d,e,no,a,s,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}}else{for(let n=Math.max(0,f.start),i=Math.min(a.count,f.start+f.count);n<i;n+=3){o=xo(this,r,e,no,a,s,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function xo(e,t,n,r,i,o,a,s,l,c,u,h){io.fromBufferAttribute(i,c),oo.fromBufferAttribute(i,u),ao.fromBufferAttribute(i,h);const f=e.morphTargetInfluences;if(o&&f){uo.set(0,0,0),ho.set(0,0,0),fo.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=f[e],n=o[e];0!==t&&(so.fromBufferAttribute(n,c),lo.fromBufferAttribute(n,u),co.fromBufferAttribute(n,h),a?(uo.addScaledVector(so,t),ho.addScaledVector(lo,t),fo.addScaledVector(co,t)):(uo.addScaledVector(so.sub(io),t),ho.addScaledVector(lo.sub(oo),t),fo.addScaledVector(co.sub(ao),t)))}io.add(uo),oo.add(ho),ao.add(fo)}e.isSkinnedMesh&&(e.boneTransform(c,io),e.boneTransform(u,oo),e.boneTransform(h,ao));const d=function(e,t,n,r,i,o,a,s){let l;if(l=t.side===m?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,t.side!==v,s),null===l)return null;yo.copy(s),yo.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(yo);return c<n.near||c>n.far?null:{distance:c,point:yo.clone(),object:e}}(e,t,n,r,io,oo,ao,go);if(d){s&&(po.fromBufferAttribute(s,c),mo.fromBufferAttribute(s,u),vo.fromBufferAttribute(s,h),d.uv=xi.getUV(go,io,oo,ao,po,mo,vo,new Zn)),l&&(po.fromBufferAttribute(l,c),mo.fromBufferAttribute(l,u),vo.fromBufferAttribute(l,h),d.uv2=xi.getUV(go,io,oo,ao,po,mo,vo,new Zn));const e={a:c,b:u,c:h,normal:new sr,materialIndex:0};xi.getNormal(io,oo,ao,e.normal),d.face=e}return d}_o.prototype.isMesh=!0;class bo extends eo{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const a=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const s=[],l=[],c=[],u=[];let h=0,f=0;function d(e,t,n,r,i,o,d,p,m,v,g){const y=o/m,_=d/v,x=o/2,b=d/2,w=p/2,S=m+1,M=v+1;let E=0,T=0;const A=new sr;for(let o=0;o<M;o++){const a=o*_-b;for(let s=0;s<S;s++){const h=s*y-x;A[e]=h*r,A[t]=a*i,A[n]=w,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=p>0?1:-1,c.push(A.x,A.y,A.z),u.push(s/m),u.push(1-o/v),E+=1}}for(let e=0;e<v;e++)for(let t=0;t<m;t++){const n=h+t+S*e,r=h+t+S*(e+1),i=h+(t+1)+S*(e+1),o=h+(t+1)+S*e;s.push(n,r,o),s.push(r,i,o),T+=6}a.addGroup(f,T,g),f+=T,h+=E}d("z","y","x",-1,-1,n,t,e,o,i,0),d("z","y","x",1,-1,n,t,-e,o,i,1),d("x","z","y",1,1,e,n,t,r,o,2),d("x","z","y",1,-1,e,n,-t,r,o,3),d("x","y","z",1,-1,e,t,n,r,i,4),d("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new Gi(l,3)),this.setAttribute("normal",new Gi(c,3)),this.setAttribute("uv",new Gi(u,2))}static fromJSON(e){return new bo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function wo(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function So(e){const t={};for(let n=0;n<e.length;n++){const r=wo(e[n]);for(const e in r)t[e]=r[e]}return t}const Mo={clone:wo,merge:So};class Eo extends wi{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=wo(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Eo.prototype.isShaderMaterial=!0;class To extends ci{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new zr,this.projectionMatrix=new zr,this.projectionMatrixInverse=new zr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}To.prototype.isCamera=!0;class Ao extends To{constructor(e=50,t=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Vn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Fn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Vn*Math.atan(Math.tan(.5*Fn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Fn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/a,r*=o.width/e,n*=o.height/a}const a=this.filmOffset;0!==a&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ao.prototype.isPerspectiveCamera=!0;class Co extends ci{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new Ao(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new sr(1,0,0)),this.add(r);const i=new Ao(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new sr(-1,0,0)),this.add(i);const o=new Ao(90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new sr(0,1,0)),this.add(o);const a=new Ao(90,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new sr(0,-1,0)),this.add(a);const s=new Ao(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new sr(0,0,1)),this.add(s);const l=new Ao(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new sr(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,o,a,s,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}class Ro extends er{constructor(e,t,n,r,i,o,a,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:oe,n,r,i,o,a=void 0!==a?a:Be,s,l,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ro.prototype.isCubeTexture=!0;class Po extends rr{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new Ro(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:_e,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=ze,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new bo(5,5,5),i=new Eo({name:"CubemapFromEquirect",uniforms:wo(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:m,blending:_});i.uniforms.tEquirect.value=t;const o=new _o(r,i),a=t.minFilter;t.minFilter===we&&(t.minFilter=_e);return new Co(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}Po.prototype.isWebGLCubeRenderTarget=!0;const Lo=new sr,ko=new sr,Io=new $n;class No{constructor(e=new sr(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Lo.subVectors(n,t).cross(ko.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Lo),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Io.getNormalMatrix(e),r=this.coplanarPoint(Lo).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}No.prototype.isPlane=!0;const Oo=new Rr,Do=new sr;class Bo{constructor(e=new No,t=new No,n=new No,r=new No,i=new No,o=new No){this.planes=[e,t,n,r,i,o]}set(e,t,n,r,i,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],f=n[9],d=n[10],p=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(a-r,u-s,p-h,y-m).normalize(),t[1].setComponents(a+r,u+s,p+h,y+m).normalize(),t[2].setComponents(a+i,u+l,p+f,y+v).normalize(),t[3].setComponents(a-i,u-l,p-f,y-v).normalize(),t[4].setComponents(a-o,u-c,p-d,y-g).normalize(),t[5].setComponents(a+o,u+c,p+d,y+g).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Oo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Oo)}intersectsSprite(e){return Oo.center.set(0,0,0),Oo.radius=.7071067811865476,Oo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Oo)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Do.x=r.normal.x>0?e.max.x:e.min.x,Do.y=r.normal.y>0?e.max.y:e.min.y,Do.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Do)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function zo(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Fo(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,i,o),t.onUploadCallback();let s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(s=5121),{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){const o=r.array,a=r.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,i),o.version=t.version)}}}class Vo extends eo{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,a=Math.floor(n),s=Math.floor(r),l=a+1,c=s+1,u=e/a,h=t/s,f=[],d=[],p=[],m=[];for(let e=0;e<c;e++){const t=e*h-o;for(let n=0;n<l;n++){const r=n*u-i;d.push(r,-t,0),p.push(0,0,1),m.push(n/a),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),o=t+1+l*e;f.push(n,r,o),f.push(r,i,o)}this.setIndex(f),this.setAttribute("position",new Gi(d,3)),this.setAttribute("normal",new Gi(p,3)),this.setAttribute("uv",new Gi(m,2))}static fromJSON(e){return new Vo(e.width,e.height,e.widthSegments,e.heightSegments)}}const Uo={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in vec3 f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn ( f90 - f0 ) * fresnel + f0;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in vec3 f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, vec3( 1.0 ), dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\t#ifdef SPECULAR\n\t\tvec3 specularIntensityFactor = vec3( specularIntensity );\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularColorF90 = mix( specularIntensityFactor, vec3( 1.0 ), metalnessFactor );\n\t#else\n\t\tvec3 specularIntensityFactor = vec3( 1.0 );\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularColorF90 = vec3( 1.0 );\n\t#endif\n\tmaterial.specularColor = mix( min( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularColorF90 = vec3( 1.0 );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n\tvec3 specularColorF90;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), vec3( 1.0 ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularColorF90, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 transmission = transmissionFactor * getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t\t#ifdef USE_TANGENT\n\t\t\tvTangent = normalize( transformedTangent );\n\t\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t\t#endif\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Go={common:{diffuse:{value:new Ri(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new $n},uv2Transform:{value:new $n},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Zn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ri(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ri(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $n}},sprite:{diffuse:{value:new Ri(16777215)},opacity:{value:1},center:{value:new Zn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $n}}},Ho={basic:{uniforms:So([Go.common,Go.specularmap,Go.envmap,Go.aomap,Go.lightmap,Go.fog]),vertexShader:Uo.meshbasic_vert,fragmentShader:Uo.meshbasic_frag},lambert:{uniforms:So([Go.common,Go.specularmap,Go.envmap,Go.aomap,Go.lightmap,Go.emissivemap,Go.fog,Go.lights,{emissive:{value:new Ri(0)}}]),vertexShader:Uo.meshlambert_vert,fragmentShader:Uo.meshlambert_frag},phong:{uniforms:So([Go.common,Go.specularmap,Go.envmap,Go.aomap,Go.lightmap,Go.emissivemap,Go.bumpmap,Go.normalmap,Go.displacementmap,Go.fog,Go.lights,{emissive:{value:new Ri(0)},specular:{value:new Ri(1118481)},shininess:{value:30}}]),vertexShader:Uo.meshphong_vert,fragmentShader:Uo.meshphong_frag},standard:{uniforms:So([Go.common,Go.envmap,Go.aomap,Go.lightmap,Go.emissivemap,Go.bumpmap,Go.normalmap,Go.displacementmap,Go.roughnessmap,Go.metalnessmap,Go.fog,Go.lights,{emissive:{value:new Ri(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Uo.meshphysical_vert,fragmentShader:Uo.meshphysical_frag},toon:{uniforms:So([Go.common,Go.aomap,Go.lightmap,Go.emissivemap,Go.bumpmap,Go.normalmap,Go.displacementmap,Go.gradientmap,Go.fog,Go.lights,{emissive:{value:new Ri(0)}}]),vertexShader:Uo.meshtoon_vert,fragmentShader:Uo.meshtoon_frag},matcap:{uniforms:So([Go.common,Go.bumpmap,Go.normalmap,Go.displacementmap,Go.fog,{matcap:{value:null}}]),vertexShader:Uo.meshmatcap_vert,fragmentShader:Uo.meshmatcap_frag},points:{uniforms:So([Go.points,Go.fog]),vertexShader:Uo.points_vert,fragmentShader:Uo.points_frag},dashed:{uniforms:So([Go.common,Go.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Uo.linedashed_vert,fragmentShader:Uo.linedashed_frag},depth:{uniforms:So([Go.common,Go.displacementmap]),vertexShader:Uo.depth_vert,fragmentShader:Uo.depth_frag},normal:{uniforms:So([Go.common,Go.bumpmap,Go.normalmap,Go.displacementmap,{opacity:{value:1}}]),vertexShader:Uo.normal_vert,fragmentShader:Uo.normal_frag},sprite:{uniforms:So([Go.sprite,Go.fog]),vertexShader:Uo.sprite_vert,fragmentShader:Uo.sprite_frag},background:{uniforms:{uvTransform:{value:new $n},t2D:{value:null}},vertexShader:Uo.background_vert,fragmentShader:Uo.background_frag},cube:{uniforms:So([Go.envmap,{opacity:{value:1}}]),vertexShader:Uo.cube_vert,fragmentShader:Uo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Uo.equirect_vert,fragmentShader:Uo.equirect_frag},distanceRGBA:{uniforms:So([Go.common,Go.displacementmap,{referencePosition:{value:new sr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Uo.distanceRGBA_vert,fragmentShader:Uo.distanceRGBA_frag},shadow:{uniforms:So([Go.lights,Go.fog,{color:{value:new Ri(0)},opacity:{value:1}}]),vertexShader:Uo.shadow_vert,fragmentShader:Uo.shadow_frag}};function jo(e,t,n,r,i){const o=new Ri(0);let a,s,l=0,c=null,u=0,h=null;function f(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),l=t,f(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,f(o,l)},render:function(n,i){let d=!1,v=!0===i.isScene?i.background:null;v&&v.isTexture&&(v=t.get(v));const g=e.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(v=null),null===v?f(o,l):v&&v.isColor&&(f(v,1),d=!0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===ce)?(void 0===s&&(s=new _o(new bo(1,1,1),new Eo({name:"BackgroundCubeMaterial",uniforms:wo(Ho.cube.uniforms),vertexShader:Ho.cube.vertexShader,fragmentShader:Ho.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=v,s.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,c===v&&u===v.version&&h===e.toneMapping||(s.material.needsUpdate=!0,c=v,u=v.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null)):v&&v.isTexture&&(void 0===a&&(a=new _o(new Vo(2,2),new Eo({name:"BackgroundMaterial",uniforms:wo(Ho.background.uniforms),vertexShader:Ho.background.vertexShader,fragmentShader:Ho.background.fragmentShader,side:p,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(a)),a.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),a.material.uniforms.uvTransform.value.copy(v.matrix),c===v&&u===v.version&&h===e.toneMapping||(a.material.needsUpdate=!0,c=v,u=v.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Wo(e,t,n,r){const i=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},l=f(null);let c=l;function u(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function f(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function d(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function p(e){m(e,0)}function m(n,i){const o=c.newAttributes,a=c.enabledAttributes,s=c.attributeDivisors;if(o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==i){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i}}function v(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function g(t,n,i,o,a,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,o,a,s):e.vertexAttribIPointer(t,n,i,a,s)}function y(){_(),c!==l&&(c=l,u(c.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,_){let x=!1;if(a){const t=function(t,n,i){const a=!0===i.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[a];void 0===u&&(u=f(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[a]=u);return u}(y,h,l);c!==t&&(c=t,u(c.object)),x=function(e,t){const n=c.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return c.attributesNum!==i||c.index!==t}(y,_),x&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}c.attributes=n,c.attributesNum=i,c.index=t}(y,_)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==_&&n.update(_,34963),x&&(!function(i,o,a,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();const l=s.attributes,c=a.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const r=c[t];if(r>=0){const o=l[t];if(void 0!==o){const t=o.normalized,i=o.itemSize,a=n.get(o);if(void 0===a)continue;const l=a.buffer,c=a.type,u=a.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,a=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)):p(r),e.bindBuffer(34962,l),g(r,i,c,t,a*u,h*u)}else o.isInstancedBufferAttribute?(m(r,o.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)):p(r),e.bindBuffer(34962,l),g(r,i,c,t,0,0)}else if("instanceMatrix"===t){const t=n.get(i.instanceMatrix);if(void 0===t)continue;const o=t.buffer,a=t.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r+0,4,a,!1,64,0),e.vertexAttribPointer(r+1,4,a,!1,64,16),e.vertexAttribPointer(r+2,4,a,!1,64,32),e.vertexAttribPointer(r+3,4,a,!1,64,48)}else if("instanceColor"===t){const t=n.get(i.instanceColor);if(void 0===t)continue;const o=t.buffer,a=t.type;m(r,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r,3,a,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r,n);break;case 3:e.vertexAttrib3fv(r,n);break;case 4:e.vertexAttrib4fv(r,n);break;default:e.vertexAttrib1fv(r,n)}}}}v()}(i,l,h,y),null!==_&&e.bindBuffer(34963,n.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:d,enableAttribute:p,disableUnusedAttributes:v}}function qo(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,a,s){if(0===s)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,r,a,s),n.update(a,o,s)}}function Xo(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=o||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),f=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),m=e.getParameter(36347),v=e.getParameter(36348),g=e.getParameter(36349),y=h>0,_=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:o?e.getParameter(36183):0}}function Yo(e){const t=this;let n=null,r=0,i=!1,o=!1;const a=new No,s=new $n,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,n,r,i){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==i||null===c){const t=r+4*o,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)a.copy(e[t]).applyMatrix4(i,s),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const a=0!==e.length||t||0!==r||i;return i=t,n=u(e,o,0),r=e.length,a},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,a,s){const h=t.clippingPlanes,f=t.clipIntersection,d=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||o&&!d)o?u(null):c();else{const e=o?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=u(h,a,t,s);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=e}}}function Zo(e){let t=new WeakMap;function n(e,t){return t===se?e.mapping=oe:t===le&&(e.mapping=ae),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const o=i.mapping;if(o===se||o===le){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const a=e.getRenderTarget(),s=new Po(o.height/2);return s.fromEquirectangularTexture(e,i),t.set(i,s),e.setRenderTarget(a),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}Ho.physical={uniforms:So([Ho.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Zn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ri(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Zn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Ri(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Ri(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Uo.meshphysical_vert,fragmentShader:Uo.meshphysical_frag};class $o extends To{constructor(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}$o.prototype.isOrthographicCamera=!0;class Jo extends Eo{constructor(e){super(e),this.type="RawShaderMaterial"}}Jo.prototype.isRawShaderMaterial=!0;const Ko=Math.pow(2,8),Qo=[.125,.215,.35,.446,.526,.582],ea=5+Qo.length,ta={[$t]:0,[Jt]:1,[Qt]:2,[tn]:3,[nn]:4,[rn]:5,[Kt]:6},na=new Pi({side:m,depthWrite:!1,depthTest:!1}),ra=new _o(new bo,na),ia=new $o,{_lodPlanes:oa,_sizeLods:aa,_sigmas:sa}=va(),la=new Ri;let ca=null;const ua=(1+Math.sqrt(5))/2,ha=1/ua,fa=[new sr(1,1,1),new sr(-1,1,1),new sr(1,1,-1),new sr(-1,1,-1),new sr(0,ua,ha),new sr(0,ua,-ha),new sr(ha,0,ua),new sr(-ha,0,ua),new sr(ua,ha,0),new sr(-ua,ha,0)];function da(e){const t=Math.max(e.r,e.g,e.b),n=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);e.multiplyScalar(Math.pow(2,-n));return(n+128)/255}class pa{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),n=new sr(0,1,0);return new Jo({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:ta[$t]},outputEncoding:{value:ta[$t]}},vertexShader:ba(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${wa()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:_,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){ca=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=xa(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_a(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<oa.length;e++)oa[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(ca),e.scissorTest=!1,ya(e,0,0,e.width,e.height)}_fromTexture(e){ca=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:pe,minFilter:pe,generateMipmaps:!1,type:Me,format:Ue,encoding:ma(e)?e.encoding:Qt,depthBuffer:!1},n=ga(t);return n.depthBuffer=!e,this._pingPongRenderTarget=ga(t),n}_compileMaterial(e){const t=new _o(oa[0],e);this._renderer.compile(t,ia)}_sceneToCubeUV(e,t,n,r){const i=new Ao(90,1,t,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.outputEncoding,u=s.toneMapping;s.getClearColor(la),s.toneMapping=K,s.outputEncoding=$t,s.autoClear=!1;let h=!1;const f=e.background;if(f){if(f.isColor){na.color.copy(f).convertSRGBToLinear(),e.background=null;const t=da(na.color);na.opacity=t,h=!0}}else{na.color.copy(la).convertSRGBToLinear();const e=da(na.color);na.opacity=e,h=!0}for(let t=0;t<6;t++){const n=t%3;0==n?(i.up.set(0,o[t],0),i.lookAt(a[t],0,0)):1==n?(i.up.set(0,0,o[t]),i.lookAt(0,a[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,a[t])),ya(r,n*Ko,t>2?Ko:0,Ko,Ko),s.setRenderTarget(r),h&&s.render(ra,i),s.render(e,i)}s.toneMapping=u,s.outputEncoding=c,s.autoClear=l}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=xa()):null==this._equirectShader&&(this._equirectShader=_a());const r=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new _o(oa[0],r),o=r.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=ta[e.encoding],o.outputEncoding.value=ta[t.texture.encoding],ya(t,0,0,3*Ko,2*Ko),n.setRenderTarget(t),n.render(i,ia)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<ea;t++){const n=Math.sqrt(sa[t]*sa[t]-sa[t-1]*sa[t-1]),r=fa[(t-1)%fa.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,a){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new _o(oa[r],l),u=l.uniforms,h=aa[n]-1,f=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,d=i/f,p=isFinite(i)?1+Math.floor(3*d):20;p>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let v=0;for(let e=0;e<20;++e){const t=e/d,n=Math.exp(-t*t/2);m.push(n),0==e?v+=n:e<p&&(v+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/v;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=m,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a),u.dTheta.value=f,u.mipInt.value=8-n,u.inputEncoding.value=ta[e.texture.encoding],u.outputEncoding.value=ta[e.texture.encoding];const g=aa[r];ya(t,3*Math.max(0,Ko-2*g),(0===r?0:2*Ko)+2*g*(r>4?r-8+4:0),3*g,2*g),s.setRenderTarget(t),s.render(c,ia)}}function ma(e){return void 0!==e&&e.type===Me&&(e.encoding===$t||e.encoding===Jt||e.encoding===Kt)}function va(){const e=[],t=[],n=[];let r=8;for(let i=0;i<ea;i++){const o=Math.pow(2,r);t.push(o);let a=1/o;i>4?a=Qo[i-8+4-1]:0==i&&(a=0),n.push(a);const s=1/(o-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,f=6,d=3,p=2,m=1,v=new Float32Array(d*f*h),g=new Float32Array(p*f*h),y=new Float32Array(m*f*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,d*f*e),g.set(u,p*f*e);const i=[e,e,e,e,e,e];y.set(i,m*f*e)}const _=new eo;_.setAttribute("position",new Ii(v,d)),_.setAttribute("uv",new Ii(g,p)),_.setAttribute("faceIndex",new Ii(y,m)),e.push(_),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function ga(e){const t=new rr(3*Ko,3*Ko,e);return t.texture.mapping=ce,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function ya(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function _a(){const e=new Zn(1,1);return new Jo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ta[$t]},outputEncoding:{value:ta[$t]}},vertexShader:ba(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${wa()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:_,depthTest:!1,depthWrite:!1})}function xa(){return new Jo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ta[$t]},outputEncoding:{value:ta[$t]}},vertexShader:ba(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${wa()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:_,depthTest:!1,depthWrite:!1})}function ba(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function wa(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Sa(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(i.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const o=i.mapping,a=o===se||o===le,s=o===oe||o===ae;if(a||s){if(t.has(i))return t.get(i).texture;{const o=i.image;if(a&&o&&o.height>0||s&&o&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(o)){const o=e.getRenderTarget();null===n&&(n=new pa(e));const s=a?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,s),e.setRenderTarget(o),i.addEventListener("dispose",r),s.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ma(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ea(e,t,n,r){const i={},o=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",a),delete i[s.id];const l=o.get(s);l&&(t.remove(l),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let a=0;if(null!==r){const e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;a=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const s=new(ji(n)>65535?Vi:zi)(n,1);s.version=a;const l=o.get(e);l&&t.remove(l),o.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",a),i[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const r=e.morphAttributes;for(const e in r){const n=r[e];for(let e=0,r=n.length;e<r;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function Ta(e,t,n,r){const i=r.isWebGL2;let o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,a,t*s),n.update(r,o,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,a,r*s,c),n.update(l,o,c)}}function Aa(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Ca(e,t){return e[0]-t[0]}function Ra(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Pa(e){const t={},n=new Float32Array(8),r=[];for(let e=0;e<8;e++)r[e]=[e,0];return{update:function(i,o,a,s){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=t[o.id];if(void 0===u||u.length!==c){u=[];for(let e=0;e<c;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<c;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(Ra);for(let e=0;e<8;e++)e<c&&u[e][1]?(r[e][0]=u[e][0],r[e][1]=u[e][1]):(r[e][0]=Number.MAX_SAFE_INTEGER,r[e][1]=0);r.sort(Ca);const h=o.morphAttributes.position,f=o.morphAttributes.normal;let d=0;for(let e=0;e<8;e++){const t=r[e],i=t[0],a=t[1];i!==Number.MAX_SAFE_INTEGER&&a?(h&&o.getAttribute("morphTarget"+e)!==h[i]&&o.setAttribute("morphTarget"+e,h[i]),f&&o.getAttribute("morphNormal"+e)!==f[i]&&o.setAttribute("morphNormal"+e,f[i]),n[e]=a,d+=a):(h&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),f&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const p=o.morphTargetsRelative?1:1-d;s.getUniforms().setValue(e,"morphTargetBaseInfluence",p),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function La(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const a=r.render.frame,s=e.geometry,l=t.get(e,s);return i.get(l)!==a&&(t.update(l),i.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}class ka extends er{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=pe,this.minFilter=pe,this.wrapR=fe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ka.prototype.isDataTexture2DArray=!0;class Ia extends er{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=pe,this.minFilter=pe,this.wrapR=fe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Ia.prototype.isDataTexture3D=!0;const Na=new er,Oa=new ka,Da=new Ia,Ba=new Ro,za=[],Fa=[],Va=new Float32Array(16),Ua=new Float32Array(9),Ga=new Float32Array(4);function Ha(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=za[i];if(void 0===o&&(o=new Float32Array(i),za[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function ja(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Wa(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function qa(e,t){let n=Fa[t];void 0===n&&(n=new Int32Array(t),Fa[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Xa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Ya(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ja(n,t))return;e.uniform2fv(this.addr,t),Wa(n,t)}}function Za(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ja(n,t))return;e.uniform3fv(this.addr,t),Wa(n,t)}}function $a(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ja(n,t))return;e.uniform4fv(this.addr,t),Wa(n,t)}}function Ja(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ja(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Wa(n,t)}else{if(ja(n,r))return;Ga.set(r),e.uniformMatrix2fv(this.addr,!1,Ga),Wa(n,r)}}function Ka(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ja(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Wa(n,t)}else{if(ja(n,r))return;Ua.set(r),e.uniformMatrix3fv(this.addr,!1,Ua),Wa(n,r)}}function Qa(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ja(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Wa(n,t)}else{if(ja(n,r))return;Va.set(r),e.uniformMatrix4fv(this.addr,!1,Va),Wa(n,r)}}function es(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ts(e,t){const n=this.cache;ja(n,t)||(e.uniform2iv(this.addr,t),Wa(n,t))}function ns(e,t){const n=this.cache;ja(n,t)||(e.uniform3iv(this.addr,t),Wa(n,t))}function rs(e,t){const n=this.cache;ja(n,t)||(e.uniform4iv(this.addr,t),Wa(n,t))}function is(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function os(e,t){const n=this.cache;ja(n,t)||(e.uniform2uiv(this.addr,t),Wa(n,t))}function as(e,t){const n=this.cache;ja(n,t)||(e.uniform3uiv(this.addr,t),Wa(n,t))}function ss(e,t){const n=this.cache;ja(n,t)||(e.uniform4uiv(this.addr,t),Wa(n,t))}function ls(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Na,i)}function cs(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Da,i)}function us(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Ba,i)}function hs(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Oa,i)}function fs(e,t){e.uniform1fv(this.addr,t)}function ds(e,t){const n=Ha(t,this.size,2);e.uniform2fv(this.addr,n)}function ps(e,t){const n=Ha(t,this.size,3);e.uniform3fv(this.addr,n)}function ms(e,t){const n=Ha(t,this.size,4);e.uniform4fv(this.addr,n)}function vs(e,t){const n=Ha(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function gs(e,t){const n=Ha(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ys(e,t){const n=Ha(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function _s(e,t){e.uniform1iv(this.addr,t)}function xs(e,t){e.uniform2iv(this.addr,t)}function bs(e,t){e.uniform3iv(this.addr,t)}function ws(e,t){e.uniform4iv(this.addr,t)}function Ss(e,t){e.uniform1uiv(this.addr,t)}function Ms(e,t){e.uniform2uiv(this.addr,t)}function Es(e,t){e.uniform3uiv(this.addr,t)}function Ts(e,t){e.uniform4uiv(this.addr,t)}function As(e,t,n){const r=t.length,i=qa(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||Na,i[e])}function Cs(e,t,n){const r=t.length,i=qa(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||Ba,i[e])}function Rs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Xa;case 35664:return Ya;case 35665:return Za;case 35666:return $a;case 35674:return Ja;case 35675:return Ka;case 35676:return Qa;case 5124:case 35670:return es;case 35667:case 35671:return ts;case 35668:case 35672:return ns;case 35669:case 35673:return rs;case 5125:return is;case 36294:return os;case 36295:return as;case 36296:return ss;case 35678:case 36198:case 36298:case 36306:case 35682:return ls;case 35679:case 36299:case 36307:return cs;case 35680:case 36300:case 36308:case 36293:return us;case 36289:case 36303:case 36311:case 36292:return hs}}(t.type)}function Ps(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return fs;case 35664:return ds;case 35665:return ps;case 35666:return ms;case 35674:return vs;case 35675:return gs;case 35676:return ys;case 5124:case 35670:return _s;case 35667:case 35671:return xs;case 35668:case 35672:return bs;case 35669:case 35673:return ws;case 5125:return Ss;case 36294:return Ms;case 36295:return Es;case 36296:return Ts;case 35678:case 36198:case 36298:case 36306:case 35682:return As;case 35680:case 36300:case 36308:case 36293:return Cs}}(t.type)}function Ls(e){this.id=e,this.seq=[],this.map={}}Ps.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Wa(t,e)},Ls.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const ks=/(\w+)(\])?(\[|\.)?/g;function Is(e,t){e.seq.push(t),e.map[t.id]=t}function Ns(e,t,n){const r=e.name,i=r.length;for(ks.lastIndex=0;;){const o=ks.exec(r),a=ks.lastIndex;let s=o[1];const l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===i){Is(n,void 0===c?new Rs(s,e,t):new Ps(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new Ls(s),Is(n,e)),n=e}}}function Os(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Ns(n,e.getUniformLocation(t,n.name),this)}}function Ds(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}Os.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Os.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},Os.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],a=n[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,r)}},Os.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let Bs=0;function zs(e){switch(e){case $t:return["Linear","( value )"];case Jt:return["sRGB","( value )"];case Qt:return["RGBE","( value )"];case tn:return["RGBM","( value, 7.0 )"];case nn:return["RGBM","( value, 16.0 )"];case rn:return["RGBD","( value, 256.0 )"];case Kt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case en:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Fs(e,t,n){const r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function Vs(e,t){const n=zs(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Us(e,t){const n=zs(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Gs(e,t){let n;switch(t){case Q:n="Linear";break;case ee:n="Reinhard";break;case te:n="OptimizedCineon";break;case ne:n="ACESFilmic";break;case re:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Hs(e){return""!==e}function js(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ws(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const qs=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xs(e){return e.replace(qs,Ys)}function Ys(e,t){const n=Uo[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Xs(n)}const Zs=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,$s=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Js(e){return e.replace($s,Qs).replace(Zs,Ks)}function Ks(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Qs(e,t,n,r)}function Qs(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function el(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function tl(e,t,n,r){const i=e.getContext(),o=n.defines;let a=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===f?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===d&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case oe:case ae:t="ENVMAP_TYPE_CUBE";break;case ce:case ue:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ae:case ue:t="ENVMAP_MODE_REFRACTION"}return t}(n),p=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Z:t="ENVMAP_BLENDING_MULTIPLY";break;case $:t="ENVMAP_BLENDING_MIX";break;case J:t="ENVMAP_BLENDING_ADD"}return t}(n),m=e.gammaFactor>0?e.gammaFactor:1,v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission>0)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Hs).join("\n")}(n),g=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(o),y=i.createProgram();let _,x,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(_=[g].filter(Hs).join("\n"),_.length>0&&(_+="\n"),x=[v,g].filter(Hs).join("\n"),x.length>0&&(x+="\n")):(_=[el(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Hs).join("\n"),x=[v,el(n),"#define SHADER_NAME "+n.shaderName,g,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==K?"#define TONE_MAPPING":"",n.toneMapping!==K?Uo.tonemapping_pars_fragment:"",n.toneMapping!==K?Gs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Uo.encodings_pars_fragment,n.map?Vs("mapTexelToLinear",n.mapEncoding):"",n.matcap?Vs("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Vs("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Vs("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularTintMap?Vs("specularTintMapTexelToLinear",n.specularTintMapEncoding):"",n.lightMap?Vs("lightMapTexelToLinear",n.lightMapEncoding):"",Us("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Hs).join("\n")),a=Xs(a),a=js(a,n),a=Ws(a,n),s=Xs(s),s=js(s,n),s=Ws(s,n),a=Js(a),s=Js(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",_=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,x=["#define varying in",n.glslVersion===On?"":"out highp vec4 pc_fragColor;",n.glslVersion===On?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const w=b+x+s,S=Ds(i,35633,b+_+a),M=Ds(i,35632,w);if(i.attachShader(y,S),i.attachShader(y,M),void 0!==n.index0AttributeName?i.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y),e.debug.checkShaderErrors){const e=i.getProgramInfoLog(y).trim(),t=i.getShaderInfoLog(S).trim(),n=i.getShaderInfoLog(M).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(y,35714)){r=!1;const t=Fs(i,S,"vertex"),n=Fs(i,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(y,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:_},fragmentShader:{log:n,prefix:x}})}let E,T;return i.deleteShader(S),i.deleteShader(M),this.getUniforms=function(){return void 0===E&&(E=new Os(i,y)),E},this.getAttributes=function(){return void 0===T&&(T=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i).name;n[r]=e.getAttribLocation(t,r)}return n}(i,y)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=Bs++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=S,this.fragmentShader=M,this}function nl(e,t,n,r,i,o,a){const s=[],l=i.isWebGL2,c=i.logarithmicDepthBuffer,u=i.floatVertexTextures,h=i.maxVertexUniforms,f=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},g=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function y(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=$t,t}return{getParameters:function(o,s,g,_,x){const b=_.fog,w=o.isMeshStandardMaterial?_.environment:null,S=(o.isMeshStandardMaterial?n:t).get(o.envMap||w),M=p[o.type],E=x.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(u)return 1024;{const e=h,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(x):0;let T,A;if(null!==o.precision&&(d=i.getMaxPrecision(o.precision),d!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",d,"instead.")),M){const e=Ho[M];T=e.vertexShader,A=e.fragmentShader}else T=o.vertexShader,A=o.fragmentShader;const C=e.getRenderTarget();return{isWebGL2:l,shaderID:M,shaderName:o.type,vertexShader:T,fragmentShader:A,defines:o.defines,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:d,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:f,outputEncoding:null!==C?y(C.texture):e.outputEncoding,map:!!o.map,mapEncoding:y(o.map),matcap:!!o.matcap,matcapEncoding:y(o.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:y(S),envMapCubeUV:!!S&&(S.mapping===ce||S.mapping===ue),lightMap:!!o.lightMap,lightMapEncoding:y(o.lightMap),aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,emissiveMapEncoding:y(o.emissiveMap),bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:o.normalMapType===ln,tangentSpaceNormalMap:o.normalMapType===sn,clearcoatMap:!!o.clearcoatMap,clearcoatRoughnessMap:!!o.clearcoatRoughnessMap,clearcoatNormalMap:!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularTintMap:!!o.specularTintMap,specularTintMapEncoding:y(o.specularTintMap),alphaMap:!!o.alphaMap,gradientMap:!!o.gradientMap,sheen:!!o.sheen,transmission:!!o.transmission,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!x.geometry&&!!x.geometry.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!x.geometry&&!!x.geometry.attributes.color&&4===x.geometry.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularTintMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularTintMap||!o.displacementMap),fog:!!b,useFog:o.fog,fogExp2:b&&b.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===x.isSkinnedMesh&&E>0,maxBones:E,useVertexTexture:u,morphTargets:!!x.geometry&&!!x.geometry.morphAttributes.position,morphNormals:!!x.geometry&&!!x.geometry.morphAttributes.normal,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&g.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:K,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,alphaTest:o.alphaTest,doubleSided:o.side===v,flipSided:o.side===m,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<g.length;e++)n.push(t[g[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=Ho[t];n=Mo.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=s.length;e<t;e++){const t=s[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new tl(e,n,t,o),s.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function rl(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function il(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ol(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function al(e){const t=[];let n=0;const r=[],i=[],o=[],a={id:-1};function s(r,i,o,s,l,c){let u=t[n];const h=e.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||a,groupOrder:s,renderOrder:r.renderOrder,z:l,group:c},t[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||a,u.groupOrder=s,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transmissive:i,transparent:o,init:function(){n=0,r.length=0,i.length=0,o.length=0},push:function(e,t,n,a,l,c){const u=s(e,t,n,a,l,c);n.transmission>0?i.push(u):!0===n.transparent?o.push(u):r.push(u)},unshift:function(e,t,n,a,l,c){const u=s(e,t,n,a,l,c);n.transmission>0?i.unshift(u):!0===n.transparent?o.unshift(u):r.unshift(u)},finish:function(){for(let e=n,r=t.length;e<r;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||il),i.length>1&&i.sort(t||ol),o.length>1&&o.sort(t||ol)}}}function sl(e){let t=new WeakMap;return{get:function(n,r){let i;return!1===t.has(n)?(i=new al(e),t.set(n,[i])):r>=t.get(n).length?(i=new al(e),t.get(n).push(i)):i=t.get(n)[r],i},dispose:function(){t=new WeakMap}}}function ll(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new sr,color:new Ri};break;case"SpotLight":n={position:new sr,direction:new sr,color:new Ri,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new sr,color:new Ri,distance:0,decay:0};break;case"HemisphereLight":n={direction:new sr,skyColor:new Ri,groundColor:new Ri};break;case"RectAreaLight":n={color:new Ri,position:new sr,halfWidth:new sr,halfHeight:new sr}}return e[t.id]=n,n}}}let cl=0;function ul(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function hl(e,t){const n=new ll,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new sr);const o=new sr,a=new zr,s=new zr;return{setup:function(o){let a=0,s=0,l=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let c=0,u=0,h=0,f=0,d=0,p=0,m=0,v=0;o.sort(ul);for(let e=0,t=o.length;e<t;e++){const t=o[e],g=t.color,y=t.intensity,_=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=g.r*y,s+=g.g*y,l+=g.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[c]=n,i.directionalShadowMap[c]=x,i.directionalShadowMatrix[c]=t.shadow.matrix,p++}i.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(g).multiplyScalar(y),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=x,i.spotShadowMatrix[h]=t.shadow.matrix,v++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(g).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[f]=e,f++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=x,i.pointShadowMatrix[u]=t.shadow.matrix,m++}i.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),i.hemi[d]=e,d++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=Go.LTC_FLOAT_1,i.rectAreaLTC2=Go.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Go.LTC_HALF_1,i.rectAreaLTC2=Go.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=s,i.ambient[2]=l;const g=i.hash;g.directionalLength===c&&g.pointLength===u&&g.spotLength===h&&g.rectAreaLength===f&&g.hemiLength===d&&g.numDirectionalShadows===p&&g.numPointShadows===m&&g.numSpotShadows===v||(i.directional.length=c,i.spot.length=h,i.rectArea.length=f,i.point.length=u,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=v,g.directionalLength=c,g.pointLength=u,g.spotLength=h,g.rectAreaLength=f,g.hemiLength=d,g.numDirectionalShadows=p,g.numPointShadows=m,g.numSpotShadows=v,i.version=cl++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,f=e.length;t<f;t++){const f=e[t];if(f.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(f.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(f.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(f.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(f.matrixWorld),e.position.applyMatrix4(h),s.identity(),a.copy(f.matrixWorld),a.premultiply(h),s.extractRotation(a),e.halfWidth.set(.5*f.width,0,0),e.halfHeight.set(0,.5*f.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(f.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(f.matrixWorld),e.position.applyMatrix4(h),r++}else if(f.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(f.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:i}}function fl(e,t){const n=new hl(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function dl(e,t){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new fl(e,t),n.set(r,[o])):i>=n.get(r).length?(o=new fl(e,t),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}class pl extends wi{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=on,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}pl.prototype.isMeshDepthMaterial=!0;class ml extends wi{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new sr,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}ml.prototype.isMeshDistanceMaterial=!0;function vl(e,t,n){let r=new Bo;const i=new Zn,o=new Zn,a=new nr,s=new pl({depthPacking:an}),l=new ml,c={},u=n.maxTextureSize,f={0:m,1:p,2:v},g=new Eo({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),y=g.clone();y.defines.HORIZONTAL_PASS=1;const x=new eo;x.setAttribute("position",new Ii(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new _o(x,g),w=this;function S(n,r){const i=t.update(b);g.uniforms.shadow_pass.value=n.map.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,g,b,null),y.uniforms.shadow_pass.value=n.mapPass.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,y,b,null)}function M(t,n,r,i,o,a,u){let h=null;const p=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(h=void 0!==p?p:!0===i.isPointLight?l:s,e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const e=h.uuid,t=r.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let i=n[t];void 0===i&&(i=h.clone(),n[t]=i),h=i}return h.visible=r.visible,h.wireframe=r.wireframe,h.side=u===d?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:f[r.side],h.clipShadows=r.clipShadows,h.clippingPlanes=r.clippingPlanes,h.clipIntersection=r.clipIntersection,h.wireframeLinewidth=r.wireframeLinewidth,h.linewidth=r.linewidth,!0===i.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(i.matrixWorld),h.nearDistance=o,h.farDistance=a),h}function E(n,i,o,a,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===d)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=M(n,0,u,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,n,c)}}}else if(i.visible){const t=M(n,0,i,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)E(l[e],i,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(t,n,s){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.state;f.setBlending(_),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const p=h.getFrameExtents();if(i.multiply(p),o.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/p.x),i.x=o.x*p.x,h.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/p.y),i.y=o.y*p.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===d){const e={minFilter:_e,magFilter:_e,format:ze};h.map=new rr(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.mapPass=new rr(i.x,i.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:pe,magFilter:pe,format:ze};h.map=new rr(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const m=h.getViewportCount();for(let e=0;e<m;e++){const t=h.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),f.viewport(a),h.updateMatrices(c,e),r=h.getFrustum(),E(n,s,h.camera,c,this.type)}h.isPointLightShadow||this.type!==d||S(h,s),h.needsUpdate=!1}w.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function gl(e,t,n){const r=n.isWebGL2;const i=new function(){let t=!1;const n=new nr;let r=null;const i=new nr(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){e?ye(2929):_e(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case U:e.depthFunc(512);break;case G:e.depthFunc(519);break;case H:e.depthFunc(513);break;case j:e.depthFunc(515);break;case W:e.depthFunc(514);break;case q:e.depthFunc(518);break;case X:e.depthFunc(516);break;case Y:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},c=new function(){let t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?ye(2960):_e(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&l===r||(e.stencilOp(t,n,r),a=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null}}};let u={},h=null,f={},d=null,p=!1,g=null,y=null,Z=null,$=null,J=null,K=null,Q=null,ee=!1,te=null,ne=null,re=null,ie=null,oe=null;const ae=e.getParameter(35661);let se=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ce)[1]),se=le>=1):-1!==ce.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),se=le>=2);let ue=null,he={};const fe=e.getParameter(3088),de=e.getParameter(2978),pe=(new nr).fromArray(fe),me=(new nr).fromArray(de);function ve(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,i);return o}const ge={};function ye(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function _e(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}ge[3553]=ve(3553,3553,1),ge[34067]=ve(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),c.setClear(0),ye(2929),o.setFunc(j),Se(!1),Me(s),ye(2884),we(_);const xe={[E]:32774,[T]:32778,[A]:32779};if(r)xe[C]=32775,xe[R]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(xe[C]=e.MIN_EXT,xe[R]=e.MAX_EXT)}const be={[P]:0,[L]:1,[k]:768,[N]:770,[V]:776,[z]:774,[D]:772,[I]:769,[O]:771,[F]:775,[B]:773};function we(t,n,r,i,o,a,s,l){if(t!==_){if(!1===p&&(ye(3042),p=!0),t===M)o=o||n,a=a||r,s=s||i,n===y&&o===J||(e.blendEquationSeparate(xe[n],xe[o]),y=n,J=o),r===Z&&i===$&&a===K&&s===Q||(e.blendFuncSeparate(be[r],be[i],be[a],be[s]),Z=r,$=i,K=a,Q=s),g=t,ee=null;else if(t!==g||l!==ee){if(y===E&&J===E||(e.blendEquation(32774),y=E,J=E),l)switch(t){case x:e.blendFuncSeparate(1,771,1,771);break;case b:e.blendFunc(1,1);break;case w:e.blendFuncSeparate(0,0,769,771);break;case S:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case x:e.blendFuncSeparate(770,771,1,771);break;case b:e.blendFunc(770,1);break;case w:e.blendFunc(0,769);break;case S:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,$=null,K=null,Q=null,g=t,ee=l}}else!0===p&&(_e(3042),p=!1)}function Se(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Me(t){t!==a?(ye(2884),t!==ne&&(t===s?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):_e(2884),ne=t}function Ee(t,n,r){t?(ye(32823),ie===n&&oe===r||(e.polygonOffset(n,r),ie=n,oe=r)):_e(32823)}function Te(t){void 0===t&&(t=33984+ae-1),ue!==t&&(e.activeTexture(t),ue=t)}return{buffers:{color:i,depth:o,stencil:c},enable:ye,disable:_e,bindFramebuffer:function(t,n){return null===n&&null!==h&&(n=h),f[t]!==n&&(e.bindFramebuffer(t,n),f[t]=n,r&&(36009===t&&(f[36160]=n),36160===t&&(f[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==h&&(e.bindFramebuffer(36160,t),h=t)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:we,setMaterial:function(e,t){e.side===v?_e(2884):ye(2884);let n=e.side===m;t&&(n=!n),Se(n),e.blending===x&&!1===e.transparent?we(_):we(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);const r=e.stencilWrite;c.setTest(r),r&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ee(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):_e(32926)},setFlipSided:Se,setCullFace:Me,setLineWidth:function(t){t!==re&&(se&&e.lineWidth(t),re=t)},setPolygonOffset:Ee,setScissorTest:function(e){e?ye(3089):_e(3089)},activeTexture:Te,bindTexture:function(t,n){null===ue&&Te();let r=he[ue];void 0===r&&(r={type:void 0,texture:void 0},he[ue]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ge[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=he[ue];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===r&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},ue=null,he={},h=null,f={},d=null,p=!1,g=null,y=null,Z=null,$=null,J=null,K=null,Q=null,ee=!1,te=null,ne=null,re=null,ie=null,oe=null,pe.set(0,0,e.canvas.width,e.canvas.height),me.set(0,0,e.canvas.width,e.canvas.height),i.reset(),o.reset(),c.reset()}}}function yl(e,t,n,r,i,o,a){const s=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,f=new WeakMap;let d,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Xn:Math.floor,o=r(i*e.width),a=r(i*e.height);void 0===d&&(d=m(o,a));const s=n?m(o,a):d;s.width=o,s.height=a;return s.getContext("2d").drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return Wn(e.width)&&Wn(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==pe&&e.minFilter!==_e}function _(t,n,i,o,a=1){e.generateMipmap(t);r.get(n).__maxMipLevel=Math.log2(Math.max(i,o,a))}function x(n,r,i){if(!1===s)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function b(e){return e===pe||e===me||e===ge?9728:9729}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&f.delete(n),a.memory.textures--}function S(t){const n=t.target;n.removeEventListener("dispose",S),function(t){const n=t.texture,i=r.get(t),o=r.get(n);if(!t)return;void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),a.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}let M=0;function E(e,t){const i=r.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void L(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function T(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;P(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const a=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=a||l?l?r.image[e].image:r.image[e]:v(r.image[e],!1,!0,c);const h=u[0],f=g(h)||s,d=o.convert(r.format),p=o.convert(r.type),m=x(r.internalFormat,d,p);let b;if(R(34067,r,f),a){for(let e=0;e<6;e++){b=u[e].mipmaps;for(let t=0;t<b.length;t++){const i=b[t];r.format!==ze&&r.format!==Be?null!==d?n.compressedTexImage2D(34069+e,t,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,i.width,i.height,0,d,p,i.data)}}t.__maxMipLevel=b.length-1}else{b=r.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,d,p,u[e].data);for(let t=0;t<b.length;t++){const r=b[t].image[e].image;n.texImage2D(34069+e,t+1,m,r.width,r.height,0,d,p,r.data)}}else{n.texImage2D(34069+e,0,m,d,p,u[e]);for(let t=0;t<b.length;t++){const r=b[t];n.texImage2D(34069+e,t+1,m,d,p,r.image[e])}}t.__maxMipLevel=b.length}y(r,f)&&_(34067,r,h.width,h.height);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(a,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture))}const A={[he]:10497,[fe]:33071,[de]:33648},C={[pe]:9728,[me]:9984,[ge]:9986,[_e]:9729,[xe]:9985,[we]:9987};function R(n,o,a){if(a?(e.texParameteri(n,10242,A[o.wrapS]),e.texParameteri(n,10243,A[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,A[o.wrapR]),e.texParameteri(n,10240,C[o.magFilter]),e.texParameteri(n,10241,C[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===fe&&o.wrapT===fe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,b(o.magFilter)),e.texParameteri(n,10241,b(o.minFilter)),o.minFilter!==pe&&o.minFilter!==_e&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(o.type===Pe&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&o.type===Le&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function P(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),a.memory.textures++)}function L(t,r,i){let a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),P(t,r),n.activeTexture(33984+i),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!s&&(e.wrapS!==fe||e.wrapT!==fe||e.minFilter!==pe&&e.minFilter!==_e)}(r)&&!1===g(r.image),c=v(r.image,l,!1,u),h=g(c)||s,f=o.convert(r.format);let d,p=o.convert(r.type),m=x(r.internalFormat,f,p);R(a,r,h);const b=r.mipmaps;if(r.isDepthTexture)m=6402,s?m=r.type===Pe?36012:r.type===Re?33190:r.type===Oe?35056:33189:r.type===Pe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Ge&&6402===m&&r.type!==Ae&&r.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ae,p=o.convert(r.type)),r.format===He&&6402===m&&(m=34041,r.type!==Oe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Oe,p=o.convert(r.type))),n.texImage2D(3553,0,m,c.width,c.height,0,f,p,null);else if(r.isDataTexture)if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)d=b[e],n.texImage2D(3553,e,m,d.width,d.height,0,f,p,d.data);r.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,f,p,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=b.length;e<t;e++)d=b[e],r.format!==ze&&r.format!==Be?null!==f?n.compressedTexImage2D(3553,e,m,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,d.width,d.height,0,f,p,d.data);t.__maxMipLevel=b.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,f,p,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,f,p,c.data),t.__maxMipLevel=0;else if(b.length>0&&h){for(let e=0,t=b.length;e<t;e++)d=b[e],n.texImage2D(3553,e,m,f,p,d);r.generateMipmaps=!1,t.__maxMipLevel=b.length-1}else n.texImage2D(3553,0,m,f,p,c),t.__maxMipLevel=0;y(r,h)&&_(a,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function k(t,i,a,s,l){const c=o.convert(a.format),u=o.convert(a.type),h=x(a.internalFormat,c,u);32879===l||35866===l?n.texImage3D(l,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(l,0,h,i.width,i.height,0,c,u,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,l,r.get(a).__webglTexture,0),n.bindFramebuffer(36160,null)}function I(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Pe?i=36012:t.type===Re&&(i=33190));const r=O(n);e.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const t=O(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=o.convert(t.format),a=o.convert(t.type),s=x(t.internalFormat,i,a);if(r){const t=O(n);e.renderbufferStorageMultisample(36161,t,s,n.width,n.height)}else e.renderbufferStorage(36161,s,n.width,n.height)}e.bindRenderbuffer(36161,null)}function N(t){const i=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),E(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Ge)e.framebufferTexture2D(36160,36096,3553,o,0);else{if(i.depthTexture.format!==He)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,o,0)}}(i.__webglFramebuffer,t)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),I(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),I(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function O(e){return s&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let D=!1,B=!1;this.allocateTextureUnit=function(){const e=M;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=E,this.setTexture2DArray=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?L(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?L(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",S),!0!==t.isWebGLMultipleRenderTargets&&(u.__webglTexture=e.createTexture(),u.__version=l.version,a.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,f=!0===t.isWebGLMultipleRenderTargets,d=!0===t.isWebGLMultisampleRenderTarget,p=l.isDataTexture3D||l.isDataTexture2DArray,m=g(t)||s;if(!s||l.format!==Be||l.type!==Pe&&l.type!==Le||(l.format=ze,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),f)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(d)if(s){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const r=o.convert(l.format),i=o.convert(l.type),a=x(l.internalFormat,r,i),s=O(t);e.renderbufferStorageMultisample(36161,s,a,t.width,t.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),I(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,u.__webglTexture),R(34067,l,m);for(let e=0;e<6;e++)k(c.__webglFramebuffer[e],t,l,36064,34069+e);y(l,m)&&_(34067,l,t.width,t.height),n.bindTexture(34067,null)}else if(f){const e=t.texture;for(let i=0,o=e.length;i<o;i++){const o=e[i],a=r.get(o);n.bindTexture(3553,a.__webglTexture),R(3553,o,m),k(c.__webglFramebuffer,t,o,36064+i,3553),y(o,m)&&_(3553,o,t.width,t.height)}n.bindTexture(3553,null)}else{let e=3553;if(p)if(s){e=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(e,u.__webglTexture),R(e,l,m),k(c.__webglFramebuffer,t,l,36064,e),y(l,m)&&_(e,l,t.width,t.height,t.depth),n.bindTexture(e,null)}t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){const t=g(e)||s,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=i.length;o<a;o++){const a=i[o];if(y(a,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,i=r.get(a).__webglTexture;n.bindTexture(t,i),_(t,a,e.width,e.height),n.bindTexture(t,null)}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(s){const i=t.width,o=t.height;let a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024);const s=r.get(t);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),E(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),T(e,t)}}function _l(e,t,n){const r=n.isWebGL2;return{convert:function(e){let n;if(e===Me)return 5121;if(e===ke)return 32819;if(e===Ie)return 32820;if(e===Ne)return 33635;if(e===Ee)return 5120;if(e===Te)return 5122;if(e===Ae)return 5123;if(e===Ce)return 5124;if(e===Re)return 5125;if(e===Pe)return 5126;if(e===Le)return r?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===De)return 6406;if(e===Be)return 6407;if(e===ze)return 6408;if(e===Fe)return 6409;if(e===Ve)return 6410;if(e===Ge)return 6402;if(e===He)return 34041;if(e===je)return 6403;if(e===We)return 36244;if(e===qe)return 33319;if(e===Xe)return 33320;if(e===Ye)return 36248;if(e===Ze)return 36249;if(e===$e||e===Je||e===Ke||e===Qe){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===$e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Je)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ke)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Qe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===nt||e===rt){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===et)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===rt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===it)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===ot||e===at)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(e===ot)return n.COMPRESSED_RGB8_ETC2;if(e===at)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===st||e===lt||e===ct||e===ut||e===ht||e===ft||e===dt||e===pt||e===mt||e===vt||e===gt||e===yt||e===_t||e===xt||e===wt||e===St||e===Mt||e===Et||e===Tt||e===At||e===Ct||e===Rt||e===Pt||e===Lt||e===kt||e===It||e===Nt||e===Ot?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):e===bt?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===Oe?r?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class xl extends Ao{constructor(e=[]){super(),this.cameras=e}}xl.prototype.isArrayCamera=!0;class bl extends ci{constructor(){super(),this.type="Group"}}bl.prototype.isGroup=!0;const wl={type:"move"};class Sl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new bl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new bl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new sr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new sr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new bl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new sr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new sr),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(wl))),l&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const e=new bl;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}const i=l.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],a=r.position.distanceTo(i.position),s=.02,c=.005;l.inputState.pinching&&a>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==o),this}}class Ml extends Dn{constructor(e,t){super();const n=this,r=e.state;let i=null,o=1,a=null,s="local-floor",l=null,c=null,u=null,h=null,f=null;const d=[],p=new Map,m=new Ao;m.layers.enable(1),m.viewport=new nr;const v=new Ao;v.layers.enable(2),v.viewport=new nr;const g=[m,v],y=new xl;y.layers.enable(1),y.layers.enable(2);let _=null,x=null;function b(e){const t=p.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function w(){p.forEach((function(e,t){e.disconnect(t)})),p.clear(),_=null,x=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),C.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function S(e){const t=i.inputSources;for(let e=0;e<d.length;e++)p.set(t[e],d[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=p.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),p.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=p.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=d[e];return void 0===t&&(t=new Sl,d[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=d[e];return void 0===t&&(t=new Sl,d[e]=t),t.getGripSpace()},this.getHand=function(e){let t=d[e];return void 0===t&&(t=new Sl,d[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return i},this.setSession=async function(e){if(i=e,null!==i){i.addEventListener("select",b),i.addEventListener("selectstart",b),i.addEventListener("selectend",b),i.addEventListener("squeeze",b),i.addEventListener("squeezestart",b),i.addEventListener("squeezeend",b),i.addEventListener("end",w),i.addEventListener("inputsourceschange",S);const e=t.getContextAttributes();if(!0!==e.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers){const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:o};f=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:f})}else{let n=0;if(e.antialias){const n={antialias:!0,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:o};f=new XRWebGLLayer(i,t,n),i.updateRenderState({layers:[f]})}else{e.depth&&(n=e.stencil?34041:6402);const r={colorFormat:e.alpha?6408:6407,depthFormat:n,scaleFactor:o};c=new XRWebGLBinding(i,t),h=c.createProjectionLayer(r),u=t.createFramebuffer(),i.updateRenderState({layers:[h]})}}a=await i.requestReferenceSpace(s),C.setContext(i),C.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const M=new sr,E=new sr;function T(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;y.near=v.near=m.near=e.near,y.far=v.far=m.far=e.far,_===y.near&&x===y.far||(i.updateRenderState({depthNear:y.near,depthFar:y.far}),_=y.near,x=y.far);const t=e.parent,n=y.cameras;T(y,t);for(let e=0;e<n.length;e++)T(n[e],t);y.matrixWorld.decompose(y.position,y.quaternion,y.scale),e.position.copy(y.position),e.quaternion.copy(y.quaternion),e.scale.copy(y.scale),e.matrix.copy(y.matrix),e.matrixWorld.copy(y.matrixWorld);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){M.setFromMatrixPosition(t.matrixWorld),E.setFromMatrixPosition(n.matrixWorld);const r=M.distanceTo(E),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],f=a*u,d=a*h,p=r/(-u+h),m=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const v=a+p,g=s+p,y=f-m,_=d+(r-m),x=l*s/g*v,b=c*s/g*v;e.projectionMatrix.makePerspective(y,_,x,b,v,g)}(y,m,v):y.projectionMatrix.copy(m.projectionMatrix)},this.getCamera=function(){return y},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==f?f.fixedFoveation:void 0},this.setFoveation=function(e){null!==h&&(h.fixedFoveation=e),null!==f&&void 0!==f.fixedFoveation&&(f.fixedFoveation=e)};let A=null;const C=new zo;C.setAnimationLoop((function(e,n){if(l=n.getViewerPose(a),null!==l){const e=l.views;null!==f&&r.bindXRFramebuffer(f.framebuffer);let n=!1;e.length!==y.cameras.length&&(y.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const o=e[i];let a=null;if(null!==f)a=f.getViewport(o);else{const e=c.getViewSubImage(h,o);r.bindXRFramebuffer(u),void 0!==e.depthStencilTexture&&t.framebufferTexture2D(36160,36096,3553,e.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,e.colorTexture,0),a=e.viewport}const s=g[i];s.matrix.fromArray(o.transform.matrix),s.projectionMatrix.fromArray(o.projectionMatrix),s.viewport.set(a.x,a.y,a.width,a.height),0===i&&y.matrix.copy(s.matrix),!0===n&&y.cameras.push(s)}}const o=i.inputSources;for(let e=0;e<d.length;e++){const t=d[e],r=o[e];t.update(r,n,a)}A&&A(e,n)})),this.setAnimationLoop=function(e){A=e},this.dispose=function(){}}}function El(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const r=e.get(n).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const i=e.get(r).__maxMipLevel;void 0!==i&&(t.maxMipLevel.value=i)}let i,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap?i=n.clearcoatRoughnessMap:n.specularIntensityMap?i=n.specularIntensityMap:n.specularTintMap&&(i=n.specularTintMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===m&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===m&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o,a){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t,r){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===m&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap);t.transmission>0&&(e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height));e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap);e.attenuationDistance.value=t.attenuationDistance,e.attenuationTint.value.copy(t.attenuationTint),e.specularIntensity.value=t.specularIntensity,e.specularTint.value.copy(t.specularTint),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularTintMap&&(e.specularTintMap.value=t.specularTintMap)}(e,r,a):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Tl(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,f=null;const d=[],g=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=$t,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1;const y=this;let _=!1,x=0,b=0,w=null,S=-1,M=null;const E=new nr,T=new nr;let A=null,C=t.width,R=t.height,P=1,L=null,k=null;const I=new nr(0,0,C,R),N=new nr(0,0,C,R);let O=!1;const D=[],B=new Bo;let z=!1,F=!1,V=null;const U=new zr,G=new sr,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===w?P:1}let W,q,X,Y,Z,$,J,Q,ee,te,ne,re,ie,oe,ae,se,le,ce,ue,he,de,me,ve,ge=n;function ye(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",be,!1),t.addEventListener("webglcontextrestored",Se,!1),null===ge){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),ge=ye(t,e),null===ge)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ge.getShaderPrecisionFormat&&(ge.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function _e(){W=new Ma(ge),q=new Xo(ge,W,e),W.init(q),me=new _l(ge,W,q),X=new gl(ge,W,q),D[0]=1029,Y=new Aa(ge),Z=new rl,$=new yl(ge,W,X,Z,q,me,Y),J=new Zo(y),Q=new Sa(y),ee=new Fo(ge,q),ve=new Wo(ge,W,ee,q),te=new Ea(ge,ee,Y,ve),ne=new La(ge,te,ee,Y),ue=new Pa(ge),se=new Yo(Z),re=new nl(y,J,Q,W,q,ve,se),ie=new El(Z),oe=new sl(Z),ae=new dl(W,q),ce=new jo(y,J,X,ne,s),le=new vl(y,ne,q),he=new qo(ge,W,Y,q),de=new Ta(ge,W,Y,q),Y.programs=re.programs,y.capabilities=q,y.extensions=W,y.properties=Z,y.renderLists=oe,y.shadowMap=le,y.state=X,y.info=Y}_e();const xe=new Ml(y,ge);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const e=Y.autoReset,t=le.enabled,n=le.autoUpdate,r=le.needsUpdate,i=le.type;_e(),Y.autoReset=e,le.enabled=t,le.autoUpdate=n,le.needsUpdate=r,le.type=i}function Ee(e){const t=e.target;t.removeEventListener("dispose",Ee),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&t.forEach((function(e){re.releaseProgram(e)}))})(e),Z.remove(e)}(t)}this.xr=xe,this.getContext=function(){return ge},this.getContextAttributes=function(){return ge.getContextAttributes()},this.forceContextLoss=function(){const e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(e){void 0!==e&&(P=e,this.setSize(C,R,!1))},this.getSize=function(e){return e.set(C,R)},this.setSize=function(e,n,r){xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,R=n,t.width=Math.floor(e*P),t.height=Math.floor(n*P),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(C*P,R*P).floor()},this.setDrawingBufferSize=function(e,n,r){C=e,R=n,P=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(I)},this.setViewport=function(e,t,n,r){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,n,r),X.viewport(E.copy(I).multiplyScalar(P).floor())},this.getScissor=function(e){return e.copy(N)},this.setScissor=function(e,t,n,r){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,r),X.scissor(T.copy(N).multiplyScalar(P).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(e){X.setScissorTest(O=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){k=e},this.getClearColor=function(e){return e.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(e,t,n){let r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),ge.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",be,!1),t.removeEventListener("webglcontextrestored",Se,!1),oe.dispose(),ae.dispose(),Z.dispose(),J.dispose(),Q.dispose(),ne.dispose(),ve.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",Ae),xe.removeEventListener("sessionend",Ce),V&&(V.dispose(),V=null),Re.stop()},this.renderBufferImmediate=function(e,t){ve.initAttributes();const n=Z.get(e);e.hasPositions&&!n.position&&(n.position=ge.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ge.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ge.createBuffer()),e.hasColors&&!n.color&&(n.color=ge.createBuffer());const r=t.getAttributes();e.hasPositions&&(ge.bindBuffer(34962,n.position),ge.bufferData(34962,e.positionArray,35048),ve.enableAttribute(r.position),ge.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(ge.bindBuffer(34962,n.normal),ge.bufferData(34962,e.normalArray,35048),ve.enableAttribute(r.normal),ge.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(ge.bindBuffer(34962,n.uv),ge.bufferData(34962,e.uvArray,35048),ve.enableAttribute(r.uv),ge.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(ge.bindBuffer(34962,n.color),ge.bufferData(34962,e.colorArray,35048),ve.enableAttribute(r.color),ge.vertexAttribPointer(r.color,3,5126,!1,0,0)),ve.disableUnusedAttributes(),ge.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=H);const a=i.isMesh&&i.matrixWorld.determinant()<0,s=De(e,t,r,i);X.setMaterial(r,a);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=te.getWireframeAttribute(n),h=2),void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ue.update(i,n,r,s),ve.setup(i,r,s,n,l);let f=he;null!==l&&(u=ee.get(l),f=de,f.setIndex(u));const d=null!==l?l.count:c.count,p=n.drawRange.start*h,m=n.drawRange.count*h,v=null!==o?o.start*h:0,g=null!==o?o.count*h:1/0,y=Math.max(p,v),_=Math.min(d,p+m,v+g)-1,x=Math.max(0,_-y+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*j()),f.setMode(1)):f.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),X.setLineWidth(e*j()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);if(i.isInstancedMesh)f.renderInstances(y,x,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);f.renderInstances(y,x,e)}else f.render(y,x)}},this.compile=function(e,t){f=ae.get(e),f.init(),g.push(f),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))})),f.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){Ne(n[r],e,t)}else Ne(n,e,t)})),g.pop(),f=null};let Te=null;function Ae(){Re.stop()}function Ce(){Re.start()}const Re=new zo;function ke(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;if(n.isArrayCamera){const i=n.cameras;for(let n=0,o=i.length;n<o;n++){const o=i[n];X.viewport(E.copy(o.viewport)),f.setupLightsView(o);for(let n=0,i=e.length;n<i;n++){const i=e[n],a=i.object,s=i.geometry,l=null===r?i.material:r,c=i.group;a.layers.test(o.layers)&&Ie(a,t,o,s,l,c)}}}else for(let i=0,o=e.length;i<o;i++){const o=e[i];Ie(o.object,t,n,o.geometry,null===r?o.material:r,o.group)}}function Ie(e,t,n,r,i,o){if(e.onBeforeRender(y,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const r=De(n,t,i,e);X.setMaterial(i),ve.reset(),function(e,t){e.render((function(e){y.renderBufferImmediate(e,t)}))}(e,r)}else!0===i.transparent&&i.side===v?(i.side=m,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,o),i.side=p,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,o),i.side=v):y.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(y,t,n,r,i,o)}function Ne(e,t,n){!0!==t.isScene&&(t=H);const r=Z.get(e),i=f.state.lights,o=f.state.shadowsArray,a=i.state.version,s=re.getParameters(e,i.state,o,t,n),l=re.getProgramCacheKey(s);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?Q:J).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",Ee),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===a)return Oe(e,s),u}else s.uniforms=re.getUniforms(e),e.onBuild(s,y),e.onBeforeCompile(s,y),u=re.acquireProgram(s,l),c.set(l,u),r.uniforms=s.uniforms;const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=se.uniform),Oe(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const d=u.getUniforms(),p=Os.seqWithValue(d.seq,h);return r.currentProgram=u,r.uniformsList=p,u}function Oe(e,t){const n=Z.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents}function De(e,t,n,r){!0!==t.isScene&&(t=H),$.resetTextureUnits();const i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=null===w?y.outputEncoding:w.texture.encoding,s=(n.isMeshStandardMaterial?Q:J).get(n.envMap||o),l=!0===n.vertexColors&&!!r.geometry&&!!r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,c=!!r.geometry&&!!r.geometry.attributes.tangent,u=!!r.geometry&&!!r.geometry.morphAttributes.position,h=!!r.geometry&&!!r.geometry.morphAttributes.normal,d=Z.get(n),p=f.state.lights;if(!0===z&&(!0===F||e!==M)){const t=e===M&&n.id===S;se.setState(n,e,t)}let m=!1;n.version===d.__version?d.needsLights&&d.lightsStateVersion!==p.state.version||d.outputEncoding!==a||r.isInstancedMesh&&!1===d.instancing?m=!0:r.isInstancedMesh||!0!==d.instancing?r.isSkinnedMesh&&!1===d.skinning?m=!0:r.isSkinnedMesh||!0!==d.skinning?d.envMap!==s||n.fog&&d.fog!==i?m=!0:void 0===d.numClippingPlanes||d.numClippingPlanes===se.numPlanes&&d.numIntersection===se.numIntersection?(d.vertexAlphas!==l||d.vertexTangents!==c||d.morphTargets!==u||d.morphNormals!==h)&&(m=!0):m=!0:m=!0:m=!0:(m=!0,d.__version=n.version);let v=d.currentProgram;!0===m&&(v=Ne(n,t,r));let g=!1,_=!1,x=!1;const b=v.getUniforms(),E=d.uniforms;if(X.useProgram(v.program)&&(g=!0,_=!0,x=!0),n.id!==S&&(S=n.id,_=!0),g||M!==e){if(b.setValue(ge,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&b.setValue(ge,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),M!==e&&(M=e,_=!0,x=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=b.map.cameraPosition;void 0!==t&&t.setValue(ge,G.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&b.setValue(ge,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&b.setValue(ge,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){b.setOptional(ge,r,"bindMatrix"),b.setOptional(ge,r,"bindMatrixInverse");const e=r.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),b.setValue(ge,"boneTexture",e.boneTexture,$),b.setValue(ge,"boneTextureSize",e.boneTextureSize)):b.setOptional(ge,e,"boneMatrices"))}var T,A;return(_||d.receiveShadow!==r.receiveShadow)&&(d.receiveShadow=r.receiveShadow,b.setValue(ge,"receiveShadow",r.receiveShadow)),_&&(b.setValue(ge,"toneMappingExposure",y.toneMappingExposure),d.needsLights&&(A=x,(T=E).ambientLightColor.needsUpdate=A,T.lightProbe.needsUpdate=A,T.directionalLights.needsUpdate=A,T.directionalLightShadows.needsUpdate=A,T.pointLights.needsUpdate=A,T.pointLightShadows.needsUpdate=A,T.spotLights.needsUpdate=A,T.spotLightShadows.needsUpdate=A,T.rectAreaLights.needsUpdate=A,T.hemisphereLights.needsUpdate=A),i&&n.fog&&ie.refreshFogUniforms(E,i),ie.refreshMaterialUniforms(E,n,P,R,V),Os.upload(ge,d.uniformsList,E,$)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Os.upload(ge,d.uniformsList,E,$),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&b.setValue(ge,"center",r.center),b.setValue(ge,"modelViewMatrix",r.modelViewMatrix),b.setValue(ge,"normalMatrix",r.normalMatrix),b.setValue(ge,"modelMatrix",r.matrixWorld),v}Re.setAnimationLoop((function(e){Te&&Te(e)})),"undefined"!=typeof window&&Re.setContext(window),this.setAnimationLoop=function(e){Te=e,xe.setAnimationLoop(e),null===e?Re.stop():Re.start()},xe.addEventListener("sessionstart",Ae),xe.addEventListener("sessionend",Ce),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===_)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===xe.enabled&&!0===xe.isPresenting&&(!0===xe.cameraAutoUpdate&&xe.updateCamera(t),t=xe.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),f=ae.get(e,g.length),f.init(),g.push(f),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),B.setFromProjectionMatrix(U),F=this.localClippingEnabled,z=se.init(this.clippingPlanes,F,t),h=oe.get(e,d.length),h.init(),d.push(h),function e(t,n,r,i){if(!1===t.visible)return;if(t.layers.test(n.layers))if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(n);else if(t.isLight)f.pushLight(t),t.castShadow&&f.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=ne.update(t),n=t.material;n.visible&&h.push(t,e,n,r,G.z,null)}}else if(t.isImmediateRenderObject)i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U),h.push(t,null,t.material,r,G.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==Y.render.frame&&(t.skeleton.update(),t.skeleton.frame=Y.render.frame),!t.frustumCulled||B.intersectsObject(t))){i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(U);const e=ne.update(t),n=t.material;if(Array.isArray(n)){const i=e.groups;for(let o=0,a=i.length;o<a;o++){const a=i[o],s=n[a.materialIndex];s&&s.visible&&h.push(t,e,s,r,G.z,a)}}else n.visible&&h.push(t,e,n,r,G.z,null)}const o=t.children;for(let t=0,a=o.length;t<a;t++)e(o[t],n,r,i)}(e,t,0,y.sortObjects),h.finish(),!0===y.sortObjects&&h.sort(L,k),!0===z&&se.beginShadows();const n=f.state.shadowsArray;le.render(n,e,t),f.setupLights(),f.setupLightsView(t),!0===z&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),ce.render(h,e);const r=h.opaque,i=h.transmissive,o=h.transparent;r.length>0&&ke(r,e,t),i.length>0&&function(e,t,n,r){if(null===V){const e=!0===a&&!0===q.isWebGL2;V=new(e?or:rr)(1024,1024,{generateMipmaps:!0,type:null!==me.convert(Le)?Le:Me,minFilter:we,magFilter:pe,wrapS:fe,wrapT:fe})}const i=y.getRenderTarget();y.setRenderTarget(V),y.clear();const o=y.toneMapping;y.toneMapping=K,ke(e,n,r),y.toneMapping=o,$.updateMultisampleRenderTarget(V),$.updateRenderTargetMipmap(V),y.setRenderTarget(i),ke(t,n,r)}(r,i,e,t),o.length>0&&ke(o,e,t),null!==w&&($.updateMultisampleRenderTarget(w),$.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1),ve.resetDefaultState(),S=-1,M=null,g.pop(),f=g.length>0?g[g.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return w},this.setRenderTarget=function(e,t=0,n=0){w=e,x=t,b=n,e&&void 0===Z.get(e).__webglFramebuffer&&$.setupRenderTarget(e);let r=null,i=!1,o=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(o=!0);const a=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=a[t],i=!0):r=e.isWebGLMultisampleRenderTarget?Z.get(e).__webglMultisampledFramebuffer:a,E.copy(e.viewport),T.copy(e.scissor),A=e.scissorTest}else E.copy(I).multiplyScalar(P).floor(),T.copy(N).multiplyScalar(P).floor(),A=O;if(X.bindFramebuffer(36160,r)&&q.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const n=e.texture;if(D.length!==n.length||36064!==D[0]){for(let e=0,t=n.length;e<t;e++)D[e]=36064+e;D.length=n.length,t=!0}}else 1===D.length&&36064===D[0]||(D[0]=36064,D.length=1,t=!0);else 1===D.length&&1029===D[0]||(D[0]=1029,D.length=1,t=!0);t&&(q.isWebGL2?ge.drawBuffers(D):W.get("WEBGL_draw_buffers").drawBuffersWEBGL(D))}if(X.viewport(E),X.scissor(T),X.setScissorTest(A),i){const r=Z.get(e.texture);ge.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,n)}else if(o){const r=Z.get(e.texture),i=t||0;ge.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){X.bindFramebuffer(36160,s);try{const a=e.texture,s=a.format,l=a.type;if(s!==ze&&me.convert(s)!==ge.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Le&&(W.has("EXT_color_buffer_half_float")||q.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===Me||me.convert(l)===ge.getParameter(35738)||l===Pe&&(q.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ge.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ge.readPixels(t,n,r,i,me.convert(s),me.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==w?Z.get(w).__webglFramebuffer:null;X.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r);let a=me.convert(t.format);q.isWebGL2&&(6407===a&&(a=32849),6408===a&&(a=32856)),$.setTexture2D(t,0),ge.copyTexImage2D(3553,n,a,e.x,e.y,i,o,0),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,o=t.image.height,a=me.convert(n.format),s=me.convert(n.type);$.setTexture2D(n,0),ge.pixelStorei(37440,n.flipY),ge.pixelStorei(37441,n.premultiplyAlpha),ge.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ge.texSubImage2D(3553,r,e.x,e.y,i,o,a,s,t.image.data):t.isCompressedTexture?ge.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):ge.texSubImage2D(3553,r,e.x,e.y,a,s,t.image),0===r&&n.generateMipmaps&&ge.generateMipmap(3553),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=me.convert(r.format),c=me.convert(r.type);let u;if(r.isDataTexture3D)$.setTexture3D(r,0),u=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(r,0),u=35866}ge.pixelStorei(37440,r.flipY),ge.pixelStorei(37441,r.premultiplyAlpha),ge.pixelStorei(3317,r.unpackAlignment);const h=ge.getParameter(3314),f=ge.getParameter(32878),d=ge.getParameter(3316),p=ge.getParameter(3315),m=ge.getParameter(32877),v=n.isCompressedTexture?n.mipmaps[0]:n.image;ge.pixelStorei(3314,v.width),ge.pixelStorei(32878,v.height),ge.pixelStorei(3316,e.min.x),ge.pixelStorei(3315,e.min.y),ge.pixelStorei(32877,e.min.z),n.isDataTexture||n.isDataTexture3D?ge.texSubImage3D(u,i,t.x,t.y,t.z,o,a,s,l,c,v.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ge.compressedTexSubImage3D(u,i,t.x,t.y,t.z,o,a,s,l,v.data)):ge.texSubImage3D(u,i,t.x,t.y,t.z,o,a,s,l,c,v),ge.pixelStorei(3314,h),ge.pixelStorei(32878,f),ge.pixelStorei(3316,d),ge.pixelStorei(3315,p),ge.pixelStorei(32877,m),0===i&&r.generateMipmaps&&ge.generateMipmap(u),X.unbindTexture()},this.initTexture=function(e){$.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){x=0,b=0,w=null,X.reset(),ve.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Al extends Tl{}Al.prototype.isWebGL1Renderer=!0;class Cl{constructor(e,t=25e-5){this.name="",this.color=new Ri(e),this.density=t}clone(){return new Cl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Cl.prototype.isFogExp2=!0;class Rl{constructor(e,t=1,n=1e3){this.name="",this.color=new Ri(e),this.near=t,this.far=n}clone(){return new Rl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Rl.prototype.isFog=!0;class Pl extends ci{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Pl.prototype.isScene=!0;class Ll{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=En,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Un()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Un()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Un()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Ll.prototype.isInterleavedBuffer=!0;const kl=new sr;class Il{constructor(e,t,n,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)kl.x=this.getX(t),kl.y=this.getY(t),kl.z=this.getZ(t),kl.applyMatrix4(e),this.setXYZ(t,kl.x,kl.y,kl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)kl.x=this.getX(t),kl.y=this.getY(t),kl.z=this.getZ(t),kl.applyNormalMatrix(e),this.setXYZ(t,kl.x,kl.y,kl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)kl.x=this.getX(t),kl.y=this.getY(t),kl.z=this.getZ(t),kl.transformDirection(e),this.setXYZ(t,kl.x,kl.y,kl.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Ii(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Il(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Il.prototype.isInterleavedBufferAttribute=!0;class Nl extends wi{constructor(e){super(),this.type="SpriteMaterial",this.color=new Ri(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Ol;Nl.prototype.isSpriteMaterial=!0;const Dl=new sr,Bl=new sr,zl=new sr,Fl=new Zn,Vl=new Zn,Ul=new zr,Gl=new sr,Hl=new sr,jl=new sr,Wl=new Zn,ql=new Zn,Xl=new Zn;class Yl extends ci{constructor(e){if(super(),this.type="Sprite",void 0===Ol){Ol=new eo;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Ll(e,5);Ol.setIndex([0,1,2,0,2,3]),Ol.setAttribute("position",new Il(t,3,0,!1)),Ol.setAttribute("uv",new Il(t,2,3,!1))}this.geometry=Ol,this.material=void 0!==e?e:new Nl,this.center=new Zn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Bl.setFromMatrixScale(this.matrixWorld),Ul.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),zl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Bl.multiplyScalar(-zl.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;Zl(Gl.set(-.5,-.5,0),zl,o,Bl,r,i),Zl(Hl.set(.5,-.5,0),zl,o,Bl,r,i),Zl(jl.set(.5,.5,0),zl,o,Bl,r,i),Wl.set(0,0),ql.set(1,0),Xl.set(1,1);let a=e.ray.intersectTriangle(Gl,Hl,jl,!1,Dl);if(null===a&&(Zl(Hl.set(-.5,.5,0),zl,o,Bl,r,i),ql.set(0,1),a=e.ray.intersectTriangle(Gl,jl,Hl,!1,Dl),null===a))return;const s=e.ray.origin.distanceTo(Dl);s<e.near||s>e.far||t.push({distance:s,point:Dl.clone(),uv:xi.getUV(Dl,Gl,Hl,jl,Wl,ql,Xl,new Zn),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Zl(e,t,n,r,i,o){Fl.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Vl.x=o*Fl.x-i*Fl.y,Vl.y=i*Fl.x+o*Fl.y):Vl.copy(Fl),e.copy(t),e.x+=Vl.x,e.y+=Vl.y,e.applyMatrix4(Ul)}Yl.prototype.isSprite=!0;const $l=new sr,Jl=new sr;class Kl extends ci{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){$l.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo($l);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){$l.setFromMatrixPosition(e.matrixWorld),Jl.setFromMatrixPosition(this.matrixWorld);const n=$l.distanceTo(Jl)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const Ql=new sr,ec=new nr,tc=new nr,nc=new sr,rc=new zr;class ic extends _o{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new zr,this.bindMatrixInverse=new zr}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new nr,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;ec.fromBufferAttribute(r.attributes.skinIndex,e),tc.fromBufferAttribute(r.attributes.skinWeight,e),Ql.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=tc.getComponent(e);if(0!==r){const i=ec.getComponent(e);rc.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(nc.copy(Ql).applyMatrix4(rc),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}ic.prototype.isSkinnedMesh=!0;class oc extends ci{constructor(){super(),this.type="Bone"}}oc.prototype.isBone=!0;class ac extends er{constructor(e=null,t=1,n=1,r,i,o,a,s,l=pe,c=pe,u,h){super(null,o,a,s,l,c,r,i,u,h),this.image={data:e,width:t,height:n},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ac.prototype.isDataTexture=!0;const sc=new zr,lc=new zr;class cc{constructor(e=[],t=[]){this.uuid=Un(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new zr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new zr;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:lc;sc.multiplyMatrices(i,t[r]),sc.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new cc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=qn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ac(t,e,e,ze,Pe);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new oc),this.bones.push(i),this.boneInverses.push((new zr).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}}const uc=new zr,hc=new zr,fc=[],dc=new _o;class pc extends _o{constructor(e,t,n){super(e,t),this.instanceMatrix=new Ii(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(dc.geometry=this.geometry,dc.material=this.material,void 0!==dc.material)for(let i=0;i<r;i++){this.getMatrixAt(i,uc),hc.multiplyMatrices(n,uc),dc.matrixWorld=hc,dc.raycast(e,fc);for(let e=0,n=fc.length;e<n;e++){const n=fc[e];n.instanceId=i,n.object=this,t.push(n)}fc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ii(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}pc.prototype.isInstancedMesh=!0;class mc extends wi{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ri(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}mc.prototype.isLineBasicMaterial=!0;const vc=new sr,gc=new sr,yc=new zr,_c=new Br,xc=new Rr;class bc extends ci{constructor(e=new eo,t=new mc){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)vc.fromBufferAttribute(t,e-1),gc.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=vc.distanceTo(gc);e.setAttribute("lineDistance",new Gi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),xc.copy(n.boundingSphere),xc.applyMatrix4(r),xc.radius+=i,!1===e.ray.intersectsSphere(xc))return;yc.copy(r).invert(),_c.copy(e.ray).applyMatrix4(yc);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=new sr,c=new sr,u=new sr,h=new sr,f=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){for(let n=Math.max(0,o.start),a=Math.min(r.count,o.start+o.count)-1;n<a;n+=f){const o=r.getX(n),a=r.getX(n+1);l.fromBufferAttribute(i,o),c.fromBufferAttribute(i,a);if(_c.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const f=e.ray.origin.distanceTo(h);f<e.near||f>e.far||t.push({distance:f,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,o.start),r=Math.min(i.count,o.start+o.count)-1;n<r;n+=f){l.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1);if(_c.distanceSqToSegment(l,c,h,u)>s)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}bc.prototype.isLine=!0;const wc=new sr,Sc=new sr;class Mc extends bc{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)wc.fromBufferAttribute(t,e),Sc.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+wc.distanceTo(Sc);e.setAttribute("lineDistance",new Gi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Mc.prototype.isLineSegments=!0;class Ec extends bc{constructor(e,t){super(e,t),this.type="LineLoop"}}Ec.prototype.isLineLoop=!0;class Tc extends wi{constructor(e){super(),this.type="PointsMaterial",this.color=new Ri(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Tc.prototype.isPointsMaterial=!0;const Ac=new zr,Cc=new Br,Rc=new Rr,Pc=new sr;class Lc extends ci{constructor(e=new eo,t=new Tc){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Rc.copy(n.boundingSphere),Rc.applyMatrix4(r),Rc.radius+=i,!1===e.ray.intersectsSphere(Rc))return;Ac.copy(r).invert(),Cc.copy(e.ray).applyMatrix4(Ac);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(n.isBufferGeometry){const i=n.index,a=n.attributes.position;if(null!==i){for(let n=Math.max(0,o.start),l=Math.min(i.count,o.start+o.count);n<l;n++){const o=i.getX(n);Pc.fromBufferAttribute(a,o),kc(Pc,o,s,r,e,t,this)}}else{for(let n=Math.max(0,o.start),i=Math.min(a.count,o.start+o.count);n<i;n++)Pc.fromBufferAttribute(a,n),kc(Pc,n,s,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function kc(e,t,n,r,i,o,a){const s=Cc.distanceSqToPoint(e);if(s<n){const n=new sr;Cc.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}Lc.prototype.isPoints=!0;class Ic extends er{constructor(e,t,n,r,i,o,a,s,l){super(e,t,n,r,i,o,a,s,l),this.format=void 0!==a?a:Be,this.minFilter=void 0!==o?o:_e,this.magFilter=void 0!==i?i:_e,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Ic.prototype.isVideoTexture=!0;class Nc extends er{constructor(e,t,n,r,i,o,a,s,l,c,u,h){super(null,o,a,s,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Nc.prototype.isCompressedTexture=!0;class Oc extends er{constructor(e,t,n,r,i,o,a,s,l){super(e,t,n,r,i,o,a,s,l),this.needsUpdate=!0}}Oc.prototype.isCanvasTexture=!0;class Dc extends er{constructor(e,t,n,r,i,o,a,s,l,c){if((c=void 0!==c?c:Ge)!==Ge&&c!==He)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Ge&&(n=Ae),void 0===n&&c===He&&(n=Oe),super(null,r,i,o,a,s,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:pe,this.minFilter=void 0!==s?s:pe,this.flipY=!1,this.generateMipmaps=!1}}Dc.prototype.isDepthTexture=!0;class Bc extends eo{constructor(e=1,t=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],o=[],a=[],s=[],l=new sr,c=new Zn;o.push(0,0,0),a.push(0,0,1),s.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),o.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(o[u]/e+1)/2,c.y=(o[u+1]/e+1)/2,s.push(c.x,c.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new Gi(o,3)),this.setAttribute("normal",new Gi(a,3)),this.setAttribute("uv",new Gi(s,2))}static fromJSON(e){return new Bc(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class zc extends eo{constructor(e=1,t=1,n=1,r=8,i=1,o=!1,a=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],f=[];let d=0;const p=[],m=n/2;let v=0;function g(n){const i=d,o=new Zn,p=new sr;let g=0;const y=!0===n?e:t,_=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*_,0),h.push(0,_,0),f.push(.5,.5),d++;const x=d;for(let e=0;e<=r;e++){const t=e/r*s+a,n=Math.cos(t),i=Math.sin(t);p.x=y*i,p.y=m*_,p.z=y*n,u.push(p.x,p.y,p.z),h.push(0,_,0),o.x=.5*n+.5,o.y=.5*i*_+.5,f.push(o.x,o.y),d++}for(let e=0;e<r;e++){const t=i+e,r=x+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),g+=3}l.addGroup(v,g,!0===n?1:2),v+=g}!function(){const o=new sr,g=new sr;let y=0;const _=(t-e)/n;for(let l=0;l<=i;l++){const c=[],v=l/i,y=v*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*s+a,l=Math.sin(i),p=Math.cos(i);g.x=y*l,g.y=-v*n+m,g.z=y*p,u.push(g.x,g.y,g.z),o.set(l,_,p).normalize(),h.push(o.x,o.y,o.z),f.push(t,1-v),c.push(d++)}p.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=p[t][e],r=p[t+1][e],i=p[t+1][e+1],o=p[t][e+1];c.push(n,r,o),c.push(r,i,o),y+=6}l.addGroup(v,y,0),v+=y}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new Gi(u,3)),this.setAttribute("normal",new Gi(h,3)),this.setAttribute("uv",new Gi(f,2))}static fromJSON(e){return new zc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Fc extends zc{constructor(e=1,t=1,n=8,r=1,i=!1,o=0,a=2*Math.PI){super(0,e,t,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Fc(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Vc extends eo{constructor(e,t,n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],o=[];function a(e,t,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const a=e.clone().lerp(n,r/i),s=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)o[r][e]=0===e&&r===i?a:a.clone().lerp(s,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(s(o[e][n+1]),s(o[e+1][n]),s(o[e][n])):(s(o[e][n+1]),s(o[e+1][n+1]),s(o[e+1][n]))}}function s(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new sr,r=new sr,i=new sr;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],r),l(t[o+2],i),a(n,r,i,e)}(r),function(e){const t=new sr;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new sr;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=u(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(r,1-a)}var t;(function(){const e=new sr,t=new sr,n=new sr,r=new sr,a=new Zn,s=new Zn,l=new Zn;for(let h=0,f=0;h<i.length;h+=9,f+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),a.set(o[f+0],o[f+1]),s.set(o[f+2],o[f+3]),l.set(o[f+4],o[f+5]),r.copy(e).add(t).add(n).divideScalar(3);const d=u(r);c(a,f+0,e,d),c(s,f+2,t,d),c(l,f+4,n,d)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new Gi(i,3)),this.setAttribute("normal",new Gi(i.slice(),3)),this.setAttribute("uv",new Gi(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Vc(e.vertices,e.indices,e.radius,e.details)}}class Uc extends Vc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Uc(e.radius,e.detail)}}const Gc=new sr,Hc=new sr,jc=new sr,Wc=new xi;class qc extends eo{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=Math.cos(Fn*t),r=e.getIndex(),i=e.getAttribute("position"),o=r?r.count:i.count,a=[0,0,0],s=["a","b","c"],l=new Array(3),c={},u=[];for(let e=0;e<o;e+=3){r?(a[0]=r.getX(e),a[1]=r.getX(e+1),a[2]=r.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:o,c:h}=Wc;if(t.fromBufferAttribute(i,a[0]),o.fromBufferAttribute(i,a[1]),h.fromBufferAttribute(i,a[2]),Wc.getNormal(jc),l[0]=`${t.x},${t.y},${t.z}`,l[1]=`${o.x},${o.y},${o.z}`,l[2]=`${h.x},${h.y},${h.z}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let e=0;e<3;e++){const t=(e+1)%3,r=l[e],i=l[t],o=Wc[s[e]],h=Wc[s[t]],f=`${r}_${i}`,d=`${i}_${r}`;d in c&&c[d]?(jc.dot(c[d].normal)<=n&&(u.push(o.x,o.y,o.z),u.push(h.x,h.y,h.z)),c[d]=null):f in c||(c[f]={index0:a[e],index1:a[t],normal:jc.clone()})}}for(const e in c)if(c[e]){const{index0:t,index1:n}=c[e];Gc.fromBufferAttribute(i,t),Hc.fromBufferAttribute(i,n),u.push(Gc.x,Gc.y,Gc.z),u.push(Hc.x,Hc.y,Hc.z)}this.setAttribute("position",new Gi(u,3))}}class Xc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let a,s=0,l=i-1;for(;s<=l;)if(r=Math.floor(s+(l-s)/2),a=n[r]-o,a<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]===o)return r/(i-1);const c=n[r];return(r+(o-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);const i=this.getPoint(n),o=this.getPoint(r),a=t||(i.isVector2?new Zn:new sr);return a.copy(o).sub(i).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new sr,r=[],i=[],o=[],a=new sr,s=new zr;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new sr),r[t].normalize()}i[0]=new sr,o[0]=new sr;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),a.crossVectors(r[t-1],r[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Gn(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(s.makeRotationAxis(a,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Gn(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(a.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Yc extends Xc{constructor(e=0,t=0,n=1,r=1,i=0,o=2*Math.PI,a=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(e,t){const n=t||new Zn,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const a=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=l-this.aY;s=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Yc.prototype.isEllipseCurve=!0;class Zc extends Yc{constructor(e,t,n,r,i,o){super(e,t,n,n,r,i,o),this.type="ArcCurve"}}function $c(){let e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){let l=(t-e)/o-(n-e)/(o+a)+(n-t)/a,c=(n-t)/a-(r-t)/(a+s)+(r-n)/s;l*=a,c*=a,i(t,n,l,c)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}Zc.prototype.isArcCurve=!0;const Jc=new sr,Kc=new $c,Qc=new $c,eu=new $c;class tu extends Xc{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new sr){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let a,s,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?a=r[(l-1)%i]:(Jc.subVectors(r[0],r[1]).add(r[0]),a=Jc);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?s=r[(l+2)%i]:(Jc.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=Jc),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Kc.initNonuniformCatmullRom(a.x,u.x,h.x,s.x,t,n,r),Qc.initNonuniformCatmullRom(a.y,u.y,h.y,s.y,t,n,r),eu.initNonuniformCatmullRom(a.z,u.z,h.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(Kc.initCatmullRom(a.x,u.x,h.x,s.x,this.tension),Qc.initCatmullRom(a.y,u.y,h.y,s.y,this.tension),eu.initCatmullRom(a.z,u.z,h.z,s.z,this.tension));return n.set(Kc.calc(c),Qc.calc(c),eu.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new sr).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function nu(e,t,n,r,i){const o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function ru(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function iu(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}tu.prototype.isCatmullRomCurve3=!0;class ou extends Xc{constructor(e=new Zn,t=new Zn,n=new Zn,r=new Zn){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Zn){const n=t,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(iu(e,r.x,i.x,o.x,a.x),iu(e,r.y,i.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ou.prototype.isCubicBezierCurve=!0;class au extends Xc{constructor(e=new sr,t=new sr,n=new sr,r=new sr){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new sr){const n=t,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(iu(e,r.x,i.x,o.x,a.x),iu(e,r.y,i.y,o.y,a.y),iu(e,r.z,i.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}au.prototype.isCubicBezierCurve3=!0;class su extends Xc{constructor(e=new Zn,t=new Zn){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Zn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Zn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}su.prototype.isLineCurve=!0;class lu extends Xc{constructor(e=new sr,t=new sr){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new sr){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cu extends Xc{constructor(e=new Zn,t=new Zn,n=new Zn){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Zn){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(ru(e,r.x,i.x,o.x),ru(e,r.y,i.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cu.prototype.isQuadraticBezierCurve=!0;class uu extends Xc{constructor(e=new sr,t=new sr,n=new sr){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new sr){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(ru(e,r.x,i.x,o.x),ru(e,r.y,i.y,o.y),ru(e,r.z,i.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}uu.prototype.isQuadraticBezierCurve3=!0;class hu extends Xc{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Zn){const n=t,r=this.points,i=(r.length-1)*e,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],l=r[o],c=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(nu(a,s.x,l.x,c.x,u.x),nu(a,s.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Zn).fromArray(n))}return this}}hu.prototype.isSplineCurve=!0;var fu=Object.freeze({__proto__:null,ArcCurve:Zc,CatmullRomCurve3:tu,CubicBezierCurve:ou,CubicBezierCurve3:au,EllipseCurve:Yc,LineCurve:su,LineCurve3:lu,QuadraticBezierCurve:cu,QuadraticBezierCurve3:uu,SplineCurve:hu});const du=function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let o=pu(e,0,i,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c,u,h,f,d;if(r&&(o=function(e,t,n,r){const i=[];let o,a,s,l,c;for(o=0,a=t.length;o<a;o++)s=t[o]*r,l=o<a-1?t[o+1]*r:e.length,c=pu(e,s,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Eu(c));for(i.sort(bu),o=0;o<i.length;o++)wu(i[o],n),n=mu(n,n.next);return n}(e,t,o,n)),e.length>80*n){s=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],f=e[t+1],h<s&&(s=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);d=Math.max(c-s,u-l),d=0!==d?1/d:0}return vu(o,a,n,s,l,d),a};function pu(e,t,n,r,i){let o,a;if(i===function(e,t,n,r){let i=0;for(let o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)a=Ou(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=Ou(o,e[o],e[o+1],a);return a&&Ru(a,a.next)&&(Du(a),a=a.next),a}function mu(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Ru(r,r.next)&&0!==Cu(r.prev,r,r.next))r=r.next;else{if(Du(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function vu(e,t,n,r,i,o,a){if(!e)return;!a&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=Mu(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,a,s,l,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ,r);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,o?yu(e,r,i,o):gu(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Du(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?vu(e=_u(mu(e),t,n),t,n,r,i,o,2):2===a&&xu(e,t,n,r,i,o):vu(mu(e),t,n,r,i,o,1);break}}function gu(e){const t=e.prev,n=e,r=e.next;if(Cu(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(Tu(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Cu(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function yu(e,t,n,r){const i=e.prev,o=e,a=e.next;if(Cu(i,o,a)>=0)return!1;const s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Mu(s,l,t,n,r),f=Mu(c,u,t,n,r);let d=e.prevZ,p=e.nextZ;for(;d&&d.z>=h&&p&&p.z<=f;){if(d!==e.prev&&d!==e.next&&Tu(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Cu(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&Tu(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Cu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Tu(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Cu(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&Tu(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Cu(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function _u(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!Ru(i,o)&&Pu(i,r,r.next,o)&&Iu(i,o)&&Iu(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Du(r),Du(r.next),r=e=o),r=r.next}while(r!==e);return mu(r)}function xu(e,t,n,r,i,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Au(a,e)){let s=Nu(a,e);return a=mu(a,a.next),s=mu(s,s.next),vu(a,t,n,r,i,o),void vu(s,t,n,r,i,o)}e=e.next}a=a.next}while(a!==e)}function bu(e,t){return e.x-t.x}function wu(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>a){if(a=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===a)return o;const s=o,l=o.x,c=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=l&&r!==n.x&&Tu(i<c?r:a,i,l,c,i<c?a:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),Iu(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&Su(o,n)))&&(o=n,h=u)),n=n.next}while(n!==s);return o}(e,t)){const n=Nu(t,e);mu(t,t.next),mu(n,n.next)}}function Su(e,t){return Cu(e.prev,e,t.prev)<0&&Cu(t.next,e,e.next)<0}function Mu(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Eu(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Tu(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Au(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Pu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Iu(e,t)&&Iu(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Cu(e.prev,e,t.prev)||Cu(e,t.prev,t))||Ru(e,t)&&Cu(e.prev,e,e.next)>0&&Cu(t.prev,t,t.next)>0)}function Cu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Ru(e,t){return e.x===t.x&&e.y===t.y}function Pu(e,t,n,r){const i=ku(Cu(e,t,n)),o=ku(Cu(e,t,r)),a=ku(Cu(n,r,e)),s=ku(Cu(n,r,t));return i!==o&&a!==s||(!(0!==i||!Lu(e,n,t))||(!(0!==o||!Lu(e,r,t))||(!(0!==a||!Lu(n,e,r))||!(0!==s||!Lu(n,t,r)))))}function Lu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ku(e){return e>0?1:e<0?-1:0}function Iu(e,t){return Cu(e.prev,e,e.next)<0?Cu(e,t,e.next)>=0&&Cu(e,e.prev,t)>=0:Cu(e,t,e.prev)<0||Cu(e,e.next,t)<0}function Nu(e,t){const n=new Bu(e.i,e.x,e.y),r=new Bu(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ou(e,t,n,r){const i=new Bu(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Du(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class zu{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return zu.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];Fu(e),Vu(n,e);let o=e.length;t.forEach(Fu);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,Vu(n,t[e]);const a=du(n,r);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}}function Fu(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Vu(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Uu extends eo{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){o(e[t])}function o(e){const o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,f=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Gu;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let v,g,y,_,x,b=!1;p&&(v=p.getSpacedPoints(s),b=!0,c=!1,g=p.computeFrenetFrames(s,!1),y=new sr,_=new sr,x=new sr),c||(d=0,u=0,h=0,f=0);const w=e.extractPoints(a);let S=w.shape;const M=w.holes;if(!zu.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];zu.isClockWise(t)&&(M[e]=t.reverse())}}const E=zu.triangulateShape(S,M),T=S;for(let e=0,t=M.length;e<t;e++){const t=M[e];S=S.concat(t)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const C=S.length,R=E.length;function P(e,t,n){let r,i,o;const a=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),f=Math.sqrt(l*l+c*c),d=t.x-s/h,p=t.y+a/h,m=((n.x-c/f-d)*c-(n.y+l/f-p)*l)/(a*c-s*l);r=d+a*m-e.x,i=p+s*m-e.y;const v=r*r+i*i;if(v<=2)return new Zn(r,i);o=Math.sqrt(v/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(r=-s,i=a,o=Math.sqrt(u)):(r=a,i=s,o=Math.sqrt(u/2))}return new Zn(r/o,i/o)}const L=[];for(let e=0,t=T.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),L[e]=P(T[e],T[n],T[r]);const k=[];let I,N=L.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];I=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),I[e]=P(t[e],t[r],t[i]);k.push(I),N=N.concat(I)}for(let e=0;e<d;e++){const t=e/d,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+f;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],L[e],r);B(t.x,t.y,-n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];I=k[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],I[e],r);B(i.x,i.y,-n)}}}const O=h+f;for(let e=0;e<C;e++){const t=c?A(S[e],N[e],O):S[e];b?(_.copy(g.normals[0]).multiplyScalar(t.x),y.copy(g.binormals[0]).multiplyScalar(t.y),x.copy(v[0]).add(_).add(y),B(x.x,x.y,x.z)):B(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<C;t++){const n=c?A(S[t],N[t],O):S[t];b?(_.copy(g.normals[e]).multiplyScalar(n.x),y.copy(g.binormals[e]).multiplyScalar(n.y),x.copy(v[e]).add(_).add(y),B(x.x,x.y,x.z)):B(n.x,n.y,l/s*e)}for(let e=d-1;e>=0;e--){const t=e/d,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+f;for(let e=0,t=T.length;e<t;e++){const t=A(T[e],L[e],r);B(t.x,t.y,l+n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];I=k[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],I[e],r);b?B(i.x,i.y+v[s-1].y,v[s-1].x+n):B(i.x,i.y,l+n)}}}function D(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=s+2*d;e<n;e++){const n=C*e,o=C*(e+1);F(t+r+n,t+i+n,t+i+o,t+r+o)}}}function B(e,t,n){o.push(e),o.push(t),o.push(n)}function z(e,t,i){V(e),V(t),V(i);const o=r.length/3,a=m.generateTopUV(n,r,o-3,o-2,o-1);U(a[0]),U(a[1]),U(a[2])}function F(e,t,i,o){V(e),V(t),V(o),V(t),V(i),V(o);const a=r.length/3,s=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);U(s[0]),U(s[1]),U(s[3]),U(s[1]),U(s[2]),U(s[3])}function V(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function U(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=C*e;for(let e=0;e<R;e++){const n=E[e];z(n[2]+t,n[1]+t,n[0]+t)}e=s+2*d,t=C*e;for(let e=0;e<R;e++){const n=E[e];z(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<R;e++){const t=E[e];z(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=E[e];z(t[0]+C*s,t[1]+C*s,t[2]+C*s)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;D(T,t),t+=T.length;for(let e=0,n=M.length;e<n;e++){const n=M[e];D(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Gi(r,3)),this.setAttribute("uv",new Gi(i,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new fu[r.type]).fromJSON(r)),new Uu(n,e.options)}}const Gu={generateTopUV:function(e,t,n,r,i){const o=t[3*n],a=t[3*n+1],s=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new Zn(o,a),new Zn(s,l),new Zn(c,u)]},generateSideWallUV:function(e,t,n,r,i,o){const a=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],f=t[3*i],d=t[3*i+1],p=t[3*i+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(s-u)<Math.abs(a-c)?[new Zn(a,1-l),new Zn(c,1-h),new Zn(f,1-p),new Zn(m,1-g)]:[new Zn(s,1-l),new Zn(u,1-h),new Zn(d,1-p),new Zn(v,1-g)]}};class Hu extends Vc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Hu(e.radius,e.detail)}}class ju extends eo{constructor(e,t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Gn(r,0,2*Math.PI);const i=[],o=[],a=[],s=1/t,l=new sr,c=new Zn;for(let i=0;i<=t;i++){const u=n+i*s*r,h=Math.sin(u),f=Math.cos(u);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*h,l.y=e[n].y,l.z=e[n].x*f,o.push(l.x,l.y,l.z),c.x=i/t,c.y=n/(e.length-1),a.push(c.x,c.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,o=r,a=r+e.length,s=r+e.length+1,l=r+1;i.push(o,a,l),i.push(a,s,l)}if(this.setIndex(i),this.setAttribute("position",new Gi(o,3)),this.setAttribute("uv",new Gi(a,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new sr,i=new sr,o=new sr,a=t*e.length*3;for(let t=0,s=0;t<e.length;t++,s+=3)r.x=n[s+0],r.y=n[s+1],r.z=n[s+2],i.x=n[a+s+0],i.y=n[a+s+1],i.z=n[a+s+2],o.addVectors(r,i).normalize(),n[s+0]=n[a+s+0]=o.x,n[s+1]=n[a+s+1]=o.y,n[s+2]=n[a+s+2]=o.z}}static fromJSON(e){return new ju(e.points,e.segments,e.phiStart,e.phiLength)}}class Wu extends Vc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Wu(e.radius,e.detail)}}class qu extends eo{constructor(e,t,n){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const r=[],i=[],o=[],a=[],s=1e-5,l=new sr,c=new sr,u=new sr,h=new sr,f=new sr;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const d=t+1;for(let r=0;r<=n;r++){const d=r/n;for(let n=0;n<=t;n++){const r=n/t;e(r,d,c),i.push(c.x,c.y,c.z),r-s>=0?(e(r-s,d,u),h.subVectors(c,u)):(e(r+s,d,u),h.subVectors(u,c)),d-s>=0?(e(r,d-s,u),f.subVectors(c,u)):(e(r,d+s,u),f.subVectors(u,c)),l.crossVectors(h,f).normalize(),o.push(l.x,l.y,l.z),a.push(r,d)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*d+n,i=e*d+n+1,o=(e+1)*d+n+1,a=(e+1)*d+n;r.push(t,i,a),r.push(i,o,a)}this.setIndex(r),this.setAttribute("position",new Gi(i,3)),this.setAttribute("normal",new Gi(o,3)),this.setAttribute("uv",new Gi(a,2))}}class Xu extends eo{constructor(e=.5,t=1,n=8,r=1,i=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const a=[],s=[],l=[],c=[];let u=e;const h=(t-e)/(r=Math.max(1,r)),f=new sr,d=new Zn;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*o;f.x=u*Math.cos(r),f.y=u*Math.sin(r),s.push(f.x,f.y,f.z),l.push(0,0,1),d.x=(f.x/t+1)/2,d.y=(f.y/t+1)/2,c.push(d.x,d.y)}u+=h}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,o=r+n+1,s=r+n+2,l=r+1;a.push(i,o,l),a.push(o,s,l)}}this.setIndex(a),this.setAttribute("position",new Gi(s,3)),this.setAttribute("normal",new Gi(l,3)),this.setAttribute("uv",new Gi(c,2))}static fromJSON(e){return new Xu(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Yu extends eo{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let a=0,s=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,s,t),a+=s,s=0;function l(e){const a=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===zu.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===zu.isClockWise(t)&&(u[e]=t.reverse())}const h=zu.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+a,i=t[1]+a,o=t[2]+a;n.push(r,i,o),s+=3}}this.setIndex(n),this.setAttribute("position",new Gi(r,3)),this.setAttribute("normal",new Gi(i,3)),this.setAttribute("uv",new Gi(o,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new Yu(n,e.curveSegments)}}class Zu extends eo{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(o+a,Math.PI);let l=0;const c=[],u=new sr,h=new sr,f=[],d=[],p=[],m=[];for(let f=0;f<=n;f++){const v=[],g=f/n;let y=0;0==f&&0==o?y=.5/t:f==n&&s==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(r+s*i)*Math.sin(o+g*a),u.y=e*Math.cos(o+g*a),u.z=e*Math.sin(r+s*i)*Math.sin(o+g*a),d.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),m.push(s+y,1-g),v.push(l++)}c.push(v)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],a=c[e+1][r],l=c[e+1][r+1];(0!==e||o>0)&&f.push(t,i,l),(e!==n-1||s<Math.PI)&&f.push(i,a,l)}this.setIndex(f),this.setAttribute("position",new Gi(d,3)),this.setAttribute("normal",new Gi(p,3)),this.setAttribute("uv",new Gi(m,2))}static fromJSON(e){return new Zu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class $u extends Vc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $u(e.radius,e.detail)}}class Ju extends Uu{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new eo;const r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t),this.type="TextGeometry"}}class Ku extends eo{constructor(e=1,t=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],s=[],l=[],c=new sr,u=new sr,h=new sr;for(let o=0;o<=n;o++)for(let f=0;f<=r;f++){const d=f/r*i,p=o/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(d),u.y=(e+t*Math.cos(p))*Math.sin(d),u.z=t*Math.sin(p),a.push(u.x,u.y,u.z),c.x=e*Math.cos(d),c.y=e*Math.sin(d),h.subVectors(u,c).normalize(),s.push(h.x,h.y,h.z),l.push(f/r),l.push(o/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,a=(r+1)*(e-1)+t,s=(r+1)*e+t;o.push(n,i,s),o.push(i,a,s)}this.setIndex(o),this.setAttribute("position",new Gi(a,3)),this.setAttribute("normal",new Gi(s,3)),this.setAttribute("uv",new Gi(l,2))}static fromJSON(e){return new Ku(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Qu extends eo{constructor(e=1,t=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],s=[],l=[],c=[],u=new sr,h=new sr,f=new sr,d=new sr,p=new sr,m=new sr,v=new sr;for(let a=0;a<=n;++a){const y=a/n*i*Math.PI*2;g(y,i,o,e,f),g(y+.01,i,o,e,d),m.subVectors(d,f),v.addVectors(d,f),p.crossVectors(m,v),v.crossVectors(p,m),p.normalize(),v.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,o=-t*Math.cos(i),d=t*Math.sin(i);u.x=f.x+(o*v.x+d*p.x),u.y=f.y+(o*v.y+d*p.y),u.z=f.z+(o*v.z+d*p.z),s.push(u.x,u.y,u.z),h.subVectors(u,f).normalize(),l.push(h.x,h.y,h.z),c.push(a/n),c.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;a.push(n,i,s),a.push(i,o,s)}function g(e,t,n,r,i){const o=Math.cos(e),a=Math.sin(e),s=n/t*e,l=Math.cos(s);i.x=r*(2+l)*.5*o,i.y=r*(2+l)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new Gi(s,3)),this.setAttribute("normal",new Gi(l,3)),this.setAttribute("uv",new Gi(c,2))}static fromJSON(e){return new Qu(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class eh extends eo{constructor(e,t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new sr,s=new sr,l=new Zn;let c=new sr;const u=[],h=[],f=[],d=[];function p(i){c=e.getPointAt(i/t,c);const l=o.normals[i],f=o.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);s.x=o*l.x+i*f.x,s.y=o*l.y+i*f.y,s.z=o*l.z+i*f.z,s.normalize(),h.push(s.x,s.y,s.z),a.x=c.x+n*s.x,a.y=c.y+n*s.y,a.z=c.z+n*s.z,u.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,f.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;d.push(n,i,a),d.push(i,o,a)}}()}(),this.setIndex(d),this.setAttribute("position",new Gi(u,3)),this.setAttribute("normal",new Gi(h,3)),this.setAttribute("uv",new Gi(f,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new eh((new fu[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class th extends eo{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],n=new Set,r=new sr,i=new sr;if(null!==e.index){const o=e.attributes.position,a=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=s.length;e<l;++e){const l=s[e],c=l.start;for(let e=c,s=c+l.count;e<s;e+=3)for(let s=0;s<3;s++){const l=a.getX(e+s),c=a.getX(e+(s+1)%3);r.fromBufferAttribute(o,l),i.fromBufferAttribute(o,c),!0===nh(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const o=e.attributes.position;for(let e=0,a=o.count/3;e<a;e++)for(let a=0;a<3;a++){const s=3*e+a,l=3*e+(a+1)%3;r.fromBufferAttribute(o,s),i.fromBufferAttribute(o,l),!0===nh(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new Gi(t,3))}}function nh(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r,i),!0)}var rh=Object.freeze({__proto__:null,BoxGeometry:bo,BoxBufferGeometry:bo,CircleGeometry:Bc,CircleBufferGeometry:Bc,ConeGeometry:Fc,ConeBufferGeometry:Fc,CylinderGeometry:zc,CylinderBufferGeometry:zc,DodecahedronGeometry:Uc,DodecahedronBufferGeometry:Uc,EdgesGeometry:qc,ExtrudeGeometry:Uu,ExtrudeBufferGeometry:Uu,IcosahedronGeometry:Hu,IcosahedronBufferGeometry:Hu,LatheGeometry:ju,LatheBufferGeometry:ju,OctahedronGeometry:Wu,OctahedronBufferGeometry:Wu,ParametricGeometry:qu,ParametricBufferGeometry:qu,PlaneGeometry:Vo,PlaneBufferGeometry:Vo,PolyhedronGeometry:Vc,PolyhedronBufferGeometry:Vc,RingGeometry:Xu,RingBufferGeometry:Xu,ShapeGeometry:Yu,ShapeBufferGeometry:Yu,SphereGeometry:Zu,SphereBufferGeometry:Zu,TetrahedronGeometry:$u,TetrahedronBufferGeometry:$u,TextGeometry:Ju,TextBufferGeometry:Ju,TorusGeometry:Ku,TorusBufferGeometry:Ku,TorusKnotGeometry:Qu,TorusKnotBufferGeometry:Qu,TubeGeometry:eh,TubeBufferGeometry:eh,WireframeGeometry:th});class ih extends wi{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ri(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ih.prototype.isShadowMaterial=!0;class oh extends wi{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ri(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}oh.prototype.isMeshStandardMaterial=!0;class ah extends oh{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Gn(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new Ri(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new Ri(1,1,1),this.specularTintMap=null,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ri).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}ah.prototype.isMeshPhysicalMaterial=!0;class sh extends wi{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ri(16777215),this.specular=new Ri(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}sh.prototype.isMeshPhongMaterial=!0;class lh extends wi{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ri(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}lh.prototype.isMeshToonMaterial=!0;class ch extends wi{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}ch.prototype.isMeshNormalMaterial=!0;class uh extends wi{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Ri(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}uh.prototype.isMeshLambertMaterial=!0;class hh extends wi{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ri(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}hh.prototype.isMeshMatcapMaterial=!0;class fh extends mc{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}fh.prototype.isLineDashedMaterial=!0;var dh=Object.freeze({__proto__:null,ShadowMaterial:ih,SpriteMaterial:Nl,RawShaderMaterial:Jo,ShaderMaterial:Eo,PointsMaterial:Tc,MeshPhysicalMaterial:ah,MeshStandardMaterial:oh,MeshPhongMaterial:sh,MeshToonMaterial:lh,MeshNormalMaterial:ch,MeshLambertMaterial:uh,MeshDepthMaterial:pl,MeshDistanceMaterial:ml,MeshBasicMaterial:Pi,MeshMatcapMaterial:hh,LineDashedMaterial:fh,LineBasicMaterial:mc,Material:wi});const ph={arraySlice:function(e,t,n){return ph.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,a=0;a!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[a++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r,i=30){const o=e.clone();o.name=t;const a=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],s=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){l.push(t.times[e]);for(let n=0;n<s;++n)c.push(t.values[e*s+n])}}0!==l.length&&(t.times=ph.convertArray(l,t.times.constructor),t.values=ph.convertArray(c,t.values.constructor),a.push(t))}o.tracks=a;let s=1/0;for(let e=0;e<o.tracks.length;++e)s>o.tracks[e].times[0]&&(s=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const a=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===a)continue;let s=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let f;if(o<=r.times[0]){const e=s,t=l-s;f=ph.arraySlice(r.values,e,t)}else if(o>=r.times[h]){const e=h*l+s,t=e+l-s;f=ph.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=s,n=l-s;e.evaluate(o),f=ph.arraySlice(e.resultBuffer,t,n)}if("quaternion"===i){(new ar).fromArray(f).normalize().conjugate().toArray(f)}const d=a.times.length;for(let e=0;e<d;++e){const t=e*u+c;if("quaternion"===i)ar.multiplyQuaternionsFlat(a.values,t,f,0,a.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)a.values[t+n]-=f[n]}}}return e.blendMode=qt,e}};class mh{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const a=t[1];e<a&&(n=2,i=a);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}mh.prototype.beforeStart_=mh.prototype.copySampleValue_,mh.prototype.afterEnd_=mh.prototype.copySampleValue_;class vh extends mh{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gt,endingEnd:Gt}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case Ht:i=e,a=2*t-n;break;case jt:i=r.length-2,a=t+r[i]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Ht:o=e,s=2*n-t;break;case jt:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=o*c}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-t)/(r-t),p=d*d,m=p*d,v=-h*m+2*h*p-h*d,g=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*d+1,y=(-1-f)*m+(1.5+f)*p+.5*d,_=f*m-f*p;for(let e=0;e!==a;++e)i[e]=v*o[c+e]+g*o[l+e]+y*o[s+e]+_*o[u+e];return i}}class gh extends mh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==a;++e)i[e]=o[l+e]*u+o[s+e]*c;return i}}class yh extends mh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class _h{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ph.convertArray(t,this.TimeBufferType),this.values=ph.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:ph.convertArray(e.times,Array),values:ph.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new yh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new gh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new vh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ft:t=this.InterpolantFactoryMethodDiscrete;break;case Vt:t=this.InterpolantFactoryMethodLinear;break;case Ut:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ft;case this.InterpolantFactoryMethodLinear:return Vt;case this.InterpolantFactoryMethodSmooth:return Ut}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=ph.arraySlice(n,i,o),this.values=ph.arraySlice(this.values,i*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&ph.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=ph.arraySlice(this.times),t=ph.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Ut,i=e.length-1;let o=1;for(let a=1;a<i;++a){let i=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(r)i=!0;else{const e=a*n,r=e-n,o=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[r+a]||n!==t[o+a]){i=!0;break}}}if(i){if(a!==o){e[o]=e[a];const r=a*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,a=0;a!==n;++a)t[r+a]=t[e+a];++o}return o!==e.length?(this.times=ph.arraySlice(e,0,o),this.values=ph.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=ph.arraySlice(this.times,0),t=ph.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}_h.prototype.TimeBufferType=Float32Array,_h.prototype.ValueBufferType=Float32Array,_h.prototype.DefaultInterpolation=Vt;class xh extends _h{}xh.prototype.ValueTypeName="bool",xh.prototype.ValueBufferType=Array,xh.prototype.DefaultInterpolation=Ft,xh.prototype.InterpolantFactoryMethodLinear=void 0,xh.prototype.InterpolantFactoryMethodSmooth=void 0;class bh extends _h{}bh.prototype.ValueTypeName="color";class wh extends _h{}wh.prototype.ValueTypeName="number";class Sh extends mh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(r-t);let l=e*a;for(let e=l+a;l!==e;l+=4)ar.slerpFlat(i,0,o,l-a,o,l,s);return i}}class Mh extends _h{InterpolantFactoryMethodLinear(e){return new Sh(this.times,this.values,this.getValueSize(),e)}}Mh.prototype.ValueTypeName="quaternion",Mh.prototype.DefaultInterpolation=Vt,Mh.prototype.InterpolantFactoryMethodSmooth=void 0;class Eh extends _h{}Eh.prototype.ValueTypeName="string",Eh.prototype.ValueBufferType=Array,Eh.prototype.DefaultInterpolation=Ft,Eh.prototype.InterpolantFactoryMethodLinear=void 0,Eh.prototype.InterpolantFactoryMethodSmooth=void 0;class Th extends _h{}Th.prototype.ValueTypeName="vector";class Ah{constructor(e,t=-1,n,r=Wt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Un(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Ch(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(_h.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let a=[],s=[];a.push((e+i-1)%i,e,(e+1)%i),s.push(0,1,0);const l=ph.getKeyframeOrder(a);a=ph.sortedArray(a,1,l),s=ph.sortedArray(s,1,l),r||0!==a[0]||(a.push(i),s.push(s[0])),o.push(new wh(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],a=[];ph.flattenJSON(n,o,a,r),0!==o.length&&i.push(new e(t,o,a))}},r=[],i=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new wh(".morphTargetInfluence["+n+"]",e,o))}s=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";n(Th,o+".position",i,"pos",r),n(Mh,o+".quaternion",i,"rot",r),n(Th,o+".scale",i,"scl",r)}}if(0===r.length)return null;return new this(i,s,r,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ch(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wh;case"vector":case"vector2":case"vector3":case"vector4":return Th;case"color":return bh;case"quaternion":return Mh;case"bool":case"boolean":return xh;case"string":return Eh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];ph.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Rh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Ph{constructor(e,t,n){const r=this;let i=!1,o=0,a=0,s=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const Lh=new Ph;class kh{constructor(e){this.manager=void 0!==e?e:Lh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ih={};class Nh extends kh{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Rh.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0!==Ih[e])return void Ih[e].push({onLoad:t,onProgress:n,onError:r});const a=e.match(/^data:(.*?)(;base64)?,(.*)$/);let s;if(a){const n=a[1],o=!!a[2];let s=a[3];s=decodeURIComponent(s),o&&(s=atob(s));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(s.length);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);r="blob"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;r=t.parseFromString(s,n);break;case"json":r=JSON.parse(s);break;default:r=s}setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{Ih[e]=[],Ih[e].push({onLoad:t,onProgress:n,onError:r}),s=new XMLHttpRequest,s.open("GET",e,!0),s.addEventListener("load",(function(t){const n=this.response,r=Ih[e];if(delete Ih[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Rh.add(e,n);for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onLoad&&t.onLoad(n)}i.manager.itemEnd(e)}else{for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),s.addEventListener("progress",(function(t){const n=Ih[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onProgress&&r.onProgress(t)}}),!1),s.addEventListener("error",(function(t){const n=Ih[e];delete Ih[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),s.addEventListener("abort",(function(t){const n=Ih[e];delete Ih[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(s.responseType=this.responseType),void 0!==this.withCredentials&&(s.withCredentials=this.withCredentials),s.overrideMimeType&&s.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)s.setRequestHeader(e,this.requestHeader[e]);s.send(null)}return i.manager.itemStart(e),s}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Oh extends kh{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Nh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=Ah.parse(e[n]);t.push(r)}return t}}class Dh extends kh{constructor(e){super(e)}load(e,t,n,r){const i=this,o=[],a=new Nc,s=new Nh(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);let l=0;function c(c){s.load(e[c],(function(e){const n=i.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=_e),a.image=o,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else s.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}a.image=o}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=_e),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,r);return a}}class Bh extends kh{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Rh.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Rh.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}class zh extends kh{constructor(e){super(e)}load(e,t,n,r){const i=new Ro,o=new Bh(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(n){o.load(e[n],(function(e){i.images[n]=e,a++,6===a&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)s(t);return i}}class Fh extends kh{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new ac,a=new Nh(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:fe,o.wrapT=void 0!==n.wrapT?n.wrapT:fe,o.magFilter=void 0!==n.magFilter?n.magFilter:_e,o.minFilter=void 0!==n.minFilter?n.minFilter:_e,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=we),1===n.mipmapCount&&(o.minFilter=_e),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}class Vh extends kh{constructor(e){super(e)}load(e,t,n,r){const i=new er,o=new Bh(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;const r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?Be:ze,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class Uh extends Xc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new su(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){const e=n[r]-t,i=this.curves[r],o=i.getLength(),a=0===o?0:1-e/o;return i.getPointAt(a)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a);for(let e=0;e<s.length;e++){const r=s[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new fu[n.type]).fromJSON(n))}return this}}class Gh extends Uh{constructor(e){super(),this.type="Path",this.currentPoint=new Zn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new su(this.currentPoint.clone(),new Zn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new cu(this.currentPoint.clone(),new Zn(e,t),new Zn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,o){const a=new ou(this.currentPoint.clone(),new Zn(e,t),new Zn(n,r),new Zn(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new hu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this}absarc(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this}ellipse(e,t,n,r,i,o,a,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,o,a,s),this}absellipse(e,t,n,r,i,o,a,s){const l=new Yc(e,t,n,r,i,o,a,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Hh extends Gh{constructor(e){super(e),this.uuid=Un(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Gh).fromJSON(n))}return this}}class jh extends ci{constructor(e,t=1){super(),this.type="Light",this.color=new Ri(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}jh.prototype.isLight=!0;class Wh extends jh{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.groundColor=new Ri(t)}copy(e){return jh.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}Wh.prototype.isHemisphereLight=!0;const qh=new zr,Xh=new sr,Yh=new sr;class Zh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Zn(512,512),this.map=null,this.mapPass=null,this.matrix=new zr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Bo,this._frameExtents=new Zn(1,1),this._viewportCount=1,this._viewports=[new nr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Xh.setFromMatrixPosition(e.matrixWorld),t.position.copy(Xh),Yh.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Yh),t.updateMatrixWorld(),qh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class $h extends Zh{constructor(){super(new Ao(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Vn*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}$h.prototype.isSpotLightShadow=!0;class Jh extends jh{constructor(e,t,n=0,r=Math.PI/3,i=0,o=1){super(e,t),this.type="SpotLight",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.target=new ci,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.shadow=new $h}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Jh.prototype.isSpotLight=!0;const Kh=new zr,Qh=new sr,ef=new sr;class tf extends Zh{constructor(){super(new Ao(90,1,.5,500)),this._frameExtents=new Zn(4,2),this._viewportCount=6,this._viewports=[new nr(2,1,1,1),new nr(0,1,1,1),new nr(3,1,1,1),new nr(1,1,1,1),new nr(3,0,1,1),new nr(1,0,1,1)],this._cubeDirections=[new sr(1,0,0),new sr(-1,0,0),new sr(0,0,1),new sr(0,0,-1),new sr(0,1,0),new sr(0,-1,0)],this._cubeUps=[new sr(0,1,0),new sr(0,1,0),new sr(0,1,0),new sr(0,1,0),new sr(0,0,1),new sr(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Qh.setFromMatrixPosition(e.matrixWorld),n.position.copy(Qh),ef.copy(n.position),ef.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(ef),n.updateMatrixWorld(),r.makeTranslation(-Qh.x,-Qh.y,-Qh.z),Kh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kh)}}tf.prototype.isPointLightShadow=!0;class nf extends jh{constructor(e,t,n=0,r=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new tf}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}nf.prototype.isPointLight=!0;class rf extends Zh{constructor(){super(new $o(-5,5,5,-5,.5,500))}}rf.prototype.isDirectionalLightShadow=!0;class of extends jh{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(ci.DefaultUp),this.updateMatrix(),this.target=new ci,this.shadow=new rf}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}of.prototype.isDirectionalLight=!0;class af extends jh{constructor(e,t){super(e,t),this.type="AmbientLight"}}af.prototype.isAmbientLight=!0;class sf extends jh{constructor(e,t,n=10,r=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=r}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}sf.prototype.isRectAreaLight=!0;class lf{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new sr)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}lf.prototype.isSphericalHarmonics3=!0;class cf extends jh{constructor(e=new lf,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}cf.prototype.isLightProbe=!0;class uf extends kh{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,o=new Nh(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=new dh[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new Ri).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularTint&&void 0!==r.specularTint&&r.specularTint.setHex(e.specularTint),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationTint&&void 0!==r.attenuationTint&&r.attenuationTint.setHex(e.attenuationTint),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new Ri).setHex(i.value);break;case"v2":r.uniforms[t].value=(new Zn).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new sr).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new nr).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new $n).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new zr).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new Zn).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularTintMap&&(r.specularTintMap=n(e.specularTintMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Zn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),r}setTextures(e){return this.textures=e,this}}class hf{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class ff extends eo{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}ff.prototype.isInstancedBufferGeometry=!0;class df extends Ii{constructor(e,t,n,r=1){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}df.prototype.isInstancedBufferAttribute=!0;class pf extends kh{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Nh(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),a=qi(i.type,o),s=new Ll(a,i.stride);return s.uuid=i.uuid,t[r]=s,s}const i=e.isInstancedBufferGeometry?new ff:new eo,o=e.data.index;if(void 0!==o){const e=qi(o.type,o.array);i.setIndex(new Ii(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let o;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);o=new Il(t,n.itemSize,n.offset,n.normalized)}else{const e=qi(n.type,n.array);o=new(n.isInstancedBufferAttribute?df:Ii)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),void 0!==n.usage&&o.setUsage(n.usage),void 0!==n.updateRange&&(o.updateRange.offset=n.updateRange.offset,o.updateRange.count=n.updateRange.count),i.setAttribute(t,o)}const s=e.data.morphAttributes;if(s)for(const t in s){const n=s[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let a;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);a=new Il(t,i.itemSize,i.offset,i.normalized)}else{const e=qi(i.type,i.array);a=new Ii(e,i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),o.push(a)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new sr;void 0!==c.center&&e.fromArray(c.center),i.boundingSphere=new Rr(e,c.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}class mf extends kh{constructor(e){super(e)}load(e,t,n,r){const i=this,o=""===this.path?hf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Nh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}async loadAsync(e,t){const n=""===this.path?hf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Nh(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),o=JSON.parse(i),a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),a=this.parseTextures(e.textures,o),s=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,i,s,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a,o,t),l=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,l),s}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new Hh).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new cc).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new pf;for(let i=0,o=e.length;i<o;i++){let o;const a=e[i];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in rh?o=rh[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),n[a.uuid]=o}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new uf;i.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if("MultiMaterial"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const r=o.materials[t];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),e.push(n[r.uuid])}r[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=Ah.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function o(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:qi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Ph(t);i=new Bh(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let e=0,t=i.length;e<t;e++){const t=o(i[e]);null!==t&&(t instanceof HTMLImageElement?r[n.uuid].push(t):r[n.uuid].push(new ac(t.data,t.width,t.height)))}}else{const e=o(n.url);null!==e&&(r[n.uuid]=e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:qi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new Bh(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],o=r.url;if(Array.isArray(o)){n[r.uuid]=[];for(let e=0,t=o.length;e<t;e++){const t=o[e],a=await i(t);null!==a&&(a instanceof HTMLImageElement?n[r.uuid].push(a):n[r.uuid].push(new ac(a.data,a.width,a.height)))}}else{const e=await i(r.url);null!==e&&(n[r.uuid]=e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,o=e.length;i<o;i++){const o=e[i];let a;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const s=t[o.image];Array.isArray(s)?(a=new Ro(s),6===s.length&&(a.needsUpdate=!0)):(a=s&&s.data?new ac(s.data,s.width,s.height):new er(s),s&&(a.needsUpdate=!0)),a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.mapping&&(a.mapping=n(o.mapping,vf)),void 0!==o.offset&&a.offset.fromArray(o.offset),void 0!==o.repeat&&a.repeat.fromArray(o.repeat),void 0!==o.center&&a.center.fromArray(o.center),void 0!==o.rotation&&(a.rotation=o.rotation),void 0!==o.wrap&&(a.wrapS=n(o.wrap[0],gf),a.wrapT=n(o.wrap[1],gf)),void 0!==o.format&&(a.format=o.format),void 0!==o.type&&(a.type=o.type),void 0!==o.encoding&&(a.encoding=o.encoding),void 0!==o.minFilter&&(a.minFilter=n(o.minFilter,yf)),void 0!==o.magFilter&&(a.magFilter=n(o.magFilter,yf)),void 0!==o.anisotropy&&(a.anisotropy=o.anisotropy),void 0!==o.flipY&&(a.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(a.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(a.unpackAlignment=o.unpackAlignment),r[o.uuid]=a}return r}parseObject(e,t,n,r,i){let o,a,s;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":o=new Pl,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new Ri(e.background):o.background=u(e.background)),void 0!==e.environment&&(o.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new Rl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new Cl(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new Ao(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new $o(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new af(e.color,e.intensity);break;case"DirectionalLight":o=new of(e.color,e.intensity);break;case"PointLight":o=new nf(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new sf(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Jh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Wh(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new cf).fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),s=c(e.material),o=new ic(a,s),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),s=c(e.material),o=new _o(a,s);break;case"InstancedMesh":a=l(e.geometry),s=c(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;o=new pc(a,s,t),o.instanceMatrix=new Ii(new Float32Array(n.array),16),void 0!==r&&(o.instanceColor=new Ii(new Float32Array(r.array),r.itemSize));break;case"LOD":o=new Kl;break;case"Line":o=new bc(l(e.geometry),c(e.material));break;case"LineLoop":o=new Ec(l(e.geometry),c(e.material));break;case"LineSegments":o=new Mc(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new Lc(l(e.geometry),c(e.material));break;case"Sprite":o=new Yl(c(e.material));break;case"Group":o=new bl;break;case"Bone":o=new oc;break;default:o=new ci}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)o.add(this.parseObject(a[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=o.getObjectByProperty("uuid",n.object);void 0!==r&&o.addLevel(r,n.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const vf={UVMapping:ie,CubeReflectionMapping:oe,CubeRefractionMapping:ae,EquirectangularReflectionMapping:se,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:ue},gf={RepeatWrapping:he,ClampToEdgeWrapping:fe,MirroredRepeatWrapping:de},yf={NearestFilter:pe,NearestMipmapNearestFilter:me,NearestMipmapLinearFilter:ge,LinearFilter:_e,LinearMipmapNearestFilter:xe,LinearMipmapLinearFilter:we};class _f extends kh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Rh.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){Rh.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}_f.prototype.isImageBitmapLoader=!0;class xf{constructor(){this.type="ShapePath",this.color=new Ri,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Gh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new Hh;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],a=t[o],s=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],s=-s,a=t[i],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return r}const i=zu.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let a,s,l;const c=[];if(1===o.length)return s=o[0],l=new Hh,l.curves=s.curves,c.push(l),c;let u=!i(o[0].getPoints());u=e?!u:u;const h=[],f=[];let d,p,m=[],v=0;f[v]=void 0,m[v]=[];for(let t=0,n=o.length;t<n;t++)s=o[t],d=s.getPoints(),a=i(d),a=e?!a:a,a?(!u&&f[v]&&v++,f[v]={s:new Hh,p:d},f[v].s.curves=s.curves,u&&v++,m[v]=[]):m[v].push({h:s,p:d[0]});if(!f[0])return n(o);if(f.length>1){let e=!1;const t=[];for(let e=0,t=f.length;e<t;e++)h[e]=[];for(let n=0,i=f.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const a=i[o];let s=!0;for(let i=0;i<f.length;i++)r(a.p,f[i].p)&&(n!==i&&t.push({froms:n,tos:i,hole:o}),s?(s=!1,h[i].push(a)):e=!0);s&&h[n].push(a)}}t.length>0&&(e||(m=h))}for(let e=0,t=f.length;e<t;e++){l=f[e].s,c.push(l),p=m[e];for(let e=0,t=p.length;e<t;e++)l.holes.push(p[e].h)}return c}}class bf{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],r=function(e,t,n){const r=Array.from(e),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[];let s=0,l=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)s=0,l-=o;else{const e=wf(t,i,s,l,n);s+=e.offsetX,a.push(e.path)}}return a}(e,t,this.data);for(let e=0,t=r.length;e<t;e++)Array.prototype.push.apply(n,r[e].toShapes());return n}}function wf(e,t,n,r,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const a=new xf;let s,l,c,u,h,f,d,p;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;){switch(e[i++]){case"m":s=e[i++]*t+n,l=e[i++]*t+r,a.moveTo(s,l);break;case"l":s=e[i++]*t+n,l=e[i++]*t+r,a.lineTo(s,l);break;case"q":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,f=e[i++]*t+r,a.quadraticCurveTo(h,f,c,u);break;case"b":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,f=e[i++]*t+r,d=e[i++]*t+n,p=e[i++]*t+r,a.bezierCurveTo(h,f,d,p,c,u)}}}return{offsetX:o.ha*t,path:a}}bf.prototype.isFont=!0;class Sf extends kh{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Nh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const r=i.parse(n);t&&t(r)}),n,r)}parse(e){return new bf(e)}}let Mf;const Ef={getContext:function(){return void 0===Mf&&(Mf=new(window.AudioContext||window.webkitAudioContext)),Mf},setContext:function(e){Mf=e}};class Tf extends kh{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Nh(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);Ef.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}class Af extends cf{constructor(e,t,n=1){super(void 0,n);const r=(new Ri).set(e),i=(new Ri).set(t),o=new sr(r.r,r.g,r.b),a=new sr(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}}Af.prototype.isHemisphereLightProbe=!0;class Cf extends cf{constructor(e,t=1){super(void 0,t);const n=(new Ri).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Cf.prototype.isAmbientLightProbe=!0;const Rf=new zr,Pf=new zr;class Lf{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ao,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ao,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),r=t.eyeSep/2,i=r*t.near/t.focus,o=t.near*Math.tan(Fn*t.fov*.5)/t.zoom;let a,s;Pf.elements[12]=-r,Rf.elements[12]=r,a=-o*t.aspect+i,s=o*t.aspect+i,n.elements[0]=2*t.near/(s-a),n.elements[8]=(s+a)/(s-a),this.cameraL.projectionMatrix.copy(n),a=-o*t.aspect-i,s=o*t.aspect-i,n.elements[0]=2*t.near/(s-a),n.elements[8]=(s+a)/(s-a),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Pf),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rf)}}class kf{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=If(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=If();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function If(){return("undefined"==typeof performance?Date:performance).now()}const Nf=new sr,Of=new ar,Df=new sr,Bf=new sr;class zf extends ci{constructor(){super(),this.type="AudioListener",this.context=Ef.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new kf}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Nf,Of,Df),Bf.set(0,0,-1).applyQuaternion(Of),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Nf.x,e),t.positionY.linearRampToValueAtTime(Nf.y,e),t.positionZ.linearRampToValueAtTime(Nf.z,e),t.forwardX.linearRampToValueAtTime(Bf.x,e),t.forwardY.linearRampToValueAtTime(Bf.y,e),t.forwardZ.linearRampToValueAtTime(Bf.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Nf.x,Nf.y,Nf.z),t.setOrientation(Bf.x,Bf.y,Bf.z,n.x,n.y,n.z)}}class Ff extends ci{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Vf=new sr,Uf=new ar,Gf=new sr,Hf=new sr;class jf extends Ff{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Vf,Uf,Gf),Hf.set(0,0,1).applyQuaternion(Uf);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Vf.x,e),t.positionY.linearRampToValueAtTime(Vf.y,e),t.positionZ.linearRampToValueAtTime(Vf.z,e),t.orientationX.linearRampToValueAtTime(Hf.x,e),t.orientationY.linearRampToValueAtTime(Hf.y,e),t.orientationZ.linearRampToValueAtTime(Hf.z,e)}else t.setPosition(Vf.x,Vf.y,Vf.z),t.setOrientation(Hf.x,Hf.y,Hf.z)}}class Wf{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class qf{constructor(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){ar.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const o=this._workIndex*i;ar.multiplyQuaternionsFlat(e,o,e,t,e,n),ar.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,i){const o=1-r;for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}}const Xf=new RegExp("[\\[\\]\\.:\\/]","g"),Yf="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Zf=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),$f=/(WCOD+)?/.source.replace("WCOD",Yf),Jf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Kf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Qf=new RegExp("^"+Zf+$f+Jf+Kf+"$"),ed=["material","materials","bones"];class td{constructor(e,t,n){this.path=t,this.parsedPath=n||td.parseTrackName(t),this.node=td.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new td.Composite(e,t,n):new td(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Xf,"")}static parseTrackName(e){const t=Qf.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==ed.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=td.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}td.Composite=class{constructor(e,t,n){const r=n||td.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},td.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},td.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},td.prototype.GetterByBindingType=[td.prototype._getValue_direct,td.prototype._getValue_array,td.prototype._getValue_arrayElement,td.prototype._getValue_toArray],td.prototype.SetterByBindingTypeAndVersioning=[[td.prototype._setValue_direct,td.prototype._setValue_direct_setNeedsUpdate,td.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[td.prototype._setValue_array,td.prototype._setValue_array_setNeedsUpdate,td.prototype._setValue_array_setMatrixWorldNeedsUpdate],[td.prototype._setValue_arrayElement,td.prototype._setValue_arrayElement_setNeedsUpdate,td.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[td.prototype._setValue_fromArray,td.prototype._setValue_fromArray_setNeedsUpdate,td.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class nd{constructor(){this.uuid=Un(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let a=void 0,s=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let f=t[h];if(void 0===f){f=s++,t[h]=f,e.push(u);for(let e=0,t=o;e!==t;++e)i[e].push(new td(u,n[e],r[e]))}else if(f<l){a=e[f];const s=--l,c=e[s];t[c.uuid]=f,e[f]=c,t[h]=s,e[s]=u;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[s];let a=t[f];t[f]=o,void 0===a&&(a=new td(u,n[e],r[e])),t[s]=a}}else e[f]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o],s=a.uuid,l=t[s];if(void 0!==l&&l>=i){const o=i++,c=e[o];t[c.uuid]=l,e[l]=c,t[s]=o,e[o]=a;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[l];t[l]=r,t[o]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a].uuid,l=t[s];if(void 0!==l)if(delete t[s],l<i){const a=--i,s=e[a],c=--o,u=e[c];t[s.uuid]=l,e[l]=s,t[u.uuid]=a,e[a]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[c];t[l]=r,t[a]=i,t.pop()}}else{const i=--o,a=e[i];i>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,o.push(e),a.push(t),i.push(u);for(let n=c,r=s.length;n!==r;++n){const r=s[n];u[n]=new td(r,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}nd.prototype.isAnimationObjectGroup=!0;class rd{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,a=new Array(o),s={endingStart:Gt,endingEnd:Gt};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);a[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Bt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case qt:for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(a);break;case Wt:default:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=n===zt;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(n===Dt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Ht,r.endingEnd=Ht):(r.endingStart=e?this.zeroSlopeAtStart?Ht:Gt:jt,r.endingEnd=t?this.zeroSlopeAtEnd?Ht:Gt:jt)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=n,this}}class id extends Dn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,s,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new qf(td.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,s,l),o[e]=u}a[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new gh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let o="string"==typeof e?Ah.findByName(r,e):e;const a=null!==o?o.uuid:e,s=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:Wt),void 0!==s){const e=s.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new rd(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?Ah.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let a=0;a!==n;++a){t[a]._update(r,e,i,o)}const a=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)a[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}id.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class od{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new od(void 0===this.value.clone?this.value:this.value.clone())}}class ad extends Ll{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}ad.prototype.isInstancedInterleavedBuffer=!0;class sd{constructor(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}sd.prototype.isGLBufferAttribute=!0;class ld{constructor(e,t,n=0,r=1/0){this.ray=new Br(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Zr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,n=[]){return ud(e,this,n,t),n.sort(cd),n}intersectObjects(e,t=!1,n=[]){for(let r=0,i=e.length;r<i;r++)ud(e[r],this,n,t);return n.sort(cd),n}}function cd(e,t){return e.distance-t.distance}function ud(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)ud(r[e],t,n,!0)}}class hd{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Gn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class fd{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const dd=new Zn;class pd{constructor(e=new Zn(1/0,1/0),t=new Zn(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=dd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return dd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}pd.prototype.isBox2=!0;const md=new sr,vd=new sr;class gd{constructor(e=new sr,t=new sr){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){md.subVectors(e,this.start),vd.subVectors(this.end,this.start);const n=vd.dot(vd);let r=vd.dot(md)/n;return t&&(r=Gn(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class yd extends ci{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}yd.prototype.isImmediateRenderObject=!0;const _d=new sr;class xd extends ci{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new eo,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,o=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new Gi(r,3));const i=new mc({fog:!1,toneMapped:!1});this.cone=new Mc(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),_d.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_d),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const bd=new sr,wd=new zr,Sd=new zr;class Md extends Mc{constructor(e){const t=function e(t){const n=[];t&&t.isBone&&n.push(t);for(let r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new eo,r=[],i=[],o=new Ri(0,0,1),a=new Ri(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new Gi(r,3)),n.setAttribute("color",new Gi(i,3));super(n,new mc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Sd.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(wd.multiplyMatrices(Sd,i.matrixWorld),bd.setFromMatrixPosition(wd),r.setXYZ(n,bd.x,bd.y,bd.z),wd.multiplyMatrices(Sd,i.parent.matrixWorld),bd.setFromMatrixPosition(wd),r.setXYZ(n+1,bd.x,bd.y,bd.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}class Ed extends _o{constructor(e,t,n){super(new Zu(t,4,2),new Pi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Td=new sr,Ad=new Ri,Cd=new Ri;class Rd extends ci{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Wu(t);r.rotateY(.5*Math.PI),this.material=new Pi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new Ii(o,3)),this.add(new _o(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Ad.copy(this.light.color),Cd.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Ad:Cd;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Td.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Pd extends Mc{constructor(e=10,t=10,n=4473924,r=8947848){n=new Ri(n),r=new Ri(r);const i=t/2,o=e/t,a=e/2,s=[],l=[];for(let e=0,c=0,u=-a;e<=t;e++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new eo;c.setAttribute("position",new Gi(s,3)),c.setAttribute("color",new Gi(l,3));super(c,new mc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class Ld extends Mc{constructor(e=10,t=16,n=8,r=64,i=4473924,o=8947848){i=new Ri(i),o=new Ri(o);const a=[],s=[];for(let n=0;n<=t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;a.push(0,0,0),a.push(l,0,c);const u=1&n?i:o;s.push(u.r,u.g,u.b),s.push(u.r,u.g,u.b)}for(let t=0;t<=n;t++){const l=1&t?i:o,c=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c;a.push(n,0,i),s.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c,a.push(n,0,i),s.push(l.r,l.g,l.b)}}const l=new eo;l.setAttribute("position",new Gi(a,3)),l.setAttribute("color",new Gi(s,3));super(l,new mc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const kd=new sr,Id=new sr,Nd=new sr;class Od extends ci{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new eo;r.setAttribute("position",new Gi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new mc({fog:!1,toneMapped:!1});this.lightPlane=new bc(r,i),this.add(this.lightPlane),r=new eo,r.setAttribute("position",new Gi([0,0,0,0,0,1],3)),this.targetLine=new bc(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){kd.setFromMatrixPosition(this.light.matrixWorld),Id.setFromMatrixPosition(this.light.target.matrixWorld),Nd.subVectors(Id,kd),this.lightPlane.lookAt(Id),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Id),this.targetLine.scale.z=Nd.length()}}const Dd=new sr,Bd=new To;class zd extends Mc{constructor(e){const t=new eo,n=new mc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},a=new Ri(16755200),s=new Ri(16711680),l=new Ri(43775),c=new Ri(16777215),u=new Ri(3355443);function h(e,t,n){f(e,n),f(t,n)}function f(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.setAttribute("position",new Gi(r,3)),t.setAttribute("color",new Gi(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;Bd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Fd("c",t,e,Bd,0,0,-1),Fd("t",t,e,Bd,0,0,1),Fd("n1",t,e,Bd,-1,-1,-1),Fd("n2",t,e,Bd,1,-1,-1),Fd("n3",t,e,Bd,-1,1,-1),Fd("n4",t,e,Bd,1,1,-1),Fd("f1",t,e,Bd,-1,-1,1),Fd("f2",t,e,Bd,1,-1,1),Fd("f3",t,e,Bd,-1,1,1),Fd("f4",t,e,Bd,1,1,1),Fd("u1",t,e,Bd,.7,1.1,-1),Fd("u2",t,e,Bd,-.7,1.1,-1),Fd("u3",t,e,Bd,0,2,-1),Fd("cf1",t,e,Bd,-1,0,1),Fd("cf2",t,e,Bd,1,0,1),Fd("cf3",t,e,Bd,0,-1,1),Fd("cf4",t,e,Bd,0,1,1),Fd("cn1",t,e,Bd,-1,0,-1),Fd("cn2",t,e,Bd,1,0,-1),Fd("cn3",t,e,Bd,0,-1,-1),Fd("cn4",t,e,Bd,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Fd(e,t,n,r,i,o,a){Dd.set(i,o,a).unproject(r);const s=t[e];if(void 0!==s){const e=n.getAttribute("position");for(let t=0,n=s.length;t<n;t++)e.setXYZ(s[t],Dd.x,Dd.y,Dd.z)}}const Vd=new ur;class Ud extends Mc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new eo;i.setIndex(new Ii(n,1)),i.setAttribute("position",new Ii(r,3)),super(i,new mc({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Vd.setFromObject(this.object),Vd.isEmpty())return;const t=Vd.min,n=Vd.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Mc.prototype.copy.call(this,e),this.object=e.object,this}}class Gd extends Mc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new eo;r.setIndex(new Ii(n,1)),r.setAttribute("position",new Gi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new mc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Hd extends bc{constructor(e,t=1,n=16776960){const r=n,i=new eo;i.setAttribute("position",new Gi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new mc({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new eo;o.setAttribute("position",new Gi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new _o(o,new Pi({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?m:p,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const jd=new sr;let Wd,qd;class Xd extends ci{constructor(e=new sr(0,0,1),t=new sr(0,0,0),n=1,r=16776960,i=.2*n,o=.2*i){super(),this.type="ArrowHelper",void 0===Wd&&(Wd=new eo,Wd.setAttribute("position",new Gi([0,0,0,0,1,0],3)),qd=new zc(0,.5,1,5,1),qd.translate(0,-.5,0)),this.position.copy(t),this.line=new bc(Wd,new mc({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new _o(qd,new Pi({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{jd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(jd,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Yd extends Mc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new eo;n.setAttribute("position",new Gi(t,3)),n.setAttribute("color",new Gi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new mc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new Ri,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Zd=new Float32Array(1),$d=new Int32Array(Zd.buffer);class Jd{static toHalfFloat(e){Zd[0]=e;const t=$d[0];let n=t>>16&32768,r=t>>12&2047;const i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}}const Kd=0,Qd=1,ep=0,tp=1,np=2;function rp(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function ip(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function op(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Lc(e,t)}function ap(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Yl(e)}function sp(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Lc(e,t)}function lp(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Tc(e)}function cp(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Tc(e)}function up(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Tc(e)}function hp(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new sr(e,t,n)}function fp(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ii(e,t).setUsage(Tn)}function dp(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ni(e,t)}function pp(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Oi(e,t)}function mp(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Di(e,t)}function vp(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Bi(e,t)}function gp(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new zi(e,t)}function yp(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Fi(e,t)}function _p(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Vi(e,t)}function xp(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Gi(e,t)}function bp(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Hi(e,t)}function wp(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Yd(e)}function Sp(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ud(e,t)}function Mp(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Mc(new qc(e.geometry),new mc({color:void 0!==t?t:16777215}))}function Ep(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Mc(new th(e.geometry),new mc({color:void 0!==t?t:16777215}))}function Tp(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Nh(e)}function Ap(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Fh(e)}function Cp(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Po(e,n)}function Rp(){console.error("THREE.CanvasRenderer has been removed")}function Pp(){console.error("THREE.JSONLoader has been removed.")}Xc.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Xc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Gh.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},Pd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Md.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},kh.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),hf.extractUrlBase(e)},kh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},pd.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},pd.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},pd.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},pd.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},ur.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},ur.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ur.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},ur.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},ur.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Rr.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Bo.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},gd.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},$n.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},$n.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},$n.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},$n.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},$n.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},$n.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},zr.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},zr.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},zr.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new sr).setFromMatrixColumn(this,3)},zr.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},zr.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},zr.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},zr.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},zr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},zr.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},zr.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},zr.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},zr.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},zr.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},zr.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},zr.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},zr.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},zr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},zr.prototype.makeFrustum=function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},zr.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},No.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},ar.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},ar.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Br.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Br.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Br.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},xi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},xi.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},xi.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},xi.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},xi.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},xi.barycoordFromPoint=function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),xi.getBarycoord(e,t,n,r,i)},xi.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),xi.getNormal(e,t,n,r)},Hh.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Hh.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Uu(this,e)},Hh.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Yu(this,e)},Zn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Zn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Zn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},sr.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},sr.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},sr.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},sr.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},sr.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},sr.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},sr.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},sr.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},sr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},nr.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},nr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ci.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},ci.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},ci.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},ci.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},ci.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(ci.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),_o.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(_o.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Xt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ic.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ao.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(jh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ii.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Tn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Tn)}}}),Ii.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tn:En),this},Ii.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ii.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},eo.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},eo.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Ii(arguments[1],arguments[2])))},eo.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},eo.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},eo.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},eo.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},eo.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(eo.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Ll.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Tn:En),this},Ll.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Uu.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Uu.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Uu.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Pl.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},od.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(wi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ri}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===g}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Eo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Tl.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},Tl.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Tl.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Tl.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Tl.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Tl.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Tl.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Tl.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Tl.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Tl.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Tl.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Tl.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Tl.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Tl.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Tl.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Tl.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Tl.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Tl.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Tl.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Tl.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Tl.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Tl.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Tl.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Tl.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Tl.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Tl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Jt:$t}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(vl.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(rr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Ff.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Tf).load(e,(function(e){t.setBuffer(e)})),this},Wf.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Co.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Co.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},Kn.crossOrigin=void 0,Kn.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Vh;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Kn.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new zh;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Kn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Kn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Lp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function kp(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=r)},function(e,t,n){"use strict";
/** @license React v16.14.0
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2),i=60103;if(t.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var o=Symbol.for;i=o("react.element"),t.Fragment=o("react.fragment")}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:a.current}}t.jsx=c,t.jsxs=c},function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r),o=n(4),a=n.n(o),s=n(7),l=n.n(s),c=n(5),u=n.n(c),h=n(6),f=n.n(h),d=n(1),p=n.n(d),m=n(8),v=n.n(m),g=n(2),y=n.n(g),_=n(11),x=n.n(_),b=n(12),w=n.n(b),S=n(0);function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var E={width:"640px",height:"480px"},T=function(e){u()(n,e);var t=M(n);function n(e){var r;return i()(this,n),r=t.call(this,e),v()(l()(r),"_onChange",(function(e){r.props.onChange({prefs:e})})),r._viewer=null,r._onChange=r._onChange.bind(l()(r)),r}return a()(n,[{key:"componentDidMount",value:function(){this._viewer=new w.a({container:this.domElement,load:"1crn"}),this._viewer.settings.addEventListener("change:axes",this._onChange),this._viewer.settings.addEventListener("change:autoRotation",this._onChange),this.props.onChange({viewer:this._viewer}),this._viewer.init()&&this._viewer.run()}},{key:"componentWillUnmount",value:function(){this._viewer.settings.now.removeEventListener(this._onChange),this._viewer.dispose(),this._viewer=null,this.props.onChange({viewer:this._viewer})}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return Object(S.jsx)("div",{className:"miew-container",ref:this.domElement,style:E})}}]),n}(y.a.Component);function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var C=function(e){u()(n,e);var t=A(n);function n(e){var r;return i()(this,n),(r=t.call(this,e)).onChange=r.onChange.bind(l()(r)),r}return a()(n,[{key:"onChange",value:function(e){var t=e.target.checked;this.props.viewer&&(t=void 0!==t?this.props.prefType(t):this.props.prefType(),Number.isNaN(t)||this.props.viewer.set(this.props.prefName,t))}},{key:"render",value:function(){var e=this.props.viewer&&this.props.prefType(this.props.viewer.get(this.props.prefName))||this.props.prefType();return Object(S.jsx)("input",{type:"checkbox",checked:e,onChange:this.onChange})}}]),n}(y.a.Component);function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var P={width:"25px"},L=function(e){u()(n,e);var t=R(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"onChange",value:function(e){if(this.props.viewer){var t=this.props.viewer.get(this.props.prefName)+this.props.delta;Number.isNaN(t)||this.props.viewer.set(this.props.prefName,t)}}},{key:"render",value:function(){var e=this;return Object(S.jsxs)("button",{style:P,onClick:function(){return e.onChange()},children:[" ",this.props.delta>0?"+":"-"," "]})}}]),n}(y.a.Component);function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var I=function(e){u()(n,e);var t=k(n);function n(e){var r;return i()(this,n),(r=t.call(this,e)).state={autoRotation:0},r}return a()(n,[{key:"onChange",value:function(e){var t=this.props.viewer;t&&this.setState({autoRotation:t.get("autoRotation")})}},{key:"render",value:function(){var e=this.props.viewer,t=e?e.get("autoRotation"):0;return Object(S.jsxs)("a",{children:[" ","Current speed: ".concat(t.toFixed(1))," "]})}}]),n}(y.a.Component);function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var O=function(e){u()(n,e);var t=N(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"onChange",value:function(e){this.props.viewer&&this.props.viewer.load(this.props.file)}},{key:"render",value:function(){var e=this;return Object(S.jsxs)("button",{onClick:function(t){return e.onChange(t)},children:[" ","Load ".concat(this.props.file.toUpperCase(),".pdb")]})}}]),n}(y.a.Component);function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var B=function(e){u()(n,e);var t=D(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"onChange",value:function(e){this.props.viewer&&this.props.viewer.rep(this.props.rep,{mode:this.props.mode})}},{key:"render",value:function(){var e=this;return Object(S.jsxs)("button",{onClick:function(t){return e.onChange(t)},children:[" ","Set rep ".concat(this.props.rep," to ").concat(this.props.mode)]})}}]),n}(y.a.Component);function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var F=function(e){u()(n,e);var t=z(n);function n(){var e;return i()(this,n),e=t.call(this),v()(l()(e),"_onViewerChange",(function(t){void 0!==t.viewer&&(e._viewer=t.viewer),e.forceUpdate()})),e._viewer=null,e._onViewerChange=e._onViewerChange.bind(l()(e)),e}return a()(n,[{key:"render",value:function(){return Object(S.jsxs)("div",{children:[Object(S.jsx)(T,{onChange:this._onViewerChange}),Object(S.jsxs)("div",{style:{"padding-top":"0.5em"},children:[Object(S.jsx)(O,{viewer:this._viewer,file:"1zlm"}),"",Object(S.jsx)(B,{viewer:this._viewer,rep:"0",mode:"BS"})," Axes ="," ",Object(S.jsx)(C,{viewer:this._viewer,prefName:"axes",prefType:Boolean})," Rotation = ",Object(S.jsx)(L,{viewer:this._viewer,prefName:"autoRotation",delta:.1,prefType:Number}),"",Object(S.jsx)(L,{viewer:this._viewer,prefName:"autoRotation",delta:-.1,prefType:Number}),"",Object(S.jsx)(I,{viewer:this._viewer})]})]})}}]),n}(y.a.Component),V=document.getElementsByClassName("main")[0];x.a.render(Object(S.jsx)(F,{}),V)}]);